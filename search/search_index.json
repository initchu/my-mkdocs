{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u4e3b\u9875","text":"<p> \u200b\u7ea6\u200b 171 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> \u201c\u200b\u76f8\u4fe1\u200b\u7684\u200b\u5fc3\u200b\u5c31\u662f\u200b\u4f60\u200b\u7684\u200b\u9b54\u6cd5\u200b\uff01\u201d <p></p> <ul> <li> <p> \u200b\u63a8\u8350\u200b\u7684\u200b\u6587\u7ae0\u200b</p> <ul> <li>linux\u200b\u73af\u5883\u200b\u90e8\u7f72\u200b</li> <li>Dijkstra\u200b\u7b97\u6cd5\u200b\u6a21\u7248\u200b</li> <li>Simple-Spring</li> </ul> </li> <li> <p> \u200b\u5173\u4e8e\u200b</p> <ul> <li>\u200b\u53cb\u94fe\u200b</li> <li>Blogger </li> <li> \u200b\u4e86\u89e3\u200b\u6211\u200b</li> </ul> </li> </ul> <p> \u200b\u672c\u7ad9\u200b\u5df2\u7ecf\u200b\u8fd0\u884c\u200b </p>"},{"location":"tag/","title":"Tags","text":"<p> \u200b\u7ea6\u200b 12 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p> <p>Tip</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u76f8\u5173\u200b\u6807\u7b7e\u200b\u7684\u200b\u5217\u8868\u200b</p>"},{"location":"tag/#tag:algorithm","title":"Algorithm","text":"<ul> <li>            Dijkstra\u200b\u7b97\u6cd5\u200b          </li> <li>            K \u200b\u4e2a\u200b\u4e00\u7ec4\u200b\u7ffb\u8f6c\u200b\u94fe\u8868\u200b          </li> <li>            \u200b\u624b\u200b\u6495\u200b\u5feb\u901f\u200b\u6392\u5e8f\u200b          </li> <li>            \u200b\u6700\u957f\u200b\u56de\u6587\u200b\u5b50\u4e32\u200b          </li> <li>            \u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u6a21\u7248\u200b          </li> </ul>"},{"location":"tag/#tag:architecture--design","title":"Architecture &amp; Design","text":"<ul> <li>            \u200b\u4ece\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u7406\u89e3\u200bPull\u200b\u4e0e\u200bPush\u200b\u6a21\u578b\u200b\u5e95\u5c42\u200b\u903b\u8f91\u200b          </li> <li>            \u200b\u6d88\u606f\u200b\u7aef\u5230\u200b\u7aef\u7684\u200b\u4e00\u81f4\u6027\u200b\u4e0e\u200b\u53ef\u9760\u6027\u200b          </li> </ul>"},{"location":"tag/#tag:cs","title":"CS","text":"<ul> <li>            Editors (Vim)          </li> <li>            Shell Tools and Scripting          </li> <li>            The Shell          </li> </ul>"},{"location":"tag/#tag:helloworld","title":"HelloWorld","text":"<ul> <li>            \u200b\u535a\u5ba2\u200b\u6587\u7ae0\u200b\u6d4b\u8bd5\u200b          </li> </ul>"},{"location":"tag/#tag:juc","title":"JUC","text":"<ul> <li>            CompletableFuture          </li> <li>            JUC          </li> <li>            Java\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u53ca\u5176\u200b\u5728\u200b\u7f8e\u56e2\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u8df5\u200b          </li> <li>            ThreadLocal          </li> <li>            Volatile\u200b\u4e0e\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b          </li> <li>            \u200b\u4e0d\u53ef\u4e0d\u200b\u8bf4\u200b\u7684\u200bJava\u201c\u200b\u9501\u200b\u201d\u200b\u4e8b\u200b          </li> <li>            \u200b\u4ece\u200bReentrantLock\u200b\u7684\u200b\u5b9e\u73b0\u200b\u770b\u200bAQS\u200b\u7684\u200b\u539f\u7406\u200b\u53ca\u200b\u5e94\u7528\u200b          </li> <li>            \u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b          </li> </ul>"},{"location":"tag/#tag:jvm","title":"JVM","text":"<ul> <li>            JVM \u200b\u601d\u7ef4\u200b\u5bfc\u56fe\u200b          </li> </ul>"},{"location":"tag/#tag:missing","title":"Missing","text":"<ul> <li>            Editors (Vim)          </li> <li>            Shell Tools and Scripting          </li> <li>            The Shell          </li> </ul>"},{"location":"tag/#tag:docker","title":"docker","text":"<ul> <li>            Minio \u200b\u90e8\u7f72\u200b          </li> <li>            Mysql \u200b\u90e8\u7f72\u200b          </li> <li>            PostgreSQL \u200b\u90e8\u7f72\u200b          </li> <li>            Redis \u200b\u90e8\u7f72\u200b          </li> <li>            RocketMQ \u200b\u90e8\u7f72\u200b          </li> <li>            docker          </li> </ul>"},{"location":"tag/#tag:git","title":"git","text":"<ul> <li>            01.IdeaGit-Demo          </li> <li>            02.IdeaGit \u200b\u57fa\u7840\u200b\u64cd\u4f5c\u200b          </li> <li>            03.IdeaGit \u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b          </li> <li>            04.IdeaGit \u200b\u5206\u652f\u200b\u7ba1\u7406\u200b          </li> <li>            05.IdeaGit \u200b\u6742\u9879\u200b          </li> <li>            git commit \u200b\u89c4\u8303\u200b          </li> </ul>"},{"location":"tag/#tag:java","title":"java","text":"<ul> <li>            CompletableFuture          </li> <li>            Frequency-Control-Starter          </li> <li>            JUC          </li> <li>            JVM \u200b\u601d\u7ef4\u200b\u5bfc\u56fe\u200b          </li> <li>            Java\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u53ca\u5176\u200b\u5728\u200b\u7f8e\u56e2\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u8df5\u200b          </li> <li>            Spring AOP          </li> <li>            Spring IOC \u200b\u5bb9\u5668\u200b          </li> <li>            Spring MVC          </li> <li>            Spring \u200b\u4e8b\u52a1\u200b          </li> <li>            Spring\u200b\u4e2d\u200b@Transactional\u200b\u5931\u6548\u200b\u573a\u666f\u200b          </li> <li>            ThreadLocal          </li> <li>            Volatile\u200b\u4e0e\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b          </li> <li>            \u200b\u4e0d\u53ef\u4e0d\u200b\u8bf4\u200b\u7684\u200bJava\u201c\u200b\u9501\u200b\u201d\u200b\u4e8b\u200b          </li> <li>            \u200b\u4ece\u200bReentrantLock\u200b\u7684\u200b\u5b9e\u73b0\u200b\u770b\u200bAQS\u200b\u7684\u200b\u539f\u7406\u200b\u53ca\u200b\u5e94\u7528\u200b          </li> <li>            \u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b          </li> <li>            \u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b          </li> <li>            \u200b\u8be6\u89e3\u200b Spring \u200b\u751f\u547d\u5468\u671f\u200b          </li> </ul>"},{"location":"tag/#tag:javascript","title":"javascript","text":"<ul> <li>            JavaScript Code Runner          </li> <li>            \u200b\u57fa\u672c\u200b\u8bed\u6cd5\u200b          </li> </ul>"},{"location":"tag/#tag:linux","title":"linux","text":"<ul> <li>            ArchLinux\u200b\u5b89\u88c5\u200b\u4e0e\u200b\u914d\u7f6e\u200b          </li> <li>            Learn-Linux          </li> <li>            linux\u200b\u73af\u5883\u200b\u90e8\u7f72\u200b          </li> </ul>"},{"location":"tag/#tag:mac","title":"mac","text":"<ul> <li>            Missing Semester of MacOS - A Vim Enthusiast Programmer\u2019s Perspective          </li> </ul>"},{"location":"tag/#tag:os","title":"os","text":"<ul> <li>            IO\u200b\u591a\u8def\u590d\u7528\u200b\u5e95\u5c42\u200b\u539f\u7406\u200b          </li> <li>            \u200b\u5206\u9875\u200b\u5b58\u50a8\u200b\u539f\u7406\u200b          </li> </ul>"},{"location":"tag/#tag:ospp","title":"ospp","text":"<ul> <li>            OSPP2025\u200b\u7ecf\u9a8c\u200b\u5206\u4eab\u200b          </li> </ul>"},{"location":"tag/#tag:project","title":"project","text":"<ul> <li>            AstroMailer \u200b\u4e00\u4e2a\u200b\u6bcf\u65e5\u200b\u65e9\u5b89\u200b\u90ae\u4ef6\u200b\u53d1\u9001\u5668\u200b          </li> </ul>"},{"location":"tag/#tag:spring","title":"spring","text":"<ul> <li>            Learn-Spring          </li> <li>            Simple-Spring          </li> <li>            Spring AOP          </li> <li>            Spring IOC \u200b\u5bb9\u5668\u200b          </li> <li>            Spring MVC          </li> <li>            Spring \u200b\u4e8b\u52a1\u200b          </li> <li>            Spring\u200b\u4e2d\u200b@Transactional\u200b\u5931\u6548\u200b\u573a\u666f\u200b          </li> <li>            \u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b          </li> <li>            \u200b\u8be6\u89e3\u200b Spring \u200b\u751f\u547d\u5468\u671f\u200b          </li> </ul>"},{"location":"tag/#tag:tools","title":"tools","text":"<ul> <li>            01.IdeaGit-Demo          </li> <li>            02.IdeaGit \u200b\u57fa\u7840\u200b\u64cd\u4f5c\u200b          </li> <li>            03.IdeaGit \u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b          </li> <li>            04.IdeaGit \u200b\u5206\u652f\u200b\u7ba1\u7406\u200b          </li> <li>            05.IdeaGit \u200b\u6742\u9879\u200b          </li> <li>            Homebrew          </li> <li>            git commit \u200b\u89c4\u8303\u200b          </li> <li>            oh-my-zsh          </li> </ul>"},{"location":"about/link/","title":"\u6b22\u8fce\u200b\u52a0\u5165\u200b\u53cb\u94fe","text":"<p> \u200b\u7ea6\u200b 198 \u200b\u4e2a\u200b\u5b57\u200b  15 \u200b\u884c\u200b\u4ee3\u7801\u200b  9 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> \u200b\u891a\u6210\u5fd7\u200b's docs              \u200b\u76f8\u4fe1\u200b\u7684\u200b\u5fc3\u200b\u5c31\u662f\u200b\u4f60\u200b\u7684\u200b\u9b54\u6cd5\u200b\uff01            Knowledge is magic              \u200b\u5f97\u5fd7\u200b\u5f53\u4e3a\u200b\u5929\u4e0b\u200b\u96e8\u200b            \u200b\u5feb\u4e50\u200b\u5c0f\u725b\u200b\u7684\u200b\u535a\u5ba2\u200b\u7ad9\u200b              \u200b\u5feb\u4e50\u200b\u5c0f\u725b\u200b            Adrian\u2018s World              \u200b\u5206\u88c2\u200b\u7684\u200b\u5f57\u661f\u200b\u5728\u200b\u9ec4\u660f\u200b\u8fc7\u540e\u200b\u5f15\u6e21\u200b\u751f\u547d\u200b\u548c\u200b\u7231\u200b            Kdlyh              \u200b\u8d8b\u820d\u200b\u6709\u65f6\u200b            Wcowin's Blog              \u200b\u5faa\u6b64\u200b\u82e6\u65c5\u200b\uff0c\u200b\u4ee5\u8fbe\u200b\u661f\u8fb0\u200b            Krison's Blog              \u200b\u5929\u5730\u200b\u6709\u5927\u7f8e\u200b\u800c\u200b\u4e0d\u8a00\u200b            \u200b\u5b9d\u7855\u200b              \u200b\u5373\u4f7f\u200b\u662f\u200b\u6c89\u91cd\u200b\u7684\u200b\u8fc7\u53bb\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u63a5\u53d7\u200b\u5b83\u200b\u518d\u200b\u7ee7\u7eed\u200b\u5411\u524d\u200b\u8fc8\u8fdb\u200b\u3002            \u200b\u4ea4\u6362\u200b\u53cb\u94fe\u200b\uff0c\u200b\u8bf7\u200b\u6dfb\u52a0\u200b\u672c\u200b\u7ad9\u53cb\u200b\u94fe\u540e\u200b\u4e0b\u65b9\u200b\u7559\u8a00\u200b\u7533\u8bf7\u200b\uff0c\u200b\u671f\u671b\u200b\u60a8\u200b\u7684\u200b\u7ad9\u70b9\u200b: <p>\u200b\u53cb\u94fe\u200b\u683c\u5f0f\u200b\u793a\u4f8b\u200b/\u200b\u672c\u7ad9\u200b\u4fe1\u606f\u200b:</p> TXTHTML(\u200b\u63a8\u8350\u200b)YAML <p>\u200b\u540d\u79f0\u200b: \u200b\u891a\u6210\u5fd7\u200b's docs</p> <p>\u200b\u94fe\u63a5\u200b: https://doc.chucz.asia</p> <p>\u200b\u5934\u50cf\u200b: https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/skvZLdl76xBab4C.png</p> <p>\u200b\u7b80\u4ecb\u200b: \u200b\u76f8\u4fe1\u200b\u7684\u200b\u5fc3\u200b\u5c31\u662f\u200b\u4f60\u200b\u7684\u200b\u9b54\u6cd5\u200b\uff01</p> <p>\u200b\u63a8\u8350\u200b\u5728\u200b\u8bc4\u8bba\u200b\u533a\u200b\u53d1\u9001\u200b\u8fd9\u79cd\u200b\u683c\u5f0f\u200b\uff0c*\u200b\u53f7\u200b\u7684\u200b\u9700\u8981\u200b\u586b\u5199\u200b\u81ea\u5df1\u200b\u7684\u200b\u4fe1\u606f\u200b</p> HTML<pre><code>&lt;div class=\"card\"&gt;\n &lt;img class=\"ava\" src=\"*\u200b\u4f60\u200b\u7684\u200b\u5934\u50cf\u200b\u94fe\u63a5\u200b*\" /&gt;\n &lt;div class=\"card-header\"&gt;\n  &lt;div&gt;\n   &lt;a href=\"*\u200b\u4f60\u200b\u7684\u200b\u7f51\u7ad9\u200b\u5730\u5740\u200b* \" target=\"_blank\"&gt;*\u200b\u4f60\u200b\u7684\u200b\u7ad9\u70b9\u200b\u540d\u79f0\u200b*&lt;/a&gt;\n  &lt;/div&gt;\n  &lt;div class=\"info\"&gt;\n   *\u200b\u4f60\u200b\u7684\u200b\u7ad9\u70b9\u200b\u63cf\u8ff0\u200b*\n  &lt;/div&gt;\n &lt;/div&gt;\n&lt;/div&gt;\n</code></pre> YAML<pre><code>- name: \u200b\u891a\u6210\u5fd7\u200b's docs\n  link: https://doc.chucz.asia\n  avatar: https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/skvZLdl76xBab4C.png\n  descr: \u200b\u76f8\u4fe1\u200b\u7684\u200b\u5fc3\u200b\u5c31\u662f\u200b\u4f60\u200b\u7684\u200b\u9b54\u6cd5\u200b\uff01\n</code></pre>"},{"location":"about/me/","title":"Hi, there! I am \u200b\u891a\u6210\u5fd7","text":"<p> \u200b\u7ea6\u200b 102 \u200b\u4e2a\u200b\u5b57\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p> <p> </p> <p>\u200b\u891a\u6210\u5fd7\u200b</p> <p>A college student in FZU</p> <p>About me</p> <ul> <li> Hey, I'm \u200b\u891a\u6210\u5fd7\u200b</li> <li> \u200b\u76f8\u4fe1\u200b\u7684\u200b\u5fc3\u200b\u5c31\u662f\u200b\u4f60\u200b\u7684\u200b\u9b54\u6cd5\u200b\uff01</li> <li> Fun Fact: \u200b\u6211\u200b\u73a9\u200b\u539f\u795e\u200b\u4e8c\u672c\u200b\u5728\u8bfb\u200b\u5bb6\u5883\u6e05\u5bd2\u200b\u9ad8\u5f3a\u5ea6\u200bb\u200b\u7ad9\u200b\u73a9\u6e38\u620f\u200b\u4e5f\u200b\u6ca1\u4ec0\u4e48\u200b\u670b\u53cb\u200b\u6bcf\u5929\u200b\u6df7\u5403\u200b\u7b49\u200b\u6b7b\u522b\u200b\u518d\u200b\u548c\u200b\u6211\u200b\u8f83\u771f\u200b\u4e86\u200b\u54e5\u200b</li> <li> \u200b\u70ed\u7231\u200b (xi\u0101)\u200b\u6298\u817e\u200b \u200b\u6280\u672f\u200b</li> <li> ACG\u200b\u7231\u597d\u8005\u200b\uff0c\u200b\u559c\u6b22\u200b\u97f3\u4e50\u200b</li> <li> \u200b\u70ed\u7231\u200b\u4e52\u4e53\u7403\u200b</li> </ul>"},{"location":"blog/","title":"Blog","text":"<p> \u200b\u7ea6\u200b 45 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p> \u200b\u547d\u91cc\u200b\u6709\u65f6\u200b\u7ec8\u987b\u200b\u6709\u200b\uff0c\u200b\u547d\u91cc\u200b\u65e0\u65f6\u200b\u83ab\u200b\u5f3a\u6c42\u200b \u200b\u65e5\u51fa\u200b\u4e1c\u6d77\u200b\u843d\u200b\u897f\u5c71\u200b\uff0c\u200b\u6101\u200b\u4e5f\u200b\u4e00\u5929\u200b\uff0c\u200b\u559c\u200b\u4e5f\u200b\u4e00\u5929\u200b \u200b\u9047\u4e8b\u200b\u4e0d\u200b\u94bb\u725b\u89d2\u5c16\u200b\uff0c\u200b\u4eba\u200b\u4e5f\u200b\u8212\u5766\u200b\uff0c\u200b\u5fc3\u200b\u4e5f\u200b\u8212\u5766\u200b <p> </p>"},{"location":"blog/backend/JVM/JVM%20%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/","title":"JVM \u200b\u601d\u7ef4\u200b\u5bfc\u56fe","text":"<p> \u200b\u7ea6\u200b 15 \u200b\u4e2a\u200b\u5b57\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p> <p>\u200b\u98de\u200b\u4e66\u200b\u6587\u6863\u200b (\u200b\u81ea\u7528\u200b\uff0c\u200b\u672a\u200b\u5b8c\u5de5\u200b): JVM</p> <p></p>","tags":["java","JVM"]},{"location":"blog/backend/Java/FrequencyControl/","title":"Frequency-Control-Starter","text":"<p> \u200b\u7ea6\u200b 3662 \u200b\u4e2a\u200b\u5b57\u200b  244 \u200b\u884c\u200b\u4ee3\u7801\u200b  7 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 15 \u200b\u5206\u949f\u200b</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#1","title":"1. \u200b\u9879\u76ee\u200b\u7b80\u4ecb","text":"<p>\u200b\u672c\u200b\u9879\u76ee\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b SpringBoot + Redis \u200b\u5b9e\u73b0\u200b\u7684\u200b\u9891\u7387\u200b\u63a7\u5236\u200b\u7ec4\u4ef6\u200b</p> <p>github\u200b\u4ed3\u5e93\u200b\u5730\u5740\u200b\uff1aFrequency-Control-Spring-Boot-Starter</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#2","title":"2. \u200b\u9879\u76ee\u200b\u4eae\u70b9","text":"<ol> <li>\u200b\u4f7f\u7528\u200b lua\u200b\u811a\u672c\u200b \u200b\u4fdd\u8bc1\u200bredis\u200b\u7684\u200b\u9891\u7387\u200b\u8ba1\u6570\u200b\u7684\u200b \u200b\u539f\u5b50\u200b\u6027\u200b</li> <li>\u200b\u5141\u8bb8\u200b\u67d0\u4e2a\u200b\u63a5\u53e3\u200b\u62e5\u6709\u200b\u591a\u79cd\u200b\u9891\u63a7\u200b\u7b56\u7565\u200b\uff08\u200b\u5982\u200b\u5141\u8bb8\u200b5s\u200b\u5185\u200b3\u200b\u6b21\u200b\u300130\u200b\u79d2\u200b\u5185\u200b10\u200b\u6b21\u200b\uff09</li> <li>\u200b\u5141\u8bb8\u200b\u67d0\u4e2a\u200b\u63a5\u53e3\u200b\u62e5\u6709\u200b\u591a\u79cd\u200b\u9891\u63a7\u200b\u7b97\u6cd5\u200b\uff08\u200b\u5982\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b + \u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\uff09</li> <li>\u200b\u5b9e\u73b0\u200b\u6838\u5fc3\u200b\u914d\u7f6e\u200b\u7c7b\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u901a\u8fc7\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u81ea\u5b9a\u4e49\u200b\u9ed8\u8ba4\u200b\u9891\u63a7\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u3001\u200b\u9891\u63a7\u200b\u65f6\u95f4\u200b\u5355\u4f4d\u200b\u3001\u200b\u5355\u4f4d\u200b\u9891\u63a7\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u5185\u200b\u6700\u5927\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b</li> <li>\u200b\u53ef\u200b\u901a\u8fc7\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b\u66ff\u6362\u200b\u9650\u6d41\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u5b9e\u73b0\u200bSPI\u200b\u673a\u5236\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u81ea\u5b9a\u4e49\u200b\u5b9e\u73b0\u200b\u9650\u6d41\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u91c7\u7528\u200b\u7b56\u7565\u200b\u6a21\u5f0f\u200b+\u200b\u6a21\u7248\u200b\u65b9\u6cd5\u200b\u6a21\u5f0f\u200b+\u200b\u5de5\u5382\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u62bd\u8c61\u200b\u9650\u6d41\u200b\u7b56\u7565\u200b\u670d\u52a1\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\u3001\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u3001\u200b\u4ee4\u724c\u200b\u6876\u200b\u7b49\u200b\u9650\u6d41\u200b\u7b97\u6cd5\u200b\u7b56\u7565\u200b</li> </ol>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#3","title":"3. \u200b\u9891\u63a7\u200b\u5c5e\u6027\u200b\u6838\u5fc3\u200b\u914d\u7f6e","text":"<p>\u200b\u5728\u200b\u9891\u63a7\u200b\u5c5e\u6027\u200b\u914d\u7f6e\u200b\u65b9\u9762\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u80fd\u591f\u200b\u901a\u8fc7\u200b\u5728\u200b <code>application.properties</code> \u200b\u6216\u200b <code>application.yml</code> \u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u76f8\u5173\u200b\u53c2\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7075\u6d3b\u200b\u8c03\u6574\u200b\u9650\u6d41\u200b\u7b56\u7565\u200b\u3001\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\u3001\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\u3001\u200b\u9891\u7387\u200b\u9650\u5236\u200b\u548c\u200b\u65f6\u95f4\u200b\u5355\u4f4d\u200b\uff0c\u200b\u4ee5\u200b\u9002\u5e94\u200b\u7279\u5b9a\u200b\u573a\u666f\u200b\u3002</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#31","title":"3.1 \u200b\u914d\u7f6e\u200b\u9879\u200b\u6982\u89c8","text":"","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#32","title":"3.2 \u200b\u6548\u679c\u200b\u5c55\u793a","text":"<p>\u200b\u540c\u65f6\u200b\u6211\u200b\u914d\u7f6e\u200b\u4e86\u200b <code>spring-configuration-metadata.json</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u914d\u7f6e\u200b\u4fe1\u606f\u200b\u7684\u200b\u81ea\u52a8\u200b\u63d0\u793a\u200b\u3001\u200b\u8865\u5168\u200b\u529f\u80fd\u200b</p> <ol> <li> <p>\u200b\u81ea\u52a8\u200b\u63d0\u793a\u200b </p> </li> <li> <p>\u200b\u81ea\u52a8\u200b\u8865\u5168\u200b </p> </li> </ol>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#4","title":"4. \u200b\u9891\u63a7\u200b\u6ce8\u89e3\u200b\u53ca\u200b\u5207\u9762\u200b\u5b9e\u73b0","text":"","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#41","title":"4.1 \u200b\u9891\u63a7\u200b\u6ce8\u89e3","text":"<p>\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\u9891\u63a7\u200b\u6ce8\u89e3\u200b\uff0c\u200b\u5305\u542b\u200b\u9891\u63a7\u200b\u7b97\u6cd5\u200b\u53ca\u200b\u76f8\u5173\u200b\u7b97\u6cd5\u200b\u914d\u7f6e\u200b\u7b49\u200b\u5c5e\u6027\u200b</p> Java<pre><code>@Repeatable(FrequencyControlContainer.class) // \u200b\u53ef\u200b\u91cd\u590d\u200b\n@Retention(RetentionPolicy.RUNTIME)// \u200b\u8fd0\u884c\u200b\u65f6\u200b\u751f\u6548\u200b\n@Target(ElementType.METHOD)//\u200b\u4f5c\u7528\u200b\u5728\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\npublic @interface FrequencyControl {\n\n    FrequencyControlStrategyEnum strategy() default FrequencyControlStrategyEnum.TOTAL_COUNT_WITH_IN_FIX_TIME;\n\n    int windowSize() default -1;\n\n    int period() default -1;\n\n    String prefixKey() default \"\";\n\n    FrequencyControlTargetEnum target() default FrequencyControlTargetEnum.EL;\n\n    String spEl() default \"\";\n\n    int time() default -1;\n\n    TimeUnit unit() default TimeUnit.SECONDS;\n\n    int count() default -1;\n\n    long capacity() default -1; \n\n    double refillRate() default -1; \n}\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u5230\u200b\uff1a\u200b\u6ce8\u89e3\u200b\u5c5e\u6027\u200b\u9ed8\u8ba4\u503c\u200b\u5927\u90e8\u5206\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b -1 \u200b\u6216\u200b \u200b\u7a7a\u200b\u5b57\u7b26\u4e32\u200b</p> <p>\u200b\u539f\u56e0\u200b\u5728\u4e8e\u200b\uff1a</p> <ol> <li>\u200b\u6ce8\u89e3\u200b\u5c5e\u6027\u200b\u4e0d\u53ef\u200b\u53d8\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u901a\u8fc7\u200b <code>Properties</code> \u200b\u52a8\u6001\u200b\u914d\u7f6e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u91c7\u7528\u200b -1 \u200b\u6216\u200b \u200b\u7a7a\u200b\u5b57\u7b26\u4e32\u200b \u200b\u8868\u793a\u200b\u91c7\u7528\u200b\u9ed8\u8ba4\u503c\u200b</li> <li>\u200b\u57fa\u4e8e\u200b\u4e0a\u200b\u4e00\u70b9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u6ce8\u89e3\u200b\u5c5e\u6027\u200b\u4e0d\u200b\u4e3a\u200b -1 \u200b\u6216\u200b \u200b\u7a7a\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u5219\u200b\u5728\u200b\u5207\u9762\u200b\u6267\u884c\u200b\u65f6\u200b\u8868\u793a\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u503c\u200b</li> </ol>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#42","title":"4.2 \u200b\u53ef\u200b\u91cd\u590d\u200b\u6ce8\u89e3","text":"<p>\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u63a5\u53e3\u200b\u53ef\u4ee5\u200b\u62e5\u6709\u200b\u591a\u79cd\u200b\u9891\u63a7\u200b\u7b56\u7565\u200b\u6216\u200b\u9891\u63a7\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u9700\u8981\u200b\u5b9e\u73b0\u200b\u6ce8\u89e3\u200b\u53ef\u200b\u91cd\u590d\u4f7f\u7528\u200b \u200b\u53c2\u8003\u200b Java8\u200b\u65b0\u200b\u7279\u6027\u200b(\u200b\u516d\u200b)\u200b\u91cd\u590d\u200b\u6ce8\u89e3\u200b\u4e0e\u200b\u7c7b\u578b\u200b\u6ce8\u89e3\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u5bb9\u5668\u200b\u6ce8\u89e3\u200b\u7c7b\u200b\uff1a</p> Java<pre><code>@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface FrequencyControlContainer {\n    // \u200b\u53ef\u200b\u91cd\u590d\u200b\u6ce8\u89e3\u200b\n    FrequencyControl[] value();\n}\n</code></pre>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#43","title":"4.3 \u200b\u5207\u9762\u200b\u5b9e\u73b0","text":"<p>\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>@Around(\"@annotation(com.iflove.starter.frequencycontrol.annotation.FrequencyControl)||@annotation(com.iflove.starter.frequencycontrol.annotation.FrequencyControlContainer)\")\npublic Object around(ProceedingJoinPoint joinPoint) throws Throwable {\n    Method method = ((MethodSignature) joinPoint.getSignature()).getMethod();\n    FrequencyControl[] annotationsByType = method.getAnnotationsByType(FrequencyControl.class);\n    // \u200b\u5b9e\u73b0\u200b\u6ce8\u89e3\u200b\u914d\u7f6e\u200b\u7684\u200b\u52a8\u6001\u200b\u66ff\u6362\u200b\n    List&lt;FrequencyControlConfig&gt; frequencyControlConfigs = injectPropertiesToAnnotations(annotationsByType);\n\n    Map&lt;String, FrequencyControlConfig&gt; keyMap = new HashMap&lt;&gt;();\n\n    for (int i = 0; i &lt; frequencyControlConfigs.size(); i++) {\n        FrequencyControlConfig config = frequencyControlConfigs.get(i);\n        // \u200b\u9ed8\u8ba4\u200b\u4e3a\u200b\u65b9\u6cd5\u200b\u9650\u5b9a\u200b\u540d\u200b + \u200b\u6ce8\u89e3\u200b\u6392\u540d\u200b\uff08\u200b\u53ef\u80fd\u200b\u591a\u4e2a\u200b\uff09\n        String prefix = StrUtil.isBlank(config.getPrefixKey()) ? method.toGenericString() + \":index:\" + i : config.getPrefixKey();\n        String key = \"\";\n        switch (config.getTarget()) {\n            case EL -&gt; key = SPELUtils.parseSPEL(method, joinPoint.getArgs(), config.getSpEl());\n            case IP -&gt; key = UserContext.getIp();\n            case UID -&gt; key = UserContext.getUserId();\n        }\n        // \u200b\u5b58\u5165\u200bkeyMap\n        keyMap.put(prefix + \":\" + key, config);\n    }\n    // \u200b\u6839\u636e\u200b\u7b56\u7565\u200b\u5206\u7ec4\u200b\n    Map&lt;FrequencyControlStrategyEnum, Map&lt;String, FrequencyControlConfig&gt;&gt; configMapByStrategy = keyMap.entrySet().stream()\n            .collect(Collectors.groupingBy(\n                    entry -&gt; entry.getValue().getStrategy(),\n                    Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue)\n            ));\n\n    Map&lt;String, FrequencyControlConfig&gt; configMap;\n    // \u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\n    if ((configMap = configMapByStrategy.get(FrequencyControlStrategyEnum.TOTAL_COUNT_WITH_IN_FIX_TIME)) != null) {\n        List&lt;FixedWindowDTO&gt; frequencyControlDTOS = configMap.entrySet().stream().map(entrySet -&gt; buildFixedWindowDTO(entrySet.getKey(), entrySet.getValue())).collect(Collectors.toList());\n        FrequencyControlUtil.executeWithFrequencyControlList(FrequencyControlStrategyEnum.TOTAL_COUNT_WITH_IN_FIX_TIME, frequencyControlDTOS);\n    }\n    // \u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\n    if ((configMap = configMapByStrategy.get(FrequencyControlStrategyEnum.SLIDING_WINDOW)) != null) {\n        List&lt;SlidingWindowDTO&gt; frequencyControlDTOS = configMap.entrySet().stream().map(entrySet -&gt; buildSlidingWindowDTO(entrySet.getKey(), entrySet.getValue())).collect(Collectors.toList());\n        FrequencyControlUtil.executeWithFrequencyControlList(FrequencyControlStrategyEnum.SLIDING_WINDOW, frequencyControlDTOS);\n    }\n    // \u200b\u4ee4\u724c\u200b\u6876\u200b\n    if ((configMap = configMapByStrategy.get(FrequencyControlStrategyEnum.TOKEN_BUCKET)) != null) {\n        List&lt;TokenBucketDTO&gt; frequencyControlDTOS = configMap.entrySet().stream().map(entrySet -&gt; buildTokenBucketDTO(entrySet.getKey(), entrySet.getValue())).collect(Collectors.toList());\n        FrequencyControlUtil.executeWithFrequencyControlList(FrequencyControlStrategyEnum.TOKEN_BUCKET, frequencyControlDTOS);\n    }\n    return joinPoint.proceed();\n}\n</code></pre>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#5","title":"5. \u200b\u5e38\u89c1\u200b\u7684\u200b\u9650\u6d41\u200b\u7b97\u6cd5\u200b\u53ca\u200b\u76f8\u5173\u200b\u5b9e\u73b0","text":"","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#51","title":"5.1 \u200b\u62bd\u8c61\u200b\u9650\u6d41\u200b\u7b56\u7565","text":"<p>\u200b\u91cd\u70b9\u200b\u5173\u6ce8\u200b\u4ee5\u4e0b\u200b3\u200b\u4e2a\u200b\u65b9\u6cd5\u200b\uff1a</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#1-executewithfrequencycontrolmap","title":"1. #executeWithFrequencyControlMap","text":"Java<pre><code>/**\n * \u200b\u6267\u884c\u200b\u9650\u6d41\u200b\u7b56\u7565\u200b\n *\n * @param frequencyControlMap   \u200b\u5b9a\u4e49\u200b\u7684\u200b\u6ce8\u89e3\u200b\u9891\u63a7\u200b\n *                              Map\u200b\u4e2d\u200b\u7684\u200bKey-{@link K#getKey()}-\u200b\u5bf9\u5e94\u200bredis\u200b\u7684\u200b\u5355\u4e2a\u200b\u9891\u63a7\u200b\u7684\u200bKey\n *                              Map\u200b\u4e2d\u200b\u7684\u200bValue-\u200b\u5bf9\u5e94\u200bredis\u200b\u7684\u200b\u5355\u4e2a\u200b\u9891\u63a7\u200b\u7684\u200bKey\u200b\u9650\u5236\u200b\u7684\u200bValue\n */\nprivate void executeWithFrequencyControlMap(Map&lt;String, K&gt; frequencyControlMap) {\n    // \u200b\u5224\u65ad\u200b\uff1a\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\n    if (reachRateLimit(frequencyControlMap)) {\n        throw new FrequencyControlException((String) null);\n    }\n    // \u200b\u589e\u52a0\u200b\u9650\u6d41\u200b\u7edf\u8ba1\u200b\n    addFrequencyControlStatisticsCount(frequencyControlMap);\n}\n</code></pre> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u6267\u884c\u200b\u9650\u6d41\u200b\u7b56\u7565\u200b\uff0c\u200b\u901a\u8fc7\u200b\u6307\u5b9a\u200b\u7684\u200b\u9891\u63a7\u200b\u914d\u7f6e\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u672a\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\u65f6\u200b\u589e\u52a0\u200b\u9891\u63a7\u200b\u7edf\u8ba1\u200b\u8ba1\u6570\u200b</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#2-reachratelimit","title":"2. #reachRateLimit","text":"Java<pre><code>/**\n * \u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b (\u200b\u5b50\u7c7b\u200b\u5b9e\u73b0\u200b)\n *\n * @param frequencyControlMap \u200b\u5b9a\u4e49\u200b\u7684\u200b\u6ce8\u89e3\u200b\u9891\u63a7\u200b\n *                            Map\u200b\u4e2d\u200b\u7684\u200bKey-{@link K#getKey()}-\u200b\u5bf9\u5e94\u200bredis\u200b\u7684\u200b\u5355\u4e2a\u200b\u9891\u63a7\u200b\u7684\u200bKey\n *                            Map\u200b\u4e2d\u200b\u7684\u200bValue-\u200b\u5bf9\u5e94\u200bredis\u200b\u7684\u200b\u5355\u4e2a\u200b\u9891\u63a7\u200b\u7684\u200bKey\u200b\u9650\u5236\u200b\u7684\u200bValue\n * @return true-\u200b\u65b9\u6cd5\u200b\u88ab\u200b\u9650\u6d41\u200b false-\u200b\u65b9\u6cd5\u200b\u6ca1\u6709\u200b\u88ab\u200b\u9650\u6d41\u200b\n */\nprotected abstract boolean reachRateLimit(Map&lt;String, K&gt; frequencyControlMap);\n</code></pre> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\uff0c\u200b\u4ea4\u7ed9\u200b\u5b50\u7c7b\u200b\u5b9e\u73b0\u200b</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#3-addfrequencycontrolstatisticscount","title":"3. #addFrequencyControlStatisticsCount","text":"Java<pre><code>/**\n * \u200b\u589e\u52a0\u200b\u9650\u6d41\u200b\u7edf\u8ba1\u200b\u6b21\u6570\u200b (\u200b\u5b50\u7c7b\u200b\u5b9e\u73b0\u200b)\n *\n * @param frequencyControlMap \u200b\u5b9a\u4e49\u200b\u7684\u200b\u6ce8\u89e3\u200b\u9891\u63a7\u200b\n *                            Map\u200b\u4e2d\u200b\u7684\u200bKey-{@link K#getKey()}-\u200b\u5bf9\u5e94\u200bredis\u200b\u7684\u200b\u5355\u4e2a\u200b\u9891\u63a7\u200b\u7684\u200bKey\n *                            Map\u200b\u4e2d\u200b\u7684\u200bValue-\u200b\u5bf9\u5e94\u200bredis\u200b\u7684\u200b\u5355\u4e2a\u200b\u9891\u63a7\u200b\u7684\u200bKey\u200b\u9650\u5236\u200b\u7684\u200bValue\n */\nprotected abstract void addFrequencyControlStatisticsCount(Map&lt;String, K&gt; frequencyControlMap);\n</code></pre> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u589e\u52a0\u200b\u9650\u6d41\u200b\u7edf\u8ba1\u200b\u6b21\u6570\u200b\uff0c\u200b\u4ea4\u7ed9\u200b\u5b50\u7c7b\u200b\u5b9e\u73b0\u200b</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#52","title":"5.2 \u200b\u56fa\u5b9a\u200b\u7a97\u53e3","text":"","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#1_1","title":"1. \u200b\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u56fa\u5b9a\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\uff08Fixed Window Rate Limiting Algorithm\uff09\uff08\u200b\u4e5f\u200b\u53eb\u200b\u8ba1\u6570\u5668\u200b\uff09\u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u9650\u6d41\u200b\u7b97\u6cd5\u200b\u4e4b\u4e00\u200b\u3002\u200b\u5b83\u200b\u5212\u5206\u200b\u4e86\u200b\u591a\u5757\u200b\u56fa\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9650\u5236\u200b\u4e86\u200b\u6bcf\u5757\u200b\u7a97\u53e3\u200b\u7684\u200b\u6700\u5927\u200b\u8bf7\u6c42\u200b\u6570\u91cf\u200b\u3002</p> <p></p> <p>\u200b\u5982\u679c\u200b\u5c06\u200b\u65f6\u95f4\u200b\u6bcf\u79d2\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\u4e0d\u80fd\u200b\u8d85\u8fc7\u200b4\u200b\u4e2a\u200b\u8bf7\u6c42\u200b\u3002\u200b\u8fd9\u65f6\u5019\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\u6709\u4e2a\u200b\u5f88\u200b\u4e25\u91cd\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5c31\u662f\u200b\u4e34\u754c\u70b9\u200b\u95ee\u9898\u200b\u3002\u200b\u5f53\u200b\u5207\u6362\u200b\u7a97\u53e3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6240\u6709\u200b\u8ba1\u6570\u200b\u5c06\u4f1a\u200b\u91cd\u65b0\u200b\u8ba1\u6570\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u77ed\u77ed\u200b0.5\u200b\u79d2\u200b\u5185\u200b\u8fbe\u5230\u200b6\u200b\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <ul> <li>\u200b\u4f18\u70b9\u200b\uff1a<ul> <li>\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\u7b97\u6cd5\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u6613\u4e8e\u200b\u5b9e\u73b0\u200b\u548c\u200b\u7406\u89e3\u200b\u3002</li> </ul> </li> <li>\u200b\u7f3a\u70b9\u200b\uff1a<ul> <li>\u200b\u5b58\u5728\u200b\u660e\u663e\u200b\u7684\u200b\u4e34\u754c\u200b\u95ee\u9898\u200b\uff0c\u200b\u5982\u679c\u200b\u8bf7\u6c42\u200b\u96c6\u4e2d\u200b\u5728\u200b\u4e24\u4e2a\u200b\u7a97\u53e3\u200b\u4e4b\u95f4\u200b\u3002\u200b\u90a3\u4e48\u200b\u8bf7\u6c42\u200b\u6b21\u6570\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8d85\u8fc7\u200b\u6211\u4eec\u200b\u7684\u200b\u9884\u671f\u200b\uff0c\u200b\u6700\u9ad8\u200b\u8fbe\u5230\u200b\u9884\u671f\u200b\u7684\u200b\u4e24\u500d\u200b\u3002</li> </ul> </li> </ul>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#2_1","title":"2. \u200b\u9002\u7528\u200b\u573a\u666f","text":"<p>\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\u5b9e\u73b0\u200b\u8d77\u6765\u200b\u7b80\u5355\u200b\u65b9\u4fbf\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u5b83\u200b\u6700\u5927\u200b\u4f18\u70b9\u200b\u3002\u200b\u8981\u547d\u200b\u7684\u200b\u5c31\u662f\u200b\u5b83\u200b\u7684\u200b\u4e34\u754c\u200b\u95ee\u9898\u200b\u3002\u200b\u53ea\u8981\u200b\u5e73\u5e38\u200b\u6d41\u91cf\u200b\u76f8\u5bf9\u200b\u5747\u5300\u5206\u5e03\u200b\uff0c\u200b\u6216\u8005\u200b\u6211\u4eec\u200b\u80fd\u591f\u200b\u63a5\u53d7\u200b\u9650\u6d41\u200b\u51c6\u786e\u5ea6\u200b\u6ca1\u200b\u90a3\u4e48\u200b\u4e25\u683c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\u662f\u200b\u4e2a\u200b\u5f88\u200b\u4e0d\u9519\u200b\u7684\u200b\u65b9\u6848\u200b\u3002</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#3_1","title":"3. \u200b\u4ee3\u7801\u200b\u5b9e\u73b0","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b\uff1a<code>com.iflove.starter.frequencycontrol.service.frequencycontrol.strategy.TotalCountWithInFixTimeFrequencyController</code></p> <p>\u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>@Override\nprotected boolean reachRateLimit(Map&lt;String, FixedWindowDTO&gt; frequencyControlMap) {\n    // \u200b\u6279\u91cf\u200b\u83b7\u53d6\u200b\n    List&lt;String&gt; frequencyKeys = new ArrayList&lt;&gt;(frequencyControlMap.keySet());\n    List&lt;Integer&gt; countList = RedisUtil.mget(frequencyKeys, Integer.class);\n    for (int i = 0; i &lt; frequencyKeys.size(); i++) {\n        String key = frequencyKeys.get(i);\n        Integer count = countList.get(i);\n        int frequencyControlCountLimit = frequencyControlMap.get(key).getCount();\n        // \u200b\u5224\u65ad\u200b\uff1a\u200b\u5230\u8fbe\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\n        if (Objects.nonNull(count) &amp;&amp; count &gt;= frequencyControlCountLimit) {\n            log.warn(\"frequenctControl limit key:{}, count:{}\", key, count);\n            return true;\n        }\n    }\n    return false;\n}\n\n@Override\nprotected void addFrequencyControlStatisticsCount(Map&lt;String, FixedWindowDTO&gt; frequencyControlMap) {\n    frequencyControlMap.forEach((k, v) -&gt; RedisUtil.inc(k, v.getTime(), v.getUnit()));\n}\n</code></pre> <ul> <li> <p><code>#reachRateLimit</code></p> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b</p> <ol> <li>\u200b\u6279\u91cf\u200b\u83b7\u53d6\u200b\uff1a\u200b\u5c06\u200b\u6240\u6709\u200b\u9650\u6d41\u200b\u952e\u200b\u63d0\u53d6\u200b\u4e3a\u200b <code>List</code>\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b <code>RedisUtil.mget</code> \u200b\u65b9\u6cd5\u200b\u4ece\u200b <code>Redis</code> \u200b\u4e2d\u200b\u6279\u91cf\u200b\u83b7\u53d6\u200b\u8fd9\u4e9b\u200b\u952e\u200b\u7684\u200b\u8ba1\u200b\u6570\u503c\u200b\u3002</li> <li>\u200b\u904d\u5386\u200b\u5e76\u200b\u68c0\u67e5\u200b\uff1a\u200b\u904d\u5386\u200b\u6bcf\u4e2a\u200b\u952e\u200b\u7684\u200b\u8ba1\u200b\u6570\u503c\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5176\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\u3002</li> <li>\u200b\u9650\u6d41\u200b\u5224\u65ad\u200b\uff1a\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u952e\u200b\u7684\u200b\u8ba1\u200b\u6570\u503c\u200b\u8fbe\u5230\u200b\u6216\u200b\u8d85\u8fc7\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u5e76\u200b\u8fd4\u56de\u200b <code>true</code> \u200b\u8868\u793a\u200b\u5df2\u200b\u9650\u6d41\u200b\u3002\u200b\u5426\u5219\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u904d\u5386\u200b\u3002</li> <li>\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\uff1a\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u952e\u200b\u90fd\u200b\u672a\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\uff0c\u200b\u8fd4\u56de\u200b <code>false</code> \u200b\u8868\u793a\u200b\u672a\u200b\u9650\u6d41\u200b\u3002</li> </ol> </li> <li> <p><code>#addFrequencyControlStatisticsCount</code></p> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u589e\u52a0\u200b\u6bcf\u4e2a\u200b\u9650\u6d41\u200b\u952e\u200b\u7684\u200b\u8ba1\u6570\u200b\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u952e\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u3002</p> <ol> <li>\u200b\u8ba1\u6570\u200b\u9012\u589e\u200b\uff1a\u200b\u904d\u5386\u200b <code>frequencyControlMap</code>\uff0c\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b\u9650\u6d41\u200b\u952e\u200b\u8c03\u7528\u200b <code>RedisUtil.inc</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u589e\u52a0\u200b\u8ba1\u6570\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u3002</li> <li>\u200b\u8bbe\u7f6e\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\uff1a<code>RedisUtil.inc</code> \u200b\u63a5\u6536\u200b\u4e00\u4e2a\u200b\u65f6\u95f4\u200b\u548c\u200b\u5355\u4f4d\u200b\u53c2\u6570\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8bbe\u7f6e\u200b <code>Redis</code> \u200b\u952e\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ee5\u200b\u786e\u4fdd\u200b\u8ba1\u6570\u200b\u5728\u200b\u7a97\u53e3\u200b\u7ed3\u675f\u200b\u540e\u200b\u91cd\u7f6e\u200b\u3002</li> </ol> </li> </ul> <p><code>RedisUtil.inc</code> \u200b\u65b9\u6cd5\u200b\u5e95\u5c42\u200b\u8c03\u7528\u200b <code>lua</code> \u200b\u811a\u672c\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\uff0c<code>lua</code>\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> Lua<pre><code>local key, ttl = KEYS[1], ARGV[1]\n\nif redis.call('EXISTS', key) == 0 then\n    redis.call('SETEX', key, ttl, 1)\n    return 1\nelse\n    return tonumber(redis.call('INCR', key))\nend\n</code></pre>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#53","title":"5.3 \u200b\u6ed1\u52a8\u200b\u7a97\u53e3","text":"","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#1_2","title":"1. \u200b\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\u66f4\u6362\u200b\u7a97\u53e3\u200b\u65f6\u200b\u7684\u200b\u4e34\u754c\u70b9\u200b\u95ee\u9898\u200b\u3002\u200b\u56e0\u6b64\u200b\u51fa\u73b0\u200b\u4e86\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e00\u76f4\u200b\u90fd\u200b\u53ea\u7528\u200b\u4e00\u4e2a\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u8fd9\u4e2a\u200b\u7a97\u53e3\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u5411\u524d\u200b\u6ed1\u52a8\u200b\u3002</p> <p>\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u5c06\u200b\u65f6\u95f4\u200b\u5206\u4e3a\u200b\u591a\u4e2a\u200b\u5c0f\u200b\u7c92\u5ea6\u200b\u7684\u200b\u533a\u95f4\u200b\u3002\u200b\u5e76\u4e14\u200b\u7edf\u8ba1\u200b\u7a97\u53e3\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u7684\u200b\u79fb\u9664\u200b\u6700\u65e9\u200b\u7684\u200b\u683c\u5b50\u200b\uff0c\u200b\u52a0\u5165\u200b\u65b0\u200b\u7684\u200b\u683c\u5b50\u200b\u3002\u200b\u6240\u6709\u200b\u7684\u200b\u8ba1\u6570\u200b\u53ea\u4f1a\u200b\u7edf\u8ba1\u200b\u7a97\u53e3\u200b\u5185\u200b\u7684\u200b\u503c\u200b\u3002</p> <p></p> <p>\u200b\u5047\u8bbe\u200b\u65f6\u95f4\u200b\u7c92\u5ea6\u200b\u4e3a\u200b0.25s\u200b\u6bcf\u683c\u200b\uff0c\u200b\u6700\u5927\u200b\u8bf7\u6c42\u200b\u6570\u91cf\u200b4\u200b\u4e2a\u200b\u6bcf\u79d2\u200b\u3002</p> <p>\u200b\u7ea2\u8272\u200b\u7684\u200b\u7403\u200b\u5c31\u662f\u200b\u88ab\u200b\u9650\u6d41\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u968f\u7740\u200b\u65f6\u95f4\u200b\u7684\u200b\u4e0d\u65ad\u200b\u589e\u52a0\u200b\uff0c\u200b\u6bcf\u200b0.25s\uff0c\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\u5c31\u200b\u4f1a\u200b\u5f80\u524d\u200b\u6ed1\u52a8\u200b\u4e00\u5c0f\u200b\u683c\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u90fd\u200b\u4f1a\u200b\u7edf\u8ba1\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\u5185\u200b\u7684\u200b\u8bf7\u6c42\u200b\u4e0d\u80fd\u200b\u8d85\u8fc7\u200b4\u200b\u4e2a\u200b\u3002</p> <ul> <li> <p>\u200b\u4f18\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u5e73\u6ed1\u200b\uff0c\u200b\u76f8\u6bd4\u200b\u8d77\u200b\u56fa\u5b9a\u200b\u7a97\u53e3\u200b\uff0c\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u89e3\u51b3\u200b\u4e86\u200b\u4e34\u754c\u200b\u95ee\u9898\u200b\u3002\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u7684\u200b\u7cbe\u5ea6\u200b\u66f4\u9ad8\u200b\uff0c\u200b\u80fd\u200b\u8ba9\u200b\u8bf7\u6c42\u200b\u66f4\u52a0\u200b\u7684\u200b\u5e73\u6ed1\u200b\u3002</li> <li>\u200b\u72b6\u6001\u200b\u6027\u200b\uff0c\u200b\u662f\u200b\u7f3a\u70b9\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u4f18\u70b9\u200b\u3002\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6240\u6709\u200b\u8bf7\u6c42\u200b\u7684\u200b\u539f\u59cb\u200b\u72b6\u6001\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u7edf\u8ba1\u200b\u3002</li> </ul> </li> <li> <p>\u200b\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u72b6\u6001\u200b\u6027\u200b\uff0c\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u7b97\u6cd5\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u7a97\u53e3\u200b\u5185\u200b\u7684\u200b\u8bf7\u6c42\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e9b\u200b\u8bf7\u6c42\u200b\u4e0d\u662f\u200b\u5355\u7eaf\u200b\u7684\u200b\u6570\u503c\u200b\uff0c\u200b\u5b83\u4eec\u200b\u548c\u200b\u6700\u5c0f\u200b\u683c\u5b50\u200b\u6302\u94a9\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e00\u5b9a\u200b\u7684\u200b\u72b6\u6001\u200b\u5b58\u50a8\u200b\u5f00\u9500\u200b\uff0c\u200b\u5c24\u5176\u200b\u5bf9\u4e8e\u200b\u5927\u89c4\u6a21\u200b\u7684\u200b\u7cfb\u7edf\u200b\u3002</li> </ul> </li> </ul>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#2_2","title":"2. \u200b\u9002\u7528\u200b\u573a\u666f","text":"<p>\u200b\u9009\u62e9\u200b\u573a\u666f\u200b\u524d\u200b\uff0c\u200b\u4f9d\u7136\u200b\u8981\u200b\u4e86\u89e3\u200b\u5b83\u200b\u7684\u200b\u4f18\u7f3a\u70b9\u200b\uff0c\u200b\u624d\u200b\u77e5\u9053\u200b\u600e\u4e48\u200b\u53bb\u200b\u9002\u914d\u200b\u573a\u666f\u200b\u3002\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u6700\u5927\u200b<code>\u200b\u4f18\u70b9\u200b</code>\u200b\u662f\u200b\u5e73\u6ed1\u200b\u3002\u200b\u80fd\u591f\u200b\u5141\u8bb8\u200b\u5076\u5c14\u200b\u7a81\u53d1\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f1a\u200b\u9650\u5236\u200b\u7a97\u53e3\u200b\u5185\u200b\u7684\u200b\u603b\u200b\u6b21\u6570\u200b\uff0c\u200b\u9002\u5408\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u5e73\u5747\u200b\u901f\u7387\u200b\u7684\u200b\u573a\u666f\u200b\u3002<code>\u200b\u7f3a\u70b9\u200b</code>\u200b\u662f\u200b\u4ed6\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u7a97\u53e3\u200b\u5185\u200b\u6bcf\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u95f4\u200b\u5206\u5e03\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u5360\u7528\u200b\u5185\u5b58\u200b\u3002\u200b\u6b63\u662f\u200b\u56e0\u4e3a\u200b\u8fd9\u6837\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u6700\u597d\u200b\u662f\u200b\u7528\u4e8e\u200b\u5168\u5c40\u200b\u7684\u200b\u9650\u6d41\u200b\u3002\u200b\u5982\u679c\u200b\u7528\u4e8e\u200b\u7528\u6237\u200b\u7ea7\u522b\u200b\u7684\u200b\u9650\u6d41\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4f1a\u200b\u4e3a\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7528\u6237\u200b\u90fd\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u6d88\u8017\u200b\u5185\u5b58\u200b\u3002</p> <ul> <li>api\u200b\u9650\u6d41\u200b</li> </ul> <p>\u200b\u9488\u5bf9\u200b\u63a5\u53e3\u200b\u9650\u6d41\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e00\u822c\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u538b\u6d4b\u200b\u9884\u4f30\u200b\u63a5\u53e3\u200b\u7684\u200bqps\u3002\u200b\u4e86\u89e3\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u4e4b\u540e\u200b\u3002\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5bf9\u63a5\u53e3\u200b\u8fdb\u884c\u200b\u6700\u5927\u200bqps90%\u200b\u7684\u200b\u901f\u7387\u200b\u9650\u5236\u200b\u3002\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u9650\u6d41\u200b\u3002\u200b\u4ed6\u200b\u53ef\u4ee5\u200b\u5e73\u6ed1\u200b\u7684\u200b\u4fdd\u8bc1\u200b\u6bcf\u79d2\u200b\u7684\u200b\u8bf7\u6c42\u200b\u91cf\u200b\u4e0d\u200b\u8d85\u8fc7\u200b\u6211\u4eec\u200b\u914d\u7f6e\u200b\u7684\u200b\u6700\u5927\u200bqps\u3002</p> <ul> <li>sentinel\u200b\u9650\u6d41\u200b\u6846\u67b6\u200b\u5e95\u5c42\u200b</li> </ul> <p>\u200b\u6b63\u662f\u200b\u7531\u4e8e\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u7684\u200b\u72b6\u6001\u200b\u7279\u6027\u200b\u3002\u200b\u4ed6\u200b\u80fd\u200b\u4fdd\u5b58\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u95f4\u200b\u5206\u5e03\u200b\u8fd9\u200b\u7c7b\u200b\u539f\u59cb\u200b\u4fe1\u606f\u200b\u3002\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5f88\u200b\u5bb9\u6613\u200b\u7684\u200b\u7edf\u8ba1\u200b\u51fa\u200b1s\uff0c5s\uff0c10s\u200b\u5185\u200b\u7684\u200b\u8bf7\u6c42\u200b\u6570\u91cf\u200b\uff0c\u200b\u6210\u529f\u200b\u6570\u91cf\u200b\uff0c\u200b\u9650\u6d41\u200b\u6570\u91cf\u200b\u3002sentinel\u200b\u5e95\u5c42\u200b\u6b63\u662f\u200b\u7528\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u6765\u200b\u5b9e\u73b0\u200b\u8fd9\u4e9b\u200b\u72b6\u6001\u200b\u7684\u200b\u8bb0\u5f55\u200b\u4e0e\u200b\u9650\u6d41\u200b\u3002</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#3_2","title":"3. \u200b\u4ee3\u7801\u200b\u5b9e\u73b0","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b\uff1a <code>com.iflove.starter.frequencycontrol.service.frequencycontrol.strategy.SlidingWindowFrequencyController</code></p> <p>\u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>@Override\nprotected boolean reachRateLimit(Map&lt;String, SlidingWindowDTO&gt; frequencyControlMap) {\n    List&lt;String&gt; frequencyKeys = new ArrayList&lt;&gt;(frequencyControlMap.keySet());\n    for (String key : frequencyKeys) {\n        SlidingWindowDTO dto = frequencyControlMap.get(key);\n        // \u200b\u83b7\u53d6\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u5185\u200b\u8ba1\u6570\u200b\n        Long count = RedisUtil.zCard(dto.getKey());\n        int frequencyControlCountLimit = dto.getCount();\n        // \u200b\u5224\u65ad\u200b\uff1a\u200b\u5230\u8fbe\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\n        if (Objects.nonNull(count) &amp;&amp; count &gt;= frequencyControlCountLimit) {\n            log.warn(\"frequenctControl limit key:{}, count:{}\", key, count);\n            return true;\n        }\n    }\n    return false;\n}\n\n@Override\nprotected void addFrequencyControlStatisticsCount(Map&lt;String, SlidingWindowDTO&gt; frequencyControlMap) {\n    List&lt;String&gt; frequencyKeys = new ArrayList&lt;&gt;(frequencyControlMap.keySet());\n    for (String key : frequencyKeys) {\n        SlidingWindowDTO dto = frequencyControlMap.get(key);\n        // \u200b\u8ba1\u7b97\u200b\u6700\u5c0f\u200b\u7a97\u53e3\u200b\u5468\u671f\u200b\uff0c\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u6beb\u79d2\u200b\u7ea7\u522b\u200b\n        long period = dto.getUnit().toMillis(dto.getPeriod());\n        long current = System.currentTimeMillis();\n        // \u200b\u8ba1\u7b97\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\n        long length = period * dto.getWindowSize();\n        long start = current - length;\n        // \u200b\u6dfb\u52a0\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\uff0c\u200b\u540c\u65f6\u200b\u5220\u9664\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\u5916\u200b\u7684\u200b\u65e7\u200b\u6570\u636e\u200b\n        RedisUtil.zAddAndExpire(key, start, length, current);\n    }\n}\n</code></pre> <p>\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u65b9\u9762\u200b\uff1a\u200b\u6211\u200b\u9009\u62e9\u200b<code>Redis</code>\u200b\u7684\u200b <code>Zset</code> \u200b\u6570\u636e\u7ed3\u6784\u200b \u200b\u5b9e\u73b0\u200b \u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u7cbe\u786e\u200b\u5730\u200b\u505a\u200b\u8303\u56f4\u200b\u7b5b\u9009\u200b</p> <ul> <li> <p><code>#reachRateLimit</code></p> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b</p> <ol> <li>\u200b\u6279\u91cf\u200b\u83b7\u53d6\u200b\uff1a\u200b\u5c06\u200b\u6240\u6709\u200b\u9650\u6d41\u200b\u952e\u200b\u63d0\u53d6\u200b\u4e3a\u200b <code>List</code>\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b <code>RedisUtil.mget</code>\u200b\u65b9\u6cd5\u200b\u4ece\u200b <code>Redis</code> \u200b\u4e2d\u200b\u6279\u91cf\u200b\u83b7\u53d6\u200b\u8fd9\u4e9b\u200b\u952e\u200b\u7684\u200b\u8ba1\u200b\u6570\u503c\u200b\u3002</li> <li>\u200b\u83b7\u53d6\u200b\u8ba1\u6570\u200b\uff1a\u200b\u904d\u5386\u200b <code>frequencyControlMap</code> \u200b\u4e2d\u200b\u7684\u200b\u9650\u6d41\u200b\u952e\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b <code>Redis</code> \u200b\u7684\u200b <code>zCard</code> \u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u6bcf\u4e2a\u200b\u952e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u5185\u8ba1\u200b\u6570\u503c\u200b\u3002</li> <li>\u200b\u9650\u6d41\u200b\u5224\u65ad\u200b\uff1a\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b\u952e\u200b\u7684\u200b\u8ba1\u200b\u6570\u503c\u200b\u8fdb\u884c\u200b\u9650\u6d41\u200b\u68c0\u67e5\u200b\uff0c\u200b\u82e5\u200b\u8fbe\u5230\u200b\u6216\u200b\u8d85\u8fc7\u200b\u8bbe\u5b9a\u200b\u9608\u503c\u200b\uff0c\u200b\u5219\u200b\u8bb0\u5f55\u200b\u65e5\u5fd7\u200b\u5e76\u200b\u8fd4\u56de\u200b <code>true</code> \u200b\u8868\u793a\u200b\u9650\u6d41\u200b\u3002</li> <li>\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\uff1a\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u952e\u200b\u90fd\u200b\u672a\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b\uff0c\u200b\u8fd4\u56de\u200b <code>false</code> \u200b\u8868\u793a\u200b\u672a\u200b\u9650\u6d41\u200b\u3002</li> </ol> </li> <li> <p><code>#addFrequencyControlStatisticsCount</code></p> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u589e\u52a0\u200b\u6bcf\u4e2a\u200b\u9650\u6d41\u200b\u952e\u200b\u7684\u200b\u8ba1\u6570\u200b\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u952e\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u3002</p> </li> </ul> <p>\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u76f8\u5173\u200b\u5b9e\u73b0\u200b\u76f8\u5bf9\u200b\u590d\u6742\u200b\uff0c\u200b\u9996\u5148\u200b\u6765\u770b\u200b<code>\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u5b9e\u4f53\u7c7b\u200b(SlidingWindowDTO)</code>\u200b\u662f\u200b\u5982\u4f55\u200b\u5b9a\u4e49\u200b\u7684\u200b   </p> Java<pre><code>public class SlidingWindowDTO extends FrequencyControlDTO {\n    /**\n     * \u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\uff0c\u200b\u9ed8\u8ba4\u200b 10 s\n     */\n    private int windowSize;\n    /**\n     * \u200b\u7a97\u53e3\u200b\u6700\u5c0f\u200b\u5468\u671f\u200b 1s (\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\u662f\u200b 10s\uff0c 1s\u200b\u4e00\u4e2a\u200b\u5c0f\u683c\u5b50\u200b\uff0c-\u200b\u5171\u200b10\u200b\u4e2a\u200b\u683c\u5b50\u200b)\n     */\n    private int period;\n}\n</code></pre> <p>\u200b\u5b9a\u4e49\u200b\u65b9\u9762\u200b\uff0c\u200b\u9996\u5148\u200b\u7ee7\u627f\u200b\u4e86\u200b\u9891\u63a7\u200b\u57fa\u7c7b\u200b <code>FrequencyControlDTO</code> \uff0c\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u9891\u63a7\u200b\u7684\u200b\u4e00\u4e9b\u200b\u57fa\u672c\u200b\u5c5e\u6027\u200b</p> Java<pre><code>public class FrequencyControlDTO {\n    /**\n     * \u200b\u4ee3\u8868\u200b\u9891\u63a7\u200b\u7684\u200bKey \u200b\u5982\u679c\u200btarget\u200b\u4e3a\u200bKey\u200b\u7684\u8bdd\u200b \u200b\u8fd9\u91cc\u200b\u8981\u200b\u4f20\u503c\u200b\u7528\u4e8e\u200b\u6784\u5efa\u200bredis\u200b\u7684\u200bKey target\u200b\u4e3a\u200bIp\u200b\u6216\u8005\u200bUID\u200b\u7684\u8bdd\u200b\u4f1a\u200b\u4ece\u200b\u4e0a\u4e0b\u6587\u200b\u53d6\u503c\u200b Key\u200b\u5b57\u200b\u6bb5\u200b\u65e0\u9700\u200b\u4f20\u503c\u200b\n     */\n    private String key;\n\n    /**\n     * \u200b\u9891\u63a7\u200b\u65f6\u95f4\u200b\u5355\u4f4d\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u79d2\u200b\n     *\n     * @return \u200b\u5355\u4f4d\u200b\n     */\n    private TimeUnit unit;\n\n    /**\n     * \u200b\u5355\u4f4d\u200b\u65f6\u95f4\u200b\u5185\u200b\u6700\u5927\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\n     *\n     * @return \u200b\u6b21\u6570\u200b\n     */\n    private Integer count;\n}\n</code></pre> <p>\u200b\u800c\u200b\u5b50\u7c7b\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\u5b9a\u4e49\u200b\u4e86\u200b \u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u7279\u6709\u200b\u7684\u200b\u5c5e\u6027\u200b\uff1a<code>windowSize</code> \u200b\u548c\u200b <code>period</code></p> <ul> <li><code>windowSize</code> \u200b\u8868\u793a\u200b \u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u603b\u200b\u5927\u5c0f\u200b(\u200b\u6570\u636e\u200b\u8303\u56f4\u200b) \uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u4ee3\u8868\u200b\u7740\u200bRedis\u200b\u5b58\u50a8\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b</li> <li><code>period</code> \u200b\u8868\u793a\u200b\u7a97\u53e3\u200b\u6700\u5c0f\u200b\u5468\u671f\u200b\uff0c\u200b\u4ee3\u8868\u200b\u65f6\u95f4\u200b\u7c92\u5ea6\u200b\u5927\u5c0f\u200b</li> </ul> <p>\u200b\u91cd\u70b9\u200b\u5173\u6ce8\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u8ba1\u7b97\u200b\u903b\u8f91\u200b\uff1a</p> Java<pre><code>SlidingWindowDTO dto = frequencyControlMap.get(key);\n // \u200b\u8ba1\u7b97\u200b\u6700\u5c0f\u200b\u7a97\u53e3\u200b\u5468\u671f\u200b\uff0c\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u6beb\u79d2\u200b\u7ea7\u522b\u200b\nlong period = dto.getUnit().toMillis(dto.getPeriod());\nlong current = System.currentTimeMillis();\n// \u200b\u8ba1\u7b97\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\nlong length = period * dto.getWindowSize();\nlong start = current - length;\n// \u200b\u6dfb\u52a0\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\uff0c\u200b\u540c\u65f6\u200b\u5220\u9664\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\u5916\u200b\u7684\u200b\u65e7\u200b\u6570\u636e\u200b\nRedisUtil.zAddAndExpire(key, start, length, current);\n</code></pre> <p>\u200b\u6838\u5fc3\u601d\u60f3\u200b\u662f\u200b\uff1a\u200b\u6bcf\u6b21\u200b\u8bf7\u6c42\u200b\u90fd\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\u6233\u200b\u5230\u200b Redis \u200b\u7684\u200b\u6709\u5e8f\u200b\u96c6\u5408\u200b\u4e2d\u200b\uff0c\u200b\u540c\u65f6\u200b\u5220\u9664\u200b\u7a97\u53e3\u200b\u8303\u56f4\u200b\u4e4b\u5916\u200b\u7684\u200b\u65e7\u200b\u6570\u636e\u200b\uff0c\u200b\u4ee5\u200b\u4fdd\u6301\u200b\u8ba1\u6570\u200b\u6570\u636e\u200b\u53ea\u200b\u53cd\u6620\u200b\u5f53\u524d\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u5185\u200b\u7684\u200b\u8bf7\u6c42\u200b\u6570\u200b\u3002</p> <p>\u200b\u518d\u200b\u6765\u770b\u200bRedis\u200b\u4e2d\u662f\u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff1a</p> Java<pre><code>public static void zAddAndExpire(String key, long startTime, long expireTime, long currentTime) {\n    // \u200b\u6dfb\u52a0\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\n    template.opsForZSet().add(key, String.valueOf(currentTime), currentTime);\n    // \u200b\u5220\u9664\u200b\u5468\u671f\u200b\u4e4b\u524d\u200b\u7684\u200b\u6570\u636e\u200b\n    template.opsForZSet().removeRangeByScore(key, 0, startTime);\n    // \u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\u957f\u5ea6\u200b+\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b\n    template.expire(key, expireTime, TimeUnit.MICROSECONDS);\n}\n</code></pre> <p>\u200b\u505a\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>\u200b\u6dfb\u52a0\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\u6233\u200b\uff1a\u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002</li> <li>\u200b\u5220\u9664\u200b\u65e7\u200b\u6570\u636e\u200b\uff1a\u200b\u53ea\u200b\u4fdd\u7559\u200b\u5f53\u524d\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u5185\u200b\u7684\u200b\u65f6\u95f4\u200b\u6233\u200b\u6570\u636e\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u9650\u6d41\u200b\u5224\u65ad\u200b\u7684\u200b\u51c6\u786e\u6027\u200b\u3002</li> <li>\u200b\u8bbe\u7f6e\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\uff1a\u200b\u63a7\u5236\u200b\u96c6\u5408\u200b\u7684\u200b\u751f\u5b58\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u6ca1\u6709\u200b\u65b0\u200b\u8bf7\u6c42\u200b\u65f6\u200b\u81ea\u52a8\u200b\u6e05\u9664\u200b\u6570\u636e\u200b\uff0c\u200b\u8282\u7701\u200b Redis \u200b\u5185\u5b58\u200b\u3002</li> </ol>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#54","title":"5.4 \u200b\u6f0f\u6876\u200b\u7b97\u6cd5","text":"","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#1_3","title":"1. \u200b\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u6f0f\u6876\u200b\u7b97\u6cd5\u200b\u6b63\u5982\u200b\u5176\u540d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u60f3\u8c61\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5e95\u90e8\u200b\u7834\u200b\u4e86\u200b\u6d1e\u200b\u7684\u200b\u6876\u200b\uff0c\u200b\u65e0\u8bba\u200b\u4f60\u200b\u4ee5\u200b\u4ec0\u4e48\u6837\u200b\u7684\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u9891\u7387\u200b\u53bb\u200b\u6dfb\u52a0\u200b\u6c34\u200b\u3002\u200b\u6c34\u90fd\u4f1a\u200b\u4ece\u200b\u5e95\u90e8\u200b\u4ee5\u200b\u56fa\u5b9a\u200b\u7684\u200b\u9891\u7387\u200b\u6d41\u51fa\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u6c34\u84c4\u200b\u5728\u200b\u6f0f\u6876\u200b\u4e2d\u200b\uff0c\u200b\u76f4\u5230\u200b\u6f0f\u6876\u200b\u6ee1\u200b\u4e86\u200b\u88ab\u200b\u4e22\u5f03\u200b\u3002</p> <p>\u200b\u6bd4\u5982\u200b\u671f\u671b\u200b1S\u200b\u5185\u200b\u6700\u200b\u591a\u200b\u5904\u7406\u200b4\u200b\u6b21\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6d41\u51fa\u200b\u901f\u5ea6\u200b\u5c31\u662f\u200b\u6bcf\u200b0.25S\u200b\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b.\u200b\u5e76\u4e14\u200b\u6f0f\u6876\u200b\u6700\u5927\u200b\u5bb9\u91cf\u200b\u4e3a\u200b10\u200b\u4e2a\u200b\u8bf7\u6c42\u200b\u3002</p> <p></p> <p>\u200b\u4e0d\u89c4\u5219\u200b\u7684\u200b\u8bf7\u6c42\u200b\u968f\u610f\u200b\u7684\u200b\u6295\u9012\u200b\u5230\u200b\u6211\u4eec\u200b\u7684\u200b\u6876\u200b\u91cc\u200b\uff0c\u200b\u7136\u540e\u200b\u4f1a\u200b\u6709\u200b\u56fa\u5b9a\u200b\u7684\u200b\u9891\u7387\u200b\u53bb\u200b\u6d88\u8d39\u200b\u5b83\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u6876\u200b\u7684\u200b\u6700\u5927\u200b\u5bb9\u91cf\u200b10\uff0c\u200b\u90a3\u4e48\u200b\u8bf7\u6c42\u200b\u5c06\u4f1a\u200b\u88ab\u200b\u4e22\u5f03\u200b\u3002 \u200b\u6f0f\u6876\u200b\u9650\u6d41\u200b\u7b97\u6cd5\u200b\u6700\u5927\u200b\u7684\u200b\u7279\u70b9\u200b\u5c31\u662f\u200b\u6d41\u91cf\u200b\u6574\u578b\u200b\u3002\u200b\u8ba9\u200b\u4e0d\u89c4\u5219\u200b\u7684\u200b\u8bf7\u6c42\u200b\u9891\u7387\u200b\uff0c\u200b\u8f6c\u4e3a\u200b\u89c4\u5219\u200b\u7684\u200b\u9891\u7387\u200b\u8fdb\u884c\u200b\u6d88\u8d39\u200b\u3002</p> <ul> <li>\u200b\u4f18\u70b9\u200b\uff1a<ul> <li>\u200b\u53ef\u4ee5\u200b\u4e25\u683c\u200b\u9650\u5236\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5904\u7406\u901f\u5ea6\u200b\uff0c\u200b\u907f\u514d\u200b\u77ac\u95f4\u200b\u8bf7\u6c42\u200b\u8fc7\u591a\u200b\u5bfc\u81f4\u7cfb\u7edf\u200b\u5d29\u6e83\u200b\u6216\u8005\u200b\u96ea\u5d29\u200b\u3002</li> </ul> </li> <li>\u200b\u7f3a\u70b9\u200b\uff1a<ul> <li>\u200b\u9700\u8981\u200b\u5bf9\u200b\u8bf7\u6c42\u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4f1a\u200b\u589e\u52a0\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u5185\u5b58\u200b\u6d88\u8017\u200b\u3002</li> <li>\u200b\u9762\u5bf9\u200b\u7a81\u53d1\u200b\u6d41\u91cf\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f18\u70b9\u200b\u540c\u65f6\u200b\u4e5f\u200b\u4f1a\u200b\u662f\u200b\u7f3a\u70b9\u200b\u3002\u200b\u65e0\u6cd5\u200b\u9002\u5e94\u200b\u77ac\u65f6\u200b\u7684\u200b\u7a81\u589e\u200b\u6d41\u91cf\u200b</li> </ul> </li> </ul>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#2_3","title":"2. \u200b\u4e0d\u200b\u9002\u5408\u200b\u573a\u666f","text":"<p>\u200b\u6f0f\u6876\u200b\u7b97\u6cd5\u200b\u4e0d\u592a\u200b\u9002\u5408\u200bC\u200b\u7aef\u200b\u63a5\u53e3\u200b\u7684\u200b\u9650\u6d41\u200b\u3002\u200b\u56e0\u4e3a\u200b\u5bf9\u4e8e\u200b\u90fd\u200b\u5230\u200b\u4e86\u200b\u9650\u6d41\u200b\u7684\u200b\u573a\u666f\u200b\u4e86\u200b\u3002\u200b\u5e76\u53d1\u200b\u5df2\u7ecf\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\u4e86\u200b\u3002\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u7684\u200b\u662f\u200b\u8d85\u8fc7\u200b\u9650\u5236\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u7acb\u9a6c\u200b\u5c31\u200b\u7ed9\u200b\u4ed6\u200b\u5feb\u901f\u200b\u5931\u8d25\u200b\u8fd4\u56de\u200b\u4e86\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u505c\u200b\u5728\u200b\u6876\u200b\u91cc\u200b\u4f11\u7720\u200b\u7b49\u5f85\u200b\u54cd\u5e94\u200b\u3002\u200b\u8fd9\u6837\u200b\u6574\u4f53\u200b\u7684\u200b\u54cd\u5e94\u200b\u65f6\u95f4\u200b\u4f1a\u200b\u5f88\u200b\u9ad8\u200b\uff0c\u200b\u540c\u65f6\u200b\u8fd8\u200b\u5360\u7528\u200b\u7684\u200b\u8bf7\u6c42\u200b\u8fde\u63a5\u6c60\u200b\u3002</p> <p>\u200b\u6545\u4e0d\u5bf9\u200b\u6f0f\u6876\u200b\u7b97\u6cd5\u200b\u505a\u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#55","title":"5.5 \u200b\u4ee4\u724c\u200b\u6876","text":"","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#1_4","title":"1. \u200b\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u4ee4\u724c\u200b\u6876\u200b\u7b97\u6cd5\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u5bb9\u91cf\u200b\u7684\u200b\u4ee4\u724c\u200b\u6876\u200b\uff0c\u200b\u6bcf\u79d2\u949f\u200b\u4f1a\u200b\u5411\u200b\u4ee4\u724c\u200b\u6876\u200b\u4e2d\u200b\u653e\u5165\u200b\u4e00\u5b9a\u200b\u6570\u91cf\u200b\u7684\u200b\u4ee4\u724c\u200b\u3002\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b\u90fd\u200b\u9700\u8981\u200b\u6d88\u8017\u200b\u4e00\u4e2a\u200b\u4ee4\u724c\u200b\u624d\u80fd\u200b\u653e\u884c\u200b\u3002\u200b\u4f60\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u4ed6\u200b\u548c\u200b\u6f0f\u6876\u200b\u7b97\u6cd5\u200b\u5f88\u200b\u50cf\u200b\uff0c\u200b\u90fd\u200b\u6709\u200b\u4e2a\u200b\u5bb9\u91cf\u200b\u56fa\u5b9a\u200b\u7684\u200b\u6876\u200b\u3002</p> <ul> <li>\u200b\u4e00\u4e2a\u200b\u662f\u200b\u5300\u901f\u200b\u6d41\u51fa\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u5300\u901f\u200b\u653e\u5165\u200b\u4ee4\u724c\u200b\u3002</li> <li>\u200b\u4e00\u4e2a\u200b\u79ef\u7d2f\u200b\u7684\u200b\u662f\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u79ef\u7d2f\u200b\u7684\u200b\u662f\u200b\u53ef\u200b\u653e\u884c\u200b\u7684\u200b\u4ee4\u724c\u200b\u3002</li> </ul> <p>\u200b\u6bd4\u5982\u200b\u671f\u671b\u200b1S\u200b\u5185\u200b\u6700\u200b\u591a\u200b\u5904\u7406\u200b4\u200b\u6b21\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4ee4\u724c\u200b\u653e\u5165\u200b\u901f\u5ea6\u200b\u5c31\u662f\u200b\u6bcf\u200b0.25S\u200b\u4e00\u4e2a\u200b\u4ee4\u724c\u200b.\u200b\u5e76\u4e14\u200b\u6876\u200b\u6700\u5927\u200b\u5bb9\u91cf\u200b\u4e3a\u200b10\u200b\u4e2a\u200b\u4ee4\u724c\u200b\u3002</p> <p>\u200b\u5728\u200b\u8bf7\u6c42\u200b\u5f88\u591a\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4ed6\u200b\u5176\u5b9e\u200b\u548c\u200b\u6f0f\u6876\u200b\u7b97\u6cd5\u200b\u7684\u200b\u6548\u679c\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002\u200b\u6700\u5927\u200b\u7684\u200b\u5dee\u522b\u200b\u5c31\u662f\u200b\u5728\u200b\u8bf7\u6c42\u200b\u4e0d\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u80fd\u200b\u5b58\u50a8\u200b\u4ee4\u724c\u200b\uff0c\u200b\u7528\u6765\u200b\u5e94\u5bf9\u200b\u7a81\u589e\u200b\u6d41\u91cf\u200b\u3002</p> <ul> <li> <p>\u200b\u4f18\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u7cbe\u5ea6\u9ad8\u200b\uff1a\u200b\u4ee4\u724c\u200b\u6876\u200b\u7b97\u6cd5\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u52a8\u6001\u200b\u8c03\u6574\u200b\u751f\u6210\u200b\u4ee4\u724c\u200b\u7684\u200b\u901f\u7387\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u8f83\u200b\u9ad8\u7cbe\u5ea6\u200b\u7684\u200b\u9650\u6d41\u200b\u3002</li> <li>\u200b\u5f39\u6027\u200b\u597d\u200b\uff1a\u200b\u76f8\u6bd4\u200b\u6f0f\u6876\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4ee4\u724c\u200b\u6876\u200b\u7b97\u6cd5\u200b\u53ef\u4ee5\u200b\u5904\u7406\u200b\u7a81\u53d1\u200b\u6d41\u91cf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u77ed\u65f6\u95f4\u200b\u5185\u200b\u63d0\u4f9b\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5904\u7406\u200b\u80fd\u529b\u200b\uff0c\u200b\u4ee5\u200b\u5904\u7406\u200b\u7a81\u53d1\u200b\u6d41\u91cf\u200b\u3002</li> <li>\u200b\u65e0\u200b\u72b6\u6001\u200b\u6027\u200b\uff1a\u200b\u76f8\u8f83\u200b\u4e8e\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u7b97\u6cd5\u200b\u7b49\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u72b6\u6001\u200b\u4fe1\u606f\u200b\u7684\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4ee4\u724c\u200b\u6876\u200b\u7b97\u6cd5\u200b\u4e0d\u200b\u9700\u8981\u200b\u6301\u7eed\u200b\u7ef4\u62a4\u200b\u5927\u91cf\u200b\u7684\u200b\u72b6\u6001\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f7f\u200b\u5176\u200b\u66f4\u5177\u200b\u6269\u5c55\u6027\u200b\u548c\u200b\u9ad8\u6548\u6027\u200b\u3002</li> </ul> </li> <li> <p>\u200b\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u5b9e\u73b0\u200b\u590d\u6742\u200b\uff1a\u200b\u4ee4\u724c\u200b\u6876\u200b\u7b97\u6cd5\u200b\u9700\u8981\u200b\u5728\u200b\u56fa\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b\u5185\u200b\u751f\u6210\u200b\u4ee4\u724c\u200b\uff0c\u200b\u9700\u8981\u200b\u5f00\u542f\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u3002\u200b\u5f53\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b\u7279\u6b8a\u200b\u624b\u6bb5\u200b\u4e0d\u200b\u9700\u8981\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u73b0\u200b\u5c31\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u3002</li> <li>\u200b\u9700\u8981\u200b\u9884\u70ed\u200b\uff1a\u200b\u5728\u200b\u521a\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u6876\u200b\u4e2d\u200b\u53ef\u80fd\u200b\u6ca1\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u4ee4\u724c\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u9000\u5316\u200b\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6ca1\u6876\u200b\u7684\u200b\u6f0f\u6876\u200b\uff0c\u200b\u5f88\u200b\u53ef\u80fd\u200b\u5728\u200b\u4e00\u200b\u5f00\u59cb\u200b\u5bf9\u200b\u8bf7\u6c42\u200b\u4ea7\u751f\u200b\u8f83\u5927\u200b\u7684\u200b\u9650\u5236\u200b\u3002</li> </ul> </li> </ul>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#2_4","title":"2. \u200b\u9002\u7528\u200b\u573a\u666f","text":"<p>\u200b\u76f8\u6bd4\u200b\u8d77\u6f0f\u200b\u6876\u200b\uff0c\u200b\u4ee4\u724c\u200b\u6876\u200b\u7b97\u6cd5\u200b\u66f4\u52a0\u200b\u9002\u5408\u200b\u5e94\u5bf9\u200b\u7a81\u53d1\u200b\u7684\u200b\u6d41\u91cf\u200b\u3002\u200b\u6d41\u91cf\u200b\u8fbe\u5230\u200b\u6781\u9650\u200b\u540e\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u9000\u5316\u200b\u6210\u6ca1\u6876\u200b\u7684\u200b\u6f0f\u6876\u200b\uff0c\u200b\u901f\u7387\u200b\u53d8\u6210\u200b\u4e86\u200b\u4e25\u683c\u63a7\u5236\u200b\u3002\u200b\u9002\u7528\u200b\u4e8e\u200b\u6d41\u91cf\u200b\u6574\u4f53\u200b\u5e73\u6ed1\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6ee1\u8db3\u200b\u4e00\u5b9a\u200b\u7684\u200b\u7a81\u53d1\u200b\u6d41\u7a0b\u200b\u573a\u666f\u200b</p> <p>\u200b\u4ed6\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5f88\u5927\u200b\u7684\u200b<code>\u200b\u7f3a\u70b9\u200b</code>\uff0c\u200b\u5c31\u662f\u200b\u4ed6\u200b\u7684\u200b\u9884\u70ed\u200b\u95ee\u9898\u200b\u3002\u200b\u521a\u200b\u521b\u5efa\u200b\u7684\u200b\u4ee4\u724c\u200b\u6876\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u6ca1\u6709\u200b\u4ee4\u724c\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u521a\u200b\u8fdb\u6765\u200b\uff0c\u200b\u53c8\u200b\u7531\u4e8e\u200b\u5b83\u200b\u6ca1\u6709\u200b\u6876\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5c31\u200b\u628a\u200b\u8bf7\u6c42\u200b\u4e22\u5f03\u200b\u4e86\u200b\u3002</p>","tags":["java"]},{"location":"blog/backend/Java/FrequencyControl/#3_3","title":"3. \u200b\u4ee3\u7801\u200b\u5b9e\u73b0","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b\uff1a <code>com.iflove.starter.frequencycontrol.service.frequencycontrol.strategy.TokenBucketFrequencyController</code></p> <p>\u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>@Override\nprotected boolean reachRateLimit(Map&lt;String, TokenBucketDTO&gt; frequencyControlMap) {\n    List&lt;String&gt; frequencyKeys = new ArrayList&lt;&gt;(frequencyControlMap.keySet());\n    for (String key : frequencyKeys) {\n        // \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b1\u200b\u4e2a\u200b\u4ee4\u724c\u200b(\u200b\u4e0d\u200b\u6263\u51cf\u200b)\uff0c\u200b\u5982\u679c\u200b\u5931\u8d25\u200b\uff0c\u200b\u8bf4\u660e\u200b\u4ee4\u724c\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u9700\u8981\u200b\u9650\u6d41\u200b\n        if (!tokenBucketManager.tryAcquire(key, 1)) {\n            return true;\n        }\n    }\n    return false;\n}\n\n@Override\nprotected void addFrequencyControlStatisticsCount(Map&lt;String, TokenBucketDTO&gt; frequencyControlMap) {\n    List&lt;String&gt; frequencyKeys = new ArrayList&lt;&gt;(frequencyControlMap.keySet());\n    for (String key : frequencyKeys) {\n        TokenBucketDTO dto = frequencyControlMap.get(key);\n        // \u200b\u521b\u5efa\u200b\u4ee4\u724c\u200b\u6876\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u5b58\u5728\u200b\n        tokenBucketManager.createTokenBucket(key, dto.getCapacity(), dto.getRate());\n        // \u200b\u6263\u51cf\u200b\u4e00\u4e2a\u200b\u4ee4\u724c\u200b\n        tokenBucketManager.deductionToken(key, 1);\n    }\n}\n</code></pre> <ul> <li> <p><code>#reachRateLimit</code></p> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\u9608\u503c\u200b</p> <ol> <li>\u200b\u83b7\u53d6\u200b\u9891\u7387\u200b\u63a7\u5236\u952e\u200b\u5217\u8868\u200b\uff1a\u200b\u5c06\u200b <code>frequencyControlMap</code> \u200b\u7684\u200b\u952e\u200b\u5b58\u5165\u200b <code>frequencyKeys</code> \u200b\u5217\u8868\u200b\u4e2d\u200b\u3002</li> <li>\u200b\u9010\u4e2a\u200b\u68c0\u67e5\u200b\u4ee4\u724c\u200b\u6876\u200b\uff1a<ul> <li>\u200b\u904d\u5386\u200b\u6bcf\u4e2a\u200b\u9891\u7387\u200b\u63a7\u5236\u952e\u200b <code>key</code>\u3002</li> <li>\u200b\u8c03\u7528\u200b <code>tokenBucketManager.tryAcquire(key, 1)</code> \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b\u4ee4\u724c\u200b\uff0c\u200b\u4e0d\u200b\u6263\u51cf\u200b\u6876\u200b\u4e2d\u200b\u5df2\u6709\u200b\u7684\u200b\u4ee4\u724c\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b\u8fd4\u56de\u200b <code>false</code>\uff0c\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u4ee4\u724c\u200b\u6876\u200b\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u9650\u6d41\u200b\uff0c\u200b\u4e8e\u662f\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b <code>true</code>\u3002</li> </ul> </li> <li>\u200b\u6ca1\u6709\u200b\u8fbe\u5230\u200b\u9650\u6d41\u200b\uff1a\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u952e\u200b\u7684\u200b\u4ee4\u724c\u200b\u6876\u200b\u4e2d\u200b\u5747\u200b\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u4ee4\u724c\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b <code>false</code>\u3002</li> </ol> </li> <li> <p><code>#addFrequencyControlStatisticsCount</code></p> <p>\u200b\u529f\u80fd\u200b\uff1a\u200b\u589e\u52a0\u200b\u6bcf\u4e2a\u200b\u9650\u6d41\u200b\u952e\u200b\u7684\u200b\u8ba1\u6570\u200b\u3002</p> <ol> <li>\u200b\u904d\u5386\u200b <code>frequencyKeys</code> \u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b key\u3002</li> <li>\u200b\u83b7\u53d6\u200b\u4ee4\u724c\u200b\u6876\u200b\u914d\u7f6e\u200b\u4fe1\u606f\u200b <code>dto</code>\uff0c\u200b\u5305\u62ec\u200b\u6876\u200b\u7684\u200b\u5bb9\u91cf\u200b\u548c\u200b\u4ee4\u724c\u200b\u586b\u5145\u200b\u901f\u7387\u200b\u3002 </li> <li>\u200b\u8c03\u7528\u200b <code>tokenBucketManager.createTokenBucket(key, dto.getCapacity(), dto.getRate())</code> \u200b\u521b\u5efa\u200b\u4ee4\u724c\u200b\u6876\u200b\uff08\u200b\u5982\u679c\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff09\u3002</li> <li>\u200b\u6263\u51cf\u200b\u4e00\u4e2a\u200b\u4ee4\u724c\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>deductionToken(key, 1)</code> \u200b\u8868\u793a\u200b\u8bf7\u6c42\u200b\u6d88\u8017\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4ee4\u724c\u200b\u3002</li> </ol> </li> </ul> <p>\u200b\u5e95\u5c42\u200b\u4f7f\u7528\u200b <code>ConcurrentHashMap</code> \u200b\u5b9e\u73b0\u200b key \u200b\u548c\u200b \u200b\u4ee4\u724c\u200b\u6876\u200b \u200b\u7684\u200b\u5b58\u50a8\u200b</p> <p>\u200b\u76f8\u5173\u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\u4e8e\u200b\uff1a<code>com.iflove.starter.frequencycontrol.manager.TokenBucketManager</code></p>","tags":["java"]},{"location":"blog/backend/spring/Spring-AOP/","title":"Spring AOP","text":"<p> \u200b\u7ea6\u200b 4161 \u200b\u4e2a\u200b\u5b57\u200b  959 \u200b\u884c\u200b\u4ee3\u7801\u200b  6 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 26 \u200b\u5206\u949f\u200b</p> <p>AOP \u200b\u5207\u70b9\u200b\u8868\u8fbe\u5f0f\u200b\u548c\u200b\u4f7f\u7528\u200b\u4ee5\u53ca\u200b\u57fa\u4e8e\u200b JDK \u200b\u548c\u200b CGLIB \u200b\u7684\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u5173\u7cfb\u200b\uff1a</p> <p></p> <p><code>Joinpoint</code>\uff0c\u200b\u7ec7\u5165\u200b\u70b9\u200b\uff0c\u200b\u6307\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u4ee3\u7406\u200b\u64cd\u4f5c\u200b\u7684\u200b\u67d0\u4e2a\u200b\u7c7b\u200b\u7684\u200b\u67d0\u4e2a\u200b\u65b9\u6cd5\u200b(\u200b\u4ec5\u200b\u652f\u6301\u200b\u65b9\u6cd5\u200b\u7ea7\u522b\u200b\u7684\u200b<code>JoinPoint</code>)\uff1b<code>Pointcut</code>\u200b\u662f\u200b<code>JoinPoint</code>\u200b\u7684\u200b\u8868\u8ff0\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u80fd\u200b\u6355\u83b7\u200b<code>JoinPoint</code>\u3002</p> <p>\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u5207\u70b9\u200b\u8868\u8fbe\u5f0f\u200b\u662f\u200b<code>AspectJ</code>\u200b\u7684\u200b\u5207\u70b9\u200b\u8868\u8fbe\u5f0f\u200b\u3002</p> <ul> <li>\u200b\u9700\u8981\u200b\u5339\u914d\u200b\u7c7b\u200b\uff0c\u200b\u5b9a\u4e49\u200b<code>ClassFilter</code>\u200b\u63a5\u53e3\u200b</li> <li>\u200b\u5339\u914d\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5b9a\u4e49\u200b<code>MethodMatcher</code>\u200b\u63a5\u53e3\u200b</li> </ul> <p><code>PointCut</code>\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u5339\u914d\u200b\u7c7b\u200b\u548c\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5305\u542b\u200b<code>ClassFilter</code>\u200b\u548c\u200b<code>MethodMatcher</code>, <code>AspectJExpressionPointcut</code>\u200b\u662f\u200b\u652f\u6301\u200b<code>AspectJ</code>\u200b\u5207\u70b9\u200b\u8868\u8fbe\u5f0f\u200b\u7684\u200b<code>PointCut</code>\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u7b80\u5355\u200b\u5b9e\u73b0\u200b\u4ec5\u200b\u652f\u6301\u200b<code>execution</code>\u200b\u51fd\u6570\u200b\u3002</p> <p><code>AdvisedSupport</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u7c7b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u652f\u6301\u200b\u548c\u200b\u7ba1\u7406\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u914d\u7f6e\u200b\u548c\u200b\u529f\u80fd\u200b</p> <p><code>AdvisedSupport</code> \u200b\u7684\u200b\u4e3b\u8981\u200b\u529f\u80fd\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5b58\u50a8\u200b AOP \u200b\u914d\u7f6e\u200b\u5143\u200b\u4fe1\u606f\u200b\uff1a<ul> <li>\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\uff08\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\uff09\u3002</li> <li>\u200b\u4ee3\u7406\u200b\u7684\u200b\u63a5\u53e3\u200b\u5217\u8868\u200b\u3002</li> <li>\u200b\u5e94\u7528\u200b\u7684\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\u6216\u200b\u901a\u77e5\u200b\uff08Advices\uff09\u3002</li> </ul> </li> <li>\u200b\u7ba1\u7406\u200b\u4ee3\u7406\u200b\u884c\u4e3a\u200b\uff1a<ul> <li>\u200b\u51b3\u5b9a\u200b\u4ee3\u7406\u200b\u662f\u200b JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u8fd8\u662f\u200b CGLIB \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u3002</li> <li>\u200b\u8d1f\u8d23\u200b\u63a7\u5236\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u3002</li> </ul> </li> <li>\u200b\u652f\u6301\u200b\u8fd0\u884c\u200b\u65f6\u200b\u52a8\u6001\u200b\u4fee\u6539\u200b\uff1a<ul> <li>\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u52a8\u6001\u200b\u6dfb\u52a0\u200b\u6216\u200b\u79fb\u9664\u200b\u901a\u77e5\u200b\uff08Advice\uff09\u3002</li> </ul> </li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#jdk","title":"JDK\u200b\u52a8\u6001\u200b\u4ee3\u7406","text":"<p><code>AopProxy</code>\u200b\u662f\u200b\u83b7\u53d6\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u62bd\u8c61\u200b\u63a5\u53e3\u200b\uff0c<code>JdkDynamicAopProxy</code>\u200b\u7684\u200b\u57fa\u4e8e\u200bJDK\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u3002</p> <p><code>TargetSource</code>\uff0c\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5c01\u88c5\u200b\u3002</p> <p><code>MethodInterceptor</code>\uff0c\u200b\u65b9\u6cd5\u200b\u62e6\u622a\u5668\u200b\uff0c\u200b\u662f\u200b<code>AOP Alliance</code>\u200b\u7684\u200b\"\u200b\u516c\u6c11\u200b\"\uff0c\u200b\u987e\u540d\u601d\u4e49\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u62e6\u622a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u200b\u5728\u200b\u88ab\u200b\u4ee3\u7406\u200b\u6267\u884c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u524d\u540e\u200b\u589e\u52a0\u200b\u4ee3\u7406\u200b\u884c\u4e3a\u200b\u3002</p> \u200b\u6d4b\u8bd5\u4ee3\u7801\u200b Java<pre><code>public class AopTest {\n\n    @Test\n    public void testJdkDynamicProxy() throws Exception {\n        WorldService worldService = new WorldServiceImpl();\n\n        AdvisedSupport advisedSupport = new AdvisedSupport();\n        TargetSource targetSource = new TargetSource(worldService);\n        WorldServiceInterceptor methodInterceptor = new WorldServiceInterceptor();\n        MethodMatcher methodMatcher = new AspectJExpressionPointcut(\"execution(* test.aop.bean.WorldService.explode(..))\").getMethodMatcher();\n        advisedSupport.setTargetSource(targetSource);\n        advisedSupport.setMethodInterceptor(methodInterceptor);\n        advisedSupport.setMethodMatcher(methodMatcher);\n\n        WorldService proxy = (WorldService) new JdkDynamicAopProxy(advisedSupport).getProxy();\n        proxy.explode();\n    }\n}\n</code></pre> Java<pre><code>public class WorldServiceInterceptor implements MethodInterceptor {\n    @Override\n    public Object invoke(MethodInvocation methodInvocation) throws Throwable {\n        System.out.println(\"do something before the Earth explodes\");\n        Object res = methodInvocation.proceed();\n        System.out.println(\"do something after the Earth explodes\");\n        return res;\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#1-jdk","title":"1. JDK\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u6e90\u7801","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b\uff1a<code>com.iflove.simplespring.aop.framework.JdkDynamicAopProxy</code></p> Java<pre><code>@Override\npublic Object getProxy() {\n    return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), advised.getTargetSource().getTargetClass(), this);\n}\n\n@Override\npublic Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n    if (advised.getMethodMatcher().matches(method, advised.getTargetSource().getTarget().getClass())) {\n        // \u200b\u542f\u52a8\u200b\u4ee3\u7406\u200b\u65b9\u6cd5\u200b \n        MethodInterceptor methodInterceptor = advised.getMethodInterceptor();\n        return methodInterceptor.invoke(new ReflectiveMethodInvocation(advised.getTargetSource().getTarget(), method, args));\n    }\n    return method.invoke(advised.getTargetSource().getTarget(), args);\n}\n</code></pre> <p>\u200b\u91cd\u70b9\u200b\u5173\u6ce8\u200b\u4ee5\u4e0a\u200b\u4e24\u4e2a\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b</p> <ol> <li><code>getProxy()</code><ul> <li><code>getProxy()</code> \u200b\u65b9\u6cd5\u200b\u7528\u4e8e\u200b\u521b\u5efa\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b Java \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200b\u4ee3\u7406\u200b\u5b9e\u4f8b\u200b\u3002</li> </ul> </li> <li><code>invoke()</code><ul> <li><code>invoke()</code> \u200b\u65b9\u6cd5\u200b\u7528\u4e8e\u200b\u5904\u7406\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4e0a\u200b\u7684\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\uff0c\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u5e94\u7528\u200b\u4ee3\u7406\u200b\u903b\u8f91\u200b\u3002\u200b\u5982\u679c\u200b\u65b9\u6cd5\u200b\u5339\u914d\u200b\u5207\u9762\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5219\u200b\u6267\u884c\u200b\u589e\u5f3a\u200b\u903b\u8f91\u200b\uff1b\u200b\u5426\u5219\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u76ee\u6807\u200b\u65b9\u6cd5\u200b\u3002</li> </ul> </li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#2","title":"2. \u200b\u8fd0\u884c\u200b\u6d4b\u8bd5\u4ee3\u7801","text":"<p>\u200b\u5728\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u7684\u200b\u672b\u5c3e\u200b\u52a0\u4e0a\u200b</p> Java<pre><code>System.out.println(proxy.getClass());\nwhile (true) {}\n</code></pre> <p>\u200b\u4fdd\u8bc1\u200b\u7a0b\u5e8f\u200b\u59cb\u7ec8\u200b\u8fd0\u884c\u200b</p> <p>\u200b\u4e0b\u8f7d\u200b arthas \u200b\u5e76\u200b\u542f\u52a8\u200b</p> Bash<pre><code>java -jar arthas-boot.jar\n</code></pre> <p>\u200b\u9009\u62e9\u200b\u5bf9\u5e94\u200b\u8fdb\u7a0b\u200b</p> <p></p> <p>\u200b\u8f93\u5165\u200b</p> Bash<pre><code>jad com.sun.proxy.$Proxy2\n</code></pre> <p></p> <p>\u200b\u83b7\u5f97\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u4fe1\u606f\u200b\u5982\u4e0b\u200b\uff1a</p> Java<pre><code>/*\n * Decompiled with CFR.\n *\n * Could not load the following classes:\n *  test.aop.bean.WorldService\n */\npackage com.sun.proxy;\n\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\nimport java.lang.reflect.Proxy;\nimport java.lang.reflect.UndeclaredThrowableException;\nimport test.aop.bean.WorldService;\n\npublic final class $Proxy2\nextends Proxy\nimplements WorldService {\n    private static Method m1;\n    private static Method m2;\n    private static Method m0;\n    private static Method m3;\n\n    public $Proxy2(InvocationHandler invocationHandler) {\n        super(invocationHandler);\n    }\n\n    static {\n        try {\n            m1 = Class.forName(\"java.lang.Object\").getMethod(\"equals\", Class.forName(\"java.lang.Object\"));\n            m2 = Class.forName(\"java.lang.Object\").getMethod(\"toString\", new Class[0]);\n            m0 = Class.forName(\"java.lang.Object\").getMethod(\"hashCode\", new Class[0]);\n            m3 = Class.forName(\"test.aop.bean.WorldService\").getMethod(\"explode\", new Class[0]);\n            return;\n        }\n        catch (NoSuchMethodException noSuchMethodException) {\n            throw new NoSuchMethodError(noSuchMethodException.getMessage());\n        }\n        catch (ClassNotFoundException classNotFoundException) {\n            throw new NoClassDefFoundError(classNotFoundException.getMessage());\n        }\n    }\n\n    public final boolean equals(Object object) {\n        try {\n            return (Boolean)this.h.invoke(this, m1, new Object[]{object});\n        }\n        catch (Error | RuntimeException throwable) {\n            throw throwable;\n        }\n        catch (Throwable throwable) {\n            throw new UndeclaredThrowableException(throwable);\n        }\n    }\n\n    public final String toString() {\n        try {\n            return (String)this.h.invoke(this, m2, null);\n        }\n        catch (Error | RuntimeException throwable) {\n            throw throwable;\n        }\n        catch (Throwable throwable) {\n            throw new UndeclaredThrowableException(throwable);\n        }\n    }\n\n    public final int hashCode() {\n        try {\n            return (Integer)this.h.invoke(this, m0, null);\n        }\n        catch (Error | RuntimeException throwable) {\n            throw throwable;\n        }\n        catch (Throwable throwable) {\n            throw new UndeclaredThrowableException(throwable);\n        }\n    }\n\n    public final void explode() {\n        try {\n            this.h.invoke(this, m3, null);\n            return;\n        }\n        catch (Error | RuntimeException throwable) {\n            throw throwable;\n        }\n        catch (Throwable throwable) {\n            throw new UndeclaredThrowableException(throwable);\n        }\n    }\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u4fe1\u606f\u200b\u5982\u4e0b\u200b <code>public final class $Proxy2 extends Proxy implements WorldService</code></p> <p>\u200b\u7ee7\u627f\u200b\u4e86\u200b <code>Proxy</code>\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>WorldService</code> \u200b\u63a5\u53e3\u200b</p> <p>\u200b\u4e0a\u8ff0\u200b\u4fe1\u606f\u200b\u5370\u8bc1\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5373\u200b\uff1a</p> <p>\u200b\u77e5\u8bc6\u70b9\u200b</p> <p>JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u751f\u6210\u200b\u7684\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u548c\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4e3a\u200b\u5144\u5f1f\u200b\u5173\u7cfb\u200b\uff0c\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u5171\u540c\u200b\u7684\u200b\u63a5\u53e3\u200b</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u5b9e\u73b0\u200b\u7684\u200b <code>explode</code> \u200b\u65b9\u6cd5\u200b</p> Java<pre><code>public final void explode() {\n    try {\n        this.h.invoke(this, m3, null);\n        return;\n    }\n    catch (Error | RuntimeException throwable) {\n        throw throwable;\n    }\n    catch (Throwable throwable) {\n        throw new UndeclaredThrowableException(throwable);\n    }\n}\n</code></pre> <p>\u200b\u5176\u4ed6\u200b\u90fd\u200b\u5f88\u200b\u597d\u200b\u7406\u89e3\u200b\uff0c\u200b\u95ee\u9898\u200b\u662f\u200b\uff1a\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>h</code> \u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f</p> <p>\u200b\u5148\u200b\u7ed9\u51fa\u200b\u89e3\u7b54\u200b\uff1a<code>h</code> \u200b\u662f\u200b <code>InvocationHandler</code></p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u4e00\u6b65\u200b\u4e00\u6b65\u200b\u4ece\u200b\u6e90\u7801\u200b\u89d2\u5ea6\u200b\u5206\u6790\u200b</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u662f\u200b\u901a\u8fc7\u200b <code>JdkDynamicAopProxy</code> \u200b\u7684\u200b <code>getProxy</code> \u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u7684\u200b</p> <p>\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b</p> Java<pre><code>@Override\npublic Object getProxy() {\n    return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), advised.getTargetSource().getTargetClass(), this);\n}\n</code></pre> <p>\u200b\u4ee5\u53ca\u200b <code>Proxy.newProxyInstance</code> \u200b\u7684\u200b\u65b9\u6cd5\u200b\u7b7e\u540d\u200b</p> Java<pre><code>public static Object newProxyInstance(ClassLoader loader,\n                                          Class&lt;?&gt;[] interfaces,\n                                          InvocationHandler h)\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5728\u200b <code>getProxy</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u8fd4\u56de\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b\u4e3a\u200b <code>this</code>\uff0c\u200b\u5373\u200b <code>JdkDynamicAopProxy</code> \u200b\u672c\u8eab\u200b\uff0c\u200b\u800c\u200b <code>JdkDynamicAopProxy</code> \u200b\u8fd9\u4e2a\u200b\u7c7b\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>InvocationHandler</code> \u200b\u63a5\u53e3\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b\u52a8\u6001\u200b\u751f\u6210\u200b\u7684\u200b\u4ee3\u7406\u200b\u7c7b\u4e2d\u200b\u8c03\u7528\u200b\u7684\u200b <code>this.h.invoke</code> \u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b <code>JdkDynamicAopProxy</code> \u200b\u7684\u200b <code>invoke</code> \u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\u518d\u200b\u6765\u770b\u200b <code>invoke</code> \u200b\u65b9\u6cd5\u200b</p> Java<pre><code>@Override\npublic Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n    if (advised.getMethodMatcher().matches(method, advised.getTargetSource().getTarget().getClass())) {\n        // \u200b\u542f\u52a8\u200b\u4ee3\u7406\u200b\u65b9\u6cd5\u200b\n        MethodInterceptor methodInterceptor = advised.getMethodInterceptor();\n        return methodInterceptor.invoke(new ReflectiveMethodInvocation(advised.getTargetSource().getTarget(), method, args));\n    }\n    return method.invoke(advised.getTargetSource().getTarget(), args);\n}\n</code></pre> <p>\u200b\u6838\u5fc3\u200b\u903b\u8f91\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li> <p>\u200b\u65b9\u6cd5\u200b\u5339\u914d\u200b\uff1a</p> <ul> <li>\u200b\u8c03\u7528\u200b <code>advised.getMethodMatcher().matches(...)</code> \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u65b9\u6cd5\u200b\u662f\u5426\u200b\u7b26\u5408\u200b\u5207\u9762\u200b\u6761\u4ef6\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b\u5339\u914d\u200b\uff0c\u200b\u6267\u884c\u200b\u4ee3\u7406\u200b\u903b\u8f91\u200b\uff1b\u200b\u5426\u5219\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u76ee\u6807\u200b\u65b9\u6cd5\u200b\u3002</li> </ul> </li> <li> <p>\u200b\u4ee3\u7406\u200b\u903b\u8f91\u200b\uff1a</p> <ul> <li>\u200b\u83b7\u53d6\u200b <code>MethodInterceptor</code> \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5c01\u88c5\u200b\u4e86\u200b\u589e\u5f3a\u200b\u903b\u8f91\u200b\u3002</li> <li>\u200b\u8c03\u7528\u200b <code>MethodInterceptor.invoke(...)</code>\uff0c\u200b\u4f20\u5165\u200b\u4e00\u4e2a\u200b<code>ReflectiveMethodInvocation</code> \u200b\u5bf9\u8c61\u200b\u3002</li> <li><code>ReflectiveMethodInvocation</code> \u200b\u662f\u200b <code>Spring AOP</code> \u200b\u7684\u200b\u6838\u5fc3\u200b\u7c7b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5c01\u88c5\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\uff08\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\u3001\u200b\u65b9\u6cd5\u200b\u3001\u200b\u53c2\u6570\u200b\u7b49\u200b\uff09\u3002</li> </ul> </li> <li> <p>\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u76ee\u6807\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b\u65b9\u6cd5\u200b\u4e0d\u200b\u5339\u914d\u200b\u4ee3\u7406\u200b\u6761\u4ef6\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f7f\u7528\u200b\u53cd\u5c04\u200b\u673a\u5236\u200b\u3002</li> </ul> </li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#cglib","title":"Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406","text":"<p>\u200b\u4e0e\u200b\u57fa\u4e8e\u200bJDK\u200b\u7684\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u5728\u200b\u8fd0\u884c\u200b\u671f\u95f4\u200b\u4e3a\u200b\u63a5\u53e3\u200b\u751f\u6210\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4e0d\u540c\u200b</p> <p>\u200b\u57fa\u4e8e\u200bCGLIB\u200b\u7684\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u80fd\u200b\u5728\u200b\u8fd0\u884c\u200b\u671f\u95f4\u200b\u52a8\u6001\u200b\u6784\u5efa\u200b\u5b57\u8282\u200b\u7801\u200b\u7684\u200bclass\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e3a\u7c7b\u200b\u751f\u6210\u200b\u5b50\u7c7b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u88ab\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u4e0d\u200b\u9700\u8981\u200b\u7ee7\u627f\u200b\u81ea\u200b\u4efb\u4f55\u200b\u63a5\u53e3\u200b\u3002</p> <p>\u200b\u91cd\u8981\u200b\u6982\u5ff5\u200b</p> <p>cglib \u200b\u4e0d\u200b\u8981\u6c42\u200b\u76ee\u6807\u200b\u5b9e\u73b0\u200b\u63a5\u53e3\u200b\uff0c\u200b\u5b83\u200b\u751f\u6210\u200b\u7684\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u662f\u200b\u76ee\u6807\u200b\u7684\u200b\u5b50\u7c7b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4ee3\u7406\u200b\u4e0e\u200b\u76ee\u6807\u200b\u4e4b\u95f4\u200b\u662f\u200b\u5b50\u7236\u200b\u5173\u7cfb\u200b</p> \u200b\u6d4b\u8bd5\u4ee3\u7801\u200b Java<pre><code>private AdvisedSupport advisedSupport;\n\n@Before\npublic void setup() {\n    WorldService worldService = new WorldServiceImpl();\n\n    advisedSupport = new AdvisedSupport();\n    TargetSource targetSource = new TargetSource(worldService);\n    WorldServiceInterceptor methodInterceptor = new WorldServiceInterceptor();\n    MethodMatcher methodMatcher = new AspectJExpressionPointcut(\"execution(* test.aop.bean.WorldService.explode(..))\").getMethodMatcher();\n    advisedSupport.setTargetSource(targetSource);\n    advisedSupport.setMethodInterceptor(methodInterceptor);\n    advisedSupport.setMethodMatcher(methodMatcher);\n}\n</code></pre> Java<pre><code>@Test\npublic void testCglibDynamicProxy1() throws Exception {\n    WorldService proxy = (WorldService) new CglibAopProxy(advisedSupport).getProxy();\n    proxy.explode();\n}\n</code></pre> Java<pre><code>@Test\npublic void testCglibDynamicProxy2() throws Exception {\n    WorldServiceImpl proxy = (WorldServiceImpl) new CglibAopProxy(advisedSupport).getProxy();\n    proxy.explode();\n}\n</code></pre> <p>\u200b\u8fd0\u884c\u200b\u4e0a\u8ff0\u200b\u4ee3\u7801\u200b\u5747\u200b\u65e0\u200b\u62a5\u9519\u200b\uff0c\u200b\u5373\u200b\u9a8c\u8bc1\u200b\u4e86\u200b \u200b\u4ee3\u7406\u200b\u4e0e\u200b\u76ee\u6807\u200b\u4e4b\u95f4\u200b\u662f\u200b\u5b50\u7236\u200b\u5173\u7cfb\u200b </p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#1-cglib","title":"1. Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u6e90\u7801","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b\uff1a<code>com.iflove.simplespring.aop.framework.CglibAopProxy</code></p> Java<pre><code>public class CglibAopProxy implements AopProxy {\n\n    private final AdvisedSupport advised;\n\n    public CglibAopProxy(AdvisedSupport advised) {\n        this.advised = advised;\n    }\n\n    @Override\n    public Object getProxy() {\n        Enhancer enhancer = new Enhancer();\n        Class&lt;?&gt; aClass = advised.getTargetSource().getTarget().getClass();\n        aClass = ClassUtils.isCglibProxyClass(aClass)? aClass.getSuperclass() : aClass;\n        enhancer.setSuperclass(aClass);\n        enhancer.setInterfaces(advised.getTargetSource().getTargetClass());\n        enhancer.setCallback(new DynamicAdvisedInterceptor(advised));\n        return enhancer.create();\n    }\n\n    private static class DynamicAdvisedInterceptor implements MethodInterceptor {\n\n        private final AdvisedSupport advised;\n\n        public DynamicAdvisedInterceptor(AdvisedSupport advised) {\n            this.advised = advised;\n        }\n\n        @Override\n        public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {\n            CglibMethodInvocation methodInvocation = new CglibMethodInvocation(advised.getTargetSource().getTarget(), method, objects, methodProxy);\n            if (advised.getMethodMatcher().matches(method, advised.getTargetSource().getTarget().getClass())) {\n                return advised.getMethodInterceptor().invoke(methodInvocation);\n            }\n            return methodInvocation.proceed();\n        }\n    }\n\n    private static class CglibMethodInvocation extends ReflectiveMethodInvocation {\n\n        private final MethodProxy methodProxy;\n\n        public CglibMethodInvocation(Object target, Method method, Object[] arguments, MethodProxy methodProxy) {\n            super(target, method, arguments);\n            this.methodProxy = methodProxy;\n        }\n\n        @Override\n        public Object proceed() throws Throwable {\n            return this.methodProxy.invoke(this.target, this.arguments);\n        }\n\n    }\n}\n</code></pre> <p>\u200b\u4e0e\u200b <code>JDK</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0c<code>Cglib</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u62e5\u6709\u200b\u4e24\u4e2a\u200b\u7279\u522b\u200b\u7684\u200b\u5185\u90e8\u200b\u7c7b\u200b <code>DynamicAdvisedInterceptor</code> \u200b\u548c\u200b <code>CglibMethodInvocation</code> </p> <ul> <li><code>CglibMethodInvocation</code> \u200b\u6269\u5c55\u200b <code>ReflectiveMethodInvocation</code> \u200b\u7c7b\u4ee5\u200b\u652f\u6301\u200b <code>CGLIB</code> \u200b\u4ee3\u7406\u200b</li> <li>\u200b\u4e3b\u8981\u200b\u662f\u200b\u8986\u76d6\u200b\u4e86\u200b <code>invokeJoinpoint()</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b <code>MethodProxy</code> \u200b\u5bf9\u8c61\u200b,\u200b\u5219\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b <code>MethodProxy#invoke</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5426\u5219\u200b\u901a\u8fc7\u200b\u53cd\u5c04\u200b\u8c03\u7528\u200b</li> </ul> <p>\u200b\u90a3\u4e48\u200b\u95ee\u9898\u200b\u6765\u200b\u4e86\u200b\uff0c<code>methodProxy</code> \u200b\u7a76\u7adf\u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f\u200b\u4e0d\u200b\u4f7f\u7528\u200b <code>methodProxy</code> \u200b\u884c\u4e0d\u884c\u200b\uff1f</p> <p>\u200b\u9996\u5148\u200b\u56de\u7b54\u200b \u200b\u4e0d\u200b\u4f7f\u7528\u200b <code>methodProxy</code> \u200b\u884c\u4e0d\u884c\u200b\uff1f \u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b</p> <p>\u200b\u7b54\u6848\u200b\u662f\u200b \u200b\u53ef\u4ee5\u200b\uff01</p> <p>\u200b\u5982\u679c\u200b\u628a\u200b <code>proceed</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200b <code>methodProxy</code> \u200b\u66ff\u6362\u200b\u4e3a\u200b <code>method</code>\uff0c\u200b\u4ee3\u7406\u200b\u4f9d\u7136\u200b\u751f\u6548\u200b\uff0c\u200b\u4e14\u200b\u4e0d\u4f1a\u200b\u62a5\u9519\u200b</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u4ece\u200b\u6e90\u7801\u200b\u89d2\u5ea6\u200b\u5206\u6790\u200b <code>methodProxy</code> \u200b\u7a76\u7adf\u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#2-cglib","title":"2. CGLIB \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u539f\u7406\u200b\u4e0e\u200b\u6027\u80fd\u200b\u4f18\u5316","text":"<p><code>MethodProxy</code> \u200b\u662f\u200b CGLIB \u200b\u4e2d\u200b\u4e00\u4e2a\u200b\u5173\u952e\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u6267\u884c\u200b\u4ee3\u7406\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5b83\u200b\u901a\u8fc7\u200b ASM \u200b\u5b57\u8282\u200b\u7801\u200b\u6846\u67b6\u200b\u751f\u6210\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7c7b\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u9ad8\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u4e0e\u200b\u4f20\u7edf\u200b\u7684\u200b\u53cd\u5c04\u200b\u65b9\u5f0f\u200b\u76f8\u6bd4\u200b\uff0c<code>MethodProxy</code> \u200b\u80fd\u200b\u907f\u514d\u200b\u9891\u7e41\u200b\u53cd\u5c04\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4ece\u800c\u200b\u4f18\u5316\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u8fdb\u5165\u200b <code>proceed</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200b <code>invoke</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6e90\u7801\u200b\u5982\u4e0b\u200b</p> Java<pre><code>public Object invoke(Object obj, Object[] args) throws Throwable {\n    try {\n        this.init();\n        FastClassInfo fci = this.fastClassInfo;\n        return fci.f1.invoke(fci.i1, obj, args);\n    } catch (InvocationTargetException var4) {\n        InvocationTargetException e = var4;\n        throw e.getTargetException();\n    } catch (IllegalArgumentException var5) {\n        IllegalArgumentException e = var5;\n        if (this.fastClassInfo.i1 &lt; 0) {\n            throw new IllegalArgumentException(\"Protected method: \" + this.sig1);\n        } else {\n            throw e;\n        }\n    }\n}\n</code></pre> <p>\u200b\u7ee7\u7eed\u200b\u8fdb\u5165\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e0b\u200b\u7684\u200b <code>init</code> \u200b\u65b9\u6cd5\u200b</p> Java<pre><code>private void init() {\n    if (this.fastClassInfo == null) {\n        synchronized(this.initLock) {\n            if (this.fastClassInfo == null) {\n                CreateInfo ci = this.createInfo;\n                FastClassInfo fci = new FastClassInfo();\n                fci.f1 = helper(ci, ci.c1);\n                fci.f2 = helper(ci, ci.c2);\n                fci.i1 = fci.f1.getIndex(this.sig1);\n                fci.i2 = fci.f2.getIndex(this.sig2);\n                this.fastClassInfo = fci;\n                this.createInfo = null;\n            }\n        }\n    }\n\n}\n</code></pre> <p>\u200b\u5728\u200b <code>init</code> \u200b\u65b9\u6cd5\u200b\u4e0b\u200b\uff0c\u200b\u6709\u200b\u4e24\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b\u7c7b\u200b <code>f1</code> \u200b\u548c\u200b <code>f2</code>\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b <code>FastClass</code></p> <p>\u200b\u5c06\u200b\u6e90\u7801\u200b\u62c9\u200b\u5230\u200b\u5e95\u90e8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b <code>FastClass</code> \u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> Java<pre><code>private static class FastClassInfo {\n    FastClass f1;\n    FastClass f2;\n    int i1;\n    int i2;\n\n    private FastClassInfo() {\n    }\n}\n</code></pre> <ul> <li><code>F1</code> \u200b\u8868\u793a\u200b\u5df2\u7ecf\u200b\u521b\u5efa\u200b\u7684\u200b\u4ee3\u7406\u200b\u7c7b\u200b\uff0c\u200b\u5305\u542b\u200b\u4ee3\u7406\u200b\u903b\u8f91\u200b</li> <li><code>F2</code> \u200b\u8868\u793a\u200b\u539f\u59cb\u200b\u7c7b\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5c01\u88c5\u200b\uff0c\u200b\u52a0\u901f\u200b\u539f\u751f\u200b\u7c7b\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b</li> </ul> <p>\u200b\u65e0\u8bba\u662f\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u8fd8\u662f\u200b\u539f\u751f\u200b\u7684\u200b\u7c7b\u200b, \u200b\u5728\u200b\u521b\u5efa\u200b\u4ee3\u7406\u200b\u3001\u200b\u6267\u884c\u200b\u4ee3\u7406\u200b\u5185\u90e8\u200b\u7684\u200b\u4e00\u4e9b\u200b\u65b9\u6cd5\u200b\u4ee5\u53ca\u200b\u8c03\u7528\u200b\u4e00\u4e9b\u200b\u503c\u200b\u7684\u200b\u65f6\u5019\u200b, \u200b\u5982\u679c\u200b\u8981\u200b\u4f7f\u7528\u200b\u5230\u200b\u539f\u751f\u200b\u7c7b\u4e2d\u200b\u7684\u200b\u65b9\u6cd5\u200b\u7684\u8bdd\u200b\uff0c\u200b\u662f\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u53cd\u5c04\u200b\u7684\u200b\u65b9\u5f0f\u200b\u53bb\u200b\u6267\u884c\u200b\u7684\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5f80\u200b\u6781\u7aef\u200b\u4e00\u70b9\u200b\u7684\u200b\u65b9\u5411\u200b\u601d\u8003\u200b\uff0c\u200b\u5982\u679c\u200b\u539f\u751f\u200b\u7c7b\u4e2d\u200b\u88ab\u200b\u8c03\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\u975e\u5e38\u200b\u591a\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b <code>java</code> \u200b\u8fdb\u884c\u200b\u9891\u7e41\u200b\u7684\u200b\u53cd\u5c04\u200b\uff0c\u200b\u800c\u200b\u4f7f\u7528\u200b\u53cd\u5c04\u200b\uff0c\u200b\u53c8\u200b\u4f1a\u200b\u5bfc\u81f4\u200b <code>JVM</code> \u200b\u673a\u5236\u200b\u8fdb\u884c\u200b\u53cd\u5c04\u200b\u7684\u200b\u68c0\u67e5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u6837\u200b\u505a\u200b\u662f\u200b\u76f8\u5f53\u200b\u727a\u7272\u200b\u6027\u80fd\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c<code>Cglib</code> \u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b <code>MethodProxy</code> \u200b\u7c7b\u200b\uff0c\u200b\u5c06\u200b\u539f\u751f\u200b\u7c7b\u4e2d\u200b\u6240\u6709\u200b\u9700\u8981\u200b\u4ee3\u7406\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5b58\u5165\u200b\u8fd9\u4e2a\u200b\u7c7b\u4e2d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u76f4\u63a5\u200b\u6267\u884c\u200b\u5373\u53ef\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u597d\u5904\u200b\u5c31\u662f\u200b\u53ef\u4ee5\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u3002</p> <p></p> <p>\u200b\u5728\u200b <code>MethodProxy</code> \u200b\u7c7b\u4e2d\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u7279\u522b\u200b\u7684\u200b\u65b9\u6cd5\u200b <code>invokeSuper</code>\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u4ee3\u8868\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u539f\u59cb\u200b\u7c7b\u200b\u7684\u200b\u65b9\u6cd5\u200b</p> Java<pre><code>methodProxy.invokeSuper(this.target, this.arguments);\n</code></pre> <p>\u200b\u90a3\u4e48\u200b\u987e\u540d\u601d\u4e49\u200b\uff0c<code>invoke</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5c31\u662f\u200b\u8c03\u7528\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u7684\u200b\u4ee3\u7406\u200b\u65b9\u6cd5\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#3-cglib","title":"3. Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7c7b","text":"<p>\u200b\u7c7b\u4f3c\u200b\u4e0a\u6587\u200b\u83b7\u53d6\u200b JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u7684\u200b\u65b9\u6cd5\u200b</p> <p>\u200b\u5728\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u7684\u200b\u672b\u5c3e\u200b\u52a0\u4e0a\u200b</p> Java<pre><code>System.out.println(proxy.getClass());\nwhile (true) {}\n</code></pre> <p>\u200b\u4fdd\u8bc1\u200b\u7a0b\u5e8f\u200b\u59cb\u7ec8\u200b\u8fd0\u884c\u200b</p> <p>\u200b\u4e0b\u8f7d\u200b arthas \u200b\u5e76\u200b\u542f\u52a8\u200b</p> Bash<pre><code>java -jar arthas-boot.jar\n</code></pre> <p>\u200b\u83b7\u53d6\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7c7b\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b(\u200b\u6709\u70b9\u200b\u5c0f\u957f\u200b)\uff1a</p> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7c7b\u200b Java<pre><code>/*\n * Decompiled with CFR.\n *\n * Could not load the following classes:\n *  test.aop.bean.WorldService\n *  test.aop.bean.WorldServiceImpl\n */\npackage test.aop.bean;\n\nimport java.lang.reflect.Method;\nimport net.sf.cglib.core.ReflectUtils;\nimport net.sf.cglib.core.Signature;\nimport net.sf.cglib.proxy.Callback;\nimport net.sf.cglib.proxy.Factory;\nimport net.sf.cglib.proxy.MethodInterceptor;\nimport net.sf.cglib.proxy.MethodProxy;\nimport test.aop.bean.WorldService;\nimport test.aop.bean.WorldServiceImpl;\n\npublic class WorldServiceImpl$$EnhancerByCGLIB$$81790592\nextends WorldServiceImpl\nimplements WorldService,\nFactory {\n    private boolean CGLIB$BOUND;\n    public static Object CGLIB$FACTORY_DATA;\n    private static final ThreadLocal CGLIB$THREAD_CALLBACKS;\n    private static final Callback[] CGLIB$STATIC_CALLBACKS;\n    private MethodInterceptor CGLIB$CALLBACK_0;\n    private static Object CGLIB$CALLBACK_FILTER;\n    private static final Method CGLIB$explode$0$Method;\n    private static final MethodProxy CGLIB$explode$0$Proxy;\n    private static final Object[] CGLIB$emptyArgs;\n    private static final Method CGLIB$equals$1$Method;\n    private static final MethodProxy CGLIB$equals$1$Proxy;\n    private static final Method CGLIB$toString$2$Method;\n    private static final MethodProxy CGLIB$toString$2$Proxy;\n    private static final Method CGLIB$hashCode$3$Method;\n    private static final MethodProxy CGLIB$hashCode$3$Proxy;\n    private static final Method CGLIB$clone$4$Method;\n    private static final MethodProxy CGLIB$clone$4$Proxy;\n\n    public WorldServiceImpl$$EnhancerByCGLIB$$81790592() {\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592 worldServiceImpl$$EnhancerByCGLIB$$81790592 = this;\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(worldServiceImpl$$EnhancerByCGLIB$$81790592);\n    }\n\n    static {\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$STATICHOOK1();\n    }\n\n    public final boolean equals(Object object) {\n        MethodInterceptor methodInterceptor = this.CGLIB$CALLBACK_0;\n        if (methodInterceptor == null) {\n            WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n            methodInterceptor = this.CGLIB$CALLBACK_0;\n        }\n        if (methodInterceptor != null) {\n            Object object2 = methodInterceptor.intercept(this, CGLIB$equals$1$Method, new Object[]{object}, CGLIB$equals$1$Proxy);\n            return object2 == null ? false : (Boolean)object2;\n        }\n        return super.equals(object);\n    }\n\n    public final String toString() {\n        MethodInterceptor methodInterceptor = this.CGLIB$CALLBACK_0;\n        if (methodInterceptor == null) {\n            WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n            methodInterceptor = this.CGLIB$CALLBACK_0;\n        }\n        if (methodInterceptor != null) {\n            return (String)methodInterceptor.intercept(this, CGLIB$toString$2$Method, CGLIB$emptyArgs, CGLIB$toString$2$Proxy);\n        }\n        return super.toString();\n    }\n\n    public final int hashCode() {\n        MethodInterceptor methodInterceptor = this.CGLIB$CALLBACK_0;\n        if (methodInterceptor == null) {\n            WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n            methodInterceptor = this.CGLIB$CALLBACK_0;\n        }\n        if (methodInterceptor != null) {\n            Object object = methodInterceptor.intercept(this, CGLIB$hashCode$3$Method, CGLIB$emptyArgs, CGLIB$hashCode$3$Proxy);\n            return object == null ? 0 : ((Number)object).intValue();\n        }\n        return super.hashCode();\n    }\n\n    protected final Object clone() throws CloneNotSupportedException {\n        MethodInterceptor methodInterceptor = this.CGLIB$CALLBACK_0;\n        if (methodInterceptor == null) {\n            WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n            methodInterceptor = this.CGLIB$CALLBACK_0;\n        }\n        if (methodInterceptor != null) {\n            return methodInterceptor.intercept(this, CGLIB$clone$4$Method, CGLIB$emptyArgs, CGLIB$clone$4$Proxy);\n        }\n        return super.clone();\n    }\n\n    @Override\n    public Object newInstance(Callback[] callbackArray) {\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$SET_THREAD_CALLBACKS(callbackArray);\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592 worldServiceImpl$$EnhancerByCGLIB$$81790592 = new WorldServiceImpl$$EnhancerByCGLIB$$81790592();\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$SET_THREAD_CALLBACKS(null);\n        return worldServiceImpl$$EnhancerByCGLIB$$81790592;\n    }\n\n    @Override\n    public Object newInstance(Callback callback) {\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$SET_THREAD_CALLBACKS(new Callback[]{callback});\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592 worldServiceImpl$$EnhancerByCGLIB$$81790592 = new WorldServiceImpl$$EnhancerByCGLIB$$81790592();\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$SET_THREAD_CALLBACKS(null);\n        return worldServiceImpl$$EnhancerByCGLIB$$81790592;\n    }\n\n    @Override\n    public Object newInstance(Class[] classArray, Object[] objectArray, Callback[] callbackArray) {\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592 worldServiceImpl$$EnhancerByCGLIB$$81790592;\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$SET_THREAD_CALLBACKS(callbackArray);\n        Class[] classArray2 = classArray;\n        switch (classArray.length) {\n            case 0: {\n                worldServiceImpl$$EnhancerByCGLIB$$81790592 = new WorldServiceImpl$$EnhancerByCGLIB$$81790592();\n                break;\n            }\n            default: {\n                throw new IllegalArgumentException(\"Constructor not found\");\n            }\n        }\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$SET_THREAD_CALLBACKS(null);\n        return worldServiceImpl$$EnhancerByCGLIB$$81790592;\n    }\n\n    public final void explode() {\n        MethodInterceptor methodInterceptor = this.CGLIB$CALLBACK_0;\n        if (methodInterceptor == null) {\n            WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n            methodInterceptor = this.CGLIB$CALLBACK_0;\n        }\n        if (methodInterceptor != null) {\n            Object object = methodInterceptor.intercept(this, CGLIB$explode$0$Method, CGLIB$emptyArgs, CGLIB$explode$0$Proxy);\n            return;\n        }\n        super.explode();\n    }\n\n    @Override\n    public Callback[] getCallbacks() {\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592 worldServiceImpl$$EnhancerByCGLIB$$81790592 = this;\n        return new Callback[]{this.CGLIB$CALLBACK_0};\n    }\n\n    static void CGLIB$STATICHOOK1() {\n        CGLIB$THREAD_CALLBACKS = new ThreadLocal();\n        CGLIB$emptyArgs = new Object[0];\n        Class&lt;?&gt; clazz = Class.forName(\"test.aop.bean.WorldServiceImpl$$EnhancerByCGLIB$$81790592\");\n        Class&lt;?&gt; clazz2 = Class.forName(\"test.aop.bean.WorldServiceImpl\");\n        CGLIB$explode$0$Method = ReflectUtils.findMethods(new String[]{\"explode\", \"()V\"}, clazz2.getDeclaredMethods())[0];\n        CGLIB$explode$0$Proxy = MethodProxy.create(clazz2, clazz, \"()V\", \"explode\", \"CGLIB$explode$0\");\n        clazz2 = Class.forName(\"java.lang.Object\");\n        Method[] methodArray = ReflectUtils.findMethods(new String[]{\"equals\", \"(Ljava/lang/Object;)Z\", \"toString\", \"()Ljava/lang/String;\", \"hashCode\", \"()I\", \"clone\", \"()Ljava/lang/Object;\"}, clazz2.getDeclaredMethods());\n        CGLIB$equals$1$Method = methodArray[0];\n        CGLIB$equals$1$Proxy = MethodProxy.create(clazz2, clazz, \"(Ljava/lang/Object;)Z\", \"equals\", \"CGLIB$equals$1\");\n        CGLIB$toString$2$Method = methodArray[1];\n        CGLIB$toString$2$Proxy = MethodProxy.create(clazz2, clazz, \"()Ljava/lang/String;\", \"toString\", \"CGLIB$toString$2\");\n        CGLIB$hashCode$3$Method = methodArray[2];\n        CGLIB$hashCode$3$Proxy = MethodProxy.create(clazz2, clazz, \"()I\", \"hashCode\", \"CGLIB$hashCode$3\");\n        CGLIB$clone$4$Method = methodArray[3];\n        CGLIB$clone$4$Proxy = MethodProxy.create(clazz2, clazz, \"()Ljava/lang/Object;\", \"clone\", \"CGLIB$clone$4\");\n    }\n\n    final String CGLIB$toString$2() {\n        return super.toString();\n    }\n\n    private static final void CGLIB$BIND_CALLBACKS(Object object) {\n        block2: {\n            Object object2;\n            block3: {\n                WorldServiceImpl$$EnhancerByCGLIB$$81790592 worldServiceImpl$$EnhancerByCGLIB$$81790592 = (WorldServiceImpl$$EnhancerByCGLIB$$81790592)object;\n                if (worldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BOUND) break block2;\n                worldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BOUND = true;\n                object2 = CGLIB$THREAD_CALLBACKS.get();\n                if (object2 != null) break block3;\n                object2 = CGLIB$STATIC_CALLBACKS;\n                if (CGLIB$STATIC_CALLBACKS == null) break block2;\n            }\n            worldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$CALLBACK_0 = (MethodInterceptor)((Callback[])object2)[0];\n        }\n    }\n\n    final boolean CGLIB$equals$1(Object object) {\n        return super.equals(object);\n    }\n\n    final void CGLIB$explode$0() {\n        super.explode();\n    }\n\n    final int CGLIB$hashCode$3() {\n        return super.hashCode();\n    }\n\n    @Override\n    public void setCallback(int n, Callback callback) {\n        switch (n) {\n            case 0: {\n                this.CGLIB$CALLBACK_0 = (MethodInterceptor)callback;\n                break;\n            }\n        }\n    }\n\n    @Override\n    public void setCallbacks(Callback[] callbackArray) {\n        Callback[] callbackArray2 = callbackArray;\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592 worldServiceImpl$$EnhancerByCGLIB$$81790592 = this;\n        this.CGLIB$CALLBACK_0 = (MethodInterceptor)callbackArray[0];\n    }\n\n    public static MethodProxy CGLIB$findMethodProxy(Signature signature) {\n        String string = ((Object)signature).toString();\n        switch (string.hashCode()) {\n            case -508378822: {\n                if (!string.equals(\"clone()Ljava/lang/Object;\")) break;\n                return CGLIB$clone$4$Proxy;\n            }\n            case 1741417204: {\n                if (!string.equals(\"explode()V\")) break;\n                return CGLIB$explode$0$Proxy;\n            }\n            case 1826985398: {\n                if (!string.equals(\"equals(Ljava/lang/Object;)Z\")) break;\n                return CGLIB$equals$1$Proxy;\n            }\n            case 1913648695: {\n                if (!string.equals(\"toString()Ljava/lang/String;\")) break;\n                return CGLIB$toString$2$Proxy;\n            }\n            case 1984935277: {\n                if (!string.equals(\"hashCode()I\")) break;\n                return CGLIB$hashCode$3$Proxy;\n            }\n        }\n        return null;\n    }\n\n    final Object CGLIB$clone$4() throws CloneNotSupportedException {\n        return super.clone();\n    }\n\n    @Override\n    public Callback getCallback(int n) {\n        MethodInterceptor methodInterceptor;\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n        switch (n) {\n            case 0: {\n                methodInterceptor = this.CGLIB$CALLBACK_0;\n                break;\n            }\n            default: {\n                methodInterceptor = null;\n            }\n        }\n        return methodInterceptor;\n    }\n\n    public static void CGLIB$SET_STATIC_CALLBACKS(Callback[] callbackArray) {\n        CGLIB$STATIC_CALLBACKS = callbackArray;\n    }\n\n    public static void CGLIB$SET_THREAD_CALLBACKS(Callback[] callbackArray) {\n        CGLIB$THREAD_CALLBACKS.set(callbackArray);\n    }\n}\n</code></pre> <p>\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u540e\u200b\u7684\u200b <code>explode</code> \u200b\u65b9\u6cd5\u200b\u505a\u200b\u4e86\u200b\u4ec0\u4e48\u200b\uff1f</p> Java<pre><code>public final void explode() {\n    MethodInterceptor methodInterceptor = this.CGLIB$CALLBACK_0;\n    if (methodInterceptor == null) {\n        WorldServiceImpl$$EnhancerByCGLIB$$81790592.CGLIB$BIND_CALLBACKS(this);\n        methodInterceptor = this.CGLIB$CALLBACK_0;\n    }\n    if (methodInterceptor != null) {\n        Object object = methodInterceptor.intercept(this, CGLIB$explode$0$Method, CGLIB$emptyArgs, CGLIB$explode$0$Proxy);\n        return;\n    }\n    super.explode();\n}\n</code></pre> <p>\u200b\u9996\u5148\u200b\u83b7\u53d6\u200b <code>MethodInterceptor</code>\uff0c\u200b\u5982\u679c\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b <code>MethodInterceptor</code> \u200b\u7684\u200b <code>intercept</code> \u200b\u65b9\u6cd5\u200b</p> <p>\u200b\u5373\u200b <code>DynamicAdvisedInterceptor</code> \u200b\u7c7b\u200b\u7684\u200b <code>intercept</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6267\u884c\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200b\u65b9\u6cd5\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#aop","title":"AOP \u200b\u4ee3\u7406\u200b\u5de5\u5382","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#1","title":"1. \u200b\u6d4b\u8bd5\u4ee3\u7801","text":"Java<pre><code>@Test\npublic void testProxyFactory() {\n    // \u200b\u4f7f\u7528\u200b JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\n    advisedSupport.setProxyTargetClass(false);\n    WorldService proxy = (WorldService) new ProxyFactory(advisedSupport).getProxy();\n    proxy.explode();\n\n    // \u200b\u4f7f\u7528\u200b Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\n    advisedSupport.setProxyTargetClass(true);\n    proxy = (WorldService) new ProxyFactory(advisedSupport).getProxy();\n    proxy.explode();\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#2-aop","title":"2. AOP \u200b\u4ee3\u7406\u200b\u5de5\u5382\u200b\u4ee3\u7801","text":"Java<pre><code>public class ProxyFactory {\n    private AdvisedSupport advisedSupport;\n\n    public ProxyFactory(AdvisedSupport advisedSupport) {\n        this.advisedSupport = advisedSupport;\n    }\n\n    public Object getProxy() {\n        return createAopProxy().getProxy();\n    }\n\n    private AopProxy createAopProxy() {\n        if (advisedSupport.isProxyTargetClass()) {\n            return new CglibAopProxy(advisedSupport);\n        }\n\n        return new JdkDynamicAopProxy(advisedSupport);\n    }\n}\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u5230\u200b\u5207\u6362\u200b <code>JDK</code> \u200b\u548c\u200b <code>Cglib</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5173\u952e\u200b\u662f\u200b <code>AdvisedSupport</code> \u200b\u7684\u200b <code>proxyTargetClass</code> \u200b\u53c2\u6570\u200b</p> <ul> <li><code>proxyTargetClass</code> \u200b\u4e3a\u200b <code>false</code> \u200b\u4ee3\u8868\u200b\u4f7f\u7528\u200b <code>JDK</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b</li> <li><code>proxyTargetClass</code> \u200b\u4e3a\u200b <code>true</code> \u200b\u4ee3\u8868\u200b\u4f7f\u7528\u200b <code>Cglib</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b</li> </ul> <p>\u200b\u800c\u200b <code>AdvisedSupport</code> \u200b\u7684\u200b <code>proxyTargetClass</code> \u200b\u53c2\u6570\u200b \u200b\u9ed8\u8ba4\u503c\u200b \u200b\u4e3a\u200b <code>false</code>\uff0c\u200b\u5373\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b <code>JDK</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#advicebeforeadviceafteradviceafterreturningadvicethrowsadvice","title":"\u51e0\u79cd\u200b\u5e38\u7528\u200b\u7684\u200bAdvice\uff1aBeforeAdvice/AfterAdvice/AfterReturningAdvice/ThrowsAdvice...","text":"<p><code>Spring</code> \u200b\u5c06\u200b <code>AOP</code> \u200b\u8054\u76df\u200b\u4e2d\u200b\u7684\u200b <code>Advice</code> \u200b\u7ec6\u5316\u200b\u51fa\u200b\u5404\u79cd\u7c7b\u578b\u200b\u7684\u200b <code>Advice</code>\uff0c\u200b\u5e38\u7528\u200b\u7684\u200b\u6709\u200b<code>BeforeAdvice/AfterAdvice/AfterReturningAdvice/ThrowsAdvice</code>\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6269\u5c55\u200b<code>MethodInterceptor</code>\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b</p> Java<pre><code>public class WorldServiceBeforeAdvice implements MethodBeforeAdvice {\n\n    @Override\n    public void before(Method method, Object[] args, Object target) throws Throwable {\n        System.out.println(\"BeforeAdvice: do something before the earth explodes\");\n    }\n}\n</code></pre> Java<pre><code>@Test\npublic void testBeforeAdvice() throws Exception {\n    //\u200b\u8bbe\u7f6e\u200bBeforeAdvice\n    WorldServiceBeforeAdvice beforeAdvice = new WorldServiceBeforeAdvice();\n    MethodBeforeAdviceInterceptor methodInterceptor = new MethodBeforeAdviceInterceptor(beforeAdvice);\n    advisedSupport.setMethodInterceptor(methodInterceptor);\n\n    WorldService proxy = (WorldService) new ProxyFactory(advisedSupport).getProxy();\n    proxy.explode();\n}\n</code></pre> <p>\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b\u89c4\u8303\u200b <code>Interceptor</code> \u200b\u5206\u7c7b\u200b\uff0c\u200b\u6839\u636e\u200b\u9700\u8981\u200b\u7684\u200b\u4ee3\u7406\u200b\u65f6\u673a\u200b\u9009\u62e9\u200b\u5bf9\u5e94\u200b\u7684\u200b <code>Advice</code> \u200b\u548c\u200b <code>Interceptor</code> \u200b\u5373\u53ef\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u7b80\u5355\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u591a\u200b\u8d58\u8ff0\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#spring-aop_1","title":"Spring AOP \u200b\u62e6\u622a\u5668\u200b\u94fe","text":"<p>\u200b\u867d\u7136\u200b\u5728\u200b\u524d\u9762\u200b\u6211\u4eec\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5bf9\u200b\u65b9\u6cd5\u200b\u7684\u200b\u589e\u5f3a\u200b\uff0c\u200b\u4f46\u200b\u5e76\u200b\u4e0d\u200b\u5b8c\u7f8e\u200b\u3002\u200b\u6211\u4eec\u200b\u7684\u200b\u76ee\u524d\u200b\u7684\u200b\u4ee3\u7801\u200b\u53ea\u80fd\u200b\u652f\u6301\u200b\u5bf9\u200b\u65b9\u6cd5\u200b\u7684\u200b\u5355\u4e2a\u200b\u589e\u5f3a\u200b\u3002\u200b\u4f5c\u4e3a\u200bspring\u200b\u7684\u200b\u6838\u5fc3\u200b\u529f\u80fd\u200b\u5982\u679c\u200b\u4e0d\u200b\u652f\u6301\u200b\u591a\u200b\u5207\u9762\u200b\u7684\u8bdd\u200b\u6709\u70b9\u200b\u592a\u200b\u522b\u626d\u200b\u4e86\u200b\u3002<code>spring</code>\u200b\u5229\u7528\u200b\u4e86\u200b\u62e6\u622a\u5668\u200b\u94fe\u6765\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5bf9\u200b\u591a\u4e2a\u200b\u5207\u9762\u200b\u7684\u200b\u652f\u6301\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#proxyfactory","title":"ProxyFactory","text":"<p>\u200b\u8ba9\u200b\u6211\u4eec\u200b\u4ece\u200b <code>ProxyFactory</code> \u200b\u5f00\u59cb\u200b\uff0c\u200b\u6765\u770b\u200b\u4e00\u4e0b\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6574\u4e2a\u200b\u521b\u5efa\u200b\u6d41\u7a0b\u200b\u3002\u200b\u81f3\u4e8e\u200b\u4e3a\u4ec0\u4e48\u200b\u4ece\u200b <code>ProxyFactory</code>\u200b\u5f00\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u6700\u7ec8\u200b\u662f\u200b\u7528\u200b <code>ProxyFactory</code> \u200b\u7684\u200b <code>getProxy()</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u83b7\u5f97\u200b\u7684\u200b\u3002</p> Java<pre><code>public class ProxyFactory extends AdvisedSupport{\n\n\n    public ProxyFactory() {\n    }\n\n    public Object getProxy() {\n        return createAopProxy().getProxy();\n    }\n\n    private AopProxy createAopProxy() {\n        if (this.isProxyTargetClass()||this.getTargetSource().getTargetClass().length==0) {\n            return new CglibAopProxy(this);\n        }\n        return new JdkDynamicAopProxy(this);\n    }\n}\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u66f4\u200b\u8d34\u5408\u200b<code>spring</code>\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u66f4\u6539\u200b\u4e86\u200b <code>ProxyFactory</code> \u200b\u4f7f\u200b\u5176\u200b\u7ee7\u627f\u200b\u4e86\u200b <code>AdvisedSupport</code>\uff0c\u200b\u6b63\u5982\u200bspring\u200b\u6e90\u7801\u200b\u4e2d\u200b\u505a\u200b\u7684\u200b\u90a3\u6837\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#jdk_1","title":"\u57fa\u4e8e\u200bJDK\u200b\u52a8\u6001\u200b\u4ee3\u7406","text":"<p><code>ProxyFactory</code> \u200b\u53ea\u662f\u200b\u7b80\u5355\u200b\u7684\u200b\u505a\u200b\u4e86\u200b\u4e0b\u200b\u9009\u62e9\u200b\uff0c\u200b\u5f53\u200b\u6211\u4eec\u200b\u8bbe\u7f6e\u200b <code>proxyTargetClass</code> \u200b\u5c5e\u6027\u200b\u6216\u8005\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u6ca1\u6709\u200b\u63a5\u53e3\u200b\u65f6\u4f1a\u200b\u8c03\u7528\u200b <code>cjlib</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0c\u200b\u5426\u5219\u200b\u8c03\u7528\u200b <code>jdk</code> \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u3002\u200b\u4e8c\u8005\u200b\u5b9e\u73b0\u200b\u5e76\u200b\u6ca1\u6709\u200b\u592a\u200b\u5927\u200b\u533a\u522b\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u53ea\u200b\u8d34\u200b\u51fa\u200bjdk\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200b\u5b9e\u73b0\u200b\u3002</p> Java<pre><code>    public Object getProxy() {\n        return Proxy.newProxyInstance(getClass().getClassLoader(), advised.getTargetSource().getTargetClass(), this);\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        // \u200b\u83b7\u53d6\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\n        Object target=advised.getTargetSource().getTarget();\n        Class&lt;?&gt; targetClass = target.getClass();\n        Object retVal = null;\n        // \u200b\u83b7\u53d6\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\n        List&lt;Object&gt; chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);\n        if(chain==null||chain.isEmpty()){\n            return method.invoke(target, args);\n        }else{\n            // \u200b\u5c06\u200b\u62e6\u622a\u5668\u200b\u7edf\u4e00\u200b\u5c01\u88c5\u200b\u6210\u200bReflectiveMethodInvocation\n            MethodInvocation invocation =\n                    new ReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain);\n            // Proceed to the joinpoint through the interceptor chain.\n            // \u200b\u6267\u884c\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\n            retVal = invocation.proceed();\n        }\n        return retVal;\n    }\n</code></pre> <p>jdk\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u53ef\u4ee5\u200b\u5206\u4e3a\u200b\u83b7\u53d6\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\uff0c\u200b\u5c06\u200b\u62e6\u622a\u5668\u200b\u7edf\u4e00\u200b\u5c01\u88c5\u200b\u6210\u200b <code>ReflectiveMethodInvocation</code>\uff0c\u200b\u6267\u884c\u200b\u62e6\u622a\u5668\u200b\u94fe\u4e09\u200b\u90e8\u5206\u200b\u3002\u200b\u6211\u4eec\u200b\u6765\u200b\u9010\u4e00\u200b\u770b\u200b\u4e00\u4e0b\u200b\u8fd9\u4e09\u200b\u90e8\u5206\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#1_1","title":"1. \u200b\u83b7\u53d6\u200b\u62e6\u622a\u5668\u200b\u94fe","text":"<p>\u200b\u9996\u5148\u200b\u5c06\u200b\u83b7\u53d6\u200b\u5230\u200b\u6240\u6709\u200b\u4e0e\u200b\u5f53\u524d\u200b<code>method</code>\u200b\u5339\u914d\u200b\u7684\u200b<code>advice</code>(\u200b\u589e\u5f3a\u200b)\uff0c\u200b\u8ddf\u8e2a\u200b<code>getInterceptorsAndDynamicInterceptionAdvice</code>\u200b\u4ee3\u7801\u200b\uff0c\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b<code>Spring AOP</code>\u200b\u4e5f\u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\u8fdb\u884c\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\uff0c\u200b\u5982\u679c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5df2\u7ecf\u200b\u83b7\u53d6\u200b\u8fc7\u200b\u62e6\u622a\u5668\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u53d6\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5426\u5219\u200b\u901a\u8fc7\u200b<code>advisorChainFactory</code>\u200b\u83b7\u53d6\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\u3002</p> <p><code>AdvisorChainFactory</code>\u200b\u662f\u200b\u7528\u6765\u200b\u83b7\u5f97\u200b\u62e6\u622a\u5668\u200b\u94fe\u63a5\u200b\u53e3\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b9e\u73b0\u200b\u7c7b\u4e3a\u200b<code>DefaultAdvisorChainFactory</code></p> <p><code>AdvisedSupport#getInterceptorsAndDynamicInterceptionAdvice</code>\uff1a</p> Java<pre><code>    public List&lt;Object&gt; getInterceptorsAndDynamicInterceptionAdvice(Method method, Class&lt;?&gt; targetClass) {\n        Integer cacheKey=method.hashCode();\n        List&lt;Object&gt; cached = this.methodCache.get(cacheKey);\n        if (cached == null) {\n            cached = this.advisorChainFactory.getInterceptorsAndDynamicInterceptionAdvice(\n                    this, method, targetClass);\n            this.methodCache.put(cacheKey, cached);\n        }\n        return cached;\n    }\n</code></pre> <p></p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u5bf9\u200b<code>advisorChainFactory</code>\u200b\u83b7\u53d6\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\u8fdb\u884c\u200b\u89e3\u8bfb\u200b\u3002</p> <p>\u200b\u6574\u4f53\u200b\u4ee3\u7801\u200b\u5e76\u200b\u4e0d\u200b\u590d\u6742\u200b\uff0c\u200b\u9996\u5148\u200b\u83b7\u53d6\u200b\u6240\u6709\u200b<code>Advisor</code>(\u200b\u5207\u9762\u200b)\uff0c\u200b\u901a\u8fc7\u200b<code>pointcutAdvisor.getPointcut().getClassFilter().matches(actualClass)</code>\u200b\u6821\u9a8c\u200b\u5f53\u524d\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u662f\u5426\u200b\u5339\u914d\u200b\u8be5\u200b<code>Advisor</code>\uff0c\u200b\u518d\u200b\u901a\u8fc7\u200b<code>pointcutAdvisor.getPointcut().getMethodMatcher()</code>\u200b\u6821\u9a8c\u200b\u662f\u5426\u200b\u5339\u914d\u200b\u5f53\u524d\u200b\u8c03\u7528\u200b<code>method</code>\u3002</p> <p>\u200b\u5982\u679c\u200b\u901a\u8fc7\u200b\u6821\u9a8c\u200b\uff0c\u200b\u5219\u200b\u63d0\u53d6\u200b<code>advisor</code>\u200b\u4e2d\u200b\u7684\u200b<code>interceptors</code>\u200b\u589e\u5f3a\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5230\u200b<code>interceptorList</code>\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u53ef\u80fd\u200b\u6709\u200b\u8bfb\u8005\u200b\u4f1a\u200b\u7591\u60d1\u200b\uff0c\u200b\u660e\u660e\u200b\u662f\u200b\u8981\u200b\u83b7\u53d6\u200b<code>MethodInterceptor</code>\uff0c\u200b\u53ef\u200b<code>AdvisedSupport</code>\u200b\u7684\u200b<code>getAdvice()</code>\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b<code>Advice</code>(\u200b\u589e\u5f3a\u200b),\u200b\u5176\u5b9e\u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u70b9\u5f00\u200b<code>MethodInterceptor</code>\u200b\u7684\u200b\u6e90\u7801\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u53d1\u73b0\u200b<code>MethodInterceptor</code>\u200b\u7ee7\u627f\u200b\u4e86\u200b<code>Interceptor</code>\u200b\u63a5\u53e3\u200b\uff0c\u200b\u800c\u200b<code>Interceptor</code>\u200b\u53c8\u200b\u7ee7\u627f\u200b\u4e86\u200b<code>Advice</code>\u200b\u63a5\u53e3\u200b\u3002\u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u7684\u200b<code>Advice</code>\u200b\u548c\u200b<code>MethodInterceptor</code>\u200b\u6211\u4eec\u200b\u90fd\u200b\u662f\u200b\u7528\u200b\u7684\u200b<code>AOP</code>\u200b\u8054\u76df\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7279\u6b64\u8bf4\u660e\u200b\u4e00\u4e0b\u200b\u3002</p> <p><code>DefultAdvisorChainFactory#getInterceptorsAndDynamicInterceptionAdvice</code></p> Java<pre><code>public List&lt;Object&gt; getInterceptorsAndDynamicInterceptionAdvice(AdvisedSupport config, Method method, Class&lt;?&gt; targetClass) {\n        Advisor[] advisors = config.getAdvisors().toArray(new Advisor[0]);\n        List&lt;Object&gt; interceptorList = new ArrayList&lt;&gt;(advisors.length);\n        Class&lt;?&gt; actualClass = (targetClass != null ? targetClass : method.getDeclaringClass());\n        for (Advisor advisor : advisors) {\n            if (advisor instanceof PointcutAdvisor) {\n                // Add it conditionally.\n                PointcutAdvisor pointcutAdvisor = (PointcutAdvisor) advisor;\n                // \u200b\u6821\u9a8c\u200b\u5f53\u524d\u200bAdvisor\u200b\u662f\u5426\u200b\u9002\u7528\u200b\u4e8e\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\n                if (pointcutAdvisor.getPointcut().getClassFilter().matches(actualClass)) {\n                    MethodMatcher mm = pointcutAdvisor.getPointcut().getMethodMatcher();\n                    boolean match;\n                    // \u200b\u6821\u9a8c\u200bAdvisor\u200b\u662f\u5426\u200b\u5e94\u7528\u200b\u5230\u200b\u5f53\u524d\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\n                    match = mm.matches(method,actualClass);\n                    if (match) {\n                        MethodInterceptor interceptor = (MethodInterceptor) advisor.getAdvice();\n                            interceptorList.add(interceptor);\n                    }\n                }\n            }\n        }\n        return interceptorList;\n    }\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#2reflectivemethodinvocation","title":"2.\u200b\u5c06\u200b\u62e6\u622a\u5668\u200b\u5c01\u88c5\u200b\u6210\u200bReflectiveMethodInvocation","text":"<p>\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u662f\u200b\u91cd\u5199\u200b\u4e86\u200b<code>ReflectiveMethodInvocation</code>\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6765\u200b\u652f\u6301\u200b\u591a\u200b\u5207\u9762\u200b\u3002</p> Java<pre><code>    public ReflectiveMethodInvocation(Object proxy,Object target, Method method, Object[] arguments,Class&lt;?&gt; targetClass,List&lt;Object&gt; chain) {\n        this.proxy=proxy;\n        this.target = target;\n        this.method = method;\n        this.arguments = arguments;\n        this.targetClass=targetClass;\n        this.interceptorsAndDynamicMethodMatchers=chain;\n    }\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#3","title":"3.\u200b\u6267\u884c\u200b\u62e6\u622a\u5668\u200b\u94fe","text":"<p>spring\u200b\u80fd\u591f\u200b\u4fdd\u8bc1\u200b\u591a\u4e2a\u200b\u5207\u9762\u200b\u540c\u65f6\u200b\u5339\u914d\u200b\u540c\u4e00\u200b\u65b9\u6cd5\u200b\u7684\u200b\u800c\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u4e71\u5e8f\u200b\u7684\u200b\u5173\u952e\u200b\u5c31\u200b\u5728\u200b\u4e0b\u9762\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u4e86\u200b\u3002</p> <p><code>ReflectiveMethodInvocation#proceed()</code></p> Java<pre><code>    public Object proceed() throws Throwable {\n        // \u200b\u521d\u59cb\u200bcurrentInterceptorIndex\u200b\u4e3a\u200b-1\uff0c\u200b\u6bcf\u200b\u8c03\u7528\u200b\u4e00\u6b21\u200bproceed\u200b\u5c31\u200b\u628a\u200bcurrentInterceptorIndex+1\n        if (this.currentInterceptorIndex == this.interceptorsAndDynamicMethodMatchers.size() - 1) {\n            // \u200b\u5f53\u200b\u8c03\u7528\u200b\u6b21\u6570\u200b = \u200b\u62e6\u622a\u5668\u200b\u4e2a\u6570\u200b\u65f6\u200b\n            // \u200b\u89e6\u53d1\u200b\u5f53\u524d\u200bmethod\u200b\u65b9\u6cd5\u200b\n            return method.invoke(this.target, this.arguments);\n        }\n\n        Object interceptorOrInterceptionAdvice =\n                this.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex);\n        // \u200b\u666e\u901a\u200b\u62e6\u622a\u5668\u200b\uff0c\u200b\u76f4\u63a5\u200b\u89e6\u53d1\u200b\u62e6\u622a\u5668\u200binvoke\u200b\u65b9\u6cd5\u200b\n        return ((MethodInterceptor) interceptorOrInterceptionAdvice).invoke(this);\n    }\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u770b\u5230\u200b\uff0c<code>MethodInvocation</code>\u200b\u53ea\u662f\u200b\u7b80\u5355\u200b\u7684\u200b\u5c06\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\u7684\u200b\u6240\u6709\u200b\u62e6\u622a\u5668\u200b\u4e00\u4e00\u200b\u6267\u884c\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u89e6\u53d1\u200b\u5f53\u524d\u200b\u7684\u200b<code>method</code>\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u8fd9\u200b\u662f\u200b\u5f88\u200b\u7b80\u5355\u200b\u9ad8\u6548\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f46\u200b\u95ee\u9898\u200b\u662f\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u67d0\u4e9b\u200b\u589e\u5f3a\u200b\u6bd4\u5982\u200b<code>AfterReturningAdvice</code>\u200b\u80fd\u591f\u200b\u5728\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u5b8c\u624d\u200b\u88ab\u200b\u6267\u884c\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e0d\u540c\u200b\u589e\u5f3a\u200b\u7684\u200b\u6267\u884c\u200b\u987a\u5e8f\u200b\u7684\u200b\u95ee\u9898\u200b\u4e86\u200b\u3002</p> <p>\u200b\u800c\u200b<code>MethodInvocation</code>\u200b\u663e\u7136\u200b\u6ca1\u6709\u200b\u8003\u8651\u200b\u987a\u5e8f\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e00\u4e2a\u200b<code>AfterReturningAdvice</code>\u200b\u5f88\u200b\u53ef\u80fd\u200b\u5728\u200b<code>BeforeAdvice</code>\u200b\u4e4b\u524d\u200b\u88ab\u200b\u8c03\u7528\u200b\u3002\u200b\u90a3\u4e48\u200b\u8be5\u200b\u5982\u4f55\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\u95ee\u9898\u200b\u5462\u200b\uff1f</p> <p>\u200b\u7b54\u6848\u200b\u662f\u200b\uff0c\u200b\u63a7\u5236\u200b\u589e\u5f3a\u200b\u7684\u200b\u8c03\u7528\u200b\u987a\u5e8f\u200b\u5176\u5b9e\u200b\u7531\u200b\u6bcf\u4e2a\u200b\u62e6\u622a\u5668\u200b\u8d1f\u8d23\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5206\u6790\u200b<code>MethodBeforeAdviceInterceptor</code>\u200b\u548c\u200b<code>AfterReturningAdviceInterceptor</code></p> Java<pre><code>public class MethodBeforeAdviceInterceptor implements MethodInterceptor, BeforeAdvice {\n\n    private MethodBeforeAdvice advice;\n\n    public MethodBeforeAdviceInterceptor() {\n    }\n\n    public MethodBeforeAdviceInterceptor(MethodBeforeAdvice advice) {\n        this.advice = advice;\n    }\n\n    public void setAdvice(MethodBeforeAdvice advice) {\n        this.advice = advice;\n    }\n\n    @Override\n    public Object invoke(MethodInvocation mi) throws Throwable {\n        this.advice.before(mi.getMethod(), mi.getArguments(), mi.getThis());\n        return mi.proceed();\n    }\n}\n</code></pre> Java<pre><code>public class AfterReturningAdviceInterceptor implements MethodInterceptor, AfterAdvice {\n\n    private AfterReturningAdvice advice;\n\n    public AfterReturningAdviceInterceptor() {\n    }\n\n    public AfterReturningAdviceInterceptor(AfterReturningAdvice advice) {\n        this.advice = advice;\n    }\n\n    @Override\n    public Object invoke(MethodInvocation methodInvocation) throws Throwable {\n       Object retVal = methodInvocation.proceed();\n       this.advice.afterReturning(retVal, methodInvocation.getMethod(), methodInvocation.getArguments(), methodInvocation.getThis());\n       return retVal;\n    }\n}\n</code></pre> <p>\u200b\u770b\u200b\u4e86\u200b\u6e90\u7801\u200b\u5927\u5bb6\u200b\u5e94\u8be5\u200b\u5c31\u200b\u6e05\u695a\u200b\u4e86\u200b\uff0c\u200b\u62e6\u622a\u5668\u200b\u94fe\u200b\u6267\u884c\u200b\u7684\u200b\u987a\u5e8f\u200b\u6b63\u65f6\u200b\u5728\u200b\u5404\u4e2a\u200b\u62e6\u622a\u5668\u200b\u7684\u200b<code>invoke</code>\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002<code>before</code>\u200b\u4f1a\u5148\u200b\u6267\u884c\u200b<code>advice</code>\u200b\u589e\u5f3a\u200b\u65b9\u6cd5\u200b\u518d\u200b\u94fe\u5f0f\u200b\u8c03\u7528\u200b\uff0c\u200b\u800c\u200b<code>after</code>\u200b\u5219\u200b\u662f\u200b\u5148\u200b\u6267\u884c\u200b\u94fe\u5f0f\u200b\u8c03\u7528\u200b\uff0c\u200b\u518d\u200b\u8c03\u7528\u200b<code>advice</code>\u200b\u589e\u5f3a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u9012\u5f52\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u3002\u200b\u548c\u200b\u4e8c\u53c9\u6811\u200b\u7684\u200b\u904d\u5386\u200b\u6709\u4e9b\u200b\u5f02\u66f2\u540c\u5de5\u200b\u4e4b\u200b\u5904\u200b\u3002</p> <p></p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#_1","title":"\u6d4b\u8bd5","text":"Java<pre><code>@Before\npublic void setup() {\n    WorldService worldService = new WorldServiceImpl();\n    advisedSupport = new ProxyFactory();\n    //Advisor\u200b\u662f\u200bPointcut\u200b\u548c\u200bAdvice\u200b\u7684\u200b\u7ec4\u5408\u200b\n    String expression = \"execution(* test.aop.bean.WorldService.explode(..))\";\n    AspectJExpressionPointcutAdvisor advisor = new AspectJExpressionPointcutAdvisor();\n    advisor.setExpression(expression);\n    AfterReturningAdviceInterceptor methodInterceptor = new AfterReturningAdviceInterceptor(new WorldServiceAfterReturnAdvice());\n    advisor.setAdvice(methodInterceptor);\n    TargetSource targetSource = new TargetSource(worldService);\n    advisedSupport.setTargetSource(targetSource);\n    advisedSupport.addAdvisor(advisor);\n}\n\n@Test\npublic void testBeforeAdvice() throws Exception {\n    //\u200b\u8bbe\u7f6e\u200bBeforeAdvice\n    String expression = \"execution(* test.aop.bean.WorldService.explode(..))\";\n    AspectJExpressionPointcutAdvisor advisor = new AspectJExpressionPointcutAdvisor();\n    advisor.setExpression(expression);\n    MethodBeforeAdviceInterceptor methodInterceptor = new MethodBeforeAdviceInterceptor(new WorldServiceBeforeAdvice());\n    advisor.setAdvice(methodInterceptor);\n    advisedSupport.addAdvisor(advisor);\n    ProxyFactory factory = (ProxyFactory) advisedSupport;\n    WorldService proxy = (WorldService) factory.getProxy();\n    proxy.explode();\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#pointcutadvisorpointcutadvice","title":"PointcutAdvisor\uff1aPointcut\u200b\u548c\u200bAdvice\u200b\u7684\u200b\u7ec4\u5408","text":"<p><code>Advisor</code>\u200b\u662f\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b<code>Pointcut</code>\u200b\u548c\u200b\u4e00\u4e2a\u200b<code>Advice</code>\u200b\u7684\u200b\u7ec4\u5408\u200b\uff0c<code>Pointcut</code>\u200b\u7528\u4e8e\u200b\u6355\u83b7\u200b<code>JoinPoint</code>\uff0c<code>Advice</code>\u200b\u51b3\u5b9a\u200b\u5728\u200b<code>JoinPoint</code>\u200b\u6267\u884c\u200b\u67d0\u79cd\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u652f\u6301\u200b<code>aspectj</code>\u200b\u8868\u8fbe\u5f0f\u200b\u7684\u200b<code>AspectJExpressionPointcutAdvisor</code>\u3002</p> Java<pre><code>public class DynamicProxyTest {\n\n    @Test\n    public void testAdvisor() throws Exception {\n        WorldService worldService = new WorldServiceImpl();\n\n        //Advisor\u200b\u662f\u200bPointcut\u200b\u548c\u200bAdvice\u200b\u7684\u200b\u7ec4\u5408\u200b\n        String expression = \"execution(* org.springframework.test.service.WorldService.explode(..))\";\n        AspectJExpressionPointcutAdvisor advisor = new AspectJExpressionPointcutAdvisor();\n        advisor.setExpression(expression);\n        MethodBeforeAdviceInterceptor methodInterceptor = new MethodBeforeAdviceInterceptor(new WorldServiceBeforeAdvice());\n        advisor.setAdvice(methodInterceptor);\n\n        ClassFilter classFilter = advisor.getPointcut().getClassFilter();\n        if (classFilter.matches(worldService.getClass())) {\n            AdvisedSupport advisedSupport = new AdvisedSupport();\n            TargetSource targetSource = new TargetSource(worldService);\n            advisedSupport.setTargetSource(targetSource);\n            advisedSupport.setMethodInterceptor((MethodInterceptor) advisor.getAdvice());\n            advisedSupport.setMethodMatcher(advisor.getPointcut().getMethodMatcher());\n//          advisedSupport.setProxyTargetClass(true);   //JDK or CGLIB\n\n            WorldService proxy = (WorldService) new ProxyFactory(advisedSupport).getProxy();\n            proxy.explode();\n        }\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#bean","title":"\u52a8\u6001\u200b\u4ee3\u7406\u200b\u878d\u5165\u200bBean\u200b\u7684\u200b\u751f\u547d\u5468\u671f","text":"<p><code>BeanPostProcessor</code>\u200b\u5904\u7406\u200b\u9636\u6bb5\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u548c\u200b\u66ff\u6362\u200b<code>bean</code>\uff0c\u200b\u6b63\u597d\u200b\u53ef\u4ee5\u200b\u5728\u200b\u6b64\u200b\u9636\u6bb5\u200b\u8fd4\u56de\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u66ff\u6362\u200b\u539f\u200b\u5bf9\u8c61\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u6211\u4eec\u200b\u5f15\u5165\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u7684\u200b<code>BeanPostProcessor</code>\u2014\u2014<code>InstantiationAwareBeanPostProcessor</code>\uff0c\u200b\u7ec7\u5165\u200b\u903b\u8f91\u200b\u4f4d\u4e8e\u200b<code>BeanPostProcessor#postProcessAfterInitialization</code>\uff0c\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u67e5\u770b\u200b<code>AbstractAutowireCapableBeanFactory#resolveBeforeInstantiation</code>\u3002</p> <p><code>DefaultAdvisorAutoProxyCreator</code>\u200b\u662f\u200b\u5904\u7406\u200b\u6a2a\u5207\u200b\u903b\u8f91\u200b\u7684\u200b\u7ec7\u5165\u200b\u8fd4\u56de\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b<code>InstantiationAwareBeanPostProcessor</code>\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\uff0c\u200b\u5f53\u200b\u5bf9\u8c61\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u65f6\u200b\uff0c\u200b\u751f\u6210\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u8fd4\u56de\u200b\u3002</p> <p>\u200b\u81f3\u6b64\u200b\uff0cbean\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u5982\u4e0b\u200b </p> <p></p> <ol> <li>\u200b\u8bfb\u53d6\u200bxml\u200b\u6587\u4ef6\u200b</li> <li>load beandefinition</li> <li>BeanFactoryProcessor \u200b\u4fee\u6539\u200b BeanDefinition</li> <li>InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation</li> <li>bean\u200b\u5b9e\u4f8b\u200b\u5316\u200b</li> <li>BeanFactoryAware(setBeanFactory, setBeanName, setBeanClassLoader)</li> <li>BeanPostProcessor\u200b\u524d\u7f6e\u200b\u5904\u7406\u200b (\u200b\u4f8b\u200b\uff1aApplicationContextAwareProcessor)</li> <li>\u200b\u6267\u884c\u200b bean \u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u65b9\u6cd5\u200b<ol> <li>InitializingBean#afterPropertiesSet</li> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u521d\u59cb\u5316\u200b\u65b9\u6cd5\u200binit-method</li> </ol> </li> <li>BeanPostProcessor\u200b\u540e\u7f6e\u200b\u5904\u7406\u200b(InstantiationAwareBeanPostProcessor#postProcessAfterInitialization\u200b\u521b\u5efa\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u8fd4\u56de\u200b)</li> <li>\u200b\u5982\u679c\u200b\u662f\u200bDisposableBean\u200b\u6ce8\u518c\u200b\u9500\u6bc1\u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u5224\u65ad\u200bscope<ol> <li>\u200b\u5982\u679c\u200b\u662f\u200bsingleton\uff0c\u200b\u653e\u5165\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200bprototype\uff0c\u200b\u8fc7\u200b</li> </ol> </li> <li>\u200b\u4f7f\u7528\u200b</li> <li>\u200b\u6267\u884c\u200bbean\u200b\u7684\u200b\u9500\u6bc1\u200b\u65b9\u6cd5\u200b(singleton\uff09<ol> <li>DisposableBean#destroy</li> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u9500\u6bc1\u200b\u65b9\u6cd5\u200bdestroy-metod</li> </ol> </li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#enableaspectjautoproxy","title":"@EnableAspectJAutoProxy","text":"<p>\u200b\u5728\u200b<code>spring</code>\u200b\u4e2d\u200b\u6211\u4eec\u200b\u8981\u200b\u5f00\u542f\u200b\u81ea\u52a8\u200b\u4ee3\u7406\u200b\u7684\u200b\u529f\u80fd\u200b\u9700\u8981\u200b\u5728\u200b\u914d\u7f6e\u200b\u7c7b\u200b\u6dfb\u52a0\u200b\u5982\u4e0b\u200b\u7684\u200b\u6ce8\u89e3\u200b\uff1a</p> Java<pre><code>@EnableAspectJAutoProxy\npublic class AppConfiguration {}\n</code></pre> <p>\u200b\u5f53\u7136\u200b\u5728\u200b<code>xml</code>\u200b\u4e2d\u200b\u914d\u7f6e\u200b\u4e5f\u200b\u53ef\u200b\uff1a</p> XML<pre><code>&lt;aop:aspectj-autoproxy /&gt;\n</code></pre> <p>\u200b\u6ce8\u89e3\u200b\u6e90\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> Java<pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Import(AspectJAutoProxyRegistrar.class)\npublic @interface EnableAspectJAutoProxy {\n\n    boolean proxyTargetClass() default false;\n\n    boolean exposeProxy() default false;\n\n}\n</code></pre> <p>\u200b\u5728\u200b\u8be5\u200b\u6ce8\u89e3\u200b\u4e2d\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b<code>proxyTargetClass</code>\u200b\u548c\u200b<code>exposeProxy</code>\u200b\u4e24\u4e2a\u200b\u91cd\u8981\u200b\u5c5e\u6027\u200b\uff0c\u200b\u5b83\u4eec\u200b\u5206\u522b\u200b\u63a7\u5236\u200b\u7740\u200bSpring\u200b\u5982\u4f55\u200b\u521b\u5efa\u200b\u548c\u200b\u4f7f\u7528\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u6765\u200b\u5b9e\u73b0\u200b\u5207\u9762\u200b\u529f\u80fd\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#proxytargetclass","title":"proxyTargetClass","text":"<p>\u200b\u7528\u4e8e\u200b\u6307\u793a\u200b<code>Spring AOP</code>\u200b\u5e94\u200b\u4f7f\u7528\u200b\u54ea\u200b\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u4ee3\u7406\u200b\u6765\u7ec7\u5165\u200b\u5207\u9762\u200b\uff1a</p> <ul> <li><code>proxyTargetClass = true</code>: \u200b\u6307\u793a\u200bSpring\u200b\u4f7f\u7528\u200b<code>CGLIB</code>\u200b\u5e93\u200b\u751f\u6210\u200b\u57fa\u4e8e\u200b\u7c7b\u200b\u7684\u200b\u4ee3\u7406\u200b\u3002\u200b\u8fd9\u200b\u610f\u5473\u7740\u200bSpring\u200b\u4f1a\u200b\u521b\u5efa\u200b\u76ee\u6807\u200b\u7c7b\u200b\u7684\u200b\u5b50\u7c7b\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u5176\u4e2d\u200b\u63d2\u5165\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\u3002\u200b\u8fd9\u79cd\u200b\u4ee3\u7406\u200b\u65b9\u5f0f\u200b\u53ef\u4ee5\u200b\u62e6\u622a\u200b\u7c7b\u200b\u7684\u200b\u6240\u6709\u200b\u65b9\u6cd5\u200b\uff08\u200b\u5305\u62ec\u200b\u975e\u200b\u63a5\u53e3\u200b\u65b9\u6cd5\u200b\u548c\u200bfinal\u200b\u65b9\u6cd5\u200b\uff09\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u90a3\u4e9b\u200b\u6ca1\u6709\u200b\u63a5\u53e3\u200b\u6216\u8005\u200b\u9700\u8981\u200b\u5bf9\u975e\u200b\u516c\u5171\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u589e\u5f3a\u200b\u7684\u200b\u573a\u666f\u200b\u3002</li> <li><code>proxyTargetClass = false \u200b\u6216\u200b\u672a\u6307\u5b9a\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\uff09</code>: Spring\u200b\u5c06\u200b\u4f7f\u7528\u200b\u6807\u51c6\u200b\u7684\u200bJDK\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u6280\u672f\u200b\uff0c\u200b\u5373\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u76ee\u6807\u200b\u7c7b\u200b\u6240\u6709\u200b\u63a5\u53e3\u200b\u7684\u200b\u65b0\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u4e2d\u200b\u63d2\u5165\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u4ec5\u80fd\u200b\u7528\u4e8e\u200b\u4ee3\u7406\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u81f3\u5c11\u200b\u4e00\u4e2a\u200b\u63a5\u53e3\u200b\u7684\u200b\u76ee\u6807\u200b\u7c7b\u200b\uff0c\u200b\u4e14\u200b\u53ea\u80fd\u200b\u62e6\u622a\u200b\u901a\u8fc7\u200b\u63a5\u53e3\u200b\u58f0\u660e\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#exposeproxy","title":"exposeProxy","text":"<p>\u200b\u7528\u4e8e\u200b\u63a7\u5236\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u662f\u5426\u200b\u5e94\u200b\u88ab\u200b\u516c\u5f00\u200b\u7ed9\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8bbf\u95ee\u200b\uff1a</p> <ul> <li> <p><code>exposeProxy = true</code>: \u200b\u5f53\u200b\u8bbe\u7f6e\u200b\u4e3a\u200btrue\u200b\u65f6\u200b\uff0c<code>Spring</code>\u200b\u4f1a\u200b\u786e\u4fdd\u200b\u5728\u200bAOP\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>AopContext.currentProxy()</code> \u200b\u65b9\u6cd5\u200b\u80fd\u591f\u200b\u83b7\u53d6\u200b\u5230\u200b\u5f53\u524d\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u3002 \u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u5728\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u5185\u90e8\u200b\u9700\u8981\u200b\u8c03\u7528\u200b\u81ea\u8eab\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u5e0c\u671b\u200b\u8fd9\u4e9b\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u4e5f\u200b\u80fd\u200b\u89e6\u53d1\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\u7684\u200b\u60c5\u51b5\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002 \u200b\u4f8b\u5982\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u200b\u7c7b\u4e2d\u200b\u7684\u200b\u67d0\u4e2a\u200b\u65b9\u6cd5\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8c03\u7528\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u79c1\u6709\u200b\u6216\u200b\u53d7\u200b\u4fdd\u62a4\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u88ab\u200b\u540c\u4e00\u4e2a\u200b\u5207\u9762\u200b\u6240\u200b\u589e\u5f3a\u200b\u3002\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u82e5\u200b\u4e0d\u200b\u66b4\u9732\u200b\u4ee3\u7406\u200b\uff0c\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u5c06\u200b\u4e0d\u4f1a\u200b\u7ecf\u8fc7\u200b\u5207\u9762\u200b\u5904\u7406\u200b\uff1b\u200b\u800c\u200b\u66b4\u9732\u200b\u4ee3\u7406\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>AopContext.currentProxy().methodToCall()</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u786e\u4fdd\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u4e5f\u200b\u5f97\u5230\u200b\u5207\u9762\u200b\u7684\u200b\u62e6\u622a\u200b\u3002</p> </li> <li> <p><code>exposeProxy = false \u200b\u6216\u200b\u672a\u6307\u5b9a\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\uff09</code>\uff1a \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>Spring</code>\u200b\u4e0d\u4f1a\u200b\u7279\u522b\u200b\u66b4\u9732\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u5185\u90e8\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b <code>this</code> \u200b\u8c03\u7528\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u5c06\u200b\u4e0d\u4f1a\u200b\u89e6\u53d1\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u76ee\u6807\u200b\u7c7b\u200b\u7684\u200b\u539f\u59cb\u200b\u65b9\u6cd5\u200b\u3002</p> </li> </ul> <p>\u200b\u5173\u4e8e\u200b exposeProxy\uff0c\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b (\u200b\u6211\u200b\u7684\u200b IM \u200b\u9879\u76ee\u200b\u4e2d\u200b\u7528\u5230\u200b\u4e86\u200b)</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u6bb5\u200b\u5904\u7406\u200b\u597d\u53cb\u200b\u7533\u8bf7\u200b\u7684\u200b\u4e1a\u52a1\u200b\u903b\u8f91\u200b</p> Java<pre><code>/**\n * \u200b\u7533\u8bf7\u200b\u597d\u53cb\u200b\n * @param uid     uid\n * @param request \u200b\u8bf7\u6c42\u200b\n * @return {@link RestBean}\n */\n@Transactional\n@Override\n@RedissonLock(key = \"#uid\")\npublic RestBean&lt;Void&gt; apply(Long uid, FriendApplyReq request) {\n    // \u200b\u4e0d\u80fd\u200b\u6dfb\u52a0\u200b\u81ea\u5df1\u200b\u4e3a\u200b\u597d\u53cb\u200b\n    if (Objects.equals(uid, request.getTargetUid())) {\n        return RestBean.failure(FriendErrorEnum.SELF_APPLY_FORBIDDEN);\n    }\n    // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u597d\u53cb\u200b\u5173\u7cfb\u200b\n    UserFriend isFriend = userFriendDao.getByFriend(uid, request.getTargetUid());\n    // \u200b\u5df2\u7ecf\u200b\u5b58\u5728\u200b\u597d\u53cb\u200b\u5173\u7cfb\u200b\n    if (Objects.nonNull(isFriend)) {\n        return RestBean.failure(FriendErrorEnum.ALREADY_FRIENDS);\n    }\n    // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u7533\u8bf7\u200b\u8bb0\u5f55\u200b \uff08\u200b\u6211\u200b -&gt; \u200b\u5bf9\u65b9\u200b\uff09 \u200b\u4e14\u200b \u200b\u7533\u8bf7\u200b\u72b6\u6001\u200b\u4e3a\u200b \u200b\u5f85\u200b\u5ba1\u6279\u200b\n    UserApply myFriendApply = userApplyDao.getFriendApply(uid, request.getTargetUid());\n    // \u200b\u5b58\u5728\u200b\u7533\u8bf7\u200b\n    if (Objects.nonNull(myFriendApply)) {\n        return RestBean.failure(FriendErrorEnum.EXISTS_FRIEND_APPLY);\n    }\n    // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u7533\u8bf7\u200b\u8bb0\u5f55\u200b (\u200b\u5bf9\u65b9\u200b -&gt; \u200b\u6211\u200b)\n    UserApply friendApply = userApplyDao.getFriendApply(request.getTargetUid(), uid);\n    // \u200b\u5982\u679c\u200b\u5b58\u5728\u200b\uff0c\u200b\u76f4\u63a5\u200b\u540c\u610f\u200b\n    if (Objects.nonNull(friendApply)) {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u6267\u884c\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4ee3\u7406\u200b\u5b9e\u4f8b\u200b(\u200b\u786e\u4fdd\u200b\u4e8b\u52a1\u200b\u6b63\u786e\u200b\u6267\u884c\u200b)\uff0c\u200b\u540c\u610f\u200b\u7533\u8bf7\u200b\n        ((FriendService) AopContext.currentProxy()).applyApprove(uid, new FriendApplyApproveReq(friendApply.getId()));\n        return RestBean.success();\n    }\n    UserApply userApply = FriendAdapter.buildFriendApply(uid, request);\n    userApplyDao.save(userApply);\n    // \u200b\u7528\u6237\u200b\u7533\u8bf7\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u5411\u200b\u5bf9\u65b9\u200b\u5f02\u6b65\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u6d88\u606f\u200b\n    applicationEventPublisher.publishEvent(new UserApplyEvent(this, userApply));\n    return RestBean.success();\n}\n</code></pre> <p>\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u5904\u7406\u200b \u200b\u5982\u679c\u200b\u7533\u8bf7\u200b\u8bb0\u5f55\u200b(\u200b\u5bf9\u65b9\u200b-&gt;\u200b\u6211\u200b)\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u540c\u610f\u200b\u7533\u8bf7\u200b \u200b\u7684\u200b\u5904\u7406\u200b\u903b\u8f91\u200b </p> <p>\u200b\u8fd9\u200b\u4e00\u884c\u200b\u4ee3\u7801\u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b\u786e\u4fdd\u200b\u4e8b\u52a1\u200b\u548c\u200b\u5176\u4ed6\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\uff08\u200b\u5982\u200b <code>@Transactional</code> \u200b\u548c\u200b <code>@RedissonLock</code>\uff09\u200b\u5728\u200b\u8c03\u7528\u200b <code>applyApprove</code> \u200b\u65b9\u6cd5\u200b\u65f6\u200b\u80fd\u591f\u200b\u751f\u6548\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u4ee3\u7406\u200b\u8c03\u7528\u200b\uff1f</p> <ul> <li>\u200b\u4e8b\u52a1\u200b\u4f20\u64ad\u200b\u95ee\u9898\u200b\uff1a<ul> <li>\u200b\u5728\u200b Spring \u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u7c7b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u540c\u7c7b\u200b\u7684\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\uff08\u200b\u6bd4\u5982\u200b <code>apply</code> \u200b\u8c03\u7528\u200b <code>this.applyApprove</code>\uff09\uff0cSpring \u200b\u7684\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u4e0d\u4f1a\u200b\u751f\u6548\u200b\u3002</li> <li>\u200b\u8fd9\u4f1a\u200b\u5bfc\u81f4\u200b <code>applyApprove</code> \u200b\u65b9\u6cd5\u200b\u4e0a\u200b\u7684\u200b\u4e8b\u52a1\u200b\u6ce8\u89e3\u200b <code>@Transactional</code> \u200b\u88ab\u200b\u5ffd\u7565\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u529f\u80fd\u200b\u5931\u6548\u200b\u3002</li> </ul> </li> <li>\u200b\u4ee3\u7406\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff1a<ul> <li>\u200b\u4f7f\u7528\u200b <code>AopContext.currentProxy()</code> \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7c7b\u200b\u7684\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u3002</li> <li>\u200b\u901a\u8fc7\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u8c03\u7528\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e8b\u52a1\u200b\u548c\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\u751f\u6548\u200b\u3002</li> </ul> </li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#aop_1","title":"AOP \u200b\u751f\u6210\u200b\u4ee3\u7406\u200b\u7684\u200b\u4e09\u4e2a\u200b\u65f6\u673a","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#beforeinstantiation","title":"\u5b9e\u4f8b\u200b\u5316\u524d\u200b(BeforeInstantiation)","text":"<p>\u200b\u8bb2\u9053\u7406\u200b\u4e00\u822c\u200b\u4e0d\u7528\u200b</p> <p>\u200b\u5177\u4f53\u200b\u65f6\u673a\u200b\u5728\u200b <code>createBean</code> \u200b\u65b9\u6cd5\u200b\u4e0a\u534a\u200b\u90e8\u5206\u200b <code>#resolveBeforeInstantiation</code>\uff0c\u200b\u5982\u679c\u200b <code>Bean</code> \u200b\u5728\u200b \u200b\u5b9e\u4f8b\u200b\u5316\u524d\u200b \u200b\u88ab\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u4e86\u200b\uff0c\u200b\u5224\u65ad\u200b <code>Bean</code> \u200b\u662f\u5426\u200b\u4e3a\u200b <code>null</code>\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u4e3a\u200b <code>null</code>\uff0c\u200b\u5219\u200b\u77ed\u8def\u200b\u5e76\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b</p> <p>\u200b\u65e0\u200b\u4ee3\u7406\u200b\u5219\u200b\u8fdb\u5165\u200b\u4e0b\u200b\u534a\u200b\u90e8\u5206\u200b <code>doCreateBean</code></p> Java<pre><code>/**\n * Apply before-instantiation post-processors, resolving whether there is a\n * before-instantiation shortcut for the specified bean.\n * @param beanName the name of the bean\n * @param mbd the bean definition for the bean\n * @return the shortcut-determined bean instance, or {@code null} if none\n */\n@SuppressWarnings(\"deprecation\")\n@Nullable\nprotected Object resolveBeforeInstantiation(String beanName, RootBeanDefinition mbd) {\n    Object bean = null;\n    if (!Boolean.FALSE.equals(mbd.beforeInstantiationResolved)) {\n        // Make sure bean class is actually resolved at this point.\n        if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) {\n            Class&lt;?&gt; targetType = determineTargetType(beanName, mbd);\n            if (targetType != null) {\n                bean = applyBeanPostProcessorsBeforeInstantiation(targetType, beanName);\n                if (bean != null) {\n                    bean = applyBeanPostProcessorsAfterInitialization(bean, beanName);\n                }\n            }\n        }\n        mbd.beforeInstantiationResolved = (bean != null);\n    }\n    return bean;\n}\n</code></pre> Java<pre><code>@Override\npublic Object postProcessBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) {\n    // \u200b\u7f13\u5b58\u200b\u4ee3\u7406\u200b\n    Object cacheKey = getCacheKey(beanClass, beanName);\n\n    if (!StringUtils.hasLength(beanName) || !this.targetSourcedBeans.contains(beanName)) {\n        if (this.advisedBeans.containsKey(cacheKey)) {\n            return null;\n        }\n        if (isInfrastructureClass(beanClass) || shouldSkip(beanClass, beanName)) {\n            this.advisedBeans.put(cacheKey, Boolean.FALSE);\n            return null;\n        }\n    }\n\n    // \u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u6709\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200bTargetSource\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b\u521b\u5efa\u200b\u4ee3\u7406\u200b\u3002\n    // \u200b\u6291\u5236\u200b\u76ee\u6807\u200bbean\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5c31\u662f\u8bf4\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u914d\u7f6e\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u6309\u7167\u200b\u539f\u6709\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fdb\u884c\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u4e86\u200b\n    // TargetSource\u200b\u5c06\u200b\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u65b9\u5f0f\u200b\u5904\u7406\u200b\u76ee\u6807\u200b\u5b9e\u4f8b\u200b\u3002\n    TargetSource targetSource = getCustomTargetSource(beanClass, beanName);\n    if (targetSource != null) {\n        if (StringUtils.hasLength(beanName)) {\n            this.targetSourcedBeans.add(beanName);\n        }\n        Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(beanClass, beanName, targetSource);\n        Object proxy = createProxy(beanClass, beanName, specificInterceptors, targetSource);\n        this.proxyTypes.put(cacheKey, proxy.getClass());\n        return proxy;\n    }\n\n    return null;\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#afterinitialization","title":"\u521d\u59cb\u5316\u200b\u540e\u200b(AfterInitialization)","text":"<p>\u200b\u5177\u4f53\u200b\u65f6\u673a\u200b\u5728\u200b <code>Bean</code> \u200b\u5b9e\u4f8b\u200b\u5316\u200b\u4e4b\u540e\u200b\uff0c\u200b\u586b\u5145\u200b\u5c5e\u6027\u200b\u5b8c\u6bd5\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5728\u200b\u8c03\u7528\u200b <code>initializeBean</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200b\u5b50\u200b\u65b9\u6cd5\u200b <code>applyBeanPostProcessorsAfterInitialization</code>, \u200b\u5373\u200b BeanPostProcessor\u200b\u7684\u200b\u540e\u7f6e\u200b\u65b9\u6cd5\u200b</p> <p>\u200b\u539f\u7406\u200b\u53ef\u4ee5\u200b\u770b\u200b\u4ee5\u4e0b\u200b\u8fd9\u4e2a\u200b\u7c7b\u56fe\u200b\uff0cAOP\u200b\u4ee3\u7406\u200b\u7684\u200b\u6838\u5fc3\u200b\u7c7b\u200b <code>AutoProxyCreator</code> \u200b\u5747\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>BeanPostProcessor</code> \u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b</p> <p></p> Java<pre><code>/**\n * Create a proxy with the configured interceptors if the bean is\n * identified as one to proxy by the subclass.\n * @see #getAdvicesAndAdvisorsForBean\n */\n@Override\n@Nullable\npublic Object postProcessAfterInitialization(@Nullable Object bean, String beanName) {\n    if (bean != null) {\n        Object cacheKey = getCacheKey(bean.getClass(), beanName);\n        if (this.earlyBeanReferences.remove(cacheKey) != bean) {\n            return wrapIfNecessary(bean, beanName, cacheKey);\n        }\n    }\n    return bean;\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-AOP/#_2","title":"\u5faa\u574f\u200b\u4f9d\u8d56","text":"<p>\u200b\u5982\u679c\u200b\u5f00\u542f\u200b\u4e86\u200b\u5faa\u73af\u200b\u5f15\u7528\u200b\uff0c\u200b\u5728\u200b\u5b58\u5728\u200b\u5faa\u73af\u200b\u5f15\u7528\u200b\u95ee\u9898\u200b\u65f6\u200b\uff0c\u200b\u4ece\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200bbean\u200b\u7684\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65e9\u671f\u200b\u5f15\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u80fd\u200b\u4e3a\u200b\u5176\u200b\u751f\u6210\u200b\u4ee3\u7406\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7684\u200b\u903b\u8f91\u200b\u548c\u200b\u4e0a\u8fb9\u200b\u4e00\u6837\u200b</p> <p>\u200b\u5728\u200b <code>doCreateBean</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b</p> Java<pre><code>// \u200b\u5904\u7406\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u5c06\u200b\u5b9e\u4f8b\u200b\u5316\u540e\u200b\u7684\u200bBean\u200b\u5bf9\u8c61\u200b\u63d0\u524d\u200b\u653e\u5165\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u66b4\u9732\u200b\u51fa\u6765\u200b\nif (beanDefinition.isSingleton()) {\n    Object finalBean = bean;\n    addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, beanDefinition, finalBean));\n}\n</code></pre> Java<pre><code>protected Object getEarlyBeanReference(String beanName, BeanDefinition beanDefinition, Object bean) {\n    Object exposedObject = bean;\n    for (BeanPostProcessor beanPostProcessor : getBeanPostProcessors()) {\n        if (beanPostProcessor instanceof InstantiationAwareBeanPostProcessor) {\n            exposedObject = ((InstantiationAwareBeanPostProcessor) beanPostProcessor).getEarlyBeanReference(exposedObject, beanName);\n            if (null == exposedObject) return exposedObject;\n        }\n    }\n</code></pre> Java<pre><code>@Override\npublic Object getEarlyBeanReference(Object bean, String beanName) {\n    earlyProxyReferences.add(beanName);\n    return wrapIfNecessary(bean, beanName);\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/","title":"Spring IOC \u200b\u5bb9\u5668","text":"<p> \u200b\u7ea6\u200b 953 \u200b\u4e2a\u200b\u5b57\u200b  29 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 4 \u200b\u5206\u949f\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#1-ioc","title":"1. \u200b\u4ec0\u4e48\u200b\u662f\u200b IOC\uff1f","text":"<p>IOC\uff08Inversion of Control\uff0c\u200b\u63a7\u5236\u200b\u53cd\u8f6c\u200b\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u8bbe\u8ba1\u200b\u601d\u60f3\u200b\uff0c\u200b\u5e7f\u6cdb\u5e94\u7528\u200b\u4e8e\u200b\u73b0\u4ee3\u200b\u6846\u67b6\u200b\u4e2d\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b Spring\u3002IOC \u200b\u7684\u200b\u6838\u5fc3\u7406\u5ff5\u200b\u662f\u200b\u901a\u8fc7\u200b\u5bb9\u5668\u200b\u7ba1\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u521b\u5efa\u200b\u548c\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7684\u200b\u89e3\u200b\u8026\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#11","title":"1.1 \u200b\u63a7\u5236\u200b\u4e0e\u200b\u53cd\u8f6c","text":"<ul> <li>\u200b\u63a7\u5236\u200b\uff1a\u200b\u63a7\u5236\u200b\u7684\u200b\u662f\u200b\u5bf9\u8c61\u200b\u7684\u200b\u521b\u5efa\u200b\u8fc7\u7a0b\u200b\u548c\u200b\u4f9d\u8d56\u200b\u7684\u200b\u7ba1\u7406\u200b\u3002</li> <li>\u200b\u53cd\u8f6c\u200b\uff1a\u200b\u53cd\u8f6c\u200b\u7684\u200b\u662f\u200b\u5bf9\u8c61\u200b\u521b\u5efa\u200b\u7684\u200b\u63a7\u5236\u6743\u200b\uff0c\u200b\u7531\u200b\u7a0b\u5e8f\u5458\u200b\u624b\u52a8\u200b\u521b\u5efa\u5bf9\u8c61\u200b\uff0c\u200b\u8f6c\u53d8\u200b\u4e3a\u200b\u7531\u200b\u5bb9\u5668\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u548c\u200b\u7ba1\u7406\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#12-di","title":"1.2 \u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\uff08DI\uff09","text":"<p>IOC \u200b\u7684\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u662f\u200b \u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\uff08Dependency Injection, DI\uff09\uff1a</p> <ul> <li>\u200b\u4f9d\u8d56\u200b\uff1a\u200b\u6307\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u9700\u8981\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u6765\u200b\u5b8c\u6210\u200b\u5176\u200b\u529f\u80fd\u200b\u3002</li> <li>\u200b\u6ce8\u5165\u200b\uff1a\u200b\u5bb9\u5668\u200b\u8d1f\u8d23\u200b\u5c06\u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\u5230\u200b\u5bf9\u8c61\u200b\u4e2d\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7531\u200b\u5bf9\u8c61\u200b\u81ea\u5df1\u200b\u53bb\u200b\u5bfb\u627e\u200b\u4f9d\u8d56\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#2-ioc","title":"2. \u200b\u4e3a\u4ec0\u4e48\u200b\u9700\u8981\u200b IOC\uff1f","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#21","title":"2.1 \u200b\u4f20\u7edf\u200b\u5f00\u53d1\u200b\u4e2d\u200b\u7684\u200b\u95ee\u9898","text":"<p>\u200b\u5728\u200b\u4f20\u7edf\u200b\u5f00\u53d1\u200b\u4e2d\u200b\uff0c\u200b\u7a0b\u5e8f\u5458\u200b\u9700\u8981\u200b\u81ea\u5df1\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\u548c\u200b\u7ba1\u7406\u200b\u5bf9\u8c61\u200b\uff1a</p> <ul> <li>\u200b\u5bf9\u8c61\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5f3a\u200b\u8026\u5408\u200b\u5bfc\u81f4\u7cfb\u7edf\u200b\u96be\u4ee5\u200b\u7ef4\u62a4\u200b\u548c\u200b\u6269\u5c55\u200b\u3002</li> <li>\u200b\u5bf9\u8c61\u200b\u4f9d\u8d56\u200b\u7684\u200b\u521b\u5efa\u200b\u903b\u8f91\u200b\u5206\u6563\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4ee3\u7801\u200b\u5197\u4f59\u200b\u3002</li> <li>\u200b\u96be\u4ee5\u200b\u5355\u5143\u6d4b\u8bd5\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u9690\u85cf\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#22-ioc","title":"2.2 IOC \u200b\u7684\u200b\u4f18\u52bf","text":"<ul> <li>\u200b\u89e3\u200b\u8026\u200b\uff1a\u200b\u901a\u8fc7\u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\u5b9e\u73b0\u200b\u6a21\u5757\u200b\u95f4\u200b\u7684\u200b\u4f4e\u200b\u8026\u5408\u200b\u3002</li> <li>\u200b\u7edf\u4e00\u200b\u7ba1\u7406\u200b\uff1a\u200b\u7531\u200b\u5bb9\u5668\u200b\u96c6\u4e2d\u7ba1\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u548c\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u3002</li> <li>\u200b\u6613\u200b\u6d4b\u8bd5\u200b\uff1a\u200b\u901a\u8fc7\u200b\u6ce8\u5165\u200b Mock \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u5355\u5143\u6d4b\u8bd5\u200b\u3002</li> <li>\u200b\u7075\u6d3b\u200b\u6269\u5c55\u200b\uff1a\u200b\u9ad8\u5c42\u200b\u6a21\u5757\u200b\u4e0d\u200b\u4f9d\u8d56\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u66ff\u6362\u200b\u6216\u200b\u6269\u5c55\u200b\u529f\u80fd\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#3-spring-ioc","title":"3. Spring IOC \u200b\u5bb9\u5668\u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#31","title":"3.1 \u200b\u5bb9\u5668\u200b\u7684\u200b\u5b9a\u4e49","text":"<p>Spring \u200b\u7684\u200b IOC \u200b\u5bb9\u5668\u200b\u662f\u200b\u4e00\u4e2a\u200b Bean \u200b\u5de5\u5382\u200b\uff1a</p> <ul> <li>\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7ba1\u7406\u200b Bean \u200b\u5b9a\u4e49\u200b\u548c\u200b\u751f\u547d\u5468\u671f\u200b\u7684\u200b\u6846\u67b6\u200b\u3002</li> <li>\u200b\u5bb9\u5668\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u4f1a\u200b\u6839\u636e\u200b\u914d\u7f6e\u200b\u52a0\u8f7d\u200b Bean \u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5e76\u200b\u8d1f\u8d23\u200b\u521b\u5efa\u200b\u3001\u200b\u521d\u59cb\u5316\u200b\u548c\u200b\u7ba1\u7406\u200b\u8fd9\u4e9b\u200b Bean\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#32-bean","title":"3.2 Bean \u200b\u7684\u200b\u751f\u547d\u5468\u671f","text":"<ol> <li>\u200b\u5b9a\u4e49\u200b\uff1a\u200b\u901a\u8fc7\u200b XML \u200b\u6587\u4ef6\u200b\u3001\u200b\u6ce8\u89e3\u200b\u6216\u200b Java \u200b\u914d\u7f6e\u200b\u7c7b\u200b\u5b9a\u4e49\u200b Bean\u3002</li> <li>\u200b\u5b9e\u4f8b\u200b\u5316\u200b\uff1a\u200b\u5bb9\u5668\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\u6839\u636e\u200b\u5b9a\u4e49\u200b\u521b\u5efa\u200b Bean \u200b\u5b9e\u4f8b\u200b\u3002</li> <li>\u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\uff1a\u200b\u5bb9\u5668\u200b\u5c06\u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\u5230\u200b Bean \u200b\u4e2d\u200b\u3002</li> <li>\u200b\u521d\u59cb\u5316\u200b\uff1a\u200b\u8c03\u7528\u200b\u521d\u59cb\u5316\u200b\u65b9\u6cd5\u200b\uff08\u200b\u5982\u200b <code>@PostConstruct</code>\uff09\u3002</li> <li>\u200b\u4f7f\u7528\u200b\uff1aBean \u200b\u51c6\u5907\u5c31\u7eea\u200b\uff0c\u200b\u53ef\u200b\u88ab\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4f7f\u7528\u200b\u3002</li> <li>\u200b\u9500\u6bc1\u200b\uff1a\u200b\u5bb9\u5668\u200b\u5173\u95ed\u200b\u65f6\u200b\uff0c\u200b\u8c03\u7528\u200b\u9500\u6bc1\u200b\u65b9\u6cd5\u200b\uff08\u200b\u5982\u200b <code>@PreDestroy</code>\uff09\u3002</li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#33","title":"3.3 \u200b\u5355\u4f8b\u200b\u4e0e\u200b\u4f5c\u7528\u57df","text":"<ul> <li>\u200b\u5355\u4f8b\u200b\u4f5c\u7528\u57df\u200b\uff08\u200b\u9ed8\u8ba4\u200b\uff09\uff1a\u200b\u5bb9\u5668\u200b\u53ea\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b Bean \u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u6240\u6709\u200b\u8bf7\u6c42\u200b\u5171\u4eab\u200b\u8be5\u200b\u5b9e\u4f8b\u200b\u3002</li> <li>\u200b\u5176\u4ed6\u200b\u4f5c\u7528\u57df\u200b\uff1a\u200b\u5982\u200b\u539f\u578b\u200b\u4f5c\u7528\u57df\u200b\uff08\u200b\u6bcf\u6b21\u200b\u8bf7\u6c42\u200b\u521b\u5efa\u200b\u65b0\u200b\u5b9e\u4f8b\u200b\uff09\u3001\u200b\u4f1a\u8bdd\u200b\u4f5c\u7528\u57df\u200b\u3001\u200b\u8bf7\u6c42\u200b\u4f5c\u7528\u57df\u200b\u7b49\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#4-ioc-dip","title":"4. IOC \u200b\u4e0e\u200b\u4f9d\u8d56\u200b\u5012\u7f6e\u200b\u539f\u5219\u200b\uff08DIP\uff09","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#41","title":"4.1 \u200b\u4ec0\u4e48\u200b\u662f\u200b\u4f9d\u8d56\u200b\u5012\u7f6e\u200b\u539f\u5219\u200b\uff1f","text":"<p>\u200b\u4f9d\u8d56\u200b\u5012\u7f6e\u200b\u539f\u5219\u200b\uff08Dependency Inversion Principle, DIP\uff09 \u200b\u662f\u200b\u9762\u5411\u5bf9\u8c61\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\u7684\u200b\u91cd\u8981\u200b\u539f\u5219\u200b\uff1a</p> <ul> <li>\u200b\u9ad8\u5c42\u200b\u6a21\u5757\u200b\u4e0d\u200b\u4f9d\u8d56\u4e8e\u200b\u4f4e\u5c42\u200b\u6a21\u5757\u200b\uff0c\u200b\u800c\u662f\u200b\u4f9d\u8d56\u4e8e\u200b\u62bd\u8c61\u200b\u63a5\u53e3\u200b\u3002</li> <li>\u200b\u4f4e\u5c42\u200b\u6a21\u5757\u200b\u5b9e\u73b0\u200b\u62bd\u8c61\u200b\u63a5\u53e3\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#42-ioc-dip","title":"4.2 IOC \u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b DIP\uff1f","text":"<p>Spring \u200b\u7684\u200b IOC \u200b\u5bb9\u5668\u200b\u5929\u7136\u200b\u652f\u6301\u200b\u4f9d\u8d56\u200b\u5012\u7f6e\u200b\u539f\u5219\u200b\uff1a</p> <ul> <li>\u200b\u9ad8\u5c42\u200b\u6a21\u5757\u200b\u53ea\u200b\u4f9d\u8d56\u200b\u63a5\u53e3\u200b\uff08\u200b\u62bd\u8c61\u200b\uff09\u3002</li> <li>\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u7531\u200b\u5bb9\u5668\u200b\u6ce8\u5165\u200b\u5230\u200b\u9ad8\u5c42\u200b\u6a21\u5757\u200b\u4e2d\u200b\u3002</li> <li>\u200b\u901a\u8fc7\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u6a21\u5757\u200b\u4e4b\u95f4\u200b\u7684\u200b\u89e3\u200b\u8026\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#5-ioc","title":"5. \u200b\u793a\u4f8b\u200b\uff1a\u200b\u4ece\u200b\u4ee3\u7801\u200b\u89d2\u5ea6\u200b\u7406\u89e3\u200b IOC","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#51","title":"5.1 \u200b\u4f20\u7edf\u200b\u5b9e\u73b0","text":"Java<pre><code>public class UserService {\n    private UserRepository userRepository = new UserRepository(); // \u200b\u624b\u52a8\u200b\u521b\u5efa\u5bf9\u8c61\u200b\n\n    public void registerUser(User user) {\n        userRepository.save(user);\n    }\n}\n</code></pre> <p>\u200b\u95ee\u9898\u200b\uff1a</p> <ul> <li><code>UserService</code> \u200b\u548c\u200b <code>UserRepository</code> \u200b\u5f3a\u200b\u8026\u5408\u200b\u3002</li> <li>\u200b\u66f4\u6362\u200b <code>UserRepository</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u4fee\u6539\u200b\u4ee3\u7801\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#52-ioc","title":"5.2 IOC \u200b\u5b9e\u73b0","text":"<p>\u200b\u5b9a\u4e49\u200b\u63a5\u53e3\u200b\u548c\u200b\u5b9e\u73b0\u200b</p> Java<pre><code>public interface UserRepository {\n    void save(User user);\n}\n\npublic class JdbcUserRepository implements UserRepository {\n    public void save(User user) {\n        // \u200b\u4f7f\u7528\u200b JDBC \u200b\u4fdd\u5b58\u200b\u7528\u6237\u200b\n    }\n}\n</code></pre> <p>\u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b</p> Java<pre><code>@Service\npublic class UserService {\n    private final UserRepository userRepository;\n\n    @Autowired\n    public UserService(UserRepository userRepository) {\n        this.userRepository = userRepository; // \u200b\u5bb9\u5668\u200b\u6ce8\u5165\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\n    }\n\n    public void registerUser(User user) {\n        userRepository.save(user);\n    }\n}\n</code></pre> <p>\u200b\u4f18\u52bf\u200b\uff1a</p> <ul> <li><code>UserService</code> \u200b\u53ea\u200b\u4f9d\u8d56\u200b <code>UserRepository</code> \u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f4e\u200b\u8026\u5408\u200b\u3002</li> <li>\u200b\u66ff\u6362\u200b\u5b9e\u73b0\u200b\u65f6\u200b\uff0c\u200b\u53ea\u200b\u9700\u200b\u66f4\u6539\u200b\u914d\u7f6e\u200b\uff0c\u200b\u4e0d\u9700\u200b\u4fee\u6539\u200b\u4ee3\u7801\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-IOC/#6-ioc","title":"6. IOC \u200b\u7684\u200b\u597d\u5904\u200b\u603b\u7ed3","text":"<ol> <li>\u200b\u89e3\u200b\u8026\u200b\uff1a\u200b\u6a21\u5757\u200b\u4e4b\u95f4\u200b\u901a\u8fc7\u200b\u63a5\u53e3\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u5f7b\u5e95\u200b\u89e3\u200b\u8026\u200b\u3002</li> <li>\u200b\u7edf\u4e00\u200b\u7ba1\u7406\u200b\uff1a\u200b\u5bb9\u5668\u200b\u8d1f\u8d23\u7ba1\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u521b\u5efa\u200b\u548c\u200b\u751f\u547d\u5468\u671f\u200b\u3002</li> <li>\u200b\u7075\u6d3b\u6027\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u968f\u65f6\u200b\u66f4\u6362\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u589e\u5f3a\u200b\u4ee3\u7801\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\u548c\u200b\u6269\u5c55\u6027\u200b\u3002</li> <li>\u200b\u6d4b\u8bd5\u200b\u65b9\u4fbf\u200b\uff1a\u200b\u901a\u8fc7\u200b\u6ce8\u5165\u200b Mock \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u5355\u5143\u6d4b\u8bd5\u200b\u3002</li> <li>\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\uff1a\u200b\u901a\u8fc7\u200b\u5355\u4f8b\u200b\u6a21\u5f0f\u200b\u51cf\u5c11\u200b\u5185\u5b58\u200b\u6296\u52a8\u200b\u548c\u200b GC \u200b\u538b\u529b\u200b\u3002</li> <li>\u200b\u53ef\u9760\u6027\u200b\uff1a\u200b\u542f\u52a8\u200b\u65f6\u200b\u53d1\u73b0\u200b\u95ee\u9898\u200b\uff0c\u200b\u63d0\u5347\u200b\u5e94\u7528\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u3002</li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/","title":"Spring MVC","text":"<p> \u200b\u7ea6\u200b 2586 \u200b\u4e2a\u200b\u5b57\u200b  734 \u200b\u884c\u200b\u4ee3\u7801\u200b  8 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 18 \u200b\u5206\u949f\u200b</p> <p>\u200b\u6ce8\u610f\u200b</p> <p>\u200b\u6587\u7ae0\u200b\u4e2d\u200b\u7684\u200b\u4ee3\u7801\u200b\u5927\u90e8\u5206\u200b\u4e3a\u200b\u6211\u200b\u7684\u200b\u9879\u76ee\u200b Simple-Spring \u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u975e\u7eaf\u200b\u6e90\u7801\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#springmvc","title":"SpringMVC\u200b\u539f\u7406","text":"<p>\u200b\u6839\u636e\u200b\u4e0a\u200b\u56fe\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5f97\u77e5\u200bSpring MVC\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u7528\u6237\u200b\uff08\u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u5373\u200b\u6d4f\u89c8\u5668\u200b\uff09\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u81f3\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b\uff08DispatcherServlet\uff09</li> <li>\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b\u6536\u5230\u200b\u8bf7\u6c42\u200b\u540e\u8c03\u200b\u2f64\u200b\u5904\u7406\u5668\u200b\u6620\u5c04\u5668\u200b\uff08HandlerMapping\uff09</li> <li>\u200b\u5904\u7406\u5668\u200b\u6620\u5c04\u5668\u200b\u6839\u636e\u200b\u8bf7\u6c42\u200bUrl\u200b\u627e\u5230\u200b\u5177\u4f53\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff08Handler\uff0c\u200b\u4e5f\u200b\u53eb\u200b\u540e\u200b\u7aef\u200b\u63a7\u5236\u5668\u200b\uff09\uff0c\u200b\u751f\u6210\u200b\u5904\u7406\u5668\u200b\u5bf9\u8c61\u200b\u53ca\u200b\u5904\u7406\u5668\u200b\u62e6\u622a\u5668\u200b\uff08\u200b\u5982\u679c\u200b\u6709\u200b\uff09\u200b\u4e00\u5e76\u200b\u8fd4\u56de\u200b\u7ed9\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b</li> <li>\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b\u6536\u5230\u200b\u5904\u7406\u5668\u200b\u5bf9\u8c61\u200b\u53ca\u200b\u5904\u7406\u5668\u200b\u62e6\u622a\u5668\u200b\uff08\u200b\u5982\u679c\u200b\u6709\u200b\uff09\u200b\u540e\u200b\u8c03\u7528\u200b\u5904\u7406\u5668\u200b\u9002\u914d\u5668\u200b\uff08HandlerAdapter\uff09\u200b\u53bb\u200b\u8c03\u7528\u200b\u5904\u7406\u5668\u200bHandler</li> <li>\u200b\u5904\u7406\u5668\u200b\u9002\u914d\u5668\u200b\u6267\u884c\u200b\u5904\u7406\u5668\u200b</li> <li>\u200b\u5904\u7406\u5668\u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u7ed9\u200b\u5904\u7406\u5668\u200b\u9002\u914d\u5668\u200b\u8fd4\u56de\u200bModelAndView</li> <li>\u200b\u5904\u7406\u5668\u200b\u9002\u914d\u5668\u200b\u5c06\u200bModelAndView\uff08ModelAndView\u200b\u662f\u200bSpringMVC\u200b\u6846\u67b6\u200b\u7684\u200b\u2f00\u200b\u4e2a\u200b\u5e95\u5c42\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5305\u62ec\u200b Model \u200b\u548c\u200b View\uff09\u200b\u8fd4\u56de\u200b\u7ed9\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b</li> <li>\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u63a5\u6536\u200b\u5230\u200bModelAndView\u200b\u540e\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u89c6\u56fe\u200b\u89e3\u6790\u5668\u200b\uff08ViewResolver\uff09\u200b\u53bb\u200b\u8fdb\u200b\u2f8f\u200b\u89c6\u56fe\u200b\u89e3\u6790\u200b\uff0c\u200b\u6839\u636e\u200b\u903b\u8f91\u200b\u89c6\u56fe\u200b\u540d\u6765\u200b\u89e3\u6790\u200b\u771f\u6b63\u200b\u7684\u200b\u89c6\u56fe\u200b</li> <li>\u200b\u89c6\u56fe\u200b\u89e3\u6790\u5668\u200b\u5c06\u200b\u89e3\u6790\u200b\u5b8c\u200b\u7684\u200bView\u200b\u8fd4\u56de\u200b\u7ed9\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b</li> <li>\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b\u8fdb\u200b\u2f8f\u200b\u89c6\u56fe\u200b\u6e32\u67d3\u200b\uff0c\u200b\u5c31\u662f\u200b\u5c06\u200b\u6a21\u578b\u200b\u6570\u636e\u200b\uff08\u200b\u5728\u200b ModelAndView \u200b\u5bf9\u8c61\u200b\u4e2d\u200b\uff09\u200b\u586b\u5145\u200b\u5230\u200b request \u200b\u57df\u200b</li> <li>\u200b\u524d\u7aef\u200b\u63a7\u5236\u5668\u200b\u5411\u200b\u2f64\u200b\u6237\u200b\u54cd\u5e94\u200b\u7ed3\u679c\u200b</li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#web","title":"\u52a8\u6001\u200b\u6ce8\u518c\u200bWeb\u200b\u7ec4\u4ef6","text":"<p>\u200b\u901a\u5e38\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8981\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200bWeb\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u9700\u8981\u200b\u9759\u6001\u200b\u5730\u200b\u5728\u200b\u9879\u76ee\u200b\u8def\u5f84\u200b\u4e0b\u200b\u914d\u7f6e\u200b <code>webapp/WEB-INF/web.xml</code> \u200b\u6587\u4ef6\u200b</p> <p>\u200b\u90a3\u4e48\u200b Spring \u200b\u662f\u200b\u600e\u4e48\u200b\u505a\u5230\u200b\u4e0d\u200b\u4f7f\u7528\u200b<code>web.xml</code>\uff0c\u200b\u800c\u662f\u200b\u901a\u8fc7\u200b Java \u200b\u6ce8\u89e3\u200b\u65b9\u5f0f\u200b\u6765\u200b\u52a8\u6001\u200b\u5730\u200b\u5b9e\u73b0\u200b Web \u200b\u548c\u200b Mvc\u200b\u7684\u200b\u5462\u200b\uff1f</p> <p>\u200b\u5148\u200b\u7ed9\u51fa\u200b\u7b54\u6848\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\u52a8\u6001\u200b\u914d\u7f6e\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#webapplicationinitializer","title":"\u5b9e\u73b0\u200b WebApplicationInitializer \u200b\u63a5\u53e3","text":"Java<pre><code>public class WebInitializer implements WebApplicationInitializer{\n@Override\npublic void onStartup(ServletContext servletContext) throws ServletException {}\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#abstractannotationconfigdispatcherservletinitializer","title":"\u7ee7\u627f\u200b AbstractAnnotationConfigDispatcherServletInitializer","text":"Java<pre><code>public class WebMvcInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_1","title":"\u5bb9\u5668\u200b\u542f\u52a8","text":"<p>\u200b\u4e0a\u8ff0\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\u4ec5\u4ec5\u200b\u662f\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u52a8\u6001\u200b\u914d\u7f6e\u200b\uff0c\u200b\u800c\u200b\u5bfc\u5165\u200b\u8be5\u200b\u914d\u7f6e\u200b\u7684\u200b\u5177\u4f53\u4f4d\u7f6e\u200b\u5728\u200b <code>org.springframework.web.SpringServletContainerInitializer#onStartup</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5373\u200b\u4e3a\u200b Web\u200b\u5bb9\u5668\u200b\u521d\u59cb\u5316\u200b\u5e76\u200b\u542f\u52a8\u200b \u200b\u7684\u200b\u6e90\u5934\u200b\u3002</p> Java<pre><code>@HandlesTypes({WebApplicationInitializer.class})\npublic class SpringServletContainerInitializer implements ServletContainerInitializer {\n    public void onStartup(Set&lt;Class&lt;?&gt;&gt; webAppInitializerClasses, ServletContext servletContext) throws ServletException {\n        ...\n    }\n}     \n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#servletcontainerinitializer","title":"ServletContainerInitializer","text":"<p><code>ServletContainerInitializer</code> \u200b\u662f\u200b Servlet 3.0 \u200b\u89c4\u8303\u200b\u4e2d\u200b\u5f15\u5165\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b Web \u200b\u5e94\u7528\u200b\u542f\u52a8\u200b\u65f6\u200b\u52a8\u6001\u200b\u53d1\u73b0\u200b\u548c\u200b\u6ce8\u518c\u200b Servlet\u3001Filter \u200b\u548c\u200b Listener\u3002\u200b\u8be5\u200b\u63a5\u53e3\u200b\u7684\u200b\u4f5c\u7528\u200b\u662f\u200b\u5728\u200b Web \u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u63a5\u6536\u200b\u7b26\u5408\u200b\u7279\u5b9a\u6761\u4ef6\u200b\u7684\u200b\u7c7b\u200b\u96c6\u5408\u200b\uff0c\u200b\u5e76\u200b\u53ef\u4ee5\u200b\u57fa\u4e8e\u200b\u8fd9\u4e9b\u200b\u7c7b\u200b\u6267\u884c\u200b\u4e00\u4e9b\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u63a5\u53e3\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> Java<pre><code>/**\n * ServletContainerInitializers (SCIs) are registered via an entry in the\n * file META-INF/services/javax.servlet.ServletContainerInitializer that must be\n * included in the JAR file that contains the SCI implementation.\n * &lt;p&gt;\n * SCI processing is performed regardless of the setting of metadata-complete.\n * SCI processing can be controlled per JAR file via fragment ordering. If\n * absolute ordering is defined, then only the JARs included in the ordering\n * will be processed for SCIs. To disable SCI processing completely, an empty\n * absolute ordering may be defined.\n * &lt;p&gt;\n * SCIs register an interest in annotations (class, method or field) and/or\n * types via the {@link javax.servlet.annotation.HandlesTypes} annotation which\n * is added to the class.\n *\n * @since Servlet 3.0\n */\npublic interface ServletContainerInitializer {\n\n    /**\n     * Receives notification during startup of a web application of the classes\n     * within the web application that matched the criteria defined via the\n     * {@link javax.servlet.annotation.HandlesTypes} annotation.\n     *\n     * @param c     The (possibly null) set of classes that met the specified\n     *              criteria\n     * @param ctx   The ServletContext of the web application in which the\n     *              classes were discovered\n     *\n     * @throws ServletException If an error occurs\n     */\n    void onStartup(Set&lt;Class&lt;?&gt;&gt; c, ServletContext ctx) throws ServletException;\n}\n</code></pre> <p>\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>ServletContainerInitializer</code> \u200b\u63a5\u53e3\u200b\u7684\u200b\u7c7b\u200b\u5fc5\u987b\u200b\u5728\u200b\u4e00\u4e2a\u200b JAR \u200b\u5305\u4e2d\u200b\u7684\u200b <code>META-INF/services/javax.servlet.ServletContainerInitialize</code>r \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u6ce8\u518c\u200b\u3002\u200b\u8be5\u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\u5e94\u8be5\u200b\u5305\u542b\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u7684\u200b\u5168\u200b\u9650\u5b9a\u200b\u540d\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> Text Only<pre><code>org.springframework.web.SpringServletContainerInitializer\n</code></pre> <p>\u200b\u8fd9\u79cd\u200b\u6ce8\u518c\u200b\u673a\u5236\u200b\u5229\u7528\u200b\u4e86\u200b JDK \u200b\u7684\u200b SPI\uff08Service Provider Interface\uff09\u200b\u673a\u5236\u200b\uff0c\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u65f6\u4f1a\u200b\u81ea\u52a8\u200b\u52a0\u8f7d\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4ece\u4e2d\u200b\u8bfb\u53d6\u200b\u5e76\u200b\u52a0\u8f7d\u200b\u76f8\u5e94\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u7c7b\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8ba9\u200b <code>ServletContainerInitializer</code> \u200b\u80fd\u591f\u200b\u63a5\u6536\u200b\u5230\u200b\u7b26\u5408\u6761\u4ef6\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b <code>@HandlesTypes</code> \u200b\u6ce8\u89e3\u200b\u6765\u200b\u6807\u660e\u200b\u8be5\u7c7b\u200b\u9700\u8981\u200b\u5904\u7406\u200b\u7684\u200b\u7c7b\u578b\u200b\u3002</p> <p><code>@HandlesTypes</code> \u200b\u6ce8\u89e3\u200b\u7684\u200b <code>value</code> \u200b\u5c5e\u6027\u200b\u63a5\u6536\u200b\u4e00\u4e2a\u200b\u7c7b\u200b\u6570\u7ec4\u200b\uff0c\u200b\u6307\u5b9a\u200b\u54ea\u4e9b\u200b\u7c7b\u578b\u200b\u7684\u200b\u7c7b\u4f1a\u200b\u88ab\u200b\u6ce8\u5165\u200b\u5230\u200b <code>onStartup</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u3002</p> Java<pre><code>@HandlesTypes\n@Target({ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface HandlesTypes {\n    Class[] value();\n}   \n</code></pre> <p>\u200b\u5728\u200b Spring \u200b\u6e90\u7801\u200b\u4e2d\u200b\u5bfc\u5165\u200b\u7684\u200b\u662f\u200b\u52a8\u6001\u200b\u914d\u7f6e\u200b\u7c7b\u200b <code>WebApplicationInitializer</code></p> Java<pre><code>@HandlesTypes(WebApplicationInitializer.class)\n</code></pre> <p>Servlet 3.0+ \u200b\u5bb9\u5668\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u53bb\u200b\u626b\u63cf\u200b <code>classpath</code> \u200b\u4e0b\u200b\u6240\u6709\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>WebApplicationInitializer</code> \u200b\u63a5\u53e3\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u76f8\u5173\u200b\u7c7b\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>An INFO-level log message will be issued notifying the user</code>\uff0c\u200b\u4f1a\u200b\u6709\u200b\u4e00\u6761\u200bINFO\u200b\u7ea7\u522b\u200b \u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u627e\u5230\u200b\u4e86\u200b\u591a\u4e2a\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\uff0c\u200b\u90a3\u4e48\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u5b9e\u4f8b\u200b\u5316\u200b\uff0c\u200b\u5982\u679c\u200b\u5b9e\u73b0\u200b\u4e86\u200b<code>org.springframework.core.Ordered</code> \u200b\u63a5\u53e3\u200b\u6216\u8005\u200b\u6dfb\u52a0\u200b\u4e86\u200b <code>@Order</code> \u200b\u6ce8\u89e3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\u6765\u200b\u3002</p> Java<pre><code>@Override\npublic void onStartup(@Nullable Set&lt;Class&lt;?&gt;&gt; webAppInitializerClasses, ServletContext servletContext)\n        throws ServletException {\n\n    List&lt;WebApplicationInitializer&gt; initializers = Collections.emptyList();\n\n    if (webAppInitializerClasses != null) {\n        initializers = new ArrayList&lt;&gt;(webAppInitializerClasses.size());\n        for (Class&lt;?&gt; waiClass : webAppInitializerClasses) {\n            // Be defensive: Some servlet containers provide us with invalid classes,\n            // no matter what @HandlesTypes says...\n            if (!waiClass.isInterface() &amp;&amp; !Modifier.isAbstract(waiClass.getModifiers()) &amp;&amp;\n                    WebApplicationInitializer.class.isAssignableFrom(waiClass)) {\n                try {\n                    initializers.add((WebApplicationInitializer)\n                            ReflectionUtils.accessibleConstructor(waiClass).newInstance());\n                }\n                catch (Throwable ex) {\n                    throw new ServletException(\"Failed to instantiate WebApplicationInitializer class\", ex);\n                }\n            }\n        }\n    }\n\n    if (initializers.isEmpty()) {\n        servletContext.log(\"No Spring WebApplicationInitializer types detected on classpath\");\n        return;\n    }\n\n    servletContext.log(initializers.size() + \" Spring WebApplicationInitializers detected on classpath\");\n    AnnotationAwareOrderComparator.sort(initializers);\n    for (WebApplicationInitializer initializer : initializers) {\n        initializer.onStartup(servletContext);\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_2","title":"\u521d\u59cb\u5316","text":"<p>Spring MVC \u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b DispatcherServlet\uff0c\u200b\u521d\u59cb\u5316\u200b\u4e5f\u200b\u662f\u200b\u56f4\u7ed5\u200b\u5176\u200b\u5c55\u5f00\u200b\u7684\u200b\u3002\u200b\u7c7b\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>Servlet\u200b\u6807\u51c6\u200b\u5b9a\u4e49\u200b\u4e86\u200binit\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5176\u200b\u751f\u547d\u5468\u671f\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u65b9\u6cd5\u200b\u3002</p> <p><code>com.iflove.simplespring.webmvc.HttpServletBean#init</code></p> Java<pre><code>@Override\npublic final void init() throws ServletException {\n    // \u200b\u6e90\u7801\u200b\u91cc\u9762\u200b\u8bbe\u7f6e\u200b\u4e86\u200b ServletConfigPropertyValues\n    // \u200b\u6682\u65f6\u200b\u4e0d\u200b\u505a\u200b\u5b9e\u73b0\u200b\n\n    // Let subclasses do whatever initialization they like.\n    initServletBean();\n}\n</code></pre> <p>\u200b\u4e3b\u8981\u200b\u903b\u8f91\u200b\u4e00\u76ee\u4e86\u7136\u200b\u3002\u200b\u6ce8\u610f\u200b\u6e90\u7801\u200b\u4e2d\u200bsetPropertyValues\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5bf9\u200bDispatcherServlet\u200b\u76f8\u5173\u200bsetter\u200b\u65b9\u6cd5\u200b\u7684\u200b\u8c03\u7528\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f53\u200b\u8fdb\u884c\u200b\u5bb9\u5668\u200b\u521d\u59cb\u5316\u200b\u65f6\u200b\u4ece\u200binit-param\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u53c2\u6570\u200b\u5df2\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u5230\u200bDispatcherServlet\u200b\u7684\u200b\u76f8\u5173\u200b\u5b57\u200b\u6bb5\u200b(Field)\u200b\u4e2d\u200b\uff0c\u200b\u9879\u76ee\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u5e76\u672a\u200b\u5b9e\u73b0\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_3","title":"\u5bb9\u5668\u200b\u521d\u59cb\u5316","text":"<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#initServletBean</code></p> Java<pre><code>@Override\nprotected void initServletBean() throws ServletException {\n    logger.info(\"Initializing Spring \" + getClass().getSimpleName() + \" '\" + getServletName() + \"'\");\n    logger.info(\"Initializing Servlet '\" + getServletName() + \"'\");\n\n    long startTime = System.currentTimeMillis();\n\n    // \u200b\u521d\u59cb\u5316\u200b Web IOC \u200b\u5bb9\u5668\u200b\n    this.webApplicationContext = initWebApplicationContext();\n    // \u200b\u9ed8\u8ba4\u200b\u7a7a\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4e14\u200b\u65e0\u200b\u5b50\u7c7b\u200b\u91cd\u5199\u200b\n    initFrameworkServlet();\n\n    logger.info(\"Completed initialization in \" + (System.currentTimeMillis() - startTime) + \" ms\");\n}\n</code></pre> <p><code>com.iflove.simplespring.webmvc.FrameworkServlet#initWebApplicationContext</code></p> Java<pre><code>protected WebApplicationContext initWebApplicationContext() {\n\n    WebApplicationContext rootContext = WebApplicationContextUtils.getWebApplicationContext(getServletContext());\n    WebApplicationContext wac = this.webApplicationContext;\n\n    if (wac instanceof ConfigurableWebApplicationContext) {\n        ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) wac;\n        if (cwac.getParent() == null) {\n            cwac.setParent(rootContext);\n        }\n        // \u200b\u914d\u7f6e\u200b\u4e0a\u4e0b\u6587\u200b\u5e76\u200b\u5237\u65b0\u200b\n        configureAndRefreshWebApplicationContext(cwac);\n    } else if (wac == null) {\n        // \u200b\u5bfb\u627e\u200b IOC \u200b\u5bb9\u5668\u200b\n        wac = findWebApplicationContext();\n    }\n\n    if (wac == null) {\n        // \u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b IOC \u200b\u5bb9\u5668\u200b\n        wac = createWebApplicationContext(rootContext);\n    }\n\n    // MVC \u200b\u521d\u59cb\u5316\u200b (\u200b\u7531\u200b DispatcherServlet \u200b\u5b9e\u73b0\u200b)\n    onRefresh(wac);\n\n    // \u200b\u5c06\u200b WebApplicationContext \u200b\u5b9e\u4f8b\u200b\u653e\u5165\u200b Servlet \u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\u5171\u4eab\u200b\n    String attrName = getServletContextAttributeName();\n    getServletContext().setAttribute(attrName, wac);\n\n    return wac;\n}\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u5206\u200b\u90e8\u5206\u200b\u89e3\u8bfb\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_4","title":"\u6839\u200b\u5bb9\u5668\u200b\u67e5\u627e","text":"<p>spring-mvc\u200b\u652f\u6301\u200bSpring\u200b\u5bb9\u5668\u200b\u4e0e\u200bMVC\u200b\u5bb9\u5668\u200b\u5171\u5b58\u200b\uff0c\u200b\u6b64\u65f6\u200b\uff0cSpring\u200b\u5bb9\u5668\u200b\u5373\u6839\u200b\u5bb9\u5668\u200b\uff0cmvc\u200b\u5bb9\u5668\u200b\u5c06\u200b\u6839\u200b\u5bb9\u5668\u200b\u89c6\u4e3a\u200b\u7236\u200b\u5bb9\u5668\u200b\u3002</p> <p>\u200b\u6839\u636e\u200bServlet\u200b\u89c4\u8303\u200b\uff0c\u200b\u5404\u200b\u7ec4\u4ef6\u200b\u7684\u200b\u52a0\u8f7d\u200b \u200b\u987a\u5e8f\u200b\u5982\u4e0b\u200b:</p> <p><code>listener -&gt; filter -&gt; servlet</code></p> <p><code>com.iflove.simplespring.webmvc.context.support.WebApplicationContextUtils#getWebApplicationContext(javax.servlet.ServletContext)</code></p> Java<pre><code>String ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE = WebApplicationContext.class.getName() + \".ROOT\";\npublic static WebApplicationContext getWebApplicationContext(ServletContext sc) {\n    return getWebApplicationContext(sc, WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);\n}\n</code></pre> <p>\u200b\u4e24\u200b\u53c2\u6570\u200b\u65b9\u6cd5\u200b:</p> <p><code>com.iflove.simplespring.webmvc.context.support.WebApplicationContextUtils#getWebApplicationContext(javax.servlet.ServletContext, java.lang.String)</code></p> Java<pre><code>public static WebApplicationContext getWebApplicationContext(ServletContext sc, String attrName) {\n    Object attr = sc.getAttribute(attrName);\n    if (attr == null) {\n        return null;\n    }\n    return (WebApplicationContext) attr;\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u5f97\u51fa\u7ed3\u8bba\u200b:</p> <p>\u200b\u5982\u679c\u200bSpring\u200b\u6839\u200b\u5bb9\u5668\u200b\u5b58\u5728\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u88ab\u200b\u4fdd\u5b58\u200b\u5728\u200bServletContext\u200b\u4e2d\u200b\uff0c\u200b\u5176\u200bkey\u200b\u4e3a\u200b<code>WebApplicationContext.class.getName() + \".ROOT\"</code>\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_5","title":"\u5bb9\u5668\u200b\u521b\u5efa","text":"<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#createWebApplicationContext</code></p> Java<pre><code>protected WebApplicationContext createWebApplicationContext(ApplicationContext parent) {\n    // \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b IOC \u200b\u5bb9\u5668\u200b\n    ConfigurableWebApplicationContext wac = new AnnotationConfigWebApplicationContext();\n    // \u200b\u8bbe\u7f6e\u200b\u7236\u200b\u5bb9\u5668\u200b\n    wac.setParent(parent);\n    // \u200b\u914d\u7f6e\u200b\u4e0a\u4e0b\u6587\u200b\u5e76\u200b\u5237\u65b0\u200b\n    configureAndRefreshWebApplicationContext(wac);\n    return wac;\n}\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\uff1a\u200b\u8fd9\u91cc\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200bIOC\u200b\u5bb9\u5668\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b <code>AnnotationConfigWebApplicationContext</code>\uff0c\u200b\u800c\u200b Spring \u200b\u6e90\u7801\u200b\u4e2d\u4e3a\u200b <code>XmlWebApplicationContext</code></p> <p><code>configureAndRefreshWebApplicationContext</code>\u200b\u4e3b\u8981\u200b\u4f5c\u7528\u200b\u5373\u200b\u914d\u7f6e\u200bservlet\u200b\u4e0a\u4e0b\u6587\u200b\u5e76\u200b\u5237\u65b0\u200b\u5bb9\u5668\u200b</p> <p>\u200b\u6838\u5fc3\u200b\u6e90\u7801\u200b:</p> <p><code>com.iflove.simplespring.webmvc.FrameworkServlet#configureAndRefreshWebApplicationContext</code></p> Java<pre><code>protected void configureAndRefreshWebApplicationContext(ConfigurableWebApplicationContext wac) {\n    // \u200b\u914d\u7f6e\u200b servlet \u200b\u4e0a\u4e0b\u6587\u200b\n    wac.setServletContext(getServletContext());\n    wac.setServletConfig(getServletConfig());\n    // \u200b\u5237\u65b0\u200b\u5bb9\u5668\u200b\n    wac.refresh();\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#mvc","title":"MVC\u200b\u521d\u59cb\u5316","text":"<p>\u200b\u5165\u53e3\u200b\u4f4d\u4e8e\u200b<code>DispatcherServlet</code>\u200b\u7684\u200b<code>initStrategies</code>\u200b\u65b9\u6cd5\u200b(\u200b\u7ecf\u7531\u200b<code>onRefresh</code>\u200b\u8c03\u7528\u200b):</p> Java<pre><code>/**\n * mvc \u200b\u521d\u59cb\u5316\u200b(\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b)\n *\n * @param context the current WebApplicationContext\n */\n@Override\nprotected void onRefresh(ApplicationContext context) {\n    initStrategies(context);\n}\n\nprotected void initStrategies(ApplicationContext context) {\n    // \u200b\u521d\u59cb\u5316\u200b\u6587\u4ef6\u200b\u4e0a\u4f20\u200b\u89e3\u6790\u5668\u200b\uff08MultipartResolver\uff09\n    // \u200b\u7528\u4e8e\u200b\u89e3\u6790\u200b\u5305\u542b\u200b\u6587\u4ef6\u200b\u4e0a\u4f20\u200b\u7684\u200b multipart \u200b\u8bf7\u6c42\u200b\u3002Spring \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6807\u51c6\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5982\u200b\n    // CommonsMultipartResolver\uff08\u200b\u57fa\u4e8e\u200b Apache Commons FileUpload\uff09\u200b\u548c\u200b\n    // StandardServletMultipartResolver\uff08\u200b\u57fa\u4e8e\u200b Servlet 3.0 \u200b\u6807\u51c6\u200b\uff09\u3002\n    // \u200b\u5982\u679c\u200b\u9700\u8981\u200b\u652f\u6301\u200b\u6587\u4ef6\u200b\u4e0a\u4f20\u200b\u529f\u80fd\u200b\uff0c\u200b\u5219\u200b\u5fc5\u987b\u200b\u914d\u7f6e\u200b\u6b64\u200b\u89e3\u6790\u5668\u200b\u3002\n    // initMultipartResolver(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b\u533a\u57df\u200b\u89e3\u6790\u5668\u200b\uff08LocaleResolver\uff09\n    // \u200b\u7528\u4e8e\u200b\u89e3\u6790\u200b\u8bf7\u6c42\u200b\u7684\u200b\u533a\u57df\u200b\u4fe1\u606f\u200b\uff08Locale\uff09\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u56fd\u9645\u5316\u200b\u5e94\u7528\u200b\u4e2d\u200b\u63d0\u4f9b\u200b\u6b63\u786e\u200b\u7684\u200b\u8bed\u8a00\u200b\u548c\u200b\u683c\u5f0f\u200b\u3002\n    // \u200b\u5e38\u89c1\u200b\u7684\u200b\u5b9e\u73b0\u200b\u5305\u62ec\u200b CookieLocaleResolver \u200b\u548c\u200b SessionLocaleResolver\uff0c\n    // \u200b\u5b83\u4eec\u200b\u5206\u522b\u200b\u57fa\u4e8e\u200b Cookie \u200b\u6216\u200b Session \u200b\u5b58\u50a8\u200b\u548c\u200b\u89e3\u6790\u200b\u533a\u57df\u200b\u4fe1\u606f\u200b\u3002\n    // initLocaleResolver(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b\u4e3b\u9898\u200b\u89e3\u6790\u5668\u200b\uff08ThemeResolver\uff09\n    // \u200b\u7528\u4e8e\u200b\u652f\u6301\u200b Spring MVC \u200b\u7684\u200b\u4e3b\u9898\u200b\u529f\u80fd\u200b\u3002\u200b\u4e3b\u9898\u200b\u901a\u5e38\u200b\u7528\u6765\u200b\u6539\u53d8\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7684\u200b\u89c6\u89c9\u200b\u5916\u89c2\u200b\uff0c\u200b\u6bd4\u5982\u200b CSS \u200b\u6837\u5f0f\u200b\u3002\n    // \u200b\u5e38\u89c1\u200b\u5b9e\u73b0\u200b\u5305\u62ec\u200b FixedThemeResolver \u200b\u548c\u200b CookieThemeResolver\uff0c\n    // \u200b\u5b83\u4eec\u200b\u5206\u522b\u200b\u652f\u6301\u200b\u56fa\u5b9a\u200b\u4e3b\u9898\u200b\u548c\u200b\u57fa\u4e8e\u200b Cookie \u200b\u7684\u200b\u52a8\u6001\u200b\u4e3b\u9898\u200b\u5207\u6362\u200b\u3002\n    // initThemeResolver(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b\u8bf7\u6c42\u200b URL \u200b\u6620\u5c04\u5668\u200b\uff08HandlerMapping\uff09\n    // \u200b\u7528\u4e8e\u200b\u5c06\u200b\u8bf7\u6c42\u200b URL \u200b\u6620\u5c04\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff08Handler\uff09\u3002\n    // Spring MVC \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u591a\u79cd\u200b HandlerMapping \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5982\u200b\n    // - RequestMappingHandlerMapping\uff1a\u200b\u57fa\u4e8e\u200b @RequestMapping \u200b\u6ce8\u89e3\u200b\u7684\u200b\u6620\u5c04\u200b\u3002\n    // - SimpleUrlHandlerMapping\uff1a\u200b\u57fa\u4e8e\u200b XML \u200b\u6216\u200b Java \u200b\u914d\u7f6e\u200b\u7684\u200b\u9759\u6001\u200b\u6620\u5c04\u200b\u3002\n    // DispatcherServlet \u200b\u4f1a\u200b\u4ece\u200b HandlerMapping \u200b\u4e2d\u200b\u627e\u5230\u200b\u4e0e\u200b\u8bf7\u6c42\u200b\u5339\u914d\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u3002\n    initHandlerMappings(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b\u8bf7\u6c42\u200b\u9002\u914d\u5668\u200b\uff08HandlerAdapter\uff09\n    // \u200b\u7528\u4e8e\u200b\u5c06\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5904\u7406\u200b\u59d4\u6d3e\u200b\u7ed9\u200b\u5177\u4f53\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff08Handler\uff09\u3002\n    // HandlerAdapter \u200b\u901a\u8fc7\u200b\u591a\u6001\u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a\n    // - HttpRequestHandlerAdapter\uff1a\u200b\u652f\u6301\u200b\u5b9e\u73b0\u200b HttpRequestHandler \u200b\u63a5\u53e3\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u3002\n    // - SimpleControllerHandlerAdapter\uff1a\u200b\u652f\u6301\u200b\u5b9e\u73b0\u200b Controller \u200b\u63a5\u53e3\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u3002\n    // - RequestMappingHandlerAdapter\uff1a\u200b\u652f\u6301\u200b\u57fa\u4e8e\u200b @RequestMapping \u200b\u7684\u200b\u5904\u7406\u5668\u200b\u65b9\u6cd5\u200b\u3002\n    // DispatcherServlet \u200b\u4f1a\u200b\u6839\u636e\u200b\u5339\u914d\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u9009\u62e9\u200b\u9002\u5f53\u200b\u7684\u200b\u9002\u914d\u5668\u200b\u6267\u884c\u200b\u8bf7\u6c42\u200b\u3002\n    initHandlerAdapters(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b\u5f02\u5e38\u200b\u5904\u7406\u5668\u200b\uff08HandlerExceptionResolver\uff09\n    // \u200b\u7528\u4e8e\u200b\u6355\u83b7\u200b\u548c\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u629b\u51fa\u200b\u7684\u200b\u5f02\u5e38\u200b\u3002\n    // Spring MVC \u200b\u63d0\u4f9b\u200b\u9ed8\u8ba4\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5982\u200b\uff1a\n    // - ExceptionHandlerExceptionResolver\uff1a\u200b\u652f\u6301\u200b @ExceptionHandler \u200b\u6ce8\u89e3\u200b\u3002\n    // - ResponseStatusExceptionResolver\uff1a\u200b\u652f\u6301\u200b @ResponseStatus \u200b\u6ce8\u89e3\u200b\u3002\n    // - DefaultHandlerExceptionResolver\uff1a\u200b\u5904\u7406\u200b Spring \u200b\u5185\u90e8\u200b\u6807\u51c6\u200b\u5f02\u5e38\u200b\u3002\n    // \u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u5339\u914d\u200b\u7684\u200b\u5f02\u5e38\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u5f02\u5e38\u200b\u5c06\u200b\u88ab\u200b\u5bb9\u5668\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u9519\u8bef\u200b\u9875\u9762\u200b\u5904\u7406\u200b\u3002\n    // initHandlerExceptionResolvers(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b\u8bf7\u6c42\u200b\u5230\u200b\u89c6\u56fe\u200b\u540d\u79f0\u200b\u7684\u200b\u8f6c\u6362\u5668\u200b\uff08RequestToViewNameTranslator\uff09\n    // \u200b\u7528\u4e8e\u200b\u5728\u200b\u6ca1\u6709\u200b\u663e\u5f0f\u200b\u6307\u5b9a\u200b\u89c6\u56fe\u200b\u540d\u79f0\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4ece\u200b\u8bf7\u6c42\u200b\u8def\u5f84\u200b\u63a8\u65ad\u200b\u89c6\u56fe\u200b\u540d\u79f0\u200b\u3002\n    // \u200b\u9ed8\u8ba4\u200b\u5b9e\u73b0\u200b\u662f\u200b DefaultRequestToViewNameTranslator\uff0c\u200b\u5b83\u4f1a\u200b\u4ece\u200b URL \u200b\u4e2d\u200b\u63d0\u53d6\u200b\u8def\u5f84\u200b\u4f5c\u4e3a\u200b\u89c6\u56fe\u200b\u540d\u79f0\u200b\u3002\n    // \u200b\u4f8b\u5982\u200b\uff1a\u200b\u8bf7\u6c42\u200b `/user/profile` \u200b\u4f1a\u200b\u89e3\u6790\u200b\u4e3a\u200b\u89c6\u56fe\u200b\u540d\u79f0\u200b `user/profile`\u3002\n    // initRequestToViewNameTranslator(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b\u89c6\u56fe\u200b\u89e3\u6790\u5668\u200b\uff08ViewResolver\uff09\n    // \u200b\u7528\u4e8e\u200b\u5c06\u200b\u89c6\u56fe\u200b\u540d\u79f0\u200b\u89e3\u6790\u200b\u4e3a\u200b\u5177\u4f53\u200b\u7684\u200b\u89c6\u56fe\u200b\u5bf9\u8c61\u200b\uff08View\uff09\uff0c\u200b\u6bd4\u5982\u200b JSP\u3001Thymeleaf \u200b\u6216\u200b Freemarker\u3002\n    // \u200b\u5e38\u89c1\u200b\u7684\u200b\u5b9e\u73b0\u200b\u5305\u62ec\u200b\uff1aInternalResourceViewResolver\u3001ThymeleafViewResolver\u3002\n    // DispatcherServlet \u200b\u6839\u636e\u200b\u89e3\u6790\u200b\u540e\u200b\u7684\u200b\u89c6\u56fe\u200b\u5bf9\u8c61\u200b\u6e32\u67d3\u200b\u54cd\u5e94\u200b\u3002\n    // initViewResolvers(context);\n\n    // \u200b\u521d\u59cb\u5316\u200b Flash \u200b\u5c5e\u6027\u200b\u7ba1\u7406\u5668\u200b\uff08FlashMapManager\uff09\n    // \u200b\u7528\u4e8e\u200b\u5728\u200b\u8bf7\u6c42\u200b\u91cd\u5b9a\u5411\u200b\u65f6\u200b\uff0c\u200b\u5b58\u50a8\u200b\u548c\u200b\u4f20\u9012\u200b\u4e34\u65f6\u200b\u5c5e\u6027\u200b\uff08Flash \u200b\u5c5e\u6027\u200b\uff09\u3002\n    // Spring \u200b\u63d0\u4f9b\u200b\u9ed8\u8ba4\u200b\u5b9e\u73b0\u200b\uff1aDefaultFlashMapManager\uff0c\u200b\u57fa\u4e8e\u200b Session \u200b\u5b58\u50a8\u200b Flash \u200b\u5c5e\u6027\u200b\u3002\n    // Flash \u200b\u5c5e\u6027\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u4f20\u9012\u200b\u4e00\u6b21\u6027\u200b\u7684\u200b\u7528\u6237\u200b\u53cd\u9988\u200b\u6d88\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8868\u5355\u200b\u63d0\u4ea4\u200b\u540e\u200b\u7684\u200b\u6210\u529f\u200b\u63d0\u793a\u200b\u3002\n    // initFlashMapManager(context);\n}\n</code></pre> <p>\u200b\u6e90\u7801\u200b\u4e2d\u200b MVC\u200b\u521d\u59cb\u5316\u200b \u200b\u5b58\u5728\u200b\u591a\u4e2a\u200binit\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u7b80\u5316\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4ec5\u200b\u7ed9\u51fa\u200b2\u200b\u4e2a\u200b\u6838\u5fc3\u200b\u5b9e\u73b0\u200b</p> <p>\u200b\u663e\u7136\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u662f\u200bspring-mvc\u200b\u7684\u200b\u6838\u5fc3\u200b\u4e86\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#handlermapping","title":"HandlerMapping\u200b\u68c0\u67e5","text":"<p>initHandlerMappings\u200b\u65b9\u6cd5\u200b\u7528\u4e8e\u200b\u786e\u4fdd\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u81f3\u5c11\u200b\u542b\u6709\u200b\u4e00\u4e2a\u200bHandlerMapping\u200b\u5bf9\u8c61\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u5f00\u542f\u200b\u6ce8\u89e3\u200b\u9a71\u52a8\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c06\u4f1a\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\u7684\u200b<code>HandlerMapping</code>\uff0c\u200b\u76f8\u5173\u200b\u4ee3\u7801\u200b:</p> <p><code>com.iflove.simplespring.webmvc.DispatcherServlet#initHandlerMappings</code></p> Java<pre><code>private void initHandlerMappings(ApplicationContext context) {\n    //\u200b\u4ece\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u62ff\u200b\n    final Map&lt;String, HandlerMapping&gt; map = BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerMapping.class, true, false);\n    if (!ObjectUtils.isEmpty(map)) {\n        this.handlerMappings = new ArrayList&lt;&gt;(map.values());\n    } else {\n        //\u200b\u6ca1\u6709\u200b\u5219\u200b\u4ece\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u62ff\u200b\n        this.handlerMappings.addAll(getDefaultStrategies(context, HandlerMapping.class));\n    }\n    this.handlerMappings.sort(Comparator.comparingInt(Ordered::getOrder));\n}\n</code></pre> <p>\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u7b56\u7565\u200b\u7531\u200b<code>DispatcherServlet.properties</code>\u200b\u51b3\u5b9a\u200b\uff0c\u200b\u5728\u200b Spring \u200b\u6e90\u7801\u200b\u4e2d\u662f\u200b<code>BeanNameUrlHandlerMapping</code>\u3001<code>RequestMappingHandlerMapping</code>\u3001<code>RouterFunctionMapping</code>\uff0c\u200b\u800c\u200b Simple-Spring \u200b\u4e2d\u4e3a\u200b<code>RequestMappingHandlerMapping</code>\u3002</p> <p><code>DispatcherServlet.properties</code>\u200b\u5177\u4f53\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <p><code>src/main/resources/com/iflove/simplespring/webmvc/DispatcherServlet.properties</code></p> <p>\u200b\u6ce8\u610f\u200b\uff1a<code>DispatcherServlet.properties</code>\u200b\u5982\u679c\u200b\u653e\u5728\u200b<code>resources</code> \u200b\u9700\u8981\u200b\u4e0e\u200b <code>DispatcherServlet.java</code> \u200b\u7684\u200b\u8def\u5f84\u200b\u4e00\u81f4\u200b</p> Text Only<pre><code>com.iflove.simplespring.webmvc.HandlerMapping=com.iflove.simplespring.webmvc.handler.RequestMappingHandlerMapping\ncom.iflove.simplespring.webmvc.HandlerAdapter=com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter\n</code></pre> <p>\u200b\u7ee7\u7eed\u200b\u8ddf\u8e2a\u200b <code>getDefaultStrategies(...)</code> \u200b\u65b9\u6cd5\u200b\u4ee3\u7801\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u5df2\u200b\u5b9a\u4e49\u200b\u7684\u200b <code>DEFAULT_STRATEGIES_PATH</code>\uff0c\u200b\u83b7\u5f97\u200b\u6307\u5b9a\u200b\u9ed8\u8ba4\u200b\u7b56\u7565\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b</li> <li>\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u5e76\u200b\u83b7\u5f97\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7b56\u7565\u200b\u7c7b\u540d\u200b</li> <li>\u200b\u901a\u8fc7\u200b Spring \u200b\u4e0a\u4e0b\u6587\u200b\u521b\u5efa\u200b\u5e76\u200b\u521d\u59cb\u5316\u200b\u7b56\u7565\u200b\u7c7b\u200b</li> </ol> <p><code>com.iflove.simplespring.webmvc.DispatcherServlet#getDefaultStrategies</code></p> Java<pre><code>/**\n * \u200b\u4e0e\u200b DispatcherServlet \u200b\u7c7b\u200b\u76f8\u5173\u200b\u7684\u200b\u7c7b\u200b\u8def\u5f84\u200b\u8d44\u6e90\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9a\u4e49\u200b DispatcherServlet \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u7b56\u7565\u200b\u540d\u79f0\u200b\n * \u200b\u6ce8\u610f\u200b\uff1a\u200b\u8def\u5f84\u200b\u5e94\u200b\u4fdd\u6301\u4e00\u81f4\u200b\n */\nprivate static final String DEFAULT_STRATEGIES_PATH = \"DispatcherServlet.properties\";\n\nprotected &lt;T&gt; List&lt;T&gt; getDefaultStrategies(ApplicationContext context, Class&lt;T&gt; strategyInterface) {\n    if (defaultStrategies == null) {\n        try {\n            // Load default strategy implementations from properties file.\n            // This is currently strictly internal and not meant to be customized\n            // by application developers.\n            ClassPathResource resource = new ClassPathResource(DEFAULT_STRATEGIES_PATH, DispatcherServlet.class);\n            defaultStrategies = PropertiesLoaderUtils.loadProperties(resource);\n        } catch (IOException ex) {\n            throw new IllegalStateException(\"Could not load '\" + DEFAULT_STRATEGIES_PATH + \"': \" + ex.getMessage());\n        }\n    }\n\n    String key = strategyInterface.getName();\n    String value = defaultStrategies.getProperty(key);\n    if (value != null) {\n        String[] classNames = StringUtils.commaDelimitedListToStringArray(value);\n        List&lt;T&gt; strategies = new ArrayList&lt;&gt;(classNames.length);\n        for (String className : classNames) {\n            try {\n                Class&lt;?&gt; clazz = ClassUtils.forName(className, DispatcherServlet.class.getClassLoader());\n                Object strategy = createDefaultStrategy(context, clazz);\n                strategies.add((T) strategy);\n            } catch (ClassNotFoundException ex) {\n                throw new BeanInitializationException(\n                        \"Could not find DispatcherServlet's default strategy class [\" + className +\n                                \"] for interface [\" + key + \"]\", ex);\n            } catch (LinkageError err) {\n                throw new BeanInitializationException(\n                        \"Unresolvable class definition for DispatcherServlet's default strategy class [\" +\n                                className + \"] for interface [\" + key + \"]\", err);\n            }\n        }\n        return strategies;\n    } else {\n        return Collections.emptyList();\n    }\n}\n\nprotected Object createDefaultStrategy(ApplicationContext context, Class&lt;?&gt; clazz) {\n    return context.getAutowireCapableBeanFactory().createBean(clazz);\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#handleradapter","title":"HandlerAdapter\u200b\u68c0\u67e5","text":"<p>\u200b\u5957\u8def\u200b\u548c\u200b\u4e0a\u9762\u200b\u5b8c\u5168\u200b\u4e00\u6837\u200b\uff0cSpring\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b<code>HttpRequestHandlerAdapter</code>\u3001<code>SimpleControllerHandlerAdapter</code>\u3001<code>RequestMappingHandlerAdapter</code>\u3001<code>HandlerFunctionAdapter</code>\uff0cSimple-Spring\u200b\u4e2d\u200b\u4f7f\u7528\u200b<code>RequestMappingHandlerMethodAdapter</code>\u3002</p> <p>btw, Spring\u200b\u7684\u200b<code>DispatcherServlet.properties</code>\u200b\u5728\u200b<code>org/springframework/web/servlet/DispatcherServlet.properties</code></p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#handlermapping_1","title":"HandlerMapping\u200b\u521d\u59cb\u5316","text":"<p>\u200b\u6b64\u200b\u63a5\u53e3\u200b\u7528\u4ee5\u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u7684\u200bURL\u200b\u5bfb\u627e\u200b\u5408\u9002\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4ee5\u200b<code>RequestMappingHandlerMapping</code>\u200b\u4f4d\u200b\u4ee3\u8868\u200b\u8fdb\u884c\u200b\u8bf4\u660e\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#requestmappinghandlermapping","title":"RequestMappingHandlerMapping","text":"<p>\u200b\u6b64\u200b\u5b9e\u73b0\u200b\u6839\u636e\u200b<code>@Controller</code>\u200b\u548c\u200b<code>@RequestMapping</code>\u200b\u6ce8\u89e3\u200b\u5b8c\u6210\u200b\u89e3\u6790\u200b\u3002\u200b\u7c7b\u56fe\u200b(\u200b\u5ffd\u7565\u200b\u90e8\u5206\u200b\u63a5\u53e3\u200b):</p> <p></p> <p>\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u5165\u53e3\u200b\u4f4d\u4e8e\u200b<code>AbstractHandlerMapping</code>\u200b\u7684\u200b<code>afterPropertiesSet</code>\u200b\u65b9\u6cd5\u200b\u548c\u200b<code>initApplicationContext</code>\u200b\u65b9\u6cd5\u200b\uff0c<code>afterPropertiesSet</code>\u200b\u8c03\u7528\u200b\u4e86\u200b<code>initHandlerMethods</code>:</p> <p><code>com.iflove.simplespring.webmvc.handler.AbstractHandlerMapping#afterPropertiesSet</code></p> Java<pre><code>@Override\npublic void afterPropertiesSet() throws Exception {\n    initHandlerMethod();\n}\n</code></pre> <p><code>com.iflove.simplespring.webmvc.handler.AbstractHandlerMapping#initHandlerMethod</code></p> Java<pre><code>/**\n * \u200b\u521d\u59cb\u5316\u200b\u5904\u7406\u5668\u200b\u65b9\u6cd5\u200b\n */\nprivate void initHandlerMethod() throws Exception {\n    // from Yusiheng\n    //\u200b\u83b7\u53d6\u200b\u6240\u6709\u200bbean\n    final ApplicationContext context = obtainApplicationContext();\n    String[] names = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(context, Object.class);\n    for (String name : names) {\n        //\u200b\u62ff\u5230\u200b\u5f53\u524d\u200bclass\n        Class type = null;\n        try {\n            type = context.getType(name);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        //\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b\u4e00\u4e2a\u200bhandler -&gt; \u200b\u4ea4\u7ed9\u200b\u5b50\u7c7b\u200b\n        if (type != null &amp;&amp; isHandler(type)) {\n            //\u200b\u627e\u5230\u200bbean\u200b\u5f53\u4e2d\u200b\u7684\u200bHandlerMethod -&gt; \u200b\u4ea4\u7ed9\u200b\u5b50\u7c7b\u200b\n            detectHandlerMethod(name);\n        }\n    }\n}\n</code></pre> <p><code>detectHandlerMethods</code>\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u53cd\u5c04\u200b\u904d\u5386\u200b\u7c7b\u4e2d\u200b\u6240\u6709\u200b\u7684\u200b<code>public</code>\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u679c\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\u542b\u6709\u200b<code>@RequestMapping</code>\u200b\u6ce8\u89e3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c06\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\u7684\u200b\u8def\u5f84\u200b\u4e0e\u200b\u7c7b\u200b\u4e0a\u200b\u7684\u200b\u57fa\u7840\u200b\u8def\u5f84\u200b(\u200b\u5982\u679c\u200b\u6709\u200b)\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u4e4b\u540e\u200b\u5c06\u200b\u6620\u5c04\u200b(\u200b\u5339\u914d\u200b\u5173\u7cfb\u200b)\u200b\u6ce8\u518c\u200b\u5230\u200b<code>MappingRegistry</code>\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u6ce8\u610f\u200b\uff0c\u200b\u7c7b\u4e0a\u200b\u7684\u200b@RequestMapping\u200b\u6ce8\u89e3\u200b\u53ea\u80fd\u200b\u4f5c\u4e3a\u200b\u57fa\u200b\u8def\u5f84\u200b\u5b58\u5728\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u7c7b\u200b\u91cc\u9762\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u7684\u200b\u65b9\u6cd5\u200b\u7ea7\u200b@RequestMapping\u200b\u6ce8\u89e3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7c7b\u4e0a\u200b\u7684\u200b\u6ce8\u89e3\u200b\u662f\u200b\u6ca1\u6709\u200b\u610f\u4e49\u200b\u7684\u200b\u3002\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u5b9e\u9a8c\u200b\u548c\u200b\u6e90\u7801\u200b\u4e0a\u200b\u5f97\u5230\u200b\u8bc1\u5b9e\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u5173\u6ce8\u200b\u4e00\u4e0b\u200b Spring \u200b\u6e90\u7801\u200b\u4e2d\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u662f\u200b\u5982\u4f55\u200b\u4fdd\u5b58\u200b(\u200b\u6ce8\u518c\u200b)\u200b\u7684\u200b\u3002</p> <p>\u200b\u5185\u90e8\u200b\u7c7b\u200b<code>AbstractHandlerMethodMapping.MappingRegistry</code>\u200b\u662f\u200b\u6620\u5c04\u200b\u7684\u200b\u8f7d\u4f53\u200b\uff0c\u200b\u7c7b\u56fe\u200b:</p> <p></p> <p>\u200b\u5176\u200bregister\u200b\u65b9\u6cd5\u200b\u7b80\u7565\u200b\u7248\u200b\u6e90\u7801\u200b:</p> Java<pre><code>public void register(T mapping, Object handler, Method method) {\n    //\u200b\u5305\u88c5\u200bbean\u200b\u548c\u200b\u65b9\u6cd5\u200b\n    HandlerMethod handlerMethod = createHandlerMethod(handler, method);\n    this.mappingLookup.put(mapping, handlerMethod);\n    List&lt;String&gt; directUrls = getDirectUrls(mapping);\n    for (String url : directUrls) {\n        this.urlLookup.add(url, mapping);\n    }\n    String name = null;\n    if (getNamingStrategy() != null) {\n        name = getNamingStrategy().getName(handlerMethod, mapping);\n        addMappingName(name, handlerMethod);\n    }\n    CorsConfiguration corsConfig = initCorsConfiguration(handler, method, mapping);\n    if (corsConfig != null) {\n        this.corsLookup.put(handlerMethod, corsConfig);\n    }\n    this.registry.put(mapping, new MappingRegistration&lt;T&gt;(mapping, handlerMethod, directUrls, name));\n}\n</code></pre> <p><code>mapping</code>\u200b\u5176\u5b9e\u200b\u662f\u200b\u4e00\u4e2a\u200b<code>RequestMappingInfo</code>\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5176\u200b\u770b\u505a\u200b\u662f\u200b @RequestMapping\u200b\u6ce8\u89e3\u200b\u5404\u79cd\u200b\u5c5e\u6027\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5c01\u88c5\u200b\u3002\u200b\u6700\u7ec8\u200b\u7531\u200b<code>RequestMappingInfo.createRequestMappingInfo</code>\u200b\u65b9\u6cd5\u200b\u521b\u5efa\u200b\uff0c\u200b\u6e90\u7801\u200b:</p> Java<pre><code>protected RequestMappingInfo createRequestMappingInfo(\n        RequestMapping requestMapping, RequestCondition&lt;?&gt; customCondition) {\n    return RequestMappingInfo\n            .paths(resolveEmbeddedValuesInPatterns(requestMapping.path()))\n            .methods(requestMapping.method())\n            .params(requestMapping.params())\n            .headers(requestMapping.headers())\n            .consumes(requestMapping.consumes())\n            .produces(requestMapping.produces())\n            .mappingName(requestMapping.name())\n            .customCondition(customCondition)\n            .options(this.config)\n            .build();\n}\n</code></pre> <p>\u200b\u8fd9\u200b\u5c31\u200b\u5f88\u200b\u660e\u663e\u200b\u4e86\u200b\uff0c\u200b\u5177\u4f53\u200b\u6bcf\u79cd\u200b\u5c5e\u6027\u200b\u4ec0\u4e48\u200b\u610f\u4e49\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b<code>@RequestMapping</code>\u200b\u6e90\u7801\u200b\u3002</p> <p><code>register</code>\u200b\u65b9\u6cd5\u200b\u4e2d\u200b<code>urlLookup</code>\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u5c06\u200b<code>paths</code>\u200b\u5c5e\u6027\u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b<code>path</code>\u200b\u90fd\u200b\u4e0e\u200b\u5904\u7406\u5668\u200b\u505a\u200b\u6620\u5c04\u200b\u3002</p> <p><code>getNamingStrategy</code>\u200b\u65b9\u6cd5\u200b\u5f97\u5230\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b<code>HandlerMethodMappingNamingStrategy</code>\u200b\u63a5\u53e3\u200b\u7684\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u6b64\u200b\u63a5\u53e3\u200b\u7528\u4ee5\u200b\u6839\u636e\u200b<code>HandlerMethod</code>\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u540d\u5b57\u200b\uff0c\u200b\u7c7b\u56fe\u200b:</p> <p></p> <p>\u200b\u6bd4\u5982\u200b\u5bf9\u4e8e\u200b\u6211\u4eec\u200b\u7684\u200b\u63a7\u5236\u5668\u200b, <code>SimpleController.echo</code>\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5f97\u5230\u200b\u7684\u200b\u540d\u5b57\u200b\u5c06\u200b\u662f\u200b<code>SC#echo</code>\u3002</p> <p></p> <p>\u200b\u4ee5\u4e0a\u200b\u662f\u200b\u5bf9\u200bSpring\u200b\u6e90\u7801\u200b\u4e2d\u200b\u5982\u4f55\u200b\u4fdd\u5b58\u200b(\u200b\u6ce8\u518c\u200b)\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u7684\u200b\u89e3\u8bfb\u200b\uff0c\u200b\u800c\u200b\u5728\u200b<code>Simple-Spring</code>\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u65b9\u6cd5\u200b\u975e\u5e38\u7b80\u5355\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b <code>detectHandlerMethod</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b Spring \u200b\u6e90\u7801\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u591a\u200b\u8d58\u8ff0\u200b</p> <p><code>com.iflove.simplespring.webmvc.handler.RequestMappingHandlerMapping#detectHandlerMethod</code></p> Java<pre><code>@Override\nprotected void detectHandlerMethod(String name) throws Exception {\n    // from Yusiheng\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7c7b\u200b\n    final ApplicationContext context = obtainApplicationContext();\n    final Class&lt;?&gt; type = context.getType(name);\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7c7b\u4e0b\u200b\u7684\u200b\u6240\u6709\u200b\u65b9\u6cd5\u200b\n    final Method[] methods = type.getDeclaredMethods();\n    List&lt;HandlerMethod&gt; handlerMethods = new ArrayList&lt;&gt;();\n    // \u200b\u83b7\u5f97\u200b\u7c7b\u4e0a\u200b\u7684\u200b\u8def\u5f84\u200b\n    String path = \"\";\n    if (AnnotatedElementUtils.hasAnnotation(type, RequestMapping.class)) {\n        final RequestMapping requestMapping = AnnotatedElementUtils.findMergedAnnotation(type, RequestMapping.class);\n        final String value = requestMapping.value();\n        path = value.equals(\"\") ? \"\" : value;\n    }\n\n    final Object bean = context.getBean(name);\n\n    for (Method method : methods) {\n        // \u200b\u83b7\u53d6\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\u662f\u5426\u200b\u5b58\u5728\u200bRequestMapping\u200b\u6ce8\u89e3\u200b\n        if (AnnotatedElementUtils.hasAnnotation(method, RequestMapping.class)) {\n            // \u200b\u6536\u96c6\u200b\n            final HandlerMethod handlerMethod = new HandlerMethod(bean, method);\n            // \u200b\u83b7\u5f97\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\u7684\u200b\u8def\u5f84\u200b\n            final RequestMapping requestMapping = AnnotatedElementUtils.findMergedAnnotation(method, RequestMapping.class);\n            final String value = requestMapping.value();\n            String childPath = value.equals(\"\") ? \"\" : value;\n            handlerMethod.setRequestMethods(requestMapping.requestMethod());\n            // \u200b\u62fc\u63a5\u200b\u8def\u5f84\u200b\n            handlerMethod.setPath(path + childPath);\n\n            handlerMethods.add(handlerMethod);\n        }\n    }\n    // \u200b\u6ce8\u518c\u200bHandlerMethod\n    if (!ObjectUtils.isEmpty(handlerMethods)) {\n        for (HandlerMethod handlerMethod : handlerMethods) {\n            register(handlerMethod);\n        }\n    }\n}\n</code></pre> <p>\u200b\u91cd\u70b9\u200b\u5728\u4e8e\u200b <code>register</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u8def\u5f84\u200b\u6620\u5c04\u200b\u7684\u200b\u6ce8\u518c\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>HashMap</code> \u200b\u505a\u200b\u7b80\u5355\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u952e\u200b\u662f\u200b\u8bf7\u6c42\u200b\u8def\u5f84\u200b\uff08String \u200b\u7c7b\u578b\u200b\uff09\uff0c\u200b\u503c\u200b\u662f\u200b\u4e00\u4e2a\u200b <code>Set&lt;HandlerMethod&gt;</code>\uff0c\u200b\u8868\u793a\u200b\u5728\u200b\u8be5\u200b\u8def\u5f84\u200b\u4e0b\u200b\u53ef\u80fd\u200b\u5339\u914d\u200b\u7684\u200b\u591a\u4e2a\u200b <code>HandlerMethod</code>\uff08\u200b\u5904\u7406\u200b\u65b9\u6cd5\u200b\uff09</p> <p>\u200b\u5982\u679c\u200b\u8def\u5f84\u200b\u5305\u542b\u200b <code>{}</code>\uff0c\u200b\u5373\u200b\u5e26\u6709\u200b\u8def\u5f84\u200b\u53c2\u6570\u200b\u7684\u200b\u5360\u4f4d\u200b\u7b26\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>/user/{id}</code>\uff0c\u200b\u5219\u200b\u5c06\u200b <code>{}</code> \u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\u66ff\u6362\u6210\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b <code>(\\w+)</code>\uff0c\u200b\u4ee5\u200b\u652f\u6301\u200b\u8def\u5f84\u200b\u53c2\u6570\u200b\u7684\u200b\u5339\u914d\u200b\u3002</p> <ul> <li>\u200b\u66ff\u6362\u200b\u540e\u200b\u7684\u200b\u8def\u5f84\u200b\u4f1a\u200b\u7528\u4e8e\u200b\u540e\u7eed\u200b\u7684\u200b\u8def\u5f84\u200b\u5339\u914d\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b\u8def\u5f84\u200b\u6ca1\u6709\u200b\u8def\u5f84\u200b\u53c2\u6570\u200b\uff0c\u200b\u76f4\u63a5\u200b\u6ce8\u518c\u200b\u8be5\u200b\u8def\u5f84\u200b\u548c\u200b\u5bf9\u5e94\u200b\u7684\u200b HandlerMethod\u3002</li> </ul> <p><code>com.iflove.simplespring.webmvc.handler.AbstractHandlerMapping#register(com.iflove.simplespring.webmvc.handler.HandlerMethod)</code></p> Java<pre><code>// \u200b\u8def\u5f84\u200b\u6620\u5c04\u200b\u8868\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8def\u5f84\u200b\u5bf9\u5e94\u200b\u591a\u4e2a\u200b HandlerMethod\nprivate final Map&lt;String, Set&lt;HandlerMethod&gt;&gt; mappingRegistry = new HashMap&lt;&gt;();\n\npublic void register(HandlerMethod handlerMethod) {\n    // \u200b\u83b7\u53d6\u200b\u8bf7\u6c42\u200b\u8def\u5f84\u200b\n    String path = handlerMethod.getPath();\n    if (path.contains(\"{\") &amp;&amp; path.contains(\"}\")) {\n        // \u200b\u8def\u5f84\u200b\u66ff\u6362\u200b\n        path = path.replaceAll(\"\\\\{\\\\w+}\", \"(\\\\\\\\w+)\");\n        // \u200b\u5b58\u5728\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u4e00\u6837\u200b\n        register(path, handlerMethod);\n    } else {\n        // \u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u8def\u5f84\u200b\u7684\u200b\u4e0d\u540c\u200b\u5206\u522b\u200b\u4fdd\u5b58\u200bHandlerMethod\n        register(path, handlerMethod);\n    }\n}\n\npublic void register(String path, HandlerMethod handlerMethod) {\n    // \u200b\u6ce8\u518c\u200b\u5904\u7406\u5668\u200b\n    mappingRegistry.computeIfAbsent(path, k -&gt; new HashSet&lt;&gt;()).add(handlerMethod);\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#handleradapter_1","title":"HandlerAdapter\u200b\u521d\u59cb\u5316","text":"<p>\u200b\u540c\u6837\u200b\uff0c\u200b\u4ee5\u200bRequestMappingHandlerAdapter\u200b\u4e3a\u4f8b\u200b\u8fdb\u884c\u200b\u8bf4\u660e\u200b\uff0c\u200b\u7c7b\u56fe\u200b:</p> <p></p> <p>\u200b\u663e\u7136\u200b\uff0c\u200b\u5165\u53e3\u200b\u5728\u200b\u5b9e\u73b0\u200b\u4e86\u200b<code>InitializingBean</code>\u200b\u7684\u200b<code>afterPropertiesSet</code>\u200b\u65b9\u6cd5\u200b:</p> <p><code>com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter#afterPropertiesSet</code></p> Java<pre><code>/**\n * \u200b\u521d\u59cb\u5316\u200b\u57fa\u7840\u200b\u7ec4\u4ef6\u200b\n */\n@Override\npublic void afterPropertiesSet() throws Exception {\n    resolverComposite.addResolvers(getDefaultArgumentResolver());\n    returnValueHandlerComposite.addMethodReturnValueHandlers(getDefaultMethodReturnValueHandler());\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_6","title":"\u53c2\u6570\u200b\u89e3\u6790\u5668","text":"<p>\u200b\u53c2\u6570\u200b\u89e3\u6790\u5668\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u4ece\u200brequest\u200b\u4e2d\u200b\u89e3\u6790\u200b\u3001\u200b\u5f97\u5230\u200bController\u200b\u65b9\u6cd5\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u53c2\u6570\u200b\u3002</p> <p></p> <p><code>com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter#getDefaultArgumentResolver</code></p> Java<pre><code>/**\n * \u200b\u521d\u59cb\u5316\u200b\u53c2\u6570\u200b\u89e3\u6790\u5668\u200b\n */\npublic List&lt;HandlerMethodArgumentResolver&gt; getDefaultArgumentResolver() {\n    final List&lt;HandlerMethodArgumentResolver&gt; resolvers = new ArrayList&lt;&gt;();\n    resolvers.add(new PathVariableMethodArgumentResolver());\n    resolvers.add(new PathVariableMapMethodArgumentResolver());\n    resolvers.add(new RequestCookieMethodArgumentResolver());\n    resolvers.add(new RequestHeaderMethodArgumentResolver());\n    resolvers.add(new RequestHeaderMapMethodArgumentResolver());\n    resolvers.add(new RequestPartMethodArgumentResolver());\n    resolvers.add(new RequestParamMethodArgumentResolver());\n    resolvers.add(new RequestParamMapMethodArgumentResolver());\n    resolvers.add(new RequestRequestBodyMethodArgumentResolver());\n    resolvers.add(new ServletRequestMethodArgumentResolver());\n    resolvers.add(new ServletResponseMethodArgumentResolver());\n    return resolvers;\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_7","title":"\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u89e3\u6790\u5668","text":"<p><code>HandlerMethodReturnValueHandler</code>\u200b\u63a5\u53e3\u200b\u7528\u4ee5\u200b\u5904\u7406\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b(Controller\u200b\u65b9\u6cd5\u200b)\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\uff0c\u200b\u7c7b\u56fe\u200b:</p> <p></p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#_8","title":"\u8bf7\u6c42\u200b\u6267\u884c\u200b\u6d41\u7a0b","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#1-service","title":"1. Service","text":"<p>\u200b\u9996\u5148\u200b\u8bf7\u6c42\u200b\u8fdb\u5165\u200b\u5230\u200b <code>FrameworkServlet</code> \u200b\u91cd\u5199\u200b\u7684\u200b <code>Service</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u6b64\u5904\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5224\u65ad\u200b\u903b\u8f91\u200b</p> <ul> <li>\u200b\u5982\u679c\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u4e3a\u200b <code>GET, POST, DELETE, PUT</code> \u200b\u7b49\u200b\u5e38\u89c1\u200b <code>Http</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8d70\u200b <code>super.service</code> \u200b\u5904\u7406\u200b</li> <li>\u200b\u5426\u5219\u200b\u8d70\u200b\u81ea\u5b9a\u4e49\u200b <code>processRequest</code> \u200b\u65b9\u6cd5\u200b</li> </ul> <p><code>com.iflove.simplespring.webmvc.FrameworkServlet#service</code></p> Java<pre><code>/**\n * \u200b\u62e6\u622a\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u5224\u65ad\u200b\u53bb\u5411\u200b\n * @param request Http \u200b\u8bf7\u6c42\u200b\n * @param response Http \u200b\u54cd\u5e94\u200b\n * @throws ServletException ServletException\n * @throws IOException IOException\n */\n@Override\nprotected void service(HttpServletRequest request, HttpServletResponse response)\n        throws ServletException, IOException {\n\n    // \u200b\u5982\u679c\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u4e3a\u200b GET, POST, DELETE, PUT \u200b\u7b49\u200b\u5e38\u89c1\u200b Http \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8d70\u200b super.service \u200b\u5904\u7406\u200b \n    if (HTTP_SERVLET_METHODS.contains(request.getMethod())) {\n        super.service(request, response);\n    }\n    else {\n        processRequest(request, response);\n    }\n}\n</code></pre> <p>\u200b\u800c\u200b\u8fdb\u5165\u200b\u5230\u200b <code>super.service</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200b\u8bf7\u6c42\u200b\u6700\u7ec8\u200b\u540c\u6837\u200b\u56de\u5230\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b <code>processRequest</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u901a\u8fc7\u200b\u6e90\u7801\u200b\u5bf9\u6b64\u200b\u8fdb\u884c\u200b\u89e3\u91ca\u200b</p> <p><code>javax.servlet.http.HttpServlet#service(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)</code></p> Java<pre><code>protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n    String method = req.getMethod();\n    long lastModified;\n    if (method.equals(\"GET\")) {\n        lastModified = this.getLastModified(req);\n        if (lastModified == -1L) {\n            this.doGet(req, resp);\n        } else {\n            long ifModifiedSince;\n            try {\n                ifModifiedSince = req.getDateHeader(\"If-Modified-Since\");\n            } catch (IllegalArgumentException var9) {\n                ifModifiedSince = -1L;\n            }\n\n            if (ifModifiedSince &lt; lastModified / 1000L * 1000L) {\n                this.maybeSetLastModified(resp, lastModified);\n                this.doGet(req, resp);\n            } else {\n                resp.setStatus(304);\n            }\n        }\n    } else if (method.equals(\"HEAD\")) {\n        lastModified = this.getLastModified(req);\n        this.maybeSetLastModified(resp, lastModified);\n        this.doHead(req, resp);\n    } else if (method.equals(\"POST\")) {\n        this.doPost(req, resp);\n    } else if (method.equals(\"PUT\")) {\n        this.doPut(req, resp);\n    } else if (method.equals(\"DELETE\")) {\n        this.doDelete(req, resp);\n    } else if (method.equals(\"OPTIONS\")) {\n        this.doOptions(req, resp);\n    } else if (method.equals(\"TRACE\")) {\n        this.doTrace(req, resp);\n    } else {\n        String errMsg = lStrings.getString(\"http.method_not_implemented\");\n        Object[] errArgs = new Object[]{method};\n        errMsg = MessageFormat.format(errMsg, errArgs);\n        resp.sendError(501, errMsg);\n    }\n\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5728\u200b <code>super.service</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u8fdb\u5165\u200b\u5230\u200b\u5404\u81ea\u200b\u7684\u200b <code>do**</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u800c\u200b \u200b\u8bf7\u6c42\u200b\u7684\u200b <code>do**</code> \u200b\u65b9\u6cd5\u200b\u53c8\u200b\u88ab\u200b <code>FrameworkServlet</code> \u200b\u91cd\u5199\u200b, \u200b\u4e14\u200b\u65b9\u6cd5\u200b\u4f53\u5747\u200b\u4e3a\u200b <code>processRequest(request, response);</code>\uff0c\u200b\u5df2\u200b <code>doGet</code> \u200b\u65b9\u6cd5\u200b\u4e3a\u4f8b\u200b</p> <p>PS: \u200b\u6e90\u7801\u200b\u91cd\u5199\u200b\u7684\u200b <code>doOptions</code> \u200b\u548c\u200b <code>doTrace</code> \u200b\u6709\u4e9b\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u200b\u5e38\u7528\u200b\uff0c\u200b\u6545\u200b\u4e0d\u200b\u505a\u200b\u5b9e\u73b0\u200b</p> <p><code>com.iflove.simplespring.webmvc.FrameworkServlet#doGet</code></p> Java<pre><code>/**\n * Delegate GET requests to processRequest/doService.\n * &lt;p&gt;Will also be invoked by HttpServlet's default implementation of {@code doHead},\n * with a {@code NoBodyResponse} that just captures the content length.\n * @see #doHead\n */\n@Override\nprotected final void doGet(HttpServletRequest request, HttpServletResponse response)\n        throws ServletException, IOException {\n    processRequest(request, response);\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#2-processrequest","title":"2. processRequest","text":"<p><code>processRequest</code> \u200b\u662f\u200b <code>FrameworkServlet</code> \u200b\u4e2d\u200b\u7684\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7528\u4e8e\u200b\u63a5\u6536\u200b\u5e76\u200b\u521d\u59cb\u5316\u200b HTTP \u200b\u8bf7\u6c42\u200b\u5904\u7406\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u73af\u5883\u200b\u3002</p> <p>\u200b\u4e3b\u8981\u200b\u505a\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>\u200b\u8bb0\u5f55\u200b\u5f00\u59cb\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b\u8bf7\u6c42\u200b\u4e0a\u4e0b\u6587\u200b<ul> <li>\u200b\u4f7f\u7528\u200b <code>LocaleContextHolder</code> \u200b\u548c\u200b <code>RequestContextHolder</code> \u200b\u8bbe\u7f6e\u200b\u672c\u5730\u5316\u200b\u4e0a\u4e0b\u6587\u200b\u548c\u200b\u8bf7\u6c42\u200b\u4e0a\u4e0b\u6587\u200b</li> <li>\u200b\u901a\u8fc7\u200b <code>buildLocaleContext</code> \u200b\u548c\u200b <code>buildRequestAttributes</code> \u200b\u65b9\u6cd5\u200b\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b <code>LocaleContext</code> \u200b\u548c\u200b <code>ServletRequestAttributes</code></li> </ul> </li> <li>\u200b\u521d\u59cb\u5316\u200b\u5f02\u6b65\u200b\u7ba1\u7406\u5668\u200b</li> <li>\u200b\u8c03\u7528\u200b <code>doService</code> \u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b</li> <li>\u200b\u6e05\u7406\u200b\u4e0a\u4e0b\u6587\u200b</li> <li>\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u548c\u200b\u4e8b\u4ef6\u200b\u53d1\u5e03\u200b</li> </ol> <p><code>com.iflove.simplespring.webmvc.FrameworkServlet#processRequest</code></p> Java<pre><code>/**\n * \u200b\u5904\u7406\u200b Http \u200b\u8bf7\u6c42\u200b\n * @param request Http \u200b\u8bf7\u6c42\u200b\n * @param response Http \u200b\u54cd\u5e94\u200b\n */\nprotected final void processRequest(HttpServletRequest request, HttpServletResponse response)\n        throws ServletException, IOException {\n\n    // \u200b\u8bb0\u5f55\u200b\u5f00\u59cb\u200b\u65f6\u95f4\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u8bf7\u6c42\u200b\u4e0a\u4e0b\u6587\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u5f02\u6b65\u200b\u7ba1\u7406\u5668\u200b\n    /*\n    long startTime = System.currentTimeMillis();\n    Throwable failureCause = null;\n\n    LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();\n    LocaleContext localeContext = buildLocaleContext(request);\n\n    RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();\n    ServletRequestAttributes requestAttributes = buildRequestAttributes(request, response, previousAttributes);\n\n    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);\n    asyncManager.registerCallableInterceptor(org.springframework.web.servlet.FrameworkServlet.class.getName(), new org.springframework.web.servlet.FrameworkServlet.RequestBindingInterceptor());\n\n    initContextHolders(request, localeContext, requestAttributes);\n    */\n\n    try {\n        doService(request, response);\n    }\n    catch (ServletException | IOException ex) {\n        throw ex;\n    }\n    catch (Throwable ex) {\n        throw new ServletException(\"Request processing failed: \" + ex, ex);\n    }\n\n    // \u200b\u6e05\u7406\u200b\u4e0a\u4e0b\u6587\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u548c\u200b\u4e8b\u4ef6\u200b\u53d1\u5e03\u200b \n    /*\n    finally {\n        resetContextHolders(request, previousLocaleContext, previousAttributes);\n        if (requestAttributes != null) {\n            requestAttributes.requestCompleted();\n        }\n        logResult(request, response, failureCause, asyncManager);\n        publishRequestHandledEvent(request, response, startTime, failureCause);\n    }\n    */\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#3-doservice","title":"3. doService","text":"<p><code>doService</code> \u200b\u662f\u200b <code>processRequest</code> \u200b\u7684\u200b\u5b50\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5c01\u88c5\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7ec6\u8282\u200b\u903b\u8f91\u200b\uff0c\u200b\u5305\u62ec\u200b\u4e3a\u200b\u8bf7\u6c42\u200b\u5206\u53d1\u200b\u521b\u5efa\u200b\u4e0a\u4e0b\u6587\u200b\u73af\u5883\u200b\uff0c\u200b\u5e76\u200b\u8c03\u7528\u200b\u6838\u5fc3\u200b\u5206\u53d1\u200b\u65b9\u6cd5\u200b <code>doDispatch</code>\u3002</p> <p>\u200b\u4e3b\u8981\u200b\u505a\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b</li> <li>\u200b\u8bf7\u6c42\u200b\u5305\u542b\u200b\u652f\u6301\u200b</li> <li>\u200b\u6dfb\u52a0\u200b\u6846\u67b6\u200b\u7ea7\u200b\u5bf9\u8c61\u200b<ul> <li>\u200b\u5c06\u200b Web \u200b\u5e94\u7528\u200b\u4e0a\u4e0b\u6587\u200b\u3001\u200b\u8bed\u8a00\u200b\u73af\u5883\u200b\u89e3\u6790\u5668\u200b\uff08LocaleResolver\uff09\u3001\u200b\u4e3b\u9898\u200b\u89e3\u6790\u5668\u200b\u7b49\u200b\u5bf9\u8c61\u200b\u6dfb\u52a0\u200b\u5230\u200b\u8bf7\u6c42\u200b\u4e2d\u200b\uff0c\u200b\u4f9b\u200b\u540e\u7eed\u200b\u5904\u7406\u200b\u4f7f\u7528\u200b\u3002</li> </ul> </li> <li>\u200b\u89e3\u6790\u200b\u95ea\u5b58\u200b\u6d88\u606f\u200b</li> <li>\u200b\u8def\u5f84\u200b\u89e3\u6790\u200b</li> <li>\u200b\u8c03\u7528\u200b <code>doDispatch</code>\uff0c\u200b\u8fdb\u884c\u200b\u6838\u5fc3\u200b\u7684\u200b\u8bf7\u6c42\u200b\u5206\u53d1\u200b\u903b\u8f91\u200b</li> </ol> <p><code>com.iflove.simplespring.webmvc.DispatcherServlet#doService</code></p> Java<pre><code>/**\n * \u200b\u66b4\u9732\u200b\u7279\u5b9a\u200b\u4e8e\u200b DispatcherServlet \u200b\u7684\u200b\u8bf7\u6c42\u200b\u5c5e\u6027\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5b9e\u9645\u200b\u7684\u200b\u8bf7\u6c42\u200b\u5206\u6d3e\u200b\u59d4\u6258\u200b\u7ed9\u200b {@link #doDispatch} \u200b\u65b9\u6cd5\u200b\n */\n@Override\nprotected void doService(HttpServletRequest request, HttpServletResponse response) throws Exception {\n    // \u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u5305\u542b\u200b\u652f\u6301\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u6846\u67b6\u200b\u7ea7\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u89e3\u6790\u200b\u95ea\u5b58\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8def\u5f84\u200b\u89e3\u6790\u200b\n    /*\n    logRequest(request);\n\n    // Keep a snapshot of the request attributes in case of an include,\n    // to be able to restore the original attributes after the include.\n    Map&lt;String, Object&gt; attributesSnapshot = null;\n    if (WebUtils.isIncludeRequest(request)) {\n        attributesSnapshot = new HashMap&lt;&gt;();\n        Enumeration&lt;?&gt; attrNames = request.getAttributeNames();\n        while (attrNames.hasMoreElements()) {\n            String attrName = (String) attrNames.nextElement();\n            if (this.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) {\n                attributesSnapshot.put(attrName, request.getAttribute(attrName));\n            }\n        }\n    }\n\n    // Make framework objects available to handlers and view objects.\n    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());\n    request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver);\n    request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver);\n    request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());\n\n    if (this.flashMapManager != null) {\n        FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response);\n        if (inputFlashMap != null) {\n            request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));\n        }\n        request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap());\n        request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager);\n    }\n\n    RequestPath previousRequestPath = null;\n    if (this.parseRequestPath) {\n        previousRequestPath = (RequestPath) request.getAttribute(ServletRequestPathUtils.PATH_ATTRIBUTE);\n        ServletRequestPathUtils.parseAndCache(request);\n    }\n    */\n\n    // \u200b\u8bbe\u7f6e\u200b Web \u200b\u5e94\u7528\u200b\u4e0a\u4e0b\u6587\u200b \n    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());\n\n    // \u200b\u6838\u5fc3\u200b\u8bf7\u6c42\u200b\u5206\u53d1\u200b\u903b\u8f91\u200b \n    doDispatch(request, response);\n\n    /*\n    finally {\n        if (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {\n            // Restore the original attribute snapshot, in case of an include.\n            if (attributesSnapshot != null) {\n                restoreAttributesAfterInclude(request, attributesSnapshot);\n            }\n        }\n        if (this.parseRequestPath) {\n            ServletRequestPathUtils.setParsedRequestPath(previousRequestPath, request);\n        }\n    }\n     */\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#4-dodispatch","title":"4. \u200b\u8bf7\u6c42\u200b\u5206\u53d1\u200b doDispatch","text":"<p><code>doDispatch</code> \u200b\u662f\u200b <code>Spring MVC</code> \u200b\u7684\u200b\u8bf7\u6c42\u200b\u5206\u53d1\u200b\u6838\u5fc3\u200b\u903b\u8f91\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u5c06\u200b\u8bf7\u6c42\u200b\u5206\u914d\u200b\u7ed9\u200b\u5408\u9002\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff08Handler\uff09\u200b\u5e76\u200b\u6267\u884c\u200b\u3002</p> <p><code>com.iflove.simplespring.webmvc.DispatcherServlet#doDispatch</code></p> Java<pre><code>/**\n * \u200b\u5904\u7406\u200b\u5b9e\u9645\u200b\u7684\u200b\u5206\u6d3e\u200b\u5230\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u3002\n *\n * &lt;p&gt;\u200b\u5904\u7406\u5668\u200b\u5c06\u200b\u901a\u8fc7\u200b\u6309\u200b\u987a\u5e8f\u200b\u5e94\u7528\u200b servlet \u200b\u7684\u200b HandlerMappings \u200b\u6765\u200b\u83b7\u53d6\u200b\u3002\n * HandlerAdapter \u200b\u5c06\u200b\u901a\u8fc7\u200b\u67e5\u8be2\u200b servlet \u200b\u5b89\u88c5\u200b\u7684\u200b HandlerAdapters \u200b\u6765\u200b\u627e\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u652f\u6301\u200b\u8be5\u200b\u5904\u7406\u5668\u200b\u7c7b\u200b\u7684\u200b\u9002\u914d\u5668\u200b\u3002\n * &lt;p&gt;\u200b\u6240\u6709\u200b\u7684\u200b HTTP \u200b\u65b9\u6cd5\u200b\u90fd\u200b\u7531\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5904\u7406\u200b\u3002\u200b\u5177\u4f53\u200b\u54ea\u4e9b\u200b\u65b9\u6cd5\u200b\u662f\u200b\u53ef\u200b\u63a5\u53d7\u200b\u7684\u200b\uff0c\u200b\u7531\u200b HandlerAdapters \u200b\u6216\u200b\u5904\u7406\u5668\u200b\u672c\u8eab\u200b\u51b3\u5b9a\u200b\n *\n * @param req  current HTTP request\n * @param resp current HTTP response\n * @throws Exception in case of any kind of processing failure\n */\nprotected void doDispatch(HttpServletRequest req, HttpServletResponse resp) throws Exception {\n\n    Exception ex = null;\n    HandlerExecutionChain handlerExecutionChain = null;\n    try {\n        handlerExecutionChain = getHandler(req);\n        //handlerMethod\u200b\u627e\u200b\u4e0d\u5230\u200b\u5219\u200b\u8fd4\u56de\u200b404\n        if (ObjectUtils.isEmpty(handlerExecutionChain)) {\n            resp.sendError(HttpServletResponse.SC_NOT_FOUND);\n            return;\n        }\n\n        handlerExecutionChain.afterCompletion(req, resp, handlerExecutionChain.getHandlerMethod(), ex);\n\n        // \u200b\u83b7\u5f97\u200b\u9002\u914d\u5668\u200b\n        HandlerAdapter ha = getHandlerAdapter(handlerExecutionChain.getHandlerMethod());\n        if (!handlerExecutionChain.applyPreInterceptor(req, resp)) {\n            return;\n        }\n        ha.handle(req, resp, handlerExecutionChain.getHandlerMethod());\n        handlerExecutionChain.applyPostInterceptor(req, resp);\n    } catch (Exception e) {\n        ex = e;\n    }\n    try {\n        processDispatchResult(req, resp, handlerExecutionChain, ex);\n    } catch (Exception e) {\n        throw new ServletException(e.getMessage());\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#5-gethandler","title":"5. \u200b\u5904\u7406\u5668\u200b\u67e5\u627e\u200b getHandler","text":"<p>\u200b\u67e5\u627e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5904\u7406\u5668\u200b <code>handler</code>\uff0c\u200b\u5e76\u200b\u4e0e\u200b <code>HandlerInterceptor</code> \u200b\u7ec4\u88c5\u200b\u4e3a\u200b\u5904\u7406\u5668\u200b\u94fe\u200b\u8fd4\u56de\u200b\u3002</p> <p><code>com.iflove.simplespring.webmvc.DispatcherServlet#getHandler</code></p> Java<pre><code>/**\n * Return the HandlerExecutionChain for this request.\n * &lt;p&gt;Tries all handler mappings in order.\n *\n * @param request current HTTP request\n * @return the HandlerExecutionChain, or {@code null} if no handler could be found\n */\n@Nullable\nprotected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {\n    if (this.handlerMappings != null) {\n        for (HandlerMapping mapping : this.handlerMappings) {\n            HandlerExecutionChain handler = mapping.getHandler(request);\n            if (handler != null) {\n                return handler;\n            }\n        }\n    }\n    return null;\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#6-gethandleradapter","title":"6. \u200b\u9002\u914d\u5668\u200b\u67e5\u627e\u200b getHandlerAdapter","text":"<p>\u200b\u6839\u636e\u200b <code>handler</code> \u200b\u67e5\u627e\u200b\u652f\u6301\u200b\u7684\u200b\u9002\u914d\u5668\u200b</p> <p><code>com.iflove.simplespring.webmvc.DispatcherServlet#getHandlerAdapter</code></p> Java<pre><code>/**\n * Return the HandlerAdapter for this handler object.\n *\n * @param handler the handler object to find an adapter for\n * @throws ServletException if no HandlerAdapter can be found for the handler. This is a fatal error.\n */\nprotected HandlerAdapter getHandlerAdapter(HandlerMethod handler) throws ServletException {\n    if (this.handlerAdapters != null) {\n        for (HandlerAdapter adapter : this.handlerAdapters) {\n            if (adapter.support(handler)) {\n                return adapter;\n            }\n        }\n    }\n    throw new ServletException(\"No adapter for handler [\" + handler +\n            \"]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler\");\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-MVC/#7-hahandle","title":"7. \u200b\u8bf7\u6c42\u200b\u5904\u7406\u200b ha.handle(...)","text":"<p>\u200b\u5728\u200b\u8bf7\u6c42\u200b\u5904\u7406\u200b\u524d\u540e\u200b\u5206\u522b\u200b\u8fdb\u884c\u200b\u62e6\u622a\u5668\u200b\u7684\u200b\u524d\u7f6e\u200b\u5904\u7406\u200b\u4e0e\u200b\u540e\u7f6e\u200b\u5904\u7406\u200b\u3002</p> Java<pre><code>if (!handlerExecutionChain.applyPreInterceptor(req, resp)) {\n    return;\n}\nha.handle(req, resp, handlerExecutionChain.getHandlerMethod());\nhandlerExecutionChain.applyPostInterceptor(req, resp);\n</code></pre> <p><code>com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter#handle</code></p> Java<pre><code>/**\n * \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\u5c31\u200b\u5728\u200b\u8fd9\u200b\u5185\u90e8\u200b\n */\n@Override\npublic void handle(HttpServletRequest req, HttpServletResponse res, HandlerMethod handler) throws Exception {\n    final WebServletRequest webServletRequest = new WebServletRequest(req, res);\n    // \u200b\u9700\u8981\u200b\u5c06\u200b HandlerMethod\u200b\u6267\u884c\u200b\uff0c\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7c7b\u6765\u200b\u5305\u88c5\u200b\n    final ServletInvocableHandlerMethod invocableMethod = new ServletInvocableHandlerMethod();\n    // \u200b\u83b7\u53d6\u200b\u5230\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u7ec4\u4ef6\u200b\n    invocableMethod.setHandlerMethod(handler);\n    invocableMethod.setConversionService(conversionService);\n    invocableMethod.setResolverComposite(resolverComposite);\n    invocableMethod.setReturnValueHandlerComposite(returnValueHandlerComposite);\n    // \u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\u903b\u8f91\u200b\n    invocableMethod.invokeAndHandle(webServletRequest, handler);\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/","title":"Spring \u200b\u4e8b\u52a1","text":"<p> \u200b\u7ea6\u200b 3201 \u200b\u4e2a\u200b\u5b57\u200b  287 \u200b\u884c\u200b\u4ee3\u7801\u200b  8 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 14 \u200b\u5206\u949f\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#acid","title":"\u4e8b\u52a1\u200bACID","text":"<ul> <li>\u200b\u539f\u5b50\u200b\u6027\u200b\uff1a \u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\uff08transaction\uff09\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8981\u4e48\u200b\u5168\u90e8\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8981\u4e48\u200b\u5168\u90e8\u200b\u4e0d\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7ed3\u675f\u200b\u5728\u200b\u4e2d\u95f4\u200b\u67d0\u4e2a\u200b\u73af\u8282\u200b\u3002\u200b\u4e8b\u52a1\u200b\u5728\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u53d1\u751f\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6eda\u200b\uff08Rollback\uff09\u200b\u5230\u200b\u4e8b\u52a1\u200b\u5f00\u59cb\u200b\u524d\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b\u8fd9\u4e2a\u200b\u4e8b\u52a1\u200b\u4ece\u6765\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u8fc7\u200b\u4e00\u6837\u200b\u3002</li> <li>\u200b\u4e00\u81f4\u6027\u200b\uff1a \u200b\u5728\u200b\u4e8b\u52a1\u200b\u5f00\u59cb\u200b\u4e4b\u524d\u200b\u548c\u200b\u4e8b\u52a1\u200b\u7ed3\u675f\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\u6ca1\u6709\u200b\u88ab\u200b\u7834\u574f\u200b\u3002\u200b\u8fd9\u200b\u8868\u793a\u200b\u5199\u5165\u200b\u7684\u200b\u8d44\u6599\u200b\u5fc5\u987b\u200b\u5b8c\u5168\u7b26\u5408\u200b\u6240\u6709\u200b\u7684\u200b\u9884\u8bbe\u200b\u89c4\u5219\u200b\uff0c\u200b\u8fd9\u200b\u5305\u542b\u200b\u8d44\u6599\u200b\u7684\u200b\u7cbe\u786e\u5ea6\u200b\u3001\u200b\u4e32\u8054\u200b\u6027\u200b\u4ee5\u53ca\u200b\u540e\u7eed\u200b\u6570\u636e\u5e93\u200b\u53ef\u4ee5\u200b\u81ea\u53d1\u6027\u200b\u5730\u200b\u5b8c\u6210\u200b\u9884\u5b9a\u200b\u7684\u200b\u5de5\u4f5c\u200b\u3002</li> <li>\u200b\u9694\u79bb\u200b\u6027\u200b\uff1a \u200b\u6570\u636e\u5e93\u200b\u5141\u8bb8\u200b\u591a\u4e2a\u200b\u5e76\u53d1\u200b\u4e8b\u52a1\u200b\u540c\u65f6\u200b\u5bf9\u200b\u5176\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u8bfb\u5199\u200b\u548c\u200b\u4fee\u6539\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u9694\u79bb\u200b\u6027\u200b\u53ef\u4ee5\u200b\u9632\u6b62\u200b\u591a\u4e2a\u200b\u4e8b\u52a1\u200b\u5e76\u53d1\u200b\u6267\u884c\u200b\u65f6\u200b\u7531\u4e8e\u200b\u4ea4\u53c9\u200b\u6267\u884c\u200b\u800c\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u7684\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u3002\u200b\u4e8b\u52a1\u200b\u9694\u79bb\u200b\u5206\u4e3a\u200b\u4e0d\u540c\u200b\u7ea7\u522b\u200b\uff0c\u200b\u5305\u62ec\u200b\u8bfb\u672a\u200b\u63d0\u4ea4\u200b\uff08Read uncommitted\uff09\u3001\u200b\u8bfb\u200b\u63d0\u4ea4\u200b\uff08read committed\uff09\u3001\u200b\u53ef\u200b\u91cd\u590d\u200b\u8bfb\u200b\uff08repeatable read\uff09\u200b\u548c\u200b\u4e32\u884c\u5316\u200b\uff08Serializable\uff09\u3002</li> <li>\u200b\u6301\u4e45\u6027\u200b\uff1a \u200b\u4e8b\u52a1\u5904\u7406\u200b\u7ed3\u675f\u200b\u540e\u200b\uff0c\u200b\u5bf9\u200b\u6570\u636e\u200b\u7684\u200b\u4fee\u6539\u200b\u5c31\u662f\u200b\u6c38\u4e45\u200b\u7684\u200b\uff0c\u200b\u5373\u4fbf\u200b\u7cfb\u7edf\u6545\u969c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u4e22\u5931\u200b\u3002</li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_1","title":"\u4e8b\u52a1\u200b\u9694\u79bb\u200b\u7ea7\u522b","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#1","title":"1. \u200b\u8bfb\u672a\u200b\u63d0\u4ea4","text":"<ul> <li>ISOLATION_READ_UNCOMMITTED\uff08\u200b\u8bfb\u672a\u200b\u63d0\u4ea4\u200b\uff09\uff1a\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u4f1a\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u5c1a\u672a\u200b\u66f4\u6539\u200b\u7684\u200b\u63d0\u4ea4\u200b\uff08\u200b\u76f8\u5f53\u4e8e\u200b\u8bfb\u53d6\u200b\u7684\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u4e8b\u52a1\u200b\u6682\u65f6\u200b\u7f13\u5b58\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\uff09</li> </ul> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u8bfb\u200b\u672a\u200b\u63d0\u4ea4\u200b\u7ea7\u522b\u200b\uff0c\u200b\u6b64\u200b\u7ea7\u522b\u200b\u5c5e\u4e8e\u200b\u6700\u4f4e\u200b\u7ea7\u522b\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5404\u4e2a\u200b\u4e8b\u52a1\u200b\u5171\u4eab\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u533a\u57df\u200b\uff0c\u200b\u4efb\u4f55\u200b\u4e8b\u52a1\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u5728\u200b\u8fd9\u91cc\u200b\u8fdb\u884c\u200b\u3002\u200b\u90a3\u4e48\u200b\u5b83\u4f1a\u200b\u5bfc\u81f4\u200b\u4ee5\u4e0b\u200b\u95ee\u9898\u200b\uff1a</p> <p></p> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4e8b\u52a1\u200bA\u200b\u6700\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6beb\u65e0\u610f\u4e49\u200b\u7684\u200b\u6570\u636e\u200b\uff08\u200b\u4e8b\u52a1\u200bB\u200b\u5df2\u7ecf\u200b\u56de\u6eda\u200b\u4e86\u200b\uff09\u200b\u6211\u4eec\u200b\u79f0\u6b64\u200b\u6570\u636e\u200b\u4e3a\u200b \"\u200b\u810f\u200b\u6570\u636e\u200b\" \uff0c\u200b\u8fd9\u79cd\u200b\u73b0\u8c61\u200b\u79f0\u4e3a\u200b\u810f\u8bfb\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#2","title":"2. \u200b\u8bfb\u200b\u5df2\u200b\u63d0\u4ea4","text":"<ul> <li>ISOLATION_READ_COMMITTED\uff08\u200b\u8bfb\u200b\u5df2\u200b\u63d0\u4ea4\u200b\uff09\uff1a\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u4f1a\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u5df2\u7ecf\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6570\u636e\u200b\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b\u76f4\u63a5\u200b\u8bfb\u53d6\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u5df2\u7ecf\u200b\u53d1\u751f\u200b\u66f4\u6539\u200b\u7684\u200b\u5185\u5bb9\u200b\uff09</li> </ul> <p>\u200b\u6211\u4eec\u200b\u63a5\u7740\u200b\u6765\u770b\u200b<code>\u200b\u8bfb\u200b\u5df2\u200b\u63d0\u4ea4\u200b</code>\u200b\u7ea7\u522b\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u53ea\u80fd\u200b\u8bfb\u53d6\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u5df2\u7ecf\u200b\u63d0\u4ea4\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u76f4\u63a5\u200b\u4ece\u200b\u6570\u636e\u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u810f\u8bfb\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u8fd8\u662f\u200b\u5b58\u5728\u200b\u4ee5\u4e0b\u200b\u95ee\u9898\u200b\uff1a</p> <p></p> <p>\u200b\u8fd9\u200b\u6b63\u662f\u200b\u6211\u4eec\u200b\u524d\u9762\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u867d\u7136\u200b\u5b83\u200b\u907f\u514d\u200b\u4e86\u200b\u810f\u8bfb\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u4e8b\u4ef6\u200bB\u200b\u4fee\u6539\u200b\u5e76\u200b\u63d0\u4ea4\u200b\u4e86\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b9e\u9645\u4e0a\u200b\u4e8b\u52a1\u200bA\u200b\u4e4b\u524d\u200b\u8bfb\u53d6\u200b\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u4f9d\u7136\u200b\u4e0d\u662f\u200b\u6700\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5bfc\u81f4\u200b\u4e24\u6b21\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u73b0\u8c61\u200b\u79f0\u4e3a\u200b\u865a\u8bfb\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u79f0\u4e3a\u200b\u4e0d\u53ef\u200b\u91cd\u590d\u200b\u8bfb\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#3","title":"3. \u200b\u53ef\u200b\u91cd\u590d\u200b\u8bfb","text":"<ul> <li>ISOLATION_REPEATABLE_READ\uff08\u200b\u53ef\u200b\u91cd\u590d\u200b\u8bfb\u200b\uff09\uff1a\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u4f1a\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u5df2\u7ecf\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6570\u636e\u200b\u5e76\u4e14\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u518d\u200b\u8fdb\u884c\u200b\u6570\u636e\u200b\u4fee\u6539\u200b\uff08\u200b\u6ce8\u610f\u200b\u8fd9\u91cc\u200b\u4ec5\u4ec5\u200b\u662f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff09</li> </ul> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u9694\u79bb\u200b\u7ea7\u522b\u200b\u53ef\u200b\u91cd\u590d\u200b\u8bfb\u200b\u5c31\u200b\u80fd\u591f\u200b\u89e3\u51b3\u200b\u8fd9\u6837\u200b\u7684\u200b\u95ee\u9898\u200b\uff08MySQL\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u9694\u79bb\u200b\u7ea7\u522b\u200b\uff09\uff0c\u200b\u5b83\u200b\u89c4\u5b9a\u200b\u5728\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u6267\u884c\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6709\u6548\u200b\u5730\u200b\u907f\u514d\u200b\u4e0d\u53ef\u200b\u91cd\u590d\u200b\u8bfb\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e00\u5b9a\u200b\u5b89\u5168\u200b\u4e86\u200b\u5417\u200b\uff1f\u200b\u8fd9\u91cc\u200b\u4ec5\u4ec5\u200b\u662f\u200b\u7981\u6b62\u200b\u4e86\u200b\u4e8b\u52a1\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7684\u200bUPDATE\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u5e76\u200b\u6ca1\u6709\u200b\u7981\u6b62\u200bINSERT\u200b\u8fd9\u200b\u7c7b\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200bA\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4e8b\u52a1\u200bB\u200b\u63d2\u5165\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200bA\u200b\u8fd9\u65f6\u200b\u662f\u200b\u6beb\u4e0d\u200b\u77e5\u60c5\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a</p> <p></p> <p>\u200b\u4e24\u4e2a\u200b\u4eba\u200b\u540c\u65f6\u200b\u62a5\u540d\u200b\u4e00\u4e2a\u200b\u6d3b\u52a8\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u62a5\u540d\u200b\u7684\u200b\u4e8b\u52a1\u200b\u540c\u65f6\u200b\u5728\u200b\u8fdb\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ed6\u4eec\u200b\u4e00\u200b\u5f00\u59cb\u200b\u8bfb\u53d6\u200b\u5230\u200b\u7684\u200b\u4eba\u6570\u200b\u90fd\u200b\u662f\u200b5\uff0c\u200b\u800c\u200b\u8fd9\u65f6\u200b\uff0c\u200b\u5b83\u4eec\u200b\u90fd\u200b\u4f1a\u200b\u8ba4\u4e3a\u200b\u62a5\u540d\u200b\u6210\u529f\u200b\u540e\u200b\u4eba\u6570\u200b\u5e94\u8be5\u200b\u53d8\u6210\u200b6\uff0c\u200b\u800c\u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5e94\u8be5\u200b\u662f\u200b7\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u5c31\u200b\u53d1\u751f\u200b\u4e86\u200b\u6570\u636e\u200b\u7684\u200b\u5e7b\u8bfb\u200b\u73b0\u8c61\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#4","title":"4. \u200b\u4e32\u884c\u5316","text":"<p>\u200b\u8981\u200b\u89e3\u51b3\u200b\u4e0a\u8ff0\u200b\u79cd\u79cd\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ea\u80fd\u200b\u4f7f\u7528\u200b\u6700\u540e\u200b\u4e00\u79cd\u200b\u9694\u79bb\u200b\u7ea7\u522b\u200b\u4e32\u884c\u5316\u200b\u6765\u200b\u5b9e\u73b0\u200b\u4e86\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u4e8b\u52a1\u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff0c\u200b\u76f4\u63a5\u200b\u907f\u514d\u200b\u6240\u6709\u200b\u5e76\u53d1\u200b\u95ee\u9898\u200b\uff0c\u200b\u7b80\u5355\u200b\u7c97\u66b4\u200b\uff0c\u200b\u4f46\u662f\u200b\u6548\u7387\u200b\u7206\u51cf\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u63a8\u8350\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#5","title":"5. \u200b\u5c0f\u7ed3","text":"<p>\u200b\u6700\u540e\u200b\u603b\u7ed3\u200b\u4e09\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p> <ul> <li>\u200b\u810f\u8bfb\u200b\uff1a\u200b\u8bfb\u53d6\u200b\u5230\u200b\u4e86\u200b\u88ab\u200b\u56de\u6eda\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5b83\u200b\u6beb\u65e0\u610f\u4e49\u200b\u3002</li> <li>\u200b\u865a\u8bfb\u200b\uff08\u200b\u4e0d\u53ef\u200b\u91cd\u590d\u200b\u8bfb\u200b\uff09\uff1a\u200b\u7531\u4e8e\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u4e24\u6b21\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u3002</li> <li>\u200b\u5e7b\u8bfb\u200b\uff1a\u200b\u7531\u4e8e\u200b\u5176\u4ed6\u200b\u4e8b\u52a1\u200b\u6267\u884c\u200b\u63d2\u5165\u200b\u5220\u9664\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u800c\u200b\u53c8\u200b\u65e0\u6cd5\u200b\u611f\u77e5\u200b\u5230\u8868\u4e2d\u200b\u8bb0\u5f55\u200b\u6761\u6570\u200b\u53d1\u751f\u53d8\u5316\u200b\uff0c\u200b\u5f53\u4e0b\u200b\u6b21\u200b\u518d\u200b\u8bfb\u53d6\u200b\u65f6\u4f1a\u200b\u83ab\u540d\u5176\u5999\u200b\u591a\u51fa\u200b\u6216\u200b\u7f3a\u5931\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b\u4ea7\u751f\u200b\u5e7b\u89c9\u200b\u4e00\u6837\u200b\u3002</li> </ul> <p>\uff08\u200b\u5bf9\u4e8e\u200b\u865a\u8bfb\u200b\u548c\u200b\u5e7b\u8bfb\u200b\u7684\u200b\u533a\u5206\u200b\uff1a\u200b\u865a\u8bfb\u200b\u662f\u200b\u67d0\u4e2a\u200b\u6570\u636e\u200b\u524d\u540e\u200b\u8bfb\u53d6\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5e7b\u8bfb\u200b\u662f\u200b\u6574\u4e2a\u200b\u8868\u200b\u7684\u200b\u8bb0\u5f55\u200b\u6570\u91cf\u200b\u524d\u540e\u200b\u8bfb\u53d6\u200b\u4e0d\u200b\u4e00\u81f4\u200b)</p> <p>\u200b\u6700\u540e\u200b\u8fd9\u200b\u5f20\u56fe\u200b\uff0c\u200b\u8bf7\u200b\u52a1\u5fc5\u200b\u8bb0\u5728\u200b\u4f60\u200b\u7684\u200b\u8111\u6d77\u200b\uff0c\u200b\u8bb0\u5728\u200b\u4f60\u200b\u7684\u200b\u5fc3\u4e2d\u200b\uff1a</p> <p></p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_2","title":"\u4e8b\u52a1\u200b\u7684\u200b\u4f20\u64ad\u200b\u884c\u4e3a","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_3","title":"\u6982\u8ff0","text":"<p>\u200b\u5f53\u200b\u4e00\u4e2a\u200b <code>service</code> \u200b\u4e2d\u200b\u8c03\u7528\u200b\u4e86\u200b\u53e6\u200b\u4e00\u4e2a\u200b <code>service</code> \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6b64\u65f6\u200b <code>bservice</code> \u200b\u7684\u200b\u4e8b\u52a1\u200b\u4f20\u64ad\u200b\u5230\u200b\u4e86\u200b <code>aservice</code> \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4ea7\u751f\u200b\u4e86\u200b\u4e8b\u52a1\u200b\u7684\u200b\u4f20\u64ad\u200b\uff1a</p> Java<pre><code>@Service\npublic class AService {\n\n    @Autowired\n    private BService bService;\n\n    public void order() {\n        xxx();\n        bService().yyy();\n        zzz();\n    }\n}    \n</code></pre> <p>\u200b\u56e0\u4e3a\u200b\u4e24\u4e2a\u200b <code>service</code> \u200b\u90fd\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u90a3\u4e48\u200b\u751f\u6210\u200b\u7684\u200bsql\u200b\u8bed\u53e5\u200b\u53ef\u80fd\u200b\u5982\u4e0b\u200b\uff1a</p> SQL<pre><code>BEGIN;\n    update xxx;\n    --- \u200b\u4e8b\u52a1\u200b\u5206\u754c\u7ebf\u200b ---\n        begin;\n            update yyy;\n        commit;\n    ----------------\n    update zzz;\ncommit;    \n</code></pre> <p>\u200b\u663e\u7136\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u4e8b\u52a1\u200b\u903b\u8f91\u200b\u5b58\u5728\u200b\u95ee\u9898\u200b\uff0c\u200b\u5f53\u200b\u7b2c\u4e8c\u4e2a\u200b <code>begin</code> \u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u9690\u5f0f\u200b\u5730\u200b\u5c06\u200b\u7b2c\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u4ece\u800c\u200b\u5bfc\u81f4\u200b <code>AService</code> \u200b\u7684\u200b\u90e8\u5206\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u3002 \u200b\u6240\u4ee5\u200b\u5f53\u200b <code>B\u200b\u4e8b\u52a1\u200b</code> \u200b\u4f20\u64ad\u200b\u5230\u200b <code>A\u200b\u4e8b\u52a1\u200b</code> \u200b\u4e2d\u200b\u65f6\u200b <code>B \u200b\u4e8b\u52a1\u200b</code> \u200b\u9700\u8981\u200b\u505a\u200b\u4e00\u4e0b\u200b\u5fae\u8c03\u200b\uff0c\u200b\u5fae\u8c03\u200b\u7684\u200b\u7ed3\u679c\u200b\u5982\u200b\u4e0b\u8ff0\u200b\u51e0\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#1-aservice","title":"1. \u200b\u5f53\u200bAService\u200b\u5b58\u5728\u200b\u4e8b\u52a1","text":"<p>\u200b\u7b2c\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff1a\u200b\u878d\u5165\u200bA\u200b\u4e8b\u52a1\u200b (\u200b\u5373\u200bB\u200b\u4e8b\u52a1\u200b\u5408\u5e76\u200b\u5165\u200bA\u200b\u4e8b\u52a1\u200b) </p> <p>\u200b\u5f62\u6210\u200b\u7684\u200bsql\u200b\u5982\u4e0b\u200b\uff1a</p> SQL<pre><code>BEGIN;\n    update xxx;\n    --- \u200b\u4e8b\u52a1\u200b\u5206\u754c\u7ebf\u200b ---\n        update yyy;\n    ----------------\n    update zzz;\ncommit;   \n</code></pre> <p> </p> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u60c5\u51b5\u200b\uff1a\u200b\u6302\u200b\u8d77\u200bA\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u8ba9\u200bB\u200b\u4e8b\u52a1\u200b\u72ec\u7acb\u200b\u4e8e\u200bA\u200b\u4e8b\u52a1\u200b\u8fd0\u884c\u200b\u3002</p> <p>\u200b\u5f53\u200b\u4e24\u4e2a\u200b\u4e8b\u52a1\u200b\u9700\u8981\u200b\u5404\u81ea\u200b\u72ec\u7acb\u200b\u7ef4\u62a4\u200b\u81ea\u8eab\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5355\u4e2a\u200b\u4e8b\u52a1\u200b\u65e0\u6cd5\u200b\u72ec\u7acb\u200b\u5b8c\u6210\u200b\uff0cB\u200b\u4e8b\u52a1\u200b\u542f\u52a8\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u6682\u65f6\u200b\u5c06\u200bA\u200b\u4e8b\u52a1\u200b\u6302\u200b\u8d77\u200b\uff0c\u200b\u5373\u200b\u963b\u585e\u200bA\uff0c\u200b\u4e14\u200b\u4e0d\u200b\u5411\u200bA\u200b\u53d1\u9001\u200bsql\uff0c\u200b\u4f7f\u5f97\u200b\u5176\u200b\u65e0\u6cd5\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u800c\u200bB\u200b\u5f00\u542f\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u4e8b\u52a1\u200b\uff0cB\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u540e\u200bA\u200b\u7ee7\u7eed\u200b\u3002</p> <p></p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#2-aservice","title":"2. \u200b\u5f53\u200bAService\u200b\u65e0\u200b\u4e8b\u52a1","text":"<p>\u200b\u7b2c\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff1aB\u200b\u4e8b\u52a1\u200b\u4ee5\u200b\u4e8b\u52a1\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fd0\u884c\u200b</p> SQL<pre><code>select xxx;\n    --- \u200b\u5206\u754c\u7ebf\u200b ---\n    begin;\n        update yyy;\n    commit;\n    -------------\nselect zzz;    \n</code></pre> <p></p> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u60c5\u51b5\u200b\uff1aB\u200b\u4e8b\u52a1\u200b\u4ee5\u200b\u65e0\u200b\u4e8b\u52a1\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fd0\u884c\u200b</p> SQL<pre><code>select xxx;\n    --- \u200b\u5206\u754c\u7ebf\u200b ---\n    select yyy;\n    -------------\nselect zzz;    \n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#3_1","title":"3. \u200b\u5d4c\u5957\u200b\u4e8b\u52a1","text":"<p>\u200b\u901a\u8fc7\u200b\u8bbe\u7f6e\u200b\u4fdd\u5b58\u200b\u70b9\u200b\uff0c\u200b\u5c06\u200b\u5185\u90e8\u200b\u7684\u200b\u4e8b\u52a1\u200b\u8f6c\u5316\u200b\u4e3a\u200b \u200b\u8bbe\u7f6e\u200b\u4fdd\u5b58\u200b\u70b9\u200b \u200b\u548c\u200b \u200b\u56de\u6eda\u200b\u81f3\u200b\u4fdd\u5b58\u200b\u70b9\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7c7b\u4f3c\u200b\u4e24\u4e2a\u200b\u4e8b\u52a1\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> SQL<pre><code>begin;\n    update xxx;\n    savepoint a;\n        update yyy;\n        --- \u200b\u82e5\u200b\u62a5\u9519\u200b\uff0c\u200b\u56de\u6eda\u200b\u81f3\u200b\u4fdd\u5b58\u200b\u70b9\u200ba\n    rollback to a;\n    --- \u200b\u540e\u7eed\u200b\u4e8b\u52a1\u200b\u4e0d\u200b\u53d7\u200b\u5f71\u54cd\u200b\n    update zzz;\ncommit;    \n</code></pre> <p>\u200b\u5d4c\u5957\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u5185\u90e8\u200b <code>SAVEPOINT a</code> \u200b\u540e\u200b\u7684\u200b\u4ee3\u7801\u200b\u5982\u679c\u200b\u62a5\u9519\u200b\u5219\u200b\u76f4\u63a5\u200b\u56de\u6eda\u200b\u5230\u200b\u4fdd\u5b58\u200b\u70b9\u200b</li> <li>\u200b\u6574\u4e2a\u200b\u4e8b\u52a1\u200b\u7684\u200b\u63d0\u4ea4\u200b\u4e0d\u200b\u6536\u200b\u5185\u90e8\u200b \u200b\u4f2a\u200b\u4e8b\u52a1\u200b \u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_4","title":"\u4f20\u64ad\u200b\u884c\u4e3a","text":"<ol> <li>PROPAGATION_REQUIRED\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u65b9\u6cd5\u200b\u5fc5\u987b\u200b\u8fd0\u884c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u3002\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u5b58\u5728\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u5c06\u4f1a\u200b\u5728\u200b\u8be5\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u3002\u200b\u5426\u5219\u200b\uff0c\u200b\u4f1a\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u4e8b\u52a1\u200b\u3002REQUIRED \u200b\u8868\u793a\u200b\u9700\u8981\u200b\uff0c\u200b\u5373\u200b B\u200b\u4e8b\u52a1\u200b\u65e0\u8bba\u5982\u4f55\u200b\u90fd\u200b\u8981\u200b\u6709\u200b\u4e8b\u52a1\u200b\u3002</li> <li>PROPAGATION_SUPPORTS\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u65b9\u6cd5\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e8b\u52a1\u200b\u4e0a\u4e0b\u6587\u200b\u3002\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u8fd0\u884c\u200b</li> <li>PROPAGATION_MANDATORY\uff1a(\u200b\u5f3a\u5236\u6027\u200b\u7684\u200b) \u200b\u8868\u793a\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5fc5\u987b\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u3002\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u629b\u51fa\u200b\u4e00\u4e2a\u200b\u5f02\u5e38\u200b\u3002</li> <li>PROPAGATION_REQUIRES_NEW\uff1a(\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u4e8b\u52a1\u200b) \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u65b9\u6cd5\u200b\u5fc5\u987b\u200b\u8fd0\u884c\u200b\u5728\u200b\u5b83\u200b\u81ea\u5df1\u200b\u7684\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u3002\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u4e8b\u52a1\u200b\u5c06\u200b\u88ab\u200b\u542f\u52a8\u200b\u3002\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5728\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u671f\u95f4\u200b\uff0c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u4f1a\u200b\u88ab\u200b\u6302\u200b\u8d77\u200b\u3002</li> <li>PROPAGATION_NOT_SUPPORTED\uff1a(\u200b\u4e0d\u200b\u652f\u6301\u200b\u4e8b\u52a1\u200b) \u200b\u8868\u793a\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u8fd0\u884c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u3002\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5728\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u8fd0\u884c\u200b\u671f\u95f4\u200b\uff0c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u5c06\u200b\u88ab\u200b\u6302\u200b\u8d77\u200b\u3002</li> <li>PROPAGATION_NEVER\uff1a(\u200b\u4e0d\u4f1a\u200b\u8fd0\u884c\u200b\u5728\u200b\u6709\u200b\u4e8b\u52a1\u200b\u7684\u200b\u73af\u5883\u200b) \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u65b9\u6cd5\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u8fd0\u884c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u6709\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> <li>PROPAGATION_NESTED\uff1a(\u200b\u5d4c\u5957\u200b\u7684\u200b) \u200b\u8868\u793a\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u5df2\u7ecf\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5c06\u4f1a\u200b\u5728\u200b\u5d4c\u5957\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u3002\u200b\u5d4c\u5957\u200b\u7684\u200b\u4e8b\u52a1\u200b\u53ef\u4ee5\u200b\u72ec\u7acb\u200b\u4e8e\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u8fdb\u884c\u200b\u72ec\u7acb\u200b\u5730\u200b\u63d0\u4ea4\u200b\u6216\u200b\u56de\u6eda\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u200b\u884c\u4e3a\u200b\u4e0e\u200b REQUIRED \u200b\u4e00\u6837\u200b\u3002\u200b\u6ce8\u610f\u200b\u4e0d\u540c\u200b\u6570\u636e\u5e93\u200b\u5bf9\u200b\u8fd9\u79cd\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u7684\u200b\u652f\u6301\u200b\u662f\u200b\u6709\u6240\u200b\u5dee\u5f02\u200b\u7684\u200b\u3002\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u8d44\u6e90\u7ba1\u7406\u200b\u5668\u200b\u7684\u200b\u6587\u6863\u200b\u6765\u200b\u786e\u8ba4\u200b\u5b83\u4eec\u200b\u662f\u5426\u200b\u652f\u6301\u200b\u5d4c\u5957\u200b\u4e8b\u52a1\u200b\u3002</li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#spring_1","title":"Spring\u200b\u4e8b\u52a1\u7ba1\u7406","text":"<p>spring\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5982\u4e0b\u200b\u51e0\u4e2a\u200b\u6838\u5fc3\u200b\u7684\u200b\u7ec4\u4ef6\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8fdb\u884c\u200b\u4e8b\u52a1\u7ba1\u7406\u200b\uff1a</p> <ol> <li>PlatformTransactionManager<ul> <li>\u200b\u662f\u200b\u4e8b\u52a1\u7ba1\u7406\u200b\u7684\u200b\u6838\u5fc3\u200b\u63a5\u53e3\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u5f00\u542f\u200b\u3001\u200b\u63d0\u4ea4\u200b\u3001\u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\u3002</li> </ul> </li> <li>TransactionDefinition \uff1a<ul> <li>\u200b\u8be5\u200b\u63a5\u53e3\u200b\u5141\u8bb8\u200b\u5f00\u53d1\u8005\u200b\u5b9a\u5236\u200b\u4e8b\u52a1\u200b\u7684\u200b\u5404\u79cd\u200b\u5c5e\u6027\u200b\uff0c\u200b\u5982\u200b\u9694\u79bb\u200b\u7ea7\u522b\u200b\u3001\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u3001\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u4ee5\u53ca\u200b\u662f\u5426\u200b\u53ea\u8bfb\u200b\u3002</li> </ul> </li> <li>TransactionStatus\uff1a<ul> <li>\u200b\u8be5\u200b\u63a5\u53e3\u200b\u7528\u4e8e\u200b\u8bb0\u5f55\u200b\u4e8b\u52a1\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u5b83\u200b\u5305\u542b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5173\u952e\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u662f\u5426\u200b\u5904\u4e8e\u200b\u6d3b\u52a8\u72b6\u6001\u200b\u3001\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u63d0\u4ea4\u200b\u3001\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u56de\u6eda\u200b\uff0c\u200b\u6302\u200b\u8d77\u200b\u7684\u200b\u8d44\u6e90\u200b\u7b49\u200b\u3002</li> <li>\u200b\u901a\u8fc7\u200b\u68c0\u67e5\u200b\u4e8b\u52a1\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b\u53ef\u4ee5\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u7ee7\u7eed\u6267\u884c\u200b\u4e8b\u52a1\u200b\u64cd\u4f5c\u200b\u3002</li> </ul> </li> <li>TransactionSynchronizationManager<ul> <li>\u200b\u8be5\u200b\u7ec4\u4ef6\u200b\u4e3a\u200b <code>Spring</code> \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u79cd\u200b\u7edf\u4e00\u200b\u548c\u200b\u7075\u6d3b\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u5b9a\u4e49\u200b\u548c\u200b\u914d\u7f6e\u200b\u4e8b\u52a1\u200b\u7684\u200b\u5404\u79cd\u200b\u5c5e\u6027\u200b\uff0c\u200b\u4f7f\u200b\u5f00\u53d1\u8005\u200b\u80fd\u591f\u200b\u6839\u636e\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e1a\u52a1\u200b\u9700\u6c42\u200b\u8c03\u6574\u200b\u4e8b\u52a1\u200b\u7684\u200b\u884c\u4e3a\u200b\u3002</li> </ul> </li> <li>TransactionSynchronization \u200b\u8be5\u200b\u63a5\u53e3\u200b\u7528\u4e8e\u200b\u5728\u200b\u4e8b\u52a1\u200b\u5904\u7406\u8fc7\u7a0b\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u540c\u6b65\u200b\u56de\u8c03\u200b\uff1a<ul> <li><code>TransactionSynchronization</code> \u200b\u63a5\u53e3\u200b\u4e3a\u200b <code>Spring</code> \u200b\u4e8b\u52a1\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u7075\u6d3b\u200b\u7684\u200b\u6269\u5c55\u200b\u673a\u5236\u200b\u3002</li> <li>\u200b\u901a\u8fc7\u200b\u6ce8\u518c\u200b\u5230\u200b <code>TransactionSynchronizationManager</code>\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u3001\u200b\u56de\u6eda\u200b\u6216\u200b\u5b8c\u6210\u200b\u540e\u200b\u6267\u884c\u200b\u76f8\u5e94\u200b\u7684\u200b\u903b\u8f91\u200b\u3002</li> <li>\u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u3001\u200b\u8d44\u6e90\u200b\u6e05\u7406\u200b\u3001\u200b\u7f13\u5b58\u200b\u5237\u65b0\u200b\u7b49\u200b\u4efb\u52a1\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002</li> <li>\u200b\u6839\u636e\u200b\u4e1a\u52a1\u200b\u9700\u6c42\u200b\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4ee5\u200b\u6ee1\u8db3\u200b\u7279\u5b9a\u200b\u7684\u200b\u4e8b\u52a1\u5904\u7406\u200b\u9700\u6c42\u200b\u3002</li> </ul> </li> <li>TransactionSynchronization \u200b\u63a5\u53e3\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff1a</li> </ol> Java<pre><code>public interface TransactionSynchronization extends Ordered, Flushable {\n\n    // \u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u72b6\u6001\u200b\n    int STATUS_COMMITTED = 0;\n\n    // \u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b\u72b6\u6001\u200b\n    int STATUS_ROLLED_BACK = 1;\n\n    // \u200b\u4e8b\u52a1\u200b\u72b6\u6001\u200b\u672a\u77e5\u200b\n    int STATUS_UNKNOWN = 2;\n\n\n    // \u200b\u8fd4\u56de\u200b\u6b64\u200b\u4e8b\u52a1\u200b\u540c\u6b65\u200b\u7684\u200b\u6267\u884c\u200b\u987a\u5e8f\u200b\u3002\n    @Override\n    default int getOrder() {\n        return Ordered.LOWEST_PRECEDENCE;\n    }\n\n    // \u200b\u6682\u505c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u7528\u4e8e\u200b\u6302\u200b\u8d77\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u672c\u8d28\u200b\u662f\u200b\u5c06\u200b\u5f53\u524d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u89e3\u7ed1\u200b\n    default void suspend() {}\n\n    //\u200b\u6062\u590d\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5c06\u200b\u5df2\u7ecf\u200b\u6682\u505c\u200b\u7684\u200b\u4e8b\u52a1\u200b\u4e0e\u200b\u5f53\u524d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u91cd\u65b0\u200b\u7ed1\u5b9a\u200b\n    default void resume() {}\n\n    // \u200b\u5982\u679c\u200b\u9002\u7528\u200b\uff0c\u200b\u5c06\u200b\u5e95\u5c42\u200b\u4f1a\u8bdd\u200b\u5237\u65b0\u200b\u5230\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b:\n    @Override\n    default void flush() {\n    }\n\n    // \u200b\u5728\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u4e4b\u524d\u200b\u8c03\u7528\u200b(\u200b\u5728\u200b\"beforeCompletion\"\u200b\u4e4b\u524d\u200b)\u3002\n    // \u200b\u6b64\u200b\u56de\u8c03\u200b\u5e76\u200b\u4e0d\u200b\u610f\u5473\u7740\u200b\u4e8b\u52a1\u200b\u5c06\u200b\u5b9e\u9645\u200b\u63d0\u4ea4\u200b\u3002\u200b\u5728\u200b\u8c03\u7528\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u53d1\u751f\u200b\u56de\u6eda\u200b\u51b3\u7b56\u200b\u3002\n    // \u200b\u6b64\u200b\u56de\u8c03\u200b\u662f\u200b\u4e3a\u4e86\u200b\u6267\u884c\u200b\u4ec5\u200b\u5728\u200b\u63d0\u4ea4\u200b\u4ecd\u200b\u6709\u200b\u673a\u4f1a\u200b\u53d1\u751f\u200b\u65f6\u624d\u200b\u76f8\u5173\u200b\u7684\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5c06\u200bSQL\u200b\u8bed\u53e5\u200b\u5237\u65b0\u200b\u5230\u200b\u6570\u636e\u5e93\u200b\u3002\n    default void beforeCommit(boolean readOnly) {}\n\n    // \u200b\u5728\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b/\u200b\u56de\u6eda\u200b\u4e4b\u524d\u200b\u8c03\u7528\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e8b\u52a1\u200b\u5b8c\u6210\u200b\u4e4b\u524d\u200b\u6267\u884c\u200b\u8d44\u6e90\u200b\u6e05\u7406\u200b\u3002\n    default void beforeCompletion() {\n    }\n\n    // \u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u540e\u200b\u8c03\u7528\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e3b\u200b\u4e8b\u52a1\u200b\u6210\u529f\u200b\u63d0\u4ea4\u200b\u540e\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\u8fdb\u4e00\u6b65\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\n    // \u200b\u4f8b\u5982\u200b\uff0c\u200b\u5728\u200b\u4e3b\u200b\u4e8b\u52a1\u200b\u6210\u529f\u200b\u63d0\u4ea4\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u4ea4\u200b\u8fdb\u4e00\u6b65\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u200b\u786e\u8ba4\u200b\u6d88\u606f\u200b\u6216\u7535\u5b50\u90ae\u4ef6\u200b\u3002\n    default void afterCommit() {\n    }\n\n    // \u200b\u5728\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b/\u200b\u56de\u6eda\u200b\u540e\u200b\u8c03\u7528\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e8b\u52a1\u200b\u5b8c\u6210\u200b\u540e\u200b\u6267\u884c\u200b\u8d44\u6e90\u200b\u6e05\u7406\u200b\u3002\n    default void afterCompletion(int status) { }\n\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#platformtransactionmanager","title":"\u6838\u5fc3\u200b\u63a5\u53e3\u200b PlatformTransactionManager","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_5","title":"\u7ee7\u627f\u200b\u5173\u7cfb\u200b\u4e0e\u200b\u65b9\u6cd5\u200b\u57fa\u672c\u200b\u6982\u89c8","text":"<p>\u200b\u7ee7\u627f\u200b\u5173\u7cfb\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <ul> <li>PlatformTransactionManager</li> <li>\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u91cd\u8981\u200b\u7684\u200b\u63a5\u53e3\u200b\u3002\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u83b7\u53d6\u200b\u4e8b\u52a1\u200b\u72b6\u6001\u200b\u3001\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\u3001\u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b\u7b49\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>TransactionStatus getTransaction(@Nullable TransactionDefinition definition)\n\nvoid commit(TransactionStatus status)\n\nvoid rollback(TransactionStatus status)\n</code></pre> <ul> <li>AbstractPlatformTransactionManager</li> <li>\u200b\u4e8b\u52a1\u7ba1\u7406\u200b\u7684\u200b\u62bd\u8c61\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u3002\u200b\u91c7\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u5957\u8def\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e8b\u52a1\u200b\u7684\u200b\u64cd\u4f5c\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b\u83b7\u53d6\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b\u3002\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u6570\u636e\u6e90\u200b\u4e0a\u200b\u64cd\u4f5c\u200b\u53c8\u200b\u6709\u200b\u533a\u522b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8be5\u200b\u62bd\u8c61\u7c7b\u200b\u540c\u65f6\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u9700\u8981\u200b\u5b50\u7c7b\u200b\u53bb\u200b\u5b9e\u9645\u200b\u6267\u884c\u200b\u7684\u200b\u62bd\u8c61\u200b\u65b9\u6cd5\u200b\u3002</li> <li> <p><code>java     TransactionStatus getTransaction(@Nullable TransactionDefinition definition)</code></p> <p>\u200b\u83b7\u53d6\u200b\u4e8b\u52a1\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u6709\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u6839\u636e\u200b\u5b9a\u4e49\u200b\u7684\u200b\u4e8b\u52a1\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b</li> <li>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6839\u636e\u200b\u4e8b\u52a1\u200b\u7684\u200b\u5b9a\u4e49\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b</li> <li><code>java void commit(TransactionStatus status)</code></li> </ul> <p>\u200b\u6839\u636e\u200b\u4e8b\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u51c6\u5907\u200b\u8fdb\u884c\u200b\u4e8b\u52a1\u200b\u7684\u200b\u63d0\u4ea4\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u771f\u6b63\u200b\u7684\u200b\u63d0\u4ea4\u200b\u4ea4\u7ed9\u200b<code>doRollback(DefaultTransactionStatus status)</code></p> </li> <li> <p><code>java     void rollback(TransactionStatus status)</code></p> <p>\u200b\u5f00\u59cb\u200b\u51c6\u5907\u200b\u8fdb\u884c\u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b</p> </li> <li> <p><code>java     abstract Object doGetTransaction()</code></p> <p>\u200b\u4e3a\u200b\u5f53\u524d\u200b\u7684\u200b\u4e8b\u52a1\u200b\u72b6\u6001\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u5bf9\u8c61\u200b\u3002\u200b\u5f97\u5230\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u540e\u200b\u5728\u200b\u4ea4\u7ed9\u200b\u5176\u4ed6\u200b\u6a21\u7248\u200b\u65b9\u6cd5\u200b\u53bb\u200b\u5904\u7406\u200b</p> </li> <li> <p><code>java     Object doSuspend(Object transaction)</code></p> <p>\u200b\u6302\u200b\u8d77\u200b\u6307\u5b9a\u200b\u7684\u200b\u4e8b\u52a1\u200b</p> </li> <li> <p><code>java     abstract void doBegin(Object transaction, TransactionDefinition definition)</code></p> <p>\u200b\u6839\u636e\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u4e8b\u52a1\u200b\u5b9a\u4e49\u200b\u5f00\u59cb\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5728\u6b64\u4e4b\u524d\u200b\u8981\u4e48\u200b\u6ca1\u6709\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u8981\u4e48\u200b\u5b58\u5728\u200b\u7684\u200b\u4e8b\u52a1\u200b\u5df2\u200b\u88ab\u200b\u6302\u200b\u8d77\u200b\u3002\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u653e\u5fc3\u5927\u80c6\u200b\u7684\u200b\u5f00\u59cb\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u4e8b\u52a1\u200b\u3002</p> </li> <li> <p><code>java     abstract void doCommit(DefaultTransactionStatus status)</code></p> <p>\u200b\u5bf9\u4e8e\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u4e8b\u52a1\u200b\u8fdb\u884c\u200b\u63d0\u4ea4\u200b\u64cd\u4f5c\u200b</p> </li> <li> <p><code>java     abstract void doRollback(DefaultTransactionStatus status)</code></p> <p>\u200b\u5bf9\u4e8e\u200b\u6307\u5b9a\u200b\u7684\u200b\u4e8b\u52a1\u200b\u6267\u884c\u200b\u56de\u6eda\u200b\u64cd\u4f5c\u200b</p> </li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_6","title":"\u83b7\u53d6\u200b\u4e8b\u52a1\u200b\u5bf9\u8c61","text":"<p>\u200b\u62bd\u8c61\u7c7b\u200b<code>AbstractPlatformTransactionManager</code>\u200b\u7684\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\u5b9e\u73b0\u200b\uff1a</p> Java<pre><code>// \u200b\u6838\u5fc3\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u83b7\u53d6\u200b\u4e8b\u52a1\u200b\u5bf9\u8c61\u200b\n@Override\npublic final TransactionStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException {\n\n    // \u200b\u5982\u679c\u200b\u6709\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u4e8b\u52a1\u200b\u914d\u7f6e\u200b\uff0c\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u4e8b\u52a1\u200b\u914d\u7f6e\u200b\uff08\u200b\u9694\u79bb\u200b\u7ea7\u522b\u200b\uff0c\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u7b49\u200b\uff09\n    TransactionDefinition def = (definition != null ? definition : TransactionDefinition.withDefaults());\n\n    // \u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u6216\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4f46\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u7684\u200b\u8fde\u63a5\u200b\u8d44\u6e90\u200b\u662f\u4ece\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ed1\u5b9a\u200b\u8d44\u6e90\u200b\u4e2d\u200b\u67e5\u627e\u200b\n    Object transaction = doGetTransaction();\n    boolean debugEnabled = logger.isDebugEnabled();\n\n    // \u200b\u73b0\u6709\u200b\u4e8b\u52a1\u200b\u88ab\u200b\u53d1\u73b0\u200b\n    if (isExistingTransaction(transaction)) {\n        // \u200b\u68c0\u67e5\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\uff0c\u200b\u6839\u636e\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u521b\u5efa\u200b\u5185\u90e8\u4e8b\u52a1\u200b\n        // \u200b\u5982\u200b\uff1aREQUIRES_NEW \u200b\u5c31\u200b\u4f1a\u200b\u6302\u200b\u8d77\u200b\u5916\u90e8\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5f00\u542f\u200b\u65b0\u200b\u4e8b\u7269\u200b\u8fd4\u56de\u200b\n        return handleExistingTransaction(def, transaction, debugEnabled);\n    }\n\n    // \u200b\u68c0\u67e5\u200b\u65b0\u200b\u4e8b\u52a1\u200b\u7684\u200b\u5b9a\u4e49\u200b\u8bbe\u7f6e\u200b\u3002\n    if (def.getTimeout() &lt; TransactionDefinition.TIMEOUT_DEFAULT) {\n        throw new InvalidTimeoutException(\"Invalid transaction timeout\", def.getTimeout());\n    }\n\n    // \u200b\u6ca1\u6709\u200b\u53d1\u73b0\u200b\u73b0\u6709\u200b\u4e8b\u52a1\u200b-&gt;\u200b\u68c0\u67e5\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\uff0c\u200b\u7ee7\u7eed\u6267\u884c\u200b\n    // PROPAGATION_MANDATORY\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5fc5\u987b\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u629b\u51fa\u200b\u4e00\u4e2a\u200b\u5f02\u5e38\u200b\n    if (def.getPropagationBehavior() == TransactionDefinition.PROPAGATION_MANDATORY) {\n        throw new IllegalTransactionStateException(\"No existing transaction found for transaction marked with propagation 'mandatory'\");\n    }\n    // NESTED\uff0cREQUIRED \uff0cREQUIRES_NEW \u200b\u5c31\u200b\u4f1a\u200b\u5f00\u542f\u200b\u4e8b\u52a1\u200b\n    else if (def.getPropagationBehavior() == TransactionDefinition.PROPAGATION_REQUIRED        ||def.getPropagationBehavior() == TransactionDefinition.PROPAGATION_REQUIRES_NEW \n       ||def.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NESTED) {\n        SuspendedResourcesHolder suspendedResources = suspend(null);\n        if (debugEnabled) {\n            logger.debug(\"Creating new transaction with name [\" + def.getName() + \"]: \" + def);\n        }\n        try {\n            // \u200b\u76f4\u63a5\u200b\u542f\u52a8\u200b\u4e8b\u52a1\u200b\n            return startTransaction(def, transaction, debugEnabled, suspendedResources);\n        }\n        catch (RuntimeException | Error ex) {\n            resume(null, suspendedResources);\n            throw ex;\n        }\n    }\n    else {\n        // \u200b\u5269\u4e0b\u200b\u7684\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\n        // SUPPORTS NOT_SUPPORTED   NEVER\n        // \u200b\u521b\u5efa\u200b\u201c\u200b\u7a7a\u200b\u201d\u200b\u4e8b\u52a1\u200b:\u200b\u6ca1\u6709\u200b\u5b9e\u9645\u200b\u4e8b\u52a1\u200b\uff08\u200b\u4e0d\u4f1a\u200b\u5c06\u200bconnection\u200b\u7684\u200bautocommitted\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bfalse\uff09\n        if (def.getIsolationLevel() != TransactionDefinition.ISOLATION_DEFAULT &amp;&amp; logger.isWarnEnabled()) {\n            logger.warn(\"Custom isolation level specified but no actual transaction initiated; \" + \"isolation level will effectively be ignored: \" + def);\n        }\n        boolean newSynchronization = (getTransactionSynchronization() == SYNCHRONIZATION_ALWAYS);\n        return prepareTransactionStatus(def, null, true, newSynchronization, debugEnabled, null);\n    }\n}\n</code></pre> <p></p> <p>\u200b\u9996\u5148\u200b\u901a\u8fc7\u200b <code>doGetTransaction</code> \u200b\u65b9\u6cd5\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7684\u200b\u4e8b\u52a1\u200b</p> <p>1. \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u200b <code>isExistingTransaction(transaction)</code></p> <p>\u200b\u8fdb\u5165\u200b <code>handleExistingTransaction(def, transaction, debugEnabled)</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5904\u7406\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4e8b\u52a1\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b</p> Java<pre><code>@Override\nprotected boolean isExistingTransaction(Object transaction) {\n    DataSourceTransactionObject txObject = (DataSourceTransactionObject) transaction;\n    return (txObject.hasConnectionHolder() &amp;&amp; txObject.getConnectionHolder().isTransactionActive());\n}\n</code></pre> <p>\u200b\u5904\u7406\u200b\u5f53\u200b\u5916\u90e8\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u65f6\u200b\u7684\u200b\u72b6\u6001\u200b\uff1a</p> Java<pre><code>private TransactionStatus handleExistingTransaction(\n    TransactionDefinition definition, Object transaction, boolean debugEnabled)\n    throws TransactionException {\n\n    // \u200b\u5982\u679c\u200b\u662f\u200bnever\uff0c\u200b\u56e0\u4e3a\u200b\u5b58\u5728\u200b\u5916\u754c\u200b\u4e8b\u52a1\u200b\u6240\u4ee5\u200b\u76f4\u63a5\u200b\u629b\u200b\u5f02\u5e38\u200b\n    if (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NEVER) {\n        throw new IllegalTransactionStateException(\n            \"Existing transaction found for transaction marked with propagation 'never'\");\n    }\n    // NOT_SUPPORTED\u200b\u8868\u793a\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u8fd0\u884c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u3002\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5728\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u8fd0\u884c\u200b\u671f\u95f4\u200b\uff0c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u5c06\u200b\u88ab\u200b\u6302\u200b\u8d77\u200b\n    if (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NOT_SUPPORTED) {\n        if (debugEnabled) {\n            logger.debug(\"Suspending current transaction\");\n        }\n        // \u200b\u6302\u200b\u8d77\u200b\u5916\u90e8\u200b\u4e8b\u52a1\u200b\n        Object suspendedResources = suspend(transaction);\n        // \u200b\u8bbe\u7f6e\u200b\u540c\u6b65\u5668\u200b\n        boolean newSynchronization = (getTransactionSynchronization() == SYNCHRONIZATION_ALWAYS);\n        // \u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e0d\u4f1a\u200b\u771f\u5b9e\u200b\u7684\u200b\u521b\u5efa\u200b\u4e8b\u52a1\u200b\n        // \u200b\u65b0\u521b\u5efa\u200b\u7684\u200bTransactionStatus\u200b\u4f1a\u200b\u6301\u6709\u200b\u5df2\u7ecf\u200b\u6302\u200b\u8d77\u200b\u7684\u200b\u8fde\u63a5\u200b\u8d44\u6e90\u200b\n        return prepareTransactionStatus(\n            definition, null, false, newSynchronization, debugEnabled, suspendedResources);\n    }\n     // REQUIRES_NEW\n    if (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_REQUIRES_NEW) {\n        if (debugEnabled) {\n            logger.debug(\"Suspending current transaction, creating new transaction with name [\" +\n                         definition.getName() + \"]\");\n        }\n        SuspendedResourcesHolder suspendedResources = suspend(transaction);\n        try {\n            // \u200b\u6302\u200b\u8d77\u200b\u5916\u90e8\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5f00\u542f\u200b\u65b0\u200b\u7684\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u4e5f\u200b\u4f1a\u200b\u6301\u6709\u200b\u5df2\u7ecf\u200b\u6302\u200b\u8d77\u200b\u7684\u200b\u8fde\u63a5\u200b\u8d44\u6e90\u200b\n            return startTransaction(definition, transaction, debugEnabled, suspendedResources);\n        }\n        catch (RuntimeException | Error beginEx) {\n            resumeAfterBeginException(transaction, suspendedResources, beginEx);\n            throw beginEx;\n        }\n    }\n     //NESTED \u200b\u5d4c\u5957\u200b\u4e8b\u52a1\u200b\n    if (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NESTED) {\n        if (!isNestedTransactionAllowed()) {\n            throw new NestedTransactionNotSupportedException(\n                \"Transaction manager does not allow nested transactions by default - \" + \"specify 'nestedTransactionAllowed' property with value 'true'\");\n        }\n        if (debugEnabled) {\n            logger.debug(\"Creating nested transaction with name [\" + definition.getName() + \"]\");\n        }\n        // \u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200bsavepoint\u200b\u6765\u200b\u751f\u6210\u200b\u5d4c\u5957\u200b\u4e8b\u52a1\u200b\uff08mysql\uff09\n        if (useSavepointForNestedTransaction()) {\n            DefaultTransactionStatus status =\n                prepareTransactionStatus(definition, transaction, false, false, debugEnabled, null);\n            // \u200b\u521b\u5efa\u200b\u4fdd\u5b58\u200b\u70b9\u200b\n            status.createAndHoldSavepoint();\n            return status;\n        } else {\n\n            return startTransaction(definition, transaction, debugEnabled, null);\n        }\n    }\n\n    // \u200b\u5176\u4ed6\u200bREQUIRED\uff0cSUPPORTS\uff0cMANDATORY\uff0c\u200b\u878d\u5165\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u200b\u540c\u6b65\u200b\n    // \u200b\u56e0\u4e3a\u200b\u5916\u754c\u200b\u6709\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u6b64\u6b21\u200b\u5f00\u200b\u4e00\u4e2a\u200b\u7a7a\u200b\u4e8b\u52a1\u200b\u5373\u53ef\u200b\n    boolean newSynchronization = (getTransactionSynchronization() != SYNCHRONIZATION_NEVER);\n    return prepareTransactionStatus(definition, transaction, false, newSynchronization, debugEnabled, null);\n}\n</code></pre> <p>2. \u200b\u5f53\u524d\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5219\u200b\u5728\u200b\u5f53\u524d\u200b\u65b9\u6cd5\u200b\u5185\u200b\u5904\u7406\u200b\u5916\u90e8\u200b\u65e0\u200b\u4e8b\u52a1\u200b\u7684\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#transactional","title":"@Transactional \u200b\u6ce8\u89e3","text":"Java<pre><code>public @interface Transactional {\n    @AliasFor(\"transactionManager\")\n    String value() default \"\";\n\n    // \u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b\u3001\u200b\u6682\u65f6\u200b\u5148\u200b\u5ffd\u7565\u200b\u5b83\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u53bb\u200b\u4fee\u6539\u200b\u8fd9\u4e2a\u200b\u53c2\u6570\u200b\u7684\u200b\u503c\u200b\n    @AliasFor(\"value\")\n    String transactionManager() default \"\";\n\n    String[] label() default {};\n\n    // \u200b\u4e8b\u52a1\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\n    Propagation propagation() default Propagation.REQUIRED;\n\n    // \u200b\u4e8b\u52a1\u200b\u9694\u79bb\u200b\u7ea7\u522b\u200b\n    Isolation isolation() default Isolation.DEFAULT;\n\n    // \u200b\u4e8b\u52a1\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b -1\uff0c\u200b\u4e3a\u200b\u6c38\u4e45\u200b\u4e0d\u200b\u8d85\u65f6\u200b\uff0c \u200b\u5355\u4f4d\u200b\u662f\u200b\u79d2\u200b\n    int timeout() default -1;\n\n    // \u200b\u4e8b\u52a1\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u5355\u4f4d\u200b\uff0c\u200b\u6bd4\u5982\u200b timeoutString = \"30s\"\n    String timeoutString() default \"\";\n\n    // \u200b\u662f\u5426\u200b\u53ea\u8bfb\u200b\u4e8b\u52a1\u200b\n    boolean readOnly() default false;\n\n    // \u200b\u5bf9\u200b\u54ea\u4e9b\u200b\u5f02\u5e38\u200b\u8fdb\u884c\u200b\u56de\u6eda\u200b\n    Class&lt;? extends Throwable&gt;[] rollbackFor() default {};\n\n    // \u200b\u5bf9\u200b\u54ea\u4e9b\u200b\u5f02\u5e38\u200b\u8fdb\u884c\u200b\u56de\u6eda\u200b\u3010\u200b\u5f02\u5e38\u200b\u5168\u200b\u9650\u5b9a\u200b\u540d\u200b\u3011\n    String[] rollbackForClassName() default {};\n\n    // \u200b\u5bf9\u200b\u54ea\u4e9b\u200b\u5f02\u5e38\u200b\u4e0d\u56de\u200b\u6eda\u200b\n    Class&lt;? extends Throwable&gt;[] noRollbackFor() default {};\n\n    // \u200b\u5bf9\u200b\u54ea\u4e9b\u200b\u5f02\u5e38\u200b\u4e0d\u56de\u200b\u6eda\u200b\u3010\u200b\u5f02\u5e38\u200b\u5168\u200b\u9650\u5b9a\u200b\u540d\u200b\u3011\n    String[] noRollbackForClassName() default {};\n}\n</code></pre> <p><code>rollbackFor</code> \u200b\u548c\u200b <code>rollbackForClassName</code> \u200b\u7684\u200b\u533a\u522b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u6765\u770b\u200b\u4f7f\u7528\u200b\u65b9\u5f0f\u200b\u3002 </p> <p>\u200b\u6700\u597d\u200b\u4f7f\u7528\u200b <code>rollbackFor</code> \u200b\u53ef\u4ee5\u200b\u5728\u200b\u7f16\u8bd1\u200b\u7684\u200b\u65f6\u5019\u200b\u76f4\u63a5\u200b\u5e2e\u52a9\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u51fa\u9519\u200b\u3002</p> Java<pre><code>@Transactional(rollbackFor = Exception.class, rollbackForClassName = {\"java.lang.Exception\"})\n</code></pre> <p>\u200b\u6ce8\u610f\u200b</p> <p>\u200b\u5728\u200b\u4f7f\u7528\u200b <code>@Transactional</code> \u200b\u6ce8\u89e3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e00\u5b9a\u200b\u8981\u200b\u8bbe\u7f6e\u200b<code>rollbackFor</code>\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u662f\u200b\u4e0d\u200b\u56de\u6eda\u200b\u7684\u200b\u68c0\u67e5\u200b\u7c7b\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6bd4\u5982\u200b <code>IOException</code>\u3001<code>SQLException</code> \u200b\u7b49\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#spring_2","title":"Spring \u200b\u4e8b\u52a1\u7ba1\u7406\u200b\u4e0e\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u5b9e\u8df5","text":"<p>\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u7ea6\u5b9a\u200b\uff1a</p> <p>\u200b\u5b9a\u4e49\u200b\u4e24\u4e2a\u200b\u4e8b\u52a1\u200b\u65b9\u6cd5\u200bA\u200b\u548c\u200bB\uff0c\u200b\u5728\u200bA\u200b\u91cc\u9762\u200b\u8c03\u7528\u200bB\u3002\u200b\u4e14\u200bA\u200b\u4e8b\u52a1\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\u4e0d\u4f1a\u200b\u6539\u53d8\u200b\uff0cB\u200b\u4e8b\u52a1\u200b\u7684\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u53ef\u80fd\u200b\u4f1a\u53d8\u200b\u3002</p> Java<pre><code>@Transactional(rollbackFor = Exception.class)\npublic void A() {\n    userMapper.insertUser(\"A\",1);\n    sqlTestService.B();\n}\n\npublic void B() {\n    userMapper.insertUser(\"B\",2);\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_7","title":"\u5d4c\u5957\u200b\u4e8b\u52a1","text":"<p>\u200b\u4fee\u6539\u200bB\u200b\u4e8b\u52a1\u200b\u7684\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u200b\u751f\u6210\u200b\u5d4c\u5957\u200b\u4e8b\u52a1\u200b</p> Java<pre><code>@Transactional(rollbackFor = Exception.class, propagation = Propagation.NESTED)\n</code></pre> <p>\u200b\u5d4c\u5957\u200b\u4e8b\u52a1\u200b\u548c\u200b\u7236\u200b\u4e8b\u52a1\u200b\u662f\u200b\u6709\u200b\u5173\u8054\u200b\u7684\u200b\uff0c\u200b\u5f53\u200bA\u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cB\u200b\u4e8b\u52a1\u200b\u4e00\u5b9a\u200b\u56de\u6eda\u200b\u3002</p> <p>\u200b\u5f53\u200bB\u200b\u4e8b\u52a1\u200b\u5f02\u5e38\u200b\u56de\u6eda\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8981\u200b\u5224\u65ad\u200b\u5728\u200bA\u200b\u91cc\u9762\u200b\u662f\u5426\u200btry\u200b\u4e86\u200bB\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5982\u679c\u200btry\u200b\u5c31\u200bA\u200b\u4e0d\u4f1a\u200b\u56de\u6eda\u200b\uff0c\u200b\u53ea\u662f\u200bB\u200b\u56de\u6eda\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_8","title":"\u6302\u200b\u8d77\u200b\u4e8b\u52a1","text":"<p>\u200b\u4fee\u6539\u200bB\u200b\u4e8b\u52a1\u200b\u7684\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u200b\u751f\u6210\u200b\u65b0\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u6302\u200b\u8d77\u200bA\u200b\u4e8b\u52a1\u200b</p> Java<pre><code>@Transactional(rollbackFor = Exception.class, propagation = Propagation.REQUIRES_NEW)\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_9","title":"\u878d\u5165\u200b\u4e8b\u52a1","text":"<p>\u200b\u4fee\u6539\u200bB\u200b\u4e8b\u52a1\u200b\u7684\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u200b\u878d\u5165\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b</p> Java<pre><code>@Transactional(rollbackFor = Exception.class, propagation = Propagation.REQUIRED)\n\n@Transactional(rollbackFor = Exception.class, propagation = Propagation.SUPPORTS)\n</code></pre> <p>\u200b\u65e2\u7136\u200b\u8bf4\u200b\u662f\u200b\u878d\u5165\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u90a3\u200b\u5176\u5b9e\u200b\u672c\u8d28\u200b\u4e0a\u200b\u8fd8\u662f\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4e0d\u7ba1\u200b\u600e\u4e48\u6837\u200b\u7684\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u7ba1\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\u5f02\u5e38\u200b\uff0cA\u3001B\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b\u4e00\u8d77\u200b\u63d0\u4ea4\u200b\u3001\u200b\u6216\u200b\u4e00\u8d77\u200b\u56de\u6eda\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring-tx/#_10","title":"\u6267\u884c\u200b\u7ed3\u679c\u200b\u6c47\u603b","text":"<p>\u200b\u6392\u5217\u7ec4\u5408\u200b\u7ed3\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/","title":"Spring\u200b\u4e2d\u200b@Transactional\u200b\u5931\u6548\u200b\u573a\u666f","text":"<p> \u200b\u7ea6\u200b 2796 \u200b\u4e2a\u200b\u5b57\u200b  200 \u200b\u884c\u200b\u4ee3\u7801\u200b  5 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 12 \u200b\u5206\u949f\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#spring","title":"Spring \u200b\u4e8b\u52a1\u200b\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u57fa\u672c\u200b\u4ecb\u7ecd\u200b-&gt; Spring\u200b\u4e8b\u52a1\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#1-transactional-public","title":"1. @Transactional\u200b\u5e94\u7528\u200b\u5728\u200b\u975e\u200b public \u200b\u4fee\u9970\u200b\u7684\u200b\u65b9\u6cd5\u200b\u4e0a","text":"<p>\u200b\u4f7f\u7528\u200b@Transactional\u200b\u4fee\u9970\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5fc5\u987b\u200b\u662f\u200bpublic\u200b\u4fee\u9970\u200b\u3001\u200b\u975e\u200bstatic\u200b\u4fee\u9970\u200b\u3001\u200b\u975e\u200bfinal\u200b\u4fee\u9970\u200b\u7684\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e8b\u52a1\u200b\u5931\u6548\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u200b\u662f\u200b\u4e0d\u200b\u51c6\u786e\u200b\u7684\u200b\uff01</p> <p></p> <p>\u200b\u56e0\u4e3a\u200bSpring\u200b\u7684\u200b\u4e8b\u52a1\u200b\u662f\u200b\u901a\u8fc7\u200bAOP\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u800c\u200b AOP \u200b\u65e0\u6cd5\u200b\u62e6\u622a\u200b private \u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b AOP \u200b\u7684\u200b\u5b9e\u73b0\u200b\u6709\u200b\u4e24\u79cd\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u548c\u200b Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u3002JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u662f\u200b\u57fa\u4e8e\u200b\u63a5\u53e3\u200b\u7684\u200b\uff0c\u200b\u548c\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4e3a\u200b\u5144\u5f1f\u200b\u5173\u7cfb\u200b\uff1bCglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u662f\u200b\u57fa\u4e8e\u200b\u7ee7\u627f\u200b\u7684\u200b\uff0c\u200b\u548c\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u662f\u200b\u7236\u5b50\u5173\u7cfb\u200b\u3002</p> <p>PS: \u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u65b0\u7248\u200b\u7684\u200b idea\uff0c\u200b\u90a3\u4e48\u200b\u8fdd\u53cd\u200b\u4e0a\u8ff0\u60c5\u51b5\u200b\u5747\u4f1a\u200b\u76f4\u63a5\u200b\u5728\u200b\u7f16\u8bd1\u200b\u65f6\u671f\u200b\u62a5\u9519\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f9d\u7136\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\uff0c\u200b\u8bf7\u591a\u52a0\u200b\u6ce8\u610f\u200b\u26a0\ufe0f</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#1-public","title":"1. public \u200b\u4fee\u9970","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#1-override","title":"1. \u200b\u63a5\u53e3\u200b\u7ee7\u627f\u200b\u65b9\u6cd5\u200b(@Override)","text":"<p>\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u7ee7\u627f\u200b\u81ea\u200b\u63a5\u53e3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u5b9a\u200b\u662f\u200b public \u200b\u7684\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u751f\u6548\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#2","title":"2. \u200b\u591a\u4e2a\u200b\u65b9\u6cd5","text":"<p>\u200b\u4e3a\u4e86\u200b\u7b80\u5316\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u4ec5\u200b\u5bf9\u200b\u4e24\u4e2a\u200b\u65b9\u6cd5\u200b\u7684\u200b\u60c5\u51b5\u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u4f46\u200b\u4e24\u4e2a\u200b\u548c\u200b\u591a\u4e2a\u200b\u672c\u8d28\u200b\u4e0a\u200b\u5dee\u522b\u200b\u4e0d\u200b\u5927\u200b</p> <p>\u200b\u5047\u8bbe\u200b A \u200b\u65b9\u6cd5\u200b\u4e3a\u200b\u63a5\u53e3\u200b\u7ee7\u627f\u200b\u65b9\u6cd5\u200b(\u200b\u4e00\u5b9a\u200b\u4e3a\u200b public)\uff0cB \u200b\u65b9\u6cd5\u200b\u4e3a\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u81ea\u5b9a\u4e49\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\u4e3a\u200b@Transactional \u200b\u6ce8\u89e3\u200b\u4f4d\u7f6e\u200b\u3001B \u200b\u65b9\u6cd5\u200b\u4fee\u9970\u7b26\u200b\u3001\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7c7b\u578b\u200b\u3002</p> <p>\u200b\u524d\u7f6e\u200b\u51c6\u5907\u200b\u5982\u4e0b\u200b:</p> \u200b\u524d\u7f6e\u200b\u51c6\u5907\u200b  \u200b\u8868\u200b\u7ed3\u6784\u200b  SQL<pre><code>create table goods  \n(  \n    id    int auto_increment  \n        primary key,  \n    price decimal(10, 2) null  \n);\n</code></pre>  \u200b\u5b9e\u4f53\u7c7b\u200b  Java<pre><code>@TableName(value =\"goods\")\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Goods implements Serializable {\n    /**\n     * \n     */\n    @TableId(value = \"id\", type = IdType.AUTO)\n    private Integer id;\n\n    /**\n     * \n     */\n    @TableField(value = \"price\")\n    private BigDecimal price;\n}\n</code></pre>  Mapper  Java<pre><code>@Mapper\npublic interface GoodsMapper extends BaseMapper&lt;Goods&gt; {\n\n}\n</code></pre>  Service  Java<pre><code>@Slf4j\n@Service\npublic class GoodsServiceImpl extends ServiceImpl&lt;GoodsMapper, Goods&gt;\n    implements GoodsService {\n\n    @Resource\n    GoodsMapper goodsMapper;\n\n    ...\n}\n</code></pre>  \u200b\u542f\u52a8\u200b\u7c7b\u200b  Java<pre><code>@SpringBootApplication\n@EnableAspectJAutoProxy(exposeProxy = true)\npublic class Demo1Application {\n\n    public static void main(String[] args) {\n        ConfigurableApplicationContext context = SpringApplication.run(Demo1Application.class, args);\n        // \u200b\u6d4b\u8bd5\u200b\n        GoodsService service = context.getBean(GoodsService.class);\n        service.insert(2, new BigDecimal(\"123\"));\n    }\n}\n</code></pre> <p>1. A+\u200b\u6ce8\u89e3\u200b\uff0cB \u200b\u4e0d\u200b\u52a0\u200b</p> <p>\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b</p> Java<pre><code>@Slf4j\n@Service\npublic class GoodsServiceImpl extends ServiceImpl&lt;GoodsMapper, Goods&gt;\n    implements GoodsService {\n\n    @Resource\n    GoodsMapper goodsMapper;\n\n    @Override\n    @Transactional\n    public void insert(Integer id, BigDecimal price) {\n        doInsert(id, price);\n    }\n\n    private void doInsert(Integer id, BigDecimal price) {\n        log.info(\"===========&gt;{}\", TransactionSynchronizationManager.getCurrentTransactionName());\n        Goods goods = new Goods(id, price);\n        goodsMapper.insert(goods);\n        throw new RuntimeException(\"error\");\n    }\n}\n</code></pre> <p>\u200b\u8fd9\u200b\u5176\u5b9e\u200b\u8ddf\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u6ca1\u6709\u200b\u672c\u8d28\u533a\u522b\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u751f\u6548\u200b\uff01</p> <p>2. JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0cB+\u200b\u6ce8\u89e3\u200b\uff0cA \u200b\u4e0d\u200b\u52a0\u200b</p> <p>SpringBoot \u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0c\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u4f7f\u7528\u200b JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b YAML \u200b\u914d\u7f6e\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u5982\u4e0b\u200b\u4ee3\u7801\u200b\uff0c\u200b\u540e\u7eed\u200b\u4e0d\u518d\u200b\u8d58\u8ff0\u200b\uff0c\u200b\u6ce8\u610f\u200b\u662f\u200b YAML, YAML, YAML !!! \u200b\u5728\u200b\u542f\u52a8\u200b\u7c7b\u4e0a\u200b\u6ca1\u7528\u200b!</p> YAML<pre><code>spring:\n  aop:\n    proxy-target-class: false\n</code></pre> <p>\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b:</p> Java<pre><code>@Slf4j\n@Service\npublic class GoodsServiceImpl extends ServiceImpl&lt;GoodsMapper, Goods&gt;\n    implements GoodsService {\n\n    @Resource\n    GoodsMapper goodsMapper;\n\n    @Override\n    public void insert(Integer id, BigDecimal price) {\n        ((GoodsServiceImpl) AopContext.currentProxy()).doInsert(id, price);\n    }\n\n    @Transactional\n    private void doInsert(Integer id, BigDecimal price) {\n        log.info(\"===========&gt;{}\", TransactionSynchronizationManager.getCurrentTransactionName());\n        Goods goods = new Goods(id, price);\n        goodsMapper.insert(goods);\n        throw new RuntimeException(\"error\");\n    }\n}\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u8fd9\u91cc\u200b\u4f7f\u7528\u200b\u4e86\u200b AopContext \u200b\u83b7\u53d6\u200b\u4ee3\u7406\u200b\u7c7b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u63a5\u53e3\u200b\u65b9\u6cd5\u200b\u6ca1\u6709\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u7684\u200b\u79c1\u6709\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u8c03\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\u76f4\u63a5\u200b\u62a5\u9519\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u200b\u5931\u6548\u200b\u95ee\u9898\u200b\u4e86\u200b</p> <p>\u200b\u6765\u200b\u770b\u770b\u200b\u62a5\u9519\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4fe1\u606f\u200b\u8868\u793a\u200b\u4e0d\u80fd\u200b cast\uff0c\u200b\u539f\u56e0\u200b\u662f\u200b JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u57fa\u4e8e\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u5b9e\u73b0\u200b\u7c7b\u200b(\u200b\u5144\u5f1f\u200b\u5173\u7cfb\u200b)\u200b\u4e4b\u95f4\u200b\u80af\u5b9a\u200b\u4e0d\u80fd\u200b\u4e92\u76f8\u200b cast \u200b\u7684\u200b</p> Text Only<pre><code>Exception in thread \"main\" java.lang.ClassCastException: class jdk.proxy2.$Proxy57 cannot be cast to class com.example.demo.service.impl.GoodsServiceImpl (jdk.proxy2.$Proxy57 is in module jdk.proxy2 of loader 'app'; com.example.demo.service.impl.GoodsServiceImpl is in unnamed module of loader 'app')\n    at com.example.demo.service.impl.GoodsServiceImpl.insert(GoodsServiceImpl.java:33)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:216)\n    at jdk.proxy2/jdk.proxy2.$Proxy57.insert(Unknown Source)\n    at com.example.demo.Demo1Application.main(Demo1Application.java:18)\n</code></pre> <p>3. Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0cB+\u200b\u6ce8\u89e3\u200b\uff0cB \u200b\u4fee\u9970\u7b26\u200b\u4e3a\u200b private\uff0cA \u200b\u4e0d\u200b\u52a0\u200b</p> <p>\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b:</p> Java<pre><code>@Slf4j\n@Service\npublic class GoodsServiceImpl extends ServiceImpl&lt;GoodsMapper, Goods&gt;\n    implements GoodsService {\n\n    @Resource\n    GoodsMapper goodsMapper;\n\n    @Override\n    public void insert(Integer id, BigDecimal price) {\n        ((GoodsServiceImpl) AopContext.currentProxy()).doInsert(id, price);\n    }\n\n    @Transactional\n    private void doInsert(Integer id, BigDecimal price) {\n        log.info(\"===========&gt;{}\", TransactionSynchronizationManager.getCurrentTransactionName());\n        Goods goods = new Goods(id, price);\n        goodsMapper.insert(goods);\n        throw new RuntimeException(\"error\");\n    }\n}\n</code></pre> <p>\u200b\u62a5\u9519\u200b\u4fe1\u606f\u200b\uff1a</p> <p>\u200b\u89e3\u8bfb\u200b\uff1acglib\u200b\u5b50\u7c7b\u200b\u4ee3\u7406\u200b\u65e0\u6cd5\u200b\u7ee7\u627f\u200b private \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u7236\u7c7b\u200b\u7684\u200b private \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f46\u662f\u200bSpring \u200b\u53ea\u4f1a\u200b\u5bf9\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u8fdb\u884c\u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u6ce8\u5165\u200b\u539f\u59cb\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8c03\u7528\u200b private \u200b\u65b9\u6cd5\u200b\u4f1a\u7a7a\u200b\u6307\u9488\u200b</p> <p>\u200b\u8fd9\u4e2a\u200b\u573a\u666f\u200b\u64cd\u4f5c\u200b\u6570\u636e\u5e93\u200b\u7684\u200b mapper \u200b\u5931\u6548\u200b\u4e86\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b\u663e\u793a\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u540c\u6837\u200b\u4e0d\u80fd\u200b\u5224\u5b9a\u200b\u4e3a\u200b\u4e8b\u52a1\u200b\u5931\u6548\u200b\u7684\u200b\u573a\u666f\u200b</p> <p></p> <p>4. Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0cB+\u200b\u6ce8\u89e3\u200b\uff0cB \u200b\u4fee\u9970\u7b26\u200b\u4e3a\u200b protected\uff0cA \u200b\u4e0d\u200b\u52a0\u200b</p> <p>\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u548c\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u573a\u666f\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4ec5\u4ec5\u200b\u4fee\u6539\u200b private \u200b\u4e3a\u200b protected\uff0c\u200b\u4e0d\u200b cv \u200b\u4e86\u200b</p> <p>\u200b\u4e8b\u52a1\u200b\u751f\u6548\u200b\uff01\u200b\u6765\u200b\u770b\u770b\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b</p> <p>\u200b\u9996\u5148\u200b\u6253\u5370\u200b\u4e86\u200b\u4e8b\u52a1\u200b\u4fe1\u606f\u200b\uff0c\u200b\u800c\u4e14\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u65b0\u589e\u200b\u6570\u636e\u200b\uff0c\u200b\u8bc1\u660e\u200b\u4e86\u200b\u4e8b\u52a1\u200b\u751f\u6548\u200b\u3002</p> <p>\u200b\u62a5\u9519\u200b\u4e3a\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u4e2d\u200b\u624b\u52a8\u200b\u629b\u51fa\u200b\uff0c\u200b\u4e0d\u7528\u200b\u7406\u4f1a\u200b</p> <p></p> <p>\u200b\u89e3\u8bfb\u200b\uff1aCglib \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u662f\u200b\u57fa\u4e8e\u200b\u7ee7\u627f\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b protected \u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u7ee7\u627f\u200b\uff0c\u200b\u5e76\u200b\u6210\u529f\u200b\u4ee3\u7406\u200b\uff01</p> <p>5. A+\u200b\u6ce8\u89e3\u200b\uff0cB+\u200b\u6ce8\u89e3\u200b</p> <p>\u200b\u8fd9\u4e2a\u200b\u5176\u5b9e\u200b\u8ddf\u200b\u4e8b\u52a1\u200b\u4f20\u64ad\u200b\u884c\u4e3a\u200b\u6709\u5173\u200b\u4e86\u200b\uff0c\u200b\u4e0b\u6587\u200b\u4e2d\u6709\u200b\u8be6\u7ec6\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u505a\u200b\u6d4b\u8bd5\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#2-static","title":"2. \u200b\u975e\u200b static \u200b\u4fee\u9970","text":"<p>\u200b\u65e0\u8bba\u200b\u54ea\u200b\u79cd\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u90fd\u200b\u662f\u200b\u57fa\u4e8e\u200b\u5bf9\u8c61\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u975e\u200b\u57fa\u4e8e\u200b\u7c7b\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u80fd\u591f\u200b\u4ee3\u7406\u200b static \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5e94\u8be5\u200b\u79f0\u5176\u4e3a\u200b\u9759\u6001\u200b\u4ee3\u7406\u200b\u800c\u200b\u975e\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u4e86\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#3-final","title":"3. final \u200b\u4fee\u9970","text":"<p>\u200b\u6cbf\u7528\u200b\u6d4b\u8bd5\u200bpublic \u200b\u4fee\u9970\u200b\u65f6\u200b\u7684\u200b\u80cc\u666f\u200b\u548c\u200b\u4ee3\u7801\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#1-jdk","title":"1. JDK \u200b\u52a8\u6001\u200b\u4ee3\u7406","text":"Java<pre><code>@Slf4j\n@Service\npublic class GoodsServiceImpl extends ServiceImpl&lt;GoodsMapper, Goods&gt;\n    implements GoodsService {\n\n    @Resource\n    GoodsMapper goodsMapper;\n\n    @Override\n    @Transactional\n    public final void insert(Integer id, BigDecimal price) {\n        log.info(\"===========&gt;{}\", TransactionSynchronizationManager.getCurrentTransactionName());\n        Goods goods = new Goods(id, price);\n        goodsMapper.insert(goods);\n        throw new RuntimeException(\"error\");\n    }\n}\n</code></pre> <p>\u200b\u4e8b\u52a1\u200b\u751f\u6548\u200b\uff01\u200b\u7f51\u4e0a\u200b\u5f88\u591a\u200b\u4eba\u200b\u90fd\u200b\u8bf4\u52a0\u200b final \u200b\u4e8b\u52a1\u200b\u4f1a\u200b\u5931\u6548\u200b\uff0c\u200b\u8fd9\u200b\u662f\u200b\u4e0d\u200b\u51c6\u786e\u200b\u7684\u200b!!!</p> <p></p> <p>\u200b\u539f\u56e0\u200b\u5728\u4e8e\u200b\uff0cJDK \u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u751f\u6210\u200b\u7684\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5185\u90e8\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u8c03\u7528\u200b insert \u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u8def\u7531\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\u4e2d\u200b\uff0c\u200b\u540c\u65f6\u200b\u4ed6\u200b\u53c8\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\u4fdd\u8bc1\u200b\u4e8b\u52a1\u200b\u751f\u6548\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#2-cglib","title":"2. Cglib \u200b\u52a8\u6001\u200b\u4ee3\u7406","text":"<p>\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u4e0d\u53d8\u200b</p> <p>\u200b\u51fa\u73b0\u200b\u4e86\u200b\u7a7a\u200b\u6307\u9488\u200b\u5f02\u5e38\u200b</p> <p>\u200b\u539f\u56e0\u200b\u662f\u200b\uff0ccglib\u200b\u5b50\u7c7b\u200b\u4ee3\u7406\u200b\u65e0\u6cd5\u200b\u7ee7\u627f\u200b final \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u7236\u7c7b\u200b\u7684\u200b final \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f46\u662f\u200bSpring \u200b\u53ea\u4f1a\u200b\u5bf9\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u8fdb\u884c\u200b\u4f9d\u8d56\u200b\u6ce8\u5165\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u6ce8\u5165\u200b\u539f\u59cb\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8c03\u7528\u200b final \u200b\u65b9\u6cd5\u200b\u4f1a\u7a7a\u200b\u6307\u9488\u200b</p> <p></p> <p>\u200b\u8fd9\u4e2a\u200b\u573a\u666f\u200b\u64cd\u4f5c\u200b\u6570\u636e\u5e93\u200b\u7684\u200b mapper \u200b\u5931\u6548\u200b\u4e86\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b\u663e\u793a\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u540c\u6837\u200b\u4e0d\u80fd\u200b\u5224\u5b9a\u200b\u4e3a\u200b\u4e8b\u52a1\u200b\u5931\u6548\u200b\u7684\u200b\u573a\u666f\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#2-propagation","title":"2. propagation \u200b\u5c5e\u6027\u200b\u8bbe\u7f6e\u200b\u9519\u8bef","text":"<p>\u200b\u5f53\u200b\u6211\u4eec\u200b\u5c06\u200b<code>propagation</code>\u200b\u5c5e\u6027\u200b\u7684\u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e0b\u200b\u51e0\u79cd\u200b\u53d6\u503c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e8b\u52a1\u200b\u5931\u6548\u200b\uff1a</p> <ol> <li> <p><code>Propagation.NOT_SUPPORTED</code>\uff1a\u200b\u4ee5\u975e\u200b\u4e8b\u52a1\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u6682\u505c\u200b\u5f53\u524d\u200b\u7684\u200b\u4e8b\u52a1\u200b</p> </li> <li> <p><code>Propagation.NEVER</code>\uff1a\u200b\u4ee5\u975e\u200b\u4e8b\u52a1\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u5b58\u5728\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5219\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</p> </li> </ol>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#3-rollbackfor","title":"3. rollbackFor\u200b\u5c5e\u6027\u200b\u8bbe\u7f6e\u200b\u9519\u8bef","text":"<p>Spring\u200b\u9ed8\u8ba4\u200b\u629b\u51fa\u200b\u4e86\u200b\u672a\u200b\u68c0\u67e5\u200bunchecked\u200b\u5f02\u5e38\u200b\uff08\u200b\u7ee7\u627f\u200b\u81ea\u200b RuntimeException \u200b\u7684\u200b\u5f02\u5e38\u200b\uff09\u200b\u6216\u8005\u200b Error\u200b\u624d\u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\uff1b\u200b\u5176\u4ed6\u200b\u5f02\u5e38\u200b\u4e0d\u4f1a\u200b\u89e6\u53d1\u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\u629b\u51fa\u200b\u5176\u4ed6\u200b\u7c7b\u578b\u200b\u7684\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4f46\u200b\u5374\u200b\u671f\u671b\u200b Spring \u200b\u80fd\u591f\u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b rollbackFor\u200b\u5c5e\u6027\u200b\uff1b\u200b\u82e5\u200b\u5728\u200b\u76ee\u6807\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u629b\u51fa\u200b\u7684\u200b\u5f02\u5e38\u200b\u662f\u200b rollbackFor \u200b\u6307\u5b9a\u200b\u7684\u200b\u5f02\u5e38\u200b\u7684\u200b\u5b50\u7c7b\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u540c\u6837\u200b\u4f1a\u200b\u56de\u6eda\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u5bf9\u200b\u672a\u200b\u68c0\u67e5\u200b\u5f02\u5e38\u200b\u548c\u200b\u5df2\u200b\u68c0\u67e5\u200b\u5f02\u5e38\u200b\u7684\u200b\u533a\u522b\u200b\u505a\u200b\u7b80\u8981\u200b\u9610\u8ff0\u200b</p> \u200b\u5bf9\u6bd4\u200b\u9879\u200b \u200b\u5df2\u200b\u68c0\u67e5\u200b\u5f02\u5e38\u200b\uff08Checked Exception\uff09 \u200b\u672a\u200b\u68c0\u67e5\u200b\u5f02\u5e38\u200b\uff08Unchecked Exception\uff09 \u200b\u7ee7\u627f\u200b\u5173\u7cfb\u200b \u200b\u7ee7\u627f\u200b\u81ea\u200b Exception\uff08\u200b\u4f46\u200b\u4e0d\u200b\u5305\u62ec\u200b RuntimeException\uff09 \u200b\u7ee7\u627f\u200b\u81ea\u200b RuntimeException \u200b\u662f\u5426\u200b\u5f3a\u5236\u200b\u5904\u7406\u200b \u200b\u5fc5\u987b\u200b try-catch \u200b\u6216\u200b throws\uff0c\u200b\u5426\u5219\u200b\u65e0\u6cd5\u200b\u7f16\u8bd1\u200b \u200b\u65e0\u9700\u200b\u5f3a\u5236\u200b\u5904\u7406\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b try-catch \u200b\u5e38\u89c1\u200b\u5f02\u5e38\u200b IOException\u3001SQLException\u3001ClassNotFoundException\u3001InterruptedException NullPointerException\u3001ArrayIndexOutOfBoundsException\u3001ArithmeticException\u3001IllegalArgumentException \u200b\u4e8b\u52a1\u200b\u56de\u6eda\u200b (@Transactional) \u200b\u9ed8\u8ba4\u200b\u4e0d\u4f1a\u200b\u56de\u6eda\u200b\uff0c\u200b\u9700\u200b\u914d\u7f6e\u200b rollbackFor = Exception.class \u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u56de\u6eda\u200b \u200b\u89e6\u53d1\u200b\u539f\u56e0\u200b \u200b\u4f9d\u8d56\u200b\u5916\u90e8\u200b\u8d44\u6e90\u200b\uff08\u200b\u5982\u200b\u6587\u4ef6\u200b\u3001\u200b\u6570\u636e\u5e93\u200b\u3001\u200b\u7f51\u7edc\u200b\u7b49\u200b\uff09 \u200b\u4ee3\u7801\u200b\u903b\u8f91\u200b\u9519\u8bef\u200b \u200b\u662f\u5426\u200b\u53ef\u200b\u9884\u9632\u200b \u200b\u5927\u591a\u200b\u53ef\u200b\u9884\u9632\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u673a\u5236\u200b\u907f\u514d\u200b \u200b\u901a\u5e38\u200b\u662f\u200b\u7a0b\u5e8f\u200b BUG\uff0c\u200b\u5e94\u200b\u4fee\u6b63\u200b\u4ee3\u7801\u200b\u903b\u8f91\u200b \u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b FileReader file = new FileReader(\"test.txt\"); // IOException int x = 1 / 0; // ArithmeticException","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#4-transactional","title":"4. \u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u5bfc\u81f4\u200b@Transactional\u200b\u5931\u6548","text":"<p>\u200b\u540c\u4e00\u4e2a\u200b\u7c7b\u4e2d\u200b\uff0cA\u200b\u65b9\u6cd5\u200b\u662f\u975e\u200b\u4e8b\u52a1\u6027\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f46\u662f\u200bB\u200b\u65b9\u6cd5\u200b\u662f\u200b\u4e8b\u52a1\u6027\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6b64\u65f6\u200bA\u200b\u8c03\u7528\u200bB\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200bB\u200b\u7684\u200b\u4e8b\u52a1\u200b\u5931\u6548\u200b\u3002</p> <p>\u200b\u539f\u56e0\u200b\uff1a\u200b\u8fd9\u4e2a\u200b\u548c\u200b\u573a\u666f\u200b\u4e00\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u7684\u200b\u5b9e\u73b0\u200b\u662f\u200b\u57fa\u4e8e\u200bAOP\u200b\u7684\u200b\uff0c\u200b\u800c\u200bAOP\u200b\u7684\u200b\u5b9e\u73b0\u200b\u53c8\u200b\u662f\u200b\u57fa\u4e8e\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200b\u672c\u8d28\u200b\u5c31\u7b97\u200b\u5bf9\u200b\u65b9\u6cd5\u200b\u7684\u200b\u589e\u5f3a\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u4f7f\u7528\u200b\u589e\u5f3a\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b\u60f3\u8981\u200b\u4f7f\u7528\u200b\u4e8b\u52a1\u200b\u65b9\u6cd5\u200b\uff09\uff0c\u200b\u5c31\u200b\u5fc5\u987b\u200b\u662f\u200b\u901a\u8fc7\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u53bb\u200b\u89e6\u53d1\u200b\u76ee\u6807\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff1a\u200b\u901a\u8fc7\u200b <code>AopContext.currentProxy()</code> \u200b\u8fd9\u4e2a\u200bAPI\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7c7b\u200b\u7684\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b</p> <p>\u200b\u5728\u200b\u542f\u52a8\u200b\u7c7b\u4e0a\u200b\u8bbe\u7f6e\u200b <code>@EnableAspectJAutoProxy (exposeProxy = true)</code></p> <p><code>exposeProxy = true</code>\u200b\u7528\u4e8e\u200b\u63a7\u5236\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u662f\u5426\u200b\u5e94\u200b\u88ab\u200b\u516c\u5f00\u200b\u7ed9\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8bbf\u95ee\u200b\uff1a</p> <ul> <li> <p><code>exposeProxy = true</code>: \u200b\u5f53\u200b\u8bbe\u7f6e\u200b\u4e3a\u200btrue\u200b\u65f6\u200b\uff0c<code>Spring</code>\u200b\u4f1a\u200b\u786e\u4fdd\u200b\u5728\u200bAOP\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>AopContext.currentProxy()</code> \u200b\u65b9\u6cd5\u200b\u80fd\u591f\u200b\u83b7\u53d6\u200b\u5230\u200b\u5f53\u524d\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u3002 \u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u5728\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u5185\u90e8\u200b\u9700\u8981\u200b\u8c03\u7528\u200b\u81ea\u8eab\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u5e0c\u671b\u200b\u8fd9\u4e9b\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u4e5f\u200b\u80fd\u200b\u89e6\u53d1\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\u7684\u200b\u60c5\u51b5\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002 \u200b\u4f8b\u5982\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u200b\u7c7b\u4e2d\u200b\u7684\u200b\u67d0\u4e2a\u200b\u65b9\u6cd5\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8c03\u7528\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u79c1\u6709\u200b\u6216\u200b\u53d7\u200b\u4fdd\u62a4\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u88ab\u200b\u540c\u4e00\u4e2a\u200b\u5207\u9762\u200b\u6240\u200b\u589e\u5f3a\u200b\u3002\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u82e5\u200b\u4e0d\u200b\u66b4\u9732\u200b\u4ee3\u7406\u200b\uff0c\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u5c06\u200b\u4e0d\u4f1a\u200b\u7ecf\u8fc7\u200b\u5207\u9762\u200b\u5904\u7406\u200b\uff1b\u200b\u800c\u200b\u66b4\u9732\u200b\u4ee3\u7406\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>AopContext.currentProxy().methodToCall()</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u786e\u4fdd\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u4e5f\u200b\u5f97\u5230\u200b\u5207\u9762\u200b\u7684\u200b\u62e6\u622a\u200b\u3002</p> </li> <li> <p><code>exposeProxy = false \u200b\u6216\u200b\u672a\u6307\u5b9a\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\uff09</code>\uff1a \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>Spring</code>\u200b\u4e0d\u4f1a\u200b\u7279\u522b\u200b\u66b4\u9732\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u88ab\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u5185\u90e8\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b <code>this</code> \u200b\u8c03\u7528\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u5c06\u200b\u4e0d\u4f1a\u200b\u89e6\u53d1\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u76ee\u6807\u200b\u7c7b\u200b\u7684\u200b\u539f\u59cb\u200b\u65b9\u6cd5\u200b\u3002</p> </li> </ul> <p>\u200b\u5173\u4e8e\u200b exposeProxy\uff0c\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u6bb5\u200b\u5904\u7406\u200b\u597d\u53cb\u200b\u7533\u8bf7\u200b\u7684\u200b\u4e1a\u52a1\u200b\u903b\u8f91\u200b</p> Java<pre><code>/**\n * \u200b\u7533\u8bf7\u200b\u597d\u53cb\u200b\n * @param uid     uid\n * @param request \u200b\u8bf7\u6c42\u200b\n * @return {@link RestBean}\n */\n@Transactional\n@Override\n@RedissonLock(key = \"#uid\")\npublic RestBean&lt;Void&gt; apply(Long uid, FriendApplyReq request) {\n    // \u200b\u4e0d\u80fd\u200b\u6dfb\u52a0\u200b\u81ea\u5df1\u200b\u4e3a\u200b\u597d\u53cb\u200b\n    if (Objects.equals(uid, request.getTargetUid())) {\n        return RestBean.failure(FriendErrorEnum.SELF_APPLY_FORBIDDEN);\n    }\n    // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u597d\u53cb\u200b\u5173\u7cfb\u200b\n    UserFriend isFriend = userFriendDao.getByFriend(uid, request.getTargetUid());\n    // \u200b\u5df2\u7ecf\u200b\u5b58\u5728\u200b\u597d\u53cb\u200b\u5173\u7cfb\u200b\n    if (Objects.nonNull(isFriend)) {\n        return RestBean.failure(FriendErrorEnum.ALREADY_FRIENDS);\n    }\n    // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u7533\u8bf7\u200b\u8bb0\u5f55\u200b \uff08\u200b\u6211\u200b -&gt; \u200b\u5bf9\u65b9\u200b\uff09 \u200b\u4e14\u200b \u200b\u7533\u8bf7\u200b\u72b6\u6001\u200b\u4e3a\u200b \u200b\u5f85\u200b\u5ba1\u6279\u200b\n    UserApply myFriendApply = userApplyDao.getFriendApply(uid, request.getTargetUid());\n    // \u200b\u5b58\u5728\u200b\u7533\u8bf7\u200b\n    if (Objects.nonNull(myFriendApply)) {\n        return RestBean.failure(FriendErrorEnum.EXISTS_FRIEND_APPLY);\n    }\n    // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u7533\u8bf7\u200b\u8bb0\u5f55\u200b (\u200b\u5bf9\u65b9\u200b -&gt; \u200b\u6211\u200b)\n    UserApply friendApply = userApplyDao.getFriendApply(request.getTargetUid(), uid);\n    // \u200b\u5982\u679c\u200b\u5b58\u5728\u200b\uff0c\u200b\u76f4\u63a5\u200b\u540c\u610f\u200b\n    if (Objects.nonNull(friendApply)) {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u6267\u884c\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4ee3\u7406\u200b\u5b9e\u4f8b\u200b(\u200b\u786e\u4fdd\u200b\u4e8b\u52a1\u200b\u6b63\u786e\u200b\u6267\u884c\u200b)\uff0c\u200b\u540c\u610f\u200b\u7533\u8bf7\u200b\n        ((FriendService) AopContext.currentProxy()).applyApprove(uid, new FriendApplyApproveReq(friendApply.getId()));\n        return RestBean.success();\n    }\n    UserApply userApply = FriendAdapter.buildFriendApply(uid, request);\n    userApplyDao.save(userApply);\n    // \u200b\u7528\u6237\u200b\u7533\u8bf7\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u5411\u200b\u5bf9\u65b9\u200b\u5f02\u6b65\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u6d88\u606f\u200b\n    applicationEventPublisher.publishEvent(new UserApplyEvent(this, userApply));\n    return RestBean.success();\n}\n</code></pre> <p>\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u5904\u7406\u200b \u200b\u5982\u679c\u200b\u7533\u8bf7\u200b\u8bb0\u5f55\u200b(\u200b\u5bf9\u65b9\u200b-&gt;\u200b\u6211\u200b)\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u540c\u610f\u200b\u7533\u8bf7\u200b \u200b\u7684\u200b\u5904\u7406\u200b\u903b\u8f91\u200b </p> <p>\u200b\u8fd9\u200b\u4e00\u884c\u200b\u4ee3\u7801\u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b\u786e\u4fdd\u200b\u4e8b\u52a1\u200b\u548c\u200b\u5176\u4ed6\u200b\u5207\u9762\u200b\u903b\u8f91\u200b\uff08\u200b\u5982\u200b <code>@Transactional</code> \u200b\u548c\u200b <code>@RedissonLock</code> \uff09\u200b\u5728\u200b\u8c03\u7528\u200b <code>applyApprove</code> \u200b\u65b9\u6cd5\u200b\u65f6\u200b\u80fd\u591f\u200b\u751f\u6548\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#5-transactional","title":"5. \u200b\u5f02\u5e38\u200b\u6355\u83b7\u200b\u5bfc\u81f4\u200b@Transactional\u200b\u5931\u6548","text":"<p>\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u629b\u51fa\u200b\u4e86\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8be5\u200b\u5f02\u5e38\u200b\u901a\u8fc7\u200b <code>try...catch</code> \u200b\u8fdb\u884c\u200b\u4e86\u200b\u6355\u83b7\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4e8b\u52a1\u200b\u6ce8\u89e3\u200b <code>@Transactional</code> \u200b\u5931\u6548\u200b</p> <p>\u200b\u793a\u4f8b\u200b\uff1a</p> Java<pre><code>@Resource\nprivate IBService bService;\n\n@Service\nClass AServiceImpl implements IAService{\n    @Transactional\n    public Result A(Student s) {\n        try {\n            bService.save(s);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return Result.ok();\n    }\n}\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u62a5\u9519\u200b<code>org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only</code></p> <p>\u200b\u539f\u56e0\u200b\uff1a\u200b\u56e0\u4e3a\u200b<code>bService</code>\u200b\u6267\u884c\u200b<code>save</code>\u200b\u65b9\u6cd5\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6240\u4ee5\u200b<code>bService</code>\u200b\u544a\u8bc9\u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u9700\u8981\u200b\u88ab\u200b<code>rollback</code>\uff0c\u200b\u4f46\u662f\u200b<code>aService</code>\u200b\u4e2d\u200b\u4f7f\u7528\u200b<code>try...catch</code>\u200b\u6355\u83b7\u200b\u4e86\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5b83\u200b\u8ba4\u4e3a\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u5e76\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u662f\u200b\u5904\u4e8e\u200b\u6b63\u5e38\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e8e\u662f\u200b<code>aService</code>\u200b\u5c31\u200b\u544a\u8bc9\u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u9700\u8981\u200b\u88ab\u200b<code>commit</code>\uff0c\u200b\u7ed3\u679c\u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b\u53d1\u73b0\u200b\u6536\u5230\u200b\u4e24\u4e2a\u200b\u77db\u76fe\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5b83\u200b\u4e5f\u200b\u641e\u4e0d\u6e05\u200b\u662f\u200b\u8be5\u200b<code>rollback</code>\u200b\u8fd8\u662f\u200b\u8be5\u200b<code>commit</code>\uff0c\u200b\u4e8e\u662f\u200b\u5c31\u200b\u629b\u200b\u4e86\u200b\u4e2a\u200b<code>UnexpectedRollbackException</code>\u200b\u5f02\u5e38\u200b\u3002</p> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200bSpring\u200b\u4e2d\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u662f\u200b\u5728\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u65f6\u200b\u5f00\u59cb\u200b\u7684\u200b\uff0c\u200b\u4e1a\u52a1\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u540e\u200b\u624d\u200b\u6267\u884c\u200b<code>rollback</code>\u200b\u6216\u200b<code>commit</code>\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u662f\u5426\u200b\u88ab\u200b\u56de\u6eda\u200b\u53d6\u51b3\u4e8e\u200b\u662f\u5426\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4e14\u200b\u8be5\u200b\u5f02\u5e38\u200b\u662f\u5426\u200b\u6ee1\u8db3\u200b\u573a\u666f\u200b\u4e09\u200b\uff08\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u629b\u51fa\u200b\u7684\u200b\u5f02\u5e38\u200b\u662f\u5426\u200b\u6709\u200b\u88ab\u200b<code>rollbackFor</code>\u200b\u6307\u5b9a\u200b\uff0c\u200b\u6216\u200b<code>rollbackFor</code>\u200b\u6307\u5b9a\u200b\u5f02\u5e38\u200b\u7684\u200b\u5b50\u7c7b\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u4e00\u5b9a\u200b\u8981\u200b\u4f7f\u7528\u200b<code>try..catch</code>\u200b\u65f6\u200b\uff0c\u200b\u4e00\u5b9a\u200b\u8981\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\uff08\u200b\u4e14\u200b\u629b\u51fa\u200b\u7684\u200b\u5f02\u5e38\u200b\u5fc5\u987b\u200b\u6ee1\u8db3\u200b\u573a\u666f\u200b\u4e09\u200b\uff0c\u200b\u4e00\u822c\u200b\u76f4\u63a5\u200b\u629b\u200b\u4e00\u4e2a\u200b\u8fd0\u884c\u200b\u65f6\u200b\u5f02\u5e38\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b <code>throw new RuntimeException()</code>\uff0c\u200b\u8fd0\u884c\u200b\u65f6\u200b\u5f02\u5e38\u200b\u662f\u200b<code>rollbackFor</code>\u200b\u9ed8\u8ba4\u200b\u6307\u5b9a\u200b\u7684\u200b\u5f02\u5e38\u200b\uff09\uff0c\u200b\u800c\u200b\u4e0d\u200b\u53ea\u662f\u200b\u6253\u5370\u200b\u5f02\u5e38\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u7efc\u4e0a\u200b\u6240\u8bc9\u200b\uff1a\u200b\u5728\u200b <code>Service</code> \u200b\u5c42\u4e2d\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u6700\u597d\u200b\u4e0d\u8981\u200b\u968f\u4fbf\u200b\u5199\u200b <code>try...catch</code> \uff0c\u200b\u5982\u679c\u200b\u5199\u200b\u4e86\u200b\u5219\u200b\u4e00\u5b9a\u200b\u8981\u200b\u624b\u52a8\u200b\u629b\u200b\u5f02\u5e38\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#6","title":"6. \u200b\u6570\u636e\u5e93\u200b\u5f15\u64ce\u200b\u4e0d\u200b\u652f\u6301\u200b\u4e8b\u52a1","text":"<p>\u200b\u4ece\u200b\u00a0<code>MySQL\u00a05.5.5</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u5b58\u50a8\u200b\u5f15\u64ce\u200b\u662f\u200b\uff1a <code>InnoDB</code> \uff0c\u200b\u4e4b\u524d\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\uff1a <code>MyISAM</code> \u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u662f\u4ece\u200b <code>MySQL5.5.5</code> \u200b\u5f00\u59cb\u200b\uff0c <code>MySQL</code> \u200b\u624d\u200b\u652f\u6301\u200b\u4e8b\u52a1\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#7","title":"7. \u200b\u672a\u200b\u542f\u7528\u200b\u4e8b\u52a1","text":"<p>xml \u200b\u914d\u7f6e\u200b</p> XML<pre><code>&lt;!--\u200b\u914d\u7f6e\u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b--&gt;\n&lt;bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"&gt;\n    &lt;property name=\"dataSource\" ref=\"dataSourceRef\"&gt;&lt;/property&gt;\n&lt;/bean&gt;\n\n&lt;!--\u200b\u5f00\u542f\u200b\u4e8b\u52a1\u200b\u7684\u200b\u6ce8\u89e3\u200b\u9a71\u52a8\u200b\uff0c\u200b\u5c06\u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b\u4e2d\u200b\u7684\u200b\u73af\u7ed5\u200b\u901a\u77e5\u200b\u4f5c\u7528\u200b\u5230\u200b\u8fde\u63a5\u70b9\u200b\uff0c\u200b\u8fde\u63a5\u70b9\u200b\u4f7f\u7528\u200b@Transactional\u200b\u8fdb\u884c\u200b\u6807\u8bc6\u200b\ntransaction-manager\u200b\u5c5e\u6027\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u4e8b\u52a1\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200btransactionManager\u200b\u8fd9\u4e2a\u200bid\u200b\u540d\u200b\n--&gt;\n&lt;tx:annotation-driven transaction-manager=\"transactionManager\"/&gt;\n</code></pre> <p>\u200b\u542f\u52a8\u200b\u7c7b\u200b\u914d\u7f6e\u200b</p> Java<pre><code>@SpringBootApplication\n@EnableTransactionManagement\npublic class SpringBootApplication {\n    ...\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#8-beanspring","title":"8. Bean\u200b\u6ca1\u6709\u200b\u7eb3\u5165\u200bSpring\u200b\u5bb9\u5668\u200b\u7ba1\u7406","text":"<p>Sprin\uff47\u200b\u7684\u200b\u4e8b\u52a1\u7ba1\u7406\u200b\u6838\u5fc3\u200b\u662f\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0c\u200b\u4e0d\u662f\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200bBean\u200b\u662f\u200b\u65e0\u6cd5\u200b\u8fdb\u884c\u200b\u88ab\u200bSpring\u200b\u8fdb\u884c\u200b\u4e8b\u52a1\u7ba1\u7406\u200b\u7684\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/#9","title":"9. \u200b\u4e8b\u52a1\u200b\u65b9\u6cd5\u200b\u542f\u52a8\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u5f02\u6b65\u200b\u64cd\u4f5c","text":"<p><code>spring</code> \u200b\u7684\u200b\u4e8b\u52a1\u200b\u662f\u200b\u901a\u8fc7\u200b <code>LocalThread</code> \u200b\u6765\u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u548c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5f00\u542f\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4e1a\u52a1\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e1a\u52a1\u200b\u5c31\u200b\u4f1a\u200b\u4e8b\u52a1\u200b\u5931\u6548\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e8b\u52a1\u200b\u662f\u200b\u57fa\u4e8e\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u7684\u200b\uff0c\u200b\u8981\u200b\u60f3\u200b\u6709\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u9700\u8981\u200b\u88ab\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u3002\u200b\u8fd9\u91cc\u200b\u63d0\u4f9b\u200b\u4e00\u79cd\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u65b0\u200b\u7684\u200b\u4e1a\u52a1\u200b\u5355\u72ec\u200b\u5c01\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7136\u540e\u200b\u6539\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b <code>@Transactional</code> \uff0c\u200b\u6216\u8005\u200b\u5c06\u200b\u8fd9\u4e2a\u200b\u65e0\u6cd5\u200b\u5355\u72ec\u200b\u62bd\u53d6\u200b\u5230\u200b\u4e00\u4e2a\u200b\u7c7b\u4e2d\u200b\uff0c\u200b\u5c06\u200b\u8be5\u7c7b\u200b\u4ea4\u7ed9\u200bIOC\u200b\u5bb9\u5668\u200b\u8fdb\u884c\u200b\u7ba1\u7406\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u80fd\u200b\u8ba9\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e1a\u52a1\u200b\u5177\u6709\u200b\u4e8b\u52a1\u200b\u4e86\u200b </p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/","title":"\u5faa\u73af\u200b\u4f9d\u8d56","text":"<p> \u200b\u7ea6\u200b 908 \u200b\u4e2a\u200b\u5b57\u200b  17 \u200b\u884c\u200b\u4ee3\u7801\u200b  4 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 3 \u200b\u5206\u949f\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/#_2","title":"\u4ec0\u4e48\u200b\u662f\u200b\u5faa\u73af\u200b\u4f9d\u8d56","text":"<p>\u200b\u9996\u5148\u200b\u4e86\u89e3\u200b\u4e00\u4e0b\u200b Bean \u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u5355\u4f8b\u200b Bean \u200b\u4ece\u200b\u521b\u5efa\u200b\u5230\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e3b\u8981\u200b\u7ecf\u5386\u200b\u4e86\u200b\u4e09\u6b65\u200b\u3002</p> <p></p> <p>\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u6765\u200b\u7406\u89e3\u200b\uff0c\u200b\u5728\u200b Spring \u200b\u4e2d\u200b\uff0ca \u200b\u4f9d\u8d56\u200b b\uff0cb \u200b\u4f9d\u8d56\u200ba\uff0c\u200b\u5f62\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u95ed\u73af\u200b\uff0c\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u4efb\u610f\u200b\u4e00\u4e2a\u200b Bean\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6700\u7ec8\u200b\u53c8\u200b\u4f9d\u8d56\u200b\u56de\u200b\u81ea\u5df1\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u521d\u59cb\u5316\u200b\u5931\u8d25\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/#_3","title":"\u89e3\u51b3\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u6d41\u7a0b","text":"<p>spring \u200b\u7528\u200b\u4e86\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u89e3\u51b3\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u3002</p> <ul> <li>\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b: <code>Map&lt;String, Object&gt; singletonObjects</code> \u200b\u662f\u200b\u6210\u54c1\u200b\u5bf9\u8c61\u200b\u5355\u4f8b\u200b\u6c60\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u3001\u200b\u5c5e\u6027\u200b\u8d4b\u503c\u200b (\u200b\u6ce8\u5165\u200b)\u3001\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b\u7684\u200b bean \u200b\u5b9e\u4f8b\u200b</li> <li>\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b: <code>Map&lt;String, Object&gt; earlySingletonObjects</code> \u200b\u5b58\u50a8\u200b\u65e9\u671f\u200b\u66dd\u5149\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u5b8c\u6210\u200b\u7684\u200b bean \u200b\u5b9e\u4f8b\u200b</li> <li>\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b: <code>Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories</code> \u200b\u662f\u200b\u65e9\u671f\u200b\u66dd\u5149\u200b\u5bf9\u8c61\u200b\u5de5\u5382\u200b\uff0c\u200b\u4fdd\u5b58\u200b bean \u200b\u521b\u5efa\u200b\u5de5\u5382\u200b(ObjectFactory)</li> </ul> Java<pre><code>  /**\n * \u200b\u5355\u4f8b\u200b\u5bf9\u8c61\u200b\u96c6\u5408\u200b\uff0c\u200b\u5b58\u50a8\u200b BeanName - Bean\u200b\u5bf9\u8c61\u200b \u200b\u952e\u503c\u200b\u5bf9\u200b\n * Cache of singleton objects: bean name --&gt; bean instance\n */\nprivate final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;();\n\n/**\n * \u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\uff0c\u200b\u63d0\u524d\u200b\u66b4\u9732\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5b8c\u5168\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u7684\u200b\u5bf9\u8c61\u200b\n * Cache of singleton objects: bean name --&gt; bean instance\n */\nprotected final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;();\n\n/**\n * \u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5b58\u653e\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\n * Cache of singleton factories: bean name --&gt; ObjectFactory\n */\nprotected final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;();\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/#_4","title":"\u4e00\u7ea7\u200b\u7f13\u5b58\u200b\u4f5c\u7528","text":"<p>\u200b\u5728\u200b\u83b7\u53d6\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>getSingleton(beanName)</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4ece\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b\u83b7\u53d6\u200b Bean\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200b\u91cd\u8f7d\u200b\u65b9\u6cd5\u200b <code>getSingleton(beanName, \u200b\u521b\u5efa\u200b\u65b9\u6cd5\u200b)</code> \u200b\u521b\u5efa\u200b Bean \u200b\u540e\u200b\uff0c\u200b\u5c06\u200b\u5b83\u200b\u8bbe\u7f6e\u200b\u56de\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/#_5","title":"\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u4f5c\u7528","text":"<p>\u200b\u5728\u200b <code>createBean</code> \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u8c03\u7528\u200b\u5177\u4f53\u200b\u7684\u200b <code>doCreateBean</code> \u200b\u65b9\u6cd5\u200b </p> <p>\u200b\u4e3b\u8981\u200b\u505a\u200b\u4e86\u200b\u5982\u4e0b\u200b\u51e0\u4ef6\u4e8b\u200b</p> <ol> <li>\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u5c06\u200b\u5bf9\u8c61\u200b\u7684\u200b\u521b\u5efa\u200b\u5de5\u5382\u200b\u4fdd\u5b58\u200b\u5728\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> <li>\u200b\u5c5e\u6027\u200b\u8d4b\u503c\u200b</li> <li>\u200b\u521d\u59cb\u5316\u200b\u5904\u7406\u200b (\u200b\u524d\u7f6e\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u540e\u7f6e\u200b)</li> </ol> <p></p> <p>\u200b\u5bf9\u8c61\u200b\u5de5\u5382\u200b\u505a\u200b\u4e86\u200b\u4ec0\u4e48\u200b </p> <p>\u200b\u672c\u8d28\u200b\u4e0a\u200b\u7684\u200b\u4f5c\u7528\u200b\u662f\u200b\u66b4\u9732\u200b\u4e00\u4e2a\u200b\u65e9\u671f\u200b\u5bf9\u8c61\u200b\u3002\u200b\u628a\u200b\u6240\u6709\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>InstantiationAwareBeanPostProcessor</code> (Spring \u200b\u6e90\u7801\u200b\u4e2d\u4e3a\u200b <code>SmartInstantiationAwareBeanPostProcessor</code> ) \u200b\u7684\u200b\u540e\u7f6e\u200b\u5904\u7406\u5668\u200b\u63d0\u524d\u200b\u8fd0\u884c\u200b\u3002AOP \u200b\u5728\u200b\u8fd9\u91cc\u200b\u63d0\u524d\u200b\u6267\u884c\u200b\u3002</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u8fd9\u4e48\u200b\u8bf4\u200b\uff0c <code>SmartInstantiationAwareBeanPostProcessor</code> \u200b\u5c31\u662f\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u800c\u751f\u200b\u7684\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/#_6","title":"\u4e8c\u7ea7\u7f13\u5b58\u200b\u4f5c\u7528","text":"<p>\u200b\u5728\u200b\u5c5e\u6027\u200b\u8d4b\u503c\u200b\u9636\u6bb5\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u89e3\u51b3\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u7684\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li> <p>A \u200b\u5b9e\u4f8b\u200b\u5316\u200b\u6210\u529f\u200b</p> </li> <li> <p>A \u200b\u628a\u200b\u81ea\u5df1\u200b\u7684\u200b ObjectFactory \u200b\u4fdd\u5b58\u200b\u5728\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b</p> </li> <li> <p>A \u200b\u5c5e\u6027\u200b\u8d4b\u503c\u200b\u4f9d\u8d56\u200b B</p> </li> <li> <p>B \u200b\u5b9e\u4f8b\u200b\u5316\u200b\u6210\u529f\u200b</p> </li> <li> <p>B \u200b\u628a\u200b\u81ea\u5df1\u200b\u7684\u200b ObjectFactory \u200b\u4fdd\u5b58\u200b\u5728\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u4e2d\u200b</p> </li> <li> <p>B \u200b\u5c5e\u6027\u200b\u590d\u5236\u200b\u4f9d\u8d56\u200b A\uff0c\u200b\u8fd9\u65f6\u5019\u200b B \u200b\u8c03\u7528\u200b\u7684\u200b\u662f\u200b\u590d\u7528\u200b\u7684\u200b <code>getSingleton(beanName)</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5e95\u5c42\u200b\u4f1a\u5148\u200b\u53bb\u200b\u4e00\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\u4e2d\u200b\u627e\u200b A\uff0c\u200b\u5982\u679c\u200b\u90fd\u200b\u627e\u200b\u4e0d\u5230\u200b\uff0c\u200b\u4f1a\u200b\u627e\u5230\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\uff0c\u200b\u7136\u540e\u200b\u8c03\u7528\u200b\u5bf9\u8c61\u200b\u5de5\u5382\u200b\u7684\u200b\u83b7\u53d6\u200b\u5bf9\u8c61\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u83b7\u53d6\u200b\u4ee3\u7406\u200b\u540e\u200b\u6216\u8005\u200b\u6ca1\u6709\u200b\u4ee3\u7406\u200b\u7684\u200b\u5bf9\u8c61\u200b(\u200b\u8fd9\u4e2a\u200b\u53d6\u51b3\u4e8e\u200b wrapIfNecessary \u200b\u903b\u8f91\u200b)\uff0c\u200b\u6700\u540e\u200b\u628a\u200b\u5f97\u5230\u200b\u7684\u200b\u5bf9\u8c61\u200b\u653e\u5230\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5220\u9664\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u3002</p> </li> <li> <p>\u200b\u4e4b\u540e\u200b\u5982\u679c\u200b C \u200b\u4e5f\u200b\u4f9d\u8d56\u200b\u4e86\u200b A\uff0c\u200b\u90a3\u4e48\u200b\u4e5f\u200b\u80fd\u200b\u5728\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\u4e2d\u200b\u627e\u5230\u200b\u8fd9\u4e2a\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u3002\u200b\u4e00\u65e6\u200b A \u200b\u521d\u59cb\u5316\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u81ea\u5df1\u200b\u653e\u5165\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u540c\u65f6\u200b\u5220\u9664\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\u3002</p> </li> </ol> <p></p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/#_7","title":"\u53ea\u7528\u200b\u4e00\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\uff0c\u200b\u80fd\u5426\u200b\u89e3\u51b3\u200b\u5faa\u73af\u200b\u4f9d\u8d56","text":"<p>\u200b\u7406\u8bba\u200b\u4e0a\u200b\uff0c\u200b\u53ea\u7528\u200b\u4e00\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\u5c31\u200b\u80fd\u200b\u89e3\u51b3\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u629b\u5f03\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\uff0c\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u7684\u200b value \u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u5de5\u5382\u200b\uff0c\u200b\u90a3\u4e48\u200b\u662f\u4e0d\u662f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5bf9\u8c61\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u90fd\u200b\u53bb\u200b\u6267\u884c\u200b\u4e00\u904d\u200b ObjectFactory \u200b\u7684\u200b\u521b\u5efa\u5bf9\u8c61\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5c06\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\u5b58\u50a8\u200b\u5728\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\u91cc\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u5176\u5b9e\u200b\u662f\u200b\u548c\u200b spring \u200b\u89c4\u8303\u200b\u6302\u94a9\u200b\u7684\u200b\u3002</p> <p>\u200b\u56e0\u4e3a\u200b aop \u200b\u7684\u200b\u5b9e\u73b0\u200b\u662f\u200b\u9760\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>SmartInstantiationAwareBeanPostProcessor</code> \u200b\u63a5\u53e3\u200b\u7684\u200b <code>AnnotationAwareAspectJAutoProxyCreator</code> \u200b\u5728\u200b bean \u200b\u7684\u200b\u540e\u7f6e\u200b\u5904\u7406\u5668\u200b\u751f\u6548\u200b\u7684\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u662f\u200b\u5728\u200b bean \u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u751f\u6548\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u521a\u521a\u200b\u5b9e\u4f8b\u200b\u5316\u200b\uff0c\u200b\u5c31\u200b\u6267\u884c\u200b\u4e86\u200b\u540e\u7f6e\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u90a3\u200b\u548c\u200b spring \u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u662f\u200b\u76f8\u6096\u200b\u7684\u200b\u3002\u200b\u4e3a\u6b64\u200b\uff0cspring \u200b\u91c7\u7528\u200b\u4e86\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u673a\u5236\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u6253\u7834\u200b\u751f\u547d\u5468\u671f\u200b\uff0c\u200b\u63d0\u524d\u200b\u83b7\u53d6\u200b\u4ee3\u7406\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u662f\u200b\u6700\u5c0f\u200b\u7a0b\u5ea6\u200b\u7684\u200b\u6253\u7834\u200b\u3002</p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/","title":"\u8be6\u89e3\u200b Spring \u200b\u751f\u547d\u5468\u671f","text":"<p> \u200b\u7ea6\u200b 2032 \u200b\u4e2a\u200b\u5b57\u200b  179 \u200b\u884c\u200b\u4ee3\u7801\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 9 \u200b\u5206\u949f\u200b</p> <p>\u200b\u672c\u6587\u200b\u4e2d\u200b\u9664\u4e86\u200b Simple-Spring \u200b\u672a\u200b\u5b9e\u73b0\u200b\u7684\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u5747\u200b\u4f7f\u7528\u200b Simple-Spring \u200b\u4e2d\u200b\u7684\u200b\u4ee3\u7801\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#1-spring","title":"1. Spring \u200b\u751f\u547d\u5468\u671f\u200b\u6d41\u7a0b\u56fe","text":"","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#2-applicationcontextinitializer","title":"2. ApplicationContextInitializer","text":"<p>org.springframework.context.ApplicationContextInitializer</p> <p>\u200b\u8fd9\u662f\u200b\u6574\u4e2a\u200bspring\u200b\u5bb9\u5668\u200b\u5728\u200b\u5237\u65b0\u200b\u4e4b\u524d\u200b\u521d\u59cb\u5316\u200b<code>ConfigurableApplicationContext</code>\u200b\u7684\u200b\u56de\u8c03\u200b\u63a5\u53e3\u200b\uff0c\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u5bb9\u5668\u200b\u5237\u65b0\u200b\u4e4b\u524d\u200b\u8c03\u7528\u200b\u6b64\u7c7b\u200b\u7684\u200b<code>initialize</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\u5141\u8bb8\u200b\u88ab\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u6269\u5c55\u200b\u3002\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5728\u200b\u6574\u4e2a\u200bspring\u200b\u5bb9\u5668\u200b\u8fd8\u200b\u6ca1\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\u4e4b\u524d\u200b\u505a\u200b\u4e00\u4e9b\u200b\u4e8b\u60c5\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u60f3\u5230\u200b\u7684\u200b\u573a\u666f\u200b\u53ef\u80fd\u200b\u4e3a\u200b\uff0c\u200b\u5728\u200b\u6700\u200b\u5f00\u59cb\u200b\u6fc0\u6d3b\u200b\u4e00\u4e9b\u200b\u914d\u7f6e\u200b\uff0c\u200b\u6216\u8005\u200b\u5229\u7528\u200b\u8fd9\u65f6\u5019\u200bclass\u200b\u8fd8\u200b\u6ca1\u200b\u88ab\u200b\u7c7b\u200b\u52a0\u8f7d\u200b\u5668\u200b\u52a0\u8f7d\u200b\u7684\u200b\u65f6\u673a\u200b\uff0c\u200b\u8fdb\u884c\u200b\u52a8\u6001\u200b\u5b57\u8282\u200b\u7801\u200b\u6ce8\u5165\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class TestApplicationContextInitializer implements ApplicationContextInitializer {\n    @Override\n    public void initialize(ConfigurableApplicationContext applicationContext) {\n        System.out.println(\"[ApplicationContextInitializer]\");\n    }\n}\n</code></pre> <p>\u200b\u56e0\u4e3a\u200b\u8fd9\u65f6\u5019\u200bspring\u200b\u5bb9\u5668\u200b\u8fd8\u200b\u6ca1\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u6240\u4ee5\u200b\u60f3\u8981\u200b\u81ea\u5df1\u200b\u7684\u200b\u6269\u5c55\u200b\u7684\u200b\u751f\u6548\u200b\uff0c\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u4e09\u79cd\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b\u542f\u52a8\u200b\u7c7b\u4e2d\u7528\u200b<code>springApplication.addInitializers(new TestApplicationContextInitializer())</code>\u200b\u8bed\u53e5\u200b\u52a0\u5165\u200b</li> <li>\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u914d\u7f6e\u200b<code>context.initializer.classes=com.example.demo.TestApplicationContextInitializer</code></li> <li>Spring SPI\u200b\u6269\u5c55\u200b\uff0c\u200b\u5728\u200bspring.factories\u200b\u4e2d\u200b\u52a0\u5165\u200b<code>org.springframework.context.ApplicationContextInitializer=com.example.demo.TestApplicationContextInitializer</code></li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#3-beandefinitionregistrypostprocessor","title":"3. BeanDefinitionRegistryPostProcessor","text":"<p>org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor</p> <p>\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u5728\u200b\u8bfb\u53d6\u200b\u9879\u76ee\u200b\u4e2d\u200b\u7684\u200b<code>beanDefinition</code>\u200b\u4e4b\u540e\u200b\u6267\u884c\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u8865\u5145\u200b\u7684\u200b\u6269\u5c55\u200b\u70b9\u200b</p> <p>\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd9\u91cc\u200b\u52a8\u6001\u200b\u6ce8\u518c\u200b\u81ea\u5df1\u200b\u7684\u200b<code>beanDefinition</code>\uff0c\u200b\u53ef\u4ee5\u200b\u52a0\u8f7d\u200bclasspath\u200b\u4e4b\u5916\u200b\u7684\u200bbean</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b:</p> Java<pre><code>public class TestBeanDefinitionRegistryPostProcessor implements BeanDefinitionRegistryPostProcessor {\n    @Override\n    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException {\n        System.out.println(\"[BeanDefinitionRegistryPostProcessor] postProcessBeanDefinitionRegistry\");\n    }\n\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n        System.out.println(\"[BeanDefinitionRegistryPostProcessor] postProcessBeanFactory\");\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#4-beanfactorypostprocessor","title":"4. BeanFactoryPostProcessor","text":"<p>com.iflove.simplespring.beans.factory.config.BeanFactoryPostProcessor</p> <p>\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u662f\u200b<code>beanFactory</code>\u200b\u7684\u200b\u6269\u5c55\u200b\u63a5\u53e3\u200b\uff0c\u200b\u8c03\u7528\u200b\u65f6\u673a\u200b\u5728\u200bspring\u200b\u5728\u200b\u8bfb\u53d6\u200b<code>beanDefinition</code>\u200b\u4fe1\u606f\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5b9e\u4f8b\u200b\u5316\u200bbean\u200b\u4e4b\u524d\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u65f6\u673a\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u63a5\u53e3\u200b\u6765\u200b\u81ea\u884c\u5904\u7406\u200b\u4e00\u4e9b\u200b\u4e1c\u897f\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4fee\u6539\u200b\u5df2\u7ecf\u200b\u6ce8\u518c\u200b\u7684\u200b<code>beanDefinition</code>\u200b\u7684\u200b\u5143\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class TestBeanFactoryPostProcessor implements BeanFactoryPostProcessor {\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n        System.out.println(\"[BeanFactoryPostProcessor]\");\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#5-applicationeventmulticaster","title":"5. ApplicationEventMulticaster","text":"<p>com.iflove.simplespring.context.event.ApplicationEventMulticaster com.iflove.simplespring.context.event.AbstractApplicationEventMulticaster com.iflove.simplespring.context.ApplicationEvent</p> <p><code>AbstractApplicationEventMulticaster</code> \u200b\u8be5\u200b\u62bd\u8c61\u7c7b\u200b\u5b9e\u73b0\u200b\u4e86\u200b <code>ApplicationEventMulticaster</code> \u200b\u63a5\u53e3\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7ee7\u627f\u200b\u8fd9\u4e2a\u200b\u62bd\u8c61\u7c7b\u200b\u5b9e\u73b0\u200b\u53d1\u5e03\u200b\u4ee5\u53ca\u200b\u76d1\u542c\u200b\u65f6\u95f4\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p> <p><code>ApplicationEvent</code> \u200b\u7c7b\u200b\u8868\u793a\u200b\u4e86\u200b\u4e8b\u4ef6\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u7ee7\u627f\u200b\u8fd9\u4e2a\u200b\u7c7b\u200b\u5df2\u200b\u5b9e\u73b0\u200b\u81ea\u5b9a\u4e49\u200b\u4e8b\u4ef6\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\uff1a</p> Java<pre><code>public class ContextRefreshedEvent extends ApplicationEvent {\n    /**\n     * Constructs a prototypical Event.\n     *\n     * @param source The object on which the Event initially occurred.\n     * @throws IllegalArgumentException if source is null.\n     */\n    public ContextRefreshedEvent(Object source) {\n        super(source);\n    }\n}\n</code></pre> Java<pre><code>public class SimpleApplicationEventMulticaster extends AbstractApplicationEventMulticaster {  \n\n    public SimpleApplicationEventMulticaster(BeanFactory beanFactory) {  \n        setBeanFactory(beanFactory);  \n    }  \n\n    @Override  \n    public void multicastEvent(final ApplicationEvent event) {  \n        for (ApplicationListener listener : getApplicationListeners(event)) {  \n            listener.onApplicationEvent(event);  \n        }  \n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#6-instantiationawarebeanpostprocessor","title":"6. InstantiationAwareBeanPostProcessor","text":"<p>com.iflove.simplespring.beans.factory.config.InstantiationAwareBeanPostProcessor</p> <p>\u200b\u8be5\u200b\u63a5\u53e3\u200b\u7ee7\u627f\u200b\u4e86\u200b<code>BeanPostProcess</code>\u200b\u63a5\u53e3\u200b\uff0c\u200b\u533a\u522b\u200b\u5982\u4e0b\u200b\uff1a</p> <p><code>BeanPostProcess</code>\u200b\u63a5\u53e3\u200b\u53ea\u200b\u5728\u200bbean\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u9636\u6bb5\u200b\u8fdb\u884c\u200b\u6269\u5c55\u200b\uff08\u200b\u6ce8\u5165\u200bspring\u200b\u4e0a\u4e0b\u6587\u200b\u524d\u540e\u200b\uff09\uff0c\u200b\u800c\u200b<code>InstantiationAwareBeanPostProcessor</code>\u200b\u63a5\u53e3\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\u589e\u52a0\u200b\u4e86\u200b3\u200b\u4e2a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u628a\u200b\u53ef\u200b\u6269\u5c55\u200b\u7684\u200b\u8303\u56f4\u200b\u589e\u52a0\u200b\u4e86\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u9636\u6bb5\u200b\u548c\u200b\u5c5e\u6027\u200b\u6ce8\u5165\u200b\u9636\u6bb5\u200b\u3002</p> <p>\u200b\u8be5\u7c7b\u200b\u4e3b\u8981\u200b\u7684\u200b\u6269\u5c55\u200b\u70b9\u6709\u200b\u4ee5\u4e0b\u200b5\u200b\u4e2a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4e3b\u8981\u200b\u5728\u200bbean\u200b\u751f\u547d\u5468\u671f\u200b\u7684\u200b\u4e24\u5927\u200b\u9636\u6bb5\u200b\uff1a\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u9636\u6bb5\u200b\u548c\u200b\u521d\u59cb\u5316\u200b\u9636\u6bb5\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4e00\u8d77\u200b\u8fdb\u884c\u200b\u8bf4\u660e\u200b\uff0c\u200b\u6309\u200b\u8c03\u7528\u200b\u987a\u5e8f\u200b\u4e3a\u200b\uff1a</p> <ul> <li><code>postProcessBeforeInstantiation</code>\uff1a\u200b\u5b9e\u4f8b\u200b\u5316\u200bbean\u200b\u4e4b\u524d\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200bnew\u200b\u8fd9\u4e2a\u200bbean\u200b\u4e4b\u524d\u200b</li> <li><code>postProcessAfterInstantiation</code>\uff1a\u200b\u5b9e\u4f8b\u200b\u5316\u200bbean\u200b\u4e4b\u540e\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200bnew\u200b\u8fd9\u4e2a\u200bbean\u200b\u4e4b\u540e\u200b</li> <li><code>postProcessPropertyValues</code>\uff1abean\u200b\u5df2\u7ecf\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5728\u200b\u5c5e\u6027\u200b\u6ce8\u5165\u200b\u65f6\u200b\u9636\u6bb5\u200b\u89e6\u53d1\u200b\uff0c<code>@Autowired</code>,<code>@Resource</code>\u200b\u7b49\u200b\u6ce8\u89e3\u200b\u539f\u7406\u200b\u57fa\u4e8e\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5b9e\u73b0\u200b</li> <li><code>postProcessBeforeInitialization</code>\uff1a\u200b\u521d\u59cb\u5316\u200bbean\u200b\u4e4b\u524d\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u628a\u200bbean\u200b\u6ce8\u5165\u200bspring\u200b\u4e0a\u4e0b\u6587\u200b\u4e4b\u524d\u200b</li> <li><code>postProcessAfterInitialization</code>\uff1a\u200b\u521d\u59cb\u5316\u200bbean\u200b\u4e4b\u540e\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u628a\u200bbean\u200b\u6ce8\u5165\u200bspring\u200b\u4e0a\u4e0b\u6587\u200b\u4e4b\u540e\u200b</li> </ul> <p>\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u70b9\u200b\u975e\u5e38\u200b\u6709\u7528\u200b \uff0c\u200b\u65e0\u8bba\u662f\u200b\u5199\u200b\u4e2d\u95f4\u4ef6\u200b\u548c\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\uff0c\u200b\u90fd\u200b\u80fd\u200b\u5229\u7528\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u3002\u200b\u6bd4\u5982\u200b\u5bf9\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u67d0\u200b\u4e00\u7c7b\u200b\u63a5\u53e3\u200b\u7684\u200bbean\u200b\u5728\u200b\u5404\u4e2a\u200b\u751f\u547d\u200b\u671f\u95f4\u200b\u8fdb\u884c\u200b\u6536\u96c6\u200b\uff0c\u200b\u6216\u8005\u200b\u5bf9\u200b\u67d0\u4e2a\u200b\u7c7b\u578b\u200b\u7684\u200bbean\u200b\u8fdb\u884c\u200b\u7edf\u4e00\u200b\u7684\u200b\u8bbe\u503c\u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class TestInstantiationAwareBeanPostProcessor implements InstantiationAwareBeanPostProcessor {\n\n    @Override\n    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n        System.out.println(\"[TestInstantiationAwareBeanPostProcessor] before initialization \" + beanName);\n        return bean;\n    }\n\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        System.out.println(\"[TestInstantiationAwareBeanPostProcessor] after initialization \" + beanName);\n        return bean;\n    }\n\n    @Override\n    public Object postProcessBeforeInstantiation(Class&lt;?&gt; beanClass, String beanName) throws BeansException {\n        System.out.println(\"[TestInstantiationAwareBeanPostProcessor] before instantiation \" + beanName);\n        return null;\n    }\n\n    @Override\n    public boolean postProcessAfterInstantiation(Object bean, String beanName) throws BeansException {\n        System.out.println(\"[TestInstantiationAwareBeanPostProcessor] after instantiation \" + beanName);\n        return true;\n    }\n\n    @Override\n    public PropertyValues postProcessPropertyValues(PropertyValues pvs, PropertyDescriptor[] pds, Object bean, String beanName) throws BeansException {\n        System.out.println(\"[TestInstantiationAwareBeanPostProcessor] postProcessPropertyValues \" + beanName);\n        return pvs;\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#7-smartinstantiationawarebeanpostprocessor","title":"7. SmartInstantiationAwareBeanPostProcessor","text":"<p>org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor</p> <p>\u200b\u8be5\u200b\u6269\u5c55\u200b\u63a5\u53e3\u200b\u6709\u200b3\u200b\u4e2a\u200b\u89e6\u53d1\u200b\u70b9\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>predictBeanType</code>\uff1a\u200b\u8be5\u200b\u89e6\u53d1\u200b\u70b9\u200b\u53d1\u751f\u200b\u5728\u200b<code>postProcessBeforeInstantiation</code>\u200b\u4e4b\u524d\u200b(\u200b\u5728\u200b\u56fe\u200b\u4e0a\u200b\u5e76\u200b\u6ca1\u6709\u200b\u6807\u660e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e00\u822c\u200b\u4e0d\u592a\u200b\u9700\u8981\u200b\u6269\u5c55\u200b\u8fd9\u4e2a\u200b\u70b9\u200b)\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u7528\u4e8e\u200b\u9884\u6d4b\u200bBean\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7b2c\u4e00\u4e2a\u200b\u9884\u6d4b\u200b\u6210\u529f\u200b\u7684\u200bClass\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u80fd\u200b\u9884\u6d4b\u200b\u8fd4\u56de\u200bnull\uff1b\u200b\u5f53\u200b\u4f60\u200b\u8c03\u7528\u200b<code>BeanFactory.getType(name)</code>\u200b\u65f6\u5f53\u200b\u901a\u8fc7\u200bbean\u200b\u7684\u200b\u540d\u5b57\u200b\u65e0\u6cd5\u200b\u5f97\u5230\u200bbean\u200b\u7c7b\u578b\u4fe1\u606f\u200b\u65f6\u200b\u5c31\u200b\u8c03\u7528\u200b\u8be5\u200b\u56de\u8c03\u200b\u65b9\u6cd5\u200b\u6765\u200b\u51b3\u5b9a\u200b\u7c7b\u578b\u4fe1\u606f\u200b\u3002</li> <li><code>determineCandidateConstructors</code>\uff1a\u200b\u8be5\u200b\u89e6\u53d1\u200b\u70b9\u200b\u53d1\u751f\u200b\u5728\u200b<code>postProcessBeforeInstantiation</code>\u200b\u4e4b\u540e\u200b\uff0c\u200b\u7528\u4e8e\u200b\u786e\u5b9a\u200b\u8be5\u200bbean\u200b\u7684\u200b\u6784\u9020\u51fd\u6570\u200b\u4e4b\u7528\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b\u8be5\u200bbean\u200b\u7684\u200b\u6240\u6709\u200b\u6784\u9020\u51fd\u6570\u200b\u5217\u8868\u200b\u3002\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u6269\u5c55\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\uff0c\u200b\u6765\u81ea\u200b\u5b9a\u4e49\u200b\u9009\u62e9\u200b\u76f8\u5e94\u200b\u7684\u200b\u6784\u9020\u200b\u5668\u6765\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u8fd9\u4e2a\u200bbean\u3002</li> <li><code>getEarlyBeanReference</code>\uff1a\u200b\u8be5\u200b\u89e6\u53d1\u200b\u70b9\u200b\u53d1\u751f\u200b\u5728\u200b<code>postProcessAfterInstantiation</code>\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5f53\u6709\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u5f53\u200bbean\u200b\u5b9e\u4f8b\u200b\u5316\u597d\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u6709\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u4f1a\u200b\u63d0\u524d\u200b\u66b4\u9732\u200b\u56de\u8c03\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7528\u4e8e\u200bbean\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u7684\u200b\u540e\u7f6e\u200b\u5904\u7406\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u5c31\u662f\u200b\u5728\u200b\u63d0\u524d\u200b\u66b4\u9732\u200b\u7684\u200b\u56de\u8c03\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u89e6\u53d1\u200b\u3002</li> </ul> <p><code>getEarlyBeanReference</code> \u200b\u5728\u200b bean \u200b\u5b9e\u4f8b\u200b\u5316\u200b\u4e4b\u540e\u200b\u4f5c\u4e3a\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u653e\u5165\u200b\u4e09\u7ea7\u200b\u7f13\u5b58\u200b\u4e4b\u4e2d\u200b\u3002</p> Java<pre><code>// \u200b\u5904\u7406\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u5c06\u200b\u5b9e\u4f8b\u200b\u5316\u540e\u200b\u7684\u200bBean\u200b\u5bf9\u8c61\u200b\u63d0\u524d\u200b\u653e\u5165\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u66b4\u9732\u200b\u51fa\u6765\u200b  \nif (beanDefinition.isSingleton()) {  \n    Object finalBean = bean;  \n    addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, beanDefinition, finalBean));  \n}\n</code></pre> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class TestSmartInstantiationAwareBeanPostProcessor implements SmartInstantiationAwareBeanPostProcessor {\n\n    @Override\n    public Class&lt;?&gt; predictBeanType(Class&lt;?&gt; beanClass, String beanName) throws BeansException {\n        System.out.println(\"[TestSmartInstantiationAwareBeanPostProcessor] predictBeanType \" + beanName);\n        return beanClass;\n    }\n\n    @Override\n    public Constructor&lt;?&gt;[] determineCandidateConstructors(Class&lt;?&gt; beanClass, String beanName) throws BeansException {\n        System.out.println(\"[TestSmartInstantiationAwareBeanPostProcessor] determineCandidateConstructors \" + beanName);\n        return null;\n    }\n\n    @Override\n    public Object getEarlyBeanReference(Object bean, String beanName) throws BeansException {\n        System.out.println(\"[TestSmartInstantiationAwareBeanPostProcessor] getEarlyBeanReference \" + beanName);\n        return bean;\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#8-beanfactoryaware","title":"8. BeanFactoryAware","text":"<p>com.iflove.simplespring.beans.factory.BeanFactoryAware</p> <p>\u200b\u8fd9\u4e2a\u200b\u7c7b\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u89e6\u53d1\u200b\u70b9\u200b\uff0c\u200b\u53d1\u751f\u200b\u5728\u200bbean\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6ce8\u5165\u200b\u5c5e\u6027\u200b\u4e4b\u524d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200bSetter\u200b\u4e4b\u524d\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u7c7b\u200b\u7684\u200b\u6269\u5c55\u200b\u70b9\u200b\u65b9\u6cd5\u200b\u4e3a\u200b<code>setBeanFactory</code>\uff0c\u200b\u53ef\u4ee5\u200b\u62ff\u5230\u200b<code>BeanFactory</code>\u200b\u8fd9\u4e2a\u200b\u5c5e\u6027\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u4e3a\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200bbean\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4f46\u200b\u8fd8\u200b\u672a\u200b\u521d\u59cb\u5316\u200b\u4e4b\u524d\u200b\uff0c\u200b\u62ff\u5230\u200b <code>BeanFactory</code>\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u6bcf\u4e2a\u200bbean\u200b\u4f5c\u200b\u7279\u6b8a\u5316\u200b\u7684\u200b\u5b9a\u5236\u200b\u3002\u200b\u4e5f\u200b\u6216\u8005\u200b\u53ef\u4ee5\u200b\u628a\u200b<code>BeanFactory</code>\u200b\u62ff\u5230\u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\uff0c\u200b\u65e5\u540e\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class TestBeanFactoryAware implements BeanFactoryAware {\n    @Override\n    public void setBeanFactory(BeanFactory beanFactory) throws BeansException {\n        System.out.println(\"[TestBeanFactoryAware] \" + beanFactory.getBean(TestBeanFactoryAware.class).getClass().getSimpleName());\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#9-beanpostprocessor-postprocessbeforeinitialization","title":"9. BeanPostProcessor #postProcessBeforeInitialization","text":"<p>com.iflove.simplespring.beans.factory.support.AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization</p> <p>BeanPostProcessor \u200b\u524d\u7f6e\u200b\u5904\u7406\u200b</p> Java<pre><code>/**\n * \u200b\u6267\u884c\u200b BeanPostProcessors \u200b\u63a5\u53e3\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u7684\u200b postProcessBeforeInitialization \u200b\u65b9\u6cd5\u200b\n *\n * @param existingBean\n * @param beanName\n * @return\n * @throws BeansException\n */\n@Override\npublic Object applyBeanPostProcessorsBeforeInitialization(Object existingBean, String beanName) throws BeansException {\n    Object result = existingBean;\n    for (BeanPostProcessor processor : getBeanPostProcessors()) {\n        Object current = processor.postProcessBeforeInitialization(result, beanName);\n        if (Objects.isNull(current)) return result;\n        result = current;\n    }\n    return result;\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#10-initializingbean","title":"10. InitializingBean","text":"<p>com.iflove.simplespring.beans.factory.InitializingBean</p> <p>\u200b\u8fd9\u4e2a\u200b\u7c7b\u200b\uff0c\u200b\u987e\u540d\u601d\u4e49\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7528\u6765\u200b\u521d\u59cb\u5316\u200bbean\u200b\u7684\u200b\u3002 <code>InitializingBean</code> \u200b\u63a5\u53e3\u200b\u4e3a\u200bbean\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u521d\u59cb\u5316\u200b\u65b9\u6cd5\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5b83\u200b\u53ea\u200b\u5305\u62ec\u200b <code>afterPropertiesSet</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u51e1\u662f\u200b\u7ee7\u627f\u200b\u8be5\u200b\u63a5\u53e3\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u5728\u200b\u521d\u59cb\u5316\u200bbean\u200b\u7684\u200b\u65f6\u5019\u200b\u90fd\u200b\u4f1a\u200b\u6267\u884c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u70b9\u200b\u7684\u200b\u89e6\u53d1\u200b\u65f6\u673a\u200b\u5728\u200b <code>postProcessAfterInitialization</code> \u200b\u4e4b\u524d\u200b\u3002</p> <p>\u200b\u6216\u8005\u200b\u4f7f\u7528\u200b <code>@PostConstruct</code></p> <p>\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u7528\u6237\u200b\u5b9e\u73b0\u200b\u6b64\u200b\u63a5\u53e3\u200b\uff0c\u200b\u6765\u200b\u8fdb\u884c\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\u4e00\u4e9b\u200b\u4e1a\u52a1\u200b\u6307\u6807\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u5de5\u4f5c\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class NormalBeanA implements InitializingBean{\n    @Override\n    public void afterPropertiesSet() throws Exception {\n        System.out.println(\"[InitializingBean] NormalBeanA\");\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#11-beanpostprocessor-postprocessafterinitialization","title":"11. BeanPostProcessor #postProcessAfterInitialization","text":"<p>com.iflove.simplespring.beans.factory.support.AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsAfterInitialization</p> <p>BeanPostProcessor \u200b\u540e\u7f6e\u200b\u5904\u7406\u200b</p> Java<pre><code>    /**\n     * \u200b\u6267\u884c\u200b BeanPostProcessors \u200b\u63a5\u53e3\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u7684\u200b postProcessorsAfterInitialization \u200b\u65b9\u6cd5\u200b\n     *\n     * @param existingBean\n     * @param beanName\n     * @return\n     * @throws BeansException\n     */\n    @Override\n    public Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName) throws BeansException {\n        Object result = existingBean;\n        for (BeanPostProcessor processor : getBeanPostProcessors()) {\n            Object current = processor.postProcessAfterInitialization(result, beanName);\n            if (Objects.isNull(current)) return result;\n            result = current;\n        }\n        return result;\n    }\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#12-smartinitializingsingleton","title":"12. SmartInitializingSingleton","text":"<p>org.springframework.beans.factory.SmartInitializingSingleton</p> <p>\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u4e2d\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b<code>afterSingletonsInstantiated</code>\uff0c\u200b\u5176\u200b\u4f5c\u7528\u200b\u662f\u200b\u662f\u200b \u200b\u5728\u200bspring\u200b\u5bb9\u5668\u200b\u7ba1\u7406\u200b\u7684\u200b\u6240\u6709\u200b\u5355\u4f8b\u200b\u5bf9\u8c61\u200b\uff08\u200b\u975e\u61d2\u200b\u52a0\u8f7d\u200b\u5bf9\u8c61\u200b\uff09\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\u8c03\u7528\u200b\u7684\u200b\u56de\u8c03\u200b\u63a5\u53e3\u200b\u3002\u200b\u5176\u200b\u89e6\u53d1\u200b\u65f6\u673a\u200b\u4e3a\u200b<code>postProcessAfterInitialization</code>\u200b\u4e4b\u540e\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u6269\u5c55\u200b\u6b64\u200b\u63a5\u53e3\u200b\u5728\u200b\u5bf9\u200b\u6240\u6709\u200b\u5355\u4f8b\u200b\u5bf9\u8c61\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6bd5\u200b\u540e\u200b\uff0c\u200b\u505a\u200b\u4e00\u4e9b\u200b\u540e\u7f6e\u200b\u7684\u200b\u4e1a\u52a1\u200b\u5904\u7406\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class TestSmartInitializingSingleton implements SmartInitializingSingleton {\n    @Override\n    public void afterSingletonsInstantiated() {\n        System.out.println(\"[TestSmartInitializingSingleton]\");\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#13-commandlinerunner","title":"13. CommandLineRunner","text":"<p>org.springframework.boot.CommandLineRunner</p> <p>\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u4e5f\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\uff1a<code>run(String... args)</code>\uff0c\u200b\u89e6\u53d1\u200b\u65f6\u673a\u200b\u4e3a\u200b\u6574\u4e2a\u200b\u9879\u76ee\u200b\u542f\u52a8\u200b\u5b8c\u6bd5\u200b\u540e\u200b\uff0c\u200b\u81ea\u52a8\u200b\u6267\u884c\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b<code>CommandLineRunner</code>\uff0c\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b<code>@Order</code>\u200b\u6765\u200b\u8fdb\u884c\u200b\u6392\u5e8f\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u7528\u6237\u200b\u6269\u5c55\u200b\u6b64\u200b\u63a5\u53e3\u200b\uff0c\u200b\u8fdb\u884c\u200b\u542f\u52a8\u200b\u9879\u76ee\u200b\u4e4b\u540e\u200b\u4e00\u4e9b\u200b\u4e1a\u52a1\u200b\u7684\u200b\u9884\u5904\u7406\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class TestCommandLineRunner implements CommandLineRunner {\n\n    @Override\n    public void run(String... args) throws Exception {\n        System.out.println(\"[TestCommandLineRunner]\");\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#14-disposablebean","title":"14. DisposableBean","text":"<p>com.iflove.simplespring.beans.factory.DisposableBean</p> <p>\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u70b9\u200b\u4e5f\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\uff1a<code>destroy()</code>\uff0c\u200b\u5176\u200b\u89e6\u53d1\u200b\u65f6\u673a\u200b\u4e3a\u200b\u5f53\u6b64\u200b\u5bf9\u8c61\u200b\u9500\u6bc1\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u6267\u884c\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6bd4\u5982\u8bf4\u200b\u8fd0\u884c\u200b<code>applicationContext.registerShutdownHook</code>\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b\uff1a</p> Java<pre><code>public class NormalBeanA implements DisposableBean {\n    @Override\n    public void destroy() throws Exception {\n        System.out.println(\"[DisposableBean] NormalBeanA\");\n    }\n}\n</code></pre>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#15-applicationlistener","title":"15. ApplicationListener","text":"<p>com.iflove.simplespring.context.ApplicationListener</p> Java<pre><code>public interface ApplicationListener&lt;E extends ApplicationEvent&gt; extends EventListener {\n\n    /**\n     * Handle an application event.\n     * @param event the event to respond to\n     */\n    void onApplicationEvent(E event);\n}\n</code></pre> <p>\u200b\u51c6\u786e\u200b\u7684\u200b\u8bf4\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5e94\u8be5\u200b\u4e0d\u7b97\u200bspring&amp;springboot\u200b\u5f53\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6269\u5c55\u200b\u70b9\u200b\uff0c<code>ApplicationListener</code>\u200b\u53ef\u4ee5\u200b\u76d1\u542c\u200b\u67d0\u4e2a\u200b\u4e8b\u4ef6\u200b\u7684\u200b<code>event</code>\uff0c\u200b\u89e6\u53d1\u200b\u65f6\u673a\u200b\u53ef\u4ee5\u200b\u7a7f\u63d2\u5728\u200b\u4e1a\u52a1\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u67d0\u4e2a\u200b\u4e1a\u52a1\u200b\u4e8b\u4ef6\u200b\u3002\u200b\u4f46\u662f\u200bspring\u200b\u5185\u90e8\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u5185\u7f6e\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7a7f\u63d2\u5728\u200b\u542f\u52a8\u200b\u8c03\u7528\u200b\u4e2d\u200b\u3002\u200b\u6211\u4eec\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\uff0c\u200b\u6765\u200b\u81ea\u5df1\u200b\u505a\u200b\u4e00\u4e9b\u200b\u5185\u7f6e\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u76d1\u542c\u5668\u200b\u6765\u200b\u8fbe\u5230\u200b\u548c\u200b\u524d\u9762\u200b\u4e00\u4e9b\u200b\u89e6\u53d1\u200b\u70b9\u200b\u5927\u81f4\u76f8\u540c\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u7f57\u5217\u200b\u4e0b\u200bspring\u200b\u4e3b\u8981\u200b\u7684\u200b\u5185\u7f6e\u200b\u4e8b\u4ef6\u200b\uff1a</p> <ul> <li> <p>ContextRefreshedEvent</p> <p>ApplicationContext \u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\u6216\u200b\u5237\u65b0\u200b\u65f6\u200b\uff0c\u200b\u8be5\u200b\u4e8b\u4ef6\u200b\u88ab\u200b\u53d1\u5e03\u200b\u3002\u200b\u8fd9\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b<code>ConfigurableApplicationContext</code>\u200b\u63a5\u53e3\u200b\u4e2d\u200b\u4f7f\u7528\u200b <code>refresh()</code>\u200b\u65b9\u6cd5\u200b\u6765\u200b\u53d1\u751f\u200b\u3002\u200b\u6b64\u5904\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u662f\u200b\u6307\u200b\uff1a\u200b\u6240\u6709\u200b\u7684\u200bBean\u200b\u88ab\u200b\u6210\u529f\u200b\u88c5\u8f7d\u200b\uff0c\u200b\u540e\u5904\u7406\u200bBean\u200b\u88ab\u200b\u68c0\u6d4b\u200b\u5e76\u200b\u6fc0\u6d3b\u200b\uff0c\u200b\u6240\u6709\u200bSingleton Bean \u200b\u88ab\u200b\u9884\u200b\u5b9e\u4f8b\u200b\u5316\u200b\uff0c<code>ApplicationContext</code>\u200b\u5bb9\u5668\u200b\u5df2\u200b\u5c31\u7eea\u200b\u53ef\u7528\u200b\u3002</p> </li> <li> <p>ContextStartedEvent</p> <p>\u200b\u5f53\u200b\u4f7f\u7528\u200b <code>ConfigurableApplicationContext</code> \uff08ApplicationContext\u200b\u5b50\u200b\u63a5\u53e3\u200b\uff09\u200b\u63a5\u53e3\u200b\u4e2d\u200b\u7684\u200b start() \u200b\u65b9\u6cd5\u200b\u542f\u52a8\u200b <code>ApplicationContext</code>\u200b\u65f6\u200b\uff0c\u200b\u8be5\u200b\u4e8b\u4ef6\u200b\u88ab\u200b\u53d1\u5e03\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8c03\u67e5\u200b\u4f60\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\uff0c\u200b\u6216\u8005\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63a5\u53d7\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u4e8b\u4ef6\u200b\u540e\u200b\u91cd\u542f\u200b\u4efb\u4f55\u200b\u505c\u6b62\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u3002</p> </li> <li> <p>ContextStoppedEvent</p> <p>\u200b\u5f53\u200b\u4f7f\u7528\u200b <code>ConfigurableApplicationContext</code>\u200b\u63a5\u53e3\u200b\u4e2d\u200b\u7684\u200b <code>stop()</code>\u200b\u505c\u6b62\u200b<code>ApplicationContext</code> \u200b\u65f6\u200b\uff0c\u200b\u53d1\u5e03\u200b\u8fd9\u4e2a\u200b\u4e8b\u4ef6\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63a5\u53d7\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u4e8b\u4ef6\u200b\u540e\u200b\u505a\u200b\u5fc5\u8981\u200b\u7684\u200b\u6e05\u7406\u200b\u7684\u200b\u5de5\u4f5c\u200b</p> </li> <li> <p>ContextClosedEvent</p> <p>\u200b\u5f53\u200b\u4f7f\u7528\u200b <code>ConfigurableApplicationContext</code>\u200b\u63a5\u53e3\u200b\u4e2d\u200b\u7684\u200b <code>close()</code>\u200b\u65b9\u6cd5\u200b\u5173\u95ed\u200b <code>ApplicationContext</code> \u200b\u65f6\u200b\uff0c\u200b\u8be5\u200b\u4e8b\u4ef6\u200b\u88ab\u200b\u53d1\u5e03\u200b\u3002\u200b\u4e00\u4e2a\u200b\u5df2\u200b\u5173\u95ed\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u5230\u8fbe\u200b\u751f\u547d\u5468\u671f\u200b\u672b\u7aef\u200b\uff1b\u200b\u5b83\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u5237\u65b0\u200b\u6216\u200b\u91cd\u542f\u200b</p> </li> <li> <p>RequestHandledEvent</p> <p>\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b web-specific \u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u544a\u8bc9\u200b\u6240\u6709\u200b bean HTTP \u200b\u8bf7\u6c42\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u670d\u52a1\u200b\u3002\u200b\u53ea\u80fd\u200b\u5e94\u7528\u200b\u4e8e\u200b\u4f7f\u7528\u200bDispatcherServlet\u200b\u7684\u200bWeb\u200b\u5e94\u7528\u200b\u3002\u200b\u5728\u200b\u4f7f\u7528\u200bSpring\u200b\u4f5c\u4e3a\u200b\u524d\u7aef\u200b\u7684\u200bMVC\u200b\u63a7\u5236\u5668\u200b\u65f6\u200b\uff0c\u200b\u5f53\u200bSpring\u200b\u5904\u7406\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7ed3\u675f\u200b\u540e\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u89e6\u53d1\u200b\u8be5\u200b\u4e8b\u4ef6\u200b</p> </li> </ul>","tags":["spring","java"]},{"location":"blog/backend/spring/%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/#_1","title":"\u53c2\u8003\u8d44\u6599","text":"<p>Springboot\u200b\u542f\u52a8\u200b\u6269\u5c55\u200b\u70b9\u8d85\u200b\u8be6\u7ec6\u200b\u603b\u7ed3\u200b\uff0c\u200b\u518d\u4e5f\u200b\u4e0d\u6015\u200b\u9762\u8bd5\u5b98\u200b\u95ee\u200b\u4e86\u200bSpring\u200b\u7684\u200b\u6838\u5fc3\u601d\u60f3\u200b\u5c31\u662f\u200b\u5bb9\u5668\u200b\uff0c\u200b\u5f53\u200b\u5bb9\u5668\u200brefresh\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c - \u200b\u6398\u91d1\u200b</p>","tags":["spring","java"]},{"location":"blog/backend/spring/simple-spring/simple-spring/","title":"Simple-Spring","text":"<p> \u200b\u7ea6\u200b 23 \u200b\u4e2a\u200b\u5b57\u200b  4 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/simple-spring/#ioc","title":"IOC","text":"<p>Spring IOC\u200b\u6587\u6863\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/simple-spring/#aop","title":"AOP","text":"<p>Spring AOP\u200b\u6587\u6863\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/simple-spring/#jdbc-tx","title":"JDBC &amp; TX","text":"<p>Spring Tx\u200b\u6587\u6863\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/simple-spring/#web-mvc","title":"Web MVC","text":"<p>Spring MVC\u200b\u6587\u6863\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/","title":"Learn-Spring","text":"<p> \u200b\u7ea6\u200b 361 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#1","title":"1. \u200b\u5c0f\u200b\u5085\u54e5","text":"<p>\u200b\u4e3b\u8981\u200b\u5b9e\u73b0\u200b\u4e86\u200b IOC \u200b\u548c\u200b AOP \u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5bf9\u200b\u521d\u5b66\u8005\u200b\u53cb\u597d\u200b\uff0c\u200b\u7f3a\u5c11\u200b Web\uff0cJDBC\uff0cBoot \u200b\u7b49\u200b\u5b9e\u73b0\u200b</p> <p>Spring \u200b\u624b\u200b\u64b8\u200b\u4e13\u680f\u200b</p> <p>\u200b\u76f8\u5173\u200b\u6e90\u7801\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#2","title":"2. \u200b\u9ed1\u9a6c","text":"<p>\u200b\u6e90\u7801\u200b\u90e8\u5206\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u4e00\u4e2a\u200b\u81ea\u9876\u5411\u4e0b\u200b\u7684\u200b\u68b3\u7406\u200b\uff0c\u200b\u96be\u5ea6\u200b\u8f83\u5927\u200b (\u200b\u4e8c\u7f16\u200b\uff1a\u200b\u5bf9\u200b\u65b0\u624b\u200b\u96be\u5ea6\u200b\u8f83\u5927\u200b\uff0c\u200b\u6709\u200b\u57fa\u7840\u200b\u540e\u200b\u975e\u5e38\u200b\u63a8\u8350\u200b)</p> <p>\u200b\u9ed1\u9a6c\u200b\u7a0b\u5e8f\u5458\u200bSpring\u200b\u89c6\u9891\u6559\u7a0b\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#3","title":"3. \u200b\u5ed6\u200b\u96ea\u5cf0","text":"<p>\u200b\u9002\u5408\u200b\u5bf9\u200b spring \u200b\u6709\u200b\u4e00\u5b9a\u200b\u4e86\u89e3\u200b\u7684\u200b\uff0c\u200b\u4e0d\u7136\u200b\u53ef\u80fd\u200b\u4e00\u5934\u96fe\u6c34\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bd4\u8f83\u200b\u5168\u200b</p> <p>\u200b\u5ed6\u200b\u96ea\u5cf0\u200b  - \u200b\u624b\u5199\u200bSpring</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#4-spring","title":"4. spring \u200b\u5b98\u7f51","text":"<p>spring \u200b\u5b98\u7f51\u200b\u53ca\u200b\u6e90\u7801\u200b</p> <p>Spring | Home</p> <p>spring-framework</p> <p>spring \u200b\u4e2d\u6587\u7f51\u200b</p> <p>spring \u200b\u4e2d\u6587\u7f51\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#5-github","title":"5. github \u200b\u5f00\u200b\u6e90\u4ee3\u7801\u200b/\u200b\u7b14\u8bb0","text":"<p>\u200b\u975e\u5e38\u200b\u8be6\u7ec6\u200b\u7684\u200b\u6e90\u7801\u200b\u89e3\u8bfb\u200b\u7b14\u8bb0\u200b</p> <p>spring-analysis</p> <p>xuchengsheng/spring-reading</p> <p>\u200b\u7b80\u5316\u7248\u200b spring \u200b\u4ee3\u7801\u200b</p> <p>PS\uff1a\u200b\u5c0f\u200b\u5085\u54e5\u200b\u4ee3\u7801\u200b\u4f3c\u4e4e\u200b\u662f\u200b\u6284\u200b\u8fd9\u4f4d\u200b\u5927\u795e\u200b\u7684\u200b</p> <p>mini-spring</p> <p>\u200b\u5bf9\u5e94\u200b\u7684\u200b\u89c6\u9891\u200b\u8bb2\u89e3\u200b (\u200b\u8bb2\u200b\u7684\u200b\u771f\u7684\u200b\u975e\u5e38\u200b\u597d\u200b\uff0c\u200b\u63a8\u8350\u200b\u63a8\u8350\u200b\u63a8\u8350\u200b\uff01\uff01\uff01)</p> <p>1.bean\u200b\u5bb9\u5668\u200b,bean\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u4e0e\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b_\u200b\u54d4\u54e9\u200b\u54d4\u54e9\u200b_bilibili</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#6","title":"6. \u200b\u516b\u80a1\u200b/\u200b\u535a\u5ba2","text":"<p>IoC &amp; AOP\u200b\u8be6\u89e3\u200b</p> <p>Spring IOC \u200b\u5bb9\u5668\u200b\u6e90\u7801\u200b\u5206\u6790\u200b</p> <p>Spring - \u200b\u968f\u7b14\u200b\u5206\u7c7b\u200b - niceyoo - \u200b\u535a\u5ba2\u56ed\u200b</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#7-spring","title":"7. spring \u200b\u4e8b\u52a1\u200b\u8be6\u89e3","text":"<p>Spring\u200b\u4f7f\u7528\u200b@Transactional \u200b\u7ba1\u7406\u200b\u4e8b\u52a1\u200b\uff0cJava\u200b\u4e8b\u52a1\u200b\u8be6\u89e3\u200b\u3002_\u200b\u54d4\u54e9\u200b\u54d4\u54e9\u200b_bilibili</p> <p>Spring\u200b\u4e8b\u52a1\u200b\u6e90\u7801\u200b\u89e3\u6790\u200b\u3010\u200b\u4e00\u6b21\u200b\u4e00\u4e2a\u200b\u89c6\u9891\u200b\u5f04\u61c2\u200b\u3011_\u200b\u54d4\u54e9\u200b\u54d4\u54e9\u200b_bilibili</p> <p>\u200b\u5bf9\u5e94\u200b\u7b14\u8bb0\u200b</p> <p>\u200c\ufeff\u2064\ufeff\u2063\u200b\u200b\ufeff\u200b\u2061\u200d\u200b\u200b\u200b\ufeff\u2064\ufeff\u202c\u200c\u200d\u200c\u200c\u202c\u200b\u200c\u2064\u200b\u200b\u2062\u200c\u202c\u200b\u2063\u200d\u200b\u200b\ufeff\u2061\u200b\u2063\u200b\ufeff\u200b\u200c\u200b\u200b\u2063\u2061\u2064\u200cSpring\u200b\u4e8b\u52a1\u200b\u6e90\u7801\u200b\u89e3\u6790\u200b - Feishu Docs</p>","tags":["spring"]},{"location":"blog/backend/spring/simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/#8-spring-web-mvc","title":"8. Spring Web MVC","text":"<p>Spring \u200b\u4e2d\u6587\u7f51\u200b Spring MVC</p> <p>Spring MVC\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\u53ca\u200b\u6e90\u7801\u200b\u89e3\u6790\u200b\uff08\u200b\u4e00\u200b\uff09 MVC\u200b\u539f\u7406\u200b\u4ecb\u7ecd\u200b\u3001\u200b\u4e0e\u200bIOC\u200b\u5bb9\u5668\u200b\u6574\u5408\u200b\u539f\u7406\u200b - blayn - \u200b\u535a\u5ba2\u56ed\u200b</p> <p>\u200b\u624b\u5199\u200bSpring MVC\u200b\u6846\u67b6\u200b\uff08\u200b\u4e00\u200b\uff09 \u200b\u5b9e\u73b0\u200b\u7b80\u6613\u7248\u200bmvc\u200b\u6846\u67b6\u200b - blayn - \u200b\u535a\u5ba2\u56ed\u200b</p>","tags":["spring"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/","title":"CompletableFuture","text":"<p> \u200b\u7ea6\u200b 1171 \u200b\u4e2a\u200b\u5b57\u200b  323 \u200b\u884c\u200b\u4ee3\u7801\u200b  3 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 8 \u200b\u5206\u949f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#1-completablefuturecompletionstage","title":"1. CompletableFuture\u200b\u548c\u200bCompletionStage\u200b\u4ecb\u7ecd","text":"<ul> <li>\u200b\u63a5\u53e3\u200bCompletionStage<ul> <li>\u200b\u4ee3\u8868\u200b\u5f02\u6b65\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u67d0\u200b\u4e00\u4e2a\u200b\u9636\u6bb5\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u9636\u6bb5\u200b\u5b8c\u6210\u200b\u4ee5\u540e\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u53e6\u5916\u200b\u4e00\u4e2a\u200b\u9636\u6bb5\u200b\u3002</li> <li>\u200b\u4e00\u4e2a\u200b\u9636\u6bb5\u200b\u7684\u200b\u6267\u884c\u200b\u53ef\u80fd\u200b\u662f\u200b\u88ab\u200b\u5355\u4e2a\u200b\u9636\u6bb5\u200b\u7684\u200b\u5b8c\u6210\u200b\u89e6\u53d1\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u7531\u200b\u591a\u4e2a\u200b\u9636\u6bb5\u200b\u4e00\u8d77\u200b\u89e6\u53d1\u200b</li> </ul> </li> <li>\u200b\u7c7b\u200bCompletableFuture<ul> <li>\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u975e\u5e38\u200b\u5f3a\u5927\u200b\u7684\u200bFuture\u200b\u7684\u200b\u6269\u5c55\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u6211\u4eec\u200b\u7b80\u5316\u200b\u5f02\u6b65\u200b\u7f16\u7a0b\u200b\u7684\u200b\u590d\u6742\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u51fd\u6570\u200b\u5f0f\u200b\u7f16\u7a0b\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u56de\u8c03\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5904\u7406\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff0c\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u8f6c\u6362\u200b\u548c\u200b\u7ec4\u5408\u200bCompletableFuture\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u5b83\u200b\u53ef\u80fd\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b\u660e\u786e\u200b\u5b8c\u6210\u200b\u7684\u200bFuture\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b\u5b8c\u6210\u200b\u9636\u6bb5\u200b\uff08CompletionStage\uff09\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b\u5728\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u4ee5\u540e\u200b\u89e6\u53d1\u200b\u4e00\u4e9b\u200b\u51fd\u6570\u200b\u6216\u200b\u6267\u884c\u200b\u67d0\u4e9b\u200b\u52a8\u4f5c\u200b</li> </ul> </li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#2","title":"2. \u200b\u6838\u5fc3\u200b\u7684\u200b\u56db\u4e2a\u200b\u9759\u6001\u65b9\u6cd5\u200b\uff0c\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5f02\u6b65\u200b\u4efb\u52a1","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e0a\u8ff0\u200bExecutor\u200b\u53c2\u6570\u200b\u8bf4\u660e\u200b\uff1a\u200b\u82e5\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b\uff0c\u200b\u5219\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\u7684\u200bForkJoinPoolcommonPool() \u200b\u4f5c\u4e3a\u200b\u5b83\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6267\u884c\u200b\u5f02\u6b65\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5982\u679c\u200b\u6307\u5b9a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u5219\u200b\u4f7f\u7528\u200b\u6211\u4eec\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u6216\u8005\u200b\u7279\u522b\u200b\u6307\u5b9a\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6267\u884c\u200b\u5f02\u6b65\u200b\u4ee3\u7801\u200b</p> Java<pre><code>@Slf4j(topic = \"c.FutureTest1\")\npublic class FutureTest1 {\n\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n        test1();\n        test2();\n    }\n\n    private static void test2() throws ExecutionException, InterruptedException {\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        CompletableFuture&lt;Void&gt; future1 = CompletableFuture.runAsync(() -&gt; {\n            log.debug(\"111\");\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n        }, executorService);\n\n        log.debug(\"{}\", future1.get());\n\n        CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; {\n            log.debug(\"222\");\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n            return \"hello supplyAsync\";\n        }, executorService);\n\n        log.debug(\"{}\", future2.get());\n\n        executorService.shutdown();\n    }\n\n    private static void test1() throws InterruptedException, ExecutionException {\n        CompletableFuture&lt;Void&gt; future1 = CompletableFuture.runAsync(() -&gt; {\n            log.debug(\"111\");\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n        });\n\n        log.debug(\"{}\", future1.get());\n\n        CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; {\n            log.debug(\"222\");\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n            return \"hello supplyAsync\";\n        });\n\n        log.debug(\"{}\", future2.get());\n    }\n}\n</code></pre> <p>\u200b\u8fd0\u884c\u200b\u7ed3\u679c\u200b:</p> Bash<pre><code># test1\n11:52:54.186 c.FutureTest1 [ForkJoinPool.commonPool-worker-1] - 111\n11:52:55.192 c.FutureTest1 [main] - null\n11:52:55.200 c.FutureTest1 [ForkJoinPool.commonPool-worker-1] - 222\n11:52:56.204 c.FutureTest1 [main] - hello supplyAsync\n# test2\n11:52:56.208 c.FutureTest1 [pool-1-thread-1] - 111\n11:52:57.210 c.FutureTest1 [main] - null\n11:52:57.212 c.FutureTest1 [pool-1-thread-2] - 222\n11:52:58.217 c.FutureTest1 [main] - hello supplyAsync\n</code></pre> <p>CompletableFuture\u200b\u51cf\u5c11\u200b\u963b\u585e\u200b\u548c\u200b\u8f6e\u8be2\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f20\u5165\u200b\u56de\u8c03\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5f53\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\u6216\u8005\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\u65f6\u200b\uff0c\u200b\u81ea\u52a8\u200b\u8c03\u7528\u200b\u56de\u8c03\u200b\u5bf9\u8c61\u200b\u7684\u200b\u56de\u8c03\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>@Slf4j(topic = \"c.FutureTest2\")\npublic class FutureTest2 {\n\n    public static void main(String[] args) {\n        ExecutorService executorService = Executors.newFixedThreadPool(3);\n        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; {\n            log.debug(\"------come in\");\n            int result = ThreadLocalRandom.current().nextInt(10);\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n            if (result &gt; 5) {\n                int i = 1 / 0;\n            }\n            log.debug(\"------ result: {}\", result);\n            return result;\n        }, executorService).whenComplete((v, e) -&gt; {\n            if (e == null) {\n                log.debug(\"\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7ed3\u679c\u200b\u662f\u200b: {}\", v);\n            }\n        }).exceptionally(e -&gt; {\n            e.printStackTrace();\n            log.error(\"\u200b\u5f02\u5e38\u200b\u62a5\u9519\u200b\", e);\n            return null;\n        });\n\n        log.debug(\"\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u6267\u884c\u200b\u5176\u4ed6\u200b\u4efb\u52a1\u200b\");\n        executorService.shutdown();\n    }\n}\n</code></pre> <p>\u200b\u6b63\u5e38\u200b\u6267\u884c\u200b\uff1a</p> Bash<pre><code>11:58:22.495 c.FutureTest2 [pool-1-thread-1] - ------come in\n11:58:22.495 c.FutureTest2 [main] - \u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u6267\u884c\u200b\u5176\u4ed6\u200b\u4efb\u52a1\u200b\n11:58:23.501 c.FutureTest2 [pool-1-thread-1] - ------ result: 5\n11:58:23.506 c.FutureTest2 [pool-1-thread-1] - \u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7ed3\u679c\u200b\u662f\u200b: 5\n</code></pre> <p>\u200b\u62a5\u9519\u200b\uff1a</p> <p></p> <p>CompletableFuture\u200b\u4f18\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u7ed3\u675f\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u56de\u8c03\u200b\u67d0\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u8bbe\u7f6e\u200b\u597d\u200b\u56de\u8c03\u200b\u540e\u200b\uff0c\u200b\u4e0d\u7528\u200b\u5173\u5fc3\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u4e4b\u95f4\u200b\u53ef\u4ee5\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b</li> <li>\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u51fa\u9519\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u56de\u8c03\u200b\u67d0\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#3-","title":"3. \u200b\u6848\u4f8b\u200b-\u200b\u7535\u5546\u200b\u7f51\u7ad9\u200b\u7684\u200b\u6bd4\u4ef7\u200b\u9700\u6c42","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#31","title":"3.1 \u200b\u9700\u6c42\u200b\u5206\u6790","text":"<p>\u200b\u7535\u5546\u200b\u7f51\u7ad9\u200b\u6bd4\u4ef7\u200b\u9700\u6c42\u200b\u5206\u6790\u200b\uff1a</p> <ol> <li>\u200b\u9700\u6c42\u200b\u8bf4\u660e\u200b\uff1a<ol> <li>\u200b\u540c\u200b\u4e00\u6b3e\u200b\u4ea7\u54c1\u200b\uff0c\u200b\u540c\u65f6\u200b\u641c\u7d22\u200b\u51fa\u540c\u6b3e\u200b\u4ea7\u54c1\u200b\u5728\u200b\u5404\u5927\u200b\u7535\u5546\u200b\u5e73\u53f0\u200b\u7684\u200b\u552e\u4ef7\u200b</li> <li>\u200b\u540c\u200b\u4e00\u6b3e\u200b\u4ea7\u54c1\u200b\uff0c\u200b\u540c\u65f6\u200b\u641c\u7d22\u200b\u51fa\u672c\u200b\u4ea7\u54c1\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u7535\u5546\u200b\u5e73\u53f0\u200b\u4e0b\u200b\uff0c\u200b\u5404\u4e2a\u200b\u5165\u9a7b\u200b\u5356\u5bb6\u200b\u552e\u4ef7\u200b\u662f\u200b\u591a\u5c11\u200b</li> </ol> </li> <li> <p>\u200b\u8f93\u51fa\u200b\u8fd4\u56de\u200b\uff1a </p> <ol> <li>\u200b\u51fa\u6765\u200b\u7ed3\u679c\u200b\u5e0c\u671b\u200b\u662f\u200b\u540c\u6b3e\u200b\u4ea7\u54c1\u200b\u7684\u200b\u5728\u200b\u4e0d\u540c\u200b\u5730\u65b9\u200b\u7684\u200b\u4ef7\u683c\u200b\u6e05\u5355\u200b\u5217\u8868\u200b\uff0c\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b<code>List&lt;String&gt;</code> \u200b\u4f8b\u5982\u200b\uff1a\u300aMysql\u300b in jd price is 88.05 \u300aMysql\u300b in taobao price is 90.43</li> </ol> </li> <li> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff0c\u200b\u5bf9\u6bd4\u200b\u540c\u4e00\u4e2a\u200b\u4ea7\u54c1\u200b\u5728\u200b\u5404\u4e2a\u200b\u5e73\u53f0\u200b\u4e0a\u200b\u7684\u200b\u4ef7\u683c\u200b\uff0c\u200b\u8981\u6c42\u200b\u83b7\u5f97\u200b\u4e00\u4e2a\u200b\u6e05\u5355\u200b\u5217\u8868\u200b</p> <ol> <li>step by step\uff0c\u200b\u6309\u90e8\u5c31\u73ed\u200b\uff0c\u200b\u67e5\u5b8c\u200b\u6dd8\u5b9d\u200b\u67e5\u200b\u4eac\u4e1c\u200b\uff0c\u200b\u67e5\u5b8c\u200b\u4eac\u4e1c\u200b\u67e5\u5929\u200b\u732b\u200b....</li> <li>all in\uff0c\u200b\u4e07\u7bad\u9f50\u200b\u53d1\u200b\uff0c\u200b\u4e00\u53e3\u6c14\u200b\u591a\u7ebf\u7a0b\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u540c\u65f6\u200b\u67e5\u8be2\u200b</li> </ol> </li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#32","title":"3.2 \u200b\u4ee3\u7801","text":"Java<pre><code>@Slf4j(topic = \"c.FutureTest3\")\npublic class FutureTest3 {\n\n    public static void main(String[] args) {\n        List&lt;NetMall&gt; list = Arrays.asList(new NetMall(\"jd\"),\n                new NetMall(\"taobao\"),\n                new NetMall(\"dangdang\"));\n\n        long startTime = System.currentTimeMillis();\n        List&lt;String&gt; l1 = getPrice(list, \"mysql\");\n        for (String e : l1) {\n            log.debug(\"{}\", e);\n        }\n        long endTime = System.currentTimeMillis();\n        log.debug(\"costTime: {} ms\", endTime - startTime);\n\n        log.debug(\"=====================================\");\n\n        long startTime2 = System.currentTimeMillis();\n        List&lt;String&gt; l2 = getPriceByCompletableFuture(list, \"mysql\");\n        for (String e : l2) {\n            log.debug(\"{}\", e);\n        }\n        long endTime2 = System.currentTimeMillis();\n        log.debug(\"costTime: {} ms\", endTime2 - startTime2);\n    }\n\n    private static List&lt;String&gt; getPrice(List&lt;NetMall&gt; list, String productName) {\n        return list.stream()\n                .map(mall -&gt;\n                        String.format(\"\u300a%s\u300b in %s price is %.2f\",\n                                productName,\n                                mall.getNetMallName(),\n                                mall.calcPrice(productName)))\n                .collect(Collectors.toList());\n    }\n\n    private static List&lt;String&gt; getPriceByCompletableFuture(List&lt;NetMall&gt; list, String productName) {\n        return list.stream()\n                .map(mall -&gt;\n                        CompletableFuture.supplyAsync(() -&gt;\n                                String.format(\"\u300a%s\u300b in %s price is %.2f\",\n                                        productName,\n                                        mall.getNetMallName(),\n                                        mall.calcPrice(productName))))\n                .collect(Collectors.toList())\n                .stream()\n                .map(CompletableFuture::join)\n                .collect(Collectors.toList());\n    }\n}\n\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\nclass NetMall {\n    private String netMallName;\n\n    public double calcPrice(String productName) {\n        try {\n            TimeUnit.SECONDS.sleep(1);\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n\n        return ThreadLocalRandom.current().nextDouble() * 2 + productName.charAt(0);\n    }\n}\n</code></pre> <p>\u200b\u7ed3\u679c\u200b:</p> Bash<pre><code>12:22:43.563 c.FutureTest3 [main] - \u300amysql\u300b in jd price is 109.78\n12:22:43.572 c.FutureTest3 [main] - \u300amysql\u300b in taobao price is 110.58\n12:22:43.572 c.FutureTest3 [main] - \u300amysql\u300b in dangdang price is 110.68\n12:22:43.572 c.FutureTest3 [main] - costTime: 3062 ms\n12:22:43.573 c.FutureTest3 [main] - =====================================\n12:22:44.584 c.FutureTest3 [main] - \u300amysql\u300b in jd price is 109.47\n12:22:44.584 c.FutureTest3 [main] - \u300amysql\u300b in taobao price is 110.51\n12:22:44.584 c.FutureTest3 [main] - \u300amysql\u300b in dangdang price is 110.38\n12:22:44.584 c.FutureTest3 [main] - costTime: 1011 ms\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#4-completablefuture","title":"4. CompletableFuture\u200b\u5e38\u7528\u200b\u65b9\u6cd5","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#41","title":"4.1 \u200b\u83b7\u5f97\u200b\u7ed3\u679c\u200b\u548c\u200b\u89e6\u53d1\u200b\u8ba1\u7b97","text":"<ol> <li>\u200b\u83b7\u53d6\u200b\u7ed3\u679c\u200b<ol> <li><code>public T get()</code></li> <li><code>public T get(long timeout,TimeUnit unit)</code></li> <li><code>public T join()</code>---&gt;\u200b\u548c\u200bget\u200b\u4e00\u6837\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e0d\u200b\u9700\u8981\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> <li><code>public T getNow(T valuelfAbsent)</code> ---&gt;\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u5c31\u200b\u8fd4\u56de\u200b\u6b63\u5e38\u503c\u200b\uff0c\u200b\u5426\u5219\u200b\u8fd4\u56de\u200b\u5907\u80ce\u200b\u503c\u200b\uff08\u200b\u4f20\u5165\u200b\u7684\u200b\u53c2\u6570\u200b\uff09\uff0c\u200b\u7acb\u5373\u200b\u83b7\u53d6\u200b\u7ed3\u679c\u200b\u4e0d\u200b\u963b\u585e\u200b</li> </ol> </li> <li>\u200b\u4e3b\u52a8\u200b\u89e6\u53d1\u200b\u8ba1\u7b97\u200b<ol> <li><code>public boolean complete(T value)</code> ----&gt;\u200b\u662f\u5426\u200b\u6253\u65ad\u200bget\u200b\u65b9\u6cd5\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b\u62ec\u53f7\u200b\u503c\u200b</li> </ol> </li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#42","title":"4.2 \u200b\u5bf9\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u8fdb\u884c\u200b\u5904\u7406","text":"<ul> <li><code>thenApply</code> ---&gt;\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u5b58\u5728\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e32\u884c\u5316\u200b----&gt;\u200b\u7531\u4e8e\u200b\u5b58\u5728\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff08\u200b\u5f53\u524d\u200b\u6b65\u9519\u200b\uff0c\u200b\u4e0d\u200b\u8d70\u200b\u4e0b\u200b\u4e00\u6b65\u200b\uff09\uff0c\u200b\u5f53\u524d\u200b\u6b65\u9aa4\u200b\u6709\u200b\u5f02\u5e38\u200b\u7684\u8bdd\u200b\u5c31\u200b\u53eb\u505c\u200b</li> <li><code>handle</code> ---&gt;\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u5b58\u5728\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e32\u884c\u5316\u200b----&gt;\u200b\u6709\u200b\u5f02\u5e38\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5f80\u4e0b\u8d70\u200b\u4e00\u6b65\u200b</li> </ul> Java<pre><code>@Slf4j(topic = \"c.CompletableFutureApiDemo\")\npublic class CompletableFutureApiDemo {\n    public static void main(String[] args) throws ExecutionException, InterruptedException, TimeoutException {\n        ExecutorService threadPool = Executors.newFixedThreadPool(3);\n        CompletableFuture&lt;Integer&gt; completableFuture = CompletableFuture.supplyAsync(() -&gt; {\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            return 1;\n        }, threadPool).thenApply(f -&gt; {\n            log.debug(\"222\");\n            return f + 2;\n        }).handle((f, e) -&gt; {\n            log.debug(\"333\");\n            int i = 10 / 0;\n            return f + 2;\n        }).whenComplete((v, e) -&gt; {\n            if (e == null) {\n                log.debug(\"\u200b\u8ba1\u7b97\u7ed3\u679c\u200b: {}\", v);\n            }\n        }).exceptionally(e -&gt; {\n            e.printStackTrace();\n            System.out.println(e.getCause());\n            return null;\n        });\n        log.debug(\"\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u6267\u884c\u200b\u5176\u4ed6\u200b\u4efb\u52a1\u200b\");\n\n        threadPool.shutdown();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#43","title":"4.3 \u200b\u5bf9\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u8fdb\u884c\u200b\u6d88\u8d39","text":"<ul> <li>\u200b\u63a5\u53d7\u4efb\u52a1\u200b\u7684\u200b\u5904\u7406\u7ed3\u679c\u200b\uff0c\u200b\u5e76\u200b\u6d88\u8d39\u200b\u5904\u7406\u200b\uff0c\u200b\u65e0\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b</li> <li>thenAccept</li> </ul> Java<pre><code>@Slf4j(topic = \"c.CompletableFutureApi2Demo\")\npublic class CompletableFutureApi2Demo {\n    public static void main(String[] args) {\n        ExecutorService threadPool = Executors.newFixedThreadPool(3);\n        CompletableFuture.supplyAsync(() -&gt; 1, threadPool)\n                .thenApply(f -&gt; f + 2)\n                .thenApply(f -&gt; f + 2)\n                .thenAccept(r -&gt; log.debug(\"result: {}\", r)); // 5\n        threadPool.shutdown();\n    }\n}\n</code></pre> <ul> <li> <p>\u200b\u5bf9\u6bd4\u200b\u8865\u5145\u200b</p> <ul> <li><code>thenRun(Runnable runnable)</code> :\u200b\u4efb\u52a1\u200bA\u200b\u6267\u884c\u200b\u5b8c\u200b\u6267\u884c\u200bB\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u200b\u9700\u8981\u200bA\u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li><code>thenAccept(Consumer action)</code>: \u200b\u4efb\u52a1\u200bA\u200b\u6267\u884c\u200b\u5b8c\u200b\u6267\u884c\u200bB\uff0cB\u200b\u9700\u8981\u200bA\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4efb\u52a1\u200bB\u200b\u6ca1\u6709\u200b\u8fd4\u56de\u503c\u200b</li> <li><code>thenApply(Function fn)</code>: \u200b\u4efb\u52a1\u200bA\u200b\u6267\u884c\u200b\u5b8c\u200b\u6267\u884c\u200bB\uff0cB\u200b\u9700\u8981\u200bA\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u540c\u65f6\u200b\u4efb\u52a1\u200bB\u200b\u6709\u200b\u8fd4\u56de\u503c\u200b</li> </ul> </li> </ul> Java<pre><code>@Slf4j(topic = \"c.CompletableFutureApi2Demo\")\npublic class CompletableFutureApi2Demo {\n    public static void main(String[] args) {\n        log.debug(\"{}\",\n                CompletableFuture.supplyAsync(() -&gt; \"result\")\n                .thenRun(() -&gt; {})\n                .join()); //null\n        log.debug(\"{}\",\n                CompletableFuture.supplyAsync(() -&gt; \"result\")\n                        .thenAccept(r -&gt; log.debug(\"{}\", r))\n                        .join()); //result null\n        log.debug(\"{}\", CompletableFuture.supplyAsync(() -&gt; \"result\")\n                .thenApply(f -&gt; f + 2)\n                .join()); // result2\n    }\n}\n</code></pre> <ul> <li>CompletableFuture\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8bf4\u660e\u200b<ul> <li>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u4f20\u5165\u200b\u81ea\u5b9a\u4e49\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u90fd\u200b\u7528\u200b\u9ed8\u8ba4\u200b\u7ebf\u7a0b\u200b\u6c60\u200bForkJoinPool</li> <li>\u200b\u4f20\u5165\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u6267\u884c\u200b\u7b2c\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u4f20\u5165\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u7ebf\u7a0b\u200b\u6c60\u200b<ul> <li>\u200b\u8c03\u7528\u200bthenRun\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u7b2c\u4e8c\u4e2a\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u5219\u200b\u7b2c\u4e8c\u4e2a\u200b\u4efb\u52a1\u200b\u548c\u200b\u7b2c\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u65f6\u200b\u5171\u7528\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> <li>\u200b\u8c03\u7528\u200bthenRunAsync\u200b\u6267\u884c\u200b\u7b2c\u4e8c\u4e2a\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u5219\u200b\u7b2c\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u4f60\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u4efb\u52a1\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200bForkJoin\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> </ul> </li> <li>\u200b\u5907\u6ce8\u200b\uff1a\u200b\u53ef\u80fd\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5904\u7406\u200b\u592a\u5feb\u200b\uff0c\u200b\u7cfb\u7edf\u4f18\u5316\u200b\u5207\u6362\u200b\u539f\u5219\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200bmain\u200b\u7ebf\u7a0b\u200b\u5904\u7406\u200b\uff0cthenAccept\u200b\u548c\u200bthenAcceptAsync\uff0cthenApply\u200b\u548c\u200bthenApplyAsync\u200b\u7b49\u200b\uff0c\u200b\u4e4b\u95f4\u200b\u7684\u200b\u533a\u522b\u200b\u540c\u7406\u200b\u3002</li> </ul> </li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#44","title":"4.4 \u200b\u5bf9\u200b\u8ba1\u7b97\u901f\u5ea6\u200b\u8fdb\u884c\u200b\u9009\u7528","text":"<ul> <li>\u200b\u8c01\u200b\u5feb\u200b\u7528\u200b\u8c01\u200b</li> <li>applyToEither</li> </ul> Java<pre><code>@Slf4j(topic = \"c.CompletableFutureApiDemo\")\npublic class CompletableFutureApiDemo {\n    public static void main(String[] args) {\n        ExecutorService threadPool = Executors.newFixedThreadPool(3);\n        CompletableFuture&lt;String&gt; playA = CompletableFuture.supplyAsync(() -&gt; {\n            try {\n                log.debug(\"A come in\");\n                TimeUnit.SECONDS.sleep(2);\n                log.debug(\"A complete\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            return \"playerA\";\n        }, threadPool);\n\n\n        CompletableFuture&lt;String&gt; playB = CompletableFuture.supplyAsync(() -&gt; {\n            try {\n                log.debug(\"B come in\");\n                TimeUnit.SECONDS.sleep(3);\n                log.debug(\"B complete\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            return \"playerB\";\n        }, threadPool);\n\n        CompletableFuture&lt;String&gt; result = playA.applyToEither(playB, f -&gt; f + \" is winner\");\n\n        log.debug(\"result: {}\", result.join());\n        threadPool.shutdown();\n\n        /*\n          13:36:40.505 c.CompletableFutureApiDemo [pool-1-thread-1] - A come in\n          13:36:40.505 c.CompletableFutureApiDemo [pool-1-thread-2] - B come in\n          13:36:42.511 c.CompletableFutureApiDemo [pool-1-thread-1] - A complete\n          13:36:42.512 c.CompletableFutureApiDemo [main] - result: playerA is winner\n          13:36:43.507 c.CompletableFutureApiDemo [pool-1-thread-2] - B complete\n         */\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/#45","title":"4.5 \u200b\u5bf9\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u8fdb\u884c\u200b\u5408\u5e76","text":"<ul> <li>\u200b\u4e24\u4e2a\u200bCompletableStage\u200b\u4efb\u52a1\u200b\u90fd\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u6700\u7ec8\u200b\u80fd\u200b\u628a\u200b\u4e24\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e00\u8d77\u200b\u4ea4\u7ed9\u200bthenCombine\u200b\u6765\u200b\u5904\u7406\u200b</li> <li>\u200b\u5148\u200b\u5b8c\u6210\u200b\u7684\u200b\u5148\u200b\u7b49\u200b\u7740\u200b\uff0c\u200b\u7b49\u5f85\u200b\u5176\u4ed6\u200b\u5206\u652f\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>@Slf4j(topic = \"c.CompletableFutureApi3Demo\")\npublic class CompletableFutureApi3Demo {\n    public static void main(String[] args) {\n        CompletableFuture&lt;Integer&gt; completableFuture1 = CompletableFuture.supplyAsync(() -&gt; {\n            log.debug(\"\u200b\u542f\u52a8\u200b\");\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            return 10;\n        });\n\n        CompletableFuture&lt;Integer&gt; completableFuture2 = CompletableFuture.supplyAsync(() -&gt; {\n            log.debug(\"\u200b\u542f\u52a8\u200b\");\n            try {\n                TimeUnit.SECONDS.sleep(2);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            return 20;\n        });\n\n        CompletableFuture&lt;Integer&gt; finalResult = completableFuture1.thenCombine(completableFuture2, (x, y) -&gt; {\n            log.debug(\"\u200b\u5f00\u59cb\u200b\u5408\u5e76\u200b\u7ed3\u679c\u200b\");\n            return x + y;\n        });\n\n        log.debug(\"{}\", finalResult.join());\n\n        /*\n          13:40:48.019 c.CompletableFutureApi3Demo [ForkJoinPool.commonPool-worker-1] - \u200b\u542f\u52a8\u200b\n          13:40:48.019 c.CompletableFutureApi3Demo [ForkJoinPool.commonPool-worker-2] - \u200b\u542f\u52a8\u200b\n          13:40:50.024 c.CompletableFutureApi3Demo [ForkJoinPool.commonPool-worker-2] - \u200b\u5f00\u59cb\u200b\u5408\u5e76\u200b\u7ed3\u679c\u200b\n          13:40:50.025 c.CompletableFutureApi3Demo [main] - 30\n         */\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/","title":"JUC","text":"<p> \u200b\u7ea6\u200b 52072 \u200b\u4e2a\u200b\u5b57\u200b  8057 \u200b\u884c\u200b\u4ee3\u7801\u200b  101 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 274 \u200b\u5206\u949f\u200b</p> <p>Tip</p> <p>\u200b\u539f\u6587\u200b\u4ed3\u5e93\u200b\u5730\u5740\u200b: JavaNote</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_1","title":"\u8fdb\u7a0b","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_2","title":"\u6982\u8ff0","text":"<p>\u200b\u8fdb\u7a0b\u200b\uff1a\u200b\u7a0b\u5e8f\u200b\u662f\u200b\u9759\u6b62\u200b\u7684\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u5b9e\u4f53\u200b\u7684\u200b\u8fd0\u884c\u200b\u8fc7\u7a0b\u200b\u5c31\u662f\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u662f\u200b\u7cfb\u7edf\u200b\u8fdb\u884c\u200b\u8d44\u6e90\u5206\u914d\u200b\u7684\u200b\u57fa\u672c\u200b\u5355\u4f4d\u200b</p> <p>\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7279\u5f81\u200b\uff1a\u200b\u5e76\u53d1\u200b\u6027\u200b\u3001\u200b\u5f02\u6b65\u200b\u6027\u200b\u3001\u200b\u52a8\u6001\u6027\u200b\u3001\u200b\u72ec\u7acb\u6027\u200b\u3001\u200b\u7ed3\u6784\u6027\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u5c5e\u4e8e\u200b\u8fdb\u7a0b\u200b\u7684\u200b\uff0c\u200b\u662f\u200b\u4e00\u4e2a\u200b\u57fa\u672c\u200b\u7684\u200b CPU \u200b\u6267\u884c\u200b\u5355\u5143\u200b\uff0c\u200b\u662f\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u6d41\u200b\u7684\u200b\u6700\u5c0f\u200b\u5355\u5143\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u8fdb\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b9e\u4f53\u200b\uff0c\u200b\u662f\u200b\u7cfb\u7edf\u200b\u72ec\u7acb\u200b\u8c03\u5ea6\u200b\u7684\u200b\u57fa\u672c\u200b\u5355\u4f4d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u672c\u8eab\u200b\u4e0d\u200b\u62e5\u6709\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff0c\u200b\u53ea\u200b\u62e5\u6709\u200b\u4e00\u70b9\u200b\u5728\u200b\u8fd0\u884c\u200b\u4e2d\u200b\u5fc5\u4e0d\u53ef\u5c11\u200b\u7684\u200b\u8d44\u6e90\u200b\uff0c\u200b\u4e0e\u200b\u540c\u5c5e\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5171\u4eab\u200b\u8fdb\u7a0b\u200b\u6240\u200b\u62e5\u6709\u200b\u7684\u200b\u5168\u90e8\u200b\u8d44\u6e90\u200b</p> <p>\u200b\u5173\u7cfb\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u5305\u542b\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u591a\u7ebf\u7a0b\u200b\uff0c\u200b\u6bd4\u5982\u200b\u770b\u200b\u89c6\u9891\u200b\u662f\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u56fe\u753b\u200b\u3001\u200b\u58f0\u97f3\u200b\u3001\u200b\u5e7f\u544a\u200b\u7b49\u200b\u5c31\u662f\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4f5c\u7528\u200b\uff1a\u200b\u4f7f\u200b\u591a\u9053\u7a0b\u5e8f\u200b\u66f4\u597d\u200b\u7684\u200b\u5e76\u53d1\u200b\u6267\u884c\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u8d44\u6e90\u200b\u5229\u7528\u7387\u200b\u548c\u200b\u7cfb\u7edf\u200b\u541e\u5410\u91cf\u200b\uff0c\u200b\u589e\u5f3a\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u5e76\u53d1\u200b\u6027\u80fd\u200b</p> <p>\u200b\u5e76\u53d1\u200b\u5e76\u884c\u200b\uff1a</p> <ul> <li>\u200b\u5e76\u884c\u200b\uff1a\u200b\u5728\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\uff0c\u200b\u6709\u200b\u591a\u4e2a\u200b\u6307\u4ee4\u200b\u5728\u200b\u591a\u4e2a\u200b CPU \u200b\u4e0a\u200b\u540c\u65f6\u200b\u6267\u884c\u200b</li> <li>\u200b\u5e76\u53d1\u200b\uff1a\u200b\u5728\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\uff0c\u200b\u6709\u200b\u591a\u4e2a\u200b\u6307\u4ee4\u200b\u5728\u200b\u5355\u4e2a\u200b CPU \u200b\u4e0a\u200b\u4ea4\u66ff\u200b\u6267\u884c\u200b</li> </ul> <p>\u200b\u540c\u6b65\u200b\u5f02\u6b65\u200b\uff1a</p> <ul> <li>\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b\u7ed3\u679c\u200b\u8fd4\u56de\u200b\uff0c\u200b\u624d\u80fd\u200b\u7ee7\u7eed\u200b\u8fd0\u884c\u200b\u5c31\u662f\u200b\u540c\u6b65\u200b</li> <li>\u200b\u4e0d\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b\u7ed3\u679c\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5c31\u200b\u80fd\u200b\u7ee7\u7eed\u200b\u8fd0\u884c\u200b\u5c31\u662f\u200b\u5f02\u6b65\u200b</li> </ul> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1a\u200b\u9ed1\u9a6c\u200b juc</p> <p>\u200b\u7b14\u8bb0\u200b\u7684\u200b\u6574\u4f53\u200b\u7ed3\u6784\u200b\u4f9d\u636e\u200b\u89c6\u9891\u200b\u7f16\u5199\u200b\uff0c\u200b\u5e76\u200b\u968f\u7740\u200b\u5b66\u4e60\u200b\u7684\u200b\u6df1\u5165\u200b\u8865\u5145\u200b\u4e86\u200b\u5f88\u591a\u200b\u77e5\u8bc6\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_3","title":"\u5bf9\u6bd4","text":"<p>\u200b\u7ebf\u7a0b\u200b\u8fdb\u7a0b\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>\u200b\u8fdb\u7a0b\u200b\u57fa\u672c\u4e0a\u200b\u76f8\u4e92\u200b\u72ec\u7acb\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u7ebf\u7a0b\u200b\u5b58\u5728\u200b\u4e8e\u200b\u8fdb\u7a0b\u200b\u5185\u200b\uff0c\u200b\u662f\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u96c6\u200b</li> <li>\u200b\u8fdb\u7a0b\u200b\u62e5\u6709\u200b\u5171\u4eab\u200b\u7684\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5982\u200b\u5185\u5b58\u7a7a\u95f4\u200b\u7b49\u200b\uff0c\u200b\u4f9b\u5176\u200b\u5185\u90e8\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5171\u4eab\u200b</li> <li>\u200b\u8fdb\u7a0b\u200b\u95f4\u901a\u4fe1\u200b\u8f83\u4e3a\u200b\u590d\u6742\u200b</li> </ul> <p>\u200b\u540c\u4e00\u200b\u53f0\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u901a\u4fe1\u200b\u79f0\u4e3a\u200b IPC\uff08Inter-process communication\uff09</p> <ul> <li>\u200b\u4fe1\u53f7\u91cf\u200b\uff1a\u200b\u4fe1\u53f7\u91cf\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u7528\u4e8e\u200b\u591a\u200b\u8fdb\u7a0b\u200b\u5bf9\u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u89e3\u51b3\u200b\u540c\u6b65\u200b\u76f8\u5173\u200b\u7684\u200b\u95ee\u9898\u200b\u5e76\u200b\u907f\u514d\u200b\u7ade\u4e89\u200b\u6761\u4ef6\u200b</li> <li>\u200b\u5171\u4eab\u200b\u5b58\u50a8\u200b\uff1a\u200b\u591a\u4e2a\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u540c\u200b\u4e00\u5757\u200b\u5185\u5b58\u7a7a\u95f4\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u4fe1\u53f7\u91cf\u200b\u7528\u6765\u200b\u540c\u6b65\u200b\u5bf9\u200b\u5171\u4eab\u200b\u5b58\u50a8\u200b\u7684\u200b\u8bbf\u95ee\u200b</li> <li>\u200b\u7ba1\u9053\u200b\u901a\u4fe1\u200b\uff1a\u200b\u7ba1\u9053\u200b\u662f\u200b\u7528\u4e8e\u200b\u8fde\u63a5\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u8fdb\u7a0b\u200b\u548c\u200b\u4e00\u4e2a\u200b\u5199\u200b\u8fdb\u7a0b\u200b\u4ee5\u200b\u5b9e\u73b0\u200b\u5b83\u4eec\u200b\u4e4b\u95f4\u200b\u901a\u4fe1\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u6587\u4ef6\u200b pipe \u200b\u6587\u4ef6\u200b\uff0c\u200b\u8be5\u200b\u6587\u4ef6\u200b\u540c\u4e00\u65f6\u95f4\u200b\u53ea\u200b\u5141\u8bb8\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u200b\u652f\u6301\u200b\u534a\u53cc\u5de5\u200b\u901a\u4fe1\u200b<ul> <li>\u200b\u533f\u540d\u200b\u7ba1\u9053\u200b\uff08Pipes\uff09\uff1a\u200b\u7528\u4e8e\u200b\u5177\u6709\u200b\u4eb2\u7f18\u200b\u5173\u7cfb\u200b\u7684\u200b\u7236\u5b50\u200b\u8fdb\u7a0b\u200b\u95f4\u200b\u6216\u8005\u200b\u5144\u5f1f\u200b\u8fdb\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b</li> <li>\u200b\u547d\u540d\u200b\u7ba1\u9053\u200b\uff08Names Pipes\uff09\uff1a\u200b\u4ee5\u200b\u78c1\u76d8\u200b\u6587\u4ef6\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5b58\u5728\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u672c\u200b\u673a\u200b\u4efb\u610f\u200b\u4e24\u4e2a\u200b\u8fdb\u7a0b\u200b\u901a\u4fe1\u200b\uff0c\u200b\u9075\u5faa\u200b FIFO</li> </ul> </li> <li>\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\uff1a\u200b\u5185\u6838\u200b\u4e2d\u200b\u5b58\u50a8\u200b\u6d88\u606f\u200b\u7684\u200b\u94fe\u8868\u200b\uff0c\u200b\u7531\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u6807\u8bc6\u7b26\u200b\u6807\u8bc6\u200b\uff0c\u200b\u80fd\u200b\u5728\u200b\u4e0d\u540c\u200b\u8fdb\u7a0b\u200b\u4e4b\u95f4\u200b\u63d0\u4f9b\u200b\u5168\u53cc\u5de5\u200b\u901a\u4fe1\u200b\uff0c\u200b\u5bf9\u6bd4\u200b\u7ba1\u9053\u200b\uff1a<ul> <li>\u200b\u533f\u540d\u200b\u7ba1\u9053\u200b\u5b58\u5728\u200b\u4e8e\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6587\u4ef6\u200b\uff1b\u200b\u547d\u540d\u200b\u7ba1\u9053\u200b\u5b58\u5728\u200b\u4e8e\u200b\u5b9e\u9645\u200b\u7684\u200b\u78c1\u76d8\u200b\u4ecb\u8d28\u200b\u6216\u8005\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff1b\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u5b58\u653e\u200b\u5728\u200b\u5185\u6838\u200b\u4e2d\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b\u5185\u6838\u200b\u91cd\u542f\u200b\uff08\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u91cd\u542f\u200b\uff09\u200b\u6216\u8005\u200b\u663e\u793a\u200b\u5730\u200b\u5220\u9664\u200b\u4e00\u4e2a\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u65f6\u200b\uff0c\u200b\u8be5\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u624d\u200b\u88ab\u200b\u771f\u6b63\u200b\u5220\u9664\u200b</li> <li>\u200b\u8bfb\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u6d88\u606f\u200b\u7c7b\u578b\u200b\u6709\u200b\u9009\u62e9\u5730\u200b\u63a5\u6536\u200b\u6d88\u606f\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u50cf\u200b FIFO \u200b\u90a3\u6837\u200b\u53ea\u80fd\u200b\u9ed8\u8ba4\u200b\u5730\u200b\u63a5\u6536\u200b</li> </ul> </li> </ul> <p>\u200b\u4e0d\u540c\u200b\u8ba1\u7b97\u673a\u200b\u4e4b\u95f4\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u901a\u4fe1\u200b\uff0c\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\uff0c\u200b\u5e76\u200b\u9075\u5b88\u200b\u5171\u540c\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u4f8b\u5982\u200b HTTP</p> <ul> <li>\u200b\u5957\u200b\u63a5\u5b57\u200b\uff1a\u200b\u4e0e\u200b\u5176\u5b83\u200b\u901a\u4fe1\u200b\u673a\u5236\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u53ef\u200b\u7528\u4e8e\u200b\u4e0d\u540c\u200b\u673a\u5668\u95f4\u200b\u7684\u200b\u4e92\u76f8\u200b\u901a\u4fe1\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u901a\u4fe1\u200b\u76f8\u5bf9\u200b\u7b80\u5355\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u5171\u4eab\u200b\u8fdb\u7a0b\u200b\u5185\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u662f\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u540c\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b</li> </ul> <p>Java \u200b\u4e2d\u200b\u7684\u200b\u901a\u4fe1\u200b\u673a\u5236\u200b\uff1avolatile\u3001\u200b\u7b49\u5f85\u200b/\u200b\u901a\u77e5\u200b\u673a\u5236\u200b\u3001join \u200b\u65b9\u5f0f\u200b\u3001InheritableThreadLocal\u3001MappedByteBuffer</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u66f4\u200b\u8f7b\u91cf\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u6210\u672c\u200b\u4e00\u822c\u200b\u4e0a\u8981\u200b\u6bd4\u200b\u8fdb\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u4f4e\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_4","title":"\u7ebf\u7a0b","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_5","title":"\u521b\u5efa\u200b\u7ebf\u7a0b","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#thread","title":"Thread","text":"<p>Thread \u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u7c7b\u200b\uff0c\u200b\u533f\u540d\u200b\u5185\u90e8\u200b\u7c7b\u200b\u65b9\u5f0f\u200b</p> <ul> <li>start() \u200b\u65b9\u6cd5\u200b\u5e95\u5c42\u200b\u5176\u5b9e\u200b\u662f\u200b\u7ed9\u200b CPU \u200b\u6ce8\u518c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u89e6\u53d1\u200b run() \u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u542f\u52a8\u200b\u5fc5\u987b\u200b\u8c03\u7528\u200b start() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b run() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u53d8\u6210\u200b\u4e86\u200b\u666e\u901a\u200b\u7c7b\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e3b\u7ebf\u200b\u7a0b\u5c06\u200b\u53ea\u6709\u200b\u6267\u884c\u200b\u8be5\u200b\u7ebf\u7a0b\u200b</li> <li>\u200b\u5efa\u8bae\u200b\u7ebf\u7a0b\u200b\u5148\u200b\u521b\u5efa\u200b\u5b50\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u4efb\u52a1\u200b\u653e\u5728\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5426\u5219\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\uff08main\uff09\u200b\u6c38\u8fdc\u200b\u662f\u200b\u5148\u200b\u6267\u884c\u200b\u5b8c\u200b</li> </ul> <p>Thread \u200b\u6784\u9020\u200b\u5668\u200b\uff1a</p> <ul> <li><code>public Thread()</code></li> <li><code>public Thread(String name)</code></li> </ul> Java<pre><code>public class ThreadDemo {\n    public static void main(String[] args) {\n        Thread t = new MyThread();\n        t.start();\n        for(int i = 0 ; i &lt; 100 ; i++ ){\n            System.out.println(\"main\u200b\u7ebf\u7a0b\u200b\" + i)\n        }\n        // main\u200b\u7ebf\u7a0b\u200b\u8f93\u51fa\u200b\u653e\u5728\u200b\u4e0a\u9762\u200b \u200b\u5c31\u200b\u53d8\u6210\u200b\u6709\u200b\u5148\u540e\u987a\u5e8f\u200b\u4e86\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u662f\u200b main \u200b\u7ebf\u7a0b\u200b\u9a71\u52a8\u200b\u7684\u200b\u5b50\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b\n    }\n}\nclass MyThread extends Thread {\n    @Override\n    public void run() {\n        for(int i = 0 ; i &lt; 100 ; i++ ) {\n            System.out.println(\"\u200b\u5b50\u200b\u7ebf\u7a0b\u200b\u8f93\u51fa\u200b\uff1a\"+i)\n        }\n    }\n}\n</code></pre> <p>\u200b\u7ee7\u627f\u200b Thread \u200b\u7c7b\u200b\u7684\u200b\u4f18\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u4f18\u70b9\u200b\uff1a\u200b\u7f16\u7801\u200b\u7b80\u5355\u200b</li> <li>\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u7c7b\u200b\u5df2\u7ecf\u200b\u7ee7\u627f\u200b\u4e86\u200b Thread \u200b\u7c7b\u200b\u65e0\u6cd5\u200b\u7ee7\u627f\u200b\u5176\u4ed6\u200b\u7c7b\u200b\u4e86\u200b\uff0c\u200b\u529f\u80fd\u200b\u4e0d\u80fd\u200b\u901a\u8fc7\u200b\u7ee7\u627f\u200b\u62d3\u5c55\u200b\uff08\u200b\u5355\u200b\u7ee7\u627f\u200b\u7684\u200b\u5c40\u9650\u6027\u200b\uff09</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#runnable","title":"Runnable","text":"<p>Runnable \u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u7c7b\u200b\uff0c\u200b\u533f\u540d\u200b\u5185\u90e8\u200b\u7c7b\u200b\u65b9\u5f0f\u200b</p> <p>Thread \u200b\u7684\u200b\u6784\u9020\u200b\u5668\u200b\uff1a</p> <ul> <li><code>public Thread(Runnable target)</code></li> <li><code>public Thread(Runnable target, String name)</code></li> </ul> Java<pre><code>public class ThreadDemo {\n    public static void main(String[] args) {\n        Runnable target = new MyRunnable();\n        Thread t1 = new Thread(target,\"1\u200b\u53f7\u200b\u7ebf\u7a0b\u200b\");\n        t1.start();\n        Thread t2 = new Thread(target);//Thread-0\n    }\n}\n\npublic class MyRunnable implements Runnable{\n    @Override\n    public void run() {\n        for(int i = 0 ; i &lt; 10 ; i++ ){\n            System.out.println(Thread.currentThread().getName() + \"-&gt;\" + i);\n        }\n    }\n}\n</code></pre> <p>Thread \u200b\u7c7b\u200b\u672c\u8eab\u200b\u4e5f\u200b\u662f\u200b\u5b9e\u73b0\u200b\u4e86\u200b Runnable \u200b\u63a5\u53e3\u200b\uff0cThread \u200b\u7c7b\u4e2d\u200b\u6301\u6709\u200b Runnable \u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u6267\u884c\u200b\u7ebf\u7a0b\u200b run \u200b\u65b9\u6cd5\u200b\u5e95\u5c42\u200b\u662f\u200b\u8c03\u7528\u200b Runnable#run\uff1a</p> Java<pre><code>public class Thread implements Runnable {\n    private Runnable target;\n\n    public void run() {\n        if (target != null) {\n            // \u200b\u5e95\u5c42\u200b\u8c03\u7528\u200b\u7684\u200b\u662f\u200b Runnable \u200b\u7684\u200b run \u200b\u65b9\u6cd5\u200b\n            target.run();\n        }\n    }\n}\n</code></pre> <p>Runnable \u200b\u65b9\u5f0f\u200b\u7684\u200b\u4f18\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u4ee3\u7801\u200b\u590d\u6742\u200b\u4e00\u70b9\u200b\u3002</li> <li> <p>\u200b\u4f18\u70b9\u200b\uff1a</p> </li> <li> <p>\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u7c7b\u200b\u53ea\u662f\u200b\u5b9e\u73b0\u200b\u4e86\u200b Runnable \u200b\u63a5\u53e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u7ee7\u627f\u200b\u5176\u4ed6\u200b\u7c7b\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u5355\u200b\u7ee7\u627f\u200b\u7684\u200b\u5c40\u9650\u6027\u200b</p> </li> <li>\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5305\u88c5\u200b\u6210\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u9002\u5408\u200b\u591a\u4e2a\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u5171\u4eab\u200b\u540c\u4e00\u4e2a\u200b\u8d44\u6e90\u200b</li> <li>\u200b\u5b9e\u73b0\u200b\u89e3\u200b\u8026\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u4ee3\u7801\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u5171\u4eab\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u4ee3\u7801\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u72ec\u7acb\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53ef\u4ee5\u200b\u653e\u5165\u200b\u5b9e\u73b0\u200b Runnable \u200b\u6216\u200b Callable \u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#callable","title":"Callable","text":"<p>\u200b\u5b9e\u73b0\u200b Callable \u200b\u63a5\u53e3\u200b\uff1a</p> <ol> <li>\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u7c7b\u200b\u5b9e\u73b0\u200b Callable \u200b\u63a5\u53e3\u200b\uff0c\u200b\u7533\u660e\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b\u7c7b\u578b\u200b</li> <li>\u200b\u91cd\u5199\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u7c7b\u200b\u7684\u200b call \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b Callable \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u628a\u200b Callable \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\u5305\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u628a\u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\u5305\u88c5\u200b\u6210\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u8c03\u7528\u200b\u7ebf\u7a0b\u200b\u7684\u200b start() \u200b\u65b9\u6cd5\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b</li> </ol> <p><code>public FutureTask(Callable&lt;V&gt; callable)</code>\uff1a\u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u5f97\u5230\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b</p> <ul> <li>FutureTask \u200b\u5c31\u662f\u200b Runnable \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u56e0\u4e3a\u200b Thread \u200b\u7c7b\u200b\u53ea\u80fd\u200b\u6267\u884c\u200b Runnable \u200b\u5b9e\u4f8b\u200b\u7684\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6240\u4ee5\u200b\u628a\u200b Callable \u200b\u5305\u88c5\u200b\u6210\u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u90e8\u5206\u200b\u8be6\u89e3\u200b\u4e86\u200b FutureTask \u200b\u7684\u200b\u6e90\u7801\u200b</li> </ul> <p><code>public V get()</code>\uff1a\u200b\u540c\u6b65\u200b\u7b49\u5f85\u200b task \u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u7ebf\u200b\u7a0b\u4e2d\u200b\u83b7\u53d6\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4f1a\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b</p> <ul> <li>get() \u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b</li> <li>run() \u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u4f1a\u200b\u628a\u200b\u7ed3\u679c\u200b\u8bbe\u7f6e\u200b\u5230\u200b FutureTask \u200b\u7684\u200b\u4e00\u4e2a\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff0cget() \u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u8be5\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b</li> </ul> <p>\u200b\u4f18\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u4f18\u70b9\u200b\uff1a\u200b\u540c\u200b Runnable\uff0c\u200b\u5e76\u4e14\u200b\u80fd\u200b\u5f97\u5230\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u7f16\u7801\u200b\u590d\u6742\u200b</li> </ul> Java<pre><code>public class ThreadDemo {\n    public static void main(String[] args) {\n        Callable call = new MyCallable();\n        FutureTask&lt;String&gt; task = new FutureTask&lt;&gt;(call);\n        Thread t = new Thread(task);\n        t.start();\n        try {\n            String s = task.get(); // \u200b\u83b7\u53d6\u200bcall\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u7684\u200b\u7ed3\u679c\u200b\uff08\u200b\u6b63\u5e38\u200b/\u200b\u5f02\u5e38\u200b\u7ed3\u679c\u200b\uff09\n            System.out.println(s);\n        }  catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\npublic class MyCallable implements Callable&lt;String&gt; {\n    @Override//\u200b\u91cd\u5199\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u7c7b\u200b\u65b9\u6cd5\u200b\n    public String call() throws Exception {\n        return Thread.currentThread().getName() + \"-&gt;\" + \"Hello World\";\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_6","title":"\u7ebf\u7a0b\u200b\u65b9\u6cd5","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#api","title":"API","text":"<p>Thread \u200b\u7c7b\u200b API\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public void start() \u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\uff0cJava\u200b\u865a\u62df\u673a\u200b\u8c03\u7528\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u7684\u200b run \u200b\u65b9\u6cd5\u200b public void run() \u200b\u7ebf\u7a0b\u200b\u542f\u52a8\u200b\u540e\u200b\u8c03\u7528\u200b\u8be5\u200b\u65b9\u6cd5\u200b public void setName(String name) \u200b\u7ed9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53d6\u540d\u5b57\u200b public void getName() \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u540d\u5b57\u200b\u7ebf\u7a0b\u200b\u5b58\u5728\u200b\u9ed8\u8ba4\u200b\u540d\u79f0\u200b\uff1a\u200b\u5b50\u200b\u7ebf\u7a0b\u200b\u662f\u200b Thread-\u200b\u7d22\u5f15\u200b\uff0c\u200b\u4e3b\u7ebf\u200b\u7a0b\u662f\u200b main public static Thread currentThread() \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4ee3\u7801\u200b\u5728\u200b\u54ea\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e2d\u200b\u6267\u884c\u200b public static void sleep(long time) \u200b\u8ba9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4f11\u7720\u200b\u591a\u5c11\u200b\u6beb\u79d2\u200b\u518d\u200b\u7ee7\u7eed\u6267\u884c\u200bThread.sleep(0) : \u200b\u8ba9\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7acb\u523b\u200b\u91cd\u65b0\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b CPU \u200b\u7ade\u4e89\u200b public static native void yield() \u200b\u63d0\u793a\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\u5668\u200b\u8ba9\u51fa\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b CPU \u200b\u7684\u200b\u4f7f\u7528\u200b public final int getPriority() \u200b\u8fd4\u56de\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b public final void setPriority(int priority) \u200b\u66f4\u6539\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u5e38\u7528\u200b 1 5 10 public void interrupt() \u200b\u4e2d\u65ad\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u673a\u5236\u200b public static boolean interrupted() \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b public boolean isInterrupted() \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u4e0d\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b public final void join() \u200b\u7b49\u5f85\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u7ed3\u675f\u200b public final void join(long millis) \u200b\u7b49\u5f85\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u6b7b\u4ea1\u200b millis \u200b\u6beb\u79d2\u200b\uff0c0 \u200b\u610f\u5473\u7740\u200b\u6c38\u8fdc\u200b\u7b49\u5f85\u200b public final native boolean isAlive() \u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u5b58\u6d3b\u200b\uff08\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8fd0\u884c\u200b\u5b8c\u6bd5\u200b\uff09 public final void setDaemon(boolean on) \u200b\u5c06\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\u6216\u200b\u7528\u6237\u200b\u7ebf\u7a0b","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#run-start","title":"run start","text":"<p>run\uff1a\u200b\u79f0\u4e3a\u200b\u7ebf\u7a0b\u200b\u4f53\u200b\uff0c\u200b\u5305\u542b\u200b\u4e86\u200b\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u8fd0\u884c\u200b\u7ed3\u675f\u200b\uff0c\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u968f\u5373\u200b\u7ec8\u6b62\u200b\u3002\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b run \u200b\u662f\u200b\u5728\u200b\u4e3b\u7ebf\u200b\u7a0b\u4e2d\u200b\u6267\u884c\u200b\u4e86\u200b run\uff0c\u200b\u6ca1\u6709\u200b\u542f\u52a8\u200b\u65b0\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u9700\u8981\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b</p> <p>start\uff1a\u200b\u4f7f\u7528\u200b start \u200b\u662f\u200b\u542f\u52a8\u200b\u65b0\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u5904\u4e8e\u200b\u5c31\u7eea\u200b\uff08\u200b\u53ef\u200b\u8fd0\u884c\u200b\uff09\u200b\u72b6\u6001\u200b\uff0c\u200b\u901a\u8fc7\u200b\u65b0\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u95f4\u63a5\u200b\u6267\u884c\u200b run \u200b\u4e2d\u200b\u7684\u200b\u4ee3\u7801\u200b</p> <p>\u200b\u8bf4\u660e\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u63a7\u5236\u200b\u8d44\u6e90\u200b\u7c7b\u200b</p> <p>run() \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200b\u5f02\u5e38\u200b\u4e0d\u80fd\u200b\u629b\u51fa\u200b\uff0c\u200b\u53ea\u80fd\u200b try/catch</p> <ul> <li>\u200b\u56e0\u4e3a\u200b\u7236\u7c7b\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u629b\u51fa\u200b\u4efb\u4f55\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5b50\u7c7b\u200b\u4e0d\u80fd\u200b\u6bd4\u7236\u200b\u7c7b\u200b\u629b\u51fa\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5f02\u5e38\u200b</li> <li>\u200b\u5f02\u5e38\u200b\u4e0d\u80fd\u200b\u8de8\u200b\u7ebf\u7a0b\u200b\u4f20\u64ad\u200b\u56de\u200b main() \u200b\u4e2d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5fc5\u987b\u200b\u5728\u200b\u672c\u5730\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#sleep-yield","title":"sleep yield","text":"<p>sleep\uff1a</p> <ul> <li>\u200b\u8c03\u7528\u200b sleep \u200b\u4f1a\u200b\u8ba9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4ece\u200b <code>Running</code> \u200b\u8fdb\u5165\u200b <code>Timed Waiting</code> \u200b\u72b6\u6001\u200b\uff08\u200b\u963b\u585e\u200b\uff09</li> <li>sleep() \u200b\u65b9\u6cd5\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u91ca\u653e\u200b\u5bf9\u8c61\u200b\u9501\u200b</li> <li>\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b interrupt \u200b\u65b9\u6cd5\u200b\u6253\u65ad\u200b\u6b63\u5728\u200b\u7761\u7720\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8fd9\u65f6\u200b sleep \u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u629b\u51fa\u200b InterruptedException</li> <li>\u200b\u7761\u7720\u200b\u7ed3\u675f\u200b\u540e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u672a\u5fc5\u200b\u4f1a\u200b\u7acb\u523b\u200b\u5f97\u5230\u200b\u6267\u884c\u200b\uff0c\u200b\u9700\u8981\u200b\u62a2\u5360\u200b CPU</li> <li>\u200b\u5efa\u8bae\u200b\u7528\u200b TimeUnit \u200b\u7684\u200b sleep \u200b\u4ee3\u66ff\u200b Thread \u200b\u7684\u200b sleep \u200b\u6765\u200b\u83b7\u5f97\u200b\u66f4\u597d\u200b\u7684\u200b\u53ef\u8bfb\u6027\u200b</li> </ul> <p>yield\uff1a</p> <ul> <li>\u200b\u8c03\u7528\u200b yield \u200b\u4f1a\u200b\u8ba9\u200b\u63d0\u793a\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\u5668\u200b\u8ba9\u51fa\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b CPU \u200b\u7684\u200b\u4f7f\u7528\u200b</li> <li>\u200b\u5177\u4f53\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4f9d\u8d56\u4e8e\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u4efb\u52a1\u8c03\u5ea6\u200b\u5668\u200b</li> <li>\u200b\u4f1a\u200b\u653e\u5f03\u200b CPU \u200b\u8d44\u6e90\u200b\uff0c\u200b\u9501\u200b\u8d44\u6e90\u200b\u4e0d\u4f1a\u200b\u91ca\u653e\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#join","title":"join","text":"<p>public final void join()\uff1a\u200b\u7b49\u5f85\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u7ed3\u675f\u200b</p> <p>\u200b\u539f\u7406\u200b\uff1a\u200b\u8c03\u7528\u8005\u200b\u8f6e\u8be2\u200b\u68c0\u67e5\u200b\u7ebf\u7a0b\u200b alive \u200b\u72b6\u6001\u200b\uff0ct1.join() \u200b\u7b49\u4ef7\u200b\u4e8e\u200b\uff1a</p> Java<pre><code>public final synchronized void join(long millis) throws InterruptedException {\n    // \u200b\u8c03\u7528\u8005\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b thread \u200b\u7684\u200b waitSet \u200b\u7b49\u5f85\u200b, \u200b\u76f4\u5230\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b\u7ed3\u675f\u200b\n    while (isAlive()) {\n        wait(0);\n    }\n}\n</code></pre> <ul> <li>join \u200b\u65b9\u6cd5\u200b\u662f\u200b\u88ab\u200b synchronized \u200b\u4fee\u9970\u200b\u7684\u200b\uff0c\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff0c\u200b\u5176\u200b\u5185\u90e8\u200b\u7684\u200b wait \u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u4e5f\u200b\u662f\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u91ca\u653e\u200b\u7684\u200b\u662f\u200b\u5f53\u524d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5916\u9762\u200b\u7684\u200b\u9501\u200b</li> <li>\u200b\u5f53\u200b\u8c03\u7528\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\uff08t1\uff09\u200b\u7684\u200b join \u200b\u65b9\u6cd5\u200b\u540e\u200b\uff0c\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\uff08t1\uff09\u200b\u62a2\u5360\u200b\u5230\u200b CPU \u200b\u8d44\u6e90\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u518d\u200b\u91ca\u653e\u200b\uff0c\u200b\u76f4\u5230\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b</li> </ul> <p>\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\uff1a</p> <ul> <li>join \u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4f1a\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ed3\u675f\u200b\uff0c\u200b\u624d\u80fd\u200b\u7ee7\u7eed\u200b\u5411\u4e0b\u200b\u8fd0\u884c\u200b</li> <li>\u200b\u9700\u8981\u200b\u5916\u90e8\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\uff0c\u200b\u4e0d\u200b\u7b26\u5408\u200b\u9762\u5411\u5bf9\u8c61\u200b\u5c01\u88c5\u200b\u7684\u200b\u601d\u60f3\u200b</li> <li>\u200b\u5fc5\u987b\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\u7ed3\u675f\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u914d\u5408\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4f7f\u7528\u200b</li> <li>Future \u200b\u5b9e\u73b0\u200b\uff08\u200b\u540c\u6b65\u200b\uff09\uff1aget() \u200b\u65b9\u6cd5\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b</li> <li>main \u200b\u7ebf\u7a0b\u200b\u63a5\u6536\u200b\u7ed3\u679c\u200b</li> <li>get \u200b\u65b9\u6cd5\u200b\u662f\u200b\u8ba9\u200b\u8c03\u7528\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\u7b49\u5f85\u200b</li> </ul> Java<pre><code>public class Test {\n    static int r = 0;\n    public static void main(String[] args) throws InterruptedException {\n        test1();\n    }\n    private static void test1() throws InterruptedException {\n        Thread t1 = new Thread(() -&gt; {\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            r = 10;\n        });\n        t1.start();\n        t1.join();//\u200b\u4e0d\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8f93\u51fa\u200b\u7684\u200b10\n        System.out.println(r);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#interrupt","title":"interrupt","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_7","title":"\u6253\u65ad\u200b\u7ebf\u7a0b","text":"<p><code>public void interrupt()</code>\uff1a\u200b\u6253\u65ad\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u673a\u5236\u200b</p> <p><code>public static boolean interrupted()</code>\uff1a\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u6253\u65ad\u200b\u8fd4\u56de\u200b true\uff0c\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8fde\u7eed\u200b\u8c03\u7528\u200b\u4e24\u6b21\u200b\u4e00\u5b9a\u200b\u8fd4\u56de\u200b false</p> <p><code>public boolean isInterrupted()</code>\uff1a\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u4e0d\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b</p> <p>\u200b\u6253\u65ad\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u53d1\u751f\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u7ebf\u7a0b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u62a2\u5360\u200b\u5230\u200b CPU \u200b\u540e\u4f1a\u200b\u4ece\u200b\u4e2d\u65ad\u200b\u7684\u200b\u5730\u65b9\u200b\u63a5\u7740\u200b\u8fd0\u884c\u200b\uff08\u200b\u6253\u65ad\u200b\u4e0d\u662f\u200b\u505c\u6b62\u200b\uff09</p> <ul> <li>sleep\u3001wait\u3001join \u200b\u65b9\u6cd5\u200b\u90fd\u200b\u4f1a\u200b\u8ba9\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b\u963b\u585e\u72b6\u6001\u200b\uff0c\u200b\u6253\u65ad\u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8868\u793a\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f1a\u200b\u6e05\u7a7a\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\uff08false\uff09</li> </ul> Java<pre><code>public static void main(String[] args) throws InterruptedException {\n    Thread t1 = new Thread(()-&gt;{\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }, \"t1\");\n    t1.start();\n    Thread.sleep(500);\n    t1.interrupt();\n    System.out.println(\" \u200b\u6253\u65ad\u200b\u72b6\u6001\u200b: {}\" + t1.isInterrupted());// \u200b\u6253\u65ad\u200b\u72b6\u6001\u200b: {}false\n}\n</code></pre> <ul> <li>\u200b\u6253\u65ad\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff1a\u200b\u4e0d\u4f1a\u200b\u6e05\u7a7a\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\uff08true\uff09</li> </ul> Java<pre><code>public static void main(String[] args) throws Exception {\n    Thread t2 = new Thread(()-&gt;{\n        while(true) {\n            Thread current = Thread.currentThread();\n            boolean interrupted = current.isInterrupted();\n            if(interrupted) {\n                System.out.println(\" \u200b\u6253\u65ad\u200b\u72b6\u6001\u200b: {}\" + interrupted);//\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b: {}true\n                break;\n            }\n        }\n    }, \"t2\");\n    t2.start();\n    Thread.sleep(500);\n    t2.interrupt();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#park","title":"\u6253\u65ad\u200b park","text":"<p>park \u200b\u4f5c\u7528\u200b\u7c7b\u4f3c\u200b sleep\uff0c\u200b\u6253\u65ad\u200b park \u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6e05\u7a7a\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\uff08true\uff09</p> Java<pre><code>public static void main(String[] args) throws Exception {\n    Thread t1 = new Thread(() -&gt; {\n        System.out.println(\"park...\");\n        LockSupport.park();\n        System.out.println(\"unpark...\");\n        System.out.println(\"\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\uff1a\" + Thread.currentThread().isInterrupted());//\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\uff1atrue\n    }, \"t1\");\n    t1.start();\n    Thread.sleep(2000);\n    t1.interrupt();\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\u5df2\u7ecf\u200b\u662f\u200b true, \u200b\u5219\u200b park \u200b\u4f1a\u200b\u5931\u6548\u200b</p> Java<pre><code>LockSupport.park();\nSystem.out.println(\"unpark...\");\nLockSupport.park();//\u200b\u5931\u6548\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b\nSystem.out.println(\"unpark...\");//\u200b\u548c\u200b\u4e0a\u200b\u4e00\u4e2a\u200bunpark\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u83b7\u53d6\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>Thread.interrupted()</code>\uff0c\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b</p> <p>LockSupport \u200b\u7c7b\u200b\u5728\u200b \u200b\u540c\u6b65\u200b \u2192 park-un \u200b\u8be6\u89e3\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_8","title":"\u7ec8\u6b62\u200b\u6a21\u5f0f","text":"<p>\u200b\u7ec8\u6b62\u200b\u6a21\u5f0f\u200b\u4e4b\u200b\u4e24\u200b\u9636\u6bb5\u200b\u7ec8\u6b62\u200b\u6a21\u5f0f\u200b\uff1aTwo Phase Termination</p> <p>\u200b\u76ee\u6807\u200b\uff1a\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b T1 \u200b\u4e2d\u200b\u5982\u4f55\u200b\u4f18\u96c5\u200b\u7ec8\u6b62\u200b\u7ebf\u7a0b\u200b T2\uff1f\u200b\u4f18\u96c5\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u7ed9\u200b T2 \u200b\u4e00\u4e2a\u200b\u540e\u7f6e\u200b\u5904\u7406\u5668\u200b</p> <p>\u200b\u9519\u8bef\u601d\u60f3\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\u7684\u200b stop() \u200b\u65b9\u6cd5\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\uff1astop \u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u771f\u6b63\u200b\u6740\u6b7b\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u65f6\u200b\u7ebf\u7a0b\u200b\u9501\u4f4f\u200b\u4e86\u200b\u5171\u4eab\u8d44\u6e90\u200b\uff0c\u200b\u5f53\u200b\u5b83\u200b\u88ab\u200b\u6740\u6b7b\u200b\u540e\u200b\u5c31\u200b\u518d\u4e5f\u200b\u6ca1\u6709\u200b\u673a\u4f1a\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u6c38\u8fdc\u200b\u65e0\u6cd5\u200b\u83b7\u53d6\u200b\u9501\u200b</li> <li>\u200b\u4f7f\u7528\u200b System.exit(int) \u200b\u65b9\u6cd5\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\uff1a\u200b\u76ee\u7684\u200b\u4ec5\u200b\u662f\u200b\u505c\u6b62\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u79cd\u200b\u505a\u6cd5\u200b\u4f1a\u200b\u8ba9\u200b\u6574\u4e2a\u200b\u7a0b\u5e8f\u200b\u90fd\u200b\u505c\u6b62\u200b</li> </ul> <p>\u200b\u4e24\u200b\u9636\u6bb5\u200b\u7ec8\u6b62\u200b\u6a21\u5f0f\u200b\u56fe\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u6253\u65ad\u200b\u7ebf\u7a0b\u200b\u53ef\u80fd\u200b\u5728\u200b\u4efb\u4f55\u200b\u65f6\u95f4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5728\u200b\u4efb\u4f55\u65f6\u523b\u200b\u88ab\u200b\u6253\u65ad\u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>public class Test {\n    public static void main(String[] args) throws InterruptedException {\n        TwoPhaseTermination tpt = new TwoPhaseTermination();\n        tpt.start();\n        Thread.sleep(3500);\n        tpt.stop();\n    }\n}\nclass TwoPhaseTermination {\n    private Thread monitor;\n    // \u200b\u542f\u52a8\u200b\u76d1\u63a7\u200b\u7ebf\u7a0b\u200b\n    public void start() {\n        monitor = new Thread(new Runnable() {\n            @Override\n            public void run() {\n                while (true) {\n                    Thread thread = Thread.currentThread();\n                    if (thread.isInterrupted()) {\n                        System.out.println(\"\u200b\u540e\u7f6e\u200b\u5904\u7406\u200b\");\n                        break;\n                    }\n                    try {\n                        Thread.sleep(1000);                 // \u200b\u7761\u7720\u200b\n                        System.out.println(\"\u200b\u6267\u884c\u200b\u76d1\u63a7\u200b\u8bb0\u5f55\u200b\");   // \u200b\u5728\u200b\u6b64\u200b\u88ab\u200b\u6253\u65ad\u200b\u4e0d\u4f1a\u200b\u5f02\u5e38\u200b\n                    } catch (InterruptedException e) {      // \u200b\u5728\u200b\u7761\u7720\u200b\u671f\u95f4\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u8fdb\u5165\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u7684\u200b\u903b\u8f91\u200b\n                        e.printStackTrace();\n                        // \u200b\u91cd\u65b0\u200b\u8bbe\u7f6e\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\uff0c\u200b\u6253\u65ad\u200b sleep \u200b\u4f1a\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\n                        thread.interrupt();\n                    }\n                }\n            }\n        });\n        monitor.start();\n    }\n    // \u200b\u505c\u6b62\u200b\u76d1\u63a7\u200b\u7ebf\u7a0b\u200b\n    public void stop() {\n        monitor.interrupt();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#daemon","title":"daemon","text":"<p><code>public final void setDaemon(boolean on)</code>\uff1a\u200b\u5982\u679c\u200b\u662f\u200b true \uff0c\u200b\u5c06\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b </p> <p>\u200b\u7ebf\u7a0b\u200b\u542f\u52a8\u200b\u524d\u200b\u8c03\u7528\u200b\u6b64\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>Thread t = new Thread() {\n    @Override\n    public void run() {\n        System.out.println(\"running\");\n    }\n};\n// \u200b\u8bbe\u7f6e\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\nt.setDaemon(true);\nt.start();\n</code></pre> <p>\u200b\u7528\u6237\u200b\u7ebf\u7a0b\u200b\uff1a\u200b\u5e73\u5e38\u200b\u521b\u5efa\u200b\u7684\u200b\u666e\u901a\u200b\u7ebf\u7a0b\u200b</p> <p>\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\uff1a\u200b\u670d\u52a1\u200b\u4e8e\u200b\u7528\u6237\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u53ea\u8981\u200b\u5176\u5b83\u200b\u975e\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b\u7ed3\u675f\u200b\u4e86\u200b\uff0c\u200b\u5373\u4f7f\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\u4ee3\u7801\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u5b8c\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u5f3a\u5236\u200b\u7ed3\u675f\u200b\u3002\u200b\u5b88\u62a4\u200b\u8fdb\u7a0b\u200b\u662f\u200b\u8131\u79bb\u200b\u4e8e\u200b\u7ec8\u7aef\u200b\u5e76\u4e14\u200b\u5728\u200b\u540e\u53f0\u200b\u8fd0\u884c\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u8131\u79bb\u200b\u7ec8\u7aef\u200b\u662f\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u4fe1\u606f\u200b\u5728\u200b\u7ec8\u7aef\u200b\u4e0a\u200b\u663e\u793a\u200b</p> <p>\u200b\u8bf4\u660e\u200b\uff1a\u200b\u5f53\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u662f\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\uff0cJava \u200b\u865a\u62df\u673a\u200b\u5c06\u200b\u9000\u51fa\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u666e\u901a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\uff0cJVM \u200b\u662f\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7ee7\u7eed\u200b\u8fd0\u884c\u200b\u4e0b\u53bb\u200b</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\uff1a</p> <ul> <li>\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u5668\u200b\u7ebf\u7a0b\u200b\u5c31\u662f\u200b\u4e00\u79cd\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b</li> <li>Tomcat \u200b\u4e2d\u200b\u7684\u200b Acceptor \u200b\u548c\u200b Poller \u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u662f\u200b\u5b88\u62a4\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6240\u4ee5\u200b Tomcat \u200b\u63a5\u6536\u200b\u5230\u200b shutdown \u200b\u547d\u4ee4\u200b\u540e\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7b49\u5f85\u200b\u5b83\u4eec\u200b\u5904\u7406\u200b\u5b8c\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_9","title":"\u4e0d\u200b\u63a8\u8350","text":"<p>\u200b\u4e0d\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u5df2\u200b\u8fc7\u65f6\u200b\uff0c\u200b\u5bb9\u6613\u200b\u7834\u574f\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\uff0c\u200b\u9020\u6210\u200b\u7ebf\u7a0b\u200b\u6b7b\u9501\u200b\uff1a</p> <ul> <li><code>public final void stop()</code>\uff1a\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b</li> </ul> <p>\u200b\u5e9f\u5f03\u200b\u539f\u56e0\u200b\uff1a\u200b\u65b9\u6cd5\u200b\u7c97\u66b4\u200b\uff0c\u200b\u9664\u975e\u200b\u53ef\u80fd\u200b\u6267\u884c\u200b finally \u200b\u4ee3\u7801\u200b\u5757\u200b\u4ee5\u53ca\u200b\u91ca\u653e\u200b synchronized \u200b\u5916\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u76f4\u63a5\u200b\u88ab\u200b\u7ec8\u6b62\u200b\uff0c\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b JUC \u200b\u7684\u200b\u4e92\u65a5\u200b\u9501\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u9501\u200b\u6765\u4e0d\u53ca\u200b\u91ca\u653e\u200b\uff0c\u200b\u9020\u6210\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6c38\u8fdc\u200b\u7b49\u5f85\u200b\u7684\u200b\u5c40\u9762\u200b</p> <ul> <li><code>public final void suspend()</code>\uff1a\u200b\u6302\u200b\u8d77\u200b\uff08\u200b\u6682\u505c\u200b\uff09\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b</li> </ul> <p>\u200b\u5e9f\u5f03\u200b\u539f\u56e0\u200b\uff1a\u200b\u5982\u679c\u200b\u76ee\u6807\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u6682\u505c\u200b\u65f6\u200b\u5bf9\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\u6301\u6709\u200b\u9501\u200b\uff0c\u200b\u5219\u200b\u5728\u200b\u76ee\u6807\u200b\u7ebf\u7a0b\u200b\u6062\u590d\u200b\u4e4b\u524d\u200b\u6ca1\u6709\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u8be5\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5982\u679c\u200b\u6062\u590d\u200b\u76ee\u6807\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u8c03\u7528\u200b resume \u200b\u4e4b\u524d\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u8bbf\u95ee\u200b\u6b64\u200b\u5171\u4eab\u8d44\u6e90\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6b7b\u9501\u200b</p> <ul> <li><code>public final void resume()</code>\uff1a\u200b\u6062\u590d\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_10","title":"\u7ebf\u7a0b\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_11","title":"\u8fd0\u884c\u673a\u5236","text":"<p>Java Virtual Machine Stacks\uff08Java \u200b\u865a\u62df\u673a\u200b\u6808\u200b\uff09\uff1a\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u542f\u52a8\u200b\u540e\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u5c31\u200b\u4f1a\u200b\u4e3a\u200b\u5176\u200b\u5206\u914d\u200b\u4e00\u5757\u200b\u6808\u200b\u5185\u5b58\u200b</p> <ul> <li>\u200b\u6bcf\u4e2a\u200b\u6808\u200b\u7531\u200b\u591a\u4e2a\u200b\u6808\u5e27\u200b\uff08Frame\uff09\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7740\u200b\u6bcf\u6b21\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u65f6\u6240\u200b\u5360\u7528\u200b\u7684\u200b\u5185\u5b58\u200b</li> <li>\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6d3b\u52a8\u200b\u6808\u5e27\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7740\u200b\u5f53\u524d\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u90a3\u4e2a\u200b\u65b9\u6cd5\u200b</li> </ul> <p>\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff08Thread Context Switch\uff09\uff1a\u200b\u4e00\u4e9b\u200b\u539f\u56e0\u200b\u5bfc\u81f4\u200b CPU \u200b\u4e0d\u518d\u200b\u6267\u884c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8f6c\u800c\u200b\u6267\u884c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u7247\u7528\u200b\u5b8c\u200b</li> <li>\u200b\u5783\u573e\u200b\u56de\u6536\u200b</li> <li>\u200b\u6709\u200b\u66f4\u200b\u9ad8\u200b\u4f18\u5148\u7ea7\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u8fd0\u884c\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u81ea\u5df1\u200b\u8c03\u7528\u200b\u4e86\u200b sleep\u3001yield\u3001wait\u3001join\u3001park \u200b\u7b49\u200b\u65b9\u6cd5\u200b</li> </ul> <p>\u200b\u7a0b\u5e8f\u200b\u8ba1\u6570\u5668\u200b\uff08Program Counter Register\uff09\uff1a\u200b\u8bb0\u4f4f\u200b\u4e0b\u200b\u4e00\u6761\u200b JVM \u200b\u6307\u4ee4\u200b\u7684\u200b\u6267\u884c\u200b\u5730\u5740\u200b\uff0c\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u79c1\u6709\u200b\u7684\u200b</p> <p>\u200b\u5f53\u200b Context Switch \u200b\u53d1\u751f\u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u7531\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4fdd\u5b58\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u72b6\u6001\u200b\uff08PCB \u200b\u4e2d\u200b\uff09\uff0c\u200b\u5e76\u200b\u6062\u590d\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5305\u62ec\u200b\u7a0b\u5e8f\u200b\u8ba1\u6570\u5668\u200b\u3001\u200b\u865a\u62df\u673a\u200b\u6808\u4e2d\u200b\u6bcf\u4e2a\u200b\u6808\u5e27\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5982\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u3001\u200b\u64cd\u4f5c\u6570\u200b\u6808\u200b\u3001\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u7b49\u200b</p> <p>JVM \u200b\u89c4\u8303\u200b\u5e76\u200b\u6ca1\u6709\u200b\u9650\u5b9a\u200b\u7ebf\u7a0b\u200b\u6a21\u578b\u200b\uff0c\u200b\u4ee5\u200b HotSopot \u200b\u4e3a\u4f8b\u200b\uff1a</p> <ul> <li>Java \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u5185\u6838\u200b\u7ea7\u200b\u7ebf\u7a0b\u200b\uff081:1 \u200b\u7ebf\u7a0b\u200b\u6a21\u578b\u200b\uff09\uff0c\u200b\u6bcf\u4e2a\u200b Java \u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6620\u5c04\u200b\u5230\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u539f\u751f\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u9700\u8981\u200b\u6d88\u8017\u200b\u4e00\u5b9a\u200b\u7684\u200b\u5185\u6838\u200b\u8d44\u6e90\u200b\uff08\u200b\u5806\u6808\u200b\uff09</li> <li>\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8c03\u5ea6\u200b\u662f\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8fd0\u884c\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u7ebf\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u4ee3\u7801\u200b\u662f\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u8fd0\u884c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7ebf\u7a0b\u200b\u5207\u6362\u200b\uff08\u200b\u72b6\u6001\u200b\u6539\u53d8\u200b\uff09\u200b\u4f1a\u200b\u5bfc\u81f4\u7528\u6237\u200b\u4e0e\u200b\u5185\u6838\u200b\u6001\u200b\u8f6c\u6362\u200b\u8fdb\u884c\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u8fd9\u662f\u200b\u975e\u5e38\u200b\u6d88\u8017\u200b\u6027\u80fd\u200b</li> </ul> <p>Java \u200b\u4e2d\u200b main \u200b\u65b9\u6cd5\u200b\u542f\u52a8\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\uff0cmain \u200b\u65b9\u6cd5\u200b\u91cc\u9762\u200b\u7684\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5747\u200b\u4e3a\u5b50\u200b\u7ebf\u7a0b\u200b\uff0cmain \u200b\u7ebf\u7a0b\u200b\u662f\u200b\u8fd9\u4e9b\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7236\u200b\u7ebf\u7a0b\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_12","title":"\u7ebf\u7a0b\u200b\u8c03\u5ea6","text":"<p>\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\u6307\u200b\u7cfb\u7edf\u200b\u4e3a\u200b\u7ebf\u7a0b\u200b\u5206\u914d\u200b\u5904\u7406\u5668\u200b\u4f7f\u7528\u6743\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u65b9\u5f0f\u200b\u6709\u200b\u4e24\u79cd\u200b\uff1a\u200b\u534f\u540c\u5f0f\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\u3001\u200b\u62a2\u5360\u200b\u5f0f\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\uff08Java \u200b\u9009\u62e9\u200b\uff09</p> <p>\u200b\u534f\u540c\u5f0f\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u7531\u200b\u7ebf\u7a0b\u200b\u672c\u8eab\u200b\u63a7\u5236\u200b</p> <ul> <li>\u200b\u4f18\u70b9\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u505a\u200b\u5b8c\u200b\u4efb\u52a1\u200b\u624d\u200b\u901a\u77e5\u200b\u7cfb\u7edf\u200b\u5207\u6362\u200b\u5230\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u4e32\u884c\u200b\u6267\u884c\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\u95ee\u9898\u200b</li> <li>\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u4e0d\u200b\u53ef\u63a7\u200b\uff0c\u200b\u5982\u679c\u200b\u4ee3\u7801\u200b\u7f16\u5199\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u7a0b\u5e8f\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\uff0c\u200b\u5f15\u8d77\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5954\u6e83\u200b</li> </ul> <p>\u200b\u62a2\u5360\u200b\u5f0f\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u7531\u200b\u7cfb\u7edf\u200b\u5206\u914d\u200b</p> <ul> <li>\u200b\u4f18\u70b9\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u53ef\u63a7\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u56e0\u4e3a\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u95ee\u9898\u200b\u800c\u200b\u5bfc\u81f4\u200b\u6574\u4f53\u200b\u7cfb\u7edf\u200b\u4e0d\u53ef\u200b\u7528\u200b</li> <li>\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u65e0\u6cd5\u200b\u4e3b\u52a8\u200b\u4e3a\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u591a\u200b\u5206\u914d\u200b\u65f6\u95f4\u200b</li> </ul> <p>Java \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u4f18\u5148\u7ea7\u200b\u7684\u200b\u673a\u5236\u200b\uff0c\u200b\u4f18\u5148\u7ea7\u200b\u4f1a\u200b\u63d0\u793a\u200b\uff08hint\uff09\u200b\u8c03\u5ea6\u200b\u5668\u200b\u4f18\u5148\u200b\u8c03\u5ea6\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u200b\u4ec5\u4ec5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u63d0\u793a\u200b\uff0c\u200b\u8c03\u5ea6\u200b\u5668\u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u200b\u5b83\u200b\u3002\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b CPU \u200b\u6bd4\u8f83\u5fd9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f18\u5148\u7ea7\u200b\u9ad8\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u83b7\u5f97\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u65f6\u95f4\u200b\u7247\u200b\uff0c\u200b\u4f46\u200b CPU \u200b\u95f2\u65f6\u200b\uff0c\u200b\u4f18\u5148\u7ea7\u200b\u51e0\u4e4e\u200b\u6ca1\u200b\u4f5c\u7528\u200b</p> <p>\u200b\u8bf4\u660e\u200b\uff1a\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u901a\u8fc7\u200b\u4f18\u5148\u7ea7\u200b\u6765\u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u7684\u200b\u5148\u540e\u987a\u5e8f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_13","title":"\u672a\u6765\u200b\u4f18\u5316","text":"<p>\u200b\u5185\u6838\u200b\u7ea7\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\u7684\u200b\u6210\u672c\u200b\u8f83\u5927\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f15\u5165\u200b\u4e86\u200b\u66f4\u200b\u8f7b\u91cf\u7ea7\u200b\u7684\u200b\u534f\u7a0b\u200b\u3002\u200b\u7528\u6237\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8c03\u5ea6\u200b\u7531\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u5b9e\u73b0\u200b\uff08\u200b\u591a\u200b\u5bf9\u200b\u4e00\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6a21\u578b\u200b\uff0c\u200b\u591a\u4e2a\u200b\u7528\u6237\u200b\u7ebf\u7a0b\u200b\u6620\u5c04\u200b\u5230\u200b\u4e00\u4e2a\u200b\u5185\u6838\u200b\u7ea7\u200b\u7ebf\u7a0b\u200b\uff09\uff0c\u200b\u88ab\u200b\u8bbe\u8ba1\u200b\u4e3a\u200b\u534f\u540c\u200b\u5f0f\u8c03\u5ea6\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53eb\u200b\u534f\u7a0b\u200b</p> <ul> <li>\u200b\u6709\u6808\u200b\u534f\u7a0b\u200b\uff1a\u200b\u534f\u7a0b\u4f1a\u200b\u5b8c\u6574\u200b\u7684\u200b\u505a\u200b\u8c03\u7528\u200b\u6808\u200b\u7684\u200b\u4fdd\u62a4\u200b\u3001\u200b\u6062\u590d\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53eb\u200b\u6709\u200b\u6808\u200b\u534f\u7a0b\u200b</li> <li>\u200b\u65e0\u6808\u200b\u534f\u7a0b\u200b\uff1a\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u4e00\u79cd\u200b\u6709\u9650\u200b\u72b6\u6001\u673a\u200b\uff0c\u200b\u72b6\u6001\u200b\u4fdd\u5b58\u200b\u5728\u200b\u95ed\u200b\u5305\u91cc\u200b\uff0c\u200b\u6bd4\u6709\u200b\u6808\u534f\u7a0b\u200b\u66f4\u200b\u8f7b\u91cf\u200b\uff0c\u200b\u4f46\u662f\u200b\u529f\u80fd\u200b\u6709\u9650\u200b</li> </ul> <p>\u200b\u6709\u6808\u200b\u534f\u7a0b\u200b\u4e2d\u200b\u6709\u200b\u4e00\u79cd\u200b\u7279\u4f8b\u200b\u53eb\u200b\u7ea4\u7a0b\u200b\uff0c\u200b\u5728\u200b\u65b0\u200b\u5e76\u53d1\u200b\u6a21\u578b\u200b\u4e2d\u200b\uff0c\u200b\u4e00\u6bb5\u200b\u7ea4\u7a0b\u200b\u7684\u200b\u4ee3\u7801\u200b\u88ab\u200b\u5206\u4e3a\u200b\u4e24\u200b\u90e8\u5206\u200b\uff0c\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u548c\u200b\u8c03\u5ea6\u200b\u5668\u200b\uff1a</p> <ul> <li>\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\uff1a\u200b\u7528\u4e8e\u200b\u7ef4\u62a4\u200b\u6267\u884c\u200b\u73b0\u573a\u200b\uff0c\u200b\u4fdd\u62a4\u200b\u3001\u200b\u6062\u590d\u200b\u4e0a\u4e0b\u6587\u200b\u72b6\u6001\u200b</li> <li>\u200b\u8c03\u5ea6\u200b\u5668\u200b\uff1a\u200b\u8d1f\u8d23\u200b\u7f16\u6392\u200b\u6240\u6709\u200b\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u4ee3\u7801\u200b\u987a\u5e8f\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_14","title":"\u7ebf\u7a0b\u200b\u72b6\u6001","text":"<p>\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u72b6\u6001\u200b\u53c2\u8003\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\uff1a\u200b\u521b\u5efa\u200b\u6001\u200b\u3001\u200b\u5c31\u7eea\u200b\u6001\u200b\u3001\u200b\u8fd0\u884c\u200b\u6001\u200b\u3001\u200b\u963b\u585e\u200b\u6001\u200b\u3001\u200b\u7ec8\u6b62\u200b\u6001\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u7531\u751f\u200b\u5230\u200b\u6b7b\u200b\u7684\u200b\u5b8c\u6574\u200b\u8fc7\u7a0b\u200b\uff08\u200b\u751f\u547d\u5468\u671f\u200b\uff09\uff1a\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u521b\u5efa\u200b\u5e76\u200b\u542f\u52a8\u200b\u4ee5\u540e\u200b\uff0c\u200b\u65e2\u200b\u4e0d\u662f\u200b\u4e00\u200b\u542f\u52a8\u200b\u5c31\u200b\u8fdb\u5165\u200b\u4e86\u200b\u6267\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u4e00\u76f4\u200b\u5904\u4e8e\u200b\u6267\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u5728\u200b API \u200b\u4e2d\u200b <code>java.lang.Thread.State</code> \u200b\u8fd9\u4e2a\u200b\u679a\u4e3e\u200b\u4e2d\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u516d\u79cd\u200b\u7ebf\u7a0b\u200b\u72b6\u6001\u200b\uff1a</p> \u200b\u7ebf\u7a0b\u200b\u72b6\u6001\u200b \u200b\u5bfc\u81f4\u200b\u72b6\u6001\u200b\u53d1\u751f\u200b\u6761\u4ef6\u200b NEW\uff08\u200b\u65b0\u5efa\u200b\uff09 \u200b\u7ebf\u7a0b\u200b\u521a\u200b\u88ab\u200b\u521b\u5efa\u200b\uff0c\u200b\u4f46\u662f\u200b\u5e76\u672a\u200b\u542f\u52a8\u200b\uff0c\u200b\u8fd8\u200b\u6ca1\u200b\u8c03\u7528\u200b start \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ea\u6709\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6ca1\u6709\u200b\u7ebf\u7a0b\u200b\u7279\u5f81\u200b Runnable\uff08\u200b\u53ef\u200b\u8fd0\u884c\u200b\uff09 \u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u5728\u200b Java \u200b\u865a\u62df\u673a\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u81ea\u5df1\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u6ca1\u6709\u200b\uff0c\u200b\u8fd9\u200b\u53d6\u51b3\u4e8e\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u8c03\u7528\u200b\u4e86\u200b t.start() \u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5c31\u7eea\u200b\uff08\u200b\u7ecf\u5178\u200b\u53eb\u6cd5\u200b\uff09 Blocked\uff08\u200b\u963b\u585e\u200b\uff09 \u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8bd5\u56fe\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff0c\u200b\u800c\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u9501\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\uff0c\u200b\u5219\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b Blocked \u200b\u72b6\u6001\u200b\uff1b\u200b\u5f53\u8be5\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u9501\u65f6\u200b\uff0c\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u53d8\u6210\u200b Runnable \u200b\u72b6\u6001\u200b Waiting\uff08\u200b\u65e0\u9650\u200b\u7b49\u5f85\u200b\uff09 \u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u7b49\u5f85\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4e00\u4e2a\u200b\uff08\u200b\u5524\u9192\u200b\uff09\u200b\u52a8\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b Waiting \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fdb\u5165\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\u540e\u200b\u4e0d\u80fd\u200b\u81ea\u52a8\u200b\u5524\u9192\u200b\uff0c\u200b\u5fc5\u987b\u200b\u7b49\u5f85\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b notify \u200b\u6216\u8005\u200b notifyAll \u200b\u65b9\u6cd5\u200b\u624d\u80fd\u200b\u5524\u9192\u200b Timed Waiting \uff08\u200b\u9650\u671f\u200b\u7b49\u5f85\u200b\uff09 \u200b\u6709\u200b\u51e0\u4e2a\u200b\u65b9\u6cd5\u200b\u6709\u200b\u8d85\u65f6\u200b\u53c2\u6570\u200b\uff0c\u200b\u8c03\u7528\u200b\u5c06\u200b\u8fdb\u5165\u200b Timed Waiting \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd9\u4e00\u200b\u72b6\u6001\u200b\u5c06\u200b\u4e00\u76f4\u200b\u4fdd\u6301\u200b\u5230\u200b\u8d85\u65f6\u200b\u671f\u6ee1\u200b\u6216\u8005\u200b\u63a5\u6536\u200b\u5230\u200b\u5524\u9192\u200b\u901a\u77e5\u200b\u3002\u200b\u5e26\u6709\u200b\u8d85\u65f6\u200b\u53c2\u6570\u200b\u7684\u200b\u5e38\u7528\u200b\u65b9\u6cd5\u200b\u6709\u200b Thread.sleep \u3001Object.wait Terminated\uff08\u200b\u7ed3\u675f\u200b\uff09 run \u200b\u65b9\u6cd5\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\u800c\u200b\u6b7b\u4ea1\u200b\uff0c\u200b\u6216\u8005\u200b\u56e0\u4e3a\u200b\u6ca1\u6709\u200b\u6355\u83b7\u200b\u7684\u200b\u5f02\u5e38\u200b\u7ec8\u6b62\u200b\u4e86\u200b run \u200b\u65b9\u6cd5\u200b\u800c\u200b\u6b7b\u4ea1\u200b <p></p> <ul> <li>NEW \u2192 RUNNABLE\uff1a\u200b\u5f53\u200b\u8c03\u7528\u200b t.start() \u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u7531\u200b NEW \u2192 RUNNABLE</li> <li>RUNNABLE \u2194 WAITING\uff1a</li> <li> <p>\u200b\u8c03\u7528\u200b obj.wait() \u200b\u65b9\u6cd5\u200b\u65f6\u200b</p> <p>\u200b\u8c03\u7528\u200b obj.notify()\u3001obj.notifyAll()\u3001t.interrupt()\uff1a</p> <ul> <li>\u200b\u7ade\u4e89\u200b\u9501\u200b\u6210\u529f\u200b\uff0ct \u200b\u7ebf\u7a0b\u200b\u4ece\u200b WAITING \u2192 RUNNABLE</li> <li>\u200b\u7ade\u4e89\u200b\u9501\u200b\u5931\u8d25\u200b\uff0ct \u200b\u7ebf\u7a0b\u200b\u4ece\u200b WAITING \u2192 BLOCKED</li> <li>\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b t.join() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6ce8\u610f\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5728\u200b t \u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\u7684\u200b\u76d1\u89c6\u5668\u200b\u4e0a\u200b\u7b49\u5f85\u200b</li> <li>\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b LockSupport.park() \u200b\u65b9\u6cd5\u200b</li> <li>RUNNABLE \u2194 TIMED_WAITING\uff1a\u200b\u8c03\u7528\u200b obj.wait(long n) \u200b\u65b9\u6cd5\u200b\u3001\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b t.join(long n) \u200b\u65b9\u6cd5\u200b\u3001\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b Thread.sleep(long n)</li> <li>RUNNABLE \u2194 BLOCKED\uff1at \u200b\u7ebf\u7a0b\u200b\u7528\u200b synchronized(obj) \u200b\u83b7\u53d6\u200b\u4e86\u200b\u5bf9\u8c61\u200b\u9501\u65f6\u200b\u7ade\u4e89\u200b\u5931\u8d25\u200b</li> </ul> </li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_15","title":"\u67e5\u770b\u200b\u7ebf\u7a0b","text":"<p>Windows\uff1a</p> <ul> <li>\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u5668\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u8fdb\u7a0b\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u6740\u6b7b\u200b\u8fdb\u7a0b\u200b</li> <li>tasklist \u200b\u67e5\u770b\u200b\u8fdb\u7a0b\u200b</li> <li>taskkill \u200b\u6740\u6b7b\u200b\u8fdb\u7a0b\u200b</li> </ul> <p>Linux\uff1a</p> <ul> <li>ps -ef \u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u8fdb\u7a0b\u200b</li> <li>ps -fT -p  \u200b\u67e5\u770b\u200b\u67d0\u4e2a\u200b\u8fdb\u7a0b\u200b\uff08PID\uff09\u200b\u7684\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b <li>kill \u200b\u6740\u6b7b\u200b\u8fdb\u7a0b\u200b</li> <li>top \u200b\u6309\u200b\u5927\u5199\u200b H \u200b\u5207\u6362\u200b\u662f\u5426\u200b\u663e\u793a\u200b\u7ebf\u7a0b\u200b</li> <li>top -H -p  \u200b\u67e5\u770b\u200b\u67d0\u4e2a\u200b\u8fdb\u7a0b\u200b\uff08PID\uff09\u200b\u7684\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b <p>Java\uff1a</p> <ul> <li>jps \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u6240\u6709\u200b Java \u200b\u8fdb\u7a0b\u200b</li> <li>jstack  \u200b\u67e5\u770b\u200b\u67d0\u4e2a\u200b Java \u200b\u8fdb\u7a0b\u200b\uff08PID\uff09\u200b\u7684\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u72b6\u6001\u200b <li>jconsole \u200b\u6765\u200b\u67e5\u770b\u200b\u67d0\u4e2a\u200b Java \u200b\u8fdb\u7a0b\u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u8fd0\u884c\u200b\u60c5\u51b5\u200b\uff08\u200b\u56fe\u5f62\u754c\u9762\u200b\uff09</li>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_16","title":"\u540c\u6b65","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_17","title":"\u4e34\u754c\u200b\u533a","text":"<p>\u200b\u4e34\u754c\u200b\u8d44\u6e90\u200b\uff1a\u200b\u4e00\u6b21\u200b\u4ec5\u200b\u5141\u8bb8\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u4f7f\u7528\u200b\u7684\u200b\u8d44\u6e90\u200b\u6210\u4e3a\u200b\u4e34\u754c\u200b\u8d44\u6e90\u200b</p> <p>\u200b\u4e34\u754c\u200b\u533a\u200b\uff1a\u200b\u8bbf\u95ee\u200b\u4e34\u754c\u200b\u8d44\u6e90\u200b\u7684\u200b\u4ee3\u7801\u200b\u5757\u200b</p> <p>\u200b\u7ade\u6001\u200b\u6761\u4ef6\u200b\uff1a\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u4e34\u754c\u200b\u533a\u5185\u200b\u6267\u884c\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4ee3\u7801\u200b\u7684\u200b\u6267\u884c\u200b\u5e8f\u5217\u200b\u4e0d\u540c\u200b\u800c\u200b\u5bfc\u81f4\u200b\u7ed3\u679c\u200b\u65e0\u6cd5\u200b\u9884\u6d4b\u200b\uff0c\u200b\u79f0\u4e4b\u4e3a\u200b\u53d1\u751f\u200b\u4e86\u200b\u7ade\u6001\u200b\u6761\u4ef6\u200b</p> <p>\u200b\u4e00\u4e2a\u200b\u7a0b\u5e8f\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u8bfb\u200b\u5171\u4eab\u8d44\u6e90\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u5728\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u5171\u4eab\u8d44\u6e90\u200b\u8bfb\u5199\u64cd\u4f5c\u200b\u65f6\u200b\u53d1\u751f\u200b\u6307\u4ee4\u200b\u4ea4\u9519\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b</p> <p>\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u4e34\u754c\u200b\u533a\u200b\u7684\u200b\u7ade\u6001\u200b\u6761\u4ef6\u200b\u53d1\u751f\u200b\uff08\u200b\u89e3\u51b3\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff09\uff1a</p> <ul> <li>\u200b\u963b\u585e\u200b\u5f0f\u200b\u7684\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff1asynchronized\uff0clock</li> <li>\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b\u7684\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff1a\u200b\u539f\u5b50\u200b\u53d8\u91cf\u200b</li> </ul> <p>\u200b\u7ba1\u7a0b\u200b\uff08monitor\uff09\uff1a\u200b\u7531\u200b\u5c40\u90e8\u200b\u4e8e\u200b\u81ea\u5df1\u200b\u7684\u200b\u82e5\u5e72\u200b\u516c\u5171\u200b\u53d8\u91cf\u200b\u548c\u200b\u6240\u6709\u200b\u8bbf\u95ee\u200b\u8fd9\u4e9b\u200b\u516c\u5171\u200b\u53d8\u91cf\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u6240\u200b\u7ec4\u6210\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u6a21\u5757\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u5728\u200b\u7ba1\u7a0b\u200b\u5185\u200b\u6d3b\u52a8\u200b\uff0c\u200b\u5373\u200b\u7ba1\u7a0b\u200b\u5185\u200b\u5b9a\u4e49\u200b\u7684\u200b\u64cd\u4f5c\u200b\u5728\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ea\u200b\u88ab\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u8c03\u7528\u200b\uff08\u200b\u7531\u200b\u7f16\u8bd1\u5668\u200b\u5b9e\u73b0\u200b\uff09</p> <p>synchronized\uff1a\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4e34\u754c\u200b\u533a\u5185\u200b\u4ee3\u7801\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e92\u65a5\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8ba9\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u81f3\u591a\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u80fd\u200b\u6301\u6709\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff0c\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u9501\u200b\u65f6\u4f1a\u200b\u963b\u585e\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u62e5\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u5b89\u5168\u200b\u7684\u200b\u6267\u884c\u200b\u4e34\u754c\u200b\u533a\u5185\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4e0d\u7528\u200b\u62c5\u5fc3\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b</p> <p>\u200b\u4e92\u65a5\u200b\u548c\u200b\u540c\u6b65\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b synchronized \u200b\u5173\u952e\u5b57\u200b\u6765\u200b\u5b8c\u6210\u200b\uff0c\u200b\u533a\u522b\u200b\uff1a</p> <ul> <li>\u200b\u4e92\u65a5\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u4e34\u754c\u200b\u533a\u200b\u7684\u200b\u7ade\u6001\u200b\u6761\u4ef6\u200b\u53d1\u751f\u200b\uff0c\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4e34\u754c\u200b\u533a\u200b\u4ee3\u7801\u200b</li> <li>\u200b\u540c\u6b65\u200b\u662f\u200b\u7531\u4e8e\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u7684\u200b\u5148\u540e\u200b\u3001\u200b\u987a\u5e8f\u200b\u4e0d\u540c\u200b\u3001\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b\u5230\u200b\u67d0\u4e2a\u200b\u70b9\u200b</li> </ul> <p>\u200b\u6027\u80fd\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u6027\u80fd\u200b\u5dee\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\u6027\u80fd\u200b\u597d\u200b\uff0c\u200b\u5047\u5982\u200b\u5f00\u53d1\u200b\u4e2d\u200b\u4e0d\u4f1a\u200b\u5b58\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u7c7b\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#syn-ed","title":"syn-ed","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_18","title":"\u4f7f\u7528\u200b\u9501","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_19","title":"\u540c\u6b65\u200b\u5757","text":"<p>\u200b\u9501\u200b\u5bf9\u8c61\u200b\uff1a\u200b\u7406\u8bba\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u662f\u200b\u4efb\u610f\u200b\u7684\u200b\u552f\u4e00\u200b\u5bf9\u8c61\u200b</p> <p>synchronized \u200b\u662f\u200b\u53ef\u200b\u91cd\u5165\u200b\u3001\u200b\u4e0d\u200b\u516c\u5e73\u200b\u7684\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b</p> <p>\u200b\u539f\u5219\u4e0a\u200b\uff1a</p> <ul> <li>\u200b\u9501\u200b\u5bf9\u8c61\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b\u5171\u4eab\u8d44\u6e90\u200b</li> <li>\u200b\u5728\u200b\u5b9e\u4f8b\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u4f7f\u7528\u200b this \u200b\u4f5c\u4e3a\u200b\u9501\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u9501\u4f4f\u200b\u7684\u200b this \u200b\u6b63\u597d\u200b\u662f\u200b\u5171\u4eab\u8d44\u6e90\u200b</li> <li>\u200b\u5728\u200b\u9759\u6001\u65b9\u6cd5\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7c7b\u540d\u200b .class \u200b\u5b57\u8282\u200b\u7801\u200b\u4f5c\u4e3a\u200b\u9501\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u9759\u6001\u200b\u6210\u5458\u200b\u5c5e\u4e8e\u200b\u7c7b\u200b\uff0c\u200b\u88ab\u200b\u6240\u6709\u200b\u5b9e\u4f8b\u200b\u5bf9\u8c61\u200b\u5171\u4eab\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u9501\u4f4f\u200b\u7c7b\u200b</li> </ul> <p>\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\u683c\u5f0f\u200b\uff1a</p> Java<pre><code>synchronized(\u200b\u9501\u200b\u5bf9\u8c61\u200b){\n    // \u200b\u8bbf\u95ee\u5171\u4eab\u200b\u8d44\u6e90\u200b\u7684\u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b\n}\n</code></pre> <p>\u200b\u5b9e\u4f8b\u200b\uff1a</p> Java<pre><code>public class demo {\n    static int counter = 0;\n    //static\u200b\u4fee\u9970\u200b\uff0c\u200b\u5219\u200b\u5143\u7d20\u200b\u662f\u200b\u5c5e\u4e8e\u200b\u7c7b\u200b\u672c\u8eab\u200b\u7684\u200b\uff0c\u200b\u4e0d\u200b\u5c5e\u4e8e\u200b\u5bf9\u8c61\u200b  \uff0c\u200b\u4e0e\u200b\u7c7b\u200b\u4e00\u8d77\u200b\u52a0\u8f7d\u200b\u4e00\u6b21\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\n    static final Object room = new Object();\n    public static void main(String[] args) throws InterruptedException {\n        Thread t1 = new Thread(() -&gt; {\n            for (int i = 0; i &lt; 5000; i++) {\n                synchronized (room) {\n                    counter++;\n                }\n            }\n        }, \"t1\");\n        Thread t2 = new Thread(() -&gt; {\n            for (int i = 0; i &lt; 5000; i++) {\n                synchronized (room) {\n                    counter--;\n                }\n            }\n        }, \"t2\");\n        t1.start();\n        t2.start();\n        t1.join();\n        t2.join();\n        System.out.println(counter);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_20","title":"\u540c\u6b65\u200b\u65b9\u6cd5","text":"<p>\u200b\u628a\u200b\u51fa\u73b0\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u7684\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\u9501\u8d77\u6765\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u53ea\u80fd\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b\u8bbf\u95ee\u200b</p> <p>synchronized \u200b\u4fee\u9970\u200b\u7684\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4e0d\u200b\u5177\u5907\u200b\u7ee7\u627f\u6027\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b50\u7c7b\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u5b50\u7c7b\u200b\u7684\u200b\u65b9\u6cd5\u200b\u4e5f\u200b\u88ab\u200b synchronized \u200b\u4fee\u9970\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u9501\u200b\u5bf9\u8c61\u200b\u5176\u5b9e\u200b\u662f\u200b\u4e00\u628a\u200b\u9501\u200b\uff0c\u200b\u800c\u4e14\u200b\u662f\u200b\u5b50\u7c7b\u200b\u5bf9\u8c61\u200b\u4f5c\u4e3a\u200b\u9501\u200b</p> <p>\u200b\u7528\u6cd5\u200b\uff1a\u200b\u76f4\u63a5\u200b\u7ed9\u200b\u65b9\u6cd5\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u4fee\u9970\u7b26\u200b synchronized</p> Java<pre><code>//\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\n\u200b\u4fee\u9970\u7b26\u200b synchronized \u200b\u8fd4\u56de\u503c\u200b\u7c7b\u578b\u200b \u200b\u65b9\u6cd5\u200b\u540d\u200b(\u200b\u65b9\u6cd5\u200b\u53c2\u6570\u200b) { \n    \u200b\u65b9\u6cd5\u200b\u4f53\u200b\uff1b\n}\n//\u200b\u540c\u6b65\u200b\u9759\u6001\u65b9\u6cd5\u200b\n\u200b\u4fee\u9970\u7b26\u200b static synchronized \u200b\u8fd4\u56de\u503c\u200b\u7c7b\u578b\u200b \u200b\u65b9\u6cd5\u200b\u540d\u200b(\u200b\u65b9\u6cd5\u200b\u53c2\u6570\u200b) { \n    \u200b\u65b9\u6cd5\u200b\u4f53\u200b\uff1b\n}\n</code></pre> <p>\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\u5e95\u5c42\u200b\u4e5f\u200b\u662f\u200b\u6709\u200b\u9501\u200b\u5bf9\u8c61\u200b\u7684\u200b\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5b9e\u4f8b\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\u9ed8\u8ba4\u200b\u7528\u200b this \u200b\u4f5c\u4e3a\u200b\u7684\u200b\u9501\u200b\u5bf9\u8c61\u200b</li> </ul> Java<pre><code>public synchronized void test() {} //\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\npublic void test() {\n    synchronized(this) {}\n}\n</code></pre> <ul> <li>\u200b\u5982\u679c\u200b\u65b9\u6cd5\u200b\u662f\u200b\u9759\u6001\u65b9\u6cd5\u200b\uff1a\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\u9ed8\u8ba4\u200b\u7528\u7c7b\u200b\u540d\u200b .class \u200b\u4f5c\u4e3a\u200b\u7684\u200b\u9501\u200b\u5bf9\u8c61\u200b</li> </ul> Java<pre><code>class Test{\n  public synchronized static void test() {}\n}\n//\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\nclass Test{\n    public void test() {\n        synchronized(Test.class) {}\n  }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_21","title":"\u7ebf\u7a0b\u200b\u516b\u9501","text":"<p>\u200b\u7ebf\u7a0b\u200b\u516b\u9501\u200b\u5c31\u662f\u200b\u8003\u5bdf\u200b synchronized \u200b\u9501\u4f4f\u200b\u7684\u200b\u662f\u200b\u54ea\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u76f4\u63a5\u200b\u767e\u5ea6\u200b\u641c\u7d22\u200b\u76f8\u5173\u200b\u7684\u200b\u5b9e\u4f8b\u200b</p> <p>\u200b\u8bf4\u660e\u200b\uff1a\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b\u9501\u4f4f\u200b\u7684\u200b\u5bf9\u8c61\u200b\u662f\u4e0d\u662f\u200b\u540c\u4e00\u4e2a\u200b</p> <ul> <li>\u200b\u9501\u4f4f\u200b\u7c7b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6240\u6709\u200b\u7c7b\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u7c7b\u200b\u7684\u200b\u6240\u6709\u200b\u5b9e\u4f8b\u200b\u90fd\u200b\u76f8\u5f53\u4e8e\u200b\u540c\u4e00\u200b\u628a\u200b\u9501\u200b</li> <li>\u200b\u9501\u4f4f\u200b this \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b\u5f53\u524d\u200b\u5b9e\u4f8b\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b\u5b9e\u4f8b\u200b\u5c31\u200b\u4e0d\u200b\u5b89\u5168\u200b</li> </ul> <p>\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\uff1a\u200b\u56e0\u4e3a\u200b\u9501\u4f4f\u200b\u7684\u200b\u4e0d\u662f\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7ebf\u7a0b\u200b 1 \u200b\u8c03\u7528\u200b a \u200b\u65b9\u6cd5\u200b\u9501\u4f4f\u200b\u7684\u200b\u7c7b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7ebf\u7a0b\u200b 2 \u200b\u8c03\u7528\u200b b \u200b\u65b9\u6cd5\u200b\u9501\u4f4f\u200b\u7684\u200b n2 \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4e0d\u662f\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b</p> Java<pre><code>class Number{\n    public static synchronized void a(){\n        Thread.sleep(1000);\n        System.out.println(\"1\");\n    }\n    public synchronized void b() {\n        System.out.println(\"2\");\n    }\n}\npublic static void main(String[] args) {\n    Number n1 = new Number();\n    Number n2 = new Number();\n    new Thread(()-&gt;{ n1.a(); }).start();\n    new Thread(()-&gt;{ n2.b(); }).start();\n}\n</code></pre> <p>\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff1a\u200b\u56e0\u4e3a\u200b n1 \u200b\u8c03\u7528\u200b a() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u9501\u4f4f\u200b\u7684\u200b\u662f\u200b\u7c7b\u200b\u5bf9\u8c61\u200b\uff0cn2 \u200b\u8c03\u7528\u200b b() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u9501\u4f4f\u200b\u7684\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b</p> Java<pre><code>class Number{\n    public static synchronized void a(){\n        Thread.sleep(1000);\n        System.out.println(\"1\");\n    }\n    public static synchronized void b() {\n        System.out.println(\"2\");\n    }\n}\npublic static void main(String[] args) {\n    Number n1 = new Number();\n    Number n2 = new Number();\n    new Thread(()-&gt;{ n1.a(); }).start();\n    new Thread(()-&gt;{ n2.b(); }).start();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_22","title":"\u9501\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#monitor","title":"Monitor","text":"<p>Monitor \u200b\u88ab\u200b\u7ffb\u8bd1\u200b\u4e3a\u200b\u76d1\u89c6\u5668\u200b\u6216\u200b\u7ba1\u7a0b\u200b</p> <p>\u200b\u6bcf\u4e2a\u200b Java \u200b\u5bf9\u8c61\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5173\u8054\u200b\u4e00\u4e2a\u200b Monitor \u200b\u5bf9\u8c61\u200b\uff0cMonitor \u200b\u4e5f\u200b\u662f\u200b class\uff0c\u200b\u5176\u5b9e\u200b\u4f8b\u200b\u5b58\u50a8\u200b\u5728\u200b\u5806\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b synchronized \u200b\u7ed9\u200b\u5bf9\u8c61\u200b\u4e0a\u9501\u200b\uff08\u200b\u91cd\u91cf\u7ea7\u200b\uff09\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u5934\u200b\u7684\u200b Mark Word \u200b\u4e2d\u200b\u5c31\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u6307\u5411\u200b Monitor \u200b\u5bf9\u8c61\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b</p> <ul> <li>Mark Word \u200b\u7ed3\u6784\u200b\uff1a\u200b\u6700\u540e\u200b\u4e24\u4f4d\u200b\u662f\u200b\u9501\u200b\u6807\u5fd7\u200b\u4f4d\u200b</li> </ul> <p></p> <ul> <li>64 \u200b\u4f4d\u200b\u865a\u62df\u673a\u200b Mark Word\uff1a</li> </ul> <p></p> <p>\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>\u200b\u5f00\u59cb\u200b\u65f6\u200b Monitor \u200b\u4e2d\u200b Owner \u200b\u4e3a\u200b null</li> <li>\u200b\u5f53\u200b Thread-2 \u200b\u6267\u884c\u200b synchronized(obj) \u200b\u5c31\u200b\u4f1a\u200b\u5c06\u200b Monitor \u200b\u7684\u200b\u6240\u6709\u8005\u200b Owner \u200b\u7f6e\u200b\u4e3a\u200b Thread-2\uff0cMonitor \u200b\u4e2d\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b Owner\uff0cobj \u200b\u5bf9\u8c61\u200b\u7684\u200b Mark Word \u200b\u6307\u5411\u200b Monitor\uff0c\u200b\u628a\u200b\u5bf9\u8c61\u200b\u539f\u6709\u200b\u7684\u200b MarkWord \u200b\u5b58\u5165\u200b\u7ebf\u7a0b\u200b\u6808\u4e2d\u200b\u7684\u200b\u9501\u200b\u8bb0\u5f55\u200b\u4e2d\u200b\uff08\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u90e8\u5206\u200b\u8be6\u89e3\u200b\uff09 </li> <li>\u200b\u5728\u200b Thread-2 \u200b\u4e0a\u9501\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0cThread-3\u3001Thread-4\u3001Thread-5 \u200b\u4e5f\u200b\u6267\u884c\u200b synchronized(obj)\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8fdb\u5165\u200b EntryList BLOCKED\uff08\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff09</li> <li>Thread-2 \u200b\u6267\u884c\u200b\u5b8c\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u6839\u636e\u200b obj \u200b\u5bf9\u8c61\u200b\u5934\u200b\u4e2d\u200b Monitor \u200b\u5730\u5740\u200b\u5bfb\u627e\u200b\uff0c\u200b\u8bbe\u7f6e\u200b Owner \u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u628a\u200b\u7ebf\u7a0b\u200b\u6808\u200b\u7684\u200b\u9501\u200b\u8bb0\u5f55\u200b\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5934\u200b\u7684\u200b\u503c\u200b\u8bbe\u7f6e\u200b\u56de\u200b MarkWord</li> <li>\u200b\u5524\u9192\u200b EntryList \u200b\u4e2d\u200b\u7b49\u5f85\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u7ade\u4e89\u200b\u9501\u200b\uff0c\u200b\u7ade\u4e89\u200b\u662f\u975e\u200b\u516c\u5e73\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u65f6\u200b\u6709\u200b\u65b0\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u60f3\u8981\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u53ef\u80fd\u200b\u76f4\u63a5\u200b\u5c31\u200b\u62a2\u5360\u200b\u5230\u200b\u4e86\u200b\uff0c\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u963b\u585e\u200b</li> <li>WaitSet \u200b\u4e2d\u200b\u7684\u200b Thread-0\uff0c\u200b\u662f\u200b\u4ee5\u524d\u200b\u83b7\u5f97\u200b\u8fc7\u9501\u200b\uff0c\u200b\u4f46\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u8fdb\u5165\u200b WAITING \u200b\u72b6\u6001\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff08wait-notify \u200b\u673a\u5236\u200b\uff09</li> </ul> <p></p> <p>\u200b\u6ce8\u610f\u200b\uff1a</p> <ul> <li>synchronized \u200b\u5fc5\u987b\u200b\u662f\u200b\u8fdb\u5165\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b Monitor \u200b\u624d\u200b\u6709\u200b\u4e0a\u8ff0\u200b\u7684\u200b\u6548\u679c\u200b</li> <li>\u200b\u4e0d\u200b\u52a0\u200b synchronized \u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e0d\u4f1a\u200b\u5173\u8054\u200b\u76d1\u89c6\u5668\u200b\uff0c\u200b\u4e0d\u200b\u9075\u4ece\u200b\u4ee5\u4e0a\u200b\u89c4\u5219\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_23","title":"\u5b57\u8282\u200b\u7801","text":"<p>\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>public static void main(String[] args) {\n    Object lock = new Object();\n    synchronized (lock) {\n        System.out.println(\"ok\");\n    }\n}\n</code></pre> Java<pre><code>0:  new             #2      // new Object\n3:  dup\n4:  invokespecial   #1      // invokespecial &lt;init&gt;:()V\uff0c\u200b\u975e\u865a\u200b\u65b9\u6cd5\u200b\n7:  astore_1                // lock\u200b\u5f15\u7528\u200b -&gt; lock\n8:  aload_1                 // lock \uff08synchronized\u200b\u5f00\u59cb\u200b\uff09\n9:  dup                     // \u200b\u4e00\u4efd\u200b\u7528\u6765\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u4e00\u4efd\u200b\u7528\u6765\u200b\u5f15\u7528\u200b\n10: astore_2                // lock\u200b\u5f15\u7528\u200b -&gt; slot 2\n11: monitorenter            // \u3010\u200b\u5c06\u200b lock\u200b\u5bf9\u8c61\u200b MarkWord \u200b\u7f6e\u200b\u4e3a\u200b Monitor \u200b\u6307\u9488\u200b\u3011\n12: getstatic       #3      // System.out\n15: ldc             #4      // \"ok\"\n17: invokevirtual   #5      // invokevirtual println:(Ljava/lang/String;)V\n20: aload_2                 // slot 2(lock\u200b\u5f15\u7528\u200b)\n21: monitorexit             // \u3010\u200b\u5c06\u200b lock\u200b\u5bf9\u8c61\u200b MarkWord \u200b\u91cd\u7f6e\u200b, \u200b\u5524\u9192\u200b EntryList\u3011\n22: goto 30\n25: astore_3                // any -&gt; slot 3\n26: aload_2                 // slot 2(lock\u200b\u5f15\u7528\u200b)\n27: monitorexit             // \u3010\u200b\u5c06\u200b lock\u200b\u5bf9\u8c61\u200b MarkWord \u200b\u91cd\u7f6e\u200b, \u200b\u5524\u9192\u200b EntryList\u3011\n28: aload_3\n29: athrow\n30: return\nException table:\n    from to target type\n      12 22 25      any\n      25 28 25      any\nLineNumberTable: ...\nLocalVariableTable:\n    Start Length Slot Name Signature\n        0   31      0 args [Ljava/lang/String;\n        8   23      1 lock Ljava/lang/Object;\n</code></pre> <p>\u200b\u8bf4\u660e\u200b\uff1a</p> <ul> <li>\u200b\u901a\u8fc7\u200b\u5f02\u5e38\u200b try-catch \u200b\u673a\u5236\u200b\uff0c\u200b\u786e\u4fdd\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u88ab\u200b\u89e3\u9501\u200b</li> <li>\u200b\u65b9\u6cd5\u200b\u7ea7\u522b\u200b\u7684\u200b synchronized \u200b\u4e0d\u4f1a\u200b\u5728\u200b\u5b57\u8282\u200b\u7801\u200b\u6307\u4ee4\u200b\u4e2d\u200b\u6709\u6240\u200b\u4f53\u73b0\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_24","title":"\u9501\u200b\u5347\u7ea7","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_25","title":"\u5347\u7ea7\u200b\u8fc7\u7a0b","text":"<p>synchronized \u200b\u662f\u200b\u53ef\u200b\u91cd\u5165\u200b\u3001\u200b\u4e0d\u200b\u516c\u5e73\u200b\u7684\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5176\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b</p> Java<pre><code>\u200b\u65e0\u9501\u200b -&gt; \u200b\u504f\u5411\u200b\u9501\u200b -&gt; \u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b -&gt; \u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b   // \u200b\u968f\u7740\u200b\u7ade\u4e89\u200b\u7684\u200b\u589e\u52a0\u200b\uff0c\u200b\u53ea\u80fd\u200b\u9501\u200b\u5347\u7ea7\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u964d\u7ea7\u200b\n</code></pre> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_26","title":"\u504f\u5411\u200b\u9501","text":"<p>\u200b\u504f\u5411\u200b\u9501\u200b\u7684\u200b\u601d\u60f3\u200b\u662f\u200b\u504f\u5411\u200b\u4e8e\u200b\u8ba9\u200b\u7b2c\u4e00\u4e2a\u200b\u83b7\u53d6\u200b\u9501\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e4b\u540e\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u8be5\u9501\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u540c\u6b65\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>\u200b\u5f53\u9501\u200b\u5bf9\u8c61\u200b\u7b2c\u4e00\u6b21\u200b\u88ab\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\u7684\u200b\u65f6\u5019\u200b\u8fdb\u5165\u200b\u504f\u5411\u200b\u72b6\u6001\u200b\uff0c\u200b\u6807\u8bb0\u200b\u4e3a\u200b 101\uff0c\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b CAS \u200b\u64cd\u4f5c\u200b\u5c06\u200b\u7ebf\u7a0b\u200b ID \u200b\u8bb0\u5f55\u200b\u5230\u200b Mark Word\u3002\u200b\u5982\u679c\u200b CAS \u200b\u64cd\u4f5c\u200b\u6210\u529f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u4ee5\u540e\u200b\u8fdb\u5165\u200b\u8fd9\u4e2a\u200b\u9501\u200b\u76f8\u5173\u200b\u7684\u200b\u540c\u6b65\u200b\u5757\u200b\uff0c\u200b\u67e5\u770b\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b ID \u200b\u662f\u200b\u81ea\u5df1\u200b\u7684\u200b\u5c31\u200b\u8868\u793a\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u518d\u200b\u8fdb\u884c\u200b\u4efb\u4f55\u200b\u540c\u6b65\u64cd\u4f5c\u200b</li> <li>\u200b\u5f53\u6709\u200b\u53e6\u5916\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8fd9\u4e2a\u200b\u9501\u200b\u5bf9\u8c61\u200b\u65f6\u200b\uff0c\u200b\u504f\u5411\u200b\u72b6\u6001\u200b\u5c31\u200b\u5ba3\u544a\u200b\u7ed3\u675f\u200b\uff0c\u200b\u6b64\u65f6\u200b\u64a4\u9500\u200b\u504f\u5411\u200b\uff08Revoke Bias\uff09\u200b\u540e\u200b\u6062\u590d\u200b\u5230\u200b\u672a\u200b\u9501\u5b9a\u200b\u6216\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u72b6\u6001\u200b</li> </ul> <p></p> <p>\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u521b\u5efa\u200b\u65f6\u200b\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b\u5f00\u542f\u200b\u4e86\u200b\u504f\u5411\u200b\u9501\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u5f00\u542f\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u8c61\u200b\u521b\u5efa\u200b\u540e\u200b\uff0cMarkWord \u200b\u503c\u4e3a\u200b 0x05 \u200b\u5373\u200b\u6700\u540e\u200b 3 \u200b\u4f4d\u4e3a\u200b 101\uff0cthread\u3001epoch\u3001age \u200b\u90fd\u200b\u4e3a\u200b 0</li> <li>\u200b\u504f\u5411\u200b\u9501\u200b\u662f\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u5ef6\u8fdf\u200b\u7684\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5728\u200b\u7a0b\u5e8f\u200b\u542f\u52a8\u200b\u65f6\u200b\u7acb\u5373\u200b\u751f\u6548\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u200b\u907f\u514d\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u52a0\u200b VM \u200b\u53c2\u6570\u200b <code>-XX:BiasedLockingStartupDelay=0</code> \u200b\u6765\u200b\u7981\u7528\u200b\u5ef6\u8fdf\u200b\u3002JDK 8 \u200b\u5ef6\u8fdf\u200b 4s \u200b\u5f00\u542f\u200b\u504f\u5411\u200b\u9501\u200b\u539f\u56e0\u200b\uff1a\u200b\u5728\u200b\u521a\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u4ee3\u7801\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u6709\u200b\u597d\u200b\u591a\u7ebf\u7a0b\u200b\u6765\u200b\u62a2\u9501\u200b\uff0c\u200b\u5982\u679c\u200b\u5f00\u200b\u504f\u5411\u200b\u9501\u200b\u6548\u7387\u200b\u53cd\u800c\u200b\u964d\u4f4e\u200b</li> <li>\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u200b\u8fc7\u200b hashCode\uff0c\u200b\u5c31\u200b\u518d\u4e5f\u200b\u65e0\u6cd5\u200b\u8fdb\u5165\u200b\u504f\u5411\u200b\u72b6\u6001\u200b\u4e86\u200b</li> <li>\u200b\u6dfb\u52a0\u200b VM \u200b\u53c2\u6570\u200b <code>-XX:-UseBiasedLocking</code> \u200b\u7981\u7528\u200b\u504f\u5411\u200b\u9501\u200b</li> </ul> <p>\u200b\u64a4\u9500\u200b\u504f\u5411\u200b\u9501\u200b\u7684\u200b\u72b6\u6001\u200b\uff1a</p> <ul> <li>\u200b\u8c03\u7528\u200b\u5bf9\u8c61\u200b\u7684\u200b hashCode\uff1a\u200b\u504f\u5411\u200b\u9501\u200b\u7684\u200b\u5bf9\u8c61\u200b MarkWord \u200b\u4e2d\u200b\u5b58\u50a8\u200b\u7684\u200b\u662f\u200b\u7ebf\u7a0b\u200b id\uff0c\u200b\u8c03\u7528\u200b hashCode \u200b\u5bfc\u81f4\u200b\u504f\u5411\u200b\u9501\u200b\u88ab\u200b\u64a4\u9500\u200b</li> <li>\u200b\u5f53\u6709\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u504f\u5411\u200b\u9501\u200b\u5bf9\u8c61\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u504f\u5411\u200b\u9501\u200b\u5347\u7ea7\u200b\u4e3a\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b</li> <li>\u200b\u8c03\u7528\u200b wait/notify\uff0c\u200b\u9700\u8981\u200b\u7533\u8bf7\u200b Monitor\uff0c\u200b\u8fdb\u5165\u200b WaitSet</li> </ul> <p>\u200b\u6279\u91cf\u200b\u64a4\u9500\u200b\uff1a\u200b\u5982\u679c\u200b\u5bf9\u8c61\u200b\u88ab\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u504f\u5411\u200b\u4e86\u200b\u7ebf\u7a0b\u200b T1 \u200b\u7684\u200b\u5bf9\u8c61\u200b\u4ecd\u200b\u6709\u200b\u673a\u4f1a\u200b\u91cd\u65b0\u200b\u504f\u5411\u200b T2\uff0c\u200b\u91cd\u200b\u504f\u5411\u200b\u4f1a\u200b\u91cd\u7f6e\u200b\u5bf9\u8c61\u200b\u7684\u200b Thread ID</p> <ul> <li>\u200b\u6279\u91cf\u200b\u91cd\u200b\u504f\u5411\u200b\uff1a\u200b\u5f53\u200b\u64a4\u9500\u200b\u504f\u5411\u200b\u9501\u200b\u9608\u503c\u200b\u8d85\u8fc7\u200b 20 \u200b\u6b21\u540e\u200b\uff0cJVM \u200b\u4f1a\u200b\u89c9\u5f97\u200b\u662f\u4e0d\u662f\u200b\u504f\u5411\u200b\u9519\u200b\u4e86\u200b\uff0c\u200b\u4e8e\u662f\u200b\u5728\u200b\u7ed9\u200b\u8fd9\u4e9b\u200b\u5bf9\u8c61\u200b\u52a0\u9501\u200b\u65f6\u200b\u91cd\u65b0\u200b\u504f\u5411\u200b\u81f3\u200b\u52a0\u9501\u200b\u7ebf\u7a0b\u200b</li> <li>\u200b\u6279\u91cf\u200b\u64a4\u9500\u200b\uff1a\u200b\u5f53\u200b\u64a4\u9500\u200b\u504f\u5411\u200b\u9501\u200b\u9608\u503c\u200b\u8d85\u8fc7\u200b 40 \u200b\u6b21\u540e\u200b\uff0cJVM \u200b\u4f1a\u200b\u89c9\u5f97\u200b\u81ea\u5df1\u200b\u786e\u5b9e\u200b\u504f\u5411\u200b\u9519\u200b\u4e86\u200b\uff0c\u200b\u6839\u672c\u200b\u5c31\u200b\u4e0d\u8be5\u200b\u504f\u5411\u200b\uff0c\u200b\u4e8e\u662f\u200b\u6574\u4e2a\u200b\u7c7b\u200b\u7684\u200b\u6240\u6709\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u4f1a\u200b\u53d8\u4e3a\u200b\u4e0d\u53ef\u200b\u504f\u5411\u200b\u7684\u200b\uff0c\u200b\u65b0\u5efa\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u53ef\u200b\u504f\u5411\u200b\u7684\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_27","title":"\u8f7b\u91cf\u7ea7\u200b\u9501","text":"<p>\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u6709\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u8981\u200b\u52a0\u9501\u200b\uff0c\u200b\u4f46\u200b\u52a0\u9501\u200b\u7684\u200b\u65f6\u95f4\u200b\u662f\u200b\u9519\u5f00\u200b\u7684\u200b\uff08\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u6765\u200b\u4f18\u5316\u200b\uff0c\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u5bf9\u200b\u4f7f\u7528\u8005\u200b\u662f\u200b\u900f\u660e\u200b\u7684\u200b\uff08\u200b\u4e0d\u200b\u53ef\u89c1\u200b\uff09</p> <p>\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200b\u5b83\u200b\u5df2\u7ecf\u200b\u62e5\u6709\u200b\u7684\u200b\u9501\u200b\u6240\u200b\u540c\u6b65\u200b\u7740\u200b\u7684\u200b\u4ee3\u7801\u200b\u5757\u200b\uff0c\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u6700\u5927\u200b\u7684\u200b\u4f5c\u7528\u200b\u662f\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b</p> <p>\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u5728\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\u65f6\u200b\uff08\u200b\u9501\u91cd\u200b\u5165\u65f6\u200b\uff09\uff0c\u200b\u6bcf\u6b21\u200b\u91cd\u200b\u5165\u200b\u4ecd\u7136\u200b\u9700\u8981\u200b\u6267\u884c\u200b CAS \u200b\u64cd\u4f5c\u200b\uff0cJava 6 \u200b\u624d\u200b\u5f15\u5165\u200b\u7684\u200b\u504f\u5411\u200b\u9501\u6765\u200b\u4f18\u5316\u200b</p> <p>\u200b\u9501\u200b\u91cd\u5165\u200b\u5b9e\u4f8b\u200b\uff1a</p> Java<pre><code>static final Object obj = new Object();\npublic static void method1() {\n    synchronized( obj ) {\n        // \u200b\u540c\u6b65\u200b\u5757\u200b A\n        method2();\n    }\n}\npublic static void method2() {\n    synchronized( obj ) {\n        // \u200b\u540c\u6b65\u200b\u5757\u200b B\n    }\n}\n</code></pre> <ul> <li>\u200b\u521b\u5efa\u200b\u9501\u200b\u8bb0\u5f55\u200b\uff08Lock Record\uff09\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6808\u200b\u5e27\u200b\u90fd\u200b\u4f1a\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u9501\u200b\u8bb0\u5f55\u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u5b58\u50a8\u200b\u9501\u5b9a\u200b\u5bf9\u8c61\u200b\u7684\u200b Mark Word</li> </ul> <p></p> <ul> <li> <p>\u200b\u8ba9\u200b\u9501\u200b\u8bb0\u5f55\u200b\u4e2d\u200b Object reference \u200b\u6307\u5411\u200b\u9501\u4f4f\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u200b\u5c1d\u8bd5\u200b\u7528\u200b CAS \u200b\u66ff\u6362\u200b Object \u200b\u7684\u200b Mark Word\uff0c\u200b\u5c06\u200b Mark Word \u200b\u7684\u200b\u503c\u200b\u5b58\u5165\u200b\u9501\u200b\u8bb0\u5f55\u200b</p> </li> <li> <p>\u200b\u5982\u679c\u200b CAS \u200b\u66ff\u6362\u200b\u6210\u529f\u200b\uff0c\u200b\u5bf9\u8c61\u200b\u5934\u200b\u4e2d\u200b\u5b58\u50a8\u200b\u4e86\u200b\u9501\u200b\u8bb0\u5f55\u200b\u5730\u5740\u200b\u548c\u200b\u72b6\u6001\u200b 00\uff08\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\uff09 \uff0c\u200b\u8868\u793a\u200b\u7531\u8be5\u200b\u7ebf\u7a0b\u200b\u7ed9\u200b\u5bf9\u8c61\u200b\u52a0\u9501\u200b </p> </li> <li> <p>\u200b\u5982\u679c\u200b CAS \u200b\u5931\u8d25\u200b\uff0c\u200b\u6709\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p> </li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u6301\u6709\u200b\u4e86\u200b\u8be5\u200b Object \u200b\u7684\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u8868\u660e\u200b\u6709\u200b\u7ade\u4e89\u200b\uff0c\u200b\u8fdb\u5165\u200b\u9501\u200b\u81a8\u80c0\u200b\u8fc7\u7a0b\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u81ea\u5df1\u200b\u6267\u884c\u200b\u4e86\u200b synchronized \u200b\u9501\u200b\u91cd\u5165\u200b\uff0c\u200b\u5c31\u200b\u6dfb\u52a0\u200b\u4e00\u6761\u200b Lock Record \u200b\u4f5c\u4e3a\u200b\u91cd\u5165\u200b\u7684\u200b\u8ba1\u6570\u200b</li> </ul> <p></p> <ul> <li>\u200b\u5f53\u200b\u9000\u51fa\u200b synchronized \u200b\u4ee3\u7801\u200b\u5757\u200b\uff08\u200b\u89e3\u9501\u200b\u65f6\u200b\uff09</li> <li>\u200b\u5982\u679c\u200b\u6709\u200b\u53d6\u503c\u200b\u4e3a\u200b null \u200b\u7684\u200b\u9501\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u8868\u793a\u200b\u6709\u200b\u91cd\u5165\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u91cd\u7f6e\u200b\u9501\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u8868\u793a\u200b\u91cd\u200b\u5165\u200b\u8ba1\u6570\u200b\u51cf\u200b 1</li> <li>\u200b\u5982\u679c\u200b\u9501\u200b\u8bb0\u5f55\u200b\u7684\u200b\u503c\u200b\u4e0d\u200b\u4e3a\u200b null\uff0c\u200b\u8fd9\u65f6\u200b\u4f7f\u7528\u200b CAS \u200b\u5c06\u200b Mark Word \u200b\u7684\u200b\u503c\u200b\u6062\u590d\u200b\u7ed9\u200b\u5bf9\u8c61\u200b\u5934\u200b<ul> <li>\u200b\u6210\u529f\u200b\uff0c\u200b\u5219\u200b\u89e3\u9501\u200b\u6210\u529f\u200b</li> <li>\u200b\u5931\u8d25\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u8fdb\u884c\u200b\u4e86\u200b\u9501\u200b\u81a8\u80c0\u200b\u6216\u200b\u5df2\u7ecf\u200b\u5347\u7ea7\u200b\u4e3a\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u89e3\u9501\u200b\u6d41\u7a0b\u200b</li> </ul> </li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_28","title":"\u9501\u200b\u81a8\u80c0","text":"<p>\u200b\u5728\u200b\u5c1d\u8bd5\u200b\u52a0\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0cCAS \u200b\u64cd\u4f5c\u200b\u65e0\u6cd5\u200b\u6210\u529f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u4e3a\u6b64\u200b\u5bf9\u8c61\u200b\u52a0\u4e0a\u200b\u4e86\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\uff08\u200b\u6709\u200b\u7ade\u4e89\u200b\uff09\uff0c\u200b\u8fd9\u65f6\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u9501\u200b\u81a8\u80c0\u200b\uff0c\u200b\u5c06\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u53d8\u4e3a\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b</p> <ul> <li>\u200b\u5f53\u200b Thread-1 \u200b\u8fdb\u884c\u200b\u8f7b\u91cf\u7ea7\u200b\u52a0\u9501\u200b\u65f6\u200b\uff0cThread-0 \u200b\u5df2\u7ecf\u200b\u5bf9\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u52a0\u200b\u4e86\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b</li> </ul> <p></p> <ul> <li>Thread-1 \u200b\u52a0\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fdb\u5165\u200b\u9501\u200b\u81a8\u80c0\u200b\u6d41\u7a0b\u200b\uff1a\u200b\u4e3a\u200b Object \u200b\u5bf9\u8c61\u200b\u7533\u8bf7\u200b Monitor \u200b\u9501\u200b\uff0c\u200b\u901a\u8fc7\u200b Object \u200b\u5bf9\u8c61\u200b\u5934\u200b\u83b7\u53d6\u200b\u5230\u6301\u200b\u9501\u7ebf\u200b\u7a0b\u200b\uff0c\u200b\u5c06\u200b Monitor \u200b\u7684\u200b Owner \u200b\u7f6e\u200b\u4e3a\u200b Thread-0\uff0c\u200b\u5c06\u200b Object \u200b\u7684\u200b\u5bf9\u8c61\u200b\u5934\u200b\u6307\u5411\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u5730\u5740\u200b\uff0c\u200b\u7136\u540e\u200b\u81ea\u5df1\u200b\u8fdb\u5165\u200b Monitor \u200b\u7684\u200b EntryList BLOCKED</li> </ul> <p></p> <ul> <li>\u200b\u5f53\u200b Thread-0 \u200b\u9000\u51fa\u200b\u540c\u6b65\u200b\u5757\u200b\u89e3\u9501\u200b\u65f6\u200b\uff0c\u200b\u4f7f\u7528\u200b CAS \u200b\u5c06\u200b Mark Word \u200b\u7684\u200b\u503c\u200b\u6062\u590d\u200b\u7ed9\u200b\u5bf9\u8c61\u200b\u5934\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u8fdb\u5165\u200b\u91cd\u91cf\u7ea7\u200b\u89e3\u9501\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u5373\u200b\u6309\u7167\u200b Monitor \u200b\u5730\u5740\u200b\u627e\u5230\u200b Monitor \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u8bbe\u7f6e\u200b Owner \u200b\u4e3a\u200b null\uff0c\u200b\u5524\u9192\u200b EntryList \u200b\u4e2d\u200b BLOCKED \u200b\u7ebf\u7a0b\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_29","title":"\u9501\u200b\u4f18\u5316","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_30","title":"\u81ea\u65cb\u200b\u9501","text":"<p>\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u7ade\u4e89\u200b\u65f6\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u7acb\u5373\u200b\u963b\u585e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u81ea\u65cb\u200b\uff08\u200b\u9ed8\u8ba4\u200b 10 \u200b\u6b21\u200b\uff09\u200b\u6765\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u91c7\u7528\u200b\u5faa\u73af\u200b\u7684\u200b\u65b9\u5f0f\u200b\u53bb\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b</p> <p>\u200b\u6ce8\u610f\u200b\uff1a</p> <ul> <li>\u200b\u81ea\u65cb\u200b\u5360\u7528\u200b CPU \u200b\u65f6\u95f4\u200b\uff0c\u200b\u5355\u6838\u200b CPU \u200b\u81ea\u65cb\u200b\u5c31\u662f\u200b\u6d6a\u8d39\u65f6\u95f4\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ea\u80fd\u200b\u8fd0\u884c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u591a\u6838\u200b CPU \u200b\u81ea\u65cb\u200b\u624d\u80fd\u200b\u53d1\u6325\u4f18\u52bf\u200b</li> <li>\u200b\u81ea\u65cb\u200b\u5931\u8d25\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u963b\u585e\u72b6\u6001\u200b</li> </ul> <p>\u200b\u4f18\u70b9\u200b\uff1a\u200b\u4e0d\u4f1a\u200b\u8fdb\u5165\u200b\u963b\u585e\u72b6\u6001\u200b\uff0c\u200b\u51cf\u5c11\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u7684\u200b\u6d88\u8017\u200b</p> <p>\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u5f53\u200b\u81ea\u65cb\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8d8a\u6765\u8d8a\u200b\u591a\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u7684\u200b\u6d88\u8017\u200b CPU \u200b\u8d44\u6e90\u200b</p> <p>\u200b\u81ea\u65cb\u200b\u9501\u200b\u60c5\u51b5\u200b\uff1a</p> <ul> <li> <p>\u200b\u81ea\u65cb\u200b\u6210\u529f\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a </p> </li> <li> <p>\u200b\u81ea\u65cb\u200b\u5931\u8d25\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> </li> </ul> <p></p> <p>\u200b\u81ea\u65cb\u200b\u9501\u200b\u8bf4\u660e\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b Java 6 \u200b\u4e4b\u540e\u200b\u81ea\u65cb\u200b\u9501\u200b\u662f\u200b\u81ea\u200b\u9002\u5e94\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5bf9\u8c61\u200b\u521a\u521a\u200b\u7684\u200b\u4e00\u6b21\u200b\u81ea\u65cb\u200b\u64cd\u4f5c\u200b\u6210\u529f\u200b\u8fc7\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8ba4\u4e3a\u200b\u8fd9\u6b21\u200b\u81ea\u65cb\u200b\u6210\u529f\u200b\u7684\u200b\u53ef\u80fd\u6027\u200b\u4f1a\u9ad8\u200b\uff0c\u200b\u5c31\u200b\u591a\u200b\u81ea\u65cb\u200b\u51e0\u6b21\u200b\uff1b\u200b\u53cd\u4e4b\u200b\uff0c\u200b\u5c31\u200b\u5c11\u200b\u81ea\u65cb\u200b\u751a\u81f3\u200b\u4e0d\u200b\u81ea\u65cb\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u667a\u80fd\u200b</li> <li>Java 7 \u200b\u4e4b\u540e\u200b\u4e0d\u80fd\u200b\u63a7\u5236\u200b\u662f\u5426\u200b\u5f00\u542f\u200b\u81ea\u65cb\u200b\u529f\u80fd\u200b\uff0c\u200b\u7531\u200b JVM \u200b\u63a7\u5236\u200b</li> </ul> Java<pre><code>//\u200b\u624b\u5199\u200b\u81ea\u65cb\u200b\u9501\u200b\npublic class SpinLock {\n    // \u200b\u6cdb\u578b\u200b\u88c5\u200b\u7684\u200b\u662f\u200bThread\uff0c\u200b\u539f\u5b50\u200b\u5f15\u7528\u200b\u7ebf\u7a0b\u200b\n    AtomicReference&lt;Thread&gt; atomicReference = new AtomicReference&lt;&gt;();\n\n    public void lock() {\n        Thread thread = Thread.currentThread();\n        System.out.println(thread.getName() + \" come in\");\n\n        //\u200b\u5f00\u59cb\u200b\u81ea\u65cb\u200b\uff0c\u200b\u671f\u671b\u503c\u200b\u4e3a\u200bnull\uff0c\u200b\u66f4\u65b0\u200b\u503c\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n        while (!atomicReference.compareAndSet(null, thread)) {\n            Thread.sleep(1000);\n            System.out.println(thread.getName() + \" \u200b\u6b63\u5728\u200b\u81ea\u65cb\u200b\");\n        }\n        System.out.println(thread.getName() + \" \u200b\u81ea\u65cb\u200b\u6210\u529f\u200b\");\n    }\n\n    public void unlock() {\n        Thread thread = Thread.currentThread();\n\n        //\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u5b8c\u9501\u200b\u628a\u200b\u5f15\u7528\u200b\u53d8\u4e3a\u200bnull\n        atomicReference.compareAndSet(thread, null);\n        System.out.println(thread.getName() + \" invoke unlock\");\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        SpinLock lock = new SpinLock();\n        new Thread(() -&gt; {\n            //\u200b\u5360\u6709\u200b\u9501\u200b\n            lock.lock();\n            Thread.sleep(10000); \n\n            //\u200b\u91ca\u653e\u200b\u9501\u200b\n            lock.unlock();\n        },\"t1\").start();\n\n        // \u200b\u8ba9\u200bmain\u200b\u7ebf\u7a0b\u200b\u6682\u505c\u200b1\u200b\u79d2\u200b\uff0c\u200b\u4f7f\u5f97\u200bt1\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5148\u200b\u6267\u884c\u200b\n        Thread.sleep(1000);\n\n        new Thread(() -&gt; {\n            lock.lock();\n            lock.unlock();\n        },\"t2\").start();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_31","title":"\u9501\u200b\u6d88\u9664","text":"<p>\u200b\u9501\u200b\u6d88\u9664\u200b\u662f\u200b\u6307\u200b\u5bf9\u4e8e\u200b\u88ab\u200b\u68c0\u6d4b\u200b\u51fa\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u7ade\u4e89\u200b\u7684\u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u7684\u200b\u9501\u200b\u8fdb\u884c\u200b\u6d88\u9664\u200b\uff0c\u200b\u8fd9\u662f\u200b JVM \u200b\u5373\u65f6\u200b\u7f16\u8bd1\u5668\u200b\u7684\u200b\u4f18\u5316\u200b</p> <p>\u200b\u9501\u200b\u6d88\u9664\u200b\u4e3b\u8981\u200b\u662f\u200b\u901a\u8fc7\u200b\u9003\u9038\u200b\u5206\u6790\u200b\u6765\u200b\u652f\u6301\u200b\uff0c\u200b\u5982\u679c\u200b\u5806\u4e0a\u200b\u7684\u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u9003\u9038\u200b\u51fa\u53bb\u200b\u88ab\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\u5230\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5b83\u4eec\u200b\u5f53\u6210\u200b\u79c1\u6709\u200b\u6570\u636e\u200b\u5bf9\u5f85\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5b83\u4eec\u200b\u7684\u200b\u9501\u200b\u8fdb\u884c\u200b\u6d88\u9664\u200b\uff08\u200b\u540c\u6b65\u200b\u6d88\u9664\u200b\uff1aJVM \u200b\u9003\u9038\u200b\u5206\u6790\u200b\uff09</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_32","title":"\u9501\u200b\u7c97\u5316","text":"<p>\u200b\u5bf9\u200b\u76f8\u540c\u200b\u5bf9\u8c61\u200b\u591a\u6b21\u200b\u52a0\u9501\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7ebf\u7a0b\u200b\u53d1\u751f\u200b\u591a\u6b21\u91cd\u200b\u5165\u200b\uff0c\u200b\u9891\u7e41\u200b\u7684\u200b\u52a0\u9501\u200b\u64cd\u4f5c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6027\u80fd\u200b\u635f\u8017\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u9501\u200b\u7c97\u5316\u200b\u65b9\u5f0f\u200b\u4f18\u5316\u200b</p> <p>\u200b\u5982\u679c\u200b\u865a\u62df\u673a\u200b\u63a2\u6d4b\u200b\u5230\u200b\u4e00\u4e32\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u52a0\u9501\u200b\uff0c\u200b\u5c06\u4f1a\u200b\u628a\u200b\u52a0\u9501\u200b\u7684\u200b\u8303\u56f4\u200b\u6269\u5c55\u200b\uff08\u200b\u7c97\u5316\u200b\uff09\u200b\u5230\u200b\u6574\u4e2a\u200b\u64cd\u4f5c\u200b\u5e8f\u5217\u200b\u7684\u200b\u5916\u90e8\u200b</p> <ul> <li>\u200b\u4e00\u4e9b\u200b\u770b\u8d77\u6765\u200b\u6ca1\u6709\u200b\u52a0\u9501\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5176\u5b9e\u200b\u9690\u5f0f\u200b\u7684\u200b\u52a0\u200b\u4e86\u200b\u5f88\u591a\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>public static String concatString(String s1, String s2, String s3) {\n    return s1 + s2 + s3;\n}\n</code></pre> <ul> <li>String \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e0d\u53ef\u200b\u53d8\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u7f16\u8bd1\u5668\u200b\u4f1a\u200b\u5bf9\u200b String \u200b\u7684\u200b\u62fc\u63a5\u200b\u81ea\u52a8\u200b\u4f18\u5316\u200b\u3002\u200b\u5728\u200b JDK 1.5 \u200b\u4e4b\u524d\u200b\uff0c\u200b\u8f6c\u5316\u200b\u4e3a\u200b StringBuffer \u200b\u5bf9\u8c61\u200b\u7684\u200b\u8fde\u7eed\u200b append() \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b append() \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u540c\u6b65\u200b\u5757\u200b</li> </ul> Java<pre><code>public static String concatString(String s1, String s2, String s3) {\n    StringBuffer sb = new StringBuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.toString();\n}\n</code></pre> <p>\u200b\u6269\u5c55\u200b\u5230\u200b\u7b2c\u4e00\u4e2a\u200b append() \u200b\u64cd\u4f5c\u200b\u4e4b\u524d\u200b\u76f4\u81f3\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b append() \u200b\u64cd\u4f5c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u52a0\u9501\u200b\u4e00\u6b21\u200b\u5c31\u200b\u53ef\u4ee5\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_33","title":"\u591a\u200b\u628a\u200b\u9501","text":"<p>\u200b\u591a\u200b\u628a\u200b\u4e0d\u76f8\u5e72\u200b\u7684\u200b\u9501\u200b\uff1a\u200b\u4e00\u95f4\u200b\u5927\u200b\u5c4b\u5b50\u200b\u6709\u200b\u4e24\u4e2a\u200b\u529f\u80fd\u200b\u7761\u89c9\u200b\u3001\u200b\u5b66\u4e60\u200b\uff0c\u200b\u4e92\u200b\u4e0d\u76f8\u5e72\u200b\u3002\u200b\u73b0\u5728\u200b\u4e00\u4eba\u8981\u200b\u5b66\u4e60\u200b\uff0c\u200b\u4e00\u4eba\u8981\u200b\u7761\u89c9\u200b\uff0c\u200b\u5982\u679c\u200b\u53ea\u7528\u200b\u4e00\u95f4\u200b\u5c4b\u5b50\u200b\uff08\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff09\u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5e76\u53d1\u200b\u5ea6\u200b\u5f88\u200b\u4f4e\u200b</p> <p>\u200b\u5c06\u200b\u9501\u200b\u7684\u200b\u7c92\u5ea6\u200b\u7ec6\u5206\u200b\uff1a</p> <ul> <li>\u200b\u597d\u5904\u200b\uff0c\u200b\u662f\u200b\u53ef\u4ee5\u200b\u589e\u5f3a\u200b\u5e76\u53d1\u200b\u5ea6\u200b</li> <li>\u200b\u574f\u5904\u200b\uff0c\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u83b7\u5f97\u200b\u591a\u200b\u628a\u200b\u9501\u200b\uff0c\u200b\u5c31\u200b\u5bb9\u6613\u200b\u53d1\u751f\u200b\u6b7b\u9501\u200b </li> </ul> <p>\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u51c6\u5907\u200b\u591a\u4e2a\u200b\u5bf9\u8c61\u200b\u9501\u200b</p> Java<pre><code>public static void main(String[] args) {\n    BigRoom bigRoom = new BigRoom();\n    new Thread(() -&gt; { bigRoom.study(); }).start();\n    new Thread(() -&gt; { bigRoom.sleep(); }).start();\n}\nclass BigRoom {\n    private final Object studyRoom = new Object();\n    private final Object sleepRoom = new Object();\n\n    public void sleep() throws InterruptedException {\n        synchronized (sleepRoom) {\n            System.out.println(\"sleeping 2 \u200b\u5c0f\u65f6\u200b\");\n            Thread.sleep(2000);\n        }\n    }\n\n    public void study() throws InterruptedException {\n        synchronized (studyRoom) {\n            System.out.println(\"study 1 \u200b\u5c0f\u65f6\u200b\");\n            Thread.sleep(1000);\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_34","title":"\u6d3b\u8dc3\u6027","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_35","title":"\u6b7b\u9501","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_36","title":"\u5f62\u6210","text":"<p>\u200b\u6b7b\u9501\u200b\uff1a\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u5b83\u4eec\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6216\u8005\u200b\u5168\u90e8\u200b\u90fd\u200b\u5728\u200b\u7b49\u5f85\u200b\u67d0\u4e2a\u200b\u8d44\u6e90\u200b\u88ab\u200b\u91ca\u653e\u200b\uff0c\u200b\u7531\u4e8e\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u65e0\u9650\u671f\u200b\u5730\u200b\u963b\u585e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7a0b\u5e8f\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u6b63\u5e38\u200b\u7ec8\u6b62\u200b</p> <p>Java \u200b\u6b7b\u9501\u200b\u4ea7\u751f\u200b\u7684\u200b\u56db\u4e2a\u200b\u5fc5\u8981\u6761\u4ef6\u200b\uff1a</p> <ol> <li>\u200b\u4e92\u65a5\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5373\u5f53\u200b\u8d44\u6e90\u200b\u88ab\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\uff08\u200b\u5360\u6709\u200b\uff09\u200b\u65f6\u200b\uff0c\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u80fd\u200b\u4f7f\u7528\u200b</li> <li>\u200b\u4e0d\u53ef\u200b\u5265\u593a\u200b\u6761\u4ef6\u200b\uff0c\u200b\u8d44\u6e90\u200b\u8bf7\u6c42\u8005\u200b\u4e0d\u80fd\u200b\u5f3a\u5236\u200b\u4ece\u200b\u8d44\u6e90\u200b\u5360\u6709\u8005\u200b\u624b\u4e2d\u200b\u593a\u53d6\u200b\u8d44\u6e90\u200b\uff0c\u200b\u8d44\u6e90\u200b\u53ea\u80fd\u200b\u7531\u200b\u8d44\u6e90\u200b\u5360\u6709\u8005\u200b\u4e3b\u52a8\u200b\u91ca\u653e\u200b</li> <li>\u200b\u8bf7\u6c42\u200b\u548c\u200b\u4fdd\u6301\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5373\u5f53\u200b\u8d44\u6e90\u200b\u8bf7\u6c42\u8005\u200b\u5728\u200b\u8bf7\u6c42\u200b\u5176\u4ed6\u200b\u7684\u200b\u8d44\u6e90\u200b\u7684\u200b\u540c\u65f6\u200b\u4fdd\u6301\u200b\u5bf9\u200b\u539f\u6709\u200b\u8d44\u6e90\u200b\u7684\u200b\u5360\u6709\u200b</li> <li>\u200b\u5faa\u73af\u200b\u7b49\u5f85\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5373\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b\u7b49\u5f85\u200b\u5faa\u73af\u200b\u961f\u5217\u200b\uff1ap1 \u200b\u8981\u200b p2 \u200b\u7684\u200b\u8d44\u6e90\u200b\uff0cp2 \u200b\u8981\u200b p1 \u200b\u7684\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5f62\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7b49\u5f85\u200b\u73af\u8def\u200b</li> </ol> <p>\u200b\u56db\u4e2a\u200b\u6761\u4ef6\u200b\u90fd\u200b\u6210\u7acb\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4fbf\u200b\u5f62\u6210\u200b\u6b7b\u9501\u200b\u3002\u200b\u6b7b\u9501\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6253\u7834\u200b\u4e0a\u8ff0\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\uff0c\u200b\u4fbf\u200b\u53ef\u200b\u8ba9\u200b\u6b7b\u9501\u200b\u6d88\u5931\u200b</p> Java<pre><code>public class Dead {\n    public static Object resources1 = new Object();\n    public static Object resources2 = new Object();\n    public static void main(String[] args) {\n        new Thread(() -&gt; {\n            // \u200b\u7ebf\u7a0b\u200b1\uff1a\u200b\u5360\u7528\u200b\u8d44\u6e90\u200b1 \uff0c\u200b\u8bf7\u6c42\u200b\u8d44\u6e90\u200b2\n            synchronized(resources1){\n                System.out.println(\"\u200b\u7ebf\u7a0b\u200b1\u200b\u5df2\u7ecf\u200b\u5360\u7528\u200b\u4e86\u200b\u8d44\u6e90\u200b1\uff0c\u200b\u5f00\u59cb\u200b\u8bf7\u6c42\u200b\u8d44\u6e90\u200b2\");\n                Thread.sleep(2000);//\u200b\u4f11\u606f\u200b\u4e24\u79d2\u200b\uff0c\u200b\u9632\u6b62\u200b\u7ebf\u7a0b\u200b1\u200b\u76f4\u63a5\u200b\u8fd0\u884c\u200b\u5b8c\u6210\u200b\u3002\n                //2\u200b\u79d2\u200b\u5185\u7ebf\u200b\u7a0b\u200b2\u200b\u80af\u5b9a\u200b\u53ef\u4ee5\u200b\u9501\u4f4f\u200b\u8d44\u6e90\u200b2\n                synchronized (resources2){\n                    System.out.println(\"\u200b\u7ebf\u7a0b\u200b1\u200b\u5df2\u7ecf\u200b\u5360\u7528\u200b\u4e86\u200b\u8d44\u6e90\u200b2\");\n                }\n        }).start();\n        new Thread(() -&gt; {\n            // \u200b\u7ebf\u7a0b\u200b2\uff1a\u200b\u5360\u7528\u200b\u8d44\u6e90\u200b2 \uff0c\u200b\u8bf7\u6c42\u200b\u8d44\u6e90\u200b1\n            synchronized(resources2){\n                System.out.println(\"\u200b\u7ebf\u7a0b\u200b2\u200b\u5df2\u7ecf\u200b\u5360\u7528\u200b\u4e86\u200b\u8d44\u6e90\u200b2\uff0c\u200b\u5f00\u59cb\u200b\u8bf7\u6c42\u200b\u8d44\u6e90\u200b1\");\n                Thread.sleep(2000);\n                synchronized (resources1){\n                    System.out.println(\"\u200b\u7ebf\u7a0b\u200b2\u200b\u5df2\u7ecf\u200b\u5360\u7528\u200b\u4e86\u200b\u8d44\u6e90\u200b1\");\n                }\n            }}\n        }).start();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_37","title":"\u5b9a\u4f4d","text":"<p>\u200b\u5b9a\u4f4d\u200b\u6b7b\u9501\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b jps \u200b\u5b9a\u4f4d\u200b\u8fdb\u7a0b\u200b id\uff0c\u200b\u518d\u7528\u200b <code>jstack id</code> \u200b\u5b9a\u4f4d\u200b\u6b7b\u9501\u200b\uff0c\u200b\u627e\u5230\u200b\u6b7b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u67e5\u770b\u200b\u6e90\u7801\u200b\uff0c\u200b\u89e3\u51b3\u200b\u4f18\u5316\u200b</li> </ul> Bash<pre><code>\"Thread-1\" #12 prio=5 os_prio=0 tid=0x000000001eb69000 nid=0xd40 waiting formonitor entry [0x000000001f54f000]\n  java.lang.Thread.State: BLOCKED (on object monitor)\n#\u200b\u7701\u7565\u200b    \n\"Thread-1\" #12 prio=5 os_prio=0 tid=0x000000001eb69000 nid=0xd40 waiting for monitor entry [0x000000001f54f000]\n  java.lang.Thread.State: BLOCKED (on object monitor)\n#\u200b\u7701\u7565\u200b\n\nFound one Java-level deadlock:\n===================================================\n\"Thread-1\":\n    waiting to lock monitor 0x000000000361d378 (object 0x000000076b5bf1c0, a java.lang.Object),\n    which is held by \"Thread-0\"\n\"Thread-0\":\n    waiting to lock monitor 0x000000000361e768 (object 0x000000076b5bf1d0, a java.lang.Object),\n    which is held by \"Thread-1\"\n\nJava stack information for the threads listed above:\n===================================================\n\"Thread-1\":\n    at thread.TestDeadLock.lambda$main$1(TestDeadLock.java:28)\n    - waiting to lock &lt;0x000000076b5bf1c0&gt; (a java.lang.Object)\n    - locked &lt;0x000000076b5bf1d0&gt; (a java.lang.Object)\n    at thread.TestDeadLock$$Lambda$2/883049899.run(Unknown Source)\n    at java.lang.Thread.run(Thread.java:745)\n\"Thread-0\":\n    at thread.TestDeadLock.lambda$main$0(TestDeadLock.java:15)\n    - waiting to lock &lt;0x000000076b5bf1d0&gt; (a java.lang.Object)\n    - locked &lt;0x000000076b5bf1c0&gt; (a java.lang.Object)\n    at thread.TestDeadLock$$Lambda$1/495053715\n</code></pre> <ul> <li>Linux \u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b top \u200b\u5148\u200b\u5b9a\u4f4d\u200b\u5230\u200b CPU \u200b\u5360\u7528\u200b\u9ad8\u200b\u7684\u200b Java \u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u518d\u200b\u5229\u7528\u200b <code>top -Hp \u200b\u8fdb\u7a0b\u200bid</code> \u200b\u6765\u200b\u5b9a\u4f4d\u200b\u662f\u200b\u54ea\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u7528\u200b jstack \u200b\u7684\u200b\u8f93\u51fa\u200b\u6765\u770b\u200b\u5404\u4e2a\u200b\u7ebf\u7a0b\u200b\u6808\u200b <li>\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\uff1a\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\u8981\u200b\u6ce8\u610f\u200b\u52a0\u9501\u200b\u987a\u5e8f\u200b</li> <li>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b jconsole \u200b\u5de5\u5177\u200b\uff0c\u200b\u5728\u200b <code>jdk\\bin</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b</li>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_38","title":"\u6d3b\u9501","text":"<p>\u200b\u6d3b\u9501\u200b\uff1a\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u4efb\u52a1\u200b\u6216\u8005\u200b\u6267\u884c\u8005\u200b\u6ca1\u6709\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u7531\u4e8e\u200b\u67d0\u4e9b\u200b\u6761\u4ef6\u200b\u6ca1\u6709\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e00\u76f4\u200b\u91cd\u590d\u200b\u5c1d\u8bd5\u200b\u2014\u200b\u5931\u8d25\u200b\u2014\u200b\u5c1d\u8bd5\u200b\u2014\u200b\u5931\u8d25\u200b\u7684\u200b\u8fc7\u7a0b\u200b</p> <p>\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e92\u76f8\u200b\u6539\u53d8\u200b\u5bf9\u65b9\u200b\u7684\u200b\u7ed3\u675f\u200b\u6761\u4ef6\u200b\uff0c\u200b\u6700\u540e\u200b\u8c01\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u7ed3\u675f\u200b\uff1a</p> Java<pre><code>class TestLiveLock {\n    static volatile int count = 10;\n    static final Object lock = new Object();\n    public static void main(String[] args) {\n        new Thread(() -&gt; {\n            // \u200b\u671f\u671b\u200b\u51cf\u200b\u5230\u200b 0 \u200b\u9000\u51fa\u200b\u5faa\u73af\u200b\n            while (count &gt; 0) {\n                Thread.sleep(200);\n                count--;\n                System.out.println(\"\u200b\u7ebf\u7a0b\u200b\u4e00\u200bcount:\" + count);\n            }\n        }, \"t1\").start();\n        new Thread(() -&gt; {\n            // \u200b\u671f\u671b\u200b\u8d85\u8fc7\u200b 20 \u200b\u9000\u51fa\u200b\u5faa\u73af\u200b\n            while (count &lt; 20) {\n                Thread.sleep(200);\n                count++;\n                System.out.println(\"\u200b\u7ebf\u7a0b\u200b\u4e8c\u200bcount:\"+ count);\n            }\n        }, \"t2\").start();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_39","title":"\u9965\u997f","text":"<p>\u200b\u9965\u997f\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7531\u4e8e\u200b\u4f18\u5148\u7ea7\u200b\u592a\u4f4e\u200b\uff0c\u200b\u59cb\u7ec8\u200b\u5f97\u4e0d\u5230\u200b CPU \u200b\u8c03\u5ea6\u200b\u6267\u884c\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u80fd\u591f\u200b\u7ed3\u675f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#wait-ify","title":"wait-ify","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_40","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\u5bf9\u8c61\u200b\u9501\u540e\u200b\u624d\u200b\u53ef\u4ee5\u200b\u8c03\u7528\u200b <code>\u200b\u9501\u200b\u5bf9\u8c61\u200b.wait()</code>\uff0cnotify \u200b\u968f\u673a\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0cnotifyAll \u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u7ade\u4e89\u200b CPU</p> <p>Object \u200b\u7c7b\u200b API\uff1a</p> Java<pre><code>public final void notify():\u200b\u5524\u9192\u200b\u6b63\u5728\u200b\u7b49\u5f85\u200b\u5bf9\u8c61\u200b\u76d1\u89c6\u5668\u200b\u7684\u200b\u5355\u4e2a\u200b\u7ebf\u7a0b\u200b\u3002\npublic final void notifyAll():\u200b\u5524\u9192\u200b\u6b63\u5728\u200b\u7b49\u5f85\u200b\u5bf9\u8c61\u200b\u76d1\u89c6\u5668\u200b\u7684\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u3002\npublic final void wait():\u200b\u5bfc\u81f4\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\uff0c\u200b\u76f4\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u7684\u200b notify() \u200b\u65b9\u6cd5\u200b\u6216\u200b notifyAll()\u200b\u65b9\u6cd5\u200b\u3002\npublic final native void wait(long timeout):\u200b\u6709\u200b\u65f6\u9650\u200b\u7684\u200b\u7b49\u5f85\u200b, \u200b\u5230\u200bn\u200b\u6beb\u79d2\u200b\u540e\u200b\u7ed3\u675f\u200b\u7b49\u5f85\u200b\uff0c\u200b\u6216\u662f\u200b\u88ab\u200b\u5524\u9192\u200b\n</code></pre> <p>\u200b\u8bf4\u660e\u200b\uff1await \u200b\u662f\u200b\u6302\u200b\u8d77\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u9700\u8981\u200b\u5524\u9192\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6302\u200b\u8d77\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u81ea\u5df1\u200b\u53bb\u200b\u4e89\u62a2\u200b\u9501\u200b\uff0c\u200b\u6302\u200b\u8d77\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u5524\u9192\u200b\u540e\u200b\u53bb\u200b\u4e89\u62a2\u200b\u9501\u200b</p> <p>\u200b\u5bf9\u6bd4\u200b sleep()\uff1a</p> <ul> <li>\u200b\u539f\u7406\u200b\u4e0d\u540c\u200b\uff1asleep() \u200b\u65b9\u6cd5\u200b\u662f\u200b\u5c5e\u4e8e\u200b Thread \u200b\u7c7b\u200b\uff0c\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u7528\u6765\u200b\u63a7\u5236\u200b\u81ea\u8eab\u200b\u6d41\u7a0b\u200b\u7684\u200b\uff0c\u200b\u4f7f\u6b64\u200b\u7ebf\u7a0b\u200b\u6682\u505c\u200b\u6267\u884c\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u800c\u200b\u628a\u200b\u6267\u884c\u200b\u673a\u4f1a\u200b\u8ba9\u7ed9\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\uff1bwait() \u200b\u65b9\u6cd5\u200b\u5c5e\u4e8e\u200b Object \u200b\u7c7b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7ebf\u7a0b\u200b\u95f4\u901a\u4fe1\u200b</li> <li>\u200b\u5bf9\u9501\u200b\u7684\u200b\u5904\u7406\u200b\u673a\u5236\u200b\u4e0d\u540c\u200b\uff1a\u200b\u8c03\u7528\u200b sleep() \u200b\u65b9\u6cd5\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u91ca\u653e\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff0c\u200b\u5f53\u200b\u8c03\u7528\u200b wait() \u200b\u65b9\u6cd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u653e\u5f03\u200b\u5bf9\u8c61\u200b\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200b\u7b49\u5f85\u200b\u6b64\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7b49\u5f85\u200b\u9501\u5b9a\u200b\u6c60\u200b\uff08\u200b\u4e0d\u200b\u91ca\u653e\u200b\u9501\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u600e\u4e48\u200b\u62a2\u5360\u200b\u5230\u200b\u9501\u200b\u6267\u884c\u200b\u5524\u9192\u200b\u64cd\u4f5c\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u90fd\u200b\u4f1a\u200b\u91ca\u653e\u200b CPU</li> <li>\u200b\u4f7f\u7528\u200b\u533a\u57df\u200b\u4e0d\u540c\u200b\uff1await() \u200b\u65b9\u6cd5\u200b\u5fc5\u987b\u200b\u653e\u5728\u200b\u540c\u6b65\u63a7\u5236\u200b\u65b9\u6cd5\u200b\u548c\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\uff08\u200b\u5148\u200b\u83b7\u53d6\u200b\u9501\u200b\uff09\u200b\u4e2d\u200b\u4f7f\u7528\u200b\uff0csleep() \u200b\u65b9\u6cd5\u200b\u5219\u200b\u53ef\u4ee5\u200b\u653e\u5728\u200b\u4efb\u4f55\u200b\u5730\u65b9\u200b\u4f7f\u7528\u200b</li> </ul> <p>\u200b\u5e95\u5c42\u200b\u539f\u7406\u200b\uff1a</p> <ul> <li>Owner \u200b\u7ebf\u7a0b\u200b\u53d1\u73b0\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u8c03\u7528\u200b wait \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5373\u53ef\u200b\u8fdb\u5165\u200b WaitSet \u200b\u53d8\u4e3a\u200b WAITING \u200b\u72b6\u6001\u200b</li> <li>BLOCKED \u200b\u548c\u200b WAITING \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u5904\u4e8e\u200b\u963b\u585e\u72b6\u6001\u200b\uff0c\u200b\u4e0d\u200b\u5360\u7528\u200b CPU \u200b\u65f6\u95f4\u200b\u7247\u200b</li> <li>BLOCKED \u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u5728\u200b Owner \u200b\u7ebf\u7a0b\u200b\u91ca\u653e\u200b\u9501\u65f6\u200b\u5524\u9192\u200b</li> <li>WAITING \u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u5728\u200b Owner \u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b notify \u200b\u6216\u200b notifyAll \u200b\u65f6\u200b\u5524\u9192\u200b\uff0c\u200b\u5524\u9192\u200b\u540e\u200b\u5e76\u200b\u4e0d\u200b\u610f\u5473\u200b\u8005\u200b\u7acb\u523b\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0c\u200b\u9700\u8981\u200b\u8fdb\u5165\u200b EntryList \u200b\u91cd\u65b0\u200b\u7ade\u4e89\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_41","title":"\u4ee3\u7801\u4f18\u5316","text":"<p>\u200b\u865a\u5047\u200b\u5524\u9192\u200b\uff1anotify \u200b\u53ea\u80fd\u200b\u968f\u673a\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b WaitSet \u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u5982\u679c\u200b\u6709\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u5728\u200b\u7b49\u5f85\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u80fd\u200b\u5524\u9192\u200b\u4e0d\u4e86\u200b\u6b63\u786e\u200b\u7684\u200b\u7ebf\u7a0b\u200b</p> <p>\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u91c7\u7528\u200b notifyAll</p> <p>notifyAll \u200b\u4ec5\u200b\u89e3\u51b3\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5524\u9192\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f7f\u7528\u200b if + wait \u200b\u5224\u65ad\u200b\u4ec5\u200b\u6709\u200b\u4e00\u6b21\u200b\u673a\u4f1a\u200b\uff0c\u200b\u4e00\u65e6\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6210\u7acb\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u91cd\u65b0\u200b\u5224\u65ad\u200b</p> <p>\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u7528\u200b while + wait\uff0c\u200b\u5f53\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6210\u7acb\u200b\uff0c\u200b\u518d\u6b21\u200b wait</p> Java<pre><code>@Slf4j(topic = \"c.demo\")\npublic class demo {\n    static final Object room = new Object();\n    static boolean hasCigarette = false;    //\u200b\u6709\u6ca1\u6709\u200b\u70df\u200b\n    static boolean hasTakeout = false;\n\n    public static void main(String[] args) throws InterruptedException {\n        new Thread(() -&gt; {\n            synchronized (room) {\n                log.debug(\"\u200b\u6709\u70df\u200b\u6ca1\u200b\uff1f[{}]\", hasCigarette);\n                while (!hasCigarette) {//while\u200b\u9632\u6b62\u200b\u865a\u5047\u200b\u5524\u9192\u200b\n                    log.debug(\"\u200b\u6ca1\u70df\u200b\uff0c\u200b\u5148\u6b47\u4f1a\u200b\uff01\");\n                    try {\n                        room.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                log.debug(\"\u200b\u6709\u70df\u200b\u6ca1\u200b\uff1f[{}]\", hasCigarette);\n                if (hasCigarette) {\n                    log.debug(\"\u200b\u53ef\u4ee5\u200b\u5f00\u59cb\u200b\u5e72\u6d3b\u200b\u4e86\u200b\");\n                } else {\n                    log.debug(\"\u200b\u6ca1\u5e72\u200b\u6210\u6d3b\u200b...\");\n                }\n            }\n        }, \"\u200b\u5c0f\u5357\u200b\").start();\n\n        new Thread(() -&gt; {\n            synchronized (room) {\n                Thread thread = Thread.currentThread();\n                log.debug(\"\u200b\u5916\u5356\u200b\u9001\u5230\u200b\u6ca1\u200b\uff1f[{}]\", hasTakeout);\n                if (!hasTakeout) {\n                    log.debug(\"\u200b\u6ca1\u200b\u5916\u5356\u200b\uff0c\u200b\u5148\u6b47\u4f1a\u200b\uff01\");\n                    try {\n                        room.wait();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                log.debug(\"\u200b\u5916\u5356\u200b\u9001\u5230\u200b\u6ca1\u200b\uff1f[{}]\", hasTakeout);\n                if (hasTakeout) {\n                    log.debug(\"\u200b\u53ef\u4ee5\u200b\u5f00\u59cb\u200b\u5e72\u6d3b\u200b\u4e86\u200b\");\n                } else {\n                    log.debug(\"\u200b\u6ca1\u5e72\u200b\u6210\u6d3b\u200b...\");\n                }\n            }\n        }, \"\u200b\u5c0f\u5973\u200b\").start();\n\n\n        Thread.sleep(1000);\n        new Thread(() -&gt; {\n        // \u200b\u8fd9\u91cc\u200b\u80fd\u200b\u4e0d\u80fd\u200b\u52a0\u200b synchronized (room)\uff1f\n            synchronized (room) {\n                hasTakeout = true;\n                //log.debug(\"\u200b\u70df\u5230\u200b\u4e86\u200b\u5662\u200b\uff01\");\n                log.debug(\"\u200b\u5916\u5356\u200b\u5230\u200b\u4e86\u200b\u5662\u200b\uff01\");\n                room.notifyAll();\n            }\n        }, \"\u200b\u9001\u200b\u5916\u5356\u200b\u7684\u200b\").start();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#park-un","title":"park-un","text":"<p>LockSupport \u200b\u662f\u200b\u7528\u6765\u200b\u521b\u5efa\u200b\u9501\u200b\u548c\u200b\u5176\u4ed6\u200b\u540c\u6b65\u200b\u7c7b\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u539f\u8bed\u200b</p> <p>LockSupport \u200b\u7c7b\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>LockSupport.park()</code>\uff1a\u200b\u6682\u505c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6302\u200b\u8d77\u200b\u539f\u8bed\u200b</li> <li><code>LockSupport.unpark(\u200b\u6682\u505c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b)</code>\uff1a\u200b\u6062\u590d\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8fd0\u884c\u200b</li> </ul> Java<pre><code>public static void main(String[] args) {\n    Thread t1 = new Thread(() -&gt; {\n        System.out.println(\"start...\"); //1\n        Thread.sleep(1000);// Thread.sleep(3000)\n        // \u200b\u5148\u200b park \u200b\u518d\u200b unpark \u200b\u548c\u200b\u5148\u200b unpark \u200b\u518d\u200b park \u200b\u6548\u679c\u200b\u4e00\u6837\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u6062\u590d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8fd0\u884c\u200b\n        System.out.println(\"park...\");  //2\n        LockSupport.park();\n        System.out.println(\"resume...\");//4\n    },\"t1\");\n    t1.start();\n    Thread.sleep(2000);\n    System.out.println(\"unpark...\");    //3\n    LockSupport.unpark(t1);\n}\n</code></pre> <p>LockSupport \u200b\u51fa\u73b0\u200b\u5c31\u662f\u200b\u4e3a\u4e86\u200b\u589e\u5f3a\u200b wait &amp; notify \u200b\u7684\u200b\u529f\u80fd\u200b\uff1a</p> <ul> <li>wait\uff0cnotify \u200b\u548c\u200b notifyAll \u200b\u5fc5\u987b\u200b\u914d\u5408\u200b Object Monitor \u200b\u4e00\u8d77\u200b\u4f7f\u7528\u200b\uff0c\u200b\u800c\u200b park\u3001unpark \u200b\u4e0d\u200b\u9700\u8981\u200b</li> <li>park &amp; unpark \u200b\u4ee5\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u6765\u200b\u963b\u585e\u200b\u548c\u200b\u5524\u9192\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u800c\u200b notify \u200b\u53ea\u80fd\u200b\u968f\u673a\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\uff0cnotifyAll \u200b\u662f\u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b</li> <li>park &amp; unpark \u200b\u53ef\u4ee5\u200b\u5148\u200b unpark\uff0c\u200b\u800c\u200b wait &amp; notify \u200b\u4e0d\u80fd\u200b\u5148\u200b notify\u3002\u200b\u7c7b\u6bd4\u200b\u751f\u4ea7\u200b\u6d88\u8d39\u200b\uff0c\u200b\u5148\u200b\u6d88\u8d39\u200b\u53d1\u73b0\u200b\u6709\u200b\u4ea7\u54c1\u200b\u5c31\u200b\u6d88\u8d39\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5c31\u200b\u7b49\u5f85\u200b\uff1b\u200b\u5148\u200b\u751f\u4ea7\u200b\u5c31\u200b\u76f4\u63a5\u200b\u4ea7\u751f\u200b\u5546\u54c1\u200b\uff0c\u200b\u7136\u540e\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u6d88\u8d39\u200b</li> <li>wait \u200b\u4f1a\u200b\u91ca\u653e\u200b\u9501\u200b\u8d44\u6e90\u200b\u8fdb\u5165\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0cpark \u200b\u4e0d\u4f1a\u200b\u91ca\u653e\u200b\u9501\u200b\u8d44\u6e90\u200b\uff0c\u200b\u53ea\u200b\u8d1f\u8d23\u200b\u963b\u585e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4f1a\u200b\u91ca\u653e\u200b CPU</li> </ul> <p>\u200b\u539f\u7406\u200b\uff1a\u200b\u7c7b\u4f3c\u200b\u751f\u4ea7\u8005\u200b\u6d88\u8d39\u8005\u200b</p> <ul> <li>\u200b\u5148\u200b park\uff1a</li> <li>\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b Unsafe.park() \u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u68c0\u67e5\u200b _counter \uff0c\u200b\u672c\u200b\u60c5\u51b5\u200b\u4e3a\u200b 0\uff0c\u200b\u8fd9\u65f6\u200b\u83b7\u5f97\u200b _mutex \u200b\u4e92\u65a5\u200b\u9501\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b _cond \u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\u6302\u200b\u8d77\u200b</li> <li>\u200b\u8c03\u7528\u200b Unsafe.unpark(Thread_0) \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8bbe\u7f6e\u200b _counter \u200b\u4e3a\u200b 1</li> <li>\u200b\u5524\u9192\u200b _cond \u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\u4e2d\u200b\u7684\u200b Thread_0\uff0cThread_0 \u200b\u6062\u590d\u200b\u8fd0\u884c\u200b\uff0c\u200b\u8bbe\u7f6e\u200b _counter \u200b\u4e3a\u200b 0</li> </ul> <p></p> <ul> <li> <p>\u200b\u5148\u200b unpark\uff1a</p> </li> <li> <p>\u200b\u8c03\u7528\u200b Unsafe.unpark(Thread_0) \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8bbe\u7f6e\u200b _counter \u200b\u4e3a\u200b 1</p> </li> <li>\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b Unsafe.park() \u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u68c0\u67e5\u200b _counter \uff0c\u200b\u672c\u200b\u60c5\u51b5\u200b\u4e3a\u200b 1\uff0c\u200b\u8fd9\u65f6\u200b\u7ebf\u7a0b\u200b\u65e0\u9700\u200b\u6302\u200b\u8d77\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u8fd0\u884c\u200b\uff0c\u200b\u8bbe\u7f6e\u200b _counter \u200b\u4e3a\u200b 0</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_42","title":"\u5b89\u5168\u200b\u5206\u6790","text":"<p>\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\u548c\u200b\u9759\u6001\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b\u5b83\u4eec\u200b\u6ca1\u6709\u200b\u5171\u4eab\u200b\uff0c\u200b\u5219\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b</li> <li>\u200b\u5982\u679c\u200b\u5b83\u4eec\u200b\u88ab\u200b\u5171\u4eab\u200b\u4e86\u200b\uff0c\u200b\u6839\u636e\u200b\u5b83\u4eec\u200b\u7684\u200b\u72b6\u6001\u200b\u662f\u5426\u200b\u80fd\u591f\u200b\u6539\u53d8\u200b\uff0c\u200b\u5206\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff1a</li> <li>\u200b\u5982\u679c\u200b\u53ea\u6709\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5219\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b</li> <li>\u200b\u5982\u679c\u200b\u6709\u200b\u8bfb\u5199\u64cd\u4f5c\u200b\uff0c\u200b\u5219\u200b\u8fd9\u6bb5\u200b\u4ee3\u7801\u200b\u662f\u200b\u4e34\u754c\u200b\u533a\u200b\uff0c\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</li> </ul> <p>\u200b\u5c40\u90e8\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b</li> <li>\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u5f15\u7528\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff08\u200b\u9003\u9038\u200b\u5206\u6790\u200b\uff09\uff1a</li> <li>\u200b\u5982\u679c\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u6ca1\u6709\u200b\u9003\u79bb\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4f5c\u7528\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff08\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6808\u5e27\u200b\uff09</li> <li>\u200b\u5982\u679c\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u9003\u79bb\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4f5c\u7528\u200b\u8303\u56f4\u200b\uff0c\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff08\u200b\u66b4\u9732\u200b\u5f15\u7528\u200b\uff09</li> </ul> <p>\u200b\u5e38\u89c1\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u7c7b\u200b\uff1aString\u3001Integer\u3001StringBuffer\u3001Random\u3001Vector\u3001Hashtable\u3001java.util.concurrent \u200b\u5305\u200b</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u662f\u200b\u6307\u200b\uff0c\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b\u5b83\u4eec\u200b\u540c\u4e00\u4e2a\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u67d0\u4e2a\u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b</li> <li>\u200b\u6bcf\u4e2a\u200b\u65b9\u6cd5\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u591a\u4e2a\u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ec4\u5408\u200b\u4e0d\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\uff0c\u200b\u53ea\u80fd\u200b\u4fdd\u8bc1\u200b\u8c03\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5185\u90e8\u200b\u5b89\u5168\u200b\uff1a</li> </ul> Java<pre><code>Hashtable table = new Hashtable();\n// \u200b\u7ebf\u7a0b\u200b1\uff0c\u200b\u7ebf\u7a0b\u200b2\nif(table.get(\"key\") == null) {\n  table.put(\"key\", value);\n}\n</code></pre> <p>\u200b\u65e0\u200b\u72b6\u6001\u200b\u7c7b\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\u7684\u200b\u7c7b\u200b</p> <p>\u200b\u4e0d\u53ef\u200b\u53d8\u7c7b\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff1aString\u3001Integer \u200b\u7b49\u200b\u90fd\u200b\u662f\u200b\u4e0d\u53ef\u200b\u53d8\u7c7b\u200b\uff0c\u200b\u5185\u90e8\u200b\u7684\u200b\u72b6\u6001\u200b\u4e0d\u200b\u53ef\u4ee5\u200b\u6539\u53d8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65b9\u6cd5\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b</p> <ul> <li>replace \u200b\u7b49\u200b\u65b9\u6cd5\u200b\u5e95\u5c42\u200b\u662f\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u590d\u5236\u200b\u8fc7\u53bb\u200b</li> </ul> Java<pre><code>Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); // \u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\nString S1 = \"...\";                            // \u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\nfinal String S2 = \"...\";                  // \u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\nDate D1 = new Date();                     // \u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\nfinal Date D2 = new Date();                   // \u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\uff0cfinal\u200b\u8ba9\u200bD2\u200b\u5f15\u7528\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e0d\u80fd\u200b\u53d8\u200b\uff0c\u200b\u4f46\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5185\u5bb9\u200b\u53ef\u4ee5\u200b\u53d8\u200b\n</code></pre> <p>\u200b\u62bd\u8c61\u200b\u65b9\u6cd5\u200b\u5982\u679c\u200b\u6709\u200b\u53c2\u6570\u200b\uff0c\u200b\u88ab\u200b\u91cd\u5199\u200b\u540e\u200b\u884c\u4e3a\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u53ef\u80fd\u200b\u9020\u6210\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\uff0c\u200b\u88ab\u200b\u79f0\u4e4b\u4e3a\u200b\u5916\u661f\u200b\u65b9\u6cd5\u200b\uff1a<code>public abstract foo(Student s);</code></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_43","title":"\u540c\u6b65\u200b\u6a21\u5f0f","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_44","title":"\u4fdd\u62a4\u6027\u200b\u6682\u505c","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_45","title":"\u5355\u4efb\u52a1\u200b\u7248","text":"<p>Guarded Suspension\uff0c\u200b\u7528\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b</p> <ul> <li>\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ed3\u679c\u200b\u9700\u8981\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f20\u9012\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u4eec\u200b\u5173\u8054\u200b\u540c\u4e00\u4e2a\u200b GuardedObject</li> <li>\u200b\u5982\u679c\u200b\u6709\u200b\u7ed3\u679c\u200b\u4e0d\u65ad\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\uff08\u200b\u89c1\u200b\u751f\u4ea7\u8005\u200b/\u200b\u6d88\u8d39\u8005\u200b\uff09</li> <li>JDK \u200b\u4e2d\u200b\uff0cjoin \u200b\u7684\u200b\u5b9e\u73b0\u200b\u3001Future \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u91c7\u7528\u200b\u7684\u200b\u5c31\u662f\u200b\u6b64\u200b\u6a21\u5f0f\u200b</li> </ul> <p></p> Java<pre><code>public static void main(String[] args) {\n    GuardedObject object = new GuardedObjectV2();\n    new Thread(() -&gt; {\n        sleep(1);\n        object.complete(Arrays.asList(\"a\", \"b\", \"c\"));\n    }).start();\n\n    Object response = object.get(2500);\n    if (response != null) {\n        log.debug(\"get response: [{}] lines\", ((List&lt;String&gt;) response).size());\n    } else {\n        log.debug(\"can't get response\");\n    }\n}\n\nclass GuardedObject {\n    private Object response;\n    private final Object lock = new Object();\n\n    //\u200b\u83b7\u53d6\u200b\u7ed3\u679c\u200b\n    //timeout :\u200b\u6700\u5927\u200b\u7b49\u5f85\u65f6\u95f4\u200b\n    public Object get(long millis) {\n        synchronized (lock) {\n            // 1) \u200b\u8bb0\u5f55\u200b\u6700\u521d\u200b\u65f6\u95f4\u200b\n            long begin = System.currentTimeMillis();\n            // 2) \u200b\u5df2\u7ecf\u200b\u7ecf\u5386\u200b\u7684\u200b\u65f6\u95f4\u200b\n            long timePassed = 0;\n            while (response == null) {\n                // 4) \u200b\u5047\u8bbe\u200b millis \u200b\u662f\u200b 1000\uff0c\u200b\u7ed3\u679c\u200b\u5728\u200b 400 \u200b\u65f6\u200b\u5524\u9192\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd8\u6709\u200b 600 \u200b\u8981\u200b\u7b49\u200b\n                long waitTime = millis - timePassed;\n                log.debug(\"waitTime: {}\", waitTime);\n                //\u200b\u7ecf\u5386\u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b\u6700\u5927\u200b\u7b49\u5f85\u65f6\u95f4\u200b\u9000\u51fa\u200b\u5faa\u73af\u200b\n                if (waitTime &lt;= 0) {\n                    log.debug(\"break...\");\n                    break;\n                }\n                try {\n                    lock.wait(waitTime);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                // 3) \u200b\u5982\u679c\u200b\u63d0\u524d\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u5df2\u7ecf\u200b\u7ecf\u5386\u200b\u7684\u200b\u65f6\u95f4\u200b\u5047\u8bbe\u200b\u4e3a\u200b 400\n                timePassed = System.currentTimeMillis() - begin;\n                log.debug(\"timePassed: {}, object is null {}\",\n                        timePassed, response == null);\n            }\n            return response;\n        }\n    }\n\n    //\u200b\u4ea7\u751f\u200b\u7ed3\u679c\u200b\n    public void complete(Object response) {\n        synchronized (lock) {\n            // \u200b\u6761\u4ef6\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u901a\u77e5\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\n            this.response = response;\n            log.debug(\"notify...\");\n            lock.notifyAll();\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_46","title":"\u591a\u4efb\u52a1\u200b\u7248","text":"<p>\u200b\u591a\u4efb\u52a1\u200b\u7248\u200b\u4fdd\u62a4\u6027\u200b\u6682\u505c\u200b\uff1a</p> <p></p> Java<pre><code>public static void main(String[] args) throws InterruptedException {\n    for (int i = 0; i &lt; 3; i++) {\n        new People().start();\n    }\n    Thread.sleep(1000);\n    for (Integer id : Mailboxes.getIds()) {\n        new Postman(id, id + \"\u200b\u53f7\u200b\u5feb\u9012\u200b\u5230\u200b\u4e86\u200b\").start();\n    }\n}\n\n@Slf4j(topic = \"c.People\")\nclass People extends Thread{\n    @Override\n    public void run() {\n        // \u200b\u6536\u4fe1\u200b\n        GuardedObject guardedObject = Mailboxes.createGuardedObject();\n        log.debug(\"\u200b\u5f00\u59cb\u200b\u6536\u4fe1\u200bi d:{}\", guardedObject.getId());\n        Object mail = guardedObject.get(5000);\n        log.debug(\"\u200b\u6536\u5230\u200b\u4fe1\u200bid:{}\uff0c\u200b\u5185\u5bb9\u200b:{}\", guardedObject.getId(),mail);\n    }\n}\n\nclass Postman extends Thread{\n    private int id;\n    private String mail;\n    //\u200b\u6784\u9020\u65b9\u6cd5\u200b\n    @Override\n    public void run() {\n        GuardedObject guardedObject = Mailboxes.getGuardedObject(id);\n        log.debug(\"\u200b\u5f00\u59cb\u200b\u9001\u4fe1\u200bi d:{}\uff0c\u200b\u5185\u5bb9\u200b:{}\", guardedObject.getId(),mail);\n        guardedObject.complete(mail);\n    }\n}\n\nclass  Mailboxes {\n    private static Map&lt;Integer, GuardedObject&gt; boxes = new Hashtable&lt;&gt;();\n    private static int id = 1;\n\n    //\u200b\u4ea7\u751f\u200b\u552f\u4e00\u200b\u7684\u200bid\n    private static synchronized int generateId() {\n        return id++;\n    }\n\n    public static GuardedObject getGuardedObject(int id) {\n        return boxes.remove(id);\n    }\n\n    public static GuardedObject createGuardedObject() {\n        GuardedObject go = new GuardedObject(generateId());\n        boxes.put(go.getId(), go);\n        return go;\n    }\n\n    public static Set&lt;Integer&gt; getIds() {\n        return boxes.keySet();\n    }\n}\nclass GuardedObject {\n    //\u200b\u6807\u8bc6\u200b\uff0cGuarded Object\n    private int id;//\u200b\u6dfb\u52a0\u200bget set\u200b\u65b9\u6cd5\u200b\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_47","title":"\u987a\u5e8f\u200b\u8f93\u51fa","text":"<p>\u200b\u987a\u5e8f\u200b\u8f93\u51fa\u200b 2 1 </p> Java<pre><code>public static void main(String[] args) throws InterruptedException {\n    Thread t1 = new Thread(() -&gt; {\n        while (true) {\n            //try { Thread.sleep(1000); } catch (InterruptedException e) { }\n            // \u200b\u5f53\u200b\u6ca1\u6709\u200b\u8bb8\u53ef\u200b\u65f6\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6682\u505c\u200b\u8fd0\u884c\u200b\uff1b\u200b\u6709\u200b\u8bb8\u53ef\u200b\u65f6\u200b\uff0c\u200b\u7528\u200b\u6389\u200b\u8fd9\u4e2a\u200b\u8bb8\u53ef\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6062\u590d\u200b\u8fd0\u884c\u200b\n            LockSupport.park();\n            System.out.println(\"1\");\n        }\n    });\n    Thread t2 = new Thread(() -&gt; {\n        while (true) {\n            System.out.println(\"2\");\n            // \u200b\u7ed9\u200b\u7ebf\u7a0b\u200b t1 \u200b\u53d1\u653e\u200b\u300e\u200b\u8bb8\u53ef\u200b\u300f\uff08\u200b\u591a\u6b21\u200b\u8fde\u7eed\u200b\u8c03\u7528\u200b unpark \u200b\u53ea\u4f1a\u200b\u53d1\u653e\u200b\u4e00\u4e2a\u200b\u300e\u200b\u8bb8\u53ef\u200b\u300f\uff09\n            LockSupport.unpark(t1);\n            try { Thread.sleep(500); } catch (InterruptedException e) { }\n        }\n    });\n    t1.start();\n    t2.start();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_48","title":"\u4ea4\u66ff\u200b\u8f93\u51fa","text":"<p>\u200b\u8fde\u7eed\u200b\u8f93\u51fa\u200b 5 \u200b\u6b21\u200b abc</p> Java<pre><code>public class day2_14 {\n    public static void main(String[] args) throws InterruptedException {\n        AwaitSignal awaitSignal = new AwaitSignal(5);\n        Condition a = awaitSignal.newCondition();\n        Condition b = awaitSignal.newCondition();\n        Condition c = awaitSignal.newCondition();\n        new Thread(() -&gt; {\n            awaitSignal.print(\"a\", a, b);\n        }).start();\n        new Thread(() -&gt; {\n            awaitSignal.print(\"b\", b, c);\n        }).start();\n        new Thread(() -&gt; {\n            awaitSignal.print(\"c\", c, a);\n        }).start();\n\n        Thread.sleep(1000);\n        awaitSignal.lock();\n        try {\n            a.signal();\n        } finally {\n            awaitSignal.unlock();\n        }\n    }\n}\n\nclass AwaitSignal extends ReentrantLock {\n    private int loopNumber;\n\n    public AwaitSignal(int loopNumber) {\n        this.loopNumber = loopNumber;\n    }\n    //\u200b\u53c2\u6570\u200b1\uff1a\u200b\u6253\u5370\u200b\u5185\u5bb9\u200b  \u200b\u53c2\u6570\u200b\u4e8c\u200b\uff1a\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b  \u200b\u53c2\u6570\u200b\u4e8c\u200b\uff1a\u200b\u5524\u9192\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\n    public void print(String str, Condition condition, Condition next) {\n        for (int i = 0; i &lt; loopNumber; i++) {\n            lock();\n            try {\n                condition.await();\n                System.out.print(str);\n                next.signal();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                unlock();\n            }\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_49","title":"\u5f02\u6b65\u200b\u6a21\u5f0f","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_50","title":"\u4f20\u7edf\u200b\u7248","text":"<p>\u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\u4e4b\u200b\u751f\u4ea7\u8005\u200b/\u200b\u6d88\u8d39\u8005\u200b\uff1a</p> Java<pre><code>class ShareData {\n    private int number = 0;\n    private Lock lock = new ReentrantLock();\n    private Condition condition = lock.newCondition();\n\n    public void increment() throws Exception{\n        // \u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\uff0c\u200b\u52a0\u9501\u200b\n        lock.lock();\n        try {\n            // \u200b\u5224\u65ad\u200b  \u200b\u9632\u6b62\u200b\u865a\u5047\u200b\u5524\u9192\u200b\n            while(number != 0) {\n                // \u200b\u7b49\u5f85\u200b\u4e0d\u80fd\u200b\u751f\u4ea7\u200b\n                condition.await();\n            }\n            // \u200b\u5e72\u6d3b\u200b\n            number++;\n            System.out.println(Thread.currentThread().getName() + \"\\t \" + number);\n            // \u200b\u901a\u77e5\u200b \u200b\u5524\u9192\u200b\n            condition.signalAll();\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void decrement() throws Exception{\n        // \u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\uff0c\u200b\u52a0\u9501\u200b\n        lock.lock();\n        try {\n            // \u200b\u5224\u65ad\u200b \u200b\u9632\u6b62\u200b\u865a\u5047\u200b\u5524\u9192\u200b\n            while(number == 0) {\n                // \u200b\u7b49\u5f85\u200b\u4e0d\u80fd\u200b\u6d88\u8d39\u200b\n                condition.await();\n            }\n            // \u200b\u5e72\u6d3b\u200b\n            number--;\n            System.out.println(Thread.currentThread().getName() + \"\\t \" + number);\n            // \u200b\u901a\u77e5\u200b \u200b\u5524\u9192\u200b\n            condition.signalAll();\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n\npublic class TraditionalProducerConsumer {\n    public static void main(String[] args) {\n        ShareData shareData = new ShareData();\n        // t1\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u751f\u4ea7\u200b\n        new Thread(() -&gt; {\n            for (int i = 0; i &lt; 5; i++) {\n                shareData.increment();\n            }\n        }, \"t1\").start();\n\n        // t2\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6d88\u8d39\u200b\n        new Thread(() -&gt; {\n            for (int i = 0; i &lt; 5; i++) {\n                shareData.decrement();\n            }\n        }, \"t2\").start(); \n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_51","title":"\u6539\u8fdb\u7248","text":"<p>\u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\u4e4b\u200b\u751f\u4ea7\u8005\u200b/\u200b\u6d88\u8d39\u8005\u200b\uff1a</p> <ul> <li>\u200b\u6d88\u8d39\u200b\u961f\u5217\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5e73\u8861\u200b\u751f\u4ea7\u200b\u548c\u200b\u6d88\u8d39\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8d44\u6e90\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4ea7\u751f\u200b\u7ed3\u679c\u200b\u548c\u200b\u6d88\u8d39\u200b\u7ed3\u679c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e00\u4e00\u5bf9\u5e94\u200b</li> <li>\u200b\u751f\u4ea7\u8005\u200b\u4ec5\u200b\u8d1f\u8d23\u200b\u4ea7\u751f\u200b\u7ed3\u679c\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u5173\u5fc3\u200b\u6570\u636e\u200b\u8be5\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\uff0c\u200b\u800c\u200b\u6d88\u8d39\u8005\u200b\u4e13\u5fc3\u200b\u5904\u7406\u7ed3\u679c\u200b\u6570\u636e\u200b</li> <li>\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u662f\u200b\u6709\u200b\u5bb9\u91cf\u200b\u9650\u5236\u200b\u7684\u200b\uff0c\u200b\u6ee1\u65f6\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u52a0\u5165\u200b\u6570\u636e\u200b\uff0c\u200b\u7a7a\u65f6\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u6d88\u8017\u200b\u6570\u636e\u200b</li> <li>JDK \u200b\u4e2d\u200b\u5404\u79cd\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u91c7\u7528\u200b\u7684\u200b\u5c31\u662f\u200b\u8fd9\u79cd\u200b\u6a21\u5f0f\u200b</li> </ul> <p></p> Java<pre><code>public class demo {\n    public static void main(String[] args) {\n        MessageQueue queue = new MessageQueue(2);\n        for (int i = 0; i &lt; 3; i++) {\n            int id = i;\n            new Thread(() -&gt; {\n                queue.put(new Message(id,\"\u200b\u503c\u200b\"+id));\n            }, \"\u200b\u751f\u4ea7\u8005\u200b\" + i).start();\n        }\n\n        new Thread(() -&gt; {\n            while (true) {\n                try {\n                    Thread.sleep(1000);\n                    Message message = queue.take();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        },\"\u200b\u6d88\u8d39\u8005\u200b\").start();\n    }\n}\n\n//\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u7c7b\u200b\uff0cJava\u200b\u95f4\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u901a\u4fe1\u200b\nclass MessageQueue {\n    private LinkedList&lt;Message&gt; list = new LinkedList&lt;&gt;();//\u200b\u6d88\u606f\u200b\u7684\u200b\u961f\u5217\u200b\u96c6\u5408\u200b\n    private int capacity;//\u200b\u961f\u5217\u200b\u5bb9\u91cf\u200b\n    public MessageQueue(int capacity) {\n        this.capacity = capacity;\n    }\n\n    //\u200b\u83b7\u53d6\u200b\u6d88\u606f\u200b\n    public Message take() {\n        //\u200b\u68c0\u67e5\u200b\u961f\u5217\u200b\u662f\u5426\u200b\u4e3a\u7a7a\u200b\n        synchronized (list) {\n            while (list.isEmpty()) {\n                try {\n                    sout(Thread.currentThread().getName() + \":\u200b\u961f\u200b\u5217\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\");\n                    list.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            //\u200b\u4ece\u200b\u961f\u5217\u200b\u7684\u200b\u5934\u90e8\u200b\u83b7\u53d6\u200b\u6d88\u606f\u200b\u8fd4\u56de\u200b\n            Message message = list.removeFirst();\n            sout(Thread.currentThread().getName() + \"\uff1a\u200b\u5df2\u200b\u6d88\u8d39\u200b\u6d88\u606f\u200b--\" + message);\n            list.notifyAll();\n            return message;\n        }\n    }\n\n    //\u200b\u5b58\u5165\u200b\u6d88\u606f\u200b\n    public void put(Message message) {\n        synchronized (list) {\n            //\u200b\u68c0\u67e5\u200b\u961f\u5217\u200b\u662f\u5426\u200b\u6ee1\u200b\n            while (list.size() == capacity) {\n                try {\n                    sout(Thread.currentThread().getName()+\":\u200b\u961f\u200b\u5217\u4e3a\u200b\u5df2\u6ee1\u200b\uff0c\u200b\u751f\u4ea7\u8005\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\");\n                    list.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            //\u200b\u5c06\u200b\u6d88\u606f\u200b\u52a0\u5165\u200b\u961f\u5217\u200b\u5c3e\u90e8\u200b\n            list.addLast(message);\n            sout(Thread.currentThread().getName() + \":\u200b\u5df2\u200b\u751f\u4ea7\u200b\u6d88\u606f\u200b--\" + message);\n            list.notifyAll();\n        }\n    }\n}\n\nfinal class Message {\n    private int id;\n    private Object value;\n    //get set\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_52","title":"\u963b\u585e\u200b\u961f\u5217","text":"Java<pre><code>public static void main(String[] args) {\n    ExecutorService consumer = Executors.newFixedThreadPool(1);\n    ExecutorService producer = Executors.newFixedThreadPool(1);\n    BlockingQueue&lt;Integer&gt; queue = new SynchronousQueue&lt;&gt;();\n    producer.submit(() -&gt; {\n        try {\n            System.out.println(\"\u200b\u751f\u4ea7\u200b...\");\n            Thread.sleep(1000);\n            queue.put(10);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    });\n    consumer.submit(() -&gt; {\n        try {\n            System.out.println(\"\u200b\u7b49\u5f85\u200b\u6d88\u8d39\u200b...\");\n            Integer result = queue.take();\n            System.out.println(\"\u200b\u7ed3\u679c\u200b\u4e3a\u200b:\" + result);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    });\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_53","title":"\u5185\u5b58","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#jmm","title":"JMM","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_54","title":"\u5185\u5b58\u200b\u6a21\u578b","text":"<p>Java \u200b\u5185\u5b58\u200b\u6a21\u578b\u200b\u662f\u200b Java Memory Model\uff08JMM\uff09\uff0c\u200b\u672c\u8eab\u200b\u662f\u200b\u4e00\u79cd\u200b\u62bd\u8c61\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5e76\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u63cf\u8ff0\u200b\u7684\u200b\u662f\u200b\u4e00\u7ec4\u200b\u89c4\u5219\u200b\u6216\u200b\u89c4\u8303\u200b\uff0c\u200b\u901a\u8fc7\u200b\u8fd9\u7ec4\u200b\u89c4\u8303\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u5404\u4e2a\u200b\u53d8\u91cf\u200b\uff08\u200b\u5305\u62ec\u200b\u5b9e\u4f8b\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u9759\u6001\u200b\u5b57\u6bb5\u200b\u548c\u200b\u6784\u6210\u200b\u6570\u7ec4\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5143\u7d20\u200b\uff09\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65b9\u5f0f\u200b</p> <p>JMM \u200b\u4f5c\u7528\u200b\uff1a</p> <ul> <li>\u200b\u5c4f\u853d\u200b\u5404\u79cd\u200b\u786c\u4ef6\u200b\u548c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u5dee\u5f02\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u8ba9\u200b Java \u200b\u7a0b\u5e8f\u200b\u5728\u200b\u5404\u79cd\u200b\u5e73\u53f0\u200b\u4e0b\u200b\u90fd\u200b\u80fd\u200b\u8fbe\u5230\u200b\u4e00\u81f4\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u6548\u679c\u200b</li> <li>\u200b\u89c4\u5b9a\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u5185\u5b58\u200b\u4e4b\u95f4\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5173\u7cfb\u200b</li> </ul> <p>\u200b\u6839\u636e\u200b JMM \u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b\u4e3b\u200b\u5185\u5b58\u200b\uff08Main Memory\uff09\uff0cJava \u200b\u4e2d\u200b\u6240\u6709\u200b\u53d8\u91cf\u200b\u90fd\u200b\u5b58\u50a8\u200b\u5728\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff1b\u200b\u6bcf\u6761\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff08Working Memory\uff09\uff0c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\u67d0\u4e9b\u200b\u53d8\u91cf\u200b\u7684\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u6240\u6709\u200b\u53d8\u91cf\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u662f\u200b\u5148\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u8fdb\u884c\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8fdb\u884c\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u53d8\u91cf\u200b\uff1b\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u65e0\u6cd5\u200b\u76f8\u4e92\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\uff08\u200b\u4f20\u9012\u200b\uff09\u200b\u5fc5\u987b\u200b\u901a\u8fc7\u200b\u4e3b\u200b\u5185\u5b58\u200b\u6765\u200b\u5b8c\u6210\u200b</p> <p></p> <p>\u200b\u4e3b\u200b\u5185\u5b58\u200b\u548c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff1a</p> <ul> <li>\u200b\u4e3b\u200b\u5185\u5b58\u200b\uff1a\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u7ecf\u5e38\u200b\u63d0\u5230\u200b\u7684\u200b 8G \u200b\u5185\u5b58\u200b\uff0c16G \u200b\u5185\u5b58\u200b\uff0c\u200b\u5b58\u50a8\u200b\u6240\u6709\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff1a\u200b\u5b58\u50a8\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u5230\u200b\u7684\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u5728\u200b\u4e3b\u200b\u5185\u5b58\u200b\u7684\u200b\u7684\u200b\u503c\u200b\u7684\u200b\u526f\u672c\u200b\u62f7\u8d1d\u200b</li> </ul> <p>JVM \u200b\u548c\u200b JMM \u200b\u4e4b\u95f4\u200b\u7684\u200b\u5173\u7cfb\u200b\uff1aJMM \u200b\u4e2d\u200b\u7684\u200b\u4e3b\u200b\u5185\u5b58\u200b\u3001\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e0e\u200b JVM \u200b\u4e2d\u200b\u7684\u200b Java \u200b\u5806\u200b\u3001\u200b\u6808\u200b\u3001\u200b\u65b9\u6cd5\u200b\u533a\u200b\u7b49\u200b\u5e76\u200b\u4e0d\u662f\u200b\u540c\u4e00\u4e2a\u200b\u5c42\u6b21\u200b\u7684\u200b\u5185\u5b58\u200b\u5212\u5206\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u8005\u200b\u57fa\u672c\u4e0a\u200b\u662f\u200b\u6ca1\u6709\u200b\u5173\u7cfb\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u4e24\u8005\u200b\u4e00\u5b9a\u200b\u8981\u200b\u52c9\u5f3a\u200b\u5bf9\u5e94\u200b\u8d77\u6765\u200b\uff1a</p> <ul> <li>\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e3b\u8981\u200b\u5bf9\u5e94\u200b\u4e8e\u200b Java \u200b\u5806\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5b9e\u4f8b\u200b\u6570\u636e\u200b\u90e8\u5206\u200b\uff0c\u200b\u800c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u5219\u200b\u5bf9\u5e94\u200b\u4e8e\u200b\u865a\u62df\u673a\u200b\u6808\u4e2d\u200b\u7684\u200b\u90e8\u5206\u200b\u533a\u57df\u200b</li> <li>\u200b\u4ece\u200b\u66f4\u200b\u4f4e\u5c42\u6b21\u200b\u4e0a\u200b\u8bf4\u200b\uff0c\u200b\u4e3b\u200b\u5185\u5b58\u200b\u76f4\u63a5\u200b\u5bf9\u5e94\u200b\u4e8e\u200b\u7269\u7406\u200b\u786c\u4ef6\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u5bf9\u5e94\u200b\u5bc4\u5b58\u5668\u200b\u548c\u200b\u9ad8\u901f\u7f13\u5b58\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_55","title":"\u5185\u5b58\u200b\u4ea4\u4e92","text":"<p>Java \u200b\u5185\u5b58\u200b\u6a21\u578b\u200b\u5b9a\u4e49\u200b\u4e86\u200b 8 \u200b\u4e2a\u200b\u64cd\u4f5c\u200b\u6765\u200b\u5b8c\u6210\u200b\u4e3b\u200b\u5185\u5b58\u200b\u548c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u7684\u200b\u4ea4\u4e92\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b</p> <p>\u200b\u975e\u200b\u539f\u5b50\u200b\u534f\u5b9a\u200b\uff1a\u200b\u6ca1\u6709\u200b\u88ab\u200b volatile \u200b\u4fee\u9970\u200b\u7684\u200b long\u3001double \u200b\u5916\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u6309\u7167\u200b\u4e24\u6b21\u200b 32 \u200b\u4f4d\u200b\u7684\u200b\u64cd\u4f5c\u200b</p> <p></p> <ul> <li>lock\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u6807\u8bc6\u200b\u4e3a\u200b\u88ab\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u72ec\u5360\u200b\u72b6\u6001\u200b\uff08\u200b\u5bf9\u5e94\u200b monitorenter\uff09</li> <li>unclock\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u4ece\u200b\u72ec\u5360\u200b\u72b6\u6001\u200b\u91ca\u653e\u51fa\u6765\u200b\uff0c\u200b\u91ca\u653e\u200b\u540e\u200b\u7684\u200b\u53d8\u91cf\u200b\u624d\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u9501\u5b9a\u200b\uff08\u200b\u5bf9\u5e94\u200b monitorexit\uff09</li> <li>read\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4f20\u8f93\u200b\u5230\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> <li>load\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff0c\u200b\u5728\u200b read \u200b\u4e4b\u540e\u200b\u6267\u884c\u200b\uff0c\u200b\u628a\u200b read \u200b\u5f97\u5230\u200b\u7684\u200b\u503c\u200b\u653e\u5165\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u7684\u200b\u53d8\u91cf\u200b\u526f\u672c\u200b\u4e2d\u200b</li> <li>use\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\u4f20\u9012\u200b\u7ed9\u200b\u6267\u884c\u200b\u5f15\u64ce\u200b\uff0c\u200b\u6bcf\u5f53\u200b\u9047\u5230\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200b\u5230\u200b\u53d8\u91cf\u200b\u7684\u200b\u64cd\u4f5c\u200b\u65f6\u200b\u90fd\u200b\u8981\u200b\u4f7f\u7528\u200b\u8be5\u200b\u6307\u4ee4\u200b</li> <li>assign\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u4ece\u200b\u6267\u884c\u200b\u5f15\u64ce\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u4e00\u4e2a\u200b\u503c\u8d4b\u200b\u7ed9\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u7684\u200b\u53d8\u91cf\u200b</li> <li>store\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u7684\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\u4f20\u9001\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> <li>write\uff1a\u200b\u4f5c\u7528\u200b\u4e8e\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u5728\u200b store \u200b\u4e4b\u540e\u200b\u6267\u884c\u200b\uff0c\u200b\u628a\u200b store \u200b\u5f97\u5230\u200b\u7684\u200b\u503c\u200b\u653e\u5165\u200b\u4e3b\u200b\u5185\u5b58\u200b\u7684\u200b\u53d8\u91cf\u200b\u4e2d\u200b</li> </ul> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_56","title":"\u4e09\u5927\u200b\u7279\u6027","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_57","title":"\u53ef\u89c1\u200b\u6027","text":"<p>\u200b\u53ef\u89c1\u200b\u6027\u200b\uff1a\u200b\u662f\u200b\u6307\u5f53\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\u540c\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u65f6\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u80fd\u591f\u200b\u7acb\u5373\u200b\u770b\u200b\u5f97\u5230\u200b\u4fee\u6539\u200b\u7684\u200b\u503c\u200b</p> <p>\u200b\u5b58\u5728\u200b\u4e0d\u200b\u53ef\u89c1\u200b\u95ee\u9898\u200b\u7684\u200b\u6839\u672c\u539f\u56e0\u200b\u662f\u200b\u7531\u4e8e\u200b\u7f13\u5b58\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u7684\u200b\u662f\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u611f\u77e5\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5bf9\u4e8e\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u66f4\u6539\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\u4e0d\u662f\u200b\u6700\u65b0\u200b\u7684\u200b\u3002\u200b\u4f46\u662f\u200b final \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\u662f\u200b\u4e0d\u53ef\u200b\u53d8\u200b\u7684\u200b\uff0c\u200b\u5c31\u7b97\u200b\u6709\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u5b58\u5728\u200b\u4e0d\u200b\u53ef\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b</p> <p>main \u200b\u7ebf\u7a0b\u200b\u5bf9\u200b run \u200b\u53d8\u91cf\u200b\u7684\u200b\u4fee\u6539\u200b\u5bf9\u4e8e\u200b t \u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u53ef\u89c1\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e86\u200b t \u200b\u7ebf\u7a0b\u200b\u65e0\u6cd5\u200b\u505c\u6b62\u200b\uff1a</p> Java<pre><code>static boolean run = true;  //\u200b\u6dfb\u52a0\u200bvolatile\npublic static void main(String[] args) throws InterruptedException {\n    Thread t = new Thread(()-&gt;{\n        while(run){\n        // ....\n        }\n    });\n    t.start();\n    sleep(1);\n    run = false; // \u200b\u7ebf\u7a0b\u200bt\u200b\u4e0d\u4f1a\u200b\u5982\u200b\u9884\u60f3\u200b\u7684\u200b\u505c\u4e0b\u6765\u200b\n}\n</code></pre> <p>\u200b\u539f\u56e0\u200b\uff1a</p> <ul> <li>\u200b\u521d\u59cb\u72b6\u6001\u200b\uff0c t \u200b\u7ebf\u7a0b\u200b\u521a\u200b\u5f00\u59cb\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\u4e86\u200b run \u200b\u7684\u200b\u503c\u200b\u5230\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b</li> <li>\u200b\u56e0\u4e3a\u200b t \u200b\u7ebf\u7a0b\u200b\u8981\u200b\u9891\u7e41\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b run \u200b\u7684\u200b\u503c\u200b\uff0cJIT \u200b\u7f16\u8bd1\u5668\u200b\u4f1a\u200b\u5c06\u200b run \u200b\u7684\u200b\u503c\u200b\u7f13\u5b58\u200b\u81f3\u200b\u81ea\u5df1\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u9ad8\u901f\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u51cf\u5c11\u200b\u5bf9\u200b\u4e3b\u5b58\u200b\u4e2d\u200b run \u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u63d0\u9ad8\u6548\u7387\u200b</li> <li>1 \u200b\u79d2\u200b\u4e4b\u540e\u200b\uff0cmain \u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u4e86\u200b run \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5e76\u200b\u540c\u6b65\u200b\u81f3\u200b\u4e3b\u5b58\u200b\uff0c\u200b\u800c\u200b t \u200b\u662f\u4ece\u200b\u81ea\u5df1\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u9ad8\u901f\u7f13\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u8fd9\u4e2a\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u7ed3\u679c\u200b\u6c38\u8fdc\u200b\u662f\u200b\u65e7\u503c\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_58","title":"\u539f\u5b50\u200b\u6027","text":"<p>\u200b\u539f\u5b50\u200b\u6027\u200b\uff1a\u200b\u4e0d\u53ef\u5206\u5272\u200b\uff0c\u200b\u5b8c\u6574\u6027\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u6b63\u5728\u200b\u505a\u200b\u67d0\u4e2a\u200b\u5177\u4f53\u200b\u4e1a\u52a1\u200b\u65f6\u200b\uff0c\u200b\u4e2d\u95f4\u200b\u4e0d\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5206\u5272\u200b\uff0c\u200b\u9700\u8981\u200b\u5177\u4f53\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8981\u4e48\u200b\u540c\u65f6\u200b\u6210\u529f\u200b\uff0c\u200b\u8981\u4e48\u200b\u540c\u65f6\u200b\u5931\u8d25\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6307\u4ee4\u200b\u4e0d\u4f1a\u200b\u53d7\u5230\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u7684\u200b\u5f71\u54cd\u200b </p> <p>\u200b\u5b9a\u4e49\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u7684\u200b\u4f7f\u7528\u200b\u89c4\u5219\u200b\uff1a</p> <ol> <li>\u200b\u4e0d\u200b\u5141\u8bb8\u200b read \u200b\u548c\u200b load\u3001store \u200b\u548c\u200b write \u200b\u64cd\u4f5c\u200b\u4e4b\u4e00\u200b\u5355\u72ec\u200b\u51fa\u73b0\u200b\uff0c\u200b\u5fc5\u987b\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u8981\u6c42\u200b\u8fde\u7eed\u200b</li> <li>\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e22\u5f03\u200b assign \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5fc5\u987b\u200b\u540c\u6b65\u200b\u56de\u200b\u4e3b\u5b58\u200b</li> <li>\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u65e0\u200b\u539f\u56e0\u200b\u5730\u200b\uff08\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u8fc7\u200b\u4efb\u4f55\u200b assign \u200b\u64cd\u4f5c\u200b\uff09\u200b\u628a\u200b\u6570\u636e\u200b\u4ece\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u540c\u6b65\u200b\u4f1a\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> <li>\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u53d8\u91cf\u200b\u53ea\u80fd\u200b\u5728\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bde\u751f\u200b\uff0c\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5728\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u672a\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\uff08assign \u200b\u6216\u8005\u200b load\uff09\u200b\u7684\u200b\u53d8\u91cf\u200b\uff0c\u200b\u5373\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u5b9e\u65bd\u200b use \u200b\u548c\u200b store \u200b\u64cd\u4f5c\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5148\u200b\u81ea\u884c\u200b assign \u200b\u548c\u200b load \u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u5728\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ea\u200b\u5141\u8bb8\u200b\u4e00\u6761\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u5176\u200b\u8fdb\u884c\u200b lock \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f46\u200b lock \u200b\u64cd\u4f5c\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u540c\u4e00\u200b\u7ebf\u7a0b\u200b\u91cd\u590d\u200b\u6267\u884c\u200b\u591a\u6b21\u200b\uff0c\u200b\u591a\u6b21\u200b\u6267\u884c\u200b lock \u200b\u540e\u200b\uff0c\u200b\u53ea\u6709\u200b\u6267\u884c\u200b\u76f8\u540c\u200b\u6b21\u6570\u200b\u7684\u200b unlock \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53d8\u91cf\u200b\u624d\u200b\u4f1a\u200b\u88ab\u200b\u89e3\u9501\u200b\uff0clock \u200b\u548c\u200b unlock \u200b\u5fc5\u987b\u200b\u6210\u200b\u5bf9\u200b\u51fa\u73b0\u200b</li> <li>\u200b\u5982\u679c\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u6267\u884c\u200b lock \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5c06\u4f1a\u200b\u6e05\u7a7a\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u6b64\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5728\u200b\u6267\u884c\u200b\u5f15\u64ce\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u53d8\u91cf\u200b\u4e4b\u524d\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u4ece\u200b\u4e3b\u5b58\u200b\u52a0\u8f7d\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u4e8b\u5148\u200b\u6ca1\u6709\u200b\u88ab\u200b lock \u200b\u64cd\u4f5c\u200b\u9501\u5b9a\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u6267\u884c\u200b unlock \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u53bb\u200b unlock \u200b\u4e00\u4e2a\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u9501\u5b9a\u200b\u7684\u200b\u53d8\u91cf\u200b</li> <li>\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u6267\u884c\u200b unlock \u200b\u64cd\u4f5c\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5148\u200b\u628a\u200b\u6b64\u200b\u53d8\u91cf\u200b\u540c\u6b65\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\uff08\u200b\u6267\u884c\u200b store \u200b\u548c\u200b write \u200b\u64cd\u4f5c\u200b\uff09</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_59","title":"\u6709\u5e8f\u6027","text":"<p>\u200b\u6709\u5e8f\u6027\u200b\uff1a\u200b\u5728\u200b\u672c\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u89c2\u5bdf\u200b\uff0c\u200b\u6240\u6709\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u662f\u200b\u6709\u5e8f\u200b\u7684\u200b\uff1b\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u89c2\u5bdf\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6240\u6709\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u662f\u200b\u65e0\u5e8f\u200b\u7684\u200b\uff0c\u200b\u65e0\u5e8f\u200b\u662f\u56e0\u4e3a\u200b\u53d1\u751f\u200b\u4e86\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b</p> <p>CPU \u200b\u7684\u200b\u57fa\u672c\u200b\u5de5\u4f5c\u200b\u662f\u200b\u6267\u884c\u200b\u5b58\u50a8\u200b\u7684\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u5373\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u4e0d\u65ad\u200b\u5730\u200b\u53d6\u51fa\u200b\u6307\u4ee4\u200b\u3001\u200b\u5206\u6790\u200b\u6307\u4ee4\u200b\u3001\u200b\u6267\u884c\u200b\u6307\u4ee4\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\uff0c\u200b\u7f16\u8bd1\u5668\u200b\u548c\u200b\u5904\u7406\u5668\u200b\u4f1a\u200b\u5bf9\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\uff0c\u200b\u4e00\u822c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u4e09\u79cd\u200b\uff1a</p> Java<pre><code>\u200b\u6e90\u4ee3\u7801\u200b -&gt; \u200b\u7f16\u8bd1\u5668\u200b\u4f18\u5316\u200b\u7684\u200b\u91cd\u6392\u200b -&gt; \u200b\u6307\u4ee4\u200b\u5e76\u884c\u200b\u7684\u200b\u91cd\u6392\u200b -&gt; \u200b\u5185\u5b58\u200b\u7cfb\u7edf\u200b\u7684\u200b\u91cd\u6392\u200b -&gt; \u200b\u6700\u7ec8\u200b\u6267\u884c\u200b\u6307\u4ee4\u200b\n</code></pre> <p>\u200b\u73b0\u4ee3\u200b CPU \u200b\u652f\u6301\u200b\u591a\u7ea7\u200b\u6307\u4ee4\u200b\u6d41\u6c34\u7ebf\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b\u7684\u200b\u51af\u200b\u2022\u200b\u8bfa\u4f0a\u66fc\u200b\u578b\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b CPU\uff0c\u200b\u5176\u200b\u5de5\u4f5c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5206\u4e3a\u200b 5 \u200b\u4e2a\u200b\u9636\u6bb5\u200b\uff1a\u200b\u53d6\u6307\u4ee4\u200b\u3001\u200b\u6307\u4ee4\u200b\u8bd1\u7801\u200b\u3001\u200b\u6267\u884c\u200b\u6307\u4ee4\u200b\u3001\u200b\u8bbf\u200b\u5b58\u53d6\u200b\u6570\u200b\u548c\u200b\u7ed3\u679c\u200b\u5199\u56de\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u79f0\u4e4b\u4e3a\u200b\u4e94\u7ea7\u200b\u6307\u4ee4\u200b\u6d41\u6c34\u7ebf\u200b\u3002CPU \u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u5185\u200b\uff0c\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\u4e94\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u4e0d\u540c\u200b\u9636\u6bb5\u200b\uff08\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e0d\u540c\u200b\u7684\u200b\u9636\u6bb5\u200b\uff09\uff0c\u200b\u672c\u8d28\u200b\u4e0a\u200b\u6d41\u6c34\u7ebf\u200b\u6280\u672f\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u7f29\u77ed\u200b\u5355\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4f46\u200b\u53d8\u76f8\u200b\u5730\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u6307\u4ee4\u200b\u5730\u200b\u541e\u5410\u200b\u7387\u200b</p> <p>\u200b\u5904\u7406\u5668\u200b\u5728\u200b\u8fdb\u884c\u200b\u91cd\u200b\u6392\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u5fc5\u987b\u200b\u8981\u200b\u8003\u8651\u200b\u6307\u4ee4\u200b\u4e4b\u95f4\u200b\u7684\u200b\u6570\u636e\u200b\u4f9d\u8d56\u6027\u200b</p> <ul> <li>\u200b\u5355\u7ebf\u7a0b\u200b\u73af\u5883\u200b\u4e5f\u200b\u5b58\u5728\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5b58\u5728\u200b\u4f9d\u8d56\u6027\u200b\uff0c\u200b\u6700\u7ec8\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u548c\u200b\u4ee3\u7801\u200b\u987a\u5e8f\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e00\u81f4\u200b</li> <li>\u200b\u591a\u7ebf\u7a0b\u200b\u73af\u5883\u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u4ea4\u66ff\u200b\u6267\u884c\u200b\uff0c\u200b\u7531\u4e8e\u200b\u7f16\u8bd1\u5668\u200b\u4f18\u5316\u200b\u91cd\u6392\u200b\uff0c\u200b\u4f1a\u200b\u83b7\u53d6\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5904\u5728\u200b\u4e0d\u540c\u200b\u9636\u6bb5\u200b\u7684\u200b\u6307\u4ee4\u200b\u540c\u65f6\u200b\u6267\u884c\u200b</li> </ul> <p>\u200b\u8865\u5145\u200b\u77e5\u8bc6\u200b\uff1a</p> <ul> <li>\u200b\u6307\u4ee4\u200b\u5468\u671f\u200b\u662f\u200b\u53d6\u51fa\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5e76\u200b\u6267\u884c\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4e00\u822c\u200b\u7531\u200b\u82e5\u5e72\u4e2a\u200b\u673a\u5668\u200b\u5468\u671f\u200b\u7ec4\u6210\u200b</li> <li>\u200b\u673a\u5668\u200b\u5468\u671f\u200b\u4e5f\u200b\u79f0\u4e3a\u200b CPU \u200b\u5468\u671f\u200b\uff0c\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u5212\u5206\u200b\u4e3a\u200b\u82e5\u5e72\u4e2a\u200b\u9636\u6bb5\u200b\uff08\u200b\u5982\u53d6\u200b\u6307\u200b\u3001\u200b\u8bd1\u7801\u200b\u3001\u200b\u6267\u884c\u200b\u7b49\u200b\uff09\uff0c\u200b\u6bcf\u4e00\u200b\u9636\u6bb5\u200b\u5b8c\u6210\u200b\u4e00\u4e2a\u200b\u57fa\u672c\u64cd\u4f5c\u200b\uff0c\u200b\u5b8c\u6210\u200b\u4e00\u4e2a\u200b\u57fa\u672c\u64cd\u4f5c\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u95f4\u200b\u79f0\u4e3a\u200b\u673a\u5668\u200b\u5468\u671f\u200b</li> <li>\u200b\u632f\u8361\u5468\u671f\u200b\u6307\u200b\u5468\u671f\u6027\u200b\u4fe1\u53f7\u200b\u4f5c\u200b\u5468\u671f\u6027\u200b\u91cd\u590d\u200b\u53d8\u5316\u200b\u7684\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#cache","title":"cache","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_60","title":"\u7f13\u5b58\u200b\u673a\u5236","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_61","title":"\u7f13\u5b58\u200b\u7ed3\u6784","text":"<p>\u200b\u5728\u200b\u8ba1\u7b97\u673a\u7cfb\u7edf\u200b\u4e2d\u200b\uff0cCPU \u200b\u9ad8\u901f\u7f13\u5b58\u200b\uff08CPU Cache\uff0c\u200b\u7b80\u79f0\u200b\u7f13\u5b58\u200b\uff09\u200b\u662f\u200b\u7528\u4e8e\u200b\u51cf\u5c11\u200b\u5904\u7406\u5668\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\u6240\u200b\u9700\u200b\u5e73\u5747\u200b\u65f6\u95f4\u200b\u7684\u200b\u90e8\u4ef6\u200b\uff1b\u200b\u5728\u200b\u5b58\u50a8\u4f53\u7cfb\u200b\u4e2d\u200b\u4f4d\u4e8e\u200b\u81ea\u9876\u5411\u4e0b\u200b\u7684\u200b\u7b2c\u4e8c\u5c42\u200b\uff0c\u200b\u4ec5\u6b21\u4e8e\u200b CPU \u200b\u5bc4\u5b58\u5668\u200b\uff1b\u200b\u5176\u200b\u5bb9\u91cf\u200b\u8fdc\u200b\u5c0f\u4e8e\u200b\u5185\u5b58\u200b\uff0c\u200b\u4f46\u200b\u901f\u5ea6\u200b\u5374\u200b\u53ef\u4ee5\u200b\u63a5\u8fd1\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u9891\u7387\u200b</p> <p>CPU \u200b\u5904\u7406\u5668\u200b\u901f\u5ea6\u200b\u8fdc\u8fdc\u200b\u5927\u4e8e\u200b\u5728\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u901f\u5ea6\u200b\u5dee\u5f02\u200b\uff0c\u200b\u5728\u200b\u5b83\u4eec\u200b\u4e4b\u95f4\u200b\u67b6\u8bbe\u200b\u4e86\u200b\u591a\u7ea7\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5982\u200b L1\u3001L2\u3001L3 \u200b\u7ea7\u522b\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u7f13\u5b58\u200b\u79bb\u200b CPU \u200b\u8d8a\u8fd1\u200b\u5c31\u200b\u8d8a\u200b\u5feb\u200b\uff0c\u200b\u5c06\u200b\u9891\u7e41\u200b\u64cd\u4f5c\u200b\u7684\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u5230\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u52a0\u5feb\u200b\u8bbf\u95ee\u901f\u5ea6\u200b</p> <p></p> \u200b\u4ece\u200b CPU \u200b\u5230\u200b \u200b\u5927\u7ea6\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u949f\u200b\u5468\u671f\u200b \u200b\u5bc4\u5b58\u5668\u200b 1 cycle (4GHz \u200b\u7684\u200b CPU \u200b\u7ea6\u200b\u4e3a\u200b 0.25ns) L1 3~4 cycle L2 10~20 cycle L3 40~45 cycle \u200b\u5185\u5b58\u200b 120~240 cycle","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_62","title":"\u7f13\u5b58\u200b\u4f7f\u7528","text":"<p>\u200b\u5f53\u200b\u5904\u7406\u5668\u200b\u53d1\u51fa\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u8bf7\u6c42\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u5148\u200b\u67e5\u770b\u200b\u7f13\u5b58\u200b\u5185\u200b\u662f\u5426\u200b\u6709\u200b\u8bf7\u6c42\u200b\u6570\u636e\u200b\uff0c\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\uff08\u200b\u547d\u4e2d\u200b\uff09\uff0c\u200b\u5219\u200b\u4e0d\u7528\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u8be5\u200b\u6570\u636e\u200b\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff08\u200b\u5931\u6548\u200b\uff09\uff0c\u200b\u5219\u200b\u8981\u200b\u5148\u200b\u628a\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u76f8\u5e94\u200b\u6570\u636e\u200b\u8f7d\u5165\u200b\u7f13\u5b58\u200b\uff0c\u200b\u518d\u200b\u5c06\u200b\u5176\u200b\u8fd4\u56de\u200b\u5904\u7406\u5668\u200b</p> <p>\u200b\u7f13\u5b58\u200b\u4e4b\u6240\u4ee5\u200b\u6709\u6548\u200b\uff0c\u200b\u4e3b\u8981\u200b\u56e0\u4e3a\u200b\u7a0b\u5e8f\u8fd0\u884c\u200b\u65f6\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u8bbf\u95ee\u200b\u5448\u73b0\u200b\u5c40\u90e8\u6027\u200b\uff08Locality\uff09\u200b\u7279\u5f81\u200b\u3002\u200b\u65e2\u200b\u5305\u62ec\u200b\u7a7a\u95f4\u200b\u5c40\u90e8\u6027\u200b\uff08Spatial Locality\uff09\uff0c\u200b\u4e5f\u200b\u5305\u62ec\u200b\u65f6\u95f4\u200b\u5c40\u90e8\u6027\u200b\uff08Temporal Locality\uff09\uff0c\u200b\u6709\u6548\u200b\u5229\u7528\u200b\u8fd9\u79cd\u200b\u5c40\u90e8\u6027\u200b\uff0c\u200b\u7f13\u5b58\u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b\u6781\u9ad8\u200b\u7684\u200b\u547d\u4e2d\u7387\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_63","title":"\u4f2a\u200b\u5171\u4eab","text":"<p>\u200b\u7f13\u5b58\u200b\u4ee5\u200b\u7f13\u5b58\u200b\u884c\u200b cache line \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u5bf9\u5e94\u200b\u7740\u200b\u4e00\u5757\u200b\u5185\u5b58\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b 64 byte\uff088 \u200b\u4e2a\u200b long\uff09\uff0c\u200b\u5728\u200b CPU \u200b\u4ece\u200b\u4e3b\u5b58\u200b\u83b7\u53d6\u6570\u636e\u200b\u65f6\u200b\uff0c\u200b\u4ee5\u200b cache line \u200b\u4e3a\u200b\u5355\u4f4d\u200b\u52a0\u8f7d\u200b\uff0c\u200b\u4e8e\u662f\u200b\u76f8\u90bb\u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u4e00\u5e76\u200b\u52a0\u8f7d\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b</p> <p>\u200b\u7f13\u5b58\u200b\u4f1a\u200b\u9020\u6210\u200b\u6570\u636e\u200b\u526f\u672c\u200b\u7684\u200b\u4ea7\u751f\u200b\uff0c\u200b\u5373\u540c\u200b\u4e00\u4efd\u200b\u6570\u636e\u200b\u4f1a\u200b\u7f13\u5b58\u200b\u5728\u200b\u4e0d\u540c\u200b\u6838\u5fc3\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u4e2d\u200b\uff0cCPU \u200b\u8981\u200b\u4fdd\u8bc1\u6570\u636e\u200b\u7684\u200b\u4e00\u81f4\u6027\u200b\uff0c\u200b\u9700\u8981\u200b\u505a\u5230\u200b\u67d0\u4e2a\u200b CPU \u200b\u6838\u5fc3\u200b\u66f4\u6539\u200b\u4e86\u200b\u6570\u636e\u200b\uff0c\u200b\u5176\u5b83\u200b CPU \u200b\u6838\u5fc3\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6574\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u5fc5\u987b\u200b\u5931\u6548\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4f2a\u200b\u5171\u4eab\u200b</p> <p></p> <p>\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>padding\uff1a\u200b\u901a\u8fc7\u200b\u586b\u5145\u200b\uff0c\u200b\u8ba9\u200b\u6570\u636e\u200b\u843d\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b cache line \u200b\u4e2d\u200b</li> <li>@Contended\uff1a\u200b\u539f\u7406\u200b\u53c2\u8003\u200b \u200b\u65e0\u9501\u200b \u2192 Adder \u2192 \u200b\u4f18\u5316\u200b\u673a\u5236\u200b \u2192 \u200b\u4f2a\u200b\u5171\u4eab\u200b</li> </ul> <p>Linux \u200b\u67e5\u770b\u200b CPU \u200b\u7f13\u5b58\u200b\u884c\u200b\uff1a</p> <ul> <li>\u200b\u547d\u4ee4\u200b\uff1a<code>cat /sys/devices/system/cpu/cpu0/cache/index0/coherency_line_size64</code></li> <li>\u200b\u5185\u5b58\u5730\u5740\u200b\u683c\u5f0f\u200b\uff1a[\u200b\u9ad8\u4f4d\u200b\u7ec4\u200b\u6807\u8bb0\u200b] [\u200b\u4f4e\u4f4d\u200b\u7d22\u5f15\u200b] [\u200b\u504f\u79fb\u91cf\u200b]</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_64","title":"\u7f13\u5b58\u200b\u4e00\u81f4","text":"<p>\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\uff1a\u200b\u5f53\u200b\u591a\u4e2a\u200b\u5904\u7406\u5668\u200b\u8fd0\u7b97\u200b\u4efb\u52a1\u200b\u90fd\u200b\u6d89\u53ca\u200b\u5230\u200b\u540c\u200b\u4e00\u5757\u200b\u4e3b\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c06\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u5404\u81ea\u200b\u7684\u200b\u7f13\u5b58\u6570\u636e\u200b\u4e0d\u200b\u4e00\u6837\u200b</p> <p></p> <p>MESI\uff08Modified Exclusive Shared Or Invalid\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\u7684\u200b\u652f\u6301\u200b\u5199\u56de\u200b\u7b56\u7565\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0cCPU \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff08caceh line\uff09\u200b\u4f7f\u7528\u200b 4 \u200b\u79cd\u200b\u72b6\u6001\u200b\u8fdb\u884c\u200b\u6807\u8bb0\u200b\uff08\u200b\u4f7f\u7528\u200b\u989d\u5916\u200b\u7684\u200b\u4e24\u4f4d\u200b bit \u200b\u8868\u793a\u200b)\uff1a</p> <ul> <li>M\uff1a\u200b\u88ab\u200b\u4fee\u6539\u200b\uff08Modified\uff09</li> </ul> <p>\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u53ea\u200b\u88ab\u200b\u7f13\u5b58\u200b\u5728\u200b\u8be5\u200b CPU \u200b\u7684\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b\u88ab\u200b\u4fee\u6539\u200b\u8fc7\u200b\u7684\u200b\uff0c\u200b\u4e0e\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b (dirty)\uff0c\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u4e2d\u200b\u7684\u200b\u5185\u5b58\u200b\u9700\u8981\u200b\u5199\u56de\u200b (write back) \u200b\u4e3b\u5b58\u200b\u3002\u200b\u8be5\u200b\u72b6\u6001\u200b\u7684\u200b\u6570\u636e\u200b\u518d\u6b21\u200b\u88ab\u200b\u4fee\u6539\u200b\u4e0d\u4f1a\u200b\u53d1\u9001\u200b\u5e7f\u64ad\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u5728\u200b\u7b2c\u4e00\u6b21\u200b\u4fee\u6539\u200b\u65f6\u200b\u5931\u6548\u200b\u4e00\u6b21\u200b</p> <p>\u200b\u5f53\u200b\u88ab\u200b\u5199\u200b\u56de\u200b\u4e3b\u5b58\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u72b6\u6001\u200b\u4f1a\u200b\u53d8\u6210\u200b\u72ec\u4eab\u200b (exclusive) \u200b\u72b6\u6001\u200b</p> <ul> <li>E\uff1a\u200b\u72ec\u4eab\u200b\u7684\u200b\uff08Exclusive\uff09</li> </ul> <p>\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u53ea\u200b\u88ab\u200b\u7f13\u5b58\u200b\u5728\u200b\u8be5\u200b CPU \u200b\u7684\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u662f\u200b\u672a\u200b\u88ab\u200b\u4fee\u6539\u200b\u8fc7\u200b\u7684\u200b (clear)\uff0c\u200b\u4e0e\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\u6570\u636e\u200b\u4e00\u81f4\u200b\uff0c\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\u4e0d\u200b\u9700\u8981\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b CPU \u200b\u6838\u5fc3\u200b\uff0c\u200b\u8be5\u200b\u72b6\u6001\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4efb\u4f55\u65f6\u523b\u200b\u6709\u200b\u5176\u5b83\u200b CPU \u200b\u8bfb\u53d6\u200b\u8be5\u200b\u5185\u5b58\u200b\u65f6\u200b\u53d8\u6210\u200b\u5171\u4eab\u200b\u72b6\u6001\u200b (shared)</p> <p>\u200b\u5f53\u200b CPU \u200b\u4fee\u6539\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u4e2d\u200b\u5185\u5bb9\u200b\u65f6\u200b\uff0c\u200b\u8be5\u200b\u72b6\u6001\u200b\u53ef\u4ee5\u200b\u53d8\u6210\u200b Modified \u200b\u72b6\u6001\u200b</p> <ul> <li>S\uff1a\u200b\u5171\u4eab\u200b\u7684\u200b\uff08Shared\uff09</li> </ul> <p>\u200b\u8be5\u200b\u72b6\u6001\u200b\u610f\u5473\u7740\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\u53ef\u80fd\u200b\u88ab\u200b\u591a\u4e2a\u200b CPU \u200b\u7f13\u5b58\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5404\u4e2a\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u4e0e\u200b\u4e3b\u5b58\u200b\u6570\u636e\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5f53\u200b CPU \u200b\u4fee\u6539\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u4e2d\u200b\uff0c\u200b\u4f1a\u200b\u5411\u200b\u5176\u5b83\u200b CPU \u200b\u6838\u5fc3\u200b\u5e7f\u64ad\u200b\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4f7f\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\u53d8\u6210\u200b\u65e0\u6548\u200b\u72b6\u6001\u200b (Invalid)\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u66f4\u65b0\u200b\u5f53\u524d\u200b Cache \u200b\u91cc\u200b\u7684\u200b\u6570\u636e\u200b</p> <ul> <li>I\uff1a\u200b\u65e0\u6548\u200b\u7684\u200b\uff08Invalid\uff09</li> </ul> <p>\u200b\u8be5\u200b\u7f13\u5b58\u200b\u662f\u200b\u65e0\u6548\u200b\u7684\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u5176\u5b83\u200b CPU \u200b\u4fee\u6539\u200b\u4e86\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b</p> <p>\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5404\u4e2a\u200b\u5904\u7406\u5668\u200b\u8bbf\u95ee\u200b\u7f13\u5b58\u200b\u65f6\u200b\u90fd\u200b\u9075\u5faa\u200b\u4e00\u4e9b\u200b\u534f\u8bae\u200b\uff0c\u200b\u5728\u200b\u8bfb\u5199\u200b\u65f6\u8981\u200b\u6839\u636e\u200b\u534f\u8bae\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u534f\u8bae\u200b\u4e3b\u8981\u200b\u6709\u200b MSI\u3001MESI \u200b\u7b49\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_65","title":"\u5904\u7406\u200b\u673a\u5236","text":"<p>\u200b\u5355\u6838\u200b CPU \u200b\u5904\u7406\u5668\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u4fdd\u8bc1\u200b\u57fa\u672c\u200b\u5185\u5b58\u200b\u64cd\u4f5c\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b</p> <p>\u200b\u591a\u6838\u200b CPU \u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u6bcf\u4e2a\u200b CPU \u200b\u5904\u7406\u5668\u200b\u5185\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u5757\u200b\u5185\u5b58\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5185\u6838\u200b\u5185\u90e8\u200b\u7ef4\u62a4\u200b\u7740\u200b\u4e00\u5757\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5f53\u200b\u591a\u7ebf\u7a0b\u200b\u5e76\u53d1\u200b\u8bfb\u5199\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u7f13\u5b58\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u5904\u7406\u5668\u200b\u63d0\u4f9b\u200b\uff1a</p> <ul> <li>\u200b\u603b\u7ebf\u200b\u9501\u5b9a\u200b\uff1a\u200b\u5f53\u200b\u5904\u7406\u5668\u200b\u8981\u200b\u64cd\u4f5c\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u65f6\u200b\uff0c\u200b\u5728\u200b BUS \u200b\u603b\u7ebf\u200b\u4e0a\u200b\u53d1\u51fa\u200b\u4e00\u4e2a\u200b LOCK \u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u64cd\u4f5c\u200b\u8fd9\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\uff0c\u200b\u8be5\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5927\u91cf\u200b\u963b\u585e\u200b\uff0c\u200b\u4ece\u800c\u200b\u589e\u52a0\u200b\u7cfb\u7edf\u200b\u7684\u200b\u6027\u80fd\u200b\u5f00\u9500\u200b\uff08\u200b\u5e73\u53f0\u200b\u7ea7\u522b\u200b\u7684\u200b\u52a0\u9501\u200b\uff09</li> <li>\u200b\u7f13\u5b58\u200b\u9501\u5b9a\u200b\uff1a\u200b\u5f53\u200b\u5904\u7406\u5668\u200b\u5bf9\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u8fdb\u884c\u200b\u4e86\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u6709\u200b\u55c5\u200b\u63a2\u200b\u673a\u5236\u200b\uff0c\u200b\u5c06\u200b\u5404\u81ea\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u8be5\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u5931\u6548\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u65f6\u4f1a\u200b\u91cd\u65b0\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u57fa\u4e8e\u200b MESI \u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u6765\u200b\u5b9e\u73b0\u200b</li> </ul> <p>\u200b\u6709\u200b\u5982\u4e0b\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\u5904\u7406\u5668\u200b\u4e0d\u4f1a\u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\u9501\u5b9a\u200b\uff1a</p> <ul> <li>\u200b\u5f53\u200b\u64cd\u4f5c\u200b\u7684\u200b\u6570\u636e\u200b\u8de8\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u6216\u200b\u6ca1\u200b\u88ab\u200b\u7f13\u5b58\u200b\u5728\u200b\u5904\u7406\u5668\u200b\u5185\u90e8\u200b\uff0c\u200b\u5219\u200b\u5904\u7406\u5668\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u603b\u7ebf\u200b\u9501\u5b9a\u200b</li> <li>\u200b\u6709\u4e9b\u200b\u5904\u7406\u5668\u200b\u4e0d\u200b\u652f\u6301\u200b\u7f13\u5b58\u200b\u9501\u5b9a\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1aIntel 486 \u200b\u548c\u200b Pentium \u200b\u5904\u7406\u5668\u200b\u4e5f\u200b\u4f1a\u200b\u8c03\u7528\u200b\u603b\u7ebf\u200b\u9501\u5b9a\u200b</li> </ul> <p>\u200b\u603b\u7ebf\u200b\u673a\u5236\u200b\uff1a</p> <ul> <li>\u200b\u603b\u7ebf\u200b\u55c5\u63a2\u200b\uff1a\u200b\u6bcf\u4e2a\u200b\u5904\u7406\u5668\u200b\u901a\u8fc7\u200b\u55c5\u63a2\u200b\u5728\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u4f20\u64ad\u200b\u7684\u200b\u6570\u636e\u200b\u6765\u200b\u68c0\u67e5\u200b\u81ea\u5df1\u200b\u7f13\u5b58\u200b\u503c\u200b\u662f\u5426\u200b\u8fc7\u671f\u200b\u4e86\u200b\uff0c\u200b\u5f53\u200b\u5904\u7406\u5668\u200b\u53d1\u73b0\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\u7684\u200b\u6570\u636e\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u5c31\u200b\u5c06\u200b\u5f53\u524d\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u65e0\u6548\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f53\u200b\u5904\u7406\u5668\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u91cd\u65b0\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u628a\u200b\u6570\u636e\u200b\u8bfb\u53d6\u200b\u5230\u200b\u5904\u7406\u5668\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> <li>\u200b\u603b\u7ebf\u200b\u98ce\u66b4\u200b\uff1a\u200b\u5f53\u200b\u67d0\u4e2a\u200b CPU \u200b\u6838\u5fc3\u200b\u66f4\u65b0\u200b\u4e86\u200b Cache \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8981\u200b\u628a\u200b\u8be5\u200b\u4e8b\u4ef6\u200b\u5e7f\u64ad\u200b\u901a\u77e5\u200b\u5230\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\uff08\u200b\u5199\u200b\u4f20\u64ad\u200b\uff09\uff0cCPU \u200b\u9700\u8981\u200b\u6bcf\u65f6\u6bcf\u523b\u200b\u76d1\u542c\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4e00\u5207\u200b\u6d3b\u52a8\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u7ba1\u200b\u522b\u7684\u200b\u6838\u5fc3\u200b\u7684\u200b Cache \u200b\u662f\u5426\u200b\u7f13\u5b58\u200b\u76f8\u540c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u53d1\u51fa\u200b\u4e00\u4e2a\u200b\u5e7f\u64ad\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u4e0d\u65ad\u200b\u7684\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u55c5\u63a2\u200b\u548c\u200b CAS \u200b\u5faa\u73af\u200b\uff0c\u200b\u65e0\u6548\u200b\u7684\u200b\u4ea4\u4e92\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u603b\u7ebf\u200b\u5e26\u5bbd\u200b\u8fbe\u5230\u200b\u5cf0\u503c\u200b\uff1b\u200b\u56e0\u6b64\u200b\u4e0d\u8981\u200b\u5927\u91cf\u200b\u4f7f\u7528\u200b volatile \u200b\u5173\u952e\u5b57\u200b\uff0c\u200b\u4f7f\u7528\u200b volatile\u3001syschonized \u200b\u90fd\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u5b9e\u9645\u200b\u573a\u666f\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#volatile","title":"volatile","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_66","title":"\u540c\u6b65\u200b\u673a\u5236","text":"<p>volatile \u200b\u662f\u200b Java \u200b\u865a\u62df\u673a\u200b\u63d0\u4f9b\u200b\u7684\u200b\u8f7b\u91cf\u7ea7\u200b\u7684\u200b\u540c\u6b65\u200b\u673a\u5236\u200b\uff08\u200b\u4e09\u5927\u200b\u7279\u6027\u200b\uff09</p> <ul> <li>\u200b\u4fdd\u8bc1\u200b\u53ef\u89c1\u200b\u6027\u200b</li> <li>\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b</li> <li>\u200b\u4fdd\u8bc1\u200b\u6709\u5e8f\u6027\u200b\uff08\u200b\u7981\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\uff09</li> </ul> <p>\u200b\u6027\u80fd\u200b\uff1avolatile \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u4e0e\u200b\u666e\u901a\u200b\u53d8\u91cf\u200b\u51e0\u4e4e\u200b\u6ca1\u4ec0\u4e48\u200b\u5dee\u522b\u200b\uff0c\u200b\u4f46\u662f\u200b\u5199\u200b\u64cd\u4f5c\u200b\u76f8\u5bf9\u200b\u6162\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u9700\u8981\u200b\u5728\u200b\u672c\u5730\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u63d2\u5165\u200b\u5f88\u591a\u200b\u5185\u5b58\u200b\u5c4f\u969c\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u6307\u4ee4\u200b\u4e0d\u4f1a\u200b\u53d1\u751f\u200b\u4e71\u5e8f\u6267\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f00\u9500\u200b\u6bd4\u9501\u200b\u8981\u200b\u5c0f\u200b</p> <p>synchronized \u200b\u65e0\u6cd5\u200b\u7981\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u548c\u200b\u5904\u7406\u5668\u200b\u4f18\u5316\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u6709\u5e8f\u6027\u200b\u53ef\u89c1\u200b\u6027\u200b</p> <ul> <li>\u200b\u52a0\u200b\u4e86\u200b\u9501\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\u5230\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u83b7\u5f97\u200b\u4e0d\u5230\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c31\u8981\u200b\u963b\u585e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540c\u4e00\u65f6\u95f4\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5355\u7ebf\u7a0b\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u4f9d\u8d56\u6027\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u5355\u7ebf\u7a0b\u200b\u7684\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u662f\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\u7684\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u52a0\u9501\u200b\u524d\u200b\uff0c\u200b\u5c06\u200b\u6e05\u7a7a\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u65f6\u200b\u9700\u8981\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u91cd\u65b0\u200b\u8bfb\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u7ebf\u7a0b\u200b\u89e3\u9501\u200b\u524d\u200b\uff0c\u200b\u5fc5\u987b\u200b\u628a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u6700\u65b0\u200b\u503c\u200b\u5237\u65b0\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\uff08JMM \u200b\u5185\u5b58\u200b\u4ea4\u4e92\u200b\u7ae0\u8282\u200b\u6709\u200b\u8bb2\u200b\uff09</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_67","title":"\u6307\u4ee4\u200b\u91cd\u6392","text":"<p>volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7981\u7528\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b</p> <p>\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u5b9e\u4f8b\u200b\uff1a</p> <ul> <li>example 1\uff1a</li> </ul> Java<pre><code>public void mySort() {\n  int x = 11; //\u200b\u8bed\u53e5\u200b1\n  int y = 12; //\u200b\u8bed\u53e5\u200b2  \u200b\u8c01\u200b\u5148\u200b\u6267\u884c\u200b\u6548\u679c\u200b\u4e00\u6837\u200b\n  x = x + 5;  //\u200b\u8bed\u53e5\u200b3\n  y = x * x;  //\u200b\u8bed\u53e5\u200b4\n}\n</code></pre> <p>\u200b\u6267\u884c\u200b\u987a\u5e8f\u200b\u662f\u200b\uff1a1 2 3 4\u30012 1 3 4\u30011 3 2 4</p> <p>\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u4e5f\u200b\u6709\u200b\u9650\u5236\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\uff1a4321\uff0c\u200b\u8bed\u53e5\u200b 4 \u200b\u9700\u8981\u200b\u4f9d\u8d56\u4e8e\u200b y \u200b\u4ee5\u53ca\u200b x \u200b\u7684\u200b\u7533\u660e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b58\u5728\u200b\u6570\u636e\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u9996\u5148\u200b\u6267\u884c\u200b</p> <ul> <li>example 2\uff1a</li> </ul> Java<pre><code>int num = 0;\nboolean ready = false;\n// \u200b\u7ebf\u7a0b\u200b1 \u200b\u6267\u884c\u200b\u6b64\u200b\u65b9\u6cd5\u200b\npublic void actor1(I_Result r) {\n    if(ready) {\n      r.r1 = num + num;\n    } else {\n      r.r1 = 1;\n    }\n}\n// \u200b\u7ebf\u7a0b\u200b2 \u200b\u6267\u884c\u200b\u6b64\u200b\u65b9\u6cd5\u200b\npublic void actor2(I_Result r) {\n  num = 2;\n  ready = true;\n}\n</code></pre> <p>\u200b\u60c5\u51b5\u200b\u4e00\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 1 \u200b\u5148\u200b\u6267\u884c\u200b\uff0cready = false\uff0c\u200b\u7ed3\u679c\u200b\u4e3a\u200b r.r1 = 1</p> <p>\u200b\u60c5\u51b5\u200b\u4e8c\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 2 \u200b\u5148\u200b\u6267\u884c\u200b num = 2\uff0c\u200b\u4f46\u200b\u8fd8\u200b\u6ca1\u200b\u6267\u884c\u200b ready = true\uff0c\u200b\u7ebf\u7a0b\u200b 1 \u200b\u6267\u884c\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4e3a\u200b r.r1 = 1</p> <p>\u200b\u60c5\u51b5\u200b\u4e09\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 2 \u200b\u5148\u200b\u6267\u884c\u200b ready = true\uff0c\u200b\u7ebf\u7a0b\u200b 1 \u200b\u6267\u884c\u200b\uff0c\u200b\u8fdb\u5165\u200b if \u200b\u5206\u652f\u200b\u7ed3\u679c\u200b\u4e3a\u200b r.r1 = 4</p> <p>\u200b\u60c5\u51b5\u200b\u56db\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 2 \u200b\u6267\u884c\u200b ready = true\uff0c\u200b\u5207\u6362\u200b\u5230\u200b\u7ebf\u7a0b\u200b 1\uff0c\u200b\u8fdb\u5165\u200b if \u200b\u5206\u652f\u200b\u4e3a\u200b r.r1 = 0\uff0c\u200b\u518d\u5207\u200b\u56de\u200b\u7ebf\u7a0b\u200b 2 \u200b\u6267\u884c\u200b num = 2\uff0c\u200b\u53d1\u751f\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_68","title":"\u5e95\u5c42\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_69","title":"\u7f13\u5b58\u200b\u4e00\u81f4","text":"<p>\u200b\u4f7f\u7528\u200b volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\uff0c\u200b\u5e95\u5c42\u200b\u901a\u8fc7\u200b\u6c47\u7f16\u200b lock \u200b\u524d\u7f00\u200b\u6307\u4ee4\u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\u9501\u5b9a\u200b\uff0c\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u4fee\u6539\u200b\u5b8c\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u540e\u5199\u200b\u56de\u200b\u4e3b\u5b58\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b CPU \u200b\u6838\u5fc3\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b CPU \u200b\u603b\u7ebf\u200b\u55c5\u63a2\u200b\u673a\u5236\u200b\u4f1a\u200b\u4fee\u6539\u200b\u5176\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u4e3a\u200b\u5931\u6548\u200b\u72b6\u6001\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u65f6\u4f1a\u200b\u91cd\u65b0\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b\u6570\u636e\u200b</p> <p>lock \u200b\u524d\u7f00\u200b\u6307\u4ee4\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u5185\u5b58\u200b\u5c4f\u969c\u200b\uff0cMemory Barrier\uff08Memory Fence\uff09</p> <ul> <li>\u200b\u5bf9\u200b volatile \u200b\u53d8\u91cf\u200b\u7684\u200b\u5199\u200b\u6307\u4ee4\u200b\u540e\u200b\u4f1a\u200b\u52a0\u5165\u200b\u5199\u200b\u5c4f\u969c\u200b</li> <li>\u200b\u5bf9\u200b volatile \u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u200b\u6307\u4ee4\u200b\u524d\u4f1a\u200b\u52a0\u5165\u200b\u8bfb\u200b\u5c4f\u969c\u200b</li> </ul> <p>\u200b\u5185\u5b58\u200b\u5c4f\u969c\u200b\u6709\u200b\u4e09\u4e2a\u200b\u4f5c\u7528\u200b\uff1a</p> <ul> <li>\u200b\u786e\u4fdd\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u8bfb\u200b-\u200b\u6539\u200b-\u200b\u5199\u200b\u64cd\u4f5c\u200b\u539f\u5b50\u200b\u6267\u884c\u200b</li> <li>\u200b\u963b\u6b62\u200b\u5c4f\u969c\u200b\u4e24\u4fa7\u200b\u7684\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b</li> <li>\u200b\u5f3a\u5236\u200b\u628a\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u810f\u200b\u6570\u636e\u200b\u5199\u200b\u56de\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u8ba9\u200b\u7f13\u5b58\u200b\u884c\u4e2d\u200b\u76f8\u5e94\u200b\u7684\u200b\u6570\u636e\u200b\u5931\u6548\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_70","title":"\u5185\u5b58\u200b\u5c4f\u969c","text":"<p>\u200b\u4fdd\u8bc1\u200b\u53ef\u89c1\u200b\u6027\u200b\uff1a</p> <ul> <li>\u200b\u5199\u200b\u5c4f\u969c\u200b\uff08sfence\uff0cStore Barrier\uff09\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u8be5\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b\u7684\u200b\uff0c\u200b\u5bf9\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u6539\u52a8\u200b\uff0c\u200b\u90fd\u200b\u540c\u6b65\u200b\u5230\u200b\u4e3b\u5b58\u200b\u5f53\u4e2d\u200b</li> </ul> Java<pre><code>public void actor2(I_Result r) {\n    num = 2;\n    ready = true; // ready \u200b\u662f\u200b volatile \u200b\u8d4b\u503c\u200b\u5e26\u5199\u200b\u5c4f\u969c\u200b\n    // \u200b\u5199\u200b\u5c4f\u969c\u200b\n}\n</code></pre> <ul> <li>\u200b\u8bfb\u200b\u5c4f\u969c\u200b\uff08lfence\uff0cLoad Barrier\uff09\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u8be5\u200b\u5c4f\u969c\u200b\u4e4b\u540e\u200b\u7684\u200b\uff0c\u200b\u5bf9\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u4ece\u200b\u4e3b\u5b58\u200b\u5237\u65b0\u200b\u53d8\u91cf\u503c\u200b\uff0c\u200b\u52a0\u8f7d\u200b\u7684\u200b\u662f\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\u6700\u65b0\u200b\u6570\u636e\u200b</li> </ul> Java<pre><code>public void actor1(I_Result r) {\n    // \u200b\u8bfb\u200b\u5c4f\u969c\u200b\n    // ready \u200b\u662f\u200b volatile \u200b\u8bfb\u200b\u53d6\u503c\u200b\u5e26\u8bfb\u200b\u5c4f\u969c\u200b\n    if(ready) {\n      r.r1 = num + num;\n    } else {\n      r.r1 = 1;\n    }\n}\n</code></pre> <p></p> <ul> <li>\u200b\u5168\u80fd\u200b\u5c4f\u969c\u200b\uff1amfence\uff08modify/mix Barrier\uff09\uff0c\u200b\u517c\u5177\u200b sfence \u200b\u548c\u200b lfence \u200b\u7684\u200b\u529f\u80fd\u200b</li> </ul> <p>\u200b\u4fdd\u8bc1\u200b\u6709\u5e8f\u6027\u200b\uff1a</p> <ul> <li>\u200b\u5199\u200b\u5c4f\u969c\u200b\u4f1a\u200b\u786e\u4fdd\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5c06\u200b\u5199\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b\u7684\u200b\u4ee3\u7801\u200b\u6392\u5728\u200b\u5199\u200b\u5c4f\u969c\u200b\u4e4b\u540e\u200b</li> <li>\u200b\u8bfb\u200b\u5c4f\u969c\u200b\u4f1a\u200b\u786e\u4fdd\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5c06\u200b\u8bfb\u200b\u5c4f\u969c\u200b\u4e4b\u540e\u200b\u7684\u200b\u4ee3\u7801\u200b\u6392\u200b\u5728\u8bfb\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b</li> </ul> <p>\u200b\u4e0d\u80fd\u200b\u89e3\u51b3\u200b\u6307\u4ee4\u200b\u4ea4\u9519\u200b\uff1a</p> <ul> <li>\u200b\u5199\u200b\u5c4f\u969c\u200b\u4ec5\u4ec5\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u4e4b\u540e\u200b\u7684\u200b\u8bfb\u200b\u80fd\u591f\u200b\u8bfb\u200b\u5230\u200b\u6700\u65b0\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8bfb\u200b\u8dd1\u200b\u5230\u200b\u5199\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b</li> <li>\u200b\u6709\u5e8f\u6027\u200b\u7684\u200b\u4fdd\u8bc1\u200b\u4e5f\u200b\u53ea\u662f\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u672c\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u76f8\u5173\u200b\u4ee3\u7801\u200b\u4e0d\u200b\u88ab\u200b\u91cd\u200b\u6392\u5e8f\u200b</li> </ul> Java<pre><code>volatile i = 0;\nnew Thread(() -&gt; {i++});\nnew Thread(() -&gt; {i--});\n</code></pre> <p>i++ \u200b\u53cd\u7f16\u8bd1\u200b\u540e\u200b\u7684\u200b\u6307\u4ee4\u200b\uff1a</p> Java<pre><code>0: iconst_1           // \u200b\u5f53\u200bint\u200b\u53d6\u503c\u200b -1~5 \u200b\u65f6\u200b\uff0cJVM\u200b\u91c7\u7528\u200biconst\u200b\u6307\u4ee4\u200b\u5c06\u200b\u5e38\u91cf\u200b\u538b\u5165\u200b\u6808\u200b\u4e2d\u200b\n1: istore_1           // \u200b\u5c06\u200b\u64cd\u4f5c\u6570\u200b\u6808\u9876\u200b\u6570\u636e\u200b\u5f39\u200b\u51fa\u200b\uff0c\u200b\u5b58\u5165\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u8868\u200b\u7684\u200b slot 1\n2: iinc       1, 1    \n</code></pre> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_71","title":"\u4ea4\u4e92\u200b\u89c4\u5219","text":"<p>\u200b\u5bf9\u4e8e\u200b volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u7684\u200b use \u200b\u4e0e\u200b load\u3001read \u200b\u64cd\u4f5c\u200b\u662f\u200b\u76f8\u5173\u8054\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53d8\u91cf\u200b\u4f7f\u7528\u200b\u524d\u200b\u5fc5\u987b\u200b\u5148\u200b\u4ece\u200b\u4e3b\u5b58\u200b\u52a0\u8f7d\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u7684\u200b assign \u200b\u4e0e\u200b store\u3001write \u200b\u64cd\u4f5c\u200b\u662f\u200b\u76f8\u5173\u8054\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53d8\u91cf\u200b\u4f7f\u7528\u200b\u540e\u200b\u5fc5\u987b\u200b\u540c\u6b65\u200b\u81f3\u200b\u4e3b\u5b58\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b 1 \u200b\u548c\u200b\u7ebf\u7a0b\u200b 2 \u200b\u8c01\u200b\u5148\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u6267\u884c\u200b read \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5148\u200b\u8fdb\u884c\u200b write \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u9632\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_72","title":"\u53cc\u7aef\u200b\u68c0\u9501","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_73","title":"\u68c0\u9501\u200b\u673a\u5236","text":"<p>Double-Checked Locking\uff1a\u200b\u53cc\u7aef\u200b\u68c0\u9501\u200b\u673a\u5236\u200b</p> <p>DCL\uff08\u200b\u53cc\u7aef\u200b\u68c0\u9501\u200b\uff09\u200b\u673a\u5236\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u539f\u56e0\u200b\u662f\u200b\u6709\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u52a0\u5165\u200b volatile \u200b\u53ef\u4ee5\u200b\u7981\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b</p> Java<pre><code>public final class Singleton {\n    private Singleton() { }\n    private static Singleton INSTANCE = null;\n\n    public static Singleton getInstance() {\n        if(INSTANCE == null) { // t2\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u5224\u65ad\u200b\u4e0d\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\n            // \u200b\u9996\u6b21\u200b\u8bbf\u95ee\u200b\u4f1a\u200b\u540c\u6b65\u200b\uff0c\u200b\u800c\u200b\u4e4b\u540e\u200b\u7684\u200b\u4f7f\u7528\u200b\u6ca1\u6709\u200b synchronized\n            synchronized(Singleton.class) {\n                // \u200b\u8fd9\u91cc\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u5224\u65ad\u200b\uff0c\u200b\u9632\u6b62\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u9501\u200b\u7684\u200b\u671f\u95f4\u200b\u5b8c\u6210\u200b\u4e86\u200b\u521d\u59cb\u5316\u200b\n                if (INSTANCE == null) { \n                    INSTANCE = new Singleton();\n                }\n            }\n        }\n        return INSTANCE;\n    }\n}\n</code></pre> <p>\u200b\u4e0d\u9501\u200b INSTANCE \u200b\u7684\u200b\u539f\u56e0\u200b\uff1a</p> <ul> <li>INSTANCE \u200b\u8981\u200b\u91cd\u65b0\u200b\u8d4b\u503c\u200b</li> <li>INSTANCE \u200b\u662f\u200b null\uff0c\u200b\u7ebf\u7a0b\u200b\u52a0\u9501\u200b\u4e4b\u524d\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5bf9\u8c61\u200b\u5934\u200b\uff0cnull \u200b\u6ca1\u6709\u200b\u5f15\u7528\u200b</li> </ul> <p>\u200b\u5b9e\u73b0\u200b\u7279\u70b9\u200b\uff1a </p> <ul> <li>\u200b\u61d2\u60f0\u200b\u521d\u59cb\u5316\u200b</li> <li>\u200b\u9996\u6b21\u200b\u4f7f\u7528\u200b getInstance() \u200b\u624d\u200b\u4f7f\u7528\u200b synchronized \u200b\u52a0\u9501\u200b\uff0c\u200b\u540e\u7eed\u200b\u4f7f\u7528\u200b\u65f6\u200b\u65e0\u9700\u200b\u52a0\u9501\u200b</li> <li>\u200b\u7b2c\u4e00\u4e2a\u200b if \u200b\u4f7f\u7528\u200b\u4e86\u200b INSTANCE \u200b\u53d8\u91cf\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u540c\u6b65\u200b\u5757\u200b\u4e4b\u5916\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u73af\u5883\u200b\u4e0b\u4f1a\u200b\u4ea7\u751f\u200b\u95ee\u9898\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#dcl","title":"DCL\u200b\u95ee\u9898","text":"<p>getInstance \u200b\u65b9\u6cd5\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b57\u8282\u200b\u7801\u4e3a\u200b\uff1a</p> Java<pre><code>0:  getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n3:  ifnonnull       37\n6:  ldc             #3      // class test/Singleton\n8:  dup\n9:  astore_0\n10: monitorenter\n11: getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n14: ifnonnull 27\n17: new             #3      // class test/Singleton\n20: dup\n21: invokespecial   #4      // Method \"&lt;init&gt;\":()V\n24: putstatic       #2      // Field INSTANCE:Ltest/Singleton;\n27: aload_0\n28: monitorexit\n29: goto 37\n32: astore_1\n33: aload_0\n34: monitorexit\n35: aload_1\n36: athrow\n37: getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n40: areturn\n</code></pre> <ul> <li>17 \u200b\u8868\u793a\u200b\u521b\u5efa\u5bf9\u8c61\u200b\uff0c\u200b\u5c06\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\u5165\u6808\u200b </li> <li>20 \u200b\u8868\u793a\u200b\u590d\u5236\u200b\u4e00\u4efd\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\uff0c\u200b\u5f15\u7528\u200b\u5730\u5740\u200b</li> <li>21 \u200b\u8868\u793a\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\uff0c\u200b\u8c03\u7528\u200b\u6784\u9020\u65b9\u6cd5\u200b\u521d\u59cb\u5316\u200b\u5bf9\u8c61\u200b</li> <li>24 \u200b\u8868\u793a\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\uff0c\u200b\u8d4b\u503c\u200b\u7ed9\u200b static INSTANCE</li> </ul> <p>\u200b\u6b65\u9aa4\u200b 21 \u200b\u548c\u200b 24 \u200b\u4e4b\u95f4\u200b\u4e0d\u200b\u5b58\u5728\u200b\u6570\u636e\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u800c\u4e14\u200b\u65e0\u8bba\u200b\u91cd\u6392\u200b\u524d\u540e\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u5728\u200b\u5355\u7ebf\u7a0b\u200b\u4e2d\u200b\u5e76\u200b\u6ca1\u6709\u200b\u6539\u53d8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u79cd\u200b\u91cd\u6392\u200b\u4f18\u5316\u200b\u662f\u200b\u5141\u8bb8\u200b\u7684\u200b</p> <ul> <li>\u200b\u5173\u952e\u5728\u4e8e\u200b 0:getstatic \u200b\u8fd9\u200b\u884c\u200b\u4ee3\u7801\u200b\u5728\u200b monitor \u200b\u63a7\u5236\u200b\u4e4b\u5916\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8d8a\u8fc7\u200b monitor \u200b\u8bfb\u53d6\u200b INSTANCE \u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5f53\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b INSTANCE \u200b\u4e0d\u200b\u4e3a\u200b null \u200b\u65f6\u200b\uff0c\u200b\u7531\u4e8e\u200b INSTANCE \u200b\u5b9e\u4f8b\u200b\u672a\u5fc5\u200b\u5df2\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b t2 \u200b\u62ff\u5230\u200b\u7684\u200b\u662f\u200b\u5c06\u200b\u662f\u200b\u4e00\u4e2a\u200b\u672a\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6bd5\u200b\u7684\u200b\u5355\u4f8b\u200b\u8fd4\u56de\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u9020\u6210\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u95ee\u9898\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_74","title":"\u89e3\u51b3\u200b\u65b9\u6cd5","text":"<p>\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u53ea\u4f1a\u200b\u4fdd\u8bc1\u200b\u4e32\u884c\u200b\u8bed\u4e49\u200b\u7684\u200b\u6267\u884c\u200b\u4e00\u81f4\u6027\u200b\uff08\u200b\u5355\u7ebf\u7a0b\u200b\uff09\uff0c\u200b\u4f46\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u5173\u7cfb\u200b\u591a\u7ebf\u7a0b\u200b\u95f4\u200b\u7684\u200b\u8bed\u4e49\u200b\u4e00\u81f4\u6027\u200b</p> <p>\u200b\u5f15\u5165\u200b volatile\uff0c\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u51fa\u73b0\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4ece\u800c\u200b\u4fdd\u8bc1\u200b\u5355\u4f8b\u200b\u6a21\u5f0f\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u6027\u200b\uff1a</p> Java<pre><code>private static volatile SingletonDemo INSTANCE = null;\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#ha-be","title":"ha-be","text":"<p>happens-before \u200b\u5148\u884c\u200b\u53d1\u751f\u200b</p> <p>Java \u200b\u5185\u5b58\u200b\u6a21\u578b\u200b\u5177\u5907\u200b\u4e00\u4e9b\u200b\u5148\u5929\u200b\u7684\u200b\u201c\u200b\u6709\u5e8f\u6027\u200b\u201d\uff0c\u200b\u5373\u200b\u4e0d\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u4efb\u4f55\u200b\u540c\u6b65\u200b\u624b\u6bb5\u200b\uff08volatile\u3001synchronized \u200b\u7b49\u200b\uff09\u200b\u5c31\u200b\u80fd\u591f\u200b\u5f97\u5230\u200b\u4fdd\u8bc1\u200b\u7684\u200b\u5b89\u5168\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u901a\u5e38\u200b\u4e5f\u200b\u79f0\u4e3a\u200b happens-before \u200b\u539f\u5219\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u53ef\u89c1\u200b\u6027\u200b\u4e0e\u200b\u6709\u5e8f\u6027\u200b\u7684\u200b\u4e00\u5957\u200b\u89c4\u5219\u200b\u603b\u7ed3\u200b</p> <p>\u200b\u4e0d\u200b\u7b26\u5408\u200b happens-before \u200b\u89c4\u5219\u200b\uff0cJMM \u200b\u5e76\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b\u548c\u200b\u6709\u5e8f\u6027\u200b</p> <ol> <li>\u200b\u7a0b\u5e8f\u200b\u6b21\u5e8f\u200b\u89c4\u5219\u200b (Program Order Rule)\uff1a\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5185\u200b\uff0c\u200b\u903b\u8f91\u200b\u4e0a\u200b\u4e66\u5199\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\u64cd\u4f5c\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u4e66\u5199\u200b\u5728\u200b\u540e\u9762\u200b\u7684\u200b\u64cd\u4f5c\u200b \uff0c\u200b\u56e0\u4e3a\u200b\u591a\u4e2a\u200b\u64cd\u4f5c\u200b\u4e4b\u95f4\u200b\u6709\u200b\u5148\u540e\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5bf9\u200b\u8fd9\u4e9b\u200b\u64cd\u4f5c\u200b\u8fdb\u884c\u200b\u91cd\u200b\u6392\u5e8f\u200b</li> <li>\u200b\u9501\u5b9a\u200b\u89c4\u5219\u200b (Monitor Lock Rule)\uff1a\u200b\u4e00\u4e2a\u200b unlock \u200b\u64cd\u4f5c\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u540e\u9762\u200b\uff08\u200b\u65f6\u95f4\u200b\u7684\u200b\u5148\u540e\u200b\uff09\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u9501\u200b\u7684\u200b lock \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7ebf\u7a0b\u200b\u89e3\u9501\u200b m \u200b\u4e4b\u524d\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u7684\u200b\u5199\u200b\uff08\u200b\u89e3\u9501\u200b\u524d\u4f1a\u200b\u5237\u65b0\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\uff09\uff0c\u200b\u5bf9\u4e8e\u200b\u63a5\u4e0b\u6765\u200b\u5bf9\u200b m \u200b\u52a0\u9501\u200b\u7684\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u8be5\u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u200b\u53ef\u89c1\u200b</li> <li>volatile \u200b\u53d8\u91cf\u200b\u89c4\u5219\u200b (Volatile Variable Rule)\uff1a\u200b\u5bf9\u200b volatile \u200b\u53d8\u91cf\u200b\u7684\u200b\u5199\u200b\u64cd\u4f5c\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u540e\u9762\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u200b</li> <li>\u200b\u4f20\u9012\u200b\u89c4\u5219\u200b (Transitivity)\uff1a\u200b\u5177\u6709\u200b\u4f20\u9012\u6027\u200b\uff0c\u200b\u5982\u679c\u200b\u64cd\u4f5c\u200b A \u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u64cd\u4f5c\u200b B\uff0c\u200b\u800c\u200b\u64cd\u4f5c\u200b B \u200b\u53c8\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u64cd\u4f5c\u200b C\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u5f97\u51fa\u200b\u64cd\u4f5c\u200b A \u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u64cd\u4f5c\u200b C</li> <li>\u200b\u7ebf\u7a0b\u200b\u542f\u52a8\u200b\u89c4\u5219\u200b (Thread Start Rule)\uff1aThread \u200b\u5bf9\u8c61\u200b\u7684\u200b start()\u200b\u65b9\u200b \u200b\u6cd5\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u200b</li> </ol> Java<pre><code>static int x = 10;//\u200b\u7ebf\u7a0b\u200b start \u200b\u524d\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u7684\u200b\u5199\u200b\uff0c\u200b\u5bf9\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u5f00\u59cb\u200b\u540e\u200b\u5bf9\u200b\u8be5\u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u200b\u53ef\u89c1\u200b\nnew Thread(()-&gt;{ System.out.println(x);  },\"t1\").start();\n</code></pre> <ol> <li>\u200b\u7ebf\u7a0b\u200b\u4e2d\u65ad\u200b\u89c4\u5219\u200b (Thread Interruption Rule)\uff1a\u200b\u5bf9\u200b\u7ebf\u7a0b\u200b interrupt() \u200b\u65b9\u6cd5\u200b\u7684\u200b\u8c03\u7528\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4ee3\u7801\u200b\u68c0\u6d4b\u200b\u5230\u200b\u4e2d\u65ad\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u53d1\u751f\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u7ec8\u6b62\u200b\u89c4\u5219\u200b (Thread Termination Rule)\uff1a\u200b\u7ebf\u7a0b\u200b\u4e2d\u200b\u6240\u6709\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ec8\u6b62\u200b\u68c0\u6d4b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b Thread.join() \u200b\u65b9\u6cd5\u200b\u7ed3\u675f\u200b\u3001Thread.isAlive() \u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\u624b\u6bb5\u200b\u68c0\u6d4b\u200b\u5230\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u7ec8\u6b62\u200b\u6267\u884c\u200b</li> <li>\u200b\u5bf9\u8c61\u200b\u7ec8\u7ed3\u200b\u89c4\u5219\u200b\uff08Finaizer Rule\uff09\uff1a\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b\uff08\u200b\u6784\u9020\u51fd\u6570\u200b\u6267\u884c\u200b\u7ed3\u675f\u200b\uff09\u200b\u5148\u884c\u200b\u53d1\u751f\u200b\u4e8e\u200b\u5b83\u200b\u7684\u200b finalize() \u200b\u65b9\u6cd5\u200b\u7684\u200b\u5f00\u59cb\u200b</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_75","title":"\u8bbe\u8ba1\u6a21\u5f0f","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_76","title":"\u7ec8\u6b62\u200b\u6a21\u5f0f","text":"<p>\u200b\u7ec8\u6b62\u200b\u6a21\u5f0f\u200b\u4e4b\u200b\u4e24\u200b\u9636\u6bb5\u200b\u7ec8\u6b62\u200b\u6a21\u5f0f\u200b\uff1a\u200b\u505c\u6b62\u200b\u6807\u8bb0\u200b\u7528\u200b volatile \u200b\u662f\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u8be5\u200b\u53d8\u91cf\u200b\u5728\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b</p> Java<pre><code>class TwoPhaseTermination {\n    // \u200b\u76d1\u63a7\u200b\u7ebf\u7a0b\u200b\n    private Thread monitor;\n    // \u200b\u505c\u6b62\u200b\u6807\u8bb0\u200b\n    private volatile boolean stop = false;;\n\n    // \u200b\u542f\u52a8\u200b\u76d1\u63a7\u200b\u7ebf\u7a0b\u200b\n    public void start() {\n        monitor = new Thread(() -&gt; {\n            while (true) {\n                Thread thread = Thread.currentThread();\n                if (stop) {\n                    System.out.println(\"\u200b\u540e\u7f6e\u200b\u5904\u7406\u200b\");\n                    break;\n                }\n                try {\n                    Thread.sleep(1000);// \u200b\u7761\u7720\u200b\n                    System.out.println(thread.getName() + \"\u200b\u6267\u884c\u200b\u76d1\u63a7\u200b\u8bb0\u5f55\u200b\");\n                } catch (InterruptedException e) {\n                    System.out.println(\"\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u9000\u51fa\u200b\u7761\u7720\u200b\");\n                }\n            }\n        });\n        monitor.start();\n    }\n\n    // \u200b\u505c\u6b62\u200b\u76d1\u63a7\u200b\u7ebf\u7a0b\u200b\n    public void stop() {\n        stop = true;\n        monitor.interrupt();// \u200b\u8ba9\u200b\u7ebf\u7a0b\u200b\u5c3d\u5feb\u200b\u9000\u51fa\u200bTimed Waiting\n    }\n}\n// \u200b\u6d4b\u8bd5\u200b\npublic static void main(String[] args) throws InterruptedException {\n    TwoPhaseTermination tpt = new TwoPhaseTermination();\n    tpt.start();\n    Thread.sleep(3500);\n    System.out.println(\"\u200b\u505c\u6b62\u200b\u76d1\u63a7\u200b\");\n    tpt.stop();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#balking","title":"Balking","text":"<p>Balking \uff08\u200b\u72b9\u8c6b\u200b\uff09\u200b\u6a21\u5f0f\u200b\u7528\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u53d1\u73b0\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6216\u672c\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u505a\u200b\u4e86\u200b\u67d0\u200b\u4e00\u4ef6\u200b\u76f8\u540c\u200b\u7684\u200b\u4e8b\u200b\uff0c\u200b\u90a3\u4e48\u200b\u672c\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u65e0\u9700\u200b\u518d\u200b\u505a\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b\u7ed3\u675f\u200b\u8fd4\u56de\u200b</p> Java<pre><code>public class MonitorService {\n    // \u200b\u7528\u6765\u200b\u8868\u793a\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u5728\u200b\u6267\u884c\u200b\u542f\u52a8\u200b\u4e86\u200b\n    private volatile boolean starting = false;\n    public void start() {\n        System.out.println(\"\u200b\u5c1d\u8bd5\u200b\u542f\u52a8\u200b\u76d1\u63a7\u200b\u7ebf\u7a0b\u200b...\");\n        synchronized (this) {\n            if (starting) {\n                return;\n            }\n            starting = true;\n        }\n        // \u200b\u771f\u6b63\u200b\u542f\u52a8\u200b\u76d1\u63a7\u200b\u7ebf\u7a0b\u200b...\n    }\n}\n</code></pre> <p>\u200b\u5bf9\u6bd4\u200b\u4fdd\u62a4\u6027\u200b\u6682\u505c\u200b\u6a21\u5f0f\u200b\uff1a\u200b\u4fdd\u62a4\u6027\u200b\u6682\u505c\u200b\u6a21\u5f0f\u200b\u7528\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\uff0c\u200b\u5f53\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u65f6\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b</p> <p>\u200b\u4f8b\u5b50\u200b\uff1a\u200b\u5e0c\u671b\u200b doInit() \u200b\u65b9\u6cd5\u200b\u4ec5\u200b\u88ab\u200b\u8c03\u7528\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e0b\u9762\u200b\u7684\u200b\u5b9e\u73b0\u200b\u51fa\u73b0\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a</p> <ul> <li>\u200b\u5f53\u200b t1 \u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b init() \u200b\u51c6\u5907\u200b doInit()\uff0ct2 \u200b\u7ebf\u7a0b\u200b\u8fdb\u6765\u200b\uff0cinitialized \u200b\u8fd8\u200b\u4e3a\u200bf alse\uff0c\u200b\u5219\u200b t2 \u200b\u5c31\u200b\u53c8\u200b\u521d\u59cb\u5316\u200b\u4e00\u6b21\u200b</li> <li>volatile \u200b\u9002\u5408\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5199\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8bfb\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u4ee3\u7801\u200b\u9700\u8981\u200b\u52a0\u9501\u200b</li> </ul> Java<pre><code>public class TestVolatile {\n    volatile boolean initialized = false;\n\n    void init() {\n        if (initialized) {\n            return;\n        }\n        doInit();\n        initialized = true;\n    }\n    private void doInit() {\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_77","title":"\u65e0\u9501","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#cas","title":"CAS","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_78","title":"\u539f\u7406","text":"<p>\u200b\u65e0\u9501\u200b\u7f16\u7a0b\u200b\uff1aLock Free</p> <p>CAS \u200b\u7684\u200b\u5168\u79f0\u200b\u662f\u200b Compare-And-Swap\uff0c\u200b\u662f\u200b CPU \u200b\u5e76\u53d1\u200b\u539f\u8bed\u200b</p> <ul> <li>CAS \u200b\u5e76\u53d1\u200b\u539f\u8bed\u200b\u4f53\u73b0\u200b\u5728\u200b Java \u200b\u8bed\u8a00\u200b\u4e2d\u200b\u5c31\u662f\u200b sun.misc.Unsafe \u200b\u7c7b\u200b\u7684\u200b\u5404\u4e2a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8c03\u7528\u200b UnSafe \u200b\u7c7b\u4e2d\u200b\u7684\u200b CAS \u200b\u65b9\u6cd5\u200b\uff0cJVM \u200b\u4f1a\u200b\u5b9e\u73b0\u200b\u51fa\u200b CAS \u200b\u6c47\u7f16\u200b\u6307\u4ee4\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u79cd\u200b\u5b8c\u5168\u200b\u4f9d\u8d56\u4e8e\u200b\u786c\u4ef6\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b</li> <li>CAS \u200b\u662f\u200b\u4e00\u79cd\u200b\u7cfb\u7edf\u200b\u539f\u8bed\u200b\uff0c\u200b\u539f\u8bed\u200b\u5c5e\u4e8e\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u8303\u7574\u200b\uff0c\u200b\u662f\u200b\u7531\u200b\u82e5\u5e72\u6761\u200b\u6307\u4ee4\u200b\u7ec4\u6210\u200b \uff0c\u200b\u7528\u4e8e\u200b\u5b8c\u6210\u200b\u67d0\u4e2a\u200b\u529f\u80fd\u200b\u7684\u200b\u4e00\u4e2a\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u539f\u8bed\u200b\u7684\u200b\u6267\u884c\u200b\u5fc5\u987b\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u88ab\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u6240\u4ee5\u200b CAS \u200b\u662f\u200b\u4e00\u6761\u200b CPU \u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u9020\u6210\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b</li> </ul> <p>\u200b\u5e95\u5c42\u200b\u539f\u7406\u200b\uff1aCAS \u200b\u7684\u200b\u5e95\u5c42\u200b\u662f\u200b <code>lock cmpxchg</code> \u200b\u6307\u4ee4\u200b\uff08X86 \u200b\u67b6\u6784\u200b\uff09\uff0c\u200b\u5728\u200b\u5355\u6838\u200b\u548c\u200b\u591a\u200b\u6838\u200b CPU \u200b\u4e0b\u200b\u90fd\u200b\u80fd\u591f\u200b\u4fdd\u8bc1\u200b\u6bd4\u8f83\u200b\u4ea4\u6362\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b</p> <ul> <li>\u200b\u7a0b\u5e8f\u200b\u662f\u200b\u5728\u200b\u5355\u6838\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f1a\u200b\u7701\u7565\u200b lock \u200b\u524d\u7f00\u200b\uff0c\u200b\u5355\u200b\u5904\u7406\u5668\u200b\u81ea\u8eab\u200b\u4f1a\u200b\u7ef4\u62a4\u200b\u5904\u7406\u5668\u200b\u5185\u200b\u7684\u200b\u987a\u5e8f\u200b\u4e00\u81f4\u6027\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b lock \u200b\u524d\u7f00\u200b\u7684\u200b\u5185\u5b58\u200b\u5c4f\u969c\u200b\u6548\u679c\u200b</li> <li>\u200b\u7a0b\u5e8f\u200b\u662f\u200b\u5728\u200b\u591a\u200b\u6838\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f1a\u4e3a\u200b cmpxchg \u200b\u6307\u4ee4\u200b\u52a0\u4e0a\u200b lock \u200b\u524d\u7f00\u200b\u3002\u200b\u5f53\u200b\u67d0\u4e2a\u200b\u6838\u200b\u6267\u884c\u200b\u5230\u200b\u5e26\u200b lock \u200b\u7684\u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0cCPU \u200b\u4f1a\u200b\u6267\u884c\u200b\u603b\u7ebf\u200b\u9501\u5b9a\u200b\u6216\u200b\u7f13\u5b58\u200b\u9501\u5b9a\u200b\uff0c\u200b\u5c06\u200b\u4fee\u6539\u200b\u7684\u200b\u53d8\u91cf\u200b\u5199\u5165\u200b\u5230\u200b\u4e3b\u5b58\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8c03\u5ea6\u200b\u673a\u5236\u200b\u6240\u200b\u6253\u65ad\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u5185\u5b58\u200b\u64cd\u4f5c\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b</li> </ul> <p>\u200b\u4f5c\u7528\u200b\uff1a\u200b\u6bd4\u8f83\u200b\u5f53\u524d\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b\u4e3b\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u540c\u200b\u5219\u200b\u6267\u884c\u200b\u89c4\u5b9a\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5426\u5219\u200b\u7ee7\u7eed\u200b\u6bd4\u8f83\u200b\u76f4\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u548c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u4e00\u81f4\u200b\u4e3a\u6b62\u200b</p> <p>CAS \u200b\u7279\u70b9\u200b\uff1a</p> <ul> <li>CAS \u200b\u4f53\u73b0\u200b\u7684\u200b\u662f\u200b\u65e0\u9501\u200b\u5e76\u53d1\u200b\u3001\u200b\u65e0\u200b\u963b\u585e\u200b\u5e76\u53d1\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u9677\u5165\u200b\u963b\u585e\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u9700\u8981\u200b\u9891\u7e41\u200b\u5207\u6362\u200b\u72b6\u6001\u200b\uff08\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff09</li> <li>CAS \u200b\u662f\u200b\u57fa\u4e8e\u200b\u4e50\u89c2\u200b\u9501\u200b\u7684\u200b\u601d\u60f3\u200b</li> </ul> <p>CAS \u200b\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u6267\u884c\u200b\u7684\u200b\u662f\u200b\u5faa\u73af\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u679c\u200b\u6bd4\u8f83\u200b\u4e0d\u200b\u6210\u529f\u200b\u4e00\u76f4\u200b\u5728\u200b\u5faa\u73af\u200b\uff0c\u200b\u6700\u5dee\u200b\u7684\u200b\u60c5\u51b5\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e00\u76f4\u200b\u53d6\u5230\u200b\u7684\u200b\u503c\u200b\u548c\u200b\u9884\u671f\u200b\u503c\u200b\u90fd\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b\u5bfc\u81f4\u200b\u9965\u997f\u200b\uff0c\u200b\u4f7f\u7528\u200b CAS \u200b\u7ebf\u7a0b\u200b\u6570\u200b\u4e0d\u8981\u200b\u8d85\u8fc7\u200b CPU \u200b\u7684\u200b\u6838\u5fc3\u200b\u6570\u200b\uff0c\u200b\u91c7\u7528\u200b\u5206\u6bb5\u200b CAS \u200b\u548c\u200b\u81ea\u52a8\u200b\u8fc1\u79fb\u200b\u673a\u5236\u200b</li> <li>\u200b\u53ea\u80fd\u200b\u4fdd\u8bc1\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5faa\u73af\u200b CAS \u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u591a\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u5faa\u73af\u200b CAS \u200b\u5c31\u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u64cd\u4f5c\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u53ea\u80fd\u200b\u7528\u9501\u6765\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b</li> <li>\u200b\u5f15\u51fa\u6765\u200b ABA \u200b\u95ee\u9898\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_79","title":"\u4e50\u89c2\u200b\u9501","text":"<p>CAS \u200b\u4e0e\u200b synchronized \u200b\u603b\u7ed3\u200b\uff1a</p> <ul> <li>synchronized \u200b\u662f\u4ece\u200b\u60b2\u89c2\u200b\u7684\u200b\u89d2\u5ea6\u200b\u51fa\u53d1\u200b\uff1a\u200b\u603b\u662f\u200b\u5047\u8bbe\u200b\u6700\u574f\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u53bb\u200b\u62ff\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u90fd\u200b\u8ba4\u4e3a\u200b\u522b\u4eba\u200b\u4f1a\u200b\u4fee\u6539\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bcf\u6b21\u200b\u5728\u200b\u62ff\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u90fd\u200b\u4f1a\u200b\u4e0a\u9501\u200b\uff0c\u200b\u8fd9\u6837\u200b\u522b\u4eba\u200b\u60f3\u200b\u62ff\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\u5c31\u200b\u4f1a\u200b\u963b\u585e\u200b\uff08\u200b\u5171\u4eab\u8d44\u6e90\u200b\u6bcf\u6b21\u200b\u53ea\u200b\u7ed9\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u963b\u585e\u200b\uff0c\u200b\u7528\u200b\u5b8c\u540e\u200b\u518d\u200b\u628a\u200b\u8d44\u6e90\u200b\u8f6c\u8ba9\u200b\u7ed9\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b synchronized \u200b\u4e5f\u200b\u79f0\u4e4b\u4e3a\u200b\u60b2\u89c2\u200b\u9501\u200b\uff0cReentrantLock \u200b\u4e5f\u200b\u662f\u200b\u4e00\u79cd\u200b\u60b2\u89c2\u200b\u9501\u200b\uff0c\u200b\u6027\u80fd\u200b\u8f83\u5dee\u200b</li> <li>CAS \u200b\u662f\u4ece\u200b\u4e50\u89c2\u200b\u7684\u200b\u89d2\u5ea6\u200b\u51fa\u53d1\u200b\uff1a\u200b\u603b\u662f\u200b\u5047\u8bbe\u200b\u6700\u597d\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u53bb\u200b\u62ff\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u90fd\u200b\u8ba4\u4e3a\u200b\u522b\u4eba\u200b\u4e0d\u4f1a\u200b\u4fee\u6539\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u4f1a\u200b\u4e0a\u9501\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u66f4\u65b0\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u5224\u65ad\u200b\u4e00\u4e0b\u200b\u5728\u6b64\u671f\u95f4\u200b\u522b\u4eba\u200b\u6709\u6ca1\u6709\u200b\u53bb\u200b\u66f4\u65b0\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\u3002\u200b\u5982\u679c\u200b\u522b\u4eba\u200b\u4fee\u6539\u200b\u8fc7\u200b\uff0c\u200b\u5219\u200b\u83b7\u53d6\u200b\u73b0\u5728\u200b\u6700\u65b0\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u522b\u4eba\u200b\u6ca1\u200b\u4fee\u6539\u200b\u8fc7\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4fee\u6539\u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u7684\u200b\u503c\u200b\uff0cCAS \u200b\u8fd9\u79cd\u200b\u673a\u5236\u200b\u4e5f\u200b\u79f0\u4e4b\u4e3a\u200b\u4e50\u89c2\u200b\u9501\u200b\uff0c\u200b\u7efc\u5408\u6027\u200b\u80fd\u200b\u8f83\u200b\u597d\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#atomic","title":"Atomic","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#api_1","title":"\u5e38\u7528\u200bAPI","text":"<p>\u200b\u5e38\u89c1\u200b\u539f\u5b50\u200b\u7c7b\u200b\uff1aAtomicInteger\u3001AtomicBoolean\u3001AtomicLong</p> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>public AtomicInteger()</code>\uff1a\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u9ed8\u8ba4\u503c\u200b\u4e3a\u200b 0 \u200b\u7684\u200b\u539f\u5b50\u200b\u578b\u200b Integer</li> <li><code>public AtomicInteger(int initialValue)</code>\uff1a\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u6307\u5b9a\u200b\u503c\u200b\u7684\u200b\u539f\u5b50\u200b\u578b\u200b Integer</li> </ul> <p>\u200b\u5e38\u7528\u200bAPI\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u4f5c\u7528\u200b public final int get() \u200b\u83b7\u53d6\u200b AtomicInteger \u200b\u7684\u200b\u503c\u200b public final int getAndIncrement() \u200b\u4ee5\u200b\u539f\u5b50\u200b\u65b9\u5f0f\u200b\u5c06\u200b\u5f53\u524d\u200b\u503c\u52a0\u200b 1\uff0c\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b\u81ea\u200b\u589e\u524d\u200b\u7684\u200b\u503c\u200b public final int incrementAndGet() \u200b\u4ee5\u200b\u539f\u5b50\u200b\u65b9\u5f0f\u200b\u5c06\u200b\u5f53\u524d\u200b\u503c\u52a0\u200b 1\uff0c\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b\u81ea\u200b\u589e\u540e\u200b\u7684\u200b\u503c\u200b public final int getAndSet(int value) \u200b\u4ee5\u200b\u539f\u5b50\u200b\u65b9\u5f0f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b newValue \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd4\u56de\u200b\u65e7\u503c\u200b public final int addAndGet(int data) \u200b\u4ee5\u200b\u539f\u5b50\u200b\u65b9\u5f0f\u200b\u5c06\u200b\u8f93\u5165\u200b\u7684\u200b\u6570\u503c\u200b\u4e0e\u200b\u5b9e\u4f8b\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u76f8\u52a0\u200b\u5e76\u200b\u8fd4\u56de\u200b\u5b9e\u4f8b\u200b\uff1aAtomicInteger \u200b\u91cc\u200b\u7684\u200b value","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_80","title":"\u539f\u7406\u200b\u5206\u6790","text":"<p>AtomicInteger \u200b\u539f\u7406\u200b\uff1a\u200b\u81ea\u65cb\u200b\u9501\u200b + CAS \u200b\u7b97\u6cd5\u200b</p> <p>CAS \u200b\u7b97\u6cd5\u200b\uff1a\u200b\u6709\u200b 3 \u200b\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\uff08\u200b\u5185\u5b58\u200b\u503c\u200b V\uff0c \u200b\u65e7\u200b\u7684\u200b\u9884\u671f\u200b\u503c\u200b A\uff0c\u200b\u8981\u200b\u4fee\u6539\u200b\u7684\u200b\u503c\u200b B\uff09</p> <ul> <li>\u200b\u5f53\u65e7\u200b\u7684\u200b\u9884\u671f\u200b\u503c\u200b A == \u200b\u5185\u5b58\u200b\u503c\u200b V \u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\uff0c\u200b\u5c06\u200b V \u200b\u6539\u4e3a\u200b B</li> <li>\u200b\u5f53\u65e7\u200b\u7684\u200b\u9884\u671f\u200b\u503c\u200b A != \u200b\u5185\u5b58\u200b\u503c\u200b V \u200b\u6b64\u65f6\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u73b0\u5728\u200b\u7684\u200b\u6700\u65b0\u200b\u503c\u200b\uff0c\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u7684\u200b\u52a8\u4f5c\u200b\u5c31\u662f\u200b\u81ea\u65cb\u200b </li> </ul> <p>\u200b\u5206\u6790\u200b getAndSet \u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>AtomicInteger\uff1a</li> </ul> Java<pre><code>public final int getAndSet(int newValue) {\n    /**\n    * this:       \u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\n    * valueOffset:    \u200b\u5185\u5b58\u200b\u504f\u79fb\u91cf\u200b\uff0c\u200b\u5185\u5b58\u5730\u5740\u200b\n    */\n    return unsafe.getAndSetInt(this, valueOffset, newValue);\n}\n</code></pre> <p>valueOffset\uff1a\u200b\u504f\u79fb\u91cf\u200b\u8868\u793a\u200b\u8be5\u200b\u53d8\u91cf\u503c\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u5730\u5740\u200b\u7684\u200b\u504f\u79fb\u200b\uff0cUnsafe \u200b\u5c31\u662f\u200b\u6839\u636e\u200b\u5185\u5b58\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\u83b7\u53d6\u6570\u636e\u200b</p> Java<pre><code>valueOffset = unsafe.objectFieldOffset\n                (AtomicInteger.class.getDeclaredField(\"value\"));\n//\u200b\u8c03\u7528\u200b\u672c\u5730\u200b\u65b9\u6cd5\u200b   --&gt;\npublic native long objectFieldOffset(Field var1);\n</code></pre> <ul> <li>unsafe \u200b\u7c7b\u200b\uff1a</li> </ul> Java<pre><code>// val1: AtomicInteger\u200b\u5bf9\u8c61\u200b\u672c\u8eab\u200b\uff0cvar2: \u200b\u8be5\u200b\u5bf9\u8c61\u200b\u503c\u5f97\u5f15\u7528\u200b\u5730\u5740\u200b\uff0cvar4: \u200b\u9700\u8981\u200b\u53d8\u52a8\u200b\u7684\u200b\u6570\u200b\npublic final int getAndSetInt(Object var1, long var2, int var4) {\n    int var5;\n    do {\n        // var5: \u200b\u7528\u200b var1 \u200b\u548c\u200b var2 \u200b\u627e\u5230\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u771f\u5b9e\u200b\u503c\u200b\n        var5 = this.getIntVolatile(var1, var2);\n    } while(!this.compareAndSwapInt(var1, var2, var5, var4));\n\n    return var5;\n}\n</code></pre> <p>var5\uff1a\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u62f7\u8d1d\u5230\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff08\u200b\u6bcf\u6b21\u200b\u90fd\u200b\u8981\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u62ff\u5230\u200b\u6700\u65b0\u200b\u7684\u200b\u503c\u200b\u5230\u200b\u672c\u5730\u200b\u5185\u5b58\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u6267\u884c\u200b <code>compareAndSwapInt()</code> \u200b\u518d\u200b\u548c\u200b\u4e3b\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5047\u8bbe\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b false\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4e00\u76f4\u200b\u6267\u884c\u200b while \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u76f4\u5230\u200b\u671f\u671b\u200b\u7684\u200b\u503c\u200b\u548c\u200b\u771f\u5b9e\u200b\u503c\u200b\u4e00\u6837\u200b\uff0c\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</p> <ul> <li>\u200b\u53d8\u91cf\u200b value \u200b\u7528\u200b volatile \u200b\u4fee\u9970\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u591a\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5185\u5b58\u200b\u53ef\u89c1\u200b\u6027\u200b\uff0c\u200b\u907f\u514d\u200b\u7ebf\u7a0b\u200b\u4ece\u200b\u5de5\u4f5c\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u5931\u6548\u200b\u7684\u200b\u53d8\u91cf\u200b</li> </ul> Java<pre><code>private volatile int value\n</code></pre> <p>CAS \u200b\u5fc5\u987b\u200b\u501f\u52a9\u200b volatile \u200b\u624d\u80fd\u200b\u8bfb\u53d6\u200b\u5230\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u6700\u65b0\u200b\u503c\u6765\u200b\u5b9e\u73b0\u200b\u6bd4\u8f83\u200b\u5e76\u200b\u4ea4\u6362\u200b\u7684\u200b\u6548\u679c\u200b</p> <p>\u200b\u5206\u6790\u200b getAndUpdate \u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>getAndUpdate\uff1a</li> </ul> Java<pre><code>public final int getAndUpdate(IntUnaryOperator updateFunction) {\n    int prev, next;\n    do {\n        prev = get(); //\u200b\u5f53\u524d\u200b\u503c\u200b\uff0ccas\u200b\u7684\u200b\u671f\u671b\u503c\u200b\n        next = updateFunction.applyAsInt(prev);//\u200b\u671f\u671b\u503c\u200b\u66f4\u65b0\u200b\u5230\u200b\u8be5\u503c\u200b\n    } while (!compareAndSet(prev, next));//\u200b\u81ea\u65cb\u200b\n    return prev;\n}\n</code></pre> <p>\u200b\u51fd\u6570\u200b\u5f0f\u200b\u63a5\u53e3\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u64cd\u4f5c\u200b\u903b\u8f91\u200b</p> Java<pre><code>AtomicInteger a = new AtomicInteger();\na.getAndUpdate(i -&gt; i + 10);\n</code></pre> <ul> <li>compareAndSet\uff1a</li> </ul> Java<pre><code>public final boolean compareAndSet(int expect, int update) {\n    /**\n    * this:       \u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\n    * valueOffset:    \u200b\u5185\u5b58\u200b\u504f\u79fb\u91cf\u200b\uff0c\u200b\u5185\u5b58\u5730\u5740\u200b\n    * expect:     \u200b\u671f\u671b\u200b\u7684\u200b\u503c\u200b\n    * update:         \u200b\u66f4\u65b0\u200b\u7684\u200b\u503c\u200b\n    */\n    return unsafe.compareAndSwapInt(this, valueOffset, expect, update);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_81","title":"\u539f\u5b50\u200b\u5f15\u7528","text":"<p>\u200b\u539f\u5b50\u200b\u5f15\u7528\u200b\uff1a\u200b\u5bf9\u200b Object \u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e00\u79cd\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u90fd\u200b\u662f\u200b\u539f\u5b50\u200b\u6027\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\u53d8\u91cf\u200b</p> <p>\u200b\u539f\u5b50\u200b\u5f15\u7528\u200b\u7c7b\u200b\uff1aAtomicReference\u3001AtomicStampedReference\u3001AtomicMarkableReference</p> <p>AtomicReference \u200b\u7c7b\u200b\uff1a</p> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a<code>AtomicReference&lt;T&gt; atomicReference = new AtomicReference&lt;T&gt;()</code></li> <li>\u200b\u5e38\u7528\u200b API\uff1a</li> <li><code>public final boolean compareAndSet(V expectedValue, V newValue)</code>\uff1aCAS \u200b\u64cd\u4f5c\u200b</li> <li><code>public final void set(V newValue)</code>\uff1a\u200b\u5c06\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b newValue </li> <li><code>public final V get()</code>\uff1a\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u503c\u200b</li> </ul> Java<pre><code>public class AtomicReferenceDemo {\n    public static void main(String[] args) {\n        Student s1 = new Student(33, \"z3\");\n\n        // \u200b\u521b\u5efa\u200b\u539f\u5b50\u200b\u5f15\u7528\u200b\u5305\u88c5\u200b\u7c7b\u200b\n        AtomicReference&lt;Student&gt; atomicReference = new AtomicReference&lt;&gt;();\n        // \u200b\u8bbe\u7f6e\u200b\u4e3b\u200b\u5185\u5b58\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u4e3a\u200bs1\n        atomicReference.set(s1);\n\n        // \u200b\u6bd4\u8f83\u200b\u5e76\u200b\u4ea4\u6362\u200b\uff0c\u200b\u5982\u679c\u200b\u73b0\u5728\u200b\u4e3b\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u4e3a\u200b z3\uff0c\u200b\u90a3\u4e48\u200b\u4ea4\u6362\u200b\u6210\u200b l4\n        while (true) {\n            Student s2 = new Student(44, \"l4\");\n            if (atomicReference.compareAndSet(s1, s2)) {\n                break;\n            }\n        }\n        System.out.println(atomicReference.get());\n    }\n}\n\nclass Student {\n    private int id;\n    private String name;\n    //\u3002\u3002\u3002\u3002\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_82","title":"\u539f\u5b50\u200b\u6570\u7ec4","text":"<p>\u200b\u539f\u5b50\u200b\u6570\u7ec4\u200b\u7c7b\u200b\uff1aAtomicIntegerArray\u3001AtomicLongArray\u3001AtomicReferenceArray</p> <p>AtomicIntegerArray \u200b\u7c7b\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>/**\n*   i       the index\n* expect    the expected value\n* update    the new value\n*/\npublic final boolean compareAndSet(int i, int expect, int update) {\n    return compareAndSetRaw(checkedByteOffset(i), expect, update);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_83","title":"\u539f\u5b50\u200b\u66f4\u65b0\u200b\u5668","text":"<p>\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\u5668\u7c7b\u200b\uff1aAtomicReferenceFieldUpdater\u3001AtomicIntegerFieldUpdater\u3001AtomicLongFieldUpdater</p> <p>\u200b\u5229\u7528\u200b\u5b57\u200b\u6bb5\u200b\u66f4\u65b0\u200b\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9488\u5bf9\u200b\u5bf9\u8c61\u200b\u7684\u200b\u67d0\u4e2a\u200b\u57df\u200b\uff08Field\uff09\u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ea\u80fd\u200b\u914d\u5408\u200b volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u51fa\u73b0\u5f02\u5e38\u200b <code>IllegalArgumentException: Must be volatile type</code></p> <p>\u200b\u5e38\u7528\u200b API\uff1a</p> <ul> <li><code>static &lt;U&gt; AtomicIntegerFieldUpdater&lt;U&gt; newUpdater(Class&lt;U&gt; c, String fieldName)</code>\uff1a\u200b\u6784\u9020\u65b9\u6cd5\u200b</li> <li><code>abstract boolean compareAndSet(T obj, int expect, int update)</code>\uff1aCAS</li> </ul> Java<pre><code>public class UpdateDemo {\n    private volatile int field;\n\n    public static void main(String[] args) {\n        AtomicIntegerFieldUpdater fieldUpdater = AtomicIntegerFieldUpdater\n                    .newUpdater(UpdateDemo.class, \"field\");\n        UpdateDemo updateDemo = new UpdateDemo();\n        fieldUpdater.compareAndSet(updateDemo, 0, 10);\n        System.out.println(updateDemo.field);//10\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_84","title":"\u539f\u5b50\u200b\u7d2f\u52a0\u5668","text":"<p>\u200b\u539f\u5b50\u200b\u7d2f\u52a0\u5668\u200b\u7c7b\u200b\uff1aLongAdder\u3001DoubleAdder\u3001LongAccumulator\u3001DoubleAccumulator </p> <p>LongAdder \u200b\u548c\u200b LongAccumulator \u200b\u533a\u522b\u200b\uff1a</p> <p>\u200b\u76f8\u540c\u70b9\u200b\uff1a</p> <ul> <li>LongAddr \u200b\u4e0e\u200b LongAccumulator \u200b\u7c7b\u200b\u90fd\u200b\u662f\u200b\u4f7f\u7528\u200b\u975e\u200b\u963b\u585e\u200b\u7b97\u6cd5\u200b CAS \u200b\u5b9e\u73b0\u200b\u7684\u200b</li> <li>LongAddr \u200b\u7c7b\u200b\u662f\u200b LongAccumulator \u200b\u7c7b\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7279\u4f8b\u200b\uff0c\u200b\u53ea\u662f\u200b LongAccumulator \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u66f4\u200b\u5f3a\u5927\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u7d2f\u52a0\u200b\u89c4\u5219\u200b\uff0c\u200b\u5f53\u200baccumulatorFunction \u200b\u4e3a\u200b null \u200b\u65f6\u200b\u5c31\u200b\u7b49\u4ef7\u200b\u4e8e\u200b LongAddr</li> </ul> <p>\u200b\u4e0d\u540c\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u8c03\u7528\u200b casBase \u200b\u65f6\u200b\uff0cLongAccumulator \u200b\u4f7f\u7528\u200b function.applyAsLong(b = base, x) \u200b\u6765\u200b\u8ba1\u7b97\u200b\uff0cLongAddr \u200b\u4f7f\u7528\u200b casBase(b = base, b + x) </li> <li>LongAccumulator \u200b\u7c7b\u200b\u529f\u80fd\u200b\u66f4\u52a0\u200b\u5f3a\u5927\u200b\uff0c\u200b\u6784\u9020\u65b9\u6cd5\u200b\u53c2\u6570\u200b\u4e2d\u200b</li> <li>accumulatorFunction \u200b\u662f\u200b\u4e00\u4e2a\u200b\u53cc\u76ee\u200b\u8fd0\u7b97\u5668\u200b\u63a5\u53e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u7d2f\u52a0\u200b\u89c4\u5219\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7d2f\u52a0\u200b\u6216\u8005\u200b\u76f8\u4e58\u200b\uff0c\u200b\u5176\u200b\u6839\u636e\u200b\u8f93\u5165\u200b\u7684\u200b\u4e24\u4e2a\u200b\u53c2\u6570\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u8ba1\u7b97\u200b\u503c\u200b\uff0cLongAdder \u200b\u5185\u7f6e\u200b\u7d2f\u52a0\u200b\u89c4\u5219\u200b</li> <li>identity \u200b\u5219\u200b\u662f\u200b LongAccumulator \u200b\u7d2f\u52a0\u5668\u200b\u7684\u200b\u521d\u59cb\u503c\u200b\uff0cLongAccumulator \u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u7d2f\u52a0\u5668\u200b\u63d0\u4f9b\u200b\u975e\u200b0\u200b\u7684\u200b\u521d\u59cb\u503c\u200b\uff0c\u200b\u800c\u200b LongAdder \u200b\u53ea\u80fd\u200b\u63d0\u4f9b\u200b\u9ed8\u8ba4\u200b\u7684\u200b 0</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#adder","title":"Adder","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_85","title":"\u4f18\u5316\u200b\u673a\u5236","text":"<p>LongAdder \u200b\u662f\u200b Java8 \u200b\u63d0\u4f9b\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u8ddf\u200b AtomicLong \u200b\u6709\u200b\u76f8\u540c\u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u4f46\u200b\u5bf9\u200b CAS \u200b\u673a\u5236\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4f18\u5316\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u4f7f\u7528\u200b\u5206\u6bb5\u200b CAS \u200b\u4ee5\u53ca\u200b\u81ea\u52a8\u200b\u5206\u6bb5\u200b\u8fc1\u79fb\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u5927\u5e45\u5ea6\u200b\u63d0\u5347\u200b\u591a\u7ebf\u7a0b\u200b\u9ad8\u200b\u5e76\u53d1\u200b\u6267\u884c\u200b CAS \u200b\u64cd\u4f5c\u200b\u7684\u200b\u6027\u80fd\u200b</p> <p>CAS \u200b\u5e95\u5c42\u200b\u5b9e\u73b0\u200b\u662f\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5faa\u73af\u200b\u4e2d\u200b\u4e0d\u65ad\u200b\u5730\u200b\u5c1d\u8bd5\u200b\u4fee\u6539\u200b\u76ee\u6807\u503c\u200b\uff0c\u200b\u76f4\u5230\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\u3002\u200b\u5982\u679c\u200b\u7ade\u4e89\u200b\u4e0d\u200b\u6fc0\u70c8\u200b\u4fee\u6539\u200b\u6210\u529f\u7387\u200b\u5f88\u200b\u9ad8\u200b\uff0c\u200b\u5426\u5219\u200b\u5931\u8d25\u7387\u200b\u5f88\u200b\u9ad8\u200b\uff0c\u200b\u5931\u8d25\u200b\u540e\u200b\u8fd9\u4e9b\u200b\u91cd\u590d\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u8017\u8d39\u200b\u6027\u80fd\u200b\uff08\u200b\u5bfc\u81f4\u200b\u5927\u91cf\u200b\u7ebf\u7a0b\u200b\u7a7a\u200b\u5faa\u73af\u200b\uff0c\u200b\u81ea\u200b\u65cb\u8f6c\u200b\uff09</p> <p>\u200b\u4f18\u5316\u200b\u6838\u5fc3\u601d\u60f3\u200b\uff1a\u200b\u6570\u636e\u200b\u5206\u79bb\u200b\uff0c\u200b\u5c06\u200b AtomicLong \u200b\u7684\u200b\u5355\u70b9\u200b\u7684\u200b\u66f4\u65b0\u200b\u538b\u529b\u200b\u5206\u62c5\u200b\u5230\u200b\u5404\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u7a7a\u95f4\u200b\u6362\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5728\u200b\u4f4e\u200b\u5e76\u53d1\u200b\u7684\u200b\u65f6\u5019\u200b\u76f4\u63a5\u200b\u66f4\u65b0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u969c\u200b\u548c\u200b AtomicLong \u200b\u7684\u200b\u6027\u80fd\u200b\u57fa\u672c\u4e00\u81f4\u200b\uff0c\u200b\u800c\u200b\u5728\u200b\u9ad8\u200b\u5e76\u53d1\u200b\u7684\u200b\u65f6\u5019\u200b\u901a\u8fc7\u200b\u5206\u6563\u200b\u51cf\u5c11\u200b\u7ade\u4e89\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u6027\u80fd\u200b</p> <p>\u200b\u5206\u6bb5\u200b CAS \u200b\u673a\u5236\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b\u65f6\u200b\uff0c\u200b\u521b\u5efa\u200b Cell \u200b\u6570\u7ec4\u200b\u7528\u4e8e\u200b\u5c06\u200b\u4e0d\u540c\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u64cd\u4f5c\u200b\u79bb\u6563\u200b\uff08\u200b\u901a\u8fc7\u200b hash \u200b\u7b49\u200b\u7b97\u6cd5\u200b\u6620\u5c04\u200b\uff09\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u8282\u70b9\u200b\u4e0a\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b\u591a\u4e2a\u200b\u7d2f\u52a0\u200b\u5355\u5143\u200b\uff08\u200b\u4f1a\u200b\u6839\u636e\u200b\u9700\u8981\u200b\u6269\u5bb9\u200b\uff0c\u200b\u6700\u5927\u200b\u4e3a\u200b CPU \u200b\u6838\u6570\u200b\uff09\uff0cTherad-0 \u200b\u7d2f\u52a0\u200b Cell[0]\uff0c\u200b\u800c\u200b Thread-1 \u200b\u7d2f\u52a0\u200b Cell[1] \u200b\u7b49\u200b\uff0c\u200b\u6700\u540e\u200b\u5c06\u200b\u7ed3\u679c\u200b\u6c47\u603b\u200b</li> <li>\u200b\u5728\u200b\u7d2f\u52a0\u200b\u65f6\u200b\u64cd\u4f5c\u200b\u7684\u200b\u4e0d\u540c\u200b\u7684\u200b Cell \u200b\u53d8\u91cf\u200b\uff0c\u200b\u56e0\u6b64\u200b\u51cf\u5c11\u200b\u4e86\u200b CAS \u200b\u91cd\u8bd5\u200b\u5931\u8d25\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b</li> </ul> <p>\u200b\u81ea\u52a8\u200b\u5206\u6bb5\u200b\u8fc1\u79fb\u200b\u673a\u5236\u200b\uff1a\u200b\u67d0\u4e2a\u200b Cell \u200b\u7684\u200b value \u200b\u6267\u884c\u200b CAS \u200b\u5931\u8d25\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5bfb\u627e\u200b\u53e6\u200b\u4e00\u4e2a\u200b Cell \u200b\u5206\u6bb5\u200b\u5185\u200b\u7684\u200b value \u200b\u503c\u200b\u8fdb\u884c\u200b CAS \u200b\u64cd\u4f5c\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_86","title":"\u4f2a\u200b\u5171\u4eab","text":"<p>Cell \u200b\u4e3a\u200b\u7d2f\u52a0\u200b\u5355\u5143\u200b\uff1a\u200b\u6570\u7ec4\u200b\u8bbf\u95ee\u200b\u7d22\u5f15\u200b\u662f\u200b\u901a\u8fc7\u200b Thread \u200b\u91cc\u200b\u7684\u200b threadLocalRandomProbe \u200b\u57df\u200b\u53d6\u6a21\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u57df\u200b\u662f\u200b ThreadLocalRandom \u200b\u66f4\u65b0\u200b\u7684\u200b</p> Java<pre><code>// Striped64.Cell\n@sun.misc.Contended static final class Cell {\n    volatile long value;\n    Cell(long x) { value = x; }\n    // \u200b\u7528\u200b cas \u200b\u65b9\u5f0f\u200b\u8fdb\u884c\u200b\u7d2f\u52a0\u200b, prev \u200b\u8868\u793a\u200b\u65e7\u503c\u200b, next \u200b\u8868\u793a\u200b\u65b0\u503c\u200b\n    final boolean cas(long prev, long next) {\n        return UNSAFE.compareAndSwapLong(this, valueOffset, prev, next);\n    }\n    // \u200b\u7701\u7565\u200b\u4e0d\u200b\u91cd\u8981\u200b\u4ee3\u7801\u200b\n}\n</code></pre> <p>Cell \u200b\u662f\u200b\u6570\u7ec4\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u662f\u200b\u8fde\u7eed\u200b\u5b58\u50a8\u200b\u7684\u200b\uff0c64 \u200b\u4f4d\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u4e00\u4e2a\u200b Cell \u200b\u4e3a\u200b 24 \u200b\u5b57\u8282\u200b\uff0816 \u200b\u5b57\u8282\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5934\u200b\u548c\u200b 8 \u200b\u5b57\u8282\u200b\u7684\u200b value\uff09\uff0c\u200b\u6bcf\u200b\u4e00\u4e2a\u200b cache line \u200b\u4e3a\u200b 64 \u200b\u5b57\u8282\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7f13\u5b58\u200b\u884c\u200b\u53ef\u4ee5\u200b\u5b58\u200b\u4e0b\u200b 2 \u200b\u4e2a\u200b\u7684\u200b Cell \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5f53\u200b Core-0 \u200b\u8981\u200b\u4fee\u6539\u200b Cell[0]\u3001Core-1 \u200b\u8981\u200b\u4fee\u6539\u200b Cell[1]\uff0c\u200b\u65e0\u8bba\u8c01\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\u90fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5f53\u524d\u200b\u7f13\u5b58\u200b\u884c\u200b\u5931\u6548\u200b\uff0c\u200b\u4ece\u800c\u200b\u5bfc\u81f4\u200b\u5bf9\u65b9\u200b\u7684\u200b\u6570\u636e\u200b\u5931\u6548\u200b\uff0c\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u53bb\u200b\u4e3b\u5b58\u200b\u83b7\u53d6\u200b\uff0c\u200b\u5f71\u54cd\u200b\u6548\u7387\u200b</p> <p></p> <p>@sun.misc.Contended\uff1a\u200b\u9632\u6b62\u200b\u7f13\u5b58\u200b\u884c\u4f2a\u200b\u5171\u4eab\u200b\uff0c\u200b\u5728\u200b\u4f7f\u7528\u200b\u6b64\u200b\u6ce8\u89e3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u6216\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u524d\u540e\u200b\u5404\u200b\u589e\u52a0\u200b 128 \u200b\u5b57\u8282\u200b\u5927\u5c0f\u200b\u7684\u200b padding\uff0c\u200b\u4f7f\u7528\u200b 2 \u200b\u500d\u200b\u4e8e\u200b\u5927\u591a\u6570\u200b\u786c\u4ef6\u200b\u7f13\u5b58\u200b\u884c\u8ba9\u200b CPU \u200b\u5c06\u200b\u5bf9\u8c61\u200b\u9884\u8bfb\u200b\u81f3\u200b\u7f13\u5b58\u200b\u65f6\u200b\u5360\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u9020\u6210\u200b\u5bf9\u65b9\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u5931\u6548\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_87","title":"\u6e90\u7801\u200b\u89e3\u6790","text":"<p>Striped64 \u200b\u7c7b\u200b\u6210\u5458\u200b\u5c5e\u6027\u200b\uff1a</p> Java<pre><code>// \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8ba1\u7b97\u673a\u200bCPU\u200b\u6570\u91cf\u200b\nstatic final int NCPU = Runtime.getRuntime().availableProcessors()\n// \u200b\u7d2f\u52a0\u200b\u5355\u5143\u200b\u6570\u7ec4\u200b, \u200b\u61d2\u60f0\u200b\u521d\u59cb\u5316\u200b\ntransient volatile Cell[] cells;\n// \u200b\u57fa\u7840\u200b\u503c\u200b, \u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b, \u200b\u5219\u200b\u7528\u200b cas \u200b\u7d2f\u52a0\u200b\u8fd9\u4e2a\u200b\u57df\u200b\uff0c\u200b\u5f53\u200b cells \u200b\u6269\u5bb9\u200b\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u5c06\u200b\u6570\u636e\u200b\u5199\u200b\u5230\u200b base \u200b\u4e2d\u200b\ntransient volatile long base;\n// \u200b\u5728\u200b cells \u200b\u521d\u59cb\u5316\u200b\u6216\u200b\u6269\u5bb9\u200b\u65f6\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b, \u200b\u901a\u8fc7\u200b CAS \u200b\u66f4\u65b0\u200b cellsBusy \u200b\u7f6e\u200b\u4e3a\u200b 1 \u200b\u6765\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u9501\u200b\ntransient volatile int cellsBusy;\n</code></pre> <p>\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>cells \u200b\u5360\u7528\u200b\u5185\u5b58\u200b\u662f\u200b\u76f8\u5bf9\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\uff0c\u200b\u662f\u200b\u60f0\u6027\u200b\u52a0\u8f7d\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u65e0\u200b\u7ade\u4e89\u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6b63\u5728\u200b\u521d\u59cb\u5316\u200b cells \u200b\u6570\u7ec4\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u66f4\u65b0\u200b base \u200b\u57df\u200b</li> <li>\u200b\u5728\u200b\u7b2c\u4e00\u6b21\u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b\u65f6\u200b\uff08casBase \u200b\u5931\u8d25\u200b\uff09\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5927\u5c0f\u200b\u4e3a\u200b 2 \u200b\u7684\u200b cells \u200b\u6570\u7ec4\u200b\uff0c\u200b\u5c06\u200b\u5f53\u524d\u200b\u7d2f\u52a0\u200b\u7684\u200b\u503c\u200b\u5305\u88c5\u200b\u4e3a\u200b Cell \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u653e\u5165\u200b\u6620\u5c04\u200b\u7684\u200b\u69fd\u200b\u4f4d\u200b\u4e0a\u200b</li> <li>\u200b\u5206\u6bb5\u200b\u7d2f\u52a0\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b cells \u200b\u69fd\u200b\u4f4d\u200b\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u65b0\u5efa\u200b Cell \u200b\u586b\u5145\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u7ade\u4e89\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u91cd\u65b0\u200b\u8ba1\u7b97\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u69fd\u200b\u4f4d\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u81ea\u65cb\u200b\u5c1d\u8bd5\u200b\u4fee\u6539\u200b</li> <li>\u200b\u5206\u6bb5\u200b\u8fc1\u79fb\u200b\u540e\u200b\u8fd8\u200b\u51fa\u73b0\u200b\u7ade\u4e89\u200b\u5c31\u200b\u4f1a\u200b\u6269\u5bb9\u200b cells \u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u4e3a\u200b\u539f\u6765\u200b\u7684\u200b\u4e24\u500d\u200b\uff0c\u200b\u7136\u540e\u200b rehash\uff0c\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u603b\u662f\u200b 2 \u200b\u7684\u200b n \u200b\u6b21\u200b\u5e42\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u6700\u5927\u200b\u4e3a\u200b CPU \u200b\u6838\u6570\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u8d85\u8fc7\u200b\uff0c\u200b\u5982\u679c\u200b\u6838\u6570\u200b\u662f\u200b 6 \u200b\u6838\u200b\uff0c\u200b\u6570\u7ec4\u200b\u6700\u957f\u200b\u662f\u200b 8 </li> </ul> <p>\u200b\u65b9\u6cd5\u200b\u5206\u6790\u200b\uff1a</p> <ul> <li>LongAdder#add\uff1a\u200b\u7d2f\u52a0\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>public void add(long x) {\n    // as \u200b\u4e3a\u200b\u7d2f\u52a0\u200b\u5355\u5143\u200b\u6570\u7ec4\u200b\u7684\u200b\u5f15\u7528\u200b\uff0cb \u200b\u4e3a\u200b\u57fa\u7840\u200b\u503c\u200b\uff0cv \u200b\u8868\u793a\u200b\u671f\u671b\u503c\u200b\n    // m \u200b\u8868\u793a\u200b cells \u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b - 1\uff0ca \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u547d\u4e2d\u200b\u7684\u200b cell \u200b\u5355\u5143\u683c\u200b\n    Cell[] as; long b, v; int m; Cell a;\n\n    // cells \u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\u8bf4\u660e\u200b cells \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u53d1\u751f\u200b\u4e86\u200b\u7ade\u4e89\u200b\uff0c\u200b\u53bb\u200b\u66f4\u65b0\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u69fd\u200b\u4f4d\u200b\n    // \u200b\u8fdb\u5165\u200b || \u200b\u540e\u200b\u7684\u200b\u903b\u8f91\u200b\u53bb\u200b\u66f4\u65b0\u200b base \u200b\u57df\u200b\uff0c\u200b\u66f4\u65b0\u200b\u5931\u8d25\u200b\u8868\u793a\u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b\u8fdb\u5165\u200b\u6761\u4ef6\u200b\n    if ((as = cells) != null || !casBase(b = base, b + x)) {\n        // uncontended \u200b\u4e3a\u200b true \u200b\u8868\u793a\u200b cell \u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\n        boolean uncontended = true;\n\n        // \u200b\u6761\u4ef6\u200b\u4e00\u200b: true \u200b\u8bf4\u660e\u200b cells \u200b\u672a\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u591a\u7ebf\u7a0b\u200b\u5199\u200b base \u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u521d\u59cb\u5316\u200b cells \u200b\u6570\u7ec4\u200b\n        //          fasle \u200b\u8bf4\u660e\u200b cells \u200b\u5df2\u7ecf\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\u5bfb\u627e\u200b\u81ea\u5df1\u200b\u7684\u200b cell \u200b\u53bb\u200b\u7d2f\u52a0\u200b\n        // \u200b\u6761\u4ef6\u200b\u4e8c\u200b: getProbe() \u200b\u83b7\u53d6\u200b hash \u200b\u503c\u200b\uff0c&amp; m \u200b\u7684\u200b\u903b\u8f91\u200b\u548c\u200b HashMap \u200b\u7684\u200b\u903b\u8f91\u200b\u76f8\u540c\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6563\u5217\u200b\u7684\u200b\u5747\u5300\u200b\u6027\u200b\n        //          true \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u4e0b\u200b\u6807\u7684\u200b cell \u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u9700\u8981\u200b\u521b\u5efa\u200b cell\n        //        false \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\u3010\u200b\u5c06\u200b x \u200b\u503c\u200b\u7d2f\u52a0\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u4e2d\u200b\u3011\n        // \u200b\u6761\u4ef6\u200b\u4e09\u200b: \u200b\u6709\u200b\u53d6\u53cd\u200b\u7b26\u53f7\u200b\uff0cfalse \u200b\u8bf4\u660e\u200b cas \u200b\u6210\u529f\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\uff0ctrue \u200b\u8bf4\u660e\u200b\u5931\u8d25\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u6709\u200b\u7ade\u4e89\u200b\n        if (as == null || (m = as.length - 1) &lt; 0 ||\n            (a = as[getProbe() &amp; m]) == null ||\n            !(uncontended = a.cas(v = a.value, v + x)))\n            longAccumulate(x, null, uncontended);\n          // \u3010uncontended \u200b\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u4e0a\u200b\u7d2f\u52a0\u200b\u5931\u8d25\u200b\u7684\u200b\u65f6\u5019\u200b\u624d\u200b\u4e3a\u200b false\uff0c\u200b\u5176\u4f59\u200b\u60c5\u51b5\u200b\u5747\u200b\u4e3a\u200b true\u3011\n    }\n}\n</code></pre> <ul> <li>Striped64#longAccumulate\uff1acell \u200b\u6570\u7ec4\u200b\u521b\u5efa\u200b</li> </ul> Java<pre><code>                          // x            null            false | true\nfinal void longAccumulate(long x, LongBinaryOperator fn, boolean wasUncontended) {\n    int h;\n    // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b cell, \u200b\u9700\u8981\u200b\u968f\u673a\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b hash \u200b\u503c\u200b\u7528\u6765\u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u5230\u200b cell\n    if ((h = getProbe()) == 0) {\n        // \u200b\u521d\u59cb\u5316\u200b probe\uff0c\u200b\u83b7\u53d6\u200b hash \u200b\u503c\u200b\n        ThreadLocalRandom.current(); \n        h = getProbe();   \n        // \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u80af\u5b9a\u200b\u662f\u200b\u5199\u5165\u200b\u5230\u200b\u4e86\u200b cells[0] \u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e0d\u200b\u628a\u200b\u5b83\u200b\u5f53\u505a\u200b\u4e00\u6b21\u200b\u771f\u6b63\u200b\u7684\u200b\u7ade\u4e89\u200b\n        wasUncontended = true;\n    }\n    // \u200b\u8868\u793a\u200b\u3010\u200b\u6269\u5bb9\u200b\u610f\u5411\u200b\u3011\uff0cfalse \u200b\u4e00\u5b9a\u200b\u4e0d\u4f1a\u200b\u6269\u5bb9\u200b\uff0ctrue \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6269\u5bb9\u200b\n    boolean collide = false; \n    //\u200b\u81ea\u65cb\u200b\n    for (;;) {\n        // as \u200b\u8868\u793a\u200bcells\u200b\u5f15\u7528\u200b\uff0ca \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u547d\u4e2d\u200b\u7684\u200b cell\uff0cn \u200b\u8868\u793a\u200b cells \u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\uff0cv \u200b\u8868\u793a\u200b \u200b\u671f\u671b\u503c\u200b\n        Cell[] as; Cell a; int n; long v;\n        // \u3010CASE1\u3011: \u200b\u8868\u793a\u200b cells \u200b\u5df2\u7ecf\u200b\u521d\u59cb\u5316\u200b\u4e86\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5e94\u8be5\u200b\u5c06\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u4e2d\u200b\n        if ((as = cells) != null &amp;&amp; (n = as.length) &gt; 0) {\n            // CASE1.1: true \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7d22\u5f15\u200b\u4e0b\u200b\u6807\u7684\u200b Cell \u200b\u4e3a\u200b null\uff0c\u200b\u9700\u8981\u200b\u521b\u5efa\u200b new Cell\n            if ((a = as[(n - 1) &amp; h]) == null) {\n                // \u200b\u5224\u65ad\u200b cellsBusy \u200b\u662f\u5426\u200b\u88ab\u200b\u9501\u200b\n                if (cellsBusy == 0) {   \n                    // \u200b\u521b\u5efa\u200b cell, \u200b\u521d\u59cb\u200b\u7d2f\u52a0\u200b\u503c\u4e3a\u200b x\n                    Cell r = new Cell(x);  \n                    // \u200b\u52a0\u9501\u200b\n                    if (cellsBusy == 0 &amp;&amp; casCellsBusy()) {\n                        // \u200b\u521b\u5efa\u200b\u6210\u529f\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8fdb\u5165\u200b\u3010\u200b\u521b\u5efa\u200b cell \u200b\u903b\u8f91\u200b\u3011\n                        boolean created = false;  \n                        try {\n                            Cell[] rs; int m, j;\n                            // \u200b\u628a\u200b\u5f53\u524d\u200b cells \u200b\u6570\u7ec4\u200b\u8d4b\u503c\u200b\u7ed9\u200b rs\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u200b\u4e3a\u200b null\n                            if ((rs = cells) != null &amp;&amp;\n                                (m = rs.length) &gt; 0 &amp;&amp;\n                                // \u200b\u518d\u6b21\u200b\u5224\u65ad\u200b\u9632\u6b62\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u521d\u59cb\u5316\u200b\u8fc7\u8be5\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u518d\u6b21\u200b\u521d\u59cb\u5316\u200b\u8be5\u200b\u4f4d\u7f6e\u200b\u4f1a\u200b\u9020\u6210\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\n                                // \u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u5224\u65ad\u200b\uff0c\u200b\u8fdb\u884c\u200b\u7684\u200b\u903b\u8f91\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5f71\u54cd\u200b\n                                rs[j = (m - 1) &amp; h] == null) {\n                                // \u200b\u628a\u200b\u65b0\u521b\u5efa\u200b\u7684\u200b cell \u200b\u586b\u5145\u200b\u81f3\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\n                                rs[j] = r;\n                                created = true;   // \u200b\u8868\u793a\u200b\u521b\u5efa\u200b\u5b8c\u6210\u200b\n                            }\n                        } finally {\n                            cellsBusy = 0;        // \u200b\u89e3\u9501\u200b\n                        }\n                        if (created)          // true \u200b\u8868\u793a\u200b\u521b\u5efa\u200b\u5b8c\u6210\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a8\u51fa\u200b\u5faa\u73af\u200b\u4e86\u200b\n                            break;\n                        continue;\n                    }\n                }\n                collide = false;\n            }\n            // CASE1.2: \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u6709\u200b\u7ade\u4e89\u200b, \u200b\u6539\u53d8\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b cell \u200b\u6765\u200b\u91cd\u8bd5\u200b cas\n            else if (!wasUncontended)\n                wasUncontended = true;\n            // CASE 1.3: \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b rehash \u200b\u8fc7\u200b\uff0c\u200b\u5982\u679c\u200b\u65b0\u200b\u547d\u4e2d\u200b\u7684\u200b cell \u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u7d2f\u52a0\u200b\uff0cfalse \u200b\u8bf4\u660e\u200b\u65b0\u200b\u547d\u4e2d\u200b\u4e5f\u200b\u6709\u200b\u7ade\u4e89\u200b\n            else if (a.cas(v = a.value, ((fn == null) ? v + x : fn.applyAsLong(v, x))))\n                break;\n            // CASE 1.4: cells \u200b\u957f\u5ea6\u200b\u5df2\u7ecf\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u6700\u5927\u200b\u957f\u5ea6\u200b CPU \u200b\u5185\u6838\u200b\u7684\u200b\u6570\u91cf\u200b\u6216\u8005\u200b\u5df2\u7ecf\u200b\u6269\u5bb9\u200b\n            else if (n &gt;= NCPU || cells != as)\n                collide = false;      // \u200b\u6269\u5bb9\u200b\u610f\u5411\u200b\u6539\u4e3a\u200bfalse\uff0c\u3010\u200b\u8868\u793a\u200b\u4e0d\u80fd\u200b\u6269\u5bb9\u200b\u4e86\u200b\u3011\n            // CASE 1.5: \u200b\u66f4\u6539\u200b\u6269\u5bb9\u200b\u610f\u5411\u200b\uff0c\u200b\u5982\u679c\u200b n &gt;= NCPU\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u6c38\u8fdc\u200b\u4e0d\u4f1a\u200b\u6267\u884c\u200b\u5230\u200b\uff0ccase1.4 \u200b\u6c38\u8fdc\u200b\u5148\u4e8e\u200b 1.5 \u200b\u6267\u884c\u200b\n            else if (!collide)\n                collide = true;\n            // CASE 1.6: \u3010\u200b\u6269\u5bb9\u200b\u903b\u8f91\u200b\u3011\uff0c\u200b\u8fdb\u884c\u200b\u52a0\u9501\u200b\n            else if (cellsBusy == 0 &amp;&amp; casCellsBusy()) {\n                try {\n                    // \u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u68c0\u67e5\u200b\uff0c\u200b\u9632\u6b62\u200b\u671f\u95f4\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6269\u5bb9\u200b\u4e86\u200b\n                    if (cells == as) {     \n                        // \u200b\u6269\u5bb9\u200b\u4e3a\u200b\u4ee5\u524d\u200b\u7684\u200b 2 \u200b\u500d\u200b\n                        Cell[] rs = new Cell[n &lt;&lt; 1];\n                        // \u200b\u904d\u5386\u200b\u79fb\u52a8\u200b\u503c\u200b\n                        for (int i = 0; i &lt; n; ++i)\n                            rs[i] = as[i];\n                        // \u200b\u628a\u200b\u6269\u5bb9\u200b\u540e\u200b\u7684\u200b\u5f15\u7528\u200b\u7ed9\u200b cells\n                        cells = rs;\n                    }\n                } finally {\n                    cellsBusy = 0;    // \u200b\u89e3\u9501\u200b\n                }\n                collide = false;  // \u200b\u6269\u5bb9\u200b\u610f\u5411\u200b\u6539\u4e3a\u200b false\uff0c\u200b\u8868\u793a\u200b\u4e0d\u200b\u6269\u5bb9\u200b\u4e86\u200b\n                continue;\n            }\n            // \u200b\u91cd\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b Hash \u200b\u503c\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u3010\u200b\u5206\u6bb5\u200b\u8fc1\u79fb\u200b\u673a\u5236\u200b\u3011\n            h = advanceProbe(h);\n        }\n\n        // \u3010CASE2\u3011: \u200b\u8fd0\u884c\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b cells \u200b\u8fd8\u200b\u672a\u200b\u521d\u59cb\u5316\u200b\uff0cas \u200b\u4e3a\u200bnull\n        // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u6ca1\u6709\u200b\u52a0\u9501\u200b\uff0c\u200b\u6ca1\u6709\u200b\u52a0\u9501\u200b\u5c31\u200b\u7528\u200b CAS \u200b\u52a0\u9501\u200b\n        // \u200b\u6761\u4ef6\u200b\u4e8c\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed9\u200b as \u200b\u8d4b\u503c\u200b\u4e4b\u540e\u200b\u4fee\u6539\u200b\u4e86\u200b cells\uff0c\u200b\u8fd9\u91cc\u200b\u4e0d\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u5224\u65ad\u200b\n        else if (cellsBusy == 0 &amp;&amp; cells == as &amp;&amp; casCellsBusy()) {\n            // \u200b\u521d\u59cb\u5316\u200b\u6807\u5fd7\u200b\uff0c\u200b\u5f00\u59cb\u200b \u3010\u200b\u521d\u59cb\u5316\u200b cells \u200b\u6570\u7ec4\u200b\u3011\n            boolean init = false;\n            try { \n                  // \u200b\u518d\u6b21\u200b\u5224\u65ad\u200b cells == as \u200b\u9632\u6b62\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u63d0\u524d\u200b\u521d\u59cb\u5316\u200b\u4e86\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u518d\u6b21\u200b\u521d\u59cb\u5316\u200b\u5bfc\u81f4\u200b\u4e22\u5931\u200b\u6570\u636e\u200b\n                // \u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u662f\u200b\u3010\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u91cd\u65b0\u200b\u68c0\u67e5\u200b\uff0c\u200b\u7ecf\u5178\u200b DCL\u3011\n                if (cells == as) {\n                    Cell[] rs = new Cell[2];  // \u200b\u521d\u59cb\u5316\u200b\u6570\u7ec4\u200b\u5927\u5c0f\u200b\u4e3a\u200b2\n                    rs[h &amp; 1] = new Cell(x);  // \u200b\u586b\u5145\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200bcell\n                    cells = rs;\n                    init = true;              // \u200b\u521d\u59cb\u5316\u200b\u6210\u529f\u200b\uff0c\u200b\u6807\u8bb0\u200b\u7f6e\u200b\u4e3a\u200b true\n                }\n            } finally {\n                cellsBusy = 0;                    // \u200b\u89e3\u9501\u200b\u554a\u200b\n            }\n            if (init)\n                break;                            // \u200b\u521d\u59cb\u5316\u200b\u6210\u529f\u200b\u76f4\u63a5\u200b\u8df3\u51fa\u200b\u81ea\u65cb\u200b\n        }\n        // \u3010CASE3\u3011: \u200b\u8fd0\u884c\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u521d\u59cb\u5316\u200b cells\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c06\u503c\u200b\u7d2f\u52a0\u200b\u5230\u200b base\uff0c\u200b\u7d2f\u52a0\u200b\u6210\u529f\u200b\u76f4\u63a5\u200b\u7ed3\u675f\u200b\u81ea\u65cb\u200b\n        else if (casBase(v = base, ((fn == null) ? v + x :\n                                    fn.applyAsLong(v, x))))\n            break; \n    }\n}\n</code></pre> <ul> <li>sum\uff1a\u200b\u83b7\u53d6\u200b\u6700\u7ec8\u200b\u7ed3\u679c\u200b\u901a\u8fc7\u200b sum \u200b\u6574\u5408\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6700\u7ec8\u200b\u4e00\u81f4\u6027\u200b\uff0c\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u5f3a\u200b\u4e00\u81f4\u6027\u200b</li> </ul> Java<pre><code>public long sum() {\n    Cell[] as = cells; Cell a;\n    long sum = base;\n    if (as != null) {\n        // \u200b\u904d\u5386\u200b \u200b\u7d2f\u52a0\u200b\n        for (int i = 0; i &lt; as.length; ++i) {\n            if ((a = as[i]) != null)\n                sum += a.value;\n        }\n    }\n    return sum;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#aba","title":"ABA","text":"<p>ABA \u200b\u95ee\u9898\u200b\uff1a\u200b\u5f53\u200b\u8fdb\u884c\u200b\u83b7\u53d6\u200b\u4e3b\u200b\u5185\u5b58\u200b\u503c\u65f6\u200b\uff0c\u200b\u8be5\u200b\u5185\u5b58\u200b\u503c\u200b\u5728\u200b\u5199\u200b\u5165\u4e3b\u200b\u5185\u5b58\u200b\u65f6\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u4fee\u6539\u200b\u4e86\u200b N \u200b\u6b21\u200b\uff0c\u200b\u4f46\u662f\u200b\u6700\u7ec8\u200b\u53c8\u200b\u6539\u6210\u200b\u539f\u6765\u200b\u7684\u200b\u503c\u200b</p> <p>\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5148\u200b\u628a\u200b A \u200b\u6539\u6210\u200b B \u200b\u53c8\u200b\u6539\u56de\u200b A\uff0c\u200b\u4e3b\u7ebf\u200b\u7a0b\u4ec5\u200b\u80fd\u200b\u5224\u65ad\u200b\u51fa\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\u4e0e\u200b\u6700\u521d\u200b\u503c\u200b A \u200b\u662f\u5426\u200b\u76f8\u540c\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u611f\u77e5\u200b\u5230\u200b\u8fd9\u79cd\u200b\u4ece\u200b A \u200b\u6539\u4e3a\u200b B \u200b\u53c8\u200b \u200b\u6539\u200b\u56de\u200b A \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8fd9\u65f6\u200b CAS \u200b\u867d\u7136\u200b\u6210\u529f\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fc7\u7a0b\u200b\u5b58\u5728\u200b\u95ee\u9898\u200b</p> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> <li><code>public AtomicStampedReference(V initialRef, int initialStamp)</code>\uff1a\u200b\u521d\u59cb\u503c\u200b\u548c\u200b\u521d\u59cb\u200b\u7248\u672c\u53f7\u200b</li> <li>\u200b\u5e38\u7528\u200bAPI\uff1a</li> <li><code>public boolean compareAndSet(V expectedReference, V newReference, int expectedStamp, int newStamp)</code>\uff1a\u200b\u671f\u671b\u200b\u5f15\u7528\u200b\u548c\u200b\u671f\u671b\u200b\u7248\u672c\u53f7\u200b\u90fd\u200b\u4e00\u81f4\u200b\u624d\u200b\u8fdb\u884c\u200b CAS \u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li><code>public void set(V newReference, int newStamp)</code>\uff1a\u200b\u8bbe\u7f6e\u200b\u503c\u200b\u548c\u200b\u7248\u672c\u53f7\u200b</li> <li><code>public V getReference()</code>\uff1a\u200b\u8fd4\u56de\u200b\u5f15\u7528\u200b\u7684\u200b\u503c\u200b</li> <li><code>public int getStamp()</code>\uff1a\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7248\u672c\u53f7\u200b</li> </ul> Java<pre><code>public static void main(String[] args) {\n    AtomicStampedReference&lt;Integer&gt; atomicReference = new AtomicStampedReference&lt;&gt;(100,1);\n    int startStamp = atomicReference.getStamp();\n    new Thread(() -&gt;{\n        int stamp = atomicReference.getStamp();\n        atomicReference.compareAndSet(100, 101, stamp, stamp + 1);\n        stamp = atomicReference.getStamp();\n        atomicReference.compareAndSet(101, 100, stamp, stamp + 1);\n    },\"t1\").start();\n\n    new Thread(() -&gt;{\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        if (!atomicReference.compareAndSet(100, 200, startStamp, startStamp + 1)) {\n            System.out.println(atomicReference.getReference());//100\n            System.out.println(Thread.currentThread().getName() + \"\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u5931\u8d25\u200b\");\n        }\n    },\"t2\").start();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#unsafe","title":"Unsafe","text":"<p>Unsafe \u200b\u662f\u200b CAS \u200b\u7684\u200b\u6838\u5fc3\u200b\u7c7b\u200b\uff0c\u200b\u7531\u4e8e\u200b Java \u200b\u65e0\u6cd5\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u5e95\u5c42\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u672c\u5730\u200b\uff08Native\uff09\u200b\u65b9\u6cd5\u200b\u6765\u200b\u8bbf\u95ee\u200b</p> <p>Unsafe \u200b\u7c7b\u200b\u5b58\u5728\u200b sun.misc \u200b\u5305\u200b\uff0c\u200b\u5176\u4e2d\u200b\u6240\u6709\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b native \u200b\u4fee\u9970\u200b\u7684\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5e95\u5c42\u200b\u8d44\u6e90\u200b\u6267\u884c\u200b\u76f8\u5e94\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u57fa\u4e8e\u200b\u8be5\u7c7b\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u7279\u5b9a\u200b\u7684\u200b\u5185\u5b58\u200b\u6570\u636e\u200b\uff0c\u200b\u5176\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u64cd\u4f5c\u200b\u7c7b\u4f3c\u200b C \u200b\u7684\u200b\u6307\u9488\u200b</p> <p>\u200b\u6a21\u62df\u200b\u5b9e\u73b0\u200b\u539f\u5b50\u200b\u6574\u6570\u200b\uff1a</p> Java<pre><code>public static void main(String[] args) {\n    MyAtomicInteger atomicInteger = new MyAtomicInteger(10);\n    if (atomicInteger.compareAndSwap(20)) {\n        System.out.println(atomicInteger.getValue());\n    }\n}\n\nclass MyAtomicInteger {\n    private static final Unsafe UNSAFE;\n    private static final long VALUE_OFFSET;\n    private volatile int value;\n\n    static {\n        try {\n            //Unsafe unsafe = Unsafe.getUnsafe()\u200b\u8fd9\u6837\u200b\u4f1a\u200b\u62a5\u9519\u200b\uff0c\u200b\u9700\u8981\u200b\u53cd\u5c04\u200b\u83b7\u53d6\u200b\n            Field theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\n            theUnsafe.setAccessible(true);\n            UNSAFE = (Unsafe) theUnsafe.get(null);\n            // \u200b\u83b7\u53d6\u200b value \u200b\u5c5e\u6027\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\uff0cvalue \u200b\u5c5e\u6027\u200b\u6307\u5411\u200b\u8be5\u200b\u5730\u5740\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8bbe\u7f6e\u200b\u8be5\u200b\u5730\u5740\u200b\u7684\u200b\u503c\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b value \u200b\u7684\u200b\u503c\u200b\n            VALUE_OFFSET = UNSAFE.objectFieldOffset(\n                           MyAtomicInteger.class.getDeclaredField(\"value\"));\n        } catch (NoSuchFieldException | IllegalAccessException e) {\n            e.printStackTrace();\n            throw new RuntimeException();\n        }\n    }\n\n    public MyAtomicInteger(int value) {\n        this.value = value;\n    }\n    public int getValue() {\n        return value;\n    }\n\n    public boolean compareAndSwap(int update) {\n        while (true) {\n            int prev = this.value;\n            int next = update;\n            //                          \u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b  \u200b\u5185\u5b58\u200b\u504f\u79fb\u91cf\u200b    \u200b\u671f\u671b\u503c\u200b \u200b\u66f4\u65b0\u200b\u503c\u200b\n            if (UNSAFE.compareAndSwapInt(this, VALUE_OFFSET, prev, update)) {\n                System.out.println(\"CAS\u200b\u6210\u529f\u200b\");\n                return true;\n            }\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#final","title":"final","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_88","title":"\u539f\u7406","text":"Java<pre><code>public class TestFinal {\n    final int a = 20;\n}\n</code></pre> <p>\u200b\u5b57\u8282\u200b\u7801\u200b\uff1a</p> Java<pre><code>0: aload_0\n1: invokespecial #1 // Method java/lang/Object.\"&lt;init&gt;\":()V\n4: aload_0\n5: bipush 20        // \u200b\u5c06\u503c\u200b\u76f4\u63a5\u200b\u653e\u5165\u200b\u6808\u4e2d\u200b\n7: putfield #2      // Field a:I\n&lt;-- \u200b\u5199\u200b\u5c4f\u969c\u200b\n10: return\n</code></pre> <p>final \u200b\u53d8\u91cf\u200b\u7684\u200b\u8d4b\u503c\u200b\u901a\u8fc7\u200b putfield \u200b\u6307\u4ee4\u200b\u6765\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5728\u200b\u8fd9\u6761\u200b\u6307\u4ee4\u200b\u4e4b\u540e\u200b\u4e5f\u200b\u4f1a\u200b\u52a0\u5165\u200b\u5199\u200b\u5c4f\u969c\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u8bfb\u5230\u200b\u5b83\u200b\u7684\u200b\u503c\u65f6\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u4e3a\u200b 0 \u200b\u7684\u200b\u60c5\u51b5\u200b</p> <p>\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b final \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b</p> <ul> <li>\u200b\u590d\u5236\u200b\u4e00\u4efd\u200b\u653e\u5165\u200b\u6808\u4e2d\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u6548\u7387\u9ad8\u200b</li> <li>\u200b\u5927\u4e8e\u200b short \u200b\u6700\u5927\u503c\u200b\u4f1a\u200b\u5c06\u200b\u5176\u200b\u590d\u5236\u5230\u200b\u7c7b\u200b\u7684\u200b\u5e38\u91cf\u200b\u6c60\u200b\uff0c\u200b\u8bbf\u95ee\u200b\u65f6\u200b\u4ece\u200b\u5e38\u91cf\u200b\u6c60\u200b\u83b7\u53d6\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_89","title":"\u4e0d\u53ef\u200b\u53d8","text":"<p>\u200b\u4e0d\u53ef\u200b\u53d8\u200b\uff1a\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u4e0d\u200b\u80fd\u591f\u200b\u4fee\u6539\u200b\u5176\u200b\u5185\u90e8\u200b\u72b6\u6001\u200b\uff08\u200b\u5c5e\u6027\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u662f\u200b\u4e0d\u53ef\u200b\u53d8\u200b\u5bf9\u8c61\u200b</p> <p>\u200b\u4e0d\u53ef\u200b\u53d8\u200b\u5bf9\u8c61\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u4e0d\u200b\u5b58\u5728\u200b\u5e76\u53d1\u200b\u4fee\u6539\u200b\u548c\u200b\u53ef\u89c1\u200b\u6027\u200b\u95ee\u9898\u200b\uff0c\u200b\u662f\u200b\u53e6\u200b\u4e00\u79cd\u200b\u907f\u514d\u200b\u7ade\u4e89\u200b\u7684\u200b\u65b9\u5f0f\u200b</p> <p>String \u200b\u7c7b\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u53ef\u200b\u53d8\u200b\u7684\u200b\uff0c\u200b\u8be5\u7c7b\u200b\u548c\u200b\u7c7b\u200b\u4e2d\u200b\u6240\u6709\u200b\u5c5e\u6027\u200b\u90fd\u200b\u662f\u200b final \u200b\u7684\u200b</p> <ul> <li>\u200b\u7c7b\u7528\u200b final \u200b\u4fee\u9970\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u8be5\u7c7b\u200b\u4e2d\u200b\u7684\u200b\u65b9\u6cd5\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u8986\u76d6\u200b\uff0c\u200b\u9632\u6b62\u200b\u5b50\u7c7b\u200b\u65e0\u610f\u95f4\u200b\u7834\u574f\u200b\u4e0d\u200b\u53ef\u53d8\u6027\u200b</li> <li>\u200b\u65e0\u200b\u5199\u5165\u200b\u65b9\u6cd5\u200b\uff08set\uff09\u200b\u786e\u4fdd\u200b\u5916\u90e8\u200b\u4e0d\u80fd\u200b\u5bf9\u200b\u5185\u90e8\u200b\u5c5e\u6027\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b</li> <li>\u200b\u5c5e\u6027\u200b\u7528\u200b final \u200b\u4fee\u9970\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u8be5\u200b\u5c5e\u6027\u200b\u662f\u200b\u53ea\u8bfb\u200b\u7684\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b</li> </ul> Java<pre><code>public final class String\n    implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence {\n    /** The value is used for character storage. */\n    private final char value[];\n    //....\n}\n</code></pre> <ul> <li>\u200b\u66f4\u6539\u200b String \u200b\u7c7b\u200b\u6570\u636e\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u6784\u9020\u200b\u65b0\u200b\u5b57\u7b26\u4e32\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u751f\u6210\u200b\u65b0\u200b\u7684\u200b char[] value\uff0c\u200b\u901a\u8fc7\u200b\u521b\u5efa\u200b\u526f\u672c\u200b\u5bf9\u8c61\u200b\u6765\u200b\u907f\u514d\u200b\u5171\u4eab\u200b\u7684\u200b\u65b9\u5f0f\u200b\u79f0\u4e4b\u4e3a\u200b\u4fdd\u62a4\u6027\u200b\u62f7\u8d1d\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#state","title":"State","text":"<p>\u200b\u65e0\u200b\u72b6\u6001\u200b\uff1a\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\u4fdd\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u79f0\u4e3a\u200b\u72b6\u6001\u200b\u4fe1\u606f\u200b\uff0c\u200b\u65e0\u200b\u72b6\u6001\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b</p> <p>Servlet \u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u5176\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u4e00\u822c\u200b\u4e0d\u200b\u4e3a\u200b Servlet \u200b\u8bbe\u7f6e\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\u7684\u200b\u7c7b\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#local","title":"Local","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_90","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>ThreadLocal \u200b\u7c7b\u200b\u7528\u6765\u200b\u63d0\u4f9b\u200b\u7ebf\u7a0b\u200b\u5185\u90e8\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u53d8\u91cf\u200b\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u73af\u5883\u200b\u4e0b\u200b\u8bbf\u95ee\u200b\uff08\u200b\u901a\u8fc7\u200b get \u200b\u548c\u200b set \u200b\u65b9\u6cd5\u200b\u8bbf\u95ee\u200b\uff09\u200b\u65f6\u80fd\u200b\u4fdd\u8bc1\u200b\u5404\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53d8\u91cf\u200b\u76f8\u5bf9\u200b\u72ec\u7acb\u200b\u4e8e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u7684\u200b\u53d8\u91cf\u200b\uff0c\u200b\u5206\u914d\u200b\u5728\u200b\u5806\u200b\u5185\u200b\u7684\u200b TLAB \u200b\u4e2d\u200b</p> <p>ThreadLocal \u200b\u5b9e\u4f8b\u200b\u901a\u5e38\u200b\u6765\u8bf4\u200b\u90fd\u200b\u662f\u200b <code>private static</code> \u200b\u7c7b\u578b\u200b\u7684\u200b\uff0c\u200b\u5c5e\u4e8e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u672c\u5730\u200b\u53d8\u91cf\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5173\u8054\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b ThreadLocal \u200b\u4e2d\u200b\u4fdd\u5b58\u200b\u4e00\u4efd\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u72ec\u6709\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b</p> <p>ThreadLocal \u200b\u4f5c\u7528\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u5e76\u53d1\u200b\uff1a\u200b\u5e94\u7528\u200b\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u5e76\u53d1\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b</li> <li>\u200b\u4f20\u9012\u6570\u636e\u200b\uff1a\u200b\u901a\u8fc7\u200b ThreadLocal \u200b\u5b9e\u73b0\u200b\u5728\u200b\u540c\u4e00\u200b\u7ebf\u7a0b\u200b\u4e0d\u540c\u200b\u51fd\u6570\u200b\u6216\u200b\u7ec4\u4ef6\u200b\u4e2d\u200b\u4f20\u9012\u200b\u516c\u5171\u200b\u53d8\u91cf\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4f20\u9012\u200b\u590d\u6742\u5ea6\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u9694\u79bb\u200b\uff1a\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53d8\u91cf\u200b\u90fd\u200b\u662f\u200b\u72ec\u7acb\u200b\u7684\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u4e92\u76f8\u200b\u5f71\u54cd\u200b</li> </ul> <p>\u200b\u5bf9\u6bd4\u200b synchronized\uff1a</p> synchronized ThreadLocal \u200b\u539f\u7406\u200b \u200b\u540c\u6b65\u200b\u673a\u5236\u200b\u91c7\u7528\u200b\u4ee5\u200b\u65f6\u95f4\u200b\u6362\u200b\u7a7a\u95f4\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ea\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4efd\u200b\u53d8\u91cf\u200b\uff0c\u200b\u8ba9\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6392\u961f\u200b\u8bbf\u95ee\u200b ThreadLocal \u200b\u91c7\u7528\u200b\u4ee5\u200b\u7a7a\u95f4\u200b\u6362\u200b\u65f6\u95f4\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4efd\u200b\u53d8\u91cf\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u540c\u65f6\u200b\u8bbf\u95ee\u200b\u800c\u200b\u76f8\u200b\u4e0d\u200b\u5e72\u6270\u200b \u200b\u4fa7\u91cd\u70b9\u200b \u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u8bbf\u95ee\u200b\u8d44\u6e90\u200b\u7684\u200b\u540c\u6b65\u200b \u200b\u591a\u7ebf\u7a0b\u200b\u4e2d\u200b\u8ba9\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u6570\u636e\u200b\u76f8\u4e92\u200b\u9694\u79bb","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_91","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_92","title":"\u5e38\u7528\u200b\u65b9\u6cd5","text":"\u65b9\u6cd5\u200b \u200b\u63cf\u8ff0\u200b ThreadLocal&lt;&gt;() \u200b\u521b\u5efa\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b protected T initialValue() \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u7684\u200b\u521d\u59cb\u503c\u200b public void set( T value) \u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b public T get() \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b public void remove() \u200b\u79fb\u9664\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b Java<pre><code>public class MyDemo {\n\n    private static ThreadLocal&lt;String&gt; tl = new ThreadLocal&lt;&gt;();\n\n    private String content;\n\n    private String getContent() {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u7684\u200b\u53d8\u91cf\u200b\n        return tl.get();\n    }\n\n    private void setContent(String content) {\n        // \u200b\u53d8\u91cf\u200bcontent\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n        tl.set(content);\n    }\n\n    public static void main(String[] args) {\n        MyDemo demo = new MyDemo();\n        for (int i = 0; i &lt; 5; i++) {\n            Thread thread = new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    // \u200b\u8bbe\u7f6e\u200b\u6570\u636e\u200b\n                    demo.setContent(Thread.currentThread().getName() + \"\u200b\u7684\u200b\u6570\u636e\u200b\");\n                    System.out.println(\"-----------------------\");\n                    System.out.println(Thread.currentThread().getName() + \"---&gt;\" + demo.getContent());\n                }\n            });\n            thread.setName(\"\u200b\u7ebf\u7a0b\u200b\" + i);\n            thread.start();\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_93","title":"\u5e94\u7528\u200b\u573a\u666f","text":"<p>ThreadLocal \u200b\u9002\u7528\u200b\u4e8e\u200b\u4e0b\u9762\u200b\u4e24\u79cd\u200b\u573a\u666f\u200b\uff1a</p> <ul> <li>\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u6709\u200b\u81ea\u5df1\u200b\u5355\u72ec\u200b\u7684\u200b\u5b9e\u4f8b\u200b</li> <li>\u200b\u5b9e\u4f8b\u200b\u9700\u8981\u200b\u5728\u200b\u591a\u4e2a\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u5171\u4eab\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u88ab\u200b\u591a\u7ebf\u7a0b\u200b\u5171\u4eab\u200b</li> </ul> <p>ThreadLocal \u200b\u65b9\u6848\u200b\u6709\u200b\u4e24\u4e2a\u200b\u7a81\u51fa\u200b\u7684\u200b\u4f18\u52bf\u200b\uff1a </p> <ol> <li>\u200b\u4f20\u9012\u6570\u636e\u200b\uff1a\u200b\u4fdd\u5b58\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b\u9700\u8981\u200b\u7684\u200b\u5730\u65b9\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\uff0c\u200b\u907f\u514d\u200b\u53c2\u6570\u200b\u76f4\u63a5\u200b\u4f20\u9012\u200b\u5e26\u6765\u200b\u7684\u200b\u4ee3\u7801\u200b\u8026\u5408\u200b\u95ee\u9898\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u9694\u79bb\u200b\uff1a\u200b\u5404\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u6570\u636e\u200b\u76f8\u4e92\u200b\u9694\u79bb\u200b\u5374\u200b\u53c8\u200b\u5177\u5907\u200b\u5e76\u53d1\u200b\u6027\u200b\uff0c\u200b\u907f\u514d\u200b\u540c\u6b65\u200b\u65b9\u5f0f\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u635f\u5931\u200b</li> </ol> <p>ThreadLocal \u200b\u7528\u4e8e\u200b\u6570\u636e\u200b\u8fde\u63a5\u200b\u7684\u200b\u4e8b\u52a1\u7ba1\u7406\u200b\uff1a</p> Java<pre><code>public class JdbcUtils {\n    // ThreadLocal\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5c06\u200bconnection\u200b\u7ed1\u5b9a\u200b\u5728\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e2d\u200b\n    private static final ThreadLocal&lt;Connection&gt; tl = new ThreadLocal();\n    // c3p0 \u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u6c60\u200b\u5bf9\u8c61\u200b\u5c5e\u6027\u200b\n    private static final ComboPooledDataSource ds = new ComboPooledDataSource();\n    // \u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\n    public static Connection getConnection() throws SQLException {\n        //\u200b\u53d6\u51fa\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u7684\u200bconnection\u200b\u5bf9\u8c61\u200b\n        Connection conn = tl.get();\n        if (conn == null) {\n            //\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\uff0c\u200b\u5219\u200b\u4ece\u200b\u8fde\u63a5\u6c60\u200b\u4e2d\u200b\u53d6\u51fa\u200b\n            conn = ds.getConnection();\n            //\u200b\u518d\u200b\u5c06\u200bconnection\u200b\u5bf9\u8c61\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u64cd\u4f5c\u200b\n            tl.set(conn);\n        }\n        return conn;\n    }\n    // ...\n}\n</code></pre> <p>\u200b\u7528\u200b ThreadLocal \u200b\u4f7f\u200b SimpleDateFormat \u200b\u4ece\u200b\u72ec\u4eab\u200b\u53d8\u91cf\u200b\u53d8\u6210\u200b\u5355\u4e2a\u200b\u7ebf\u7a0b\u200b\u53d8\u91cf\u200b\uff1a</p> Java<pre><code>public class ThreadLocalDateUtil {\n    private static ThreadLocal&lt;DateFormat&gt; threadLocal = new ThreadLocal&lt;DateFormat&gt;() {\n        @Override\n        protected DateFormat initialValue() {\n            return new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n        }\n    };\n\n    public static Date parse(String dateStr) throws ParseException {\n        return threadLocal.get().parse(dateStr);\n    }\n\n    public static String format(Date date) {\n        return threadLocal.get().format(date);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_94","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_95","title":"\u5e95\u5c42\u200b\u7ed3\u6784","text":"<p>JDK8 \u200b\u4ee5\u524d\u200b\uff1a\u200b\u6bcf\u4e2a\u200b ThreadLocal \u200b\u90fd\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b Map\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u7ebf\u7a0b\u200b\u4f5c\u4e3a\u200b Map \u200b\u7684\u200b key\uff0c\u200b\u8981\u200b\u5b58\u50a8\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u4f5c\u4e3a\u200b Map \u200b\u7684\u200b value\uff0c\u200b\u8fbe\u5230\u200b\u5404\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u9694\u79bb\u200b\u7684\u200b\u6548\u679c\u200b\u3002\u200b\u8fd9\u79cd\u200b\u7ed3\u6784\u200b\u4f1a\u200b\u9020\u6210\u200b Map \u200b\u7ed3\u6784\u200b\u8fc7\u5927\u200b\u548c\u200b\u5185\u5b58\u200b\u6cc4\u9732\u200b\uff0c\u200b\u56e0\u4e3a\u200b Thread \u200b\u505c\u6b62\u200b\u540e\u200b\u65e0\u6cd5\u200b\u901a\u8fc7\u200b key \u200b\u5220\u9664\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u636e\u200b</p> <p></p> <p>JDK8 \u200b\u4ee5\u540e\u200b\uff1a\u200b\u6bcf\u4e2a\u200b Thread \u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b ThreadLocalMap\uff0c\u200b\u8fd9\u4e2a\u200b Map \u200b\u7684\u200b key \u200b\u662f\u200b ThreadLocal \u200b\u5b9e\u4f8b\u200b\u672c\u8eab\u200b\uff0cvalue \u200b\u662f\u200b\u771f\u6b63\u200b\u8981\u200b\u5b58\u50a8\u200b\u7684\u200b\u503c\u200b</p> <ul> <li>\u200b\u6bcf\u4e2a\u200b Thread \u200b\u7ebf\u7a0b\u200b\u5185\u90e8\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b Map (ThreadLocalMap)</li> <li>Map \u200b\u91cc\u9762\u200b\u5b58\u50a8\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b\uff08key\uff09\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u79c1\u6709\u200b\u53d8\u91cf\u200b\uff08value\uff09</li> <li>Thread \u200b\u5185\u90e8\u200b\u7684\u200b Map \u200b\u662f\u200b\u7531\u200b ThreadLocal \u200b\u7ef4\u62a4\u200b\u7684\u200b\uff0c\u200b\u7531\u200b ThreadLocal \u200b\u8d1f\u8d23\u200b\u5411\u200b map \u200b\u83b7\u53d6\u200b\u548c\u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53d8\u91cf\u503c\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u83b7\u53d6\u200b\u526f\u672c\u200b\u503c\u65f6\u200b\uff0c\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u83b7\u53d6\u200b\u5230\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u526f\u672c\u200b\u503c\u200b\uff0c\u200b\u5f62\u6210\u200b\u526f\u672c\u200b\u7684\u200b\u9694\u79bb\u200b\uff0c\u200b\u4e92\u4e0d\u200b\u5e72\u6270\u200b</li> </ul> <p></p> <p>JDK8 \u200b\u524d\u540e\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>\u200b\u6bcf\u4e2a\u200b Map \u200b\u5b58\u50a8\u200b\u7684\u200b Entry \u200b\u6570\u91cf\u200b\u4f1a\u200b\u53d8\u5c11\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e4b\u524d\u200b\u7684\u200b\u5b58\u50a8\u200b\u6570\u91cf\u200b\u7531\u200b Thread \u200b\u7684\u200b\u6570\u91cf\u200b\u51b3\u5b9a\u200b\uff0c\u200b\u73b0\u5728\u200b\u7531\u200b ThreadLocal \u200b\u7684\u200b\u6570\u91cf\u200b\u51b3\u5b9a\u200b\uff0c\u200b\u5728\u200b\u5b9e\u9645\u200b\u7f16\u7a0b\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5f80\u5f80\u200b ThreadLocal \u200b\u7684\u200b\u6570\u91cf\u200b\u8981\u200b\u5c11\u4e8e\u200b Thread \u200b\u7684\u200b\u6570\u91cf\u200b</li> <li>\u200b\u5f53\u200b Thread \u200b\u9500\u6bc1\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b ThreadLocalMap \u200b\u4e5f\u200b\u4f1a\u200b\u968f\u4e4b\u200b\u9500\u6bc1\u200b\uff0c\u200b\u80fd\u200b\u51cf\u5c11\u200b\u5185\u5b58\u200b\u7684\u200b\u4f7f\u7528\u200b\uff0c\u200b\u9632\u6b62\u200b\u5185\u5b58\u200b\u6cc4\u9732\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_96","title":"\u6210\u5458\u200b\u53d8\u91cf","text":"<ul> <li>Thread \u200b\u7c7b\u200b\u7684\u200b\u76f8\u5173\u200b\u5c5e\u6027\u200b\uff1a\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u4e00\u4e2a\u200b ThreadLocalMap \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b58\u653e\u200b\u7531\u200b ThreadLocal \u200b\u548c\u200b\u6570\u636e\u200b\u7ec4\u6210\u200b\u7684\u200b Entry \u200b\u952e\u503c\u200b\u5bf9\u200b</li> </ul> Java<pre><code>ThreadLocal.ThreadLocalMap threadLocals = null\n</code></pre> <ul> <li>\u200b\u8ba1\u7b97\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b\uff1a</li> </ul> Java<pre><code>private final int threadLocalHashCode = nextHashCode()\n</code></pre> <p>\u200b\u4f7f\u7528\u200b <code>threadLocalHashCode &amp; (table.length - 1)</code> \u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b entry \u200b\u9700\u8981\u200b\u5b58\u653e\u200b\u7684\u200b\u4f4d\u7f6e\u200b</p> <ul> <li>\u200b\u6bcf\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b\u5c31\u200b\u4f1a\u200b\u4f7f\u7528\u200b nextHashCode \u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b hash \u200b\u503c\u200b\u7ed9\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\uff1a</li> </ul> Java<pre><code>private static AtomicInteger nextHashCode = new AtomicInteger()\n</code></pre> <ul> <li>\u200b\u6590\u6ce2\u200b\u90a3\u200b\u5951\u6570\u200b\u4e5f\u200b\u53eb\u200b\u9ec4\u91d1\u5206\u5272\u200b\u6570\u200b\uff0chash \u200b\u7684\u200b\u589e\u91cf\u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b\u6570\u5b57\u200b\uff0c\u200b\u5e26\u6765\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b hash \u200b\u5206\u5e03\u200b\u975e\u5e38\u200b\u5747\u5300\u200b\uff1a</li> </ul> Java<pre><code>private static final int HASH_INCREMENT = 0x61c88647\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_97","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"<p>\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b ThreadLocal \u200b\u5c5e\u4e8e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\uff0cThreadLocal \u200b\u4e2d\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u903b\u8f91\u200b\u90fd\u200b\u662f\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7ef4\u62a4\u200b\u7684\u200b ThreadLocalMap \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u6570\u636e\u200b\u7684\u200b\u589e\u5220\u200b\u6539\u67e5\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b\u521d\u59cb\u503c\u200b\u7684\u200b threadlcoal \u200b\u5bf9\u8c61\u200b\u9ed8\u8ba4\u200b\u8d4b\u503c\u200b\u4e3a\u200b null</p> <ul> <li>initialValue()\uff1a\u200b\u8fd4\u56de\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u7684\u200b\u521d\u59cb\u503c\u200b</li> <li>\u200b\u5ef6\u8fdf\u200b\u8c03\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5728\u200b\u6267\u884c\u200b get \u200b\u65b9\u6cd5\u200b\u65f6\u624d\u200b\u6267\u884c\u200b</li> <li>\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u7f3a\u7701\u200b\uff08\u200b\u9ed8\u8ba4\u200b\uff09\u200b\u5b9e\u73b0\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b null</li> <li>\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u4e00\u4e2a\u200b\u521d\u59cb\u503c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91cd\u5199\u200b\u6b64\u200b\u65b9\u6cd5\u200b\uff0c \u200b\u8be5\u200b\u65b9\u6cd5\u200b\u662f\u200b\u4e00\u4e2a\u200b <code>protected</code> \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u5b50\u7c7b\u200b\u8986\u76d6\u200b\u800c\u200b\u8bbe\u8ba1\u200b\u7684\u200b</li> </ul> Java<pre><code>protected T initialValue() {\n    return null;\n}\n</code></pre> <ul> <li>nextHashCode()\uff1a\u200b\u8ba1\u7b97\u200b\u54c8\u5e0c\u200b\u503c\u200b\uff0cThreadLocal \u200b\u7684\u200b\u6563\u5217\u200b\u65b9\u5f0f\u200b\u79f0\u4e4b\u4e3a\u200b\u6590\u6ce2\u200b\u90a3\u200b\u5951\u6563\u5217\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u83b7\u53d6\u200b\u54c8\u5e0c\u200b\u503c\u200b\u90fd\u200b\u4f1a\u200b\u52a0\u4e0a\u200b HASH_INCREMENT\uff0c\u200b\u8fd9\u6837\u200b\u505a\u200b\u53ef\u4ee5\u200b\u5c3d\u91cf\u907f\u514d\u200b hash \u200b\u51b2\u7a81\u200b\uff0c\u200b\u8ba9\u200b\u54c8\u5e0c\u200b\u503c\u80fd\u200b\u5747\u5300\u200b\u7684\u200b\u5206\u5e03\u200b\u5728\u200b 2 \u200b\u7684\u200b n \u200b\u6b21\u65b9\u200b\u7684\u200b\u6570\u7ec4\u200b\u4e2d\u200b</li> </ul> Java<pre><code>private static int nextHashCode() {\n    // \u200b\u54c8\u5e0c\u200b\u503c\u81ea\u589e\u200b\u4e00\u4e2a\u200b HASH_INCREMENT \u200b\u6570\u503c\u200b\n    return nextHashCode.getAndAdd(HASH_INCREMENT);\n}\n</code></pre> <ul> <li>set()\uff1a\u200b\u4fee\u6539\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b threadlocal \u200b\u5bf9\u8c61\u200b\u76f8\u5173\u8054\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u53d8\u91cf\u200b</li> </ul> Java<pre><code>public void set(T value) {\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\n    Thread t = Thread.currentThread();\n    // \u200b\u83b7\u53d6\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\u4e2d\u200b\u7ef4\u62a4\u200b\u7684\u200b ThreadLocalMap \u200b\u5bf9\u8c61\u200b\n    ThreadLocalMap map = getMap(t);\n    // \u200b\u5224\u65ad\u200b map \u200b\u662f\u5426\u200b\u5b58\u5728\u200b\n    if (map != null)\n        // \u200b\u8c03\u7528\u200b threadLocalMap.set \u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u91cd\u5199\u200b\u6216\u8005\u200b\u6dfb\u52a0\u200b\n        map.set(this, value);\n    else\n        // map \u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u8c03\u7528\u200b createMap \u200b\u8fdb\u884c\u200b ThreadLocalMap \u200b\u5bf9\u8c61\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u3002\u200b\u53c2\u6570\u200b1\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u53c2\u6570\u200b2\u200b\u662f\u200b\u5c40\u90e8\u53d8\u91cf\u200b\n        createMap(t, value);\n}\n</code></pre> Java<pre><code>// \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b Thread \u200b\u5bf9\u5e94\u200b\u7ef4\u62a4\u200b\u7684\u200b ThreadLocalMap \nThreadLocalMap getMap(Thread t) {\n    return t.threadLocals;\n}\n// \u200b\u521b\u5efa\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200bThread\u200b\u5bf9\u5e94\u200b\u7ef4\u62a4\u200b\u7684\u200bThreadLocalMap \nvoid createMap(Thread t, T firstValue) {\n    // \u3010\u200b\u8fd9\u91cc\u200b\u7684\u200b this \u200b\u662f\u200b\u8c03\u7528\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u7684\u200b threadLocal\u3011\uff0c\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b Map \u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u7b2c\u4e00\u4e2a\u200b\u6570\u636e\u200b\n    t.threadLocals = new ThreadLocalMap(this, firstValue);\n}\n</code></pre> <ul> <li>get()\uff1a\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b\u76f8\u5173\u8054\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u53d8\u91cf\u200b</li> </ul> Java<pre><code>public T get() {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    // \u200b\u5982\u679c\u200b\u6b64\u200bmap\u200b\u5b58\u5728\u200b\n    if (map != null) {\n        // \u200b\u4ee5\u200b\u5f53\u524d\u200b\u7684\u200b ThreadLocal \u200b\u4e3a\u200b key\uff0c\u200b\u8c03\u7528\u200b getEntry \u200b\u83b7\u53d6\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b58\u50a8\u200b\u5b9e\u4f53\u200b e\n        ThreadLocalMap.Entry e = map.getEntry(this);\n        // \u200b\u5bf9\u200b e \u200b\u8fdb\u884c\u200b\u5224\u7a7a\u200b \n        if (e != null) {\n            // \u200b\u83b7\u53d6\u200b\u5b58\u50a8\u200b\u5b9e\u4f53\u200b e \u200b\u5bf9\u5e94\u200b\u7684\u200b value\u200b\u503c\u200b\n            T result = (T)e.value;\n            return result;\n        }\n    }\n    /*\u200b\u6709\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\u6709\u200b\u6267\u884c\u200b\u5f53\u524d\u200b\u4ee3\u7801\u200b\n      \u200b\u7b2c\u4e00\u79cd\u200b\u60c5\u51b5\u200b: map \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u8868\u793a\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u6ca1\u6709\u200b\u7ef4\u62a4\u200b\u7684\u200b ThreadLocalMap \u200b\u5bf9\u8c61\u200b\n      \u200b\u7b2c\u4e8c\u79cd\u200b\u60c5\u51b5\u200b: map \u200b\u5b58\u5728\u200b, \u200b\u4f46\u662f\u200b\u3010\u200b\u6ca1\u6709\u200b\u4e0e\u200b\u5f53\u524d\u200b ThreadLocal \u200b\u5173\u8054\u200b\u7684\u200b entry\u3011\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u9ed8\u8ba4\u503c\u200b */\n    // \u200b\u521d\u59cb\u5316\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b threadLocal \u200b\u5bf9\u8c61\u200b\u76f8\u5173\u8054\u200b\u7684\u200b value\n    return setInitialValue();\n}\n</code></pre> Java<pre><code>private T setInitialValue() {\n    // \u200b\u8c03\u7528\u200binitialValue\u200b\u83b7\u53d6\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u88ab\u5b50\u200b\u7c7b\u200b\u91cd\u5199\u200b, \u200b\u5982\u679c\u200b\u4e0d\u200b\u91cd\u5199\u200b\u9ed8\u8ba4\u200b\u8fd4\u56de\u200b null\n    T value = initialValue();\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    // \u200b\u5224\u65ad\u200b map \u200b\u662f\u5426\u200b\u521d\u59cb\u5316\u200b\u8fc7\u200b\n    if (map != null)\n        // \u200b\u5b58\u5728\u200b\u5219\u200b\u8c03\u7528\u200b map.set \u200b\u8bbe\u7f6e\u200b\u6b64\u200b\u5b9e\u4f53\u200b entry\uff0cvalue \u200b\u662f\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u503c\u200b\n        map.set(this, value);\n    else\n        // \u200b\u8c03\u7528\u200b createMap \u200b\u8fdb\u884c\u200b ThreadLocalMap \u200b\u5bf9\u8c61\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u4e2d\u200b\n        createMap(t, value);\n    // \u200b\u8fd4\u56de\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b threadLocal \u200b\u5173\u8054\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\n    return value;\n}\n</code></pre> <ul> <li>remove()\uff1a\u200b\u79fb\u9664\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b threadLocal \u200b\u5bf9\u8c61\u200b\u76f8\u5173\u8054\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u53d8\u91cf\u200b</li> </ul> Java<pre><code>public void remove() {\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\u4e2d\u200b\u7ef4\u62a4\u200b\u7684\u200b ThreadLocalMap \u200b\u5bf9\u8c61\u200b\n    ThreadLocalMap m = getMap(Thread.currentThread());\n    if (m != null)\n        // map \u200b\u5b58\u5728\u200b\u5219\u200b\u8c03\u7528\u200b map.remove\uff0cthis\u200b\u65f6\u200b\u5f53\u524d\u200bThreadLocal\uff0c\u200b\u4ee5\u200bthis\u200b\u4e3a\u200bkey\u200b\u5220\u9664\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b9e\u4f53\u200b\n        m.remove(this);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#localmap","title":"LocalMap","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_98","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"<p>ThreadLocalMap \u200b\u662f\u200b ThreadLocal \u200b\u7684\u200b\u5185\u90e8\u200b\u7c7b\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5b9e\u73b0\u200b Map \u200b\u63a5\u53e3\u200b\uff0c\u200b\u7528\u200b\u72ec\u7acb\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5b9e\u73b0\u200b\u4e86\u200b Map \u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u5176\u200b\u5185\u90e8\u200b Entry \u200b\u4e5f\u200b\u662f\u200b\u72ec\u7acb\u200b\u5b9e\u73b0\u200b</p> Java<pre><code>// \u200b\u521d\u59cb\u5316\u200b\u5f53\u524d\u200b map \u200b\u5185\u90e8\u200b\u6563\u200b\u5217\u8868\u200b\u6570\u7ec4\u200b\u7684\u200b\u521d\u59cb\u200b\u957f\u5ea6\u200b 16\nprivate static final int INITIAL_CAPACITY = 16;\n\n// \u200b\u5b58\u653e\u6570\u636e\u200b\u7684\u200btable\uff0c\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u5fc5\u987b\u200b\u662f\u200b2\u200b\u7684\u200b\u6574\u6b21\u200b\u5e42\u200b\u3002\nprivate Entry[] table;\n\n// \u200b\u6570\u7ec4\u200b\u91cc\u9762\u200b entrys \u200b\u7684\u200b\u4e2a\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u5224\u65ad\u200b table \u200b\u5f53\u524d\u200b\u4f7f\u7528\u91cf\u200b\u662f\u5426\u200b\u8d85\u8fc7\u200b\u9608\u503c\u200b\nprivate int size = 0;\n\n// \u200b\u8fdb\u884c\u200b\u6269\u5bb9\u200b\u7684\u200b\u9608\u503c\u200b\uff0c\u200b\u8868\u200b\u4f7f\u7528\u91cf\u200b\u5927\u4e8e\u200b\u5b83\u200b\u7684\u200b\u65f6\u5019\u200b\u8fdb\u884c\u200b\u6269\u5bb9\u200b\u3002\nprivate int threshold;\n</code></pre> <p>\u200b\u5b58\u50a8\u200b\u7ed3\u6784\u200b Entry\uff1a</p> <ul> <li>Entry \u200b\u7ee7\u627f\u200b WeakReference\uff0ckey \u200b\u662f\u200b\u5f31\u200b\u5f15\u7528\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u5c06\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u751f\u547d\u5468\u671f\u200b\u89e3\u7ed1\u200b</li> <li>Entry \u200b\u9650\u5236\u200b\u53ea\u80fd\u200b\u7528\u200b ThreadLocal \u200b\u4f5c\u4e3a\u200b key\uff0ckey \u200b\u4e3a\u200b null (entry.get() == null) \u200b\u610f\u5473\u7740\u200b key \u200b\u4e0d\u518d\u200b\u88ab\u200b\u5f15\u7528\u200b\uff0centry \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b table \u200b\u4e2d\u200b\u6e05\u9664\u200b</li> </ul> Java<pre><code>static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; {\n    Object value;\n    Entry(ThreadLocal&lt;?&gt; k, Object v) {\n        // this.referent = referent = key;\n        super(k);\n        value = v;\n    }\n}\n</code></pre> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a\u200b\u5ef6\u8fdf\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u7b2c\u4e00\u6b21\u200b\u5b58\u50a8\u200b threadLocal - value \u200b\u65f6\u624d\u200b\u4f1a\u200b\u521b\u5efa\u200b threadLocalMap \u200b\u5bf9\u8c61\u200b</p> Java<pre><code>ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) {\n    // \u200b\u521d\u59cb\u5316\u200btable\uff0c\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u957f\u5ea6\u200b\u4e3a\u200b16\u200b\u7684\u200bEntry\u200b\u6570\u7ec4\u200b\n    table = new Entry[INITIAL_CAPACITY];\n    // \u3010\u200b\u5bfb\u5740\u200b\u7b97\u6cd5\u200b\u3011\u200b\u8ba1\u7b97\u200b\u7d22\u5f15\u200b\n    int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);\n    // \u200b\u521b\u5efa\u200b entry \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b58\u653e\u200b\u5230\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\u7684\u200b slot \u200b\u4e2d\u200b\n    table[i] = new Entry(firstKey, firstValue);\n    // \u200b\u6570\u636e\u200b\u603b\u91cf\u200b\u662f\u200b 1\n    size = 1;\n    // \u200b\u5c06\u200b\u9608\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b \uff08\u200b\u5f53\u524d\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b * 2\uff09/ 3\u3002\n    setThreshold(INITIAL_CAPACITY);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_99","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"<ul> <li>set()\uff1a\u200b\u6dfb\u52a0\u200b\u6570\u636e\u200b\uff0cThreadLocalMap \u200b\u4f7f\u7528\u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\u6cd5\u6765\u200b\u89e3\u51b3\u200b\u54c8\u5e0c\u200b\u51b2\u7a81\u200b</li> <li> <p>\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u63a2\u6d4b\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u76f4\u5230\u200b\u6709\u7a7a\u200b\u7684\u200b\u5730\u5740\u200b\u540e\u200b\u63d2\u5165\u200b\uff0c\u200b\u82e5\u200b\u63d2\u5165\u200b\u540e\u200b Map \u200b\u6570\u91cf\u200b\u8d85\u8fc7\u200b\u9608\u503c\u200b\uff0c\u200b\u6570\u7ec4\u200b\u4f1a\u200b\u6269\u5bb9\u200b\u4e3a\u200b\u539f\u6765\u200b\u7684\u200b 2 \u200b\u500d\u200b</p> <p>\u200b\u5047\u8bbe\u200b\u5f53\u524d\u200b table \u200b\u957f\u5ea6\u200b\u4e3a\u200b16\uff0c\u200b\u8ba1\u7b97\u51fa\u6765\u200b key \u200b\u7684\u200b hash \u200b\u503c\u4e3a\u200b 14\uff0c\u200b\u5982\u679c\u200b table[14] \u200b\u4e0a\u200b\u5df2\u7ecf\u200b\u6709\u503c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5176\u200b key \u200b\u4e0e\u200b\u5f53\u524d\u200b key \u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53d1\u751f\u200b\u4e86\u200b hash \u200b\u51b2\u7a81\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u5c06\u200b 14 \u200b\u52a0\u200b 1 \u200b\u5f97\u5230\u200b 15\uff0c\u200b\u53d6\u200b table[15] \u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd8\u662f\u200b\u51b2\u7a81\u200b\u4f1a\u200b\u56de\u5230\u200b 0\uff0c\u200b\u53d6\u200b table[0]\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\uff0c\u200b\u76f4\u5230\u200b\u53ef\u4ee5\u200b\u63d2\u5165\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b Entry[] table \u200b\u770b\u6210\u200b\u4e00\u4e2a\u200b\u73af\u5f62\u200b\u6570\u7ec4\u200b</p> </li> <li> <p>\u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\u6cd5\u4f1a\u200b\u51fa\u73b0\u200b\u5806\u79ef\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u53d6\u200b\u5e73\u65b9\u200b\u63a2\u6d4b\u200b\u6cd5\u200b\u89e3\u51b3\u200b</p> </li> <li>\u200b\u5728\u200b\u63a2\u6d4b\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b ThreadLocal \u200b\u4f1a\u200b\u590d\u7528\u200b key \u200b\u4e3a\u200b null \u200b\u7684\u200b\u810f\u200b Entry \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u200b\u8fdb\u884c\u200b\u5783\u573e\u200b\u6e05\u7406\u200b\uff0c\u200b\u9632\u6b62\u51fa\u73b0\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b</li> </ul> Java<pre><code>private void set(ThreadLocal&lt;?&gt; key, Object value) {\n    // \u200b\u83b7\u53d6\u200b\u6563\u200b\u5217\u8868\u200b\n    ThreadLocal.ThreadLocalMap.Entry[] tab = table;\n    int len = tab.length;\n    // \u200b\u54c8\u5e0c\u200b\u5bfb\u5740\u200b\n    int i = key.threadLocalHashCode &amp; (len-1);\n    // \u200b\u4f7f\u7528\u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\u6cd5\u5411\u200b\u540e\u200b\u67e5\u627e\u200b\u5143\u7d20\u200b\uff0c\u200b\u78b0\u5230\u200b entry \u200b\u4e3a\u200b\u7a7a\u65f6\u200b\u505c\u6b62\u200b\u63a2\u6d4b\u200b\n    for (ThreadLocal.ThreadLocalMap.Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u5143\u7d20\u200b key\n        ThreadLocal&lt;?&gt; k = e.get();\n        // ThreadLocal \u200b\u5bf9\u5e94\u200b\u7684\u200b key \u200b\u5b58\u5728\u200b\uff0c\u3010\u200b\u76f4\u63a5\u200b\u8986\u76d6\u200b\u4e4b\u524d\u200b\u7684\u200b\u503c\u200b\u3011\n        if (k == key) {\n            e.value = value;\n            return;\n        }\n        // \u3010\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6761\u4ef6\u200b\u8c01\u200b\u5148\u200b\u6210\u7acb\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\uff0c\u200b\u6240\u4ee5\u200b replaceStaleEntry \u200b\u4e2d\u200b\u8fd8\u200b\u9700\u8981\u200b\u5224\u65ad\u200b k == key \u200b\u7684\u200b\u60c5\u51b5\u200b\u3011\n\n        // key \u200b\u4e3a\u200b null\uff0c\u200b\u4f46\u662f\u200b\u503c\u4e0d\u4e3a\u200b null\uff0c\u200b\u8bf4\u660e\u200b\u4e4b\u524d\u200b\u7684\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u56de\u6536\u200b\u4e86\u200b\uff0c\u200b\u5f53\u524d\u200b\u662f\u200b\u3010\u200b\u8fc7\u671f\u6570\u636e\u200b\u3011\n        if (k == null) {\n            // \u3010\u200b\u78b0\u5230\u200b\u4e00\u4e2a\u200b\u8fc7\u671f\u200b\u7684\u200b slot\uff0c\u200b\u5f53\u524d\u200b\u6570\u636e\u200b\u590d\u7528\u200b\u8be5\u200b\u69fd\u200b\u4f4d\u200b\uff0c\u200b\u66ff\u6362\u200b\u8fc7\u671f\u6570\u636e\u200b\u3011\n            // \u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u8fd8\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5783\u573e\u200b\u6e05\u7406\u200b\u52a8\u4f5c\u200b\uff0c\u200b\u9632\u6b62\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\n            replaceStaleEntry(key, value, i);\n            return;\n        }\n    }\n  // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u78b0\u5230\u200b slot == null \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5219\u200b\u5728\u200b\u7a7a\u200b\u5143\u7d20\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b Entry\n    tab[i] = new Entry(key, value);\n    // \u200b\u6570\u91cf\u200b + 1\n    int sz = ++size;\n\n    // \u3010\u200b\u505a\u200b\u4e00\u6b21\u200b\u542f\u53d1\u5f0f\u200b\u6e05\u7406\u200b\u3011\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6e05\u9664\u200b\u4efb\u4f55\u200b entry \u200b\u5e76\u4e14\u200b\u3010\u200b\u5f53\u524d\u200b\u4f7f\u7528\u91cf\u200b\u8fbe\u5230\u200b\u4e86\u200b\u8d1f\u8f7d\u200b\u56e0\u5b50\u200b\u6240\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fdb\u884c\u200b rehash\n    if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)\n        // \u200b\u6269\u5bb9\u200b\n        rehash();\n}\n</code></pre> Java<pre><code>// \u200b\u83b7\u53d6\u200b\u3010\u200b\u73af\u5f62\u200b\u6570\u7ec4\u200b\u3011\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7d22\u5f15\u200b\nprivate static int nextIndex(int i, int len) {\n    // \u200b\u7d22\u5f15\u200b\u8d8a\u754c\u200b\u540e\u200b\u4ece\u200b 0 \u200b\u5f00\u59cb\u200b\u7ee7\u7eed\u200b\u83b7\u53d6\u200b\n    return ((i + 1 &lt; len) ? i + 1 : 0);\n}\n</code></pre> Java<pre><code>// \u200b\u5728\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\u63d2\u5165\u200b\u6307\u5b9a\u200b\u7684\u200b\u6570\u636e\u200b\nprivate void replaceStaleEntry(ThreadLocal&lt;?&gt; key, Object value, int staleSlot) {\n    // \u200b\u83b7\u53d6\u200b\u6563\u200b\u5217\u8868\u200b\n    Entry[] tab = table;\n    int len = tab.length;\n    Entry e;\n  // \u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u6e05\u7406\u200b\u7684\u200b\u5f00\u59cb\u200b\u4e0b\u6807\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u4ece\u200b\u5f53\u524d\u200b staleSlot \u200b\u5f00\u59cb\u200b\n    int slotToExpunge = staleSlot;\n    // \u200b\u4ee5\u200b\u5f53\u524d\u200b staleSlot \u200b\u5f00\u59cb\u200b\u3010\u200b\u5411\u524d\u200b\u8fed\u4ee3\u200b\u67e5\u627e\u200b\u3011\uff0c\u200b\u627e\u5230\u200b\u7d22\u5f15\u200b\u9760\u524d\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u200b\u627e\u5230\u200b\u4ee5\u540e\u200b\u66ff\u6362\u200b slotToExpunge \u200b\u503c\u200b\n    // \u3010\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u4e00\u4e2a\u200b\u533a\u95f4\u200b\u6bb5\u200b\u5185\u200b\uff0c\u200b\u4ece\u200b\u6700\u200b\u524d\u9762\u200b\u7684\u200b\u8fc7\u671f\u6570\u636e\u200b\u5f00\u59cb\u200b\u6e05\u7406\u200b\u3011\n    for (int i = prevIndex(staleSlot, len); (e = tab[i]) != null; i = prevIndex(i, len))\n        if (e.get() == null)\n            slotToExpunge = i;\n\n  // \u200b\u4ee5\u200b staleSlot \u3010\u200b\u5411\u200b\u540e\u200b\u53bb\u200b\u67e5\u627e\u200b\u3011\uff0c\u200b\u76f4\u5230\u200b\u78b0\u5230\u200b null \u200b\u4e3a\u6b62\u200b\uff0c\u200b\u8fd8\u662f\u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\n    for (int i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b key\n        ThreadLocal&lt;?&gt; k = e.get();\n      // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u662f\u200b\u3010\u200b\u66ff\u6362\u200b\u903b\u8f91\u200b\u3011\n        if (k == key) {\n            e.value = value;\n            // \u200b\u56e0\u4e3a\u200b\u672c\u6765\u200b\u8981\u200b\u5728\u200b staleSlot \u200b\u7d22\u5f15\u200b\u5904\u200b\u63d2\u5165\u200b\u8be5\u200b\u6570\u636e\u200b\uff0c\u200b\u73b0\u5728\u200b\u627e\u5230\u200b\u4e86\u200bi\u200b\u7d22\u5f15\u200b\u5904\u200b\u7684\u200bkey\u200b\u4e0e\u200b\u6570\u636e\u200b\u4e00\u81f4\u200b\n            // \u200b\u4f46\u662f\u200b i \u200b\u4f4d\u7f6e\u200b\u8ddd\u79bb\u200b\u6b63\u786e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u66f4\u200b\u8fdc\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u662f\u200b\u5411\u200b\u540e\u200b\u67e5\u627e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd8\u662f\u200b\u8981\u200b\u5728\u200b staleSlot \u200b\u4f4d\u7f6e\u200b\u63d2\u5165\u200b\u5f53\u524d\u200b entry\n            // \u200b\u7136\u540e\u200b\u5c06\u200b table[staleSlot] \u200b\u8fd9\u4e2a\u200b\u8fc7\u671f\u6570\u636e\u200b\u653e\u5230\u200b\u5f53\u524d\u200b\u5faa\u73af\u200b\u5230\u200b\u7684\u200b table[i] \u200b\u8fd9\u4e2a\u200b\u4f4d\u7f6e\u200b\uff0c\n            tab[i] = tab[staleSlot];\n            tab[staleSlot] = e;\n\n            // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5411\u524d\u200b\u67e5\u627e\u200b\u8fc7\u671f\u6570\u636e\u200b\u5e76\u672a\u200b\u627e\u5230\u200b\u8fc7\u671f\u200b\u7684\u200b entry\uff0c\u200b\u4f46\u200b staleSlot \u200b\u4f4d\u7f6e\u200b\u5df2\u7ecf\u200b\u4e0d\u662f\u200b\u8fc7\u671f\u6570\u636e\u200b\u4e86\u200b\uff0ci \u200b\u4f4d\u7f6e\u200b\u624d\u200b\u662f\u200b\n            if (slotToExpunge == staleSlot)\n                slotToExpunge = i;\n\n            // \u3010\u200b\u6e05\u7406\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0cexpungeStaleEntry \u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u6e05\u7406\u200b\uff0ccleanSomeSlots \u200b\u542f\u53d1\u5f0f\u200b\u6e05\u7406\u200b\u3011\n            cleanSomeSlots(expungeStaleEntry(slotToExpunge), len);\n            return;\n        }\n      // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u904d\u5386\u200b\u7684\u200b entry \u200b\u662f\u200b\u4e00\u4e2a\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8be5\u200b\u4f4d\u7f6e\u200b\u524d\u9762\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u8fc7\u671f\u6570\u636e\u200b\n        if (k == null &amp;&amp; slotToExpunge == staleSlot)\n            // \u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u6e05\u7406\u200b\u8fc7\u671f\u6570\u636e\u200b\u7684\u200b\u5f00\u59cb\u200b\u4e0b\u6807\u200b\u4fee\u6539\u200b\u4e3a\u200b\u5f53\u524d\u200b\u5faa\u73af\u200b\u7684\u200b index\uff0c\u200b\u56e0\u4e3a\u200b staleSlot \u200b\u4f1a\u200b\u653e\u5165\u200b\u8981\u200b\u6dfb\u52a0\u200b\u7684\u200b\u6570\u636e\u200b\n            slotToExpunge = i;\n    }\n  // \u200b\u5411\u200b\u540e\u200b\u67e5\u627e\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5e76\u672a\u200b\u53d1\u73b0\u200b k == key \u200b\u7684\u200b entry\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u662f\u200b\u4e00\u4e2a\u200b\u3010\u200b\u53d6\u4ee3\u200b\u8fc7\u671f\u6570\u636e\u200b\u903b\u8f91\u200b\u3011\n    // \u200b\u5220\u9664\u200b\u539f\u6709\u200b\u7684\u200b\u6570\u636e\u200b\u5f15\u7528\u200b\uff0c\u200b\u9632\u6b62\u200b\u5185\u5b58\u200b\u6cc4\u9732\u200b\n    tab[staleSlot].value = null;\n    // staleSlot \u200b\u4f4d\u7f6e\u200b\u6dfb\u52a0\u200b\u6570\u636e\u200b\uff0c\u3010\u200b\u4e0a\u9762\u200b\u7684\u200b\u6240\u6709\u200b\u903b\u8f91\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u66f4\u6539\u200b staleSlot \u200b\u7684\u200b\u503c\u200b\u3011\n    tab[staleSlot] = new Entry(key, value);\n\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u9664\u4e86\u200b staleSlot \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53d1\u73b0\u200b\u5176\u5b83\u200b\u7684\u200b\u8fc7\u671f\u200b slot\uff0c\u200b\u6240\u4ee5\u200b\u8981\u200b\u3010\u200b\u5f00\u542f\u200b\u6e05\u7406\u200b\u6570\u636e\u200b\u7684\u200b\u903b\u8f91\u200b\u3011\n    if (slotToExpunge != staleSlot)\n        cleanSomeSlots(expungeStaleEntry(slotToExpunge), len);\n}\n</code></pre> <p></p> Java<pre><code>private static int prevIndex(int i, int len) {\n    // \u200b\u5f62\u6210\u200b\u4e00\u4e2a\u200b\u73af\u7ed5\u200b\u5f0f\u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u5934\u200b\u7d22\u5f15\u200b\u8d8a\u754c\u200b\u540e\u7f6e\u200b\u4e3a\u200b\u5c3e\u200b\u7d22\u5f15\u200b\n    return ((i - 1 &gt;= 0) ? i - 1 : len - 1);\n}\n</code></pre> <ul> <li>getEntry()\uff1aThreadLocal \u200b\u7684\u200b get \u200b\u65b9\u6cd5\u200b\u4ee5\u200b\u5f53\u524d\u200b\u7684\u200b ThreadLocal \u200b\u4e3a\u200b key\uff0c\u200b\u8c03\u7528\u200b getEntry \u200b\u83b7\u53d6\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b58\u50a8\u200b\u5b9e\u4f53\u200b e</li> </ul> Java<pre><code>private Entry getEntry(ThreadLocal&lt;?&gt; key) {\n    // \u200b\u54c8\u5e0c\u200b\u5bfb\u5740\u200b\n    int i = key.threadLocalHashCode &amp; (table.length - 1);\n    // \u200b\u8bbf\u95ee\u200b\u6563\u200b\u5217\u8868\u200b\u4e2d\u200b\u6307\u5b9a\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\u7684\u200b slot \n    Entry e = table[i];\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\uff0c\u200b\u8bf4\u660e\u200b slot \u200b\u6709\u503c\u200b\u5e76\u4e14\u200b key \u200b\u5c31\u662f\u200b\u8981\u200b\u5bfb\u627e\u200b\u7684\u200b key\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\n    if (e != null &amp;&amp; e.get() == key)\n        return e;\n    else\n        // \u200b\u8fdb\u884c\u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\n        return getEntryAfterMiss(key, i, e);\n}\n// \u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\u5bfb\u5740\u200b\nprivate Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) {\n    // \u200b\u83b7\u53d6\u200b\u6563\u200b\u5217\u8868\u200b\n    Entry[] tab = table;\n    int len = tab.length;\n\n    // \u200b\u5f00\u59cb\u200b\u904d\u5386\u200b\uff0c\u200b\u78b0\u5230\u200b slot == null \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u641c\u7d22\u200b\u7ed3\u675f\u200b\n    while (e != null) {\n      // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b slot \u200b\u4e2d\u200b entry \u200b\u5bf9\u8c61\u200b\u7684\u200b key\n        ThreadLocal&lt;?&gt; k = e.get();\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u627e\u5230\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\n        if (k == key)\n            return e;\n        if (k == null)\n             // \u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u3010\u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u8fc7\u671f\u6570\u636e\u200b\u56de\u6536\u200b\u3011\n            expungeStaleEntry(i);\n        else\n            // \u200b\u66f4\u65b0\u200b index \u200b\u7ee7\u7eed\u200b\u5411\u540e\u8d70\u200b\n            i = nextIndex(i, len);\n        // \u200b\u83b7\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u69fd\u200b\u4f4d\u200b\u4e2d\u200b\u7684\u200b entry\n        e = tab[i];\n    }\n    // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u533a\u6bb5\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u76f8\u5e94\u200b\u6570\u636e\u200b\n    // \u3010\u200b\u56e0\u4e3a\u200b\u5b58\u653e\u6570\u636e\u200b\u662f\u200b\u7ebf\u6027\u200b\u7684\u200b\u5411\u200b\u540e\u200b\u5bfb\u627e\u200b\u69fd\u200b\u4f4d\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u7d27\u200b\u6328\u7740\u200b\u7684\u200b\uff0c\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u8d8a\u8fc7\u200b\u4e00\u4e2a\u200b \u200b\u7a7a\u69fd\u200b\u4f4d\u200b \u200b\u5728\u200b\u540e\u9762\u200b\u653e\u200b\u3011\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u904d\u5386\u200b\u7684\u200b\u6b21\u6570\u200b\n    return null;\n}\n</code></pre> <ul> <li>rehash()\uff1a\u200b\u89e6\u53d1\u200b\u4e00\u6b21\u200b\u5168\u91cf\u200b\u6e05\u7406\u200b\uff0c\u200b\u5982\u679c\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u5927\u4e8e\u200b\u7b49\u4e8e\u200b\u957f\u5ea6\u200b\u7684\u200b <code>2/3 * 3/4 = 1/2</code>\uff0c\u200b\u5219\u200b\u8fdb\u884c\u200b resize</li> </ul> Java<pre><code>private void rehash() {\n    // \u200b\u6e05\u695a\u200b\u5f53\u524d\u200b\u6563\u200b\u5217\u8868\u200b\u5185\u200b\u7684\u200b\u3010\u200b\u6240\u6709\u200b\u3011\u200b\u8fc7\u671f\u200b\u7684\u200b\u6570\u636e\u200b\n    expungeStaleEntries();\n\n    // threshold = len * 2 / 3\uff0c\u200b\u5c31\u662f\u200b 2/3 * (1 - 1/4)\n    if (size &gt;= threshold - threshold / 4)\n        resize();\n}\n</code></pre> Java<pre><code>private void expungeStaleEntries() {\n    Entry[] tab = table;\n    int len = tab.length;\n    // \u3010\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u7684\u200b\u69fd\u200b\u4f4d\u200b\uff0c\u200b\u6e05\u7406\u200b\u8fc7\u671f\u6570\u636e\u200b\u3011\n    for (int j = 0; j &lt; len; j++) {\n        Entry e = tab[j];\n        if (e != null &amp;&amp; e.get() == null)\n            expungeStaleEntry(j);\n    }\n}\n</code></pre> <p>Entry \u200b\u6570\u7ec4\u200b\u4e3a\u200b\u6269\u5bb9\u200b\u4e3a\u200b\u539f\u6765\u200b\u7684\u200b 2 \u200b\u500d\u200b \uff0c\u200b\u91cd\u65b0\u200b\u8ba1\u7b97\u200b key \u200b\u7684\u200b\u6563\u5217\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u9047\u5230\u200b key \u200b\u4e3a\u200b null \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u5176\u200b value \u200b\u4e5f\u200b\u7f6e\u200b\u4e3a\u200b null\uff0c\u200b\u5e2e\u52a9\u200b GC</p> Java<pre><code>private void resize() {\n    Entry[] oldTab = table;\n    int oldLen = oldTab.length;\n    // \u200b\u65b0\u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b\u662f\u200b\u8001\u200b\u6570\u7ec4\u200b\u7684\u200b\u4e8c\u500d\u200b\n    int newLen = oldLen * 2;\n    Entry[] newTab = new Entry[newLen];\n    // \u200b\u7edf\u8ba1\u200b\u65b0\u200btable\u200b\u4e2d\u200b\u7684\u200bentry\u200b\u6570\u91cf\u200b\n    int count = 0;\n  // \u200b\u904d\u5386\u200b\u8001\u8868\u200b\uff0c\u200b\u8fdb\u884c\u200b\u3010\u200b\u6570\u636e\u200b\u8fc1\u79fb\u200b\u3011\n    for (int j = 0; j &lt; oldLen; ++j) {\n        // \u200b\u8bbf\u95ee\u200b\u8001\u8868\u200b\u7684\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\u7684\u200b entry\n        Entry e = oldTab[j];\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u8001\u8868\u200b\u4e2d\u8be5\u200b\u4f4d\u7f6e\u200b\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u8fc7\u671f\u6570\u636e\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4e0d\u662f\u200b\n        if (e != null) {\n            ThreadLocal&lt;?&gt; k = e.get();\n            // \u200b\u8fc7\u671f\u6570\u636e\u200b\n            if (k == null) {\n                e.value = null; // Help the GC\n            } else {\n                // \u200b\u975e\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u200b\u5728\u200b\u65b0\u8868\u4e2d\u200b\u8fdb\u884c\u200b\u54c8\u5e0c\u200b\u5bfb\u5740\u200b\n                int h = k.threadLocalHashCode &amp; (newLen - 1);\n                // \u3010\u200b\u7ebf\u7a0b\u200b\u63a2\u6d4b\u200b\u3011\n                while (newTab[h] != null)\n                    h = nextIndex(h, newLen);\n                // \u200b\u5c06\u200b\u6570\u636e\u200b\u5b58\u653e\u200b\u5230\u200b\u65b0\u8868\u200b\u5408\u9002\u200b\u7684\u200b slot \u200b\u4e2d\u200b\n                newTab[h] = e;\n                count++;\n            }\n        }\n    }\n  // \u200b\u8bbe\u7f6e\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u89e6\u53d1\u200b\u6269\u5bb9\u200b\u7684\u200b\u6307\u6807\u200b\uff1athreshold = len * 2 / 3;\n    setThreshold(newLen);\n    size = count;\n    // \u200b\u5c06\u200b\u6269\u5bb9\u200b\u540e\u200b\u7684\u200b\u65b0\u8868\u200b\u8d4b\u503c\u200b\u7ed9\u200b threadLocalMap \u200b\u5185\u90e8\u200b\u6563\u200b\u5217\u8868\u200b\u6570\u7ec4\u200b\u5f15\u7528\u200b\n    table = newTab;\n}\n</code></pre> <ul> <li>remove()\uff1a\u200b\u5220\u9664\u200b Entry</li> </ul> Java<pre><code>private void remove(ThreadLocal&lt;?&gt; key) {\n    Entry[] tab = table;\n    int len = tab.length;\n    // \u200b\u54c8\u5e0c\u200b\u5bfb\u5740\u200b\n    int i = key.threadLocalHashCode &amp; (len-1);\n    for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) {\n        // \u200b\u627e\u5230\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u7684\u200b key\n        if (e.get() == key) {\n            // \u200b\u8bbe\u7f6e\u200b key \u200b\u4e3a\u200b null\n            e.clear();\n            // \u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u6e05\u7406\u200b\n            expungeStaleEntry(i);\n            return;\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_100","title":"\u6e05\u7406\u200b\u65b9\u6cd5","text":"<ul> <li>\u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u6e05\u7406\u200b\uff1a\u200b\u6cbf\u7740\u200b\u5f00\u59cb\u200b\u4f4d\u7f6e\u200b\u5411\u200b\u540e\u200b\u63a2\u6d4b\u200b\u6e05\u7406\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u200b\u6cbf\u9014\u200b\u4e2d\u200b\u78b0\u5230\u200b\u672a\u200b\u8fc7\u671f\u6570\u636e\u200b\u5219\u200b\u5c06\u200b\u6b64\u200b\u6570\u636e\u200b rehash \u200b\u5728\u200b table \u200b\u6570\u7ec4\u200b\u4e2d\u200b\u7684\u200b\u5b9a\u4f4d\u200b\uff0c\u200b\u91cd\u200b\u5b9a\u4f4d\u200b\u540e\u200b\u7684\u200b\u5143\u7d20\u200b\u7406\u8bba\u200b\u4e0a\u200b\u66f4\u200b\u63a5\u8fd1\u200b <code>i = entry.key &amp; (table.length - 1)</code>\uff0c\u200b\u8ba9\u200b\u6570\u636e\u200b\u7684\u200b\u6392\u5217\u200b\u66f4\u200b\u7d27\u51d1\u200b\uff0c\u200b\u4f1a\u200b\u4f18\u5316\u200b\u6574\u4e2a\u200b\u6563\u200b\u5217\u8868\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b</li> </ul> Java<pre><code>// table[staleSlot] \u200b\u662f\u200b\u4e00\u4e2a\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u200b\u4ee5\u200b\u8fd9\u4e2a\u200b\u4f4d\u7f6e\u200b\u5f00\u59cb\u200b\u7ee7\u7eed\u200b\u5411\u200b\u540e\u200b\u67e5\u627e\u200b\u8fc7\u671f\u6570\u636e\u200b\nprivate int expungeStaleEntry(int staleSlot) {\n    // \u200b\u83b7\u53d6\u200b\u6563\u200b\u5217\u8868\u200b\u548c\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\n    Entry[] tab = table;\n    int len = tab.length;\n\n    // help gc\uff0c\u200b\u5148\u200b\u628a\u200b\u5f53\u524d\u200b\u8fc7\u671f\u200b\u7684\u200b entry \u200b\u7f6e\u7a7a\u200b\uff0c\u200b\u5728\u200b\u53d6\u6d88\u200b\u5bf9\u200b entry \u200b\u7684\u200b\u5f15\u7528\u200b\n    tab[staleSlot].value = null;\n    tab[staleSlot] = null;\n    // \u200b\u6570\u91cf\u200b-1\n    size--;\n\n    Entry e;\n    int i;\n    // \u200b\u4ece\u200b staleSlot \u200b\u5f00\u59cb\u200b\u5411\u200b\u540e\u200b\u904d\u5386\u200b\uff0c\u200b\u76f4\u5230\u200b\u78b0\u5230\u200b slot == null \u200b\u7ed3\u675f\u200b\uff0c\u3010\u200b\u533a\u95f4\u200b\u5185\u200b\u6e05\u7406\u200b\u8fc7\u671f\u6570\u636e\u200b\u3011\n    for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) {\n        ThreadLocal&lt;?&gt; k = e.get();\n        // \u200b\u5f53\u524d\u200b entry \u200b\u662f\u200b\u8fc7\u671f\u6570\u636e\u200b\n        if (k == null) {\n            // help gc\n            e.value = null;\n            tab[i] = null;\n            size--;\n        } else {\n            // \u200b\u5f53\u524d\u200b entry \u200b\u4e0d\u662f\u200b\u8fc7\u671f\u6570\u636e\u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u3010rehash\u3011\n            // \u200b\u91cd\u65b0\u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b entry \u200b\u5bf9\u5e94\u200b\u7684\u200b index\n            int h = k.threadLocalHashCode &amp; (len - 1);\n            // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b entry \u200b\u5b58\u50a8\u200b\u65f6\u200b\u53d1\u751f\u200b\u8fc7\u200b hash \u200b\u51b2\u7a81\u200b\uff0c\u200b\u5411\u200b\u540e\u200b\u504f\u79fb\u200b\u8fc7\u200b\u4e86\u200b\n            if (h != i) {\n                // \u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\u7f6e\u7a7a\u200b\n                tab[i] = null;\n                // \u200b\u4ee5\u200b\u6b63\u786e\u200b\u4f4d\u7f6e\u200b h \u200b\u5f00\u59cb\u200b\uff0c\u200b\u5411\u200b\u540e\u200b\u67e5\u627e\u200b\u7b2c\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u5b58\u653e\u200b entry \u200b\u7684\u200b\u4f4d\u7f6e\u200b\n                while (tab[h] != null)\n                    h = nextIndex(h, len);\n                // \u200b\u5c06\u200b\u5f53\u524d\u200b\u5143\u7d20\u200b\u653e\u5165\u200b\u5230\u200b\u3010\u200b\u8ddd\u79bb\u200b\u6b63\u786e\u200b\u4f4d\u7f6e\u200b\u66f4\u8fd1\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u6709\u200b\u53ef\u80fd\u200b\u5c31\u662f\u200b\u6b63\u786e\u200b\u4f4d\u7f6e\u200b\u3011\n                tab[h] = e;\n            }\n        }\n    }\n    // \u200b\u8fd4\u56de\u200b slot = null \u200b\u7684\u200b\u69fd\u200b\u4f4d\u200b\u7d22\u5f15\u200b\uff0c\u200b\u56fe\u4f8b\u200b\u662f\u200b 7\uff0c\u200b\u8fd9\u4e2a\u200b\u7d22\u5f15\u200b\u4ee3\u8868\u200b\u3010\u200b\u7d22\u5f15\u200b\u524d\u9762\u200b\u7684\u200b\u533a\u95f4\u200b\u5df2\u7ecf\u200b\u6e05\u7406\u200b\u5b8c\u6210\u200b\u5783\u573e\u200b\u4e86\u200b\u3011\n    return i;\n}\n</code></pre> <ul> <li>\u200b\u542f\u53d1\u5f0f\u200b\u6e05\u7406\u200b\uff1a\u200b\u5411\u200b\u540e\u200b\u5faa\u73af\u200b\u626b\u63cf\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u200b\u53d1\u73b0\u200b\u8fc7\u671f\u6570\u636e\u200b\u8c03\u7528\u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u6e05\u7406\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u679c\u200b\u8fde\u7eed\u200b\u51e0\u6b21\u200b\u7684\u200b\u5faa\u73af\u200b\u90fd\u200b\u6ca1\u6709\u200b\u53d1\u73b0\u200b\u8fc7\u671f\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u505c\u6b62\u200b\u626b\u63cf\u200b</li> </ul> Java<pre><code>//  i \u200b\u8868\u793a\u200b\u542f\u53d1\u5f0f\u200b\u6e05\u7406\u200b\u5de5\u4f5c\u200b\u5f00\u59cb\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u7a7a\u200b slot\uff0cn \u200b\u4e00\u822c\u200b\u4f20\u9012\u200b\u7684\u200b\u662f\u200b table.length \nprivate boolean cleanSomeSlots(int i, int n) {\n    // \u200b\u8868\u793a\u200b\u542f\u53d1\u5f0f\u200b\u6e05\u7406\u200b\u5de5\u4f5c\u200b\u662f\u5426\u200b\u6e05\u9664\u200b\u4e86\u200b\u8fc7\u671f\u6570\u636e\u200b\n    boolean removed = false;\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b map \u200b\u7684\u200b\u6563\u200b\u5217\u8868\u200b\u5f15\u7528\u200b\n    Entry[] tab = table;\n    int len = tab.length;\n    do {\n        // \u200b\u83b7\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7d22\u5f15\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u8fd4\u56de\u200b\u7684\u200b slot \u200b\u4e3a\u200b null\n        i = nextIndex(i, len);\n        Entry e = tab[i];\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u662f\u200b\u8fc7\u671f\u200b\u7684\u200b\u6570\u636e\u200b\uff0ckey \u200b\u88ab\u200b gc \u200b\u4e86\u200b\n        if (e != null &amp;&amp; e.get() == null) {\n            // \u3010\u200b\u53d1\u73b0\u200b\u8fc7\u671f\u6570\u636e\u200b\u91cd\u7f6e\u200b n \u200b\u4e3a\u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b\u3011\n            n = len;\n            // \u200b\u8868\u793a\u200b\u6e05\u7406\u200b\u8fc7\u200b\u8fc7\u671f\u6570\u636e\u200b\n            removed = true;\n            // \u200b\u4ee5\u200b\u5f53\u524d\u200b\u8fc7\u671f\u200b\u7684\u200b slot \u200b\u4e3a\u200b\u5f00\u59cb\u200b\u8282\u70b9\u200b \u200b\u505a\u200b\u4e00\u6b21\u200b\u63a2\u6d4b\u200b\u5f0f\u200b\u6e05\u7406\u200b\u5de5\u4f5c\u200b\n            i = expungeStaleEntry(i);\n        }\n        // \u200b\u5047\u8bbe\u200b table \u200b\u957f\u5ea6\u200b\u4e3a\u200b 16\n        // 16 &gt;&gt;&gt; 1 ==&gt; 8\uff0c8 &gt;&gt;&gt; 1 ==&gt; 4\uff0c4 &gt;&gt;&gt; 1 ==&gt; 2\uff0c2 &gt;&gt;&gt; 1 ==&gt; 1\uff0c1 &gt;&gt;&gt; 1 ==&gt; 0\n        // \u200b\u8fde\u7eed\u200b\u7ecf\u8fc7\u200b\u8fd9\u4e48\u200b\u591a\u6b21\u200b\u5faa\u73af\u200b\u3010\u200b\u6ca1\u6709\u200b\u626b\u63cf\u200b\u5230\u200b\u8fc7\u671f\u6570\u636e\u200b\u3011\uff0c\u200b\u5c31\u200b\u505c\u6b62\u200b\u5faa\u73af\u200b\uff0c\u200b\u626b\u63cf\u200b\u5230\u200b\u7a7a\u200b slot \u200b\u4e0d\u7b97\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e0d\u662f\u200b\u8fc7\u671f\u6570\u636e\u200b\n    } while ((n &gt;&gt;&gt;= 1) != 0);\n\n    // \u200b\u8fd4\u56de\u200b\u6e05\u9664\u200b\u6807\u8bb0\u200b\n    return removed;\n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://space.bilibili.com/457326371/</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_101","title":"\u5185\u5b58\u200b\u6cc4\u6f0f","text":"<p>Memory leak\uff1a\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u662f\u200b\u6307\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u52a8\u6001\u5206\u914d\u200b\u7684\u200b\u5806\u200b\u5185\u5b58\u200b\u7531\u4e8e\u200b\u67d0\u79cd\u539f\u56e0\u200b\u672a\u200b\u91ca\u653e\u200b\u6216\u200b\u65e0\u6cd5\u200b\u91ca\u653e\u200b\uff0c\u200b\u9020\u6210\u200b\u7cfb\u7edf\u200b\u5185\u5b58\u200b\u7684\u200b\u6d6a\u8d39\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7a0b\u5e8f\u8fd0\u884c\u200b\u901f\u5ea6\u200b\u51cf\u6162\u200b\u751a\u81f3\u200b\u7cfb\u7edf\u200b\u5d29\u6e83\u200b\u7b49\u200b\u4e25\u91cd\u540e\u679c\u200b\uff0c\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u5806\u79ef\u200b\u7ec8\u5c06\u200b\u5bfc\u81f4\u200b\u5185\u5b58\u200b\u6ea2\u51fa\u200b</p> <ul> <li>\u200b\u5982\u679c\u200b key \u200b\u4f7f\u7528\u200b\u5f3a\u200b\u5f15\u7528\u200b\uff1a\u200b\u4f7f\u7528\u200b\u5b8c\u200b ThreadLocal \uff0cthreadLocal Ref \u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u4f46\u662f\u200b threadLocalMap \u200b\u7684\u200b Entry \u200b\u5f3a\u200b\u5f15\u7528\u200b\u4e86\u200b threadLocal\uff0c\u200b\u9020\u6210\u200b threadLocal \u200b\u65e0\u6cd5\u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u5b8c\u5168\u907f\u514d\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b</li> </ul> <p></p> <ul> <li>\u200b\u5982\u679c\u200b key \u200b\u4f7f\u7528\u200b\u5f31\u200b\u5f15\u7528\u200b\uff1a\u200b\u4f7f\u7528\u200b\u5b8c\u200b ThreadLocal \uff0cthreadLocal Ref \u200b\u88ab\u200b\u56de\u6536\u200b\uff0cThreadLocalMap \u200b\u53ea\u200b\u6301\u6709\u200b ThreadLocal \u200b\u7684\u200b\u5f31\u200b\u5f15\u7528\u200b\uff0c\u200b\u6240\u4ee5\u200bthreadlocal \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u6b64\u65f6\u200b Entry \u200b\u4e2d\u200b\u7684\u200b key = null\u3002\u200b\u4f46\u200b\u6ca1\u6709\u200b\u624b\u52a8\u200b\u5220\u9664\u200b\u8fd9\u4e2a\u200b Entry \u200b\u6216\u8005\u200b CurrentThread \u200b\u4f9d\u7136\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f9d\u7136\u200b\u5b58\u5728\u200b\u5f3a\u200b\u5f15\u7528\u200b\u94fe\u200b\uff0cvalue \u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u800c\u200b\u8fd9\u5757\u200b value \u200b\u6c38\u8fdc\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u5230\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u5bfc\u81f4\u200b value \u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b</li> </ul> <p></p> <ul> <li>\u200b\u4e24\u4e2a\u200b\u4e3b\u8981\u200b\u539f\u56e0\u200b\uff1a</li> <li>\u200b\u6ca1\u6709\u200b\u624b\u52a8\u200b\u5220\u9664\u200b\u8fd9\u4e2a\u200b Entry</li> <li>CurrentThread \u200b\u4f9d\u7136\u200b\u8fd0\u884c\u200b</li> </ul> <p>\u200b\u6839\u672c\u539f\u56e0\u200b\uff1aThreadLocalMap \u200b\u662f\u200b Thread\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5c5e\u6027\u200b\uff0c\u200b\u751f\u547d\u5468\u671f\u200b\u8ddf\u200b Thread \u200b\u4e00\u6837\u200b\u957f\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u624b\u52a8\u200b\u5220\u9664\u200b\u5bf9\u5e94\u200b Entry \u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b</p> <p>\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u4f7f\u7528\u200b\u5b8c\u200b ThreadLocal \u200b\u4e2d\u200b\u5b58\u50a8\u200b\u7684\u200b\u5185\u5bb9\u200b\u540e\u200b\u5c06\u200b\u5b83\u200b remove \u200b\u6389\u200b\u5c31\u200b\u53ef\u4ee5\u200b</p> <p>ThreadLocal \u200b\u5185\u90e8\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5728\u200b ThreadLocalMap \u200b\u4e2d\u200b\u7684\u200b set/getEntry \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u901a\u8fc7\u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\u6cd5\u5bf9\u200b key \u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b key \u200b\u4e3a\u200b null\uff08ThreadLocal \u200b\u4e3a\u200b null\uff09\u200b\u4f1a\u200b\u5bf9\u200b Entry \u200b\u8fdb\u884c\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u3002\u200b\u6240\u4ee5\u200b\u4f7f\u7528\u200b\u5f31\u200b\u5f15\u7528\u200b\u6bd4\u5f3a\u200b\u5f15\u7528\u200b\u591a\u4e00\u5c42\u200b\u4fdd\u969c\u200b\uff0c\u200b\u5c31\u7b97\u200b\u4e0d\u200b\u8c03\u7528\u200b remove\uff0c\u200b\u4e5f\u200b\u6709\u200b\u673a\u4f1a\u200b\u8fdb\u884c\u200b GC</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_102","title":"\u53d8\u91cf\u200b\u4f20\u9012","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_103","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>\u200b\u7236\u5b50\u200b\u7ebf\u7a0b\u200b\uff1a\u200b\u521b\u5efa\u200b\u5b50\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u7236\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5b9e\u4f8b\u200b\u4e2d\u200b\u7684\u200b main \u200b\u7ebf\u7a0b\u200b\u5c31\u662f\u200b\u7236\u200b\u7ebf\u7a0b\u200b</p> <p>ThreadLocal \u200b\u4e2d\u200b\u5b58\u50a8\u200b\u7684\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u4f20\u9012\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b InheritableThreadLocal \u200b\u7c7b\u200b</p> Java<pre><code>public static void main(String[] args) {\n    ThreadLocal&lt;String&gt; threadLocal = new InheritableThreadLocal&lt;&gt;();\n    threadLocal.set(\"\u200b\u7236\u200b\u7ebf\u7a0b\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u503c\u200b\");\n\n    new Thread(() -&gt; System.out.println(\"\u200b\u5b50\u200b\u7ebf\u7a0b\u200b\u8f93\u51fa\u200b\uff1a\" + threadLocal.get())).start();\n}\n// \u200b\u5b50\u200b\u7ebf\u7a0b\u200b\u8f93\u51fa\u200b\uff1a\u200b\u7236\u200b\u7ebf\u7a0b\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u503c\u200b\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_104","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"<p>InheritableThreadLocal \u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>public class InheritableThreadLocal&lt;T&gt; extends ThreadLocal&lt;T&gt; {\n    protected T childValue(T parentValue) {\n        return parentValue;\n    }\n    ThreadLocalMap getMap(Thread t) {\n       return t.inheritableThreadLocals;\n    }\n    void createMap(Thread t, T firstValue) {\n        t.inheritableThreadLocals = new ThreadLocalMap(this, firstValue);\n    }\n}\n</code></pre> <p>\u200b\u5b9e\u73b0\u200b\u7236\u5b50\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u5171\u4eab\u200b\u9700\u8981\u200b\u8ffd\u6eaf\u5230\u200b Thread \u200b\u5bf9\u8c61\u200b\u7684\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>private void init(ThreadGroup g, Runnable target, String name, long stackSize, AccessControlContext acc,\n                  // \u200b\u8be5\u200b\u53c2\u6570\u200b\u9ed8\u8ba4\u200b\u662f\u200b true\n                  boolean inheritThreadLocals) {\n    // ...\n    Thread parent = currentThread();\n\n    // \u200b\u5224\u65ad\u200b\u7236\u200b\u7ebf\u7a0b\u200b\uff08\u200b\u521b\u5efa\u200b\u5b50\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff09\u200b\u7684\u200b inheritableThreadLocals \u200b\u5c5e\u6027\u200b\u4e0d\u200b\u4e3a\u200b null\n    if (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != null) {\n        // \u200b\u590d\u5236\u200b\u7236\u200b\u7ebf\u7a0b\u200b\u7684\u200b inheritableThreadLocals \u200b\u5c5e\u6027\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7236\u5b50\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u5171\u4eab\u200b\n        this.inheritableThreadLocals = ThreadLocal.createInheritedMap(parent.inheritableThreadLocals); \n    }\n    // ..\n}\n// \u3010\u200b\u672c\u8d28\u200b\u4e0a\u200b\u8fd8\u662f\u200b\u521b\u5efa\u200b ThreadLocalMap\uff0c\u200b\u53ea\u662f\u200b\u628a\u200b\u7236\u7c7b\u200b\u4e2d\u200b\u7684\u200b\u53ef\u200b\u7ee7\u627f\u200b\u6570\u636e\u200b\u8bbe\u7f6e\u200b\u8fdb\u53bb\u200b\u4e86\u200b\u3011\nstatic ThreadLocalMap createInheritedMap(ThreadLocalMap parentMap) {\n    return new ThreadLocalMap(parentMap);\n}\n</code></pre> Java<pre><code>private ThreadLocalMap(ThreadLocalMap parentMap) {\n    // \u200b\u83b7\u53d6\u200b\u7236\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u54c8\u5e0c\u200b\u8868\u200b\n    Entry[] parentTable = parentMap.table;\n    int len = parentTable.length;\n    setThreshold(len);\n    table = new Entry[len];\n    // \u3010\u200b\u9010\u4e2a\u200b\u590d\u5236\u200b\u7236\u200b\u7ebf\u7a0b\u200b ThreadLocalMap \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u3011\n    for (int j = 0; j &lt; len; j++) {\n        Entry e = parentTable[j];\n        if (e != null) {\n            ThreadLocal&lt;Object&gt; key = (ThreadLocal&lt;Object&gt;) e.get();\n            if (key != null) {\n                // \u200b\u8c03\u7528\u200b\u7684\u200b\u662f\u200b InheritableThreadLocal#childValue(T parentValue)\n                Object value = key.childValue(e.value);\n                Entry c = new Entry(key, value);\n                int h = key.threadLocalHashCode &amp; (len - 1);\n                // \u200b\u7ebf\u6027\u200b\u63a2\u6d4b\u200b\n                while (table[h] != null)\n                    h = nextIndex(h, len);\n                table[h] = c;\n                size++;\n            }\n        }\n    }\n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://blog.csdn.net/feichitianxia/article/details/110495764</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_105","title":"\u7ebf\u7a0b\u200b\u6c60","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_106","title":"\u57fa\u672c\u200b\u6982\u8ff0","text":"<p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u5bb9\u7eb3\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5bb9\u5668\u200b\uff0c\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u91cd\u590d\u4f7f\u7528\u200b\uff0c\u200b\u7701\u53bb\u200b\u4e86\u200b\u9891\u7e41\u200b\u521b\u5efa\u200b\u548c\u200b\u9500\u6bc1\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\u7684\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4f5c\u7528\u200b\uff1a</p> <ol> <li>\u200b\u964d\u4f4e\u200b\u8d44\u6e90\u200b\u6d88\u8017\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u521b\u5efa\u200b\u548c\u200b\u9500\u6bc1\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u91cd\u590d\u200b\u5229\u7528\u200b\uff0c\u200b\u53ef\u200b\u6267\u884c\u200b\u591a\u4e2a\u200b\u4efb\u52a1\u200b</li> <li>\u200b\u63d0\u9ad8\u200b\u54cd\u5e94\u901f\u5ea6\u200b\uff0c\u200b\u5f53\u200b\u4efb\u52a1\u200b\u5230\u8fbe\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7528\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u7cfb\u7edf\u200b\u50f5\u6b7b\u200b</li> <li>\u200b\u63d0\u9ad8\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53ef\u7ba1\u7406\u6027\u200b\uff0c\u200b\u5982\u679c\u200b\u65e0\u200b\u9650\u5236\u200b\u7684\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0d\u4ec5\u200b\u4f1a\u200b\u6d88\u8017\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u964d\u4f4e\u200b\u7cfb\u7edf\u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u7edf\u4e00\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u8c03\u4f18\u200b\u548c\u200b\u76d1\u63a7\u200b</li> </ol> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u6838\u5fc3\u601d\u60f3\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u590d\u7528\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u91cd\u590d\u4f7f\u7528\u200b\uff0c\u200b\u6765\u200b\u5904\u7406\u200b\u591a\u4e2a\u200b\u4efb\u52a1\u200b</p> <p>\u200b\u6c60\u5316\u200b\u6280\u672f\u200b (Pool) \uff1a\u200b\u4e00\u79cd\u200b\u7f16\u7a0b\u200b\u6280\u5de7\u200b\uff0c\u200b\u6838\u5fc3\u601d\u60f3\u200b\u662f\u200b\u8d44\u6e90\u200b\u590d\u7528\u200b\uff0c\u200b\u5728\u200b\u8bf7\u6c42\u200b\u91cf\u5927\u65f6\u200b\u80fd\u200b\u4f18\u5316\u200b\u5e94\u7528\u200b\u6027\u80fd\u200b\uff0c\u200b\u964d\u4f4e\u200b\u7cfb\u7edf\u200b\u9891\u7e41\u200b\u5efa\u8fde\u200b\u7684\u200b\u8d44\u6e90\u200b\u5f00\u9500\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_107","title":"\u963b\u585e\u200b\u961f\u5217","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_108","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u6709\u200b\u754c\u200b\u961f\u5217\u200b\u548c\u200b\u65e0\u754c\u200b\u961f\u5217\u200b\uff1a</p> <ul> <li>\u200b\u6709\u200b\u754c\u200b\u961f\u5217\u200b\uff1a\u200b\u6709\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u961f\u5217\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8bbe\u5b9a\u200b\u4e86\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b LinkedBlockingQueue\uff0c\u200b\u53c8\u200b\u6216\u8005\u200b\u5927\u5c0f\u200b\u4e3a\u200b 0</li> <li>\u200b\u65e0\u200b\u754c\u200b\u961f\u5217\u200b\uff1a\u200b\u6ca1\u6709\u200b\u8bbe\u7f6e\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u961f\u5217\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u961f\u5217\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5165\u961f\u200b\uff0c\u200b\u76f4\u5230\u200b\u6ea2\u51fa\u200b\uff08\u200b\u8d85\u8fc7\u200b Integer.MAX_VALUE\uff09\uff0c\u200b\u6240\u4ee5\u200b\u76f8\u5f53\u4e8e\u200b\u65e0\u200b\u754c\u200b</li> </ul> <p>java.util.concurrent.BlockingQueue \u200b\u63a5\u53e3\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1aFIFO \u200b\u961f\u5217\u200b </p> <ul> <li>ArrayBlockQueue\uff1a\u200b\u7531\u200b\u6570\u7ec4\u200b\u7ed3\u6784\u200b\u7ec4\u6210\u200b\u7684\u200b\u6709\u754c\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> <li>LinkedBlockingQueue\uff1a\u200b\u7531\u200b\u94fe\u8868\u200b\u7ed3\u6784\u200b\u7ec4\u6210\u200b\u7684\u200b\u65e0\u754c\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u5927\u5c0f\u200b Integer.MAX_VALUE\uff09\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> <li>PriorityBlockQueue\uff1a\u200b\u652f\u6301\u200b\u4f18\u5148\u7ea7\u200b\u6392\u5e8f\u200b\u7684\u200b\u65e0\u754c\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> <li>DelayedWorkQueue\uff1a\u200b\u4f7f\u7528\u200b\u4f18\u5148\u7ea7\u200b\u961f\u5217\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u65e0\u200b\u754c\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> <li>SynchronousQueue\uff1a\u200b\u4e0d\u200b\u5b58\u50a8\u200b\u5143\u7d20\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u751f\u4ea7\u7ebf\u200b\u7a0b\u4f1a\u200b\u963b\u585e\u200b\u5230\u200b\u6709\u200b\u4e00\u4e2a\u200b put \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u653e\u5165\u200b\u5143\u7d20\u200b\u4e3a\u6b62\u200b</li> <li>LinkedTransferQueue\uff1a\u200b\u7531\u200b\u94fe\u8868\u200b\u7ed3\u6784\u200b\u7ec4\u6210\u200b\u7684\u200b\u65e0\u754c\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> <li>LinkedBlockingDeque\uff1a\u200b\u7531\u200b\u94fe\u8868\u200b\u7ed3\u6784\u200b\u7ec4\u6210\u200b\u7684\u200b\u53cc\u5411\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> </ul> <p>\u200b\u4e0e\u200b\u666e\u901a\u200b\u961f\u5217\u200b\uff08LinkedList\u3001ArrayList\u200b\u7b49\u200b\uff09\u200b\u7684\u200b\u4e0d\u540c\u70b9\u200b\u5728\u4e8e\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u963b\u585e\u200b\u6dfb\u52a0\u200b\u548c\u200b\u963b\u585e\u200b\u5220\u9664\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff1a</p> <ul> <li>\u200b\u963b\u585e\u200b\u6dfb\u52a0\u200b put()\uff1a\u200b\u5f53\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5143\u7d20\u200b\u5df2\u6ee1\u65f6\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u961f\u5217\u200b\u5143\u7d20\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u76f4\u5230\u200b\u961f\u5217\u200b\u5143\u7d20\u200b\u4e0d\u6ee1\u200b\u65f6\u624d\u200b\u91cd\u65b0\u200b\u5524\u9192\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b</li> <li>\u200b\u963b\u585e\u200b\u5220\u9664\u200b take()\uff1a\u200b\u5728\u200b\u961f\u5217\u200b\u5143\u7d20\u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u5220\u9664\u200b\u961f\u5217\u200b\u5143\u7d20\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u76f4\u5230\u200b\u961f\u5217\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\u518d\u200b\u6267\u884c\u200b\u5220\u9664\u200b\u64cd\u4f5c\u200b\uff08\u200b\u4e00\u822c\u200b\u4f1a\u200b\u8fd4\u56de\u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b\u5143\u7d20\u200b)</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_109","title":"\u6838\u5fc3\u200b\u65b9\u6cd5","text":"\u65b9\u6cd5\u200b\u7c7b\u578b\u200b \u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b \u200b\u7279\u6b8a\u200b\u503c\u200b \u200b\u963b\u585e\u200b \u200b\u8d85\u65f6\u200b \u200b\u63d2\u5165\u200b\uff08\u200b\u5c3e\u200b\uff09 add(e) offer(e) put(e) offer(e,time,unit) \u200b\u79fb\u9664\u200b\uff08\u200b\u5934\u200b\uff09 remove() poll() take() poll(time,unit) \u200b\u68c0\u67e5\u200b\uff08\u200b\u961f\u9996\u200b\u5143\u7d20\u200b\uff09 element() peek() \u200b\u4e0d\u53ef\u200b\u7528\u200b \u200b\u4e0d\u53ef\u200b\u7528\u200b <ul> <li>\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u7ec4\u200b\uff1a</li> <li>\u200b\u5f53\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u6ee1\u65f6\u200b\uff1a\u200b\u5728\u200b\u5f80\u200b\u961f\u5217\u200b\u4e2d\u200b add \u200b\u63d2\u5165\u200b\u5143\u7d20\u200b\u4f1a\u200b\u629b\u51fa\u200b IIIegalStateException: Queue full</li> <li>\u200b\u5f53\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7a7a\u65f6\u200b\uff1a\u200b\u518d\u200b\u5f80\u200b\u961f\u5217\u200b\u4e2d\u200b remove \u200b\u79fb\u9664\u200b\u5143\u7d20\u200b\uff0c\u200b\u4f1a\u200b\u629b\u51fa\u200b NoSuchException</li> <li>\u200b\u7279\u6b8a\u200b\u503c\u7ec4\u200b\uff1a</li> <li>\u200b\u63d2\u5165\u65b9\u6cd5\u200b\uff1a\u200b\u6210\u529f\u200b true\uff0c\u200b\u5931\u8d25\u200b false</li> <li>\u200b\u79fb\u9664\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b\u51fa\u200b\u961f\u5217\u200b\u5143\u7d20\u200b\uff0c\u200b\u961f\u5217\u200b\u6ca1\u6709\u200b\u5c31\u200b\u8fd4\u56de\u200b null</li> <li>\u200b\u963b\u585e\u200b\u7ec4\u200b\uff1a</li> <li>\u200b\u5f53\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u6ee1\u65f6\u200b\uff0c\u200b\u751f\u4ea7\u8005\u200b\u7ee7\u7eed\u200b\u5f80\u200b\u961f\u5217\u200b\u91cc\u200b put \u200b\u5143\u7d20\u200b\uff0c\u200b\u961f\u5217\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\u751f\u4ea7\u7ebf\u200b\u7a0b\u200b\u76f4\u5230\u200b\u961f\u5217\u200b\u6709\u200b\u7a7a\u95f4\u200b put \u200b\u6570\u636e\u200b\u6216\u200b\u54cd\u5e94\u200b\u4e2d\u65ad\u200b\u9000\u51fa\u200b</li> <li>\u200b\u5f53\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u7ebf\u7a0b\u200b\u8bd5\u56fe\u200b\u4ece\u200b\u961f\u5217\u200b\u91cc\u200b take \u200b\u5143\u7d20\u200b\uff0c\u200b\u961f\u5217\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\u6d88\u8d39\u8005\u200b\u7ebf\u7a0b\u200b\u76f4\u5230\u200b\u961f\u5217\u200b\u4e2d\u6709\u200b\u53ef\u7528\u200b\u5143\u7d20\u200b</li> <li>\u200b\u8d85\u65f6\u200b\u9000\u51fa\u200b\uff1a\u200b\u5f53\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u6ee1\u65f6\u200b\uff0c\u200b\u961f\u91cc\u200b\u4f1a\u200b\u963b\u585e\u200b\u751f\u4ea7\u8005\u200b\u7ebf\u7a0b\u200b\u4e00\u5b9a\u200b\u65f6\u95f4\u200b\uff0c\u200b\u8d85\u8fc7\u200b\u9650\u65f6\u200b\u540e\u200b\u751f\u4ea7\u8005\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u9000\u51fa\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_110","title":"\u94fe\u8868\u200b\u961f\u5217","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_111","title":"\u5165\u961f\u200b\u51fa\u961f","text":"<p>LinkedBlockingQueue \u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>public class LinkedBlockingQueue&lt;E&gt; extends AbstractQueue&lt;E&gt;\n            implements BlockingQueue&lt;E&gt;, java.io.Serializable {\n    static class Node&lt;E&gt; {\n        E item;\n        /**\n        * \u200b\u4e0b\u5217\u200b\u4e09\u79cd\u200b\u60c5\u51b5\u200b\u4e4b\u4e00\u200b\n        * - \u200b\u771f\u6b63\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n        * - \u200b\u81ea\u5df1\u200b, \u200b\u53d1\u751f\u200b\u5728\u200b\u51fa\u961f\u200b\u65f6\u200b\n        * - null, \u200b\u8868\u793a\u200b\u662f\u200b\u6ca1\u6709\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b, \u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u4e86\u200b\n        */\n        Node&lt;E&gt; next;\n\n        Node(E x) { item = x; }\n    }\n}\n</code></pre> <p>\u200b\u5165\u961f\u200b\uff1a\u200b\u5c3e\u200b\u63d2\u6cd5\u200b</p> <ul> <li>\u200b\u521d\u59cb\u5316\u200b\u94fe\u8868\u200b <code>last = head = new Node&lt;E&gt;(null)</code>\uff0cDummy \u200b\u8282\u70b9\u200b\u7528\u6765\u200b\u5360\u4f4d\u200b\uff0citem \u200b\u4e3a\u200b null</li> </ul> Java<pre><code>public LinkedBlockingQueue(int capacity) {\n    // \u200b\u9ed8\u8ba4\u200b\u662f\u200b Integer.MAX_VALUE\n    if (capacity &lt;= 0) throw new IllegalArgumentException();\n    this.capacity = capacity;\n    last = head = new Node&lt;E&gt;(null);\n}\n</code></pre> <ul> <li>\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u5165\u961f\u200b\uff1a</li> </ul> Java<pre><code>private void enqueue(Node&lt;E&gt; node) {\n    // \u200b\u4ece\u53f3\u200b\u5411\u200b\u5de6\u200b\u8ba1\u7b97\u200b\n    last = last.next = node;\n}\n</code></pre> <p></p> <ul> <li>\u200b\u518d\u6765\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u5165\u961f\u200b <code>last = last.next = node</code></li> </ul> <p>\u200b\u51fa\u961f\u200b\uff1a\u200b\u51fa\u961f\u200b\u5934\u200b\u8282\u70b9\u200b\uff0cFIFO</p> <ul> <li>\u200b\u51fa\u961f\u200b\u6e90\u7801\u200b\uff1a</li> </ul> Java<pre><code>private E dequeue() {\n    Node&lt;E&gt; h = head;\n    // \u200b\u83b7\u53d6\u200b\u4e34\u5934\u200b\u8282\u70b9\u200b\n    Node&lt;E&gt; first = h.next;\n    // \u200b\u81ea\u5df1\u200b\u6307\u5411\u200b\u81ea\u5df1\u200b\uff0chelp GC\n    h.next = h;\n    head = first;\n    // \u200b\u51fa\u961f\u200b\u7684\u200b\u5143\u7d20\u200b\n    E x = first.item;\n    // \u3010\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7f6e\u200b\u4e3a\u200b Dummy \u200b\u8282\u70b9\u200b\u3011\n    first.item = null;\n    return x;\n}\n</code></pre> <ul> <li><code>h = head</code> \u2192 <code>first = h.next</code> </li> </ul> <p></p> <ul> <li><code>h.next = h</code> \u2192 <code>head = first</code></li> </ul> <p></p> <ul> <li><code>first.item = null</code>\uff1a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7f6e\u200b\u4e3a\u200b Dummy \u200b\u8282\u70b9\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_112","title":"\u52a0\u9501\u200b\u5206\u6790","text":"<p>\u200b\u7528\u200b\u4e86\u200b\u4e24\u628a\u200b\u9501\u200b\u548c\u200b dummy \u200b\u8282\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u7528\u200b\u4e00\u628a\u200b\u9501\u200b\uff0c\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\uff0c\u200b\u6700\u200b\u591a\u53ea\u200b\u5141\u8bb8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff08\u200b\u751f\u4ea7\u8005\u200b\u6216\u200b\u6d88\u8d39\u8005\u200b\uff0c\u200b\u4e8c\u9009\u200b\u4e00\u200b\uff09\u200b\u6267\u884c\u200b</li> <li>\u200b\u7528\u200b\u4e24\u628a\u200b\u9501\u200b\uff0c\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5141\u8bb8\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\uff08\u200b\u4e00\u4e2a\u200b\u751f\u4ea7\u8005\u200b\u4e0e\u200b\u4e00\u4e2a\u200b\u6d88\u8d39\u8005\u200b\uff09\u200b\u6267\u884c\u200b</li> <li>\u200b\u6d88\u8d39\u8005\u200b\u4e0e\u200b\u6d88\u8d39\u8005\u200b\u7ebf\u7a0b\u200b\u4ecd\u7136\u200b\u4e32\u884c\u200b</li> <li>\u200b\u751f\u4ea7\u8005\u200b\u4e0e\u200b\u751f\u4ea7\u8005\u200b\u7ebf\u7a0b\u200b\u4ecd\u7136\u200b\u4e32\u884c\u200b</li> </ul> <p>\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u5206\u6790\u200b\uff1a</p> <ul> <li>\u200b\u5f53\u200b\u8282\u70b9\u200b\u603b\u6570\u200b\u5927\u4e8e\u200b 2 \u200b\u65f6\u200b\uff08\u200b\u5305\u62ec\u200b dummy \u200b\u8282\u70b9\u200b\uff09\uff0cputLock \u200b\u4fdd\u8bc1\u200b\u7684\u200b\u662f\u200b last \u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0ctakeLock \u200b\u4fdd\u8bc1\u200b\u7684\u200b\u662f\u200b head \u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u4e24\u628a\u200b\u9501\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5165\u961f\u200b\u548c\u200b\u51fa\u961f\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b</li> <li>\u200b\u5f53\u200b\u8282\u70b9\u200b\u603b\u6570\u200b\u7b49\u4e8e\u200b 2 \u200b\u65f6\u200b\uff08\u200b\u5373\u200b\u4e00\u4e2a\u200b dummy \u200b\u8282\u70b9\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b\uff09\u200b\u8fd9\u65f6\u5019\u200b\uff0c\u200b\u4ecd\u7136\u200b\u662f\u200b\u4e24\u628a\u200b\u9501\u9501\u200b\u4e24\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7ade\u4e89\u200b</li> <li>\u200b\u5f53\u200b\u8282\u70b9\u200b\u603b\u6570\u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u200b\uff08\u200b\u5c31\u200b\u4e00\u4e2a\u200b dummy \u200b\u8282\u70b9\u200b\uff09\u200b\u8fd9\u65f6\u200b take \u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u88ab\u200b notEmpty \u200b\u6761\u4ef6\u200b\u963b\u585e\u200b\uff0c\u200b\u6709\u200b\u7ade\u4e89\u200b\uff0c\u200b\u4f1a\u200b\u963b\u585e\u200b</li> </ul> Java<pre><code>// \u200b\u7528\u4e8e\u200b put(\u200b\u963b\u585e\u200b) offer(\u200b\u975e\u200b\u963b\u585e\u200b)\nprivate final ReentrantLock putLock = new ReentrantLock();\nprivate final Condition notFull = putLock.newCondition(); // \u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u4e0d\u6ee1\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\n\n// \u200b\u7528\u4e8e\u200b take(\u200b\u963b\u585e\u200b) poll(\u200b\u975e\u200b\u963b\u585e\u200b)\nprivate final ReentrantLock takeLock = new ReentrantLock();\nprivate final Condition notEmpty = takeLock.newCondition();   // \u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u4e0d\u7a7a\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5df2\u7ecf\u200b\u662f\u200b\u7a7a\u200b\u7684\u200b\n</code></pre> <p>\u200b\u5165\u961f\u200b\u51fa\u961f\u200b\uff1a</p> <ul> <li>put \u200b\u64cd\u4f5c\u200b\uff1a</li> </ul> Java<pre><code>public void put(E e) throws InterruptedException {\n    // \u200b\u7a7a\u200b\u6307\u9488\u200b\u5f02\u5e38\u200b\n    if (e == null) throw new NullPointerException();\n    int c = -1;\n    // \u200b\u628a\u200b\u5f85\u200b\u6dfb\u52a0\u200b\u7684\u200b\u5143\u7d20\u200b\u5c01\u88c5\u200b\u4e3a\u200b node \u200b\u8282\u70b9\u200b\n    Node&lt;E&gt; node = new Node&lt;E&gt;(e);\n    // \u200b\u83b7\u53d6\u200b\u5168\u5c40\u200b\u751f\u4ea7\u200b\u9501\u200b\n    final ReentrantLock putLock = this.putLock;\n    // count \u200b\u7528\u6765\u200b\u7ef4\u62a4\u200b\u5143\u7d20\u200b\u8ba1\u6570\u200b\n    final AtomicInteger count = this.count;\n    // \u200b\u83b7\u53d6\u200b\u53ef\u200b\u6253\u65ad\u200b\u9501\u200b\uff0c\u200b\u4f1a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n    putLock.lockInterruptibly();\n    try {\n      // \u200b\u961f\u5217\u200b\u6ee1\u200b\u4e86\u200b\u7b49\u5f85\u200b\n        while (count.get() == capacity) {\n            // \u3010\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0d\u6ee1\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u751f\u4ea7\u200b\u6570\u636e\u200b\u3011\uff0c\u200b\u7ebf\u7a0b\u200b\u5904\u4e8e\u200b Waiting\n            notFull.await();\n        }\n        // \u200b\u6709\u200b\u7a7a\u4f4d\u200b, \u200b\u5165\u961f\u200b\u4e14\u200b\u8ba1\u6570\u200b\u52a0\u4e00\u200b\uff0c\u200b\u5c3e\u200b\u63d2\u6cd5\u200b\n        enqueue(node);\n        // \u200b\u8fd4\u56de\u200b\u81ea\u589e\u524d\u200b\u7684\u200b\u6570\u5b57\u200b\n        c = count.getAndIncrement();\n        // put \u200b\u5b8c\u200b\u961f\u5217\u200b\u8fd8\u6709\u200b\u7a7a\u4f4d\u200b, \u200b\u5524\u9192\u200b\u5176\u4ed6\u200b\u751f\u4ea7\u200b put \u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b\u51cf\u5c11\u200b\u7ade\u4e89\u200b\n        if (c + 1 &lt; capacity)\n            notFull.signal();\n    } finally {\n        // \u200b\u89e3\u9501\u200b\n        putLock.unlock();\n    }\n    // c\u200b\u81ea\u589e\u524d\u200b\u662f\u200b0\uff0c\u200b\u8bf4\u660e\u200b\u751f\u4ea7\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b take \u200b\u7ebf\u7a0b\u200b\n    if (c == 0)\n        signalNotEmpty();\n}\n</code></pre> Java<pre><code>private void signalNotEmpty() {\n    final ReentrantLock takeLock = this.takeLock;\n    takeLock.lock();\n    try {\n        // \u200b\u8c03\u7528\u200b notEmpty.signal()\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b notEmpty.signalAll() \u200b\u662f\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u7ade\u4e89\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ea\u200b\u5269\u4e0b\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\n        notEmpty.signal();\n    } finally {\n        takeLock.unlock();\n    }\n}\n</code></pre> <ul> <li>take \u200b\u64cd\u4f5c\u200b\uff1a</li> </ul> Java<pre><code>public E take() throws InterruptedException {\n    E x;\n    int c = -1;\n    // \u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\n    final AtomicInteger count = this.count;\n    // \u200b\u83b7\u53d6\u200b\u5168\u5c40\u200b\u6d88\u8d39\u200b\u9501\u200b\n    final ReentrantLock takeLock = this.takeLock;\n    // \u200b\u53ef\u200b\u6253\u65ad\u200b\u9501\u200b\n    takeLock.lockInterruptibly();\n    try {\n        // \u200b\u6ca1\u6709\u200b\u5143\u7d20\u200b\u53ef\u4ee5\u200b\u51fa\u961f\u200b\n        while (count.get() == 0) {\n            // \u3010\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0d\u7a7a\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6d88\u8d39\u200b\u6570\u636e\u200b\u3011\uff0c\u200b\u7ebf\u7a0b\u200b\u5904\u4e8e\u200b Waiting\n            notEmpty.await();\n        }\n        // \u200b\u51fa\u961f\u200b\uff0c\u200b\u8ba1\u6570\u200b\u51cf\u4e00\u200b\uff0cFIFO\uff0c\u200b\u51fa\u961f\u200b\u5934\u200b\u8282\u70b9\u200b\n        x = dequeue();\n        // \u200b\u8fd4\u56de\u200b\u81ea\u51cf\u200b\u524d\u200b\u7684\u200b\u6570\u5b57\u200b\n        c = count.getAndDecrement();\n        // \u200b\u961f\u5217\u200b\u8fd8\u6709\u200b\u5143\u7d20\u200b\n        if (c &gt; 1)\n            // \u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b\u6d88\u8d39\u200btake\u200b\u7ebf\u7a0b\u200b\n            notEmpty.signal();\n    } finally {\n        takeLock.unlock();\n    }\n    // c \u200b\u662f\u200b\u6d88\u8d39\u200b\u524d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6d88\u8d39\u200b\u524d\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u6d88\u8d39\u200b\u4e00\u4e2a\u200b\u540e\u200b\u8fd8\u200b\u5269\u200b\u4e00\u4e2a\u200b\u7a7a\u4f4d\u200b\uff0c\u200b\u5524\u9192\u200b\u751f\u4ea7\u7ebf\u200b\u7a0b\u200b\n    if (c == capacity)\n        // \u200b\u8c03\u7528\u200b\u7684\u200b\u662f\u200b notFull.signal() \u200b\u800c\u200b\u4e0d\u662f\u200b notFull.signalAll() \u200b\u662f\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u7ade\u4e89\u200b\n        signalNotFull();\n    return x;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_113","title":"\u6027\u80fd\u200b\u6bd4\u8f83","text":"<p>\u200b\u4e3b\u8981\u200b\u5217\u4e3e\u200b LinkedBlockingQueue \u200b\u4e0e\u200b ArrayBlockingQueue \u200b\u7684\u200b\u6027\u80fd\u200b\u6bd4\u8f83\u200b\uff1a</p> <ul> <li>Linked \u200b\u652f\u6301\u200b\u6709\u200b\u754c\u200b\uff0cArray \u200b\u5f3a\u5236\u200b\u6709\u200b\u754c\u200b</li> <li>Linked \u200b\u5b9e\u73b0\u200b\u662f\u200b\u94fe\u8868\u200b\uff0cArray \u200b\u5b9e\u73b0\u200b\u662f\u200b\u6570\u7ec4\u200b</li> <li>Linked \u200b\u662f\u200b\u61d2\u60f0\u200b\u7684\u200b\uff0c\u200b\u800c\u200b Array \u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u521d\u59cb\u5316\u200b Node \u200b\u6570\u7ec4\u200b</li> <li>Linked \u200b\u6bcf\u6b21\u200b\u5165\u961f\u200b\u4f1a\u200b\u751f\u6210\u200b\u65b0\u200b Node\uff0c\u200b\u800c\u200b Array \u200b\u7684\u200b Node \u200b\u662f\u200b\u63d0\u524d\u200b\u521b\u5efa\u200b\u597d\u200b\u7684\u200b</li> <li>Linked \u200b\u4e24\u628a\u200b\u9501\u200b\uff0cArray \u200b\u4e00\u628a\u200b\u9501\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_114","title":"\u540c\u6b65\u200b\u961f\u5217","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_115","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"<p>SynchronousQueue \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u5b58\u50a8\u200b\u5143\u7d20\u200b\u7684\u200b BlockingQueue\uff0c\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u751f\u4ea7\u8005\u200b\u5fc5\u987b\u200b\u963b\u585e\u200b\u5339\u914d\u200b\u5230\u200b\u4e00\u4e2a\u200b\u6d88\u8d39\u8005\u200b</p> <p>\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u8fd0\u884c\u200b\u5f53\u524d\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5e73\u53f0\u200b\u62e5\u6709\u200b CPU \u200b\u7684\u200b\u6570\u91cf\u200b\uff1a</li> </ul> Java<pre><code>static final int NCPUS = Runtime.getRuntime().availableProcessors()\n</code></pre> <ul> <li>\u200b\u6307\u5b9a\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u540e\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6700\u5927\u200b\u81ea\u65cb\u200b\u6b21\u6570\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b CPU \u200b\u65f6\u200b\u81ea\u65cb\u200b\u6b21\u6570\u200b\u4e3a\u200b 0\uff0c\u200b\u6240\u6709\u200b\u7a0b\u5e8f\u200b\u90fd\u200b\u662f\u200b\u4e32\u884c\u200b\u6267\u884c\u200b\uff0c\u200b\u591a\u6838\u200b CPU \u200b\u65f6\u200b\u81ea\u65cb\u200b 32 \u200b\u6b21\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7ecf\u9a8c\u503c\u200b\nstatic final int maxTimedSpins = (NCPUS &lt; 2) ? 0 : 32;\n</code></pre> <p>\u200b\u81ea\u65cb\u200b\u7684\u200b\u539f\u56e0\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b\u5524\u9192\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u6d89\u53ca\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u8f6c\u53d8\u200b\uff0c\u200b\u662f\u200b\u975e\u5e38\u200b\u6d88\u8017\u200b\u8d44\u6e90\u200b\u7684\u200b\u3002\u200b\u81ea\u65cb\u200b\u671f\u95f4\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u68c0\u67e5\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\u662f\u5426\u200b\u88ab\u200b\u5339\u914d\u200b\u5230\u200b\uff0c\u200b\u5982\u679c\u200b\u81ea\u65cb\u200b\u671f\u95f4\u200b\u88ab\u200b\u5339\u914d\u200b\u5230\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76f4\u63a5\u200b\u5c31\u200b\u8fd4\u56de\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u81ea\u65cb\u200b\u6b21\u6570\u200b\u8fbe\u5230\u200b\u67d0\u4e2a\u200b\u6307\u6807\u200b\u540e\u200b\uff0c\u200b\u8fd8\u662f\u200b\u4f1a\u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b</p> <ul> <li>\u200b\u672a\u6307\u5b9a\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6700\u5927\u200b\u81ea\u65cb\u200b\u6b21\u6570\u200b\uff1a</li> </ul> Java<pre><code>static final int maxUntimedSpins = maxTimedSpins * 16;    // maxTimedSpins \u200b\u7684\u200b 16 \u200b\u500d\u200b\n</code></pre> <ul> <li>\u200b\u6307\u5b9a\u200b\u8d85\u65f6\u200b\u9650\u5236\u200b\u7684\u200b\u9608\u503c\u200b\uff0c\u200b\u5c0f\u4e8e\u200b\u8be5\u503c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u6302\u200b\u8d77\u200b\uff1a</li> </ul> Java<pre><code>static final long spinForTimeoutThreshold = 1000L;    // \u200b\u7eb3\u79d2\u200b\n</code></pre> <p>\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5c0f\u4e8e\u200b\u8be5\u503c\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u7981\u6b62\u200b\u6302\u200b\u8d77\u200b\uff0c\u200b\u963b\u585e\u200b\u518d\u200b\u5524\u9192\u200b\u7684\u200b\u6210\u672c\u200b\u592a\u9ad8\u200b\uff0c\u200b\u4e0d\u5982\u200b\u9009\u62e9\u200b\u81ea\u65cb\u200b\u7a7a\u8f6c\u200b</p> <ul> <li>\u200b\u8f6c\u6362\u5668\u200b\uff1a</li> </ul> Java<pre><code>private transient volatile Transferer&lt;E&gt; transferer;\nabstract static class Transferer&lt;E&gt; {\n    /**\n    * \u200b\u53c2\u6570\u200b\u4e00\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u4e3a\u200b null\uff0cnull \u200b\u65f6\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u8bf7\u6c42\u200b\u662f\u200b\u4e00\u4e2a\u200b REQUEST \u200b\u7c7b\u578b\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u53cd\u4e4b\u200b\u662f\u200b\u4e00\u4e2a\u200b DATA \u200b\u7c7b\u578b\u200b\u7684\u200b\u8bf7\u6c42\u200b\n    * \u200b\u53c2\u6570\u200b\u4e8c\u200b\uff1a\u200b\u5982\u679c\u200b\u4e3a\u200b true \u200b\u8868\u793a\u200b\u6307\u5b9a\u200b\u4e86\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5982\u679c\u200b\u4e3a\u200b false \u200b\u8868\u793a\u200b\u4e0d\u200b\u652f\u6301\u200b\u8d85\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\u5230\u200b\u5339\u914d\u200b\u6216\u8005\u200b\u88ab\u200b\u6253\u65ad\u200b\n    * \u200b\u53c2\u6570\u200b\u4e09\u200b\uff1a\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u9650\u5236\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b\u7eb3\u79d2\u200b\n\n    * \u200b\u8fd4\u56de\u503c\u200b\uff1a\u200b\u8fd4\u56de\u503c\u200b\u5982\u679c\u200b\u4e0d\u200b\u4e3a\u200b null \u200b\u8868\u793a\u200b\u5339\u914d\u200b\u6210\u529f\u200b\uff0cDATA \u200b\u7c7b\u578b\u200b\u7684\u200b\u8bf7\u6c42\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b put \u200b\u7684\u200b\u6570\u636e\u200b\n    *          \u200b\u5982\u679c\u200b\u8fd4\u56de\u200b null\uff0c\u200b\u8868\u793a\u200b\u8bf7\u6c42\u200b\u8d85\u65f6\u200b\u6216\u200b\u88ab\u200b\u4e2d\u65ad\u200b\n    */\n    abstract E transfer(E e, boolean timed, long nanos);\n}\n</code></pre> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>public SynchronousQueue(boolean fair) {\n    // fair \u200b\u9ed8\u8ba4\u200b false\n    // \u200b\u975e\u200b\u516c\u5e73\u200b\u6a21\u5f0f\u200b\u5b9e\u73b0\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u662f\u200b\u6808\u200b\uff0c\u200b\u516c\u5e73\u200b\u6a21\u5f0f\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u662f\u200b\u961f\u5217\u200b\n    transferer = fair ? new TransferQueue&lt;E&gt;() : new TransferStack&lt;E&gt;();\n}\n</code></pre> <ul> <li>\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>public boolean offer(E e) {\n    if (e == null) throw new NullPointerException();\n    return transferer.transfer(e, true, 0) != null;\n}\npublic E poll() {\n    return transferer.transfer(null, true, 0);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_116","title":"\u975e\u516c\u200b\u5b9e\u73b0","text":"<p>TransferStack \u200b\u662f\u975e\u200b\u516c\u5e73\u200b\u7684\u200b\u540c\u6b65\u200b\u961f\u5217\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6240\u6709\u200b\u7684\u200b\u8bf7\u6c42\u200b\u90fd\u200b\u88ab\u200b\u538b\u5165\u200b\u6808\u200b\u4e2d\u200b\uff0c\u200b\u6808\u9876\u200b\u7684\u200b\u5143\u7d20\u200b\u4f1a\u200b\u6700\u5148\u200b\u5f97\u5230\u200b\u5339\u914d\u200b\uff0c\u200b\u9020\u6210\u200b\u6808\u5e95\u200b\u7684\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\u9965\u997f\u200b</p> <p>TransferStack \u200b\u7c7b\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u8868\u793a\u200b Node \u200b\u7c7b\u578b\u200b\u4e3a\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\nstatic final int REQUEST    = 0;\n// \u200b\u8868\u793a\u200b Node\u200b\u7c7b\u200b \u200b\u578b\u200b\u4e3a\u200b\u6570\u636e\u7c7b\u578b\u200b\nstatic final int DATA       = 1;\n// \u200b\u8868\u793a\u200b Node \u200b\u7c7b\u578b\u200b\u4e3a\u200b\u5339\u914d\u200b\u4e2d\u200b\u7c7b\u578b\u200b\n// \u200b\u5047\u8bbe\u200b\u6808\u9876\u200b\u5143\u7d20\u200b\u4e3a\u200b REQUEST-NODE\uff0c\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u4e3a\u200b DATA\uff0c\u200b\u5165\u6808\u200b\u4f1a\u200b\u4fee\u6539\u200b\u7c7b\u578b\u200b\u4e3a\u200b FULFILLING \u3010\u200b\u6808\u9876\u200b &amp; \u200b\u6808\u9876\u200b\u4e4b\u4e0b\u200b\u7684\u200b\u4e00\u4e2a\u200bnode\u3011\n// \u200b\u5047\u8bbe\u200b\u6808\u9876\u200b\u5143\u7d20\u200b\u4e3a\u200b DATA-NODE\uff0c\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u4e3a\u200b REQUEST\uff0c\u200b\u5165\u6808\u200b\u4f1a\u200b\u4fee\u6539\u200b\u7c7b\u578b\u200b\u4e3a\u200b FULFILLING \u3010\u200b\u6808\u9876\u200b &amp; \u200b\u6808\u9876\u200b\u4e4b\u4e0b\u200b\u7684\u200b\u4e00\u4e2a\u200bnode\u3011\nstatic final int FULFILLING = 2;\n</code></pre> <ul> <li>\u200b\u6808\u9876\u200b\u5143\u7d20\u200b\uff1a</li> </ul> Java<pre><code>volatile SNode head;\n</code></pre> <p>\u200b\u5185\u90e8\u200b\u7c7b\u200b SNode\uff1a</p> <ul> <li>\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff1a</li> </ul> Java<pre><code>static final class SNode {\n    // \u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6808\u5e27\u200b\n    volatile SNode next; \n    // \u200b\u4e0e\u200b\u5f53\u524d\u200b node \u200b\u5339\u914d\u200b\u7684\u200b\u8282\u70b9\u200b\n    volatile SNode match;\n    // \u200b\u5047\u8bbe\u200b\u5f53\u524d\u200bnode\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u81ea\u65cb\u200b\u671f\u95f4\u200b\u672a\u200b\u88ab\u200b\u5339\u914d\u200b\u6210\u529f\u200b\uff0c\u200b\u90a3\u4e48\u200bnode\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u6302\u200b\u8d77\u200b\uff0c\n    // \u200b\u6302\u200b\u8d77\u524d\u200b waiter \u200b\u4fdd\u5b58\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5f15\u7528\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u5339\u914d\u200b\u6210\u529f\u200b\u540e\u200b\uff0c\u200b\u88ab\u200b\u5524\u9192\u200b\u3002\n    volatile Thread waiter;\n\n    // \u200b\u6570\u636e\u200b\u57df\u200b\uff0c\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b Node \u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u4e3a\u200b DATA \u200b\u7c7b\u578b\u200b\uff0c\u200b\u53cd\u4e4b\u200b\u5219\u200b\u8868\u793a\u200b Node \u200b\u4e3a\u200b REQUEST \u200b\u7c7b\u578b\u200b\n    Object item; \n    // \u200b\u8868\u793a\u200b\u5f53\u524d\u200bNode\u200b\u7684\u200b\u6a21\u5f0f\u200b \u3010DATA/REQUEST/FULFILLING\u3011\n    int mode;\n}\n</code></pre> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>SNode(Object item) {\n    this.item = item;\n}\n</code></pre> <ul> <li>\u200b\u8bbe\u7f6e\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u8bbe\u7f6e\u200b Node \u200b\u5bf9\u8c61\u200b\u7684\u200b next \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u6b64\u5904\u200b\u5bf9\u200b CAS \u200b\u8fdb\u884c\u200b\u4e86\u200b\u4f18\u5316\u200b\uff0c\u200b\u63d0\u5347\u200b\u4e86\u200b CAS \u200b\u7684\u200b\u6548\u7387\u200b</li> </ul> Java<pre><code>boolean casNext(SNode cmp, SNode val) {\n    //\u3010\u200b\u4f18\u5316\u200b\uff1acmp == next\u3011\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u5347\u200b\u4e00\u90e8\u5206\u200b\u6027\u80fd\u200b\u3002 cmp == next \u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u6ca1\u200b\u5fc5\u8981\u200b\u8d70\u200b cas\u200b\u6307\u4ee4\u200b\u3002\n    return cmp == next &amp;&amp; UNSAFE.compareAndSwapObject(this, nextOffset, cmp, val);\n}\n</code></pre> <ul> <li>\u200b\u5339\u914d\u200b\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>boolean tryMatch(SNode s) {\n    // \u200b\u5f53\u524d\u200b node \u200b\u5c1a\u672a\u200b\u4e0e\u200b\u4efb\u4f55\u200b\u8282\u70b9\u200b\u53d1\u751f\u200b\u8fc7\u200b\u5339\u914d\u200b\uff0cCAS \u200b\u8bbe\u7f6e\u200b match \u200b\u5b57\u6bb5\u200b\u4e3a\u200b s \u200b\u8282\u70b9\u200b\uff0c\u200b\u8868\u793a\u200b\u5f53\u524d\u200b node \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5339\u914d\u200b\n    if (match == null &amp;&amp; UNSAFE.compareAndSwapObject(this, matchOffset, null, s)) {\n        // \u200b\u5f53\u524d\u200b node \u200b\u5982\u679c\u200b\u81ea\u65cb\u200b\u7ed3\u675f\u200b\uff0c\u200b\u4f1a\u200b park \u200b\u963b\u585e\u200b\uff0c\u200b\u963b\u585e\u200b\u524d\u200b\u5c06\u200b node \u200b\u5bf9\u5e94\u200b\u7684\u200b Thread \u200b\u4fdd\u7559\u200b\u5230\u200b waiter \u200b\u5b57\u200b\u6bb5\u200b\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b node \u200b\u5bf9\u5e94\u200b\u7684\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\n        Thread w = waiter;\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b node \u200b\u5bf9\u5e94\u200b\u7684\u200b Thread \u200b\u6b63\u5728\u200b\u963b\u585e\u200b\n        if (w != null) {\n            waiter = null;\n            // \u200b\u4f7f\u7528\u200b unpark \u200b\u65b9\u5f0f\u200b\u5524\u9192\u200b\u7ebf\u7a0b\u200b\n            LockSupport.unpark(w);\n        }\n        return true;\n    }\n    // \u200b\u5339\u914d\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b true\n    return match == s;\n}\n</code></pre> <ul> <li>\u200b\u53d6\u6d88\u200b\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u7684\u200b\u65b9\u6cd5\u200b\nvoid tryCancel() {\n    // match \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b\u81ea\u5df1\u200b\uff0c\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b node \u200b\u662f\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\uff0c\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u7684\u200b node\uff0c\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u88ab\u200b\u5f3a\u5236\u200b\u79fb\u9664\u200b\u51fa\u6808\u200b\n    UNSAFE.compareAndSwapObject(this, matchOffset, null, this);\n}\n\nboolean isCancelled() {\n    return match == this;\n}\n</code></pre> <p>TransferStack \u200b\u7c7b\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>snode()\uff1a\u200b\u586b\u5145\u200b\u8282\u70b9\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>static SNode snode(SNode s, Object e, SNode next, int mode) {\n    // \u200b\u5f15\u7528\u200b\u6307\u5411\u200b\u7a7a\u65f6\u200b\uff0csnode \u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b SNode \u200b\u5bf9\u8c61\u200b \n    if (s == null) s = new SNode(e);\n    // \u200b\u586b\u5145\u200b\u6570\u636e\u200b\n    s.mode = mode;\n    s.next = next;\n    return s;\n}\n</code></pre> <ul> <li>transfer()\uff1a\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u5339\u914d\u200b\u51fa\u6808\u200b\uff0c\u200b\u4e0d\u200b\u5339\u914d\u200b\u963b\u585e\u200b</li> </ul> Java<pre><code>E transfer(E e, boolean timed, long nanos) {\n  // \u200b\u5305\u88c5\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b node\n    SNode s = null;\n    // \u200b\u6839\u636e\u200b\u5143\u7d20\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7684\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\n    int mode = (e == null) ? REQUEST : DATA;\n  // \u200b\u81ea\u65cb\u200b\n    for (;;) {\n        // \u200b\u83b7\u53d6\u200b\u6808\u9876\u200b\u6307\u9488\u200b\n        SNode h = head;\n       // \u3010CASE1\u3011\uff1a\u200b\u5f53\u524d\u200b\u6808\u4e3a\u200b\u7a7a\u200b\u6216\u8005\u200b\u6808\u9876\u200b node \u200b\u6a21\u5f0f\u200b\u4e0e\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u6a21\u5f0f\u200b\u4e00\u81f4\u200b\u65e0\u6cd5\u200b\u5339\u914d\u200b\uff0c\u200b\u505a\u5165\u200b\u6808\u200b\u64cd\u4f5c\u200b\n        if (h == null || h.mode == mode) {\n            // \u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u662f\u200b\u652f\u6301\u200b\u8d85\u65f6\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b nanos &lt;= 0 \u200b\u8bf4\u660e\u200b\u8fd9\u4e2a\u200b\u8bf7\u6c42\u200b\u4e0d\u200b\u652f\u6301\u200b \u201c\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u201d\n            if (timed &amp;&amp; nanos &lt;= 0) { \n                // \u200b\u6808\u9876\u200b\u5143\u7d20\u200b\u662f\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n                if (h != null &amp;&amp; h.isCancelled())\n                    // \u200b\u6808\u9876\u200b\u51fa\u6808\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u65b0\u200b\u7684\u200b\u6808\u9876\u200b\n                    casHead(h, h.next);\n                else\n                    // \u200b\u8868\u793a\u200b\u3010\u200b\u5339\u914d\u200b\u5931\u8d25\u200b\u3011\n                    return null;\n            // \u200b\u5165\u6808\u200b\n            } else if (casHead(h, s = snode(s, e, h, mode))) {\n                // \u200b\u7b49\u5f85\u200b\u88ab\u200b\u5339\u914d\u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u8fd4\u56de\u200b\u5339\u914d\u200b\u7684\u200b\u8282\u70b9\u200b\uff1b\u200b\u53d6\u6d88\u200b\u60c5\u51b5\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\uff0c\u200b\u5c31\u662f\u200b s\n                SNode m = awaitFulfill(s, timed, nanos);\n                // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b node \u200b\u662f\u200b\u3010\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u3011\n                if (m == s) { \n                    // \u200b\u5c06\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u51fa\u6808\u200b\n                    clean(s);\n                    return null;\n                }\n                // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u3010\u200b\u5339\u914d\u200b\u6210\u529f\u200b\u3011\u200b\u4e86\u200b\n                // \u200b\u6808\u9876\u200b\u6709\u200b\u8282\u70b9\u200b\u5e76\u4e14\u200b \u200b\u5339\u914d\u200b\u8282\u70b9\u200b\u8fd8\u200b\u672a\u200b\u51fa\u6808\u200b\uff0c\u200b\u9700\u8981\u200b\u534f\u52a9\u200b\u51fa\u6808\u200b\n                if ((h = head) != null &amp;&amp; h.next == s)\n                    casHead(h, s.next);\n                // \u200b\u5f53\u524d\u200b node \u200b\u6a21\u5f0f\u200b\u4e3a\u200b REQUEST \u200b\u7c7b\u578b\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5339\u914d\u200b\u8282\u70b9\u200b\u7684\u200b m.item \u200b\u6570\u636e\u200b\u57df\u200b\n                // \u200b\u5f53\u524d\u200b node \u200b\u6a21\u5f0f\u200b\u4e3a\u200b DATA \u200b\u7c7b\u578b\u200b\uff1a\u200b\u8fd4\u56de\u200b node.item \u200b\u6570\u636e\u200b\u57df\u200b\uff0c\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6570\u636e\u200b e\n                return (E) ((mode == REQUEST) ? m.item : s.item);\n            }\n        // \u3010CASE2\u3011\uff1a\u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u8bf7\u6c42\u200b\u6a21\u5f0f\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5982\u679c\u200b\u6808\u9876\u200b\u4e0d\u662f\u200b FULFILLING \u200b\u8bf4\u660e\u200b\u6ca1\u200b\u88ab\u200b\u5176\u4ed6\u200b\u8282\u70b9\u200b\u5339\u914d\u200b\uff0c\u3010\u200b\u5f53\u524d\u200b\u53ef\u4ee5\u200b\u5339\u914d\u200b\u3011\n        } else if (!isFulfilling(h.mode)) {\n            // \u200b\u5934\u200b\u8282\u70b9\u200b\u662f\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\uff0cmatch \u200b\u6307\u5411\u200b\u81ea\u5df1\u200b\uff0c\u200b\u534f\u52a9\u200b\u51fa\u6808\u200b\n            if (h.isCancelled())\n                casHead(h, h.next);\n            // \u200b\u5165\u6808\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7684\u200b\u8282\u70b9\u200b\n            else if (casHead(h, s=snode(s, e, h, FULFILLING|mode))) {\n                for (;;) { \n                    // m \u200b\u662f\u200b s \u200b\u7684\u200b\u5339\u914d\u200b\u7684\u200b\u8282\u70b9\u200b\n                    SNode m = s.next;\n                    // m \u200b\u8282\u70b9\u200b\u5728\u200b awaitFulfill \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u88ab\u200b\u4e2d\u65ad\u200b\uff0cclean \u200b\u4e86\u200b\u81ea\u5df1\u200b\n                    if (m == null) {\n                        // \u200b\u6e05\u7a7a\u200b\u6808\u200b\n                        casHead(s, null);\n                        s = null;\n                        // \u200b\u8fd4\u56de\u200b\u5230\u200b\u5916\u5c42\u200b\u81ea\u65cb\u200b\u4e2d\u200b\n                        break;\n                    }\n                    // \u200b\u83b7\u53d6\u200b\u5339\u914d\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n                    SNode mn = m.next;\n                    // \u200b\u5c1d\u8bd5\u200b\u5339\u914d\u200b\uff0c\u3010\u200b\u5339\u914d\u200b\u6210\u529f\u200b\u3011\uff0c\u200b\u5219\u200b\u5c06\u200b fulfilling \u200b\u548c\u200b m \u200b\u4e00\u8d77\u200b\u51fa\u6808\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5524\u9192\u200b\u88ab\u200b\u5339\u914d\u200b\u7684\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n                    if (m.tryMatch(s)) {\n                        casHead(s, mn);\n                        return (E) ((mode == REQUEST) ? m.item : s.item);\n                    } else\n                        // \u200b\u5339\u914d\u200b\u5931\u8d25\u200b\uff0c\u200b\u51fa\u6808\u200b m\n                        s.casNext(m, mn);\n                }\n            }\n        // \u3010CASE3\u3011\uff1a\u200b\u6808\u9876\u200b\u6a21\u5f0f\u200b\u4e3a\u200b FULFILLING \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u8868\u793a\u200b\u3010\u200b\u6808\u9876\u200b\u548c\u200b\u6808\u9876\u200b\u4e0b\u9762\u200b\u7684\u200b\u8282\u70b9\u200b\u6b63\u5728\u200b\u53d1\u751f\u200b\u5339\u914d\u200b\u3011\uff0c\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u9700\u8981\u200b\u505a\u200b\u534f\u52a9\u200b\u5de5\u4f5c\u200b\n        } else {\n            // h \u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b fulfilling \u200b\u8282\u70b9\u200b\uff0cm \u200b\u8868\u793a\u200b fulfilling \u200b\u5339\u914d\u200b\u7684\u200b\u8282\u70b9\u200b\n            SNode m = h.next;\n            if (m == null)\n                // \u200b\u6e05\u7a7a\u200b\u6808\u200b\n                casHead(h, null);\n            else {\n                SNode mn = m.next;\n                // m \u200b\u548c\u200b h \u200b\u5339\u914d\u200b\uff0c\u200b\u5524\u9192\u200b m \u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n                if (m.tryMatch(h))\n                    casHead(h, mn);\n                else\n                    h.casNext(m, mn);\n            }\n        }\n    }\n}\n</code></pre> <ul> <li>awaitFulfill()\uff1a\u200b\u963b\u585e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u88ab\u200b\u5339\u914d\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5339\u914d\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u6216\u8005\u200b\u88ab\u200b\u53d6\u6d88\u200b\u7684\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>SNode awaitFulfill(SNode s, boolean timed, long nanos) {\n    // \u200b\u7b49\u5f85\u200b\u7684\u200b\u622a\u6b62\u200b\u65f6\u95f4\u200b\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n    Thread w = Thread.currentThread();\n    // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b for(;;) \u200b\u81ea\u65cb\u200b\u68c0\u67e5\u200b\u7684\u200b\u6b21\u6570\u200b\n    int spins = (shouldSpin(s) ? (timed ? maxTimedSpins : maxUntimedSpins) : 0);\n    // \u200b\u81ea\u65cb\u200b\u68c0\u67e5\u200b\u903b\u8f91\u200b\uff1a\u200b\u662f\u5426\u200b\u5339\u914d\u200b\u3001\u200b\u662f\u5426\u200b\u8d85\u65f6\u200b\u3001\u200b\u662f\u5426\u200b\u88ab\u200b\u4e2d\u65ad\u200b\n    for (;;) {\n        // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6536\u5230\u200b\u4e2d\u65ad\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b node \u200b\u72b6\u6001\u200b\u4e3a\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n        if (w.isInterrupted())\n            s.tryCancel();\n        // \u200b\u83b7\u53d6\u200b\u4e0e\u200b\u5f53\u524d\u200b s \u200b\u5339\u914d\u200b\u7684\u200b\u8282\u70b9\u200b\n        SNode m = s.match;\n        if (m != null)\n            // \u200b\u53ef\u80fd\u200b\u662f\u200b\u6b63\u5e38\u200b\u7684\u200b\u5339\u914d\u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u53d6\u6d88\u200b\u7684\u200b\n            return m;\n        // \u200b\u6267\u884c\u200b\u4e86\u200b\u8d85\u65f6\u200b\u9650\u5236\u200b\u5c31\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8d85\u65f6\u200b\n        if (timed) {\n            nanos = deadline - System.nanoTime();\n            // \u3010\u200b\u8d85\u65f6\u200b\u4e86\u200b\uff0c\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u3011\n            if (nanos &lt;= 0L) {\n                s.tryCancel();\n                continue;\n            }\n        }\n        // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u81ea\u65cb\u200b\u68c0\u67e5\u200b\n        if (spins &gt; 0)\n            // \u200b\u81ea\u65cb\u200b\u4e00\u6b21\u200b \u200b\u9012\u51cf\u200b 1\n            spins = shouldSpin(s) ? (spins - 1) : 0;\n        // \u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u81ea\u65cb\u200b\u6b21\u6570\u200b\u4e86\u200b\n        else if (s.waiter == null)\n            //\u3010\u200b\u628a\u200b\u5f53\u524d\u200b node \u200b\u5bf9\u5e94\u200b\u7684\u200b Thread \u200b\u4fdd\u5b58\u200b\u5230\u200b node.waiter \u200b\u5b57\u6bb5\u200b\u4e2d\u200b\uff0c\u200b\u8981\u200b\u963b\u585e\u200b\u4e86\u200b\u3011\n            s.waiter = w;\n        // \u200b\u6ca1\u6709\u200b\u8d85\u65f6\u200b\u9650\u5236\u200b\u76f4\u63a5\u200b\u963b\u585e\u200b\n        else if (!timed)\n            LockSupport.park(this);\n        // nanos &gt; 1000 \u200b\u7eb3\u79d2\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u624d\u200b\u5141\u8bb8\u200b\u6302\u200b\u8d77\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n        else if (nanos &gt; spinForTimeoutThreshold)\n            LockSupport.parkNanos(this, nanos);\n    }\n}\n</code></pre> Java<pre><code>boolean shouldSpin(SNode s) {\n    // \u200b\u83b7\u53d6\u200b\u6808\u9876\u200b\n    SNode h = head;\n    // \u200b\u6761\u4ef6\u200b\u4e00\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b s \u200b\u5c31\u662f\u200b\u6808\u9876\u200b\uff0c\u200b\u5141\u8bb8\u200b\u81ea\u65cb\u200b\u68c0\u67e5\u200b\n    // \u200b\u6761\u4ef6\u200b\u4e8c\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b s \u200b\u8282\u70b9\u200b\u81ea\u65cb\u200b\u68c0\u67e5\u200b\u671f\u95f4\u200b\uff0c\u200b\u53c8\u200b\u6765\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4e0e\u200b\u5f53\u524d\u200b s \u200b\u8282\u70b9\u200b\u5339\u914d\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u53cc\u53cc\u51fa\u200b\u6808\u540e\u200b\u6761\u4ef6\u200b\u4f1a\u200b\u6210\u7acb\u200b\n    // \u200b\u6761\u4ef6\u200b\u4e09\u200b\u6210\u7acb\u200b\u524d\u63d0\u200b\u5f53\u524d\u200b s \u200b\u4e0d\u662f\u200b\u6808\u9876\u200b\u5143\u7d20\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u524d\u200b\u6808\u9876\u200b\u6b63\u5728\u200b\u5339\u914d\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u72b6\u6001\u200b\u6808\u9876\u200b\u4e0b\u9762\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u90fd\u200b\u5141\u8bb8\u200b\u81ea\u65cb\u200b\u68c0\u67e5\u200b\n    return (h == s || h == null || isFulfilling(h.mode));\n}\n</code></pre> <ul> <li>clear()\uff1a\u200b\u6307\u5b9a\u200b\u8282\u70b9\u200b\u51fa\u6808\u200b</li> </ul> Java<pre><code>void clean(SNode s) {\n    // \u200b\u6e05\u7a7a\u200b\u6570\u636e\u200b\u57df\u200b\u548c\u200b\u5173\u8054\u200b\u7ebf\u7a0b\u200b\n    s.item = null;\n    s.waiter = null;\n\n  // \u200b\u83b7\u53d6\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n    SNode past = s.next;\n    // \u200b\u5224\u65ad\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u662f\u4e0d\u662f\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\uff0c\u200b\u662f\u200b\u5c31\u200b\u66f4\u65b0\u200b past\n    if (past != null &amp;&amp; past.isCancelled())\n        past = past.next;\n\n    SNode p;\n    // \u200b\u4ece\u6808\u200b\u9876\u200b\u5f00\u59cb\u200b\u5411\u4e0b\u200b\u68c0\u67e5\u200b\uff0c\u3010\u200b\u5c06\u200b\u6808\u9876\u200b\u5f00\u59cb\u200b\u5411\u4e0b\u200b\u7684\u200b \u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b \u200b\u7684\u200b\u8282\u70b9\u200b\u5168\u90e8\u200b\u6e05\u7406\u200b\u51fa\u53bb\u200b\u3011\uff0c\u200b\u76f4\u5230\u200b\u78b0\u5230\u200b past \u200b\u6216\u8005\u200b\u4e0d\u662f\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u4e3a\u6b62\u200b\n    while ((p = head) != null &amp;&amp; p != past &amp;&amp; p.isCancelled())\n        // \u200b\u4fee\u6539\u200b\u7684\u200b\u662f\u200b\u5185\u5b58\u5730\u5740\u200b\u5bf9\u5e94\u200b\u7684\u200b\u503c\u200b\uff0cp \u200b\u6307\u5411\u200b\u8be5\u200b\u5185\u5b58\u5730\u5740\u200b\u6240\u4ee5\u200b\u6570\u636e\u200b\u4e00\u76f4\u200b\u5728\u200b\u53d8\u5316\u200b\n        casHead(p, p.next);\n  // \u200b\u8bf4\u660e\u200b\u4e2d\u95f4\u200b\u9047\u5230\u200b\u4e86\u200b\u4e0d\u662f\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u8fed\u4ee3\u200b\u4e0b\u53bb\u200b\n    while (p != null &amp;&amp; p != past) {\n        SNode n = p.next;\n        if (n != null &amp;&amp; n.isCancelled())\n            p.casNext(n, n.next);\n        else\n            p = n;\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_117","title":"\u516c\u5e73\u200b\u5b9e\u73b0","text":"<p>TransferQueue \u200b\u662f\u200b\u516c\u5e73\u200b\u7684\u200b\u540c\u6b65\u200b\u961f\u5217\u200b\uff0c\u200b\u91c7\u7528\u200b FIFO \u200b\u7684\u200b\u961f\u5217\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u8282\u70b9\u200b\u4e0e\u200b\u961f\u5c3e\u200b\u6a21\u5f0f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u9700\u8981\u200b\u4e0e\u200b\u961f\u5934\u200b\u53d1\u751f\u200b\u5339\u914d\u200b</p> <p>TransferQueue \u200b\u7c7b\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u6307\u5411\u200b\u961f\u5217\u200b\u7684\u200b dummy \u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>transient volatile QNode head;\n</code></pre> <ul> <li>\u200b\u6307\u5411\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>transient volatile QNode tail;\n</code></pre> <ul> <li>\u200b\u88ab\u200b\u6e05\u7406\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>transient volatile QNode cleanMe;\n</code></pre> <p>\u200b\u5165\u961f\u200b\u64cd\u4f5c\u200b\u662f\u200b\u4e24\u6b65\u200b\u5b8c\u6210\u200b\u7684\u200b\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b t.next = newNode\uff0c\u200b\u7b2c\u4e8c\u6b65\u200b\u662f\u200b tail = newNode\uff0c\u200b\u6240\u4ee5\u200b\u961f\u5c3e\u200b\u8282\u70b9\u200b\u51fa\u961f\u200b\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u975e\u5e38\u200b\u7279\u6b8a\u200b\u7684\u200b\u60c5\u51b5\u200b</p> <p>TransferQueue \u200b\u5185\u90e8\u200b\u7c7b\u200b\uff1a</p> <ul> <li>QNode\uff1a</li> </ul> Java<pre><code>static final class QNode {\n    // \u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n    volatile QNode next;\n    // \u200b\u6570\u636e\u200b\u57df\u200b\uff0cNode \u200b\u4ee3\u8868\u200b\u7684\u200b\u662f\u200b DATA \u200b\u7c7b\u578b\u200b item \u200b\u8868\u793a\u200b\u6570\u636e\u200b\uff0c\u200b\u5426\u5219\u200b Node \u200b\u4ee3\u8868\u200b\u7684\u200b REQUEST \u200b\u7c7b\u578b\u200b\uff0citem == null\n    volatile Object item;\n    // \u200b\u5047\u8bbe\u200b\u5f53\u524d\u200b node \u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u81ea\u65cb\u200b\u671f\u95f4\u200b\u672a\u200b\u88ab\u200b\u5339\u914d\u200b\u6210\u529f\u200b\uff0c\u200b\u90a3\u4e48\u200b node \u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u6302\u200b\u8d77\u200b\uff0c\n    // \u200b\u6302\u200b\u8d77\u524d\u200b waiter \u200b\u4fdd\u5b58\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5f15\u7528\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u5339\u914d\u200b\u6210\u529f\u200b\u540e\u200b\u88ab\u200b\u5524\u9192\u200b\u3002\n    volatile Thread waiter;\n    // true \u200b\u5f53\u524d\u200b Node \u200b\u662f\u200b\u4e00\u4e2a\u200b DATA \u200b\u7c7b\u578b\u200b\uff0cfalse \u200b\u8868\u793a\u200b\u5f53\u524d\u200b Node \u200b\u662f\u200b\u4e00\u4e2a\u200b REQUEST \u200b\u7c7b\u578b\u200b\n    final boolean isData;\n\n  // \u200b\u6784\u5efa\u200b\u65b9\u6cd5\u200b\n    QNode(Object item, boolean isData) {\n        this.item = item;\n        this.isData = isData;\n    }\n\n    // \u200b\u5c1d\u8bd5\u200b\u53d6\u6d88\u200b\u5f53\u524d\u200b node\uff0c\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u7684\u200b node \u200b\u7684\u200b item \u200b\u57df\u200b\u6307\u5411\u200b\u81ea\u5df1\u200b\n    void tryCancel(Object cmp) {\n        UNSAFE.compareAndSwapObject(this, itemOffset, cmp, this);\n    }\n\n    // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b node \u200b\u662f\u5426\u200b\u4e3a\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n    boolean isCancelled() {\n        return item == this;\n    }\n\n    // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u5426\u200b \u201c\u200b\u4e0d\u200b\u5728\u200b\u201d \u200b\u961f\u5217\u200b\u5185\u200b\uff0c\u200b\u5f53\u200b next \u200b\u6307\u5411\u200b\u81ea\u5df1\u200b\u65f6\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u51fa\u961f\u200b\u3002\n    boolean isOffList() {\n        return next == this;\n    }\n}\n</code></pre> <p>TransferQueue \u200b\u7c7b\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u8bbe\u7f6e\u200b\u5934\u5c3e\u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>void advanceHead(QNode h, QNode nh) {\n    // \u200b\u8bbe\u7f6e\u200b\u5934\u200b\u6307\u9488\u200b\u6307\u5411\u200b\u65b0\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\n    if (h == head &amp;&amp; UNSAFE.compareAndSwapObject(this, headOffset, h, nh))\n        // \u200b\u8001\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\u51fa\u961f\u200b\n        h.next = h;\n}\nvoid advanceTail(QNode t, QNode nt) {\n    if (tail == t)\n        // \u200b\u66f4\u65b0\u200b\u961f\u5c3e\u200b\u8282\u70b9\u200b\u4e3a\u200b\u65b0\u200b\u7684\u200b\u961f\u5c3e\u200b\n        UNSAFE.compareAndSwapObject(this, tailOffset, t, nt);\n}\n</code></pre> <ul> <li>transfer()\uff1a\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>E transfer(E e, boolean timed, long nanos) {\n    // s \u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u5bf9\u5e94\u200b\u7684\u200b node\n    QNode s = null;\n    // \u200b\u662f\u5426\u662f\u200b DATA \u200b\u7c7b\u578b\u200b\u7684\u200b\u8bf7\u6c42\u200b\n    boolean isData = (e != null);\n  // \u200b\u81ea\u65cb\u200b\n    for (;;) {\n        QNode t = tail;\n        QNode h = head;\n        if (t == null || h == null)\n            continue;\n      // head \u200b\u548c\u200b tail \u200b\u540c\u65f6\u200b\u6307\u5411\u200b dummy \u200b\u8282\u70b9\u200b\uff0c\u200b\u8bf4\u660e\u200b\u662f\u200b\u7a7a\u200b\u961f\u5217\u200b\n        // \u200b\u961f\u5c3e\u200b\u8282\u70b9\u200b\u4e0e\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8bf4\u660e\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u5339\u914d\u200b\uff0c\n        if (h == t || t.isData == isData) {\n            // \u200b\u83b7\u53d6\u200b\u961f\u5c3e\u200b t \u200b\u7684\u200b next \u200b\u8282\u70b9\u200b\n            QNode tn = t.next;\n            // \u200b\u591a\u7ebf\u7a0b\u200b\u73af\u5883\u200b\u4e2d\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u53ef\u80fd\u200b\u4fee\u6539\u200b\u5c3e\u200b\u8282\u70b9\u200b\n            if (t != tail)\n                continue;\n            // \u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u5165\u961f\u200b\u4e86\u200b\uff0c\u200b\u66f4\u65b0\u200b tail\n            if (tn != null) {\n                advanceTail(t, tn);\n                continue;\n            }\n            // \u200b\u5141\u8bb8\u200b\u8d85\u65f6\u200b\uff0c\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u5c0f\u4e8e\u200b 0\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u4e0d\u200b\u652f\u6301\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\n            if (timed &amp;&amp; nanos &lt;= 0)\n                return null;\n            // \u200b\u521b\u5efa\u200b node \u200b\u7684\u200b\u903b\u8f91\u200b\n            if (s == null)\n                s = new QNode(e, isData);\n            // \u200b\u5c06\u200b node \u200b\u6dfb\u52a0\u200b\u5230\u961f\u200b\u5c3e\u200b\n            if (!t.casNext(null, s))\n                continue;\n          // \u200b\u66f4\u65b0\u200b\u961f\u5c3e\u200b\u6307\u9488\u200b\n            advanceTail(t, s);\n\n            // \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b \u200b\u7b49\u5f85\u200b\u5339\u914d\u200b....\n            Object x = awaitFulfill(s, e, timed, nanos);\n\n            // \u200b\u8bf4\u660e\u200b\u3010\u200b\u5f53\u524d\u200b node \u200b\u72b6\u6001\u200b\u4e3a\u200b \u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u3011\uff0c\u200b\u9700\u8981\u200b\u505a\u51fa\u200b\u961f\u200b\u903b\u8f91\u200b\n            if (x == s) {\n                clean(t, s);\n                return null;\n            }\n          // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b node \u200b\u4ecd\u7136\u200b\u5728\u200b\u961f\u5217\u200b\u5185\u200b\uff0c\u200b\u5339\u914d\u200b\u6210\u529f\u200b\uff0c\u200b\u9700\u8981\u200b\u505a\u51fa\u200b\u961f\u200b\u903b\u8f91\u200b\n            if (!s.isOffList()) {\n                // t \u200b\u662f\u200b\u5f53\u524d\u200b s \u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\uff0c\u200b\u5224\u65ad\u200b t \u200b\u662f\u4e0d\u662f\u200b\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u662f\u200b\u5c31\u200b\u66f4\u65b0\u200b dummy \u200b\u8282\u70b9\u200b\u4e3a\u200b s \u200b\u8282\u70b9\u200b\n                advanceHead(t, s);\n                // s \u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u51fa\u961f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u628a\u200b\u5b83\u200b\u7684\u200b item \u200b\u57df\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5b83\u200b\u81ea\u5df1\u200b\uff0c\u200b\u8868\u793a\u200b\u5b83\u200b\u662f\u200b\u4e2a\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n                if (x != null)\n                    s.item = s;\n                s.waiter = null;\n            }\n            return (x != null) ? (E)x : e;\n      // \u200b\u961f\u5c3e\u200b\u8282\u70b9\u200b\u4e0e\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u8282\u70b9\u200b\u3010\u200b\u4e92\u8865\u200b\u5339\u914d\u200b\u3011\n        } else {\n            // h.next \u200b\u8282\u70b9\u200b\uff0c\u3010\u200b\u8bf7\u6c42\u200b\u8282\u70b9\u200b\u4e0e\u200b\u961f\u5c3e\u200b\u6a21\u5f0f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u9700\u8981\u200b\u4e0e\u200b\u961f\u5934\u200b\u53d1\u751f\u200b\u5339\u914d\u200b\u3011\uff0cTransferQueue \u200b\u662f\u200b\u4e00\u4e2a\u200b\u3010\u200b\u516c\u5e73\u200b\u6a21\u5f0f\u200b\u3011\n            QNode m = h.next;\n            // \u200b\u5e76\u53d1\u200b\u5bfc\u81f4\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u4e86\u200b\u961f\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u6216\u8005\u200b\u5df2\u7ecf\u200b\u628a\u200b head.next \u200b\u5339\u914d\u200b\u8d70\u200b\u4e86\u200b\n            if (t != tail || m == null || h != head)\n                continue;\n          // \u200b\u83b7\u53d6\u200b\u5339\u914d\u200b\u8282\u70b9\u200b\u7684\u200b\u6570\u636e\u200b\u57df\u200b\u4fdd\u5b58\u200b\u5230\u200b x\n            Object x = m.item;\n            // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5339\u914d\u200b\u6210\u529f\u200b\n            if (isData == (x != null) ||\n                x == m ||\n                !m.casItem(x, e)) {\n                advanceHead(h, m);\n                continue;\n            }\n          // \u3010\u200b\u5339\u914d\u200b\u5b8c\u6210\u200b\u3011\uff0c\u200b\u5c06\u5934\u200b\u8282\u70b9\u200b\u51fa\u961f\u200b\uff0c\u200b\u8ba9\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b\u6210\u4e3a\u200b dummy \u200b\u8282\u70b9\u200b\n            advanceHead(h, m);\n            // \u200b\u5524\u9192\u200b\u8be5\u200b\u5339\u914d\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n            LockSupport.unpark(m.waiter);\n            return (x != null) ? (E)x : e;\n        }\n    }\n}\n</code></pre> <ul> <li>awaitFulfill()\uff1a\u200b\u963b\u585e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u88ab\u200b\u5339\u914d\u200b</li> </ul> Java<pre><code>Object awaitFulfill(QNode s, E e, boolean timed, long nanos) {\n    // \u200b\u8868\u793a\u200b\u7b49\u5f85\u200b\u622a\u6b62\u200b\u65f6\u95f4\u200b\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    Thread w = Thread.currentThread();\n    // \u200b\u81ea\u9009\u200b\u68c0\u67e5\u200b\u7684\u200b\u6b21\u6570\u200b\n    int spins = ((head.next == s) ? (timed ? maxTimedSpins : maxUntimedSpins) : 0);\n    for (;;) {\n        // \u200b\u88ab\u200b\u6253\u65ad\u200b\u5c31\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\n        if (w.isInterrupted())\n            s.tryCancel(e);\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b Node \u200b\u6570\u636e\u200b\u57df\u200b\n        Object x = s.item;\n\n        // \u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u4e3a\u200b DATA \u200b\u6a21\u5f0f\u200b\u65f6\u200b\uff1ae \u200b\u8bf7\u6c42\u200b\u5e26\u6765\u200b\u7684\u200b\u6570\u636e\u200b\n        // s.item \u200b\u4fee\u6539\u200b\u4e3a\u200b this\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b QNode \u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b \u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n        // s.item \u200b\u4fee\u6539\u200b\u4e3a\u200b null \u200b\u8868\u793a\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5339\u914d\u200b\u8282\u70b9\u200b\u4e86\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5339\u914d\u200b\u8282\u70b9\u200b\u62ff\u8d70\u200b\u4e86\u200b item \u200b\u6570\u636e\u200b\n\n        // \u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u4e3a\u200b REQUEST \u200b\u6a21\u5f0f\u200b\u65f6\u200b\uff1ae == null\n        // s.item \u200b\u4fee\u6539\u200b\u4e3a\u200b this\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b QNode \u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b \u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n        // s.item != null \u200b\u4e14\u200b item != this  \u200b\u8868\u793a\u200b\u5f53\u524d\u200b REQUEST \u200b\u7c7b\u578b\u200b\u7684\u200b Node \u200b\u5df2\u7ecf\u200b\u5339\u914d\u200b\u5230\u200b DATA \u200b\u4e86\u200b \n        if (x != e)\n            return x;\n        // \u200b\u8d85\u65f6\u200b\u68c0\u67e5\u200b\n        if (timed) {\n            nanos = deadline - System.nanoTime();\n            if (nanos &lt;= 0L) {\n                s.tryCancel(e);\n                continue;\n            }\n        }\n        // \u200b\u81ea\u65cb\u200b\u6b21\u6570\u200b\u51cf\u4e00\u200b\n        if (spins &gt; 0)\n            --spins;\n        // \u200b\u6ca1\u6709\u200b\u81ea\u65cb\u200b\u6b21\u6570\u200b\u4e86\u200b\uff0c\u200b\u628a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c01\u88c5\u200b\u8fdb\u53bb\u200b waiter\n        else if (s.waiter == null)\n            s.waiter = w;\n        // \u200b\u963b\u585e\u200b\n        else if (!timed)\n            LockSupport.park(this);\n        else if (nanos &gt; spinForTimeoutThreshold)\n            LockSupport.parkNanos(this, nanos);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#pool","title":"\u64cd\u4f5c\u200bPool","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_118","title":"\u521b\u5efa\u200b\u65b9\u5f0f","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#executor","title":"Executor","text":"<p>\u200b\u5b58\u653e\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5bb9\u5668\u200b\uff1a</p> Java<pre><code>private final HashSet&lt;Worker&gt; workers = new HashSet&lt;Worker&gt;();\n</code></pre> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>public ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue&lt;Runnable&gt; workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler)\n</code></pre> <p>\u200b\u53c2\u6570\u200b\u4ecb\u7ecd\u200b\uff1a</p> <ul> <li>corePoolSize\uff1a\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u6700\u5c0f\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b</li> <li>maximumPoolSize\uff1a\u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u5f53\u200b\u961f\u5217\u200b\u4e2d\u200b\u5b58\u653e\u200b\u7684\u200b\u4efb\u52a1\u200b\u8fbe\u5230\u200b\u961f\u5217\u200b\u5bb9\u91cf\u200b\u65f6\u200b\uff0c\u200b\u5f53\u524d\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\u7684\u200b\u6570\u91cf\u200b\u53d8\u4e3a\u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u5e76\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\u6700\u65b0\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e0e\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5dee\u503c\u200b\u53c8\u200b\u53eb\u200b\u6551\u6025\u200b\u7ebf\u7a0b\u200b\u6570\u200b</li> <li>keepAliveTime\uff1a\u200b\u6551\u6025\u200b\u7ebf\u7a0b\u200b\u6700\u5927\u200b\u5b58\u6d3b\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b <code>corePoolSize</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u65f6\u200b\u6ca1\u6709\u200b\u65b0\u200b\u7684\u200b\u4efb\u52a1\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u5916\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u7acb\u5373\u200b\u9500\u6bc1\u200b\uff0c\u200b\u800c\u662f\u200b\u4f1a\u200b\u7b49\u5230\u200b <code>keepAliveTime</code> \u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b\u9500\u6bc1\u200b</li> <li>unit\uff1a<code>keepAliveTime</code> \u200b\u53c2\u6570\u200b\u7684\u200b\u65f6\u95f4\u200b\u5355\u4f4d\u200b</li> <li>workQueue\uff1a\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u5b58\u653e\u200b\u88ab\u200b\u63d0\u4ea4\u200b\u4f46\u200b\u5c1a\u672a\u200b\u88ab\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b</li> <li>threadFactory\uff1a\u200b\u7ebf\u7a0b\u200b\u5de5\u5382\u200b\uff0c\u200b\u521b\u5efa\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\u65f6\u200b\u7528\u5230\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b\u65f6\u8d77\u200b\u540d\u5b57\u200b</li> <li>handler\uff1a\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5230\u8fbe\u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u4ecd\u200b\u6709\u200b\u65b0\u200b\u4efb\u52a1\u200b\u65f6\u4f1a\u200b\u6267\u884c\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b</li> </ul> <p>RejectedExecutionHandler \u200b\u4e0b\u200b\u6709\u200b 4 \u200b\u4e2a\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\uff1a</p> <ul> <li>AbortPolicy\uff1a\u200b\u8ba9\u200b\u8c03\u7528\u8005\u200b\u629b\u51fa\u200b RejectedExecutionException \u200b\u5f02\u5e38\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7b56\u7565\u200b</li> <li>CallerRunsPolicy\uff1a\u200b\u8ba9\u200b\u8c03\u7528\u8005\u200b\u8fd0\u884c\u200b\u7684\u200b\u8c03\u8282\u200b\u673a\u5236\u200b\uff0c\u200b\u5c06\u200b\u67d0\u4e9b\u200b\u4efb\u52a1\u200b\u56de\u9000\u200b\u5230\u200b\u8c03\u7528\u8005\u200b\uff0c\u200b\u4ece\u800c\u200b\u964d\u4f4e\u200b\u65b0\u200b\u4efb\u52a1\u200b\u7684\u200b\u6d41\u91cf\u200b</li> <li>DiscardPolicy\uff1a\u200b\u76f4\u63a5\u200b\u4e22\u5f03\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e0d\u4e88\u200b\u4efb\u4f55\u200b\u5904\u7406\u200b\u4e5f\u200b\u4e0d\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> <li>DiscardOldestPolicy\uff1a\u200b\u653e\u5f03\u200b\u961f\u5217\u200b\u4e2d\u200b\u6700\u65e9\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u628a\u200b\u5f53\u524d\u4efb\u52a1\u200b\u52a0\u5165\u200b\u961f\u5217\u200b\u4e2d\u200b\u5c1d\u8bd5\u200b\u518d\u6b21\u200b\u63d0\u4ea4\u200b\u5f53\u524d\u4efb\u52a1\u200b</li> </ul> <p>\u200b\u8865\u5145\u200b\uff1a\u200b\u5176\u4ed6\u200b\u6846\u67b6\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b</p> <ul> <li>Dubbo\uff1a\u200b\u5728\u200b\u629b\u51fa\u200b RejectedExecutionException \u200b\u5f02\u5e38\u200b\u524d\u200b\u8bb0\u5f55\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u5e76\u200b dump \u200b\u7ebf\u7a0b\u200b\u6808\u200b\u4fe1\u606f\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u5b9a\u4f4d\u95ee\u9898\u200b</li> <li>Netty\uff1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b</li> <li>ActiveMQ\uff1a\u200b\u5e26\u200b\u8d85\u65f6\u200b\u7b49\u5f85\u200b\uff0860s\uff09\u200b\u5c1d\u8bd5\u200b\u653e\u5165\u200b\u961f\u5217\u200b</li> <li>PinPoint\uff1a\u200b\u5b83\u200b\u4f7f\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\u94fe\u200b\uff0c\u200b\u4f1a\u200b\u9010\u4e00\u200b\u5c1d\u8bd5\u200b\u7b56\u7565\u200b\u94fe\u4e2d\u200b\u6bcf\u79cd\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b</li> </ul> <p>\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\uff1a</p> <p></p> <ol> <li>\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u6ca1\u6709\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\uff08\u200b\u61d2\u60f0\u200b\uff09\uff0c\u200b\u7b49\u5f85\u200b\u63d0\u4ea4\u200b\u8fc7\u6765\u200b\u7684\u200b\u4efb\u52a1\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8c03\u7528\u200b execute \u200b\u65b9\u6cd5\u200b\u624d\u200b\u4f1a\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b</li> <li>\u200b\u5f53\u200b\u8c03\u7528\u200b execute() \u200b\u65b9\u6cd5\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u4f1a\u200b\u505a\u200b\u5982\u4e0b\u200b\u5224\u65ad\u200b\uff1a</li> <li>\u200b\u5982\u679c\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5c0f\u4e8e\u200b corePoolSize\uff0c\u200b\u90a3\u4e48\u200b\u9a6c\u4e0a\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b</li> <li>\u200b\u5982\u679c\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b\u6216\u200b\u7b49\u4e8e\u200b corePoolSize\uff0c\u200b\u90a3\u4e48\u200b\u5c06\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\u653e\u5165\u200b\u961f\u5217\u200b</li> <li>\u200b\u5982\u679c\u200b\u8fd9\u65f6\u200b\u961f\u5217\u200b\u6ee1\u200b\u4e86\u200b\u4e14\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u8fd8\u200b\u5c0f\u4e8e\u200b maximumPoolSize\uff0c\u200b\u90a3\u4e48\u200b\u4f1a\u200b\u521b\u5efa\u200b\u975e\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u7acb\u523b\u200b\u8fd0\u884c\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e0d\u200b\u516c\u5e73\u200b\u3002\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u521b\u5efa\u200b\u6bcf\u4e2a\u200b Worker\uff08\u200b\u7ebf\u7a0b\u200b\uff09\u200b\u5bf9\u8c61\u200b\u4f1a\u200b\u7ed1\u5b9a\u200b\u4e00\u4e2a\u200b\u521d\u59cb\u200b\u4efb\u52a1\u200b\uff0c\u200b\u542f\u52a8\u200b Worker \u200b\u65f6\u4f1a\u200b\u4f18\u5148\u200b\u6267\u884c\u200b</li> <li>\u200b\u5982\u679c\u200b\u961f\u5217\u200b\u6ee1\u200b\u4e86\u200b\u4e14\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b\u6216\u200b\u7b49\u4e8e\u200b maximumPoolSize\uff0c\u200b\u90a3\u4e48\u200b\u7ebf\u7a0b\u200b\u6c60\u4f1a\u200b\u542f\u52a8\u200b\u9971\u548c\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\u6765\u200b\u6267\u884c\u200b</li> <li>\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u6765\u200b\u6267\u884c\u200b</li> <li>\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7a7a\u95f2\u200b\u8d85\u8fc7\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u200b\uff08keepAliveTime\uff09\u200b\u65f6\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u4f1a\u200b\u5224\u65ad\u200b\uff1a\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u5927\u4e8e\u200b corePoolSize\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u88ab\u200b\u505c\u6389\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\u540e\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u6536\u7f29\u200b\u5230\u200b corePoolSize \u200b\u5927\u5c0f\u200b</li> </ol> <p>\u200b\u56fe\u7247\u200b\u6765\u6e90\u200b\uff1ahttps://space.bilibili.com/457326371/</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#executors","title":"Executors","text":"<p>Executors \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u56db\u79cd\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u521b\u5efa\u200b\uff1anewCachedThreadPool\u3001newFixedThreadPool\u3001newSingleThreadExecutor\u3001newScheduledThreadPool</p> <ul> <li>newFixedThreadPool\uff1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u62e5\u6709\u200b n \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> </ul> Java<pre><code>public static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS,\n                                  new LinkedBlockingQueue&lt;Runnable&gt;());\n}\n</code></pre> <ul> <li>\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b == \u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff08\u200b\u6ca1\u6709\u200b\u6551\u6025\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u521b\u5efa\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u65e0\u9700\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b</li> <li>LinkedBlockingQueue \u200b\u662f\u200b\u4e00\u4e2a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u5b9e\u73b0\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u5927\u5c0f\u200b\u4e3a\u200b <code>Integer.MAX_VALUE</code>\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u65e0\u200b\u754c\u200b\u961f\u5217\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u653e\u200b\u4efb\u610f\u200b\u6570\u91cf\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5728\u200b\u4efb\u52a1\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u5bfc\u81f4\u200b OOM\uff08\u200b\u5185\u5b58\u200b\u6ea2\u51fa\u200b\uff09</li> <li>\u200b\u9002\u7528\u200b\u4e8e\u200b\u4efb\u52a1\u91cf\u200b\u5df2\u77e5\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u8017\u65f6\u200b\u7684\u200b\u957f\u671f\u200b\u4efb\u52a1\u200b</li> <li>newCachedThreadPool\uff1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u53ef\u200b\u6269\u5bb9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> </ul> Java<pre><code>public static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue&lt;Runnable&gt;());\n}\n</code></pre> <ul> <li>\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u662f\u200b 0\uff0c \u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u662f\u200b 29 \u200b\u4e2a\u200b 1\uff0c\u200b\u5168\u90e8\u90fd\u662f\u200b\u6551\u6025\u200b\u7ebf\u7a0b\u200b\uff0860s \u200b\u540e\u200b\u53ef\u4ee5\u200b\u56de\u6536\u200b\uff09\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u521b\u5efa\u200b\u5927\u91cf\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4ece\u800c\u200b\u5bfc\u81f4\u200b OOM</li> <li>SynchronousQueue \u200b\u4f5c\u4e3a\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5bb9\u91cf\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6bcf\u200b\u4e00\u4e2a\u200b take \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u963b\u585e\u200b\u76f4\u5230\u200b\u6709\u200b\u4e00\u4e2a\u200b put \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u653e\u5165\u200b\u5143\u7d20\u200b\u4e3a\u6b62\u200b\uff08\u200b\u7c7b\u4f3c\u200b\u4e00\u624b\u4ea4\u94b1\u200b\u3001\u200b\u4e00\u624b\u4ea4\u8d27\u200b\uff09</li> <li>\u200b\u9002\u5408\u200b\u4efb\u52a1\u200b\u6570\u200b\u6bd4\u8f83\u200b\u5bc6\u96c6\u200b\uff0c\u200b\u4f46\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u8f83\u200b\u77ed\u200b\u7684\u200b\u60c5\u51b5\u200b</li> <li>newSingleThreadExecutor\uff1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u53ea\u6709\u200b 1 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5355\u7ebf\u7a0b\u200b\u6c60\u200b</li> </ul> Java<pre><code>public static ExecutorService newSingleThreadExecutor() {\n    return new FinalizableDelegatedExecutorService\n        (new ThreadPoolExecutor(1, 1,0L, TimeUnit.MILLISECONDS,\n                                new LinkedBlockingQueue&lt;Runnable&gt;()));\n}\n</code></pre> <ul> <li>\u200b\u4fdd\u8bc1\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u6309\u7167\u200b\u6307\u5b9a\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u56fa\u5b9a\u200b\u4e3a\u200b 1\uff0c\u200b\u4efb\u52a1\u200b\u6570\u200b\u591a\u4e8e\u200b 1 \u200b\u65f6\u4f1a\u200b\u653e\u5165\u200b\u65e0\u200b\u754c\u200b\u961f\u5217\u200b\u6392\u961f\u200b\uff0c\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u8fd9\u200b\u552f\u4e00\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u91ca\u653e\u200b</li> </ul> <p>\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5355\u7ebf\u7a0b\u200b\u4e32\u884c\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5931\u8d25\u200b\u800c\u200b\u7ec8\u6b62\u200b\u90a3\u4e48\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u8865\u6551\u63aa\u65bd\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u4f1a\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6c60\u200b\u7684\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b</li> <li>Executors.newSingleThreadExecutor() \u200b\u7ebf\u7a0b\u200b\u4e2a\u6570\u200b\u59cb\u7ec8\u200b\u4e3a\u200b 1\uff0c\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u3002FinalizableDelegatedExecutorService \u200b\u5e94\u7528\u200b\u7684\u200b\u662f\u200b\u88c5\u9970\u200b\u5668\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u53ea\u200b\u5bf9\u5916\u200b\u66b4\u9732\u200b\u4e86\u200b ExecutorService \u200b\u63a5\u53e3\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u80fd\u200b\u8c03\u7528\u200b ThreadPoolExecutor \u200b\u4e2d\u200b\u7279\u6709\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> </ul> <p>\u200b\u539f\u56e0\u200b\uff1a\u200b\u7236\u7c7b\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u5b50\u7c7b\u200b\u4e2d\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u9700\u8981\u200b\u53cd\u5c04\u200b\u6216\u8005\u200b\u521b\u5efa\u5bf9\u8c61\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8c03\u7528\u200b\u5b50\u7c7b\u200b\u9759\u6001\u65b9\u6cd5\u200b</p> <ul> <li>Executors.newFixedThreadPool(1) \u200b\u521d\u59cb\u200b\u65f6\u4e3a\u200b 1\uff0c\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u3002\u200b\u5bf9\u5916\u200b\u66b4\u9732\u200b\u7684\u200b\u662f\u200b ThreadPoolExecutor \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f3a\u8f6c\u200b\u540e\u200b\u8c03\u7528\u200b setCorePoolSize \u200b\u7b49\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_119","title":"\u5f00\u53d1\u200b\u8981\u6c42","text":"<p>\u200b\u963f\u91cc\u5df4\u5df4\u200b Java \u200b\u5f00\u53d1\u200b\u624b\u518c\u200b\u8981\u6c42\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u8d44\u6e90\u200b\u5fc5\u987b\u200b\u901a\u8fc7\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u63d0\u4f9b\u200b\uff0c\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5728\u200b\u5e94\u7528\u200b\u4e2d\u200b\u81ea\u884c\u200b\u663e\u5f0f\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u51cf\u5c11\u200b\u5728\u200b\u521b\u5efa\u200b\u548c\u200b\u9500\u6bc1\u200b\u7ebf\u7a0b\u200b\u4e0a\u200b\u6240\u200b\u6d88\u8017\u200b\u7684\u200b\u65f6\u95f4\u200b\u4ee5\u53ca\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u89e3\u51b3\u200b\u8d44\u6e90\u200b\u4e0d\u8db3\u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u6709\u200b\u53ef\u80fd\u200b\u9020\u6210\u200b\u7cfb\u7edf\u200b\u521b\u5efa\u200b\u5927\u91cf\u200b\u540c\u7c7b\u200b\u7ebf\u7a0b\u200b\u800c\u200b\u5bfc\u81f4\u200b\u6d88\u8017\u200b\u5b8c\u200b\u5185\u5b58\u200b\u6216\u8005\u200b\u8fc7\u5ea6\u200b\u5207\u6362\u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4f7f\u7528\u200b Executors \u200b\u53bb\u200b\u521b\u5efa\u200b\uff0c\u200b\u800c\u662f\u200b\u901a\u8fc7\u200b ThreadPoolExecutor \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\u66f4\u52a0\u200b\u660e\u786e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\u89c4\u5219\u200b\uff0c\u200b\u89c4\u907f\u200b\u8d44\u6e90\u200b\u8017\u5c3d\u200b\u7684\u200b\u98ce\u9669\u200b</li> </ul> <p>Executors \u200b\u8fd4\u56de\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5bf9\u8c61\u200b\u5f0a\u7aef\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>FixedThreadPool \u200b\u548c\u200b SingleThreadPool\uff1a\u200b\u8bf7\u6c42\u200b\u961f\u5217\u200b\u957f\u5ea6\u200b\u4e3a\u200b Integer.MAX_VALUE\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5806\u79ef\u200b\u5927\u91cf\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4ece\u800c\u200b\u5bfc\u81f4\u200b OOM</li> <li>CacheThreadPool \u200b\u548c\u200b ScheduledThreadPool\uff1a\u200b\u5141\u8bb8\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u4e3a\u200b Integer.MAX_VALUE\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u521b\u5efa\u200b\u5927\u91cf\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5bfc\u81f4\u200b OOM</li> </ul> <p>\u200b\u521b\u5efa\u200b\u591a\u200b\u5927\u5bb9\u91cf\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5408\u9002\u200b\uff1f</p> <ul> <li>\u200b\u4e00\u822c\u6765\u8bf4\u200b\u6c60\u4e2d\u200b\u603b\u7ebf\u200b\u7a0b\u6570\u200b\u662f\u200b\u6838\u5fc3\u200b\u6c60\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u4e24\u500d\u200b\uff0c\u200b\u786e\u4fdd\u200b\u5f53\u200b\u6838\u5fc3\u200b\u6c60\u6709\u200b\u7ebf\u7a0b\u200b\u505c\u6b62\u200b\u65f6\u200b\uff0c\u200b\u6838\u5fc3\u200b\u6c60\u5916\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b\u6838\u5fc3\u200b\u6c60\u200b</li> <li>\u200b\u8fc7\u5c0f\u4f1a\u200b\u5bfc\u81f4\u200b\u7a0b\u5e8f\u200b\u4e0d\u80fd\u200b\u5145\u5206\u200b\u5730\u200b\u5229\u7528\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\u3001\u200b\u5bb9\u6613\u200b\u5bfc\u81f4\u200b\u9965\u997f\u200b</li> <li>\u200b\u8fc7\u200b\u5927\u4f1a\u200b\u5bfc\u81f4\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u5360\u7528\u200b\u66f4\u200b\u591a\u200b\u5185\u5b58\u200b</li> </ul> <p>\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff1a\u200b\u5f53\u524d\u4efb\u52a1\u200b\u5728\u200b\u6267\u884c\u200b\u5b8c\u200b CPU \u200b\u65f6\u95f4\u200b\u7247\u200b\u5207\u6362\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u4e4b\u524d\u200b\u4f1a\u5148\u200b\u4fdd\u5b58\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u4e0b\u6b21\u200b\u518d\u200b\u5207\u6362\u200b\u56de\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u518d\u200b\u52a0\u8f7d\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4efb\u52a1\u200b\u4ece\u200b\u4fdd\u5b58\u200b\u5230\u200b\u518d\u200b\u52a0\u8f7d\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5c31\u662f\u200b\u4e00\u6b21\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b</p> <p>\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u5e38\u7528\u200b\u516c\u5f0f\u200b\uff1a</p> <ul> <li>CPU \u200b\u5bc6\u96c6\u578b\u200b\u4efb\u52a1\u200b (N+1)\uff1a \u200b\u8fd9\u79cd\u200b\u4efb\u52a1\u200b\u6d88\u8017\u200b\u7684\u200b\u662f\u200b CPU \u200b\u8d44\u6e90\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b N (CPU \u200b\u6838\u5fc3\u200b\u6570\u200b) + 1\uff0c\u200b\u6bd4\u200b CPU \u200b\u6838\u5fc3\u200b\u6570\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u7ebf\u7a0b\u200b\u53d1\u751f\u200b\u7f3a\u9875\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u6216\u8005\u200b\u5176\u5b83\u200b\u539f\u56e0\u200b\u5bfc\u81f4\u200b\u7684\u200b\u4efb\u52a1\u200b\u6682\u505c\u200b\u800c\u200b\u5e26\u6765\u200b\u7684\u200b\u5f71\u54cd\u200b\u3002\u200b\u4e00\u65e6\u200b\u4efb\u52a1\u200b\u6682\u505c\u200b\uff0cCPU \u200b\u67d0\u4e2a\u200b\u6838\u5fc3\u200b\u5c31\u200b\u4f1a\u200b\u5904\u4e8e\u200b\u7a7a\u95f2\u200b\u72b6\u6001\u200b\uff0c\u200b\u800c\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5145\u5206\u5229\u7528\u200b CPU \u200b\u7684\u200b\u7a7a\u95f2\u200b\u65f6\u95f4\u200b</li> </ul> <p>CPU \u200b\u5bc6\u96c6\u578b\u200b\u7b80\u5355\u200b\u7406\u89e3\u200b\u5c31\u662f\u200b\u5229\u7528\u200b CPU \u200b\u8ba1\u7b97\u80fd\u529b\u200b\u7684\u200b\u4efb\u52a1\u200b\u6bd4\u5982\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u5bf9\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b</p> <ul> <li>I/O \u200b\u5bc6\u96c6\u578b\u200b\u4efb\u52a1\u200b\uff1a \u200b\u8fd9\u79cd\u200b\u7cfb\u7edf\u200b CPU \u200b\u5904\u4e8e\u200b\u963b\u585e\u72b6\u6001\u200b\uff0c\u200b\u7528\u200b\u5927\u90e8\u5206\u200b\u7684\u200b\u65f6\u95f4\u200b\u6765\u200b\u5904\u7406\u200b I/O \u200b\u4ea4\u4e92\u200b\uff0c\u200b\u800c\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u5904\u7406\u200b I/O \u200b\u7684\u200b\u65f6\u95f4\u6bb5\u200b\u5185\u200b\u4e0d\u4f1a\u200b\u5360\u7528\u200b CPU \u200b\u6765\u200b\u5904\u7406\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5c06\u200b CPU \u200b\u4ea4\u51fa\u200b\u7ed9\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b I/O \u200b\u5bc6\u96c6\u578b\u200b\u4efb\u52a1\u200b\u7684\u200b\u5e94\u7528\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u591a\u200b\u914d\u7f6e\u200b\u4e00\u4e9b\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5177\u4f53\u200b\u7684\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u662f\u200b 2N \u200b\u6216\u200b CPU \u200b\u6838\u6570\u200b/ (1-\u200b\u963b\u585e\u200b\u7cfb\u6570\u200b)\uff0c\u200b\u963b\u585e\u200b\u7cfb\u6570\u200b\u5728\u200b 0.8~0.9 \u200b\u4e4b\u95f4\u200b</li> </ul> <p>IO \u200b\u5bc6\u96c6\u578b\u200b\u5c31\u662f\u200b\u6d89\u53ca\u200b\u5230\u200b\u7f51\u7edc\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6587\u4ef6\u200b\u8bfb\u53d6\u200b\u6b64\u7c7b\u200b\u4efb\u52a1\u200b \uff0c\u200b\u7279\u70b9\u200b\u662f\u200b CPU \u200b\u8ba1\u7b97\u200b\u8017\u8d39\u200b\u65f6\u95f4\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u7b49\u5f85\u200b IO \u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u95f4\u200b\u6765\u8bf4\u200b\u5f88\u5c11\u200b\uff0c\u200b\u5927\u90e8\u5206\u200b\u65f6\u95f4\u200b\u90fd\u200b\u82b1\u200b\u5728\u200b\u4e86\u200b\u7b49\u5f85\u200b IO \u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u4e0a\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_120","title":"\u63d0\u4ea4\u200b\u65b9\u6cd5","text":"<p>ExecutorService \u200b\u7c7b\u200b API\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b void execute(Runnable command) \u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff08Executor \u200b\u7c7b\u200b API\uff09 Future&lt;?&gt; submit(Runnable task) \u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b task() Future submit(Callable task) \u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b task\uff0c\u200b\u7528\u200b\u8fd4\u56de\u503c\u200b Future \u200b\u83b7\u5f97\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b List&gt; invokeAll(Collection&lt;? extends Callable&gt; tasks) \u200b\u63d0\u4ea4\u200b tasks \u200b\u4e2d\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b List&gt; invokeAll(Collection&lt;? extends Callable&gt; tasks, long timeout, TimeUnit unit) \u200b\u63d0\u4ea4\u200b tasks \u200b\u4e2d\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u9488\u5bf9\u200b\u6240\u6709\u200btask\uff0c\u200b\u8d85\u65f6\u200b\u4f1a\u200b\u53d6\u6d88\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u5b8c\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5e76\u200b\u629b\u51fa\u200b\u8d85\u65f6\u200b\u5f02\u5e38\u200b T invokeAny(Collection&lt;? extends Callable&gt; tasks) \u200b\u63d0\u4ea4\u200b tasks \u200b\u4e2d\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\uff0c\u200b\u54ea\u4e2a\u200b\u4efb\u52a1\u200b\u5148\u200b\u6210\u529f\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u8fd4\u56de\u200b\u6b64\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\uff0c\u200b\u5176\u5b83\u200b\u4efb\u52a1\u200b\u53d6\u6d88\u200b <p>execute \u200b\u548c\u200b submit \u200b\u90fd\u200b\u5c5e\u4e8e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>execute \u200b\u53ea\u80fd\u200b\u6267\u884c\u200b Runnable \u200b\u7c7b\u578b\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6ca1\u6709\u200b\u8fd4\u56de\u503c\u200b\uff1b submit \u200b\u65e2\u200b\u80fd\u200b\u63d0\u4ea4\u200b Runnable \u200b\u7c7b\u578b\u200b\u4efb\u52a1\u200b\u4e5f\u200b\u80fd\u200b\u63d0\u4ea4\u200b Callable \u200b\u7c7b\u578b\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5e95\u5c42\u200b\u662f\u200b\u5c01\u88c5\u200b\u6210\u200b FutureTask\uff0c\u200b\u7136\u540e\u200b\u8c03\u7528\u200b execute \u200b\u6267\u884c\u200b</li> <li>execute \u200b\u4f1a\u200b\u76f4\u63a5\u200b\u629b\u51fa\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u200b\u7684\u200b\u5f02\u5e38\u200b\uff0csubmit \u200b\u4f1a\u200b\u541e\u6389\u200b\u5f02\u5e38\u200b\uff0c\u200b\u53ef\u200b\u901a\u8fc7\u200b Future \u200b\u7684\u200b get \u200b\u65b9\u6cd5\u200b\u5c06\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u200b\u7684\u200b\u5f02\u5e38\u200b\u91cd\u65b0\u200b\u629b\u51fa\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_121","title":"\u5173\u95ed\u200b\u65b9\u6cd5","text":"<p>ExecutorService \u200b\u7c7b\u200b API\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b void shutdown() \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u53d8\u4e3a\u200b SHUTDOWN\uff0c\u200b\u7b49\u5f85\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u5173\u95ed\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u63a5\u6536\u200b\u65b0\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f46\u200b\u5df2\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u4f1a\u200b\u6267\u884c\u200b\u5b8c\u200b\uff0c\u200b\u800c\u4e14\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u7ebf\u7a0b\u200b\uff08\u200b\u4e0d\u200b\u7ed1\u5b9a\u200b\u4efb\u52a1\u200b\uff09 List shutdownNow() \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u53d8\u4e3a\u200b STOP\uff0c\u200b\u7528\u200b interrupt \u200b\u4e2d\u65ad\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5173\u95ed\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u63a5\u6536\u200b\u65b0\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\u8fd4\u56de\u200b boolean isShutdown() \u200b\u4e0d\u200b\u5728\u200b RUNNING \u200b\u72b6\u6001\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u6b64\u200b\u6267\u884c\u8005\u200b\u5df2\u200b\u88ab\u200b\u5173\u95ed\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b true boolean isTerminated() \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u662f\u5426\u662f\u200b TERMINATED\uff0c\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u5728\u200b\u5173\u95ed\u200b\u540e\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd4\u56de\u200b true boolean awaitTermination(long timeout, TimeUnit unit) \u200b\u8c03\u7528\u200b shutdown \u200b\u540e\u200b\uff0c\u200b\u7531\u4e8e\u200b\u8c03\u7528\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u7ed3\u675f\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u60f3\u200b\u5728\u7ebf\u200b\u7a0b\u6c60\u200b TERMINATED \u200b\u540e\u200b\u505a\u4e9b\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u7b49\u5f85","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_122","title":"\u5904\u7406\u200b\u5f02\u5e38","text":"<p>execute \u200b\u4f1a\u200b\u76f4\u63a5\u200b\u629b\u51fa\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u200b\u7684\u200b\u5f02\u5e38\u200b\uff0csubmit \u200b\u4f1a\u200b\u541e\u6389\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6709\u200b\u4e24\u79cd\u200b\u5904\u7406\u200b\u65b9\u6cd5\u200b</p> <p>\u200b\u65b9\u6cd5\u200b 1\uff1a\u200b\u4e3b\u52a8\u200b\u6349\u200b\u5f02\u5e38\u200b</p> Java<pre><code>ExecutorService executorService = Executors.newFixedThreadPool(1);\npool.submit(() -&gt; {\n    try {\n        System.out.println(\"task1\");\n        int i = 1 / 0;\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n});\n</code></pre> <p>\u200b\u65b9\u6cd5\u200b 2\uff1a\u200b\u4f7f\u7528\u200b Future \u200b\u5bf9\u8c61\u200b</p> Java<pre><code>ExecutorService executorService = Executors.newFixedThreadPool(1);\nFuture&lt;?&gt; future = pool.submit(() -&gt; {\n    System.out.println(\"task1\");\n    int i = 1 / 0;\n    return true;\n});\nSystem.out.println(future.get());\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_123","title":"\u5de5\u4f5c\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_124","title":"\u72b6\u6001\u200b\u4fe1\u606f","text":"<p>ThreadPoolExecutor \u200b\u4f7f\u7528\u200b int \u200b\u7684\u200b\u9ad8\u200b 3 \u200b\u4f4d\u6765\u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\uff0c\u200b\u4f4e\u200b 29 \u200b\u4f4d\u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u5b58\u50a8\u200b\u5728\u200b\u4e00\u4e2a\u200b\u539f\u5b50\u200b\u53d8\u91cf\u200b ctl \u200b\u4e2d\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u5c06\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e0e\u200b\u7ebf\u7a0b\u200b\u4e2a\u6570\u200b\u5408\u4e8c\u4e3a\u4e00\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4e00\u6b21\u200b CAS \u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u8fdb\u884c\u200b\u8d4b\u503c\u200b</p> <ul> <li>\u200b\u72b6\u6001\u200b\u8868\u793a\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u9ad8\u200b3\u200b\u4f4d\u200b\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u9664\u53bb\u200b\u9ad8\u200b3\u200b\u4f4d\u200b\u4e4b\u540e\u200b\u7684\u200b\u4f4e\u4f4d\u200b\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u6240\u200b\u62e5\u6709\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\n// \u200b\u8868\u793a\u200b\u5728\u200b ctl \u200b\u4e2d\u200b\uff0c\u200b\u4f4e\u200b COUNT_BITS \u200b\u4f4d\u200b\uff0c\u200b\u662f\u200b\u7528\u4e8e\u200b\u5b58\u653e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u7684\u200b\u4f4d\u200b\nprivate static final int COUNT_BITS = Integer.SIZE - 3;\n// \u200b\u4f4e\u200b COUNT_BITS \u200b\u4f4d\u6240\u80fd\u200b\u8868\u8fbe\u200b\u7684\u200b\u6700\u5927\u200b\u6570\u503c\u200b\uff0c000 11111111111111111111 =&gt; 5\u200b\u4ebf\u591a\u200b\nprivate static final int CAPACITY   = (1 &lt;&lt; COUNT_BITS) - 1;\n</code></pre> <p></p> <ul> <li>\u200b\u56db\u79cd\u200b\u72b6\u6001\u200b\uff1a</li> </ul> Java<pre><code>// 111 000000000000000000\uff0c\u200b\u8f6c\u6362\u6210\u200b\u6574\u6570\u200b\u540e\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u3010\u200b\u8d1f\u6570\u200b\u3011\nprivate static final int RUNNING    = -1 &lt;&lt; COUNT_BITS;\n// 000 000000000000000000\nprivate static final int SHUTDOWN   =  0 &lt;&lt; COUNT_BITS;\n// 001 000000000000000000\nprivate static final int STOP       =  1 &lt;&lt; COUNT_BITS;\n// 010 000000000000000000\nprivate static final int TIDYING    =  2 &lt;&lt; COUNT_BITS;\n// 011 000000000000000000\nprivate static final int TERMINATED =  3 &lt;&lt; COUNT_BITS;\n</code></pre> \u200b\u72b6\u6001\u200b \u200b\u9ad8\u200b3\u200b\u4f4d\u200b \u200b\u63a5\u6536\u200b\u65b0\u200b\u4efb\u52a1\u200b \u200b\u5904\u7406\u200b\u963b\u585e\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b \u200b\u8bf4\u660e\u200b RUNNING 111 Y Y SHUTDOWN 000 N Y \u200b\u4e0d\u200b\u63a5\u6536\u200b\u65b0\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f46\u200b\u5904\u7406\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5269\u4f59\u200b\u4efb\u52a1\u200b STOP 001 N N \u200b\u4e2d\u65ad\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5e76\u200b\u629b\u5f03\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4efb\u52a1\u200b TIDYING 010 - - \u200b\u4efb\u52a1\u200b\u5168\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u6d3b\u52a8\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b 0 \u200b\u5373\u5c06\u200b\u8fdb\u5165\u200b\u7ec8\u7ed3\u200b TERMINATED 011 - - \u200b\u7ec8\u6b62\u200b\u72b6\u6001\u200b <ul> <li>\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\uff1a</li> </ul> Java<pre><code>// ~CAPACITY = ~000 11111111111111111111 = 111 000000000000000000000\uff08\u200b\u53d6\u53cd\u200b\uff09\n// c == ctl = 111 000000000000000000111\n// 111 000000000000000000111\n// 111 000000000000000000000\n// 111 000000000000000000000  \u200b\u83b7\u53d6\u200b\u5230\u200b\u4e86\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\nprivate static int runStateOf(int c)     { return c &amp; ~CAPACITY; }\n</code></pre> <ul> <li>\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\uff1a</li> </ul> Java<pre><code>//        c = 111 000000000000000000111\n// CAPACITY = 000 111111111111111111111\n//            000 000000000000000000111 =&gt; 7\nprivate static int workerCountOf(int c)  { return c &amp; CAPACITY; }\n</code></pre> <ul> <li>\u200b\u91cd\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b ctl\uff1a</li> </ul> Java<pre><code>// rs \u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\uff0cwc \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b worker\uff08\u200b\u7ebf\u7a0b\u200b\uff09\u200b\u6570\u91cf\u200b\uff0c\u200b\u76f8\u4e0e\u200b\u4ee5\u540e\u200b\u5c31\u662f\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u72b6\u6001\u200b\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }\n</code></pre> <ul> <li>\u200b\u6bd4\u8f83\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b ctl \u200b\u6240\u200b\u8868\u793a\u200b\u7684\u200b\u72b6\u6001\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u6bd4\u8f83\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b ctl \u200b\u6240\u200b\u8868\u793a\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u662f\u5426\u200b\u5c0f\u4e8e\u200b\u67d0\u4e2a\u200b\u72b6\u6001\u200b s\n// \u200b\u72b6\u6001\u200b\u5bf9\u6bd4\u200b\uff1aRUNNING &lt; SHUTDOWN &lt; STOP &lt; TIDYING &lt; TERMINATED\nprivate static boolean runStateLessThan(int c, int s) { return c &lt; s; }\n// \u200b\u6bd4\u8f83\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b ctl \u200b\u6240\u200b\u8868\u793a\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u662f\u5426\u200b\u5927\u4e8e\u200b\u7b49\u4e8e\u200b\u67d0\u4e2a\u200b\u72b6\u6001\u200bs\nprivate static boolean runStateAtLeast(int c, int s) { return c &gt;= s; }\n// \u200b\u5c0f\u4e8e\u200b SHUTDOWN \u200b\u7684\u200b\u4e00\u5b9a\u200b\u662f\u200b RUNNING\uff0cSHUTDOWN == 0\nprivate static boolean isRunning(int c) { return c &lt; SHUTDOWN; }\n</code></pre> <ul> <li>\u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b ctl\uff1a</li> </ul> Java<pre><code>// \u200b\u4f7f\u7528\u200b CAS \u200b\u65b9\u5f0f\u200b \u200b\u8ba9\u200b ctl \u200b\u503c\u200b +1 \uff0c\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b true, \u200b\u5931\u8d25\u200b\u8fd4\u56de\u200b false\nprivate boolean compareAndIncrementWorkerCount(int expect) {\n    return ctl.compareAndSet(expect, expect + 1);\n}\n// \u200b\u4f7f\u7528\u200b CAS \u200b\u65b9\u5f0f\u200b \u200b\u8ba9\u200b ctl \u200b\u503c\u200b -1 \uff0c\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b true, \u200b\u5931\u8d25\u200b\u8fd4\u56de\u200b false\nprivate boolean compareAndDecrementWorkerCount(int expect) {\n    return ctl.compareAndSet(expect, expect - 1);\n}\n// \u200b\u5c06\u200b ctl \u200b\u503c\u51cf\u200b\u4e00\u200b\uff0cdo while \u200b\u5faa\u73af\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u91cd\u8bd5\u200b\uff0c\u200b\u76f4\u5230\u200b\u6210\u529f\u200b\u4e3a\u6b62\u200b\nprivate void decrementWorkerCount() {\n    do {} while (!compareAndDecrementWorkerCount(ctl.get()));\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_125","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"<p>\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u5b58\u653e\u200b Worker \u200b\u7684\u200b\u5bb9\u5668\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6ca1\u6709\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5f80\u6c60\u200b\u4e2d\u52a0\u200b\u7ebf\u7a0b\u200b\u5373\u53ef\u200b</li> </ul> Java<pre><code>private final HashSet&lt;Worker&gt; workers = new HashSet&lt;Worker&gt;();\n</code></pre> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u5168\u5c40\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u589e\u52a0\u200b\u51cf\u5c11\u200b worker \u200b\u6216\u8005\u200b\u65f6\u200b\u4fee\u6539\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u9700\u8981\u200b\u6301\u6709\u200b mainLock\nprivate final ReentrantLock mainLock = new ReentrantLock();\n</code></pre> <ul> <li>\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u7684\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u5f53\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b awaitTermination() \u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u7b49\u5f85\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200b Termination \u200b\u4e3a\u6b62\u200b\nprivate final Condition termination = mainLock.newCondition()\n</code></pre> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u76f8\u5173\u200b\u53c2\u6570\u200b\uff1a</li> </ul> Java<pre><code>private volatile int corePoolSize;                // \u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\nprivate volatile int maximumPoolSize;         // \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\nprivate volatile long keepAliveTime;          // \u200b\u7a7a\u95f2\u200b\u7ebf\u7a0b\u200b\u5b58\u6d3b\u200b\u65f6\u95f4\u200b\nprivate volatile ThreadFactory threadFactory; // \u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u65f6\u200b\u4f7f\u7528\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5de5\u5382\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b DefaultThreadFactory\nprivate final BlockingQueue&lt;Runnable&gt; workQueue;// \u3010\u200b\u8d85\u8fc7\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u5c31\u200b\u653e\u5165\u200b \u200b\u963b\u585e\u200b\u961f\u5217\u200b\u3011\n</code></pre> Java<pre><code>private volatile RejectedExecutionHandler handler;    // \u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\uff0cjuc\u200b\u5305\u200b\u63d0\u4f9b\u200b\u4e86\u200b4\u200b\u4e2d\u200b\u65b9\u5f0f\u200b\nprivate static final RejectedExecutionHandler defaultHandler = new AbortPolicy();// \u200b\u9ed8\u8ba4\u200b\u7b56\u7565\u200b\n</code></pre> <ul> <li>\u200b\u8bb0\u5f55\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u76f8\u5173\u200b\u5c5e\u6027\u200b\u7684\u200b\u6570\u503c\u200b\uff1a</li> </ul> Java<pre><code>private int largestPoolSize;      // \u200b\u8bb0\u5f55\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u751f\u547d\u5468\u671f\u200b\u5185\u7ebf\u200b\u7a0b\u6570\u200b\u6700\u5927\u503c\u200b\nprivate long completedTaskCount;  // \u200b\u8bb0\u5f55\u200b\u7ebf\u7a0b\u200b\u6c60\u6240\u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\u603b\u6570\u200b\uff0c\u200b\u5f53\u200b\u67d0\u4e2a\u200b worker \u200b\u9000\u51fa\u200b\u65f6\u200b\u5c06\u200b\u5b8c\u6210\u200b\u7684\u200b\u4efb\u52a1\u200b\u7d2f\u52a0\u200b\u5230\u200b\u8be5\u200b\u5c5e\u6027\u200b\n</code></pre> <ul> <li>\u200b\u63a7\u5236\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5185\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u56de\u6536\u200b\uff1a</li> </ul> Java<pre><code>// false\uff08\u200b\u9ed8\u8ba4\u200b\uff09\u200b\u4ee3\u8868\u200b\u4e0d\u200b\u53ef\u4ee5\u200b\uff0c\u200b\u4e3a\u200b true \u200b\u65f6\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u7a7a\u95f2\u200b\u8d85\u8fc7\u200b keepAliveTime \u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\n// allowCoreThreadTimeOut(boolean value) \u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u8be5\u503c\u200b\nprivate volatile boolean allowCoreThreadTimeOut;\n</code></pre> <p>\u200b\u5185\u90e8\u200b\u7c7b\u200b\uff1a</p> <ul> <li>Worker \u200b\u7c7b\u200b\uff1a\u200b\u6bcf\u4e2a\u200b Worker \u200b\u5bf9\u8c61\u200b\u4f1a\u200b\u7ed1\u5b9a\u200b\u4e00\u4e2a\u200b\u521d\u59cb\u200b\u4efb\u52a1\u200b\uff0c\u200b\u542f\u52a8\u200b Worker \u200b\u65f6\u200b\u4f18\u5148\u200b\u6267\u884c\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u9020\u6210\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e0d\u200b\u516c\u5e73\u200b\u7684\u200b\u539f\u56e0\u200b\u3002Worker \u200b\u7ee7\u627f\u200b\u81ea\u200b AQS\uff0c\u200b\u672c\u8eab\u200b\u5177\u6709\u200b\u9501\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u91c7\u7528\u200b\u72ec\u5360\u200b\u9501\u200b\u6a21\u5f0f\u200b\uff0cstate = 0 \u200b\u8868\u793a\u200b\u672a\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c&gt; 0 \u200b\u8868\u793a\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c&lt; 0 \u200b\u8868\u793a\u200b\u521d\u59cb\u72b6\u6001\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u62a2\u9501\u200b</li> </ul> Java<pre><code>private final class Worker extends AbstractQueuedSynchronizer implements Runnable {\n  final Thread thread;            // worker \u200b\u5185\u90e8\u200b\u5c01\u88c5\u200b\u7684\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\n    Runnable firstTask;               // worker \u200b\u7b2c\u4e00\u4e2a\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u666e\u901a\u200b\u7684\u200b Runnable \u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u6216\u8005\u200b\u662f\u200b FutureTask\n    volatile long completedTasks; // \u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b worker \u200b\u6240\u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\u6570\u91cf\u200b\n\n    // \u200b\u6784\u9020\u65b9\u6cd5\u200b\n    Worker(Runnable firstTask) {\n        // \u200b\u8bbe\u7f6e\u200bAQS\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u521d\u59cb\u5316\u200b\u4e2d\u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u62a2\u5360\u200b\u9501\u200b\n          setState(-1);\n        // firstTask\u200b\u4e0d\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u5f53\u200bworker\u200b\u542f\u52a8\u200b\u540e\u200b\uff0c\u200b\u5185\u90e8\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4f18\u5148\u200b\u6267\u884c\u200bfirstTask\uff0c\u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u4f1a\u200b\u5230\u200bqueue\u200b\u4e2d\u200b\u53bb\u200b\u83b7\u53d6\u200b\u4e0b\u4e2a\u200b\u4efb\u52a1\u200b\n        this.firstTask = firstTask;\n        // \u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u5de5\u5382\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u3010\u200b\u5c06\u200b\u5f53\u524d\u200bworker\u200b\u6307\u5b9a\u200b\u4e3a\u200bRunnable\u3011\uff0c\u200b\u6240\u4ee5\u200bthread\u200b\u542f\u52a8\u200b\u65f6\u4f1a\u200b\u8c03\u7528\u200b worker.run()\n        this.thread = getThreadFactory().newThread(this);\n    }\n    // \u3010\u200b\u4e0d\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u3011\n    protected boolean tryAcquire(int unused) {\n        if (compareAndSetState(0, 1)) {\n            setExclusiveOwnerThread(Thread.currentThread());\n            return true;\n        }\n        return false;\n    }\n}\n</code></pre> Java<pre><code>public Thread newThread(Runnable r) {\n    // \u200b\u5c06\u200b\u5f53\u524d\u200b worker \u200b\u6307\u5b9a\u200b\u4e3a\u200b thread \u200b\u7684\u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b start \u200b\u4f1a\u200b\u8c03\u7528\u200b r.run()\n    Thread t = new Thread(group, r, namePrefix + threadNumber.getAndIncrement(), 0);\n    if (t.isDaemon())\n        t.setDaemon(false);\n    if (t.getPriority() != Thread.NORM_PRIORITY)\n        t.setPriority(Thread.NORM_PRIORITY);\n    return t;\n}\n</code></pre> <ul> <li>\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u90e8\u200b\u7c7b\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_126","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_127","title":"\u63d0\u4ea4\u200b\u65b9\u6cd5","text":"<ul> <li>AbstractExecutorService#submit()\uff1a\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\uff0c\u200b\u628a\u200b Runnable \u200b\u6216\u200b Callable \u200b\u4efb\u52a1\u200b\u5c01\u88c5\u200b\u6210\u200b FutureTask \u200b\u6267\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u7684\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u8c03\u7528\u200b get \u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b\u6216\u8005\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6e90\u7801\u200b\u5206\u6790\u200b\u5728\u200b\u7b14\u8bb0\u200b\u7684\u200b Future \u200b\u90e8\u5206\u200b</li> </ul> Java<pre><code>public Future&lt;?&gt; submit(Runnable task) {\n    // \u200b\u7a7a\u200b\u6307\u9488\u200b\u5f02\u5e38\u200b\n    if (task == null) throw new NullPointerException();\n    // \u200b\u628a\u200b Runnable \u200b\u5c01\u88c5\u200b\u6210\u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u5c31\u662f\u200b null\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b FutureTask#get \u200b\u8fd4\u56de\u200b\u6570\u636e\u200b\n    RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, null);\n    // \u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\n    execute(ftask);\n    return ftask;\n}\npublic &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) {\n    if (task == null) throw new NullPointerException();\n    // \u200b\u628a\u200b Callable \u200b\u5c01\u88c5\u200b\u6210\u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\n    RunnableFuture&lt;T&gt; ftask = newTaskFor(task);\n    // \u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\n    execute(ftask);   \n    // \u200b\u8fd4\u56de\u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7528\u6765\u200b\u83b7\u53d6\u200b\u8fd4\u56de\u503c\u200b\n    return ftask;\n}\n</code></pre> Java<pre><code>protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Runnable runnable, T value) {\n    // Runnable \u200b\u5c01\u88c5\u200b\u6210\u200b FutureTask\uff0c\u3010\u200b\u6307\u5b9a\u200b\u8fd4\u56de\u503c\u200b\u3011\n    return new FutureTask&lt;T&gt;(runnable, value);\n}\nprotected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) {\n    // Callable \u200b\u76f4\u63a5\u200b\u5c01\u88c5\u200b\u6210\u200b FutureTask\n    return new FutureTask&lt;T&gt;(callable);\n}\n</code></pre> <ul> <li>execute()\uff1a\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f46\u662f\u200b\u6ca1\u6709\u200b\u8fd4\u56de\u503c\u200b\uff0c\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\uff0c\u200b\u51fa\u73b0\u5f02\u5e38\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u629b\u51fa\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u200b\u7684\u200b\u5f02\u5e38\u200b\u3002\u200b\u6839\u636e\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u9009\u62e9\u200b\u6dfb\u52a0\u200b\u4efb\u52a1\u200b\u65f6\u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b</li> </ul> Java<pre><code>// command \u200b\u53ef\u4ee5\u200b\u662f\u200b\u666e\u901a\u200b\u7684\u200b Runnable \u200b\u5b9e\u73b0\u200b\u7c7b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u662f\u200b FutureTask\uff0c\u200b\u4e0d\u80fd\u200b\u662f\u200b Callable\npublic void execute(Runnable command) {\n    // \u200b\u975e\u7a7a\u200b\u5224\u65ad\u200b\n    if (command == null)\n        throw new NullPointerException();\n      // \u200b\u83b7\u53d6\u200b ctl \u200b\u6700\u65b0\u200b\u503c\u200b\u8d4b\u503c\u200b\u7ed9\u200b c\uff0cctl \u200b\u9ad8\u200b 3 \u200b\u4f4d\u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\uff0c\u200b\u4f4e\u4f4d\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u3002\n    int c = ctl.get();\n    // \u30101\u3011\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5c0f\u4e8e\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u6b64\u6b21\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u76f4\u63a5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b worker\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n    if (workerCountOf(c) &lt; corePoolSize) {\n        // addWorker \u200b\u4e3a\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u4f1a\u200b\u521b\u5efa\u200b worker \u200b\u5bf9\u8c61\u200b\u5e76\u4e14\u200b\u5c06\u200b command \u200b\u4f5c\u4e3a\u200b firstTask\uff0c\u200b\u4f18\u5148\u200b\u6267\u884c\u200b\n        if (addWorker(command, true))\n            return;\n\n        // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u6761\u200b\u8bed\u53e5\u200b\uff0c\u200b\u8bf4\u660e\u200b addWorker \u200b\u4e00\u5b9a\u200b\u662f\u200b\u5931\u8d25\u200b\u7684\u200b\uff0c\u200b\u5b58\u5728\u200b\u5e76\u53d1\u200b\u73b0\u8c61\u200b\u6216\u8005\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u88ab\u200b\u6539\u53d8\u200b\uff0c\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u72b6\u6001\u200b\n        // SHUTDOWN \u200b\u72b6\u6001\u200b\u4e0b\u200b\u4e5f\u200b\u6709\u200b\u53ef\u80fd\u200b\u521b\u5efa\u200b\u6210\u529f\u200b\uff0c\u200b\u524d\u63d0\u200b firstTask == null \u200b\u800c\u4e14\u200b\u5f53\u524d\u200b queue \u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff08\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff09\n        c = ctl.get();\n    }\n    // \u30102\u3011\u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5df2\u7ecf\u200b\u8fbe\u5230\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b \u200b\u6216\u8005\u200b addWorker \u200b\u5931\u8d25\u200b\n    //    \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u662f\u5426\u200b\u5904\u4e8e\u200brunning\u200b\u72b6\u6001\u200b\uff0c\u200b\u6210\u7acb\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u5c06\u200b task \u200b\u653e\u5165\u200b\u5230\u200b workQueue \u200b\u4e2d\u200b\n    if (isRunning(c) &amp;&amp; workQueue.offer(command)) {\n        int recheck = ctl.get();\n        // \u200b\u6761\u4ef6\u200b\u4e00\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u88ab\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u7ed9\u200b\u4fee\u6539\u200b\u4e86\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u6267\u884c\u200b\u4e86\u200b shutdown() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8be5\u200b\u72b6\u6001\u200b\u4e0d\u80fd\u200b\u63a5\u6536\u200b\u65b0\u200b\u63d0\u4ea4\u200b\u7684\u200b\u4efb\u52a1\u200b\n        // \u200b\u6240\u4ee5\u200b\u8981\u200b\u628a\u200b\u521a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u4efb\u52a1\u200b\u5220\u9664\u200b\uff0c\u200b\u5220\u9664\u200b\u6210\u529f\u200b\u8bf4\u660e\u200b\u63d0\u4ea4\u200b\u4e4b\u540e\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8fd8\u200b\u672a\u200b\u6d88\u8d39\u200b\uff08\u200b\u5904\u7406\u200b\uff09\u200b\u8be5\u200b\u4efb\u52a1\u200b\n        if (!isRunning(recheck) &amp;&amp; remove(command))\n            // \u200b\u4efb\u52a1\u200b\u51fa\u961f\u200b\u6210\u529f\u200b\uff0c\u200b\u8d70\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\n            reject(command);\n        // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b running \u200b\u72b6\u6001\u200b\uff0c\u200b\u83b7\u53d6\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\uff0c\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b 0\n        // \u3010\u200b\u62c5\u4fdd\u200b\u673a\u5236\u200b\u3011\uff0c\u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u6c60\u5728\u200b running \u200b\u72b6\u6001\u200b\u4e0b\u200b\uff0c\u200b\u6700\u8d77\u7801\u200b\u5f97\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u5de5\u4f5c\u200b\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    // \u30103\u3011offer\u200b\u5931\u8d25\u200b\u8bf4\u660e\u200bqueue\u200b\u6ee1\u200b\u4e86\u200b\n    // \u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5c1a\u672a\u200b\u8fbe\u5230\u200b maximumPoolSize\uff0c\u200b\u4f1a\u200b\u521b\u5efa\u200b\u975e\u6838\u5fc3\u200b worker \u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u6267\u884c\u200b command\uff0c\u3010\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u200b\u516c\u5e73\u200b\u7684\u200b\u539f\u56e0\u200b\u3011\n    // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u8fbe\u5230\u200b maximumPoolSiz\uff0c\u200b\u8fd9\u91cc\u200b addWorker \u200b\u4e5f\u200b\u4f1a\u200b\u5931\u8d25\u200b\uff0c\u200b\u8d70\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\n    else if (!addWorker(command, false))\n        reject(command);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_128","title":"\u6dfb\u52a0\u200b\u7ebf\u7a0b","text":"<ul> <li>prestartAllCoreThreads()\uff1a\u200b\u63d0\u524d\u200b\u9884\u70ed\u200b\uff0c\u200b\u521b\u5efa\u200b\u6240\u6709\u200b\u7684\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b</li> </ul> Java<pre><code>public int prestartAllCoreThreads() {\n    int n = 0;\n    while (addWorker(null, true))\n        ++n;\n    return n;\n}\n</code></pre> <ul> <li>addWorker()\uff1a\u200b\u6dfb\u52a0\u200b\u7ebf\u7a0b\u200b\u5230\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u8fd4\u56de\u200b true \u200b\u8868\u793a\u200b\u521b\u5efa\u200b Worker \u200b\u6210\u529f\u200b\uff0c\u200b\u4e14\u200b\u7ebf\u7a0b\u200b\u542f\u52a8\u200b\u3002\u200b\u9996\u5148\u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u662f\u5426\u200b\u5141\u8bb8\u200b\u6dfb\u52a0\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5c31\u8ba9\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b + 1\uff0c\u200b\u7136\u540e\u200b\u53bb\u200b\u521b\u5efa\u200b Worker \u200b\u52a0\u5165\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> </ul> <p>\u200b\u6ce8\u610f\u200b\uff1aSHUTDOWN \u200b\u72b6\u6001\u200b\u4e5f\u200b\u80fd\u200b\u6dfb\u52a0\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4f46\u662f\u200b\u8981\u6c42\u200b\u65b0\u52a0\u200b\u7684\u200b Woker \u200b\u6ca1\u6709\u200b firstTask\uff0c\u200b\u800c\u4e14\u200b\u5f53\u524d\u200b queue \u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u5e2e\u52a9\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6267\u884c\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b</p> Java<pre><code>// core == true \u200b\u8868\u793a\u200b\u91c7\u7528\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u9650\u5236\u200b\uff0cfalse \u200b\u8868\u793a\u200b\u91c7\u7528\u200b maximumPoolSize\nprivate boolean addWorker(Runnable firstTask, boolean core) {\n    // \u200b\u81ea\u65cb\u200b\u3010\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u662f\u5426\u200b\u5141\u8bb8\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u3011\uff0c\u200b\u5141\u8bb8\u200b\u5c31\u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b + 1\n    retry:\n    for (;;) {\n        // \u200b\u83b7\u53d6\u200b ctl \u200b\u7684\u200b\u503c\u200b\n        int c = ctl.get();\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\n        int rs = runStateOf(c);   \n\n        // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u3010\u200b\u662f\u5426\u200b\u5141\u8bb8\u200b\u6dfb\u52a0\u200b\u7ebf\u7a0b\u200b\u3011\n\n        // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b SHUTDOWN \u200b\u72b6\u6001\u200b\uff0c\u200b\u4f46\u662f\u200b\u961f\u5217\u200b\u91cc\u9762\u200b\u8fd8\u6709\u200b\u4efb\u52a1\u200b\u5c1a\u672a\u200b\u5904\u7406\u200b\u5b8c\u200b\uff0c\u200b\u9700\u8981\u200b\u5904\u7406\u200b\u5b8c\u200b queue \u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\n        // \u3010\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u518d\u200b\u63d0\u4ea4\u200b\u65b0\u200b\u7684\u200b task\uff0c\u200b\u6240\u4ee5\u200b firstTask \u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u6dfb\u52a0\u200b worker\u3011\n        if (rs &gt;= SHUTDOWN &amp;&amp; !(rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; !workQueue.isEmpty()))\n            return false;\n        for (;;) {\n            // \u200b\u83b7\u53d6\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u6570\u91cf\u200b\n            int wc = workerCountOf(c);\n            // \u200b\u6761\u4ef6\u200b\u4e00\u200b\u4e00\u822c\u200b\u4e0d\u200b\u6210\u7acb\u200b\uff0cCAPACITY\u200b\u662f\u200b5\u200b\u4ebf\u591a\u200b\uff0c\u200b\u6839\u636e\u200b core \u200b\u5224\u65ad\u200b\u4f7f\u7528\u200b\u54ea\u4e2a\u200b\u5927\u5c0f\u200b\u9650\u5236\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\uff0c\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u8fd4\u56de\u200b false\n            if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize))\n                return false;\n            // \u200b\u8bb0\u5f55\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5df2\u7ecf\u200b\u52a0\u200b 1\uff0c\u200b\u7c7b\u6bd4\u200b\u4e8e\u200b\u7533\u8bf7\u200b\u5230\u200b\u4e86\u200b\u4e00\u5757\u200b\u4ee4\u724c\u200b\uff0c\u200b\u6761\u4ef6\u200b\u5931\u8d25\u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u4e86\u200b\u6570\u91cf\u200b\n            if (compareAndIncrementWorkerCount(c))\n                // \u200b\u7533\u8bf7\u200b\u6210\u529f\u200b\uff0c\u200b\u8df3\u51fa\u200b\u4e86\u200b retry \u200b\u8fd9\u4e2a\u200b for \u200b\u81ea\u65cb\u200b\n                break retry;\n            // CAS \u200b\u5931\u8d25\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6210\u529f\u200b\u7684\u200b\u7533\u8bf7\u200b\u5230\u200b\u4ee4\u724c\u200b\n            c = ctl.get();\n            // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u662f\u5426\u200b\u53d1\u751f\u200b\u8fc7\u200b\u53d8\u5316\u200b\uff0c\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u4e86\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b\u4e86\u200b shutdown() \u200b\u65b9\u6cd5\u200b\n            if (runStateOf(c) != rs)\n                // \u200b\u8fd4\u56de\u200b\u5916\u5c42\u200b\u5faa\u73af\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u80fd\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5728\u200b if \u200b\u8bed\u53e5\u200b\u4e2d\u200b\u8fd4\u56de\u200b false\n                continue retry;\n\n        }\n    }\n\n    //\u3010\u200b\u4ee4\u724c\u200b\u7533\u8bf7\u200b\u6210\u529f\u200b\uff0c\u200b\u5f00\u59cb\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\u3011\n\n  // \u200b\u8fd0\u884c\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8868\u793a\u200b\u521b\u5efa\u200b\u7684\u200b worker \u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u542f\u52a8\u200b\uff0cfalse\u200b\u672a\u200b\u542f\u52a8\u200b  true\u200b\u542f\u52a8\u200b\n    boolean workerStarted = false;\n    // \u200b\u6dfb\u52a0\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8868\u793a\u200b\u521b\u5efa\u200b\u7684\u200b worker \u200b\u662f\u5426\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6c60\u5b50\u200b\u4e2d\u200b\u4e86\u200b\uff0c\u200b\u9ed8\u8ba4\u200bfalse\u200b\u672a\u200b\u6dfb\u52a0\u200b\uff0ctrue\u200b\u662f\u200b\u6dfb\u52a0\u200b\u3002\n    boolean workerAdded = false;\n    Worker w = null;\n    try {\n        // \u3010\u200b\u521b\u5efa\u200b Worker\uff0c\u200b\u5e95\u5c42\u200b\u901a\u8fc7\u200b\u7ebf\u7a0b\u200b\u5de5\u5382\u200b newThread \u200b\u65b9\u6cd5\u200b\u521b\u5efa\u200b\u6267\u884c\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6307\u5b9a\u200b\u4e86\u200b\u9996\u5148\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u3011\n        w = new Worker(firstTask);\n        // \u200b\u5c06\u200b\u65b0\u521b\u5efa\u200b\u7684\u200b worker \u200b\u8282\u70b9\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8d4b\u503c\u200b\u7ed9\u200b t\n        final Thread t = w.thread;\n        // \u200b\u8fd9\u91cc\u200b\u7684\u200b\u5224\u65ad\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b \u200b\u7a0b\u5e8f\u5458\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b ThreadFactory \u200b\u5b9e\u73b0\u200b\u7c7b\u6709\u200b bug\uff0c\u200b\u521b\u9020\u200b\u4e0d\u200b\u51fa\u7ebf\u200b\u7a0b\u200b\n        if (t != null) {\n            final ReentrantLock mainLock = this.mainLock;\n            // \u200b\u52a0\u200b\u4e92\u65a5\u200b\u9501\u200b\uff0c\u200b\u8981\u200b\u6dfb\u52a0\u200b worker \u200b\u4e86\u200b\n            mainLock.lock();\n            try {\n                // \u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u4fdd\u5b58\u200b\u5230\u200b rs\n                int rs = runStateOf(ctl.get());\n              // \u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u662f\u5426\u200b\u4e3a\u200bRUNNING\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e0d\u662f\u200b\u518d\u200b\u3010\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u662f\u5426\u200b\u4e3a\u200bSHUTDOWN\u200b\u72b6\u6001\u200b\u4e14\u200bfirstTask\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\u3011\n                if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) {\n                    // \u200b\u5f53\u200b\u7ebf\u7a0b\u200bstart\u200b\u540e\u200b\uff0c\u200b\u7ebf\u7a0b\u200bisAlive\u200b\u4f1a\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u8fd9\u91cc\u200b\u8fd8\u200b\u6ca1\u200b\u5f00\u59cb\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u542f\u52a8\u200b\u4e86\u200b\u5c31\u200b\u9700\u8981\u200b\u62a5\u9519\u200b\n                    if (t.isAlive())\n                        throw new IllegalThreadStateException();\n\n                    //\u3010\u200b\u5c06\u200b\u65b0\u5efa\u200b\u7684\u200b Worker \u200b\u6dfb\u52a0\u200b\u5230\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u3011\n                    workers.add(w);\n                    int s = workers.size();\n                  // \u200b\u5f53\u524d\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u662f\u200b\u4e00\u4e2a\u200b\u65b0\u9ad8\u200b\uff0c\u200b\u66f4\u65b0\u200b largestPoolSize\n                    if (s &gt; largestPoolSize)\n                        largestPoolSize = s;\n                    // \u200b\u6dfb\u52a0\u200b\u6807\u8bb0\u200b\u7f6e\u200b\u4e3a\u200b true\n                    workerAdded = true;\n                }\n            } finally {\n                // \u200b\u89e3\u9501\u200b\u554a\u200b\n                mainLock.unlock();\n            }\n            // \u200b\u6dfb\u52a0\u200b\u6210\u529f\u200b\u5c31\u200b\u3010\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u3011\n            if (workerAdded) {\n                // Thread \u200b\u7c7b\u4e2d\u200b\u6301\u6709\u200b Runnable \u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u8c03\u7528\u200b\u7684\u200b\u662f\u200b Runnable \u200b\u7684\u200b run \uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b FutureTask\n                t.start();\n                // \u200b\u8fd0\u884c\u200b\u6807\u8bb0\u200b\u7f6e\u200b\u4e3a\u200b true\n                workerStarted = true;\n            }\n        }\n    } finally {\n        // \u200b\u5982\u679c\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\u5931\u8d25\u200b\uff0c\u200b\u505a\u200b\u6e05\u7406\u200b\u5de5\u4f5c\u200b\n        if (! workerStarted)\n            addWorkerFailed(w);\n    }\n    // \u200b\u8fd4\u56de\u200b\u65b0\u521b\u5efa\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u542f\u52a8\u200b\n    return workerStarted;\n}\n</code></pre> <ul> <li>addWorkerFailed()\uff1a\u200b\u6e05\u7406\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>private void addWorkerFailed(Worker w) {\n    final ReentrantLock mainLock = this.mainLock;\n    // \u200b\u6301\u6709\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5168\u5c40\u200b\u9501\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u64cd\u4f5c\u200b\u7684\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u76f8\u5173\u200b\u7684\u200b\u4e1c\u897f\u200b\n    mainLock.lock();\n    try {\n        //\u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u9700\u8981\u200b\u5c06\u200b worker \u200b\u5728\u200b workers \u200b\u4e2d\u200b\u6e05\u7406\u200b\u51fa\u53bb\u200b\u3002\n        if (w != null)\n            workers.remove(w);\n        // \u200b\u5c06\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8ba1\u6570\u200b -1\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5f52\u8fd8\u200b\u4ee4\u724c\u200b\u3002\n        decrementWorkerCount();\n        // \u200b\u5c1d\u8bd5\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\n        tryTerminate();\n    } finally {\n        //\u200b\u91ca\u653e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5168\u5c40\u200b\u9501\u200b\u3002\n        mainLock.unlock();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_129","title":"\u8fd0\u884c\u200b\u65b9\u6cd5","text":"<ul> <li>Worker#run\uff1aWorker \u200b\u5b9e\u73b0\u200b\u4e86\u200b Runnable \u200b\u63a5\u53e3\u200b\uff0c\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u8c03\u7528\u200b Worker \u200b\u7684\u200b run() \u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>public void run() {\n    // ThreadPoolExecutor#runWorker()\n    runWorker(this);\n}\n</code></pre> <ul> <li>runWorker()\uff1a\u200b\u7ebf\u7a0b\u200b\u542f\u52a8\u200b\u5c31\u8981\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f1a\u200b\u4e00\u76f4\u200b while \u200b\u5faa\u73af\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u5e76\u200b\u6267\u884c\u200b</li> </ul> Java<pre><code>final void runWorker(Worker w) {\n    Thread wt = Thread.currentThread();   \n    // \u200b\u83b7\u53d6\u200b worker \u200b\u7684\u200b firstTask\n    Runnable task = w.firstTask;\n    // \u200b\u5f15\u7528\u200b\u7f6e\u7a7a\u200b\uff0c\u3010\u200b\u9632\u6b62\u200b\u590d\u7528\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u65f6\u200b\u91cd\u590d\u200b\u6267\u884c\u200b\u8be5\u200b\u4efb\u52a1\u200b\u3011\n    w.firstTask = null;\n    // \u200b\u521d\u59cb\u5316\u200b worker \u200b\u65f6\u200b\u8bbe\u7f6e\u200b state = -1\uff0c\u200b\u8868\u793a\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u62a2\u5360\u200b\u9501\u200b\n    // \u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b state = 0 \u200b\u548c\u200b exclusiveOwnerThread = null\uff0c\u200b\u5f00\u59cb\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\u62a2\u9501\u200b\n    w.unlock();\n    // true \u200b\u8868\u793a\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\u9000\u51fa\u200b\uff0cfalse \u200b\u8868\u793a\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\u3002\n    boolean completedAbruptly = true;\n    try {\n        // firstTask \u200b\u4e0d\u662f\u200b null \u200b\u5c31\u200b\u76f4\u63a5\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5426\u5219\u200b\u53bb\u200b queue \u200b\u4e2d\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\n        // \u3010getTask \u200b\u5982\u679c\u200b\u662f\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\u5728\u200btake\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u76f4\u5230\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u8d70\u200b\u8fd4\u56de\u200bnull\u200b\u7684\u200b\u903b\u8f91\u200b\u3011\n        while (task != null || (task = getTask()) != null) {\n            // worker \u200b\u52a0\u9501\u200b\uff0cshutdown \u200b\u65f6\u4f1a\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b worker \u200b\u72b6\u6001\u200b\uff0c\u3010\u200b\u6839\u636e\u200b\u72ec\u5360\u200b\u9501\u200b\u72b6\u6001\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u7a7a\u95f2\u200b\u3011\n            w.lock();\n\n          // \u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u5927\u4e8e\u200b STOP\uff0c\u200b\u76ee\u524d\u200b\u5904\u4e8e\u200b STOP/TIDYING/TERMINATION\uff0c\u200b\u6b64\u65f6\u200b\u7ed9\u200b\u7ebf\u7a0b\u200b\u4e00\u4e2a\u200b\u4e2d\u65ad\u200b\u4fe1\u53f7\u200b\n            if ((runStateAtLeast(ctl.get(), STOP) ||\n                 // \u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u5904\u4e8e\u200b RUNNING \u200b\u6216\u8005\u200b SHUTDOWN \u200b\u72b6\u6001\u200b\uff0c\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\n                 (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted())\n                // \u200b\u4e2d\u65ad\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e2d\u65ad\u200b\u6807\u5fd7\u200b\u4f4d\u4e3a\u200b true\n                wt.interrupt();\n            try {\n                // \u200b\u94a9\u5b50\u200b\u65b9\u6cd5\u200b\uff0c\u3010\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u524d\u7f6e\u200b\u5904\u7406\u200b\u3011\n                beforeExecute(wt, task);\n                Throwable thrown = null;\n                try {\n                    // \u3010\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u3011\n                    task.run();\n                } catch (Exception x) {\n                  //.....\n                } finally {\n                    // \u200b\u94a9\u5b50\u200b\u65b9\u6cd5\u200b\uff0c\u3010\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u540e\u7f6e\u200b\u5904\u7406\u200b\u3011\n                    afterExecute(task, thrown);\n                }\n            } finally {\n                task = null;      // \u200b\u5c06\u200b\u5c40\u90e8\u53d8\u91cf\u200btask\u200b\u7f6e\u200b\u4e3a\u200bnull\uff0c\u200b\u4ee3\u8868\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\n                w.completedTasks++;   // \u200b\u66f4\u65b0\u200bworker\u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\u6570\u91cf\u200b\n                w.unlock();           // \u200b\u89e3\u9501\u200b\n            }\n        }\n        // getTask()\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200bnull\u200b\u65f6\u4f1a\u200b\u8d70\u200b\u5230\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u8868\u793a\u200bqueue\u200b\u4e3a\u7a7a\u200b\u5e76\u4e14\u200b\u7ebf\u7a0b\u200b\u7a7a\u95f2\u200b\u8d85\u8fc7\u200b\u4fdd\u6d3b\u200b\u65f6\u95f4\u200b\uff0c\u3010\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u9000\u51fa\u200b\u903b\u8f91\u200b\u3011\n        completedAbruptly = false;    \n    } finally {\n        // \u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b completedAbruptly = false\n          // \u200b\u5f02\u5e38\u200b\u9000\u51fa\u200b completedAbruptly = true\uff0c\u3010\u200b\u4ece\u200b task.run() \u200b\u5185\u90e8\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u3011\u200b\u65f6\u200b\uff0c\u200b\u8df3\u5230\u200b\u8fd9\u200b\u4e00\u884c\u200b\n        processWorkerExit(w, completedAbruptly);\n    }\n}\n</code></pre> <ul> <li>unlock()\uff1a\u200b\u91cd\u7f6e\u200b\u9501\u200b</li> </ul> Java<pre><code>public void unlock() { release(1); }\n// \u200b\u5916\u90e8\u200b\u4e0d\u4f1a\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b \u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u662f\u200b AQS \u200b\u5185\u200b\u8c03\u7528\u200b\u7684\u200b\uff0c\u200b\u5916\u90e8\u200b\u8c03\u7528\u200b unlock \u200b\u65f6\u200b\u89e6\u53d1\u200b\u6b64\u200b\u65b9\u6cd5\u200b\nprotected boolean tryRelease(int unused) {\n    setExclusiveOwnerThread(null);        // \u200b\u8bbe\u7f6e\u200b\u6301\u6709\u8005\u200b\u4e3a\u200b null\n    setState(0);                      // \u200b\u8bbe\u7f6e\u200b state = 0\n    return true;\n}\n</code></pre> <ul> <li>getTask()\uff1a\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u7a7a\u95f2\u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b keepAliveTime \u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u5224\u65ad\u200b\u7684\u200b\u4f9d\u636e\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u8d85\u8fc7\u200b\u4fdd\u6d3b\u200b\u65f6\u95f4\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b null \u200b\u5c31\u200b\u4ee3\u8868\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8981\u200b\u88ab\u200b\u56de\u6536\u200b\u4e86\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5230\u200b runWorker \u200b\u6267\u884c\u200b\u7ebf\u7a0b\u200b\u9000\u51fa\u200b\u903b\u8f91\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5177\u6709\u200b\u62c5\u4fdd\u200b\u673a\u5236\u200b\uff0c\u200b\u5bf9\u4e8e\u200b RUNNING \u200b\u72b6\u6001\u200b\u4e0b\u200b\u7684\u200b\u8d85\u65f6\u200b\u56de\u6536\u200b\uff0c\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u6700\u5c11\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b\uff0c\u200b\u6216\u8005\u200b\u4efb\u52a1\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5df2\u7ecf\u200b\u662f\u200b\u7a7a\u200b</li> </ul> Java<pre><code>private Runnable getTask() {\n    // \u200b\u8d85\u65f6\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u662f\u5426\u200b\u8d85\u65f6\u200b\uff0ctrue \u200b\u8868\u793a\u200b\u5df2\u200b\u8d85\u65f6\u200b\n    boolean timedOut = false; \n    for (;;) {\n        int c = ctl.get();\n        // \u200b\u83b7\u53d6\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5f53\u524d\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\n        int rs = runStateOf(c);\n\n        // \u3010tryTerminate\u3011\u200b\u6253\u65ad\u200b\u7ebf\u7a0b\u200b\u540e\u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200bSTOP\u200b\u6216\u8005\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200bSHUTDOWN\u200b\u5e76\u4e14\u200b\u961f\u5217\u200b\u5df2\u7ecf\u200b\u662f\u200b\u7a7a\u200b\n        // \u200b\u6240\u4ee5\u200b\u4e0b\u9762\u200b\u7684\u200b if \u200b\u6761\u4ef6\u200b\u4e00\u5b9a\u200b\u662f\u200b\u6210\u7acb\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b null\uff0c\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u5e94\u8be5\u200b\u9000\u51fa\u200b\u4e86\u200b\n        if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) {\n            // \u200b\u4f7f\u7528\u200b CAS \u200b\u81ea\u65cb\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8ba9\u200b ctl \u200b\u503c\u200b -1\n            decrementWorkerCount();\n            return null;\n        }\n\n      // \u200b\u83b7\u53d6\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\n        int wc = workerCountOf(c);\n\n        // \u200b\u7ebf\u7a0b\u200b\u6ca1\u6709\u200b\u660e\u786e\u200b\u7684\u200b\u533a\u5206\u200b\u8c01\u200b\u662f\u200b\u6838\u5fc3\u200b\u6216\u8005\u200b\u975e\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u662f\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5224\u65ad\u200b\n\n        // timed = false \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b \u200b\u83b7\u53d6\u200btask\u200b\u65f6\u200b\u4e0d\u200b\u652f\u6301\u200b\u8d85\u65f6\u200b\u673a\u5236\u200b\u7684\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4f7f\u7528\u200b queue.take() \u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\n        // timed = true \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b \u200b\u83b7\u53d6\u200btask\u200b\u65f6\u200b\u652f\u6301\u200b\u8d85\u65f6\u200b\u673a\u5236\u200b\uff0c\u200b\u4f7f\u7528\u200b queue.poll(xxx,xxx) \u200b\u8d85\u65f6\u200b\u83b7\u53d6\u200b\n        // \u200b\u6761\u4ef6\u200b\u4e00\u200b\u4ee3\u8868\u200b\u5141\u8bb8\u200b\u56de\u6536\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u65e0\u6240\u8c13\u200b\u4e86\u200b\uff0c\u200b\u5168\u90e8\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6267\u884c\u200b\u8d85\u65f6\u200b\u56de\u6536\u200b\n        // \u200b\u6761\u4ef6\u200b\u4e8c\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u975e\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6709\u200b\u4fdd\u6d3b\u200b\u65f6\u95f4\u200b\uff0c\u200b\u53bb\u200b\u8d85\u65f6\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\n        boolean timed = allowCoreThreadTimeOut || wc &gt; corePoolSize;\n\n      // \u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u662f\u5426\u200b\u8d85\u8fc7\u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff0c\u200b\u76f4\u63a5\u200b\u56de\u6536\u200b\n        // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u3010\u200b\u5141\u8bb8\u200b\u8d85\u65f6\u200b\u56de\u6536\u200b\u5e76\u4e14\u200b\u5df2\u7ecf\u200b\u8d85\u65f6\u200b\u4e86\u200b\u3011\uff0c\u200b\u5c31\u200b\u5e94\u8be5\u200b\u88ab\u200b\u56de\u6536\u200b\u4e86\u200b\uff0c\u200b\u7531\u4e8e\u200b\u3010\u200b\u62c5\u4fdd\u200b\u673a\u5236\u200b\u3011\u200b\u8fd8\u8981\u200b\u505a\u200b\u5224\u65ad\u200b\uff1a\n        //      wc &gt; 1 \u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd8\u200b\u7528\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u56de\u6536\u200b\n        //    workQueue.isEmpty() \u200b\u524d\u7f6e\u6761\u4ef6\u200b\u662f\u200b wc = 1\uff0c\u3010\u200b\u5982\u679c\u200b\u5f53\u524d\u4efb\u52a1\u200b\u961f\u5217\u200b\u4e5f\u200b\u662f\u200b\u7a7a\u200b\u4e86\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u9000\u51fa\u200b\u3011\n        if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut)) &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) {\n            // \u200b\u4f7f\u7528\u200b CAS \u200b\u673a\u5236\u200b\u5c06\u200b ctl \u200b\u503c\u200b -1 ,\u200b\u51cf\u200b 1 \u200b\u6210\u529f\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8fd4\u56de\u200b null\uff0c\u200b\u4ee3\u8868\u200b\u53ef\u4ee5\u200b\u9000\u51fa\u200b\n            if (compareAndDecrementWorkerCount(c))\n                return null;\n            continue;\n        }\n\n        try {\n            // \u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u8d85\u65f6\u200b\u56de\u6536\u200b\uff0c\u3010\u200b\u9009\u62e9\u200b\u4ece\u200b\u961f\u5217\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3011\u200b\u662f\u200b\u8d85\u65f6\u200b\u83b7\u53d6\u200b\u6216\u8005\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\n            Runnable r = timed ?\n                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take();\n            // \u200b\u83b7\u53d6\u200b\u5230\u200b\u4efb\u52a1\u200b\u8fd4\u56de\u200b\u4efb\u52a1\u200b\uff0c\u3010\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\u4f1a\u200b\u963b\u585e\u200b\u5230\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u4e3a\u6b62\u200b\u3011\uff0c\u200b\u4e0d\u4f1a\u200b\u8fd4\u56de\u200b null\n            if (r != null)\n                return r;\n            // \u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u4e3a\u200b null \u200b\u8bf4\u660e\u200b\u8d85\u65f6\u200b\u4e86\u200b\uff0c\u200b\u5c06\u200b\u8d85\u65f6\u200b\u6807\u8bb0\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b true\uff0c\u200b\u4e0b\u6b21\u200b\u81ea\u65cb\u200b\u65f6\u8fd4\u200b null\n            timedOut = true;\n        } catch (InterruptedException retry) {\n            // \u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u6253\u65ad\u200b\u540e\u200b\u8d85\u65f6\u200b\u6807\u8bb0\u200b\u7f6e\u200b\u4e3a\u200b false\uff0c\u3010\u200b\u8bf4\u660e\u200b\u88ab\u200b\u6253\u65ad\u200b\u4e0d\u7b97\u200b\u8d85\u65f6\u200b\u3011\uff0c\u200b\u8981\u200b\u7ee7\u7eed\u200b\u83b7\u53d6\u200b\uff0c\u200b\u76f4\u5230\u200b\u8d85\u65f6\u200b\u6216\u8005\u200b\u83b7\u53d6\u200b\u5230\u200b\u4efb\u52a1\u200b\n            // \u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b SHUTDOWN \u200b\u72b6\u6001\u200b\u4e0b\u200b\u7684\u200b\u6253\u65ad\u200b\uff0c\u200b\u4f1a\u200b\u5728\u200b\u5faa\u73af\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u524d\u200b\u5224\u65ad\u200b\uff0c\u200b\u8fd4\u56de\u200b null\n            timedOut = false;\n        }\n    }\n}\n</code></pre> <ul> <li>processWorkerExit()\uff1a\u200b\u7ebf\u7a0b\u200b\u9000\u51fa\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u62c5\u4fdd\u200b\u673a\u5236\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\u88ab\u200b\u6267\u884c\u200b</li> </ul> Java<pre><code>// \u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b completedAbruptly = false\uff0c\u200b\u5f02\u5e38\u200b\u9000\u51fa\u200b\u4e3a\u200b true\nprivate void processWorkerExit(Worker w, boolean completedAbruptly) {\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u4ee3\u8868\u200b\u5f53\u524d\u200b worker \u200b\u662f\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\u9000\u51fa\u200b\u7684\u200b\uff0ctask \u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5411\u4e0a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u4e86\u200b\n    if (completedAbruptly) \n        // \u200b\u4ece\u200b\u5f02\u5e38\u200b\u65f6\u5230\u200b\u8fd9\u91cc\u200b ctl \u200b\u4e00\u76f4\u200b\u6ca1\u6709\u200b -1\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u8fd9\u91cc\u200b -1\n        decrementWorkerCount();\n\n    final ReentrantLock mainLock = this.mainLock;\n    // \u200b\u52a0\u9501\u200b\n    mainLock.lock();\n    try {\n        // \u200b\u5c06\u200b\u5f53\u524d\u200b worker \u200b\u5b8c\u6210\u200b\u7684\u200b task \u200b\u6570\u91cf\u200b\uff0c\u200b\u6c47\u603b\u200b\u5230\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b completedTaskCount\n        completedTaskCount += w.completedTasks;\n      // \u200b\u5c06\u200b worker \u200b\u4ece\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u79fb\u9664\u200b\n        workers.remove(w);\n    } finally {\n        mainLock.unlock();    // \u200b\u89e3\u9501\u200b\n    }\n  // \u200b\u5c1d\u8bd5\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u5524\u9192\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\n    tryTerminate();\n\n    int c = ctl.get();\n    // \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e0d\u662f\u200b\u505c\u6b62\u200b\u72b6\u6001\u200b\u5c31\u200b\u5e94\u8be5\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u8fd0\u884c\u200b\u3010\u200b\u62c5\u4fdd\u200b\u673a\u5236\u200b\u3011\n    if (runStateLessThan(c, STOP)) {\n        // \u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u662f\u200b\u5bf9\u200b\u7a7a\u95f2\u200b\u7ebf\u7a0b\u200b\u56de\u6536\u200b\uff0c\u200b\u4e0d\u662f\u200b\u6267\u884c\u200b\u51fa\u9519\u200b\n        if (!completedAbruptly) {\n            // \u200b\u6839\u636e\u200b\u662f\u5426\u200b\u56de\u6536\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u786e\u5b9a\u200b\u3010\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u6700\u5c0f\u503c\u200b\u3011\n            int min = allowCoreThreadTimeOut ? 0 : corePoolSize;\n            // \u200b\u6700\u5c0f\u503c\u200b\u4e3a\u200b 0\uff0c\u200b\u4f46\u662f\u200b\u7ebf\u7a0b\u200b\u961f\u5217\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\u62c5\u4fdd\u200b\u673a\u5236\u200b\n            if (min == 0 &amp;&amp; !workQueue.isEmpty())\n                min = 1;\n            // \u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b\u6700\u5c0f\u503c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\n            if (workerCountOf(c) &gt;= min)\n                return;\n        }\n        // \u200b\u6267\u884c\u200b task \u200b\u65f6\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6709\u4e2a\u200b\u7ebf\u7a0b\u200b\u56e0\u4e3a\u200b\u5f02\u5e38\u200b\u7ec8\u6b62\u200b\u4e86\u200b\uff0c\u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b\n        // \u200b\u6216\u8005\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u6570\u91cf\u200b\u5c0f\u4e8e\u200b\u6700\u5c0f\u503c\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8981\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b worker \u200b\u52a0\u8fdb\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\n        addWorker(null, false);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_130","title":"\u505c\u6b62\u200b\u65b9\u6cd5","text":"<ul> <li>shutdown()\uff1a\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> </ul> Java<pre><code>public void shutdown() {\n    final ReentrantLock mainLock = this.mainLock;\n    // \u200b\u83b7\u53d6\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5168\u5c40\u200b\u9501\u200b\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        // \u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200b SHUTDOWN\uff0c\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u5927\u4e8e\u200b SHUTDOWN\uff0c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u8bbe\u7f6e\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\n        advanceRunState(SHUTDOWN);\n        // \u200b\u4e2d\u65ad\u200b\u7a7a\u95f2\u200b\u7ebf\u7a0b\u200b\n        interruptIdleWorkers();\n        // \u200b\u7a7a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5b50\u7c7b\u200b\u53ef\u4ee5\u200b\u6269\u5c55\u200b\n        onShutdown(); \n    } finally {\n        // \u200b\u91ca\u653e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5168\u5c40\u200b\u9501\u200b\n        mainLock.unlock();\n    }\n    tryTerminate();\n}\n</code></pre> <ul> <li>interruptIdleWorkers()\uff1ashutdown \u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u4e2d\u65ad\u200b\u6240\u6709\u200b\u7a7a\u95f2\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6839\u636e\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b AQS \u200b\u72ec\u5360\u200b\u9501\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5904\u4e8e\u200b\u5de5\u4f5c\u200b\u72b6\u6001\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u4e4b\u6240\u4ee5\u200b\u7a7a\u95f2\u200b\u662f\u56e0\u4e3a\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u6ca1\u6709\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u4e2d\u65ad\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6240\u4ee5\u200b shutdown \u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u8ba9\u200b\u6240\u6709\u200b\u7684\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b</li> </ul> Java<pre><code>// onlyOne == true \u200b\u8bf4\u660e\u200b\u53ea\u200b\u4e2d\u65ad\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b \uff0cfalse \u200b\u5219\u200b\u4e2d\u65ad\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\nprivate void interruptIdleWorkers(boolean onlyOne) {\n    final ReentrantLock mainLock = this.mainLock;\n    / /\u200b\u6301\u6709\u200b\u5168\u5c40\u200b\u9501\u200b\n    mainLock.lock();\n    try {\n        // \u200b\u904d\u5386\u200b\u6240\u6709\u200b worker\n        for (Worker w : workers) {\n            // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b worker \u200b\u7684\u200b\u7ebf\u7a0b\u200b\n            Thread t = w.thread;\n            // \u200b\u6761\u4ef6\u200b\u4e00\u200b\u6210\u7acb\u200b\uff1a\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8fed\u4ee3\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c1a\u672a\u200b\u4e2d\u65ad\u200b\n            // \u200b\u6761\u4ef6\u200b\u4e8c\u200b\u6210\u7acb\u200b\uff1a\u200b\u8bf4\u660e\u200b\u3010\u200b\u5f53\u524d\u200bworker\u200b\u5904\u4e8e\u200b\u7a7a\u95f2\u200b\u72b6\u6001\u200b\u3011\uff0c\u200b\u963b\u585e\u200b\u5728\u200bpoll\u200b\u6216\u8005\u200btake\uff0c\u200b\u56e0\u4e3a\u200bworker\u200b\u6267\u884c\u200btask\u200b\u65f6\u200b\u662f\u200b\u8981\u200b\u52a0\u9501\u200b\u7684\u200b\n            //           \u200b\u6bcf\u4e2a\u200bworker\u200b\u6709\u200b\u4e00\u4e2a\u200b\u72ec\u5360\u200b\u9501\u200b\uff0cw.tryLock()\u200b\u5c1d\u8bd5\u200b\u52a0\u9501\u200b\uff0c\u200b\u52a0\u9501\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b true\n            if (!t.isInterrupted() &amp;&amp; w.tryLock()) {\n                try {\n                    // \u200b\u4e2d\u65ad\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5904\u4e8e\u200b queue \u200b\u963b\u585e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u8fdb\u5165\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u81ea\u65cb\u200b\uff0c\u200b\u8fd4\u56de\u200b null\uff0c\u200b\u6267\u884c\u200b\u9000\u51fa\u200b\u76f8\u200b\u903b\u8f91\u200b\n                    t.interrupt();\n                } catch (SecurityException ignore) {\n                } finally {\n                    // \u200b\u91ca\u653e\u200bworker\u200b\u7684\u200b\u72ec\u5360\u200b\u9501\u200b\n                    w.unlock();\n                }\n            }\n            // false\uff0c\u200b\u4ee3\u8868\u200b\u4e2d\u65ad\u200b\u6240\u6709\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n            if (onlyOne)\n                break;\n        }\n\n    } finally {\n        // \u200b\u91ca\u653e\u200b\u5168\u5c40\u200b\u9501\u200b\n        mainLock.unlock();\n    }\n}\n</code></pre> <ul> <li>shutdownNow()\uff1a\u200b\u76f4\u63a5\u200b\u5173\u95ed\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7b49\u5f85\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b</li> </ul> Java<pre><code>public List&lt;Runnable&gt; shutdownNow() {\n    // \u200b\u8fd4\u56de\u503c\u200b\u5f15\u7528\u200b\n    List&lt;Runnable&gt; tasks;\n    final ReentrantLock mainLock = this.mainLock;\n    // \u200b\u83b7\u53d6\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5168\u5c40\u200b\u9501\u200b\n    mainLock.lock();\n    try {\n        checkShutdownAccess();\n        // \u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200bSTOP\n        advanceRunState(STOP);\n        // \u200b\u4e2d\u65ad\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u3010\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u3011\n        interruptWorkers();\n        // \u200b\u4ece\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u5bfc\u51fa\u200b\u672a\u200b\u5904\u7406\u200b\u7684\u200btask\n        tasks = drainQueue();\n    } finally {\n        mainLock.unlock();\n    }\n\n    tryTerminate();\n    // \u200b\u8fd4\u56de\u200b\u5f53\u524d\u4efb\u52a1\u200b\u961f\u5217\u200b\u4e2d\u200b \u200b\u672a\u200b\u5904\u7406\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\n    return tasks;\n}\n</code></pre> <ul> <li>tryTerminate()\uff1a\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b TERMINATED \u200b\u72b6\u6001\u200b if either (SHUTDOWN and pool and queue empty) or (STOP and pool empty)</li> </ul> Java<pre><code>final void tryTerminate() {\n    for (;;) {\n        // \u200b\u83b7\u53d6\u200b ctl \u200b\u7684\u200b\u503c\u200b\n        int c = ctl.get();\n        // \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6b63\u5e38\u200b\uff0c\u200b\u6216\u8005\u200b\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4e86\u200b\u72b6\u6001\u200b\u8f6c\u6362\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\n        if (isRunning(c) || runStateAtLeast(c, TIDYING) ||\n            // \u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b SHUTDOWN \u200b\u5e76\u4e14\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\u4e0d\u662f\u200b\u7a7a\u200b\uff0c\u200b\u9700\u8981\u200b\u53bb\u200b\u5904\u7406\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\n            (runStateOf(c) == SHUTDOWN &amp;&amp; ! workQueue.isEmpty()))\n            return;\n\n        // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u91cc\u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200b STOP \u200b\u6216\u8005\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200b SHUTDOWN \u200b\u5e76\u4e14\u200b\u961f\u5217\u200b\u5df2\u7ecf\u200b\u662f\u200b\u7a7a\u200b\n        // \u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u6570\u91cf\u200b\n        if (workerCountOf(c) != 0) {\n            // \u3010\u200b\u4e2d\u65ad\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u7ebf\u7a0b\u200b\u3011\uff0c\u200b\u5728\u200b queue.take() | queue.poll() \u200b\u963b\u585e\u200b\u7a7a\u95f2\u200b\n            // \u200b\u5524\u9192\u200b\u540e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u5728\u200bgetTask()\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200bnull\uff0c\n            // \u200b\u6267\u884c\u200b processWorkerExit \u200b\u9000\u51fa\u200b\u903b\u8f91\u200b\u65f6\u4f1a\u200b\u518d\u6b21\u200b\u8c03\u7528\u200b tryTerminate() \u200b\u5524\u9192\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u7ebf\u7a0b\u200b\n            interruptIdleWorkers(ONLY_ONE);\n            return;\n        }\n      // \u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u4e3a\u200b 0 \u200b\u6765\u5230\u200b\u8fd9\u91cc\u200b\n        final ReentrantLock mainLock = this.mainLock;\n        // \u200b\u52a0\u200b\u5168\u5c40\u200b\u9501\u200b\n        mainLock.lock();\n        try {\n            // \u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200b TIDYING \u200b\u72b6\u6001\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u4e3a\u200b 0\n            if (ctl.compareAndSet(c, ctlOf(TIDYING, 0))) {\n                try {\n                    // \u200b\u7ed3\u675f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\n                    terminated();\n                } finally {\n                    // \u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200bTERMINATED\u200b\u72b6\u6001\u200b\u3002\n                    ctl.set(ctlOf(TERMINATED, 0));\n                    // \u3010\u200b\u5524\u9192\u200b\u6240\u6709\u200b\u8c03\u7528\u200b awaitTermination() \u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u3011\n                    termination.signalAll();\n                }\n                return;\n            }\n        } finally {\n          // \u200b\u91ca\u653e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5168\u5c40\u200b\u9501\u200b\n            mainLock.unlock();\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#future","title":"Future","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_131","title":"\u7ebf\u7a0b\u200b\u4f7f\u7528","text":"<p>FutureTask \u200b\u672a\u6765\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7ee7\u627f\u200b Runnable\u3001Future \u200b\u63a5\u53e3\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5305\u88c5\u200b Callable \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4efb\u52a1\u200b\u7684\u200b\u63d0\u4ea4\u200b</p> Java<pre><code>public static void main(String[] args) throws ExecutionException, InterruptedException {\n    FutureTask&lt;String&gt; task = new FutureTask&lt;&gt;(new Callable&lt;String&gt;() {\n        @Override\n        public String call() throws Exception {\n            return \"Hello World\";\n        }\n    });\n    new Thread(task).start();   //\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\n    String msg = task.get();    //\u200b\u83b7\u53d6\u200b\u8fd4\u56de\u200b\u4efb\u52a1\u200b\u6570\u636e\u200b\n    System.out.println(msg);\n}\n</code></pre> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>public FutureTask(Callable&lt;V&gt; callable){\n    this.callable = callable;   // \u200b\u5c5e\u6027\u200b\u6ce8\u5165\u200b\n    this.state = NEW;           // \u200b\u4efb\u52a1\u200b\u72b6\u6001\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b new\n}\n</code></pre> Java<pre><code>public FutureTask(Runnable runnable, V result) {\n    // \u200b\u9002\u914d\u5668\u200b\u6a21\u5f0f\u200b\n    this.callable = Executors.callable(runnable, result);\n    this.state = NEW;       \n}\npublic static &lt;T&gt; Callable&lt;T&gt; callable(Runnable task, T result) {\n    if (task == null) throw new NullPointerException();\n    // \u200b\u4f7f\u7528\u200b\u88c5\u9970\u200b\u8005\u200b\u6a21\u5f0f\u200b\u5c06\u200b runnable \u200b\u8f6c\u6362\u6210\u200b callable \u200b\u63a5\u53e3\u200b\uff0c\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b get \u200b\u83b7\u53d6\u200b\n    // \u200b\u5f53\u524d\u4efb\u52a1\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u65f6\u200b\uff0c\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u4e3a\u200b null \u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4e3a\u200b\u4f20\u200b\u8fdb\u6765\u200b\u7684\u200b\u503c\u200b\uff0c\u3010\u200b\u4f20\u200b\u8fdb\u6765\u200b\u4ec0\u4e48\u200b\u8fd4\u56de\u200b\u4ec0\u4e48\u200b\u3011\n    return new RunnableAdapter&lt;T&gt;(task, result);\n}\nstatic final class RunnableAdapter&lt;T&gt; implements Callable&lt;T&gt; {\n    final Runnable task;\n    final T result;\n    // \u200b\u6784\u9020\u65b9\u6cd5\u200b\n    RunnableAdapter(Runnable task, T result) {\n        this.task = task;\n        this.result = result;\n    }\n    public T call() {\n        // \u200b\u5b9e\u5219\u200b\u8c03\u7528\u200b Runnable#run \u200b\u65b9\u6cd5\u200b\n        task.run();\n        // \u200b\u8fd4\u56de\u503c\u200b\u4e3a\u200b\u6784\u9020\u200b FutureTask \u200b\u5bf9\u8c61\u200b\u65f6\u200b\u4f20\u5165\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\u6216\u8005\u200b\u662f\u200b null\n        return result;\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_132","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"<p>FutureTask \u200b\u7c7b\u200b\u7684\u200b\u6210\u5458\u200b\u5c5e\u6027\u200b\uff1a</p> <ul> <li>\u200b\u4efb\u52a1\u200b\u72b6\u6001\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u8868\u793a\u200b\u5f53\u524d\u200btask\u200b\u72b6\u6001\u200b\nprivate volatile int state;\n// \u200b\u5f53\u524d\u4efb\u52a1\u200b\u5c1a\u672a\u200b\u6267\u884c\u200b\nprivate static final int NEW          = 0;\n// \u200b\u5f53\u524d\u4efb\u52a1\u200b\u6b63\u5728\u200b\u7ed3\u675f\u200b\uff0c\u200b\u5c1a\u672a\u200b\u5b8c\u5168\u200b\u7ed3\u675f\u200b\uff0c\u200b\u4e00\u79cd\u200b\u4e34\u754c\u72b6\u6001\u200b\nprivate static final int COMPLETING   = 1;\n// \u200b\u5f53\u524d\u4efb\u52a1\u200b\u6b63\u5e38\u200b\u7ed3\u675f\u200b\nprivate static final int NORMAL       = 2;\n// \u200b\u5f53\u524d\u4efb\u52a1\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u53d1\u751f\u200b\u4e86\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5185\u90e8\u200b\u5c01\u88c5\u200b\u7684\u200b callable.run() \u200b\u5411\u4e0a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u4e86\u200b\nprivate static final int EXCEPTIONAL  = 3;\n// \u200b\u5f53\u524d\u4efb\u52a1\u200b\u88ab\u200b\u53d6\u6d88\u200b\nprivate static final int CANCELLED    = 4;\n// \u200b\u5f53\u524d\u4efb\u52a1\u200b\u4e2d\u65ad\u200b\u4e2d\u200b\nprivate static final int INTERRUPTING = 5;\n// \u200b\u5f53\u524d\u4efb\u52a1\u200b\u5df2\u200b\u4e2d\u65ad\u200b\nprivate static final int INTERRUPTED  = 6;\n</code></pre> <ul> <li>\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff1a</li> </ul> Java<pre><code>private Callable&lt;V&gt; callable; // Runnable \u200b\u4f7f\u7528\u200b\u88c5\u9970\u200b\u8005\u200b\u6a21\u5f0f\u200b\u4f2a\u88c5\u6210\u200b Callable\n</code></pre> <ul> <li>\u200b\u5b58\u50a8\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u8fd9\u662f\u200b run \u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u503c\u200b\u662f\u200b void \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u7684\u200b\u539f\u56e0\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff1a\u200b\u4efb\u52a1\u200b\u6b63\u5e38\u200b\u6267\u884c\u200b\u7ed3\u675f\u200b\uff0coutcome \u200b\u4fdd\u5b58\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\uff0ccallable \u200b\u8fd4\u56de\u503c\u200b\n// \u200b\u975e\u6b63\u5e38\u200b\u60c5\u51b5\u200b\uff1acallable \u200b\u5411\u4e0a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\uff0coutcome \u200b\u4fdd\u5b58\u200b\u5f02\u5e38\u200b\nprivate Object outcome; \n</code></pre> <ul> <li>\u200b\u6267\u884c\u200b\u5f53\u524d\u4efb\u52a1\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\uff1a</li> </ul> Java<pre><code>private volatile Thread runner;   // \u200b\u5f53\u524d\u4efb\u52a1\u200b\u88ab\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u671f\u95f4\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5f53\u524d\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\n</code></pre> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u4f1a\u200b\u6709\u200b\u5f88\u200b\u591a\u7ebf\u7a0b\u200b\u53bb\u200b get \u200b\u5f53\u524d\u4efb\u52a1\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4f7f\u7528\u200b\u4e86\u200b\u4e00\u79cd\u200b\u6570\u636e\u7ed3\u6784\u200b\u5934\u200b\u63d2\u5934\u200b\u53d6\u200b\uff08\u200b\u7c7b\u4f3c\u200b\u6808\u200b\uff09\u200b\u7684\u200b\u4e00\u4e2a\u200b\u961f\u5217\u200b\u6765\u200b\u4fdd\u5b58\u200b\u6240\u6709\u200b\u7684\u200b get \u200b\u7ebf\u7a0b\u200b\nprivate volatile WaitNode waiters;\n</code></pre> <ul> <li>\u200b\u5185\u90e8\u200b\u7c7b\u200b\uff1a</li> </ul> Java<pre><code>static final class WaitNode {\n    // \u200b\u5355\u5411\u200b\u94fe\u8868\u200b\n    volatile Thread thread;\n    volatile WaitNode next;\n    WaitNode() { thread = Thread.currentThread(); }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_133","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"<p>FutureTask \u200b\u7c7b\u200b\u7684\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>FutureTask#run\uff1a\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5165\u53e3\u200b</li> </ul> Java<pre><code>public void run() {\n    //\u200b\u6761\u4ef6\u200b\u4e00\u200b\uff1a\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b task \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u6267\u884c\u200b\u8fc7\u200b\u4e86\u200b\u6216\u8005\u200b\u88ab\u200b cancel \u200b\u4e86\u200b\uff0c\u200b\u975e\u200b NEW \u200b\u72b6\u6001\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u5904\u7406\u200b\u4e86\u200b\n    //\u200b\u6761\u4ef6\u200b\u4e8c\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u662f\u200b NEW \u200b\u72b6\u6001\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5931\u8d25\u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u62a2\u5360\u200b\u4e86\u200b\u8be5\u200b\u4efb\u52a1\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset, null, Thread.currentThread()))\n        return;\n    try {\n        // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u5f53\u524d\u200b task \u200b\u4e00\u5b9a\u200b\u662f\u200b NEW \u200b\u72b6\u6001\u200b\uff0c\u200b\u800c\u4e14\u200b\u3010\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u62a2\u5360\u200b task \u200b\u6210\u529f\u200b\u3011\n        Callable&lt;V&gt; c = callable;\n        // \u200b\u5224\u65ad\u200b\u4efb\u52a1\u200b\u662f\u5426\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u9632\u6b62\u200b\u7a7a\u200b\u6307\u9488\u200b\u5f02\u5e38\u200b\uff1b\u200b\u5224\u65ad\u200b state \u200b\u72b6\u6001\u200b\uff0c\u200b\u9632\u6b62\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u5728\u6b64\u671f\u95f4\u200b cancel \u200b\u6389\u200b\u5f53\u524d\u4efb\u52a1\u200b\n        // \u3010\u200b\u56e0\u4e3a\u200b task \u200b\u7684\u200b\u6267\u884c\u8005\u200b\u5df2\u7ecf\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u3011\n        if (c != null &amp;&amp; state == NEW) {\n            V result;\n            // true \u200b\u8868\u793a\u200b callable.run \u200b\u4ee3\u7801\u200b\u5757\u200b\u6267\u884c\u200b\u6210\u529f\u200b \u200b\u672a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n            // false \u200b\u8868\u793a\u200b callable.run \u200b\u4ee3\u7801\u200b\u5757\u200b\u6267\u884c\u200b\u5931\u8d25\u200b \u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n            boolean ran;\n            try {\n              // \u3010\u200b\u8c03\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u8d4b\u503c\u200b\u7ed9\u200b result\u3011\n                result = c.call();\n                // \u200b\u6ca1\u6709\u200b\u51fa\u73b0\u5f02\u5e38\u200b\n                ran = true;\n            } catch (Throwable ex) {\n                // \u200b\u51fa\u73b0\u5f02\u5e38\u200b\uff0c\u200b\u8fd4\u56de\u503c\u200b\u7f6e\u7a7a\u200b\uff0cran \u200b\u7f6e\u200b\u4e3a\u200b false\n                result = null;\n                ran = false;\n                // \u200b\u8bbe\u7f6e\u200b\u8fd4\u56de\u200b\u7684\u200b\u5f02\u5e38\u200b\n                setException(ex);\n            }\n            // \u200b\u4ee3\u7801\u200b\u5757\u200b\u6267\u884c\u200b\u6b63\u5e38\u200b\n            if (ran)\n                // \u200b\u8bbe\u7f6e\u200b\u8fd4\u56de\u200b\u7684\u200b\u7ed3\u679c\u200b\n                set(result);\n        }\n    } finally {\n        // \u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u53d6\u6d88\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f15\u7528\u200b\uff0chelp GC\n        runner = null;\n        int s = state;\n        // \u200b\u5224\u65ad\u200b\u4efb\u52a1\u200b\u662f\u4e0d\u662f\u200b\u88ab\u200b\u4e2d\u65ad\u200b\n        if (s &gt;= INTERRUPTING)\n            // \u200b\u6267\u884c\u200b\u4e2d\u65ad\u200b\u5904\u7406\u200b\u65b9\u6cd5\u200b\n            handlePossibleCancellationInterrupt(s);\n    }\n}\n</code></pre> <p>FutureTask#set\uff1a\u200b\u8bbe\u7f6e\u200b\u6b63\u5e38\u200b\u8fd4\u56de\u503c\u200b\uff0c\u200b\u9996\u5148\u200b\u5c06\u200b\u4efb\u52a1\u200b\u72b6\u6001\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b COMPLETING \u200b\u72b6\u6001\u200b\u4ee3\u8868\u200b\u5b8c\u6210\u200b\u4e2d\u200b\uff0c\u200b\u903b\u8f91\u200b\u6267\u884c\u200b\u5b8c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b NORMAL \u200b\u72b6\u6001\u200b\u4ee3\u8868\u200b\u4efb\u52a1\u200b\u6b63\u5e38\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6700\u540e\u200b\u5524\u9192\u200b get() \u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b</p> Java<pre><code>protected void set(V v) {\n    // CAS \u200b\u65b9\u5f0f\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u4efb\u52a1\u200b\u72b6\u6001\u200b\u4e3a\u200b\u5b8c\u6210\u200b\u4e2d\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5931\u8d25\u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u53d6\u6d88\u200b\u4e86\u200b\u8be5\u200b\u4efb\u52a1\u200b\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        // \u3010\u200b\u5c06\u200b\u7ed3\u679c\u200b\u8d4b\u503c\u200b\u7ed9\u200b outcome\u3011\n        outcome = v;\n        // \u200b\u5c06\u200b\u5f53\u524d\u4efb\u52a1\u200b\u72b6\u6001\u200b\u4fee\u6539\u200b\u4e3a\u200b NORMAL \u200b\u6b63\u5e38\u200b\u7ed3\u675f\u200b\u72b6\u6001\u200b\u3002\n        UNSAFE.putOrderedInt(this, stateOffset, NORMAL);\n        finishCompletion();\n    }\n}\n</code></pre> <p>FutureTask#setException\uff1a\u200b\u8bbe\u7f6e\u200b\u5f02\u5e38\u200b\u8fd4\u56de\u503c\u200b</p> Java<pre><code>protected void setException(Throwable t) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        // \u200b\u8d4b\u503c\u200b\u7ed9\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\uff0c\u200b\u7528\u6765\u200b\u5411\u200b\u4e0a\u5c42\u200b\u629b\u51fa\u6765\u200b\u7684\u200b\u5f02\u5e38\u200b\n        outcome = t;\n        // \u200b\u5c06\u200b\u5f53\u524d\u4efb\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b \u200b\u4fee\u6539\u200b\u4e3a\u200b EXCEPTIONAL\n        UNSAFE.putOrderedInt(this, stateOffset, EXCEPTIONAL);\n        finishCompletion();\n    }\n}\n</code></pre> <p>FutureTask#finishCompletion\uff1a\u200b\u5524\u9192\u200b get() \u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b</p> Java<pre><code>private void finishCompletion() {\n    // \u200b\u904d\u5386\u200b\u6240\u6709\u200b\u7684\u200b\u7b49\u5f85\u200b\u7684\u200b\u8282\u70b9\u200b\uff0cq \u200b\u6307\u5411\u200b\u5934\u200b\u8282\u70b9\u200b\n    for (WaitNode q; (q = waiters) != null;) {\n        // \u200b\u4f7f\u7528\u200bcas\u200b\u8bbe\u7f6e\u200b waiters \u200b\u4e3a\u200b null\uff0c\u200b\u9632\u6b62\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200bcancel\u200b\u53d6\u6d88\u200b\u5f53\u524d\u4efb\u52a1\u200b\uff0c\u200b\u89e6\u53d1\u200bfinishCompletion\u200b\u65b9\u6cd5\u200b\u91cd\u590d\u200b\u6267\u884c\u200b\n        if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) {\n            // \u200b\u81ea\u65cb\u200b\n            for (;;) {\n                // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b WaitNode \u200b\u8282\u70b9\u200b\u5c01\u88c5\u200b\u7684\u200b thread\n                Thread t = q.thread;\n                // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u4e3a\u200b null\uff0c\u200b\u5524\u9192\u200b\u5f53\u524d\u200b get() \u200b\u7b49\u5f85\u200b\u83b7\u53d6\u6570\u636e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n                if (t != null) {\n                    q.thread = null;\n                    LockSupport.unpark(t);\n                }\n                // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n                WaitNode next = q.next;\n                // \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u4e86\u200b\n                if (next == null)\n                    break;\n                // \u200b\u65ad\u5f00\u200b\u94fe\u8868\u200b\n                q.next = null; // help gc\n                q = next;\n            }\n            break;\n        }\n    }\n    done();\n    callable = null;  // help GC\n}\n</code></pre> <p>FutureTask#handlePossibleCancellationInterrupt\uff1a\u200b\u4efb\u52a1\u200b\u4e2d\u65ad\u200b\u5904\u7406\u200b</p> Java<pre><code>private void handlePossibleCancellationInterrupt(int s) {\n    if (s == INTERRUPTING)\n        // \u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\u4e2d\u200b\n        while (state == INTERRUPTING)\n            // \u200b\u7b49\u5f85\u200b\u4e2d\u65ad\u200b\u5b8c\u6210\u200b\n            Thread.yield();\n}\n</code></pre> <ul> <li>FutureTask#get\uff1a\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\uff0c\u200b\u6267\u884c\u200b run \u200b\u548c\u200b get \u200b\u7684\u200b\u4e0d\u662f\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e00\u822c\u200b\u6709\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b get\uff0c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b run</li> </ul> Java<pre><code>public V get() throws InterruptedException, ExecutionException {\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u4efb\u52a1\u200b\u72b6\u6001\u200b\n    int s = state;\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u4efb\u52a1\u200b\u8fd8\u200b\u6ca1\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\n    if (s &lt;= COMPLETING)\n        // \u200b\u8fd4\u56de\u200b task \u200b\u5f53\u524d\u200b\u72b6\u6001\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u91cc\u9762\u200b\u5df2\u7ecf\u200b\u7761\u200b\u4e86\u200b\u4e00\u4f1a\u200b\n        s = awaitDone(false, 0L);\n    return report(s);\n}\n</code></pre> <p>FutureTask#awaitDone\uff1aget \u200b\u7ebf\u7a0b\u200b\u5c01\u88c5\u200b\u6210\u200b WaitNode \u200b\u5bf9\u8c61\u200b\u8fdb\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b</p> Java<pre><code>private int awaitDone(boolean timed, long nanos) throws InterruptedException {\n    // 0 \u200b\u4e0d\u5e26\u200b\u8d85\u65f6\u200b\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    // \u200b\u5f15\u7528\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5c01\u88c5\u200b\u6210\u200b WaitNode \u200b\u5bf9\u8c61\u200b\n    WaitNode q = null;\n    // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b waitNode \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u662f\u5426\u200b\u8fdb\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b\n    boolean queued = false;\n    // \u3010\u200b\u4e09\u6b21\u200b\u81ea\u65cb\u200b\u5f00\u59cb\u200b\u4f11\u7720\u200b\u3011\n    for (;;) {\n        // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b get() \u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u6253\u65ad\u200b\u8fd4\u56de\u200b true\uff0c\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\n        if (Thread.interrupted()) {\n            // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7b49\u5f85\u200b node \u200b\u51fa\u961f\u200b\uff0c\n            removeWaiter(q);\n            throw new InterruptedException();\n        }\n      // \u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u72b6\u6001\u200b\n        int s = state;\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ed3\u679c\u200b\u4e86\u200b\n        if (s &gt; COMPLETING) {\n            // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5df2\u7ecf\u200b\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b\u4e86\u200b WaitNode\uff0c\u200b\u7f6e\u7a7a\u200b help GC\n            if (q != null)\n                q.thread = null;\n            // \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7684\u200b\u72b6\u6001\u200b\n            return s;\n        }\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u4efb\u52a1\u200b\u63a5\u8fd1\u200b\u5b8c\u6210\u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8ba9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u91ca\u653e\u200b\u4e00\u4e0b\u200b cpu \uff0c\u200b\u7b49\u5f85\u200b\u8fdb\u884c\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u62a2\u5360\u200b cpu\n        else if (s == COMPLETING) \n            Thread.yield();\n        // \u3010\u200b\u7b2c\u4e00\u6b21\u200b\u81ea\u65cb\u200b\u3011\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8fd8\u200b\u672a\u200b\u521b\u5efa\u200b WaitNode \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b WaitNode\u200b\u5bf9\u8c61\u200b\n        else if (q == null)\n            q = new WaitNode();\n        // \u3010\u200b\u7b2c\u4e8c\u6b21\u200b\u81ea\u65cb\u200b\u3011\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u521b\u5efa\u200b WaitNode \u200b\u5bf9\u8c61\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200bnode\u200b\u5bf9\u8c61\u200b\u8fd8\u200b\u672a\u200b\u5165\u961f\u200b\n        else if (!queued)\n            // waiters \u200b\u6307\u5411\u200b\u961f\u9996\u200b\uff0c\u200b\u8ba9\u200b\u5f53\u524d\u200b WaitNode \u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b\u961f\u9996\u200b\uff0c\u3010\u200b\u5934\u200b\u63d2\u6cd5\u200b\u3011\uff0c\u200b\u5931\u8d25\u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u961f\u9996\u200b\n            queued = UNSAFE.compareAndSwapObject(this, waitersOffset, q.next = waiters, q);\n        // \u3010\u200b\u7b2c\u4e09\u6b21\u200b\u81ea\u65cb\u200b\u3011\uff0c\u200b\u4f1a\u5230\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u6216\u8005\u200b else \u200b\u5185\u200b\n        else if (timed) {\n            nanos = deadline - System.nanoTime();\n            if (nanos &lt;= 0L) {\n                removeWaiter(q);\n                return state;\n            }\n            // \u200b\u963b\u585e\u200b\u6307\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u200b\n            LockSupport.parkNanos(this, nanos);\n        }\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\uff1a\u200b\u8bf4\u660e\u200b\u9700\u8981\u200b\u963b\u585e\u200b\n        else\n            // \u3010\u200b\u5f53\u524d\u200b get \u200b\u64cd\u4f5c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u88ab\u200b park \u200b\u963b\u585e\u200b\u3011\uff0c\u200b\u9664\u975e\u200b\u6709\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u5524\u9192\u200b\u6216\u8005\u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e2d\u65ad\u200b\n            LockSupport.park(this);\n    }\n}\n</code></pre> <p>FutureTask#report\uff1a\u200b\u5c01\u88c5\u200b\u8fd0\u884c\u200b\u7ed3\u679c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b run() \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b outcome\uff0c\u200b\u8fd9\u662f\u200b run \u200b\u65b9\u6cd5\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\u662f\u200b void \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b\u7684\u200b\u539f\u56e0\u200b</p> Java<pre><code>private V report(int s) throws ExecutionException {\n    // \u200b\u83b7\u53d6\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u4e00\u4e2a\u200b futuretask \u200b\u5bf9\u8c61\u200b\u4e2d\u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\n    Object x = outcome;\n    // \u200b\u5f53\u524d\u4efb\u52a1\u200b\u72b6\u6001\u200b\u6b63\u5e38\u200b\u7ed3\u675f\u200b\n    if (s == NORMAL)\n        return (V)x;  // \u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b callable \u200b\u7684\u200b\u903b\u8f91\u200b\u7ed3\u679c\u200b\n    // \u200b\u5f53\u524d\u4efb\u52a1\u200b\u88ab\u200b\u53d6\u6d88\u200b\u6216\u8005\u200b\u4e2d\u65ad\u200b\n    if (s &gt;= CANCELLED)\n        throw new CancellationException();        // \u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n    // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u91cc\u200b\u8bf4\u660e\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b callable \u200b\u4e2d\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6709\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4f7f\u7528\u200b outcome \u200b\u4e0a\u5c42\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n    throw new ExecutionException((Throwable)x);   \n}\n</code></pre> <ul> <li>FutureTask#cancel\uff1a\u200b\u4efb\u52a1\u200b\u53d6\u6d88\u200b\uff0c\u200b\u6253\u65ad\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u8be5\u200b\u4efb\u52a1\u200b\u7684\u200b\u7ebf\u7a0b\u200b</li> </ul> Java<pre><code>public boolean cancel(boolean mayInterruptIfRunning) {\n    // \u200b\u6761\u4ef6\u200b\u4e00\u200b\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u4efb\u52a1\u200b\u5904\u4e8e\u200b\u8fd0\u884c\u200b\u4e2d\u200b\u6216\u8005\u200b\u5904\u4e8e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\u4e2d\u200b\n    // \u200b\u6761\u4ef6\u200b\u4e8c\u200b\uff1a\u200b\u8868\u793a\u200b\u4fee\u6539\u200b\u72b6\u6001\u200b\uff0c\u200b\u6210\u529f\u200b\u53ef\u4ee5\u200b\u53bb\u200b\u6267\u884c\u200b\u4e0b\u9762\u200b\u903b\u8f91\u200b\uff0c\u200b\u5426\u5219\u200b\u8fd4\u56de\u200b false \u200b\u8868\u793a\u200b cancel \u200b\u5931\u8d25\u200b\n    if (!(state == NEW &amp;&amp;\n          UNSAFE.compareAndSwapInt(this, stateOffset, NEW,\n                                   mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))\n        return false;\n    try {\n        // \u200b\u5982\u679c\u200b\u4efb\u52a1\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u6267\u884c\u200b\uff0c\u200b\u662f\u5426\u200b\u5141\u8bb8\u200b\u6253\u65ad\u200b\n        if (mayInterruptIfRunning) {\n            try {\n                // \u200b\u83b7\u53d6\u200b\u6267\u884c\u200b\u5f53\u524d\u200b FutureTask \u200b\u7684\u200b\u7ebf\u7a0b\u200b\n                Thread t = runner;\n                if (t != null)\n                    // \u200b\u6253\u65ad\u200b\u6267\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n                    t.interrupt();\n            } finally {\n                // \u200b\u8bbe\u7f6e\u200b\u4efb\u52a1\u200b\u72b6\u6001\u200b\u4e3a\u200b\u3010\u200b\u4e2d\u65ad\u200b\u5b8c\u6210\u200b\u3011\n                UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED);\n            }\n        }\n    } finally {\n        // \u200b\u5524\u9192\u200b\u6240\u6709\u200b get() \u200b\u963b\u585e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n        finishCompletion();\n    }\n    return true;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_134","title":"\u4efb\u52a1\u8c03\u5ea6","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#timer","title":"Timer","text":"<p>Timer \u200b\u5b9e\u73b0\u200b\u5b9a\u65f6\u200b\u529f\u80fd\u200b\uff0cTimer \u200b\u7684\u200b\u4f18\u70b9\u200b\u5728\u4e8e\u200b\u7b80\u5355\u200b\u6613\u7528\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u90fd\u200b\u662f\u200b\u7531\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u8c03\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u90fd\u200b\u662f\u200b\u4e32\u884c\u200b\u6267\u884c\u200b\u7684\u200b\uff0c\u200b\u540c\u4e00\u65f6\u95f4\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u5728\u200b\u6267\u884c\u200b\uff0c\u200b\u524d\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u6216\u200b\u5f02\u5e38\u200b\u90fd\u200b\u5c06\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u5230\u200b\u4e4b\u540e\u200b\u7684\u200b\u4efb\u52a1\u200b</p> Java<pre><code>private static void method1() {\n    Timer timer = new Timer();\n    TimerTask task1 = new TimerTask() {\n        @Override\n        public void run() {\n            System.out.println(\"task 1\");\n            //int i = 1 / 0;//\u200b\u4efb\u52a1\u200b\u4e00\u200b\u7684\u200b\u51fa\u9519\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4efb\u52a1\u200b\u4e8c\u200b\u65e0\u6cd5\u200b\u6267\u884c\u200b\n            Thread.sleep(2000);\n        }\n    };\n    TimerTask task2 = new TimerTask() {\n        @Override\n        public void run() {\n            System.out.println(\"task 2\");\n        }\n    };\n    // \u200b\u4f7f\u7528\u200b timer \u200b\u6dfb\u52a0\u200b\u4e24\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5e0c\u671b\u200b\u5b83\u4eec\u200b\u90fd\u200b\u5728\u200b 1s \u200b\u540e\u200b\u6267\u884c\u200b\n    // \u200b\u4f46\u200b\u7531\u4e8e\u200b timer \u200b\u5185\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4efb\u52a1\u200b1\u200b\u7684\u200b\u5ef6\u65f6\u200b\uff0c\u200b\u5f71\u54cd\u200b\u4e86\u200b\u4efb\u52a1\u200b2\u200b\u7684\u200b\u6267\u884c\u200b\n    timer.schedule(task1, 1000);//17:45:56 c.ThreadPool [Timer-0] - task 1\n    timer.schedule(task2, 1000);//17:45:58 c.ThreadPool [Timer-0] - task 2\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#scheduled","title":"Scheduled","text":"<p>\u200b\u4efb\u52a1\u8c03\u5ea6\u200b\u7ebf\u7a0b\u200b\u6c60\u200b ScheduledThreadPoolExecutor \u200b\u7ee7\u627f\u200b ThreadPoolExecutor\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b\u5185\u90e8\u200b\u7c7b\u200b ScheduledFutureTask \u200b\u5c01\u88c5\u200b\u4efb\u52a1\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u5185\u90e8\u200b\u7c7b\u200b DelayedWorkQueue \u200b\u4f5c\u4e3a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u961f\u5217\u200b</li> <li>\u200b\u91cd\u5199\u200b onShutdown \u200b\u65b9\u6cd5\u200b\u53bb\u200b\u5904\u7406\u200b shutdown \u200b\u540e\u200b\u7684\u200b\u4efb\u52a1\u200b</li> <li>\u200b\u63d0\u4f9b\u200b decorateTask \u200b\u65b9\u6cd5\u200b\u4f5c\u4e3a\u200b ScheduledFutureTask \u200b\u7684\u200b\u4fee\u9970\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5f00\u53d1\u8005\u200b\u8fdb\u884c\u200b\u6269\u5c55\u200b</li> </ul> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a<code>Executors.newScheduledThreadPool(int corePoolSize)</code></p> Java<pre><code>public ScheduledThreadPoolExecutor(int corePoolSize) {\n    // \u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u56fa\u5b9a\u200b\u4e3a\u200b Integer.MAX_VALUE\uff0c\u200b\u4fdd\u6d3b\u200b\u65f6\u95f4\u200b keepAliveTime \u200b\u56fa\u5b9a\u200b\u4e3a\u200b 0\n    super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,\n          // \u200b\u963b\u585e\u200b\u961f\u5217\u200b\u662f\u200b DelayedWorkQueue\n          new DelayedWorkQueue());\n}\n</code></pre> <p>\u200b\u5e38\u7528\u200b API\uff1a</p> <ul> <li><code>ScheduledFuture&lt;?&gt; schedule(Runnable/Callable&lt;V&gt;, long delay, TimeUnit u)</code>\uff1a\u200b\u5ef6\u8fdf\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b</li> <li><code>ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable/Callable&lt;V&gt;, long initialDelay, long period, TimeUnit unit)</code>\uff1a\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e0d\u200b\u8003\u8651\u200b\u6267\u884c\u200b\u7684\u200b\u8017\u65f6\u200b\uff0c\u200b\u53c2\u6570\u200b\u4e3a\u200b\u521d\u59cb\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u3001\u200b\u95f4\u9694\u65f6\u95f4\u200b\u3001\u200b\u5355\u4f4d\u200b</li> <li><code>ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable/Callable&lt;V&gt;, long initialDelay, long delay, TimeUnit unit)</code>\uff1a\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8003\u8651\u200b\u6267\u884c\u200b\u7684\u200b\u8017\u65f6\u200b\uff0c\u200b\u53c2\u6570\u200b\u4e3a\u200b\u521d\u59cb\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u3001\u200b\u95f4\u9694\u65f6\u95f4\u200b\u3001\u200b\u5355\u4f4d\u200b</li> </ul> <p>\u200b\u57fa\u672c\u200b\u4f7f\u7528\u200b\uff1a</p> <ul> <li>\u200b\u5ef6\u8fdf\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f46\u662f\u200b\u51fa\u73b0\u5f02\u5e38\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u5728\u200b\u63a7\u5236\u53f0\u200b\u6253\u5370\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b</li> </ul> Java<pre><code>public static void main(String[] args){\n    // \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5927\u5c0f\u200b\u4e3a\u200b1\u200b\u65f6\u200b\u4e5f\u200b\u662f\u200b\u4e32\u884c\u200b\u6267\u884c\u200b\n    ScheduledExecutorService executor = Executors.newScheduledThreadPool(2);\n    // \u200b\u6dfb\u52a0\u200b\u4e24\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u90fd\u200b\u5728\u200b 1s \u200b\u540e\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\n    executor.schedule(() -&gt; {\n      System.out.println(\"\u200b\u4efb\u52a1\u200b1\uff0c\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\uff1a\" + new Date());\n        //int i = 1 / 0;\n      try { Thread.sleep(2000); } catch (InterruptedException e) { }\n    }, 1000, TimeUnit.MILLISECONDS);\n\n    executor.schedule(() -&gt; {\n      System.out.println(\"\u200b\u4efb\u52a1\u200b2\uff0c\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\uff1a\" + new Date());\n    }, 1000, TimeUnit.MILLISECONDS);\n}\n</code></pre> <ul> <li>\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b scheduleAtFixedRate\uff1a\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u5230\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u4e4b\u95f4\u200b\u53ea\u8981\u200b\u5927\u4e8e\u200b\u7b49\u4e8e\u200b\u95f4\u9694\u65f6\u95f4\u200b\uff0c\u200b\u62a2\u5360\u200b\u5230\u200b CPU \u200b\u5c31\u200b\u4f1a\u200b\u7acb\u5373\u200b\u6267\u884c\u200b</li> </ul> Java<pre><code>public static void main(String[] args) {\n    ScheduledExecutorService pool = Executors.newScheduledThreadPool(1);\n    System.out.println(\"start...\" + new Date());\n\n    pool.scheduleAtFixedRate(() -&gt; {\n        System.out.println(\"running...\" + new Date());\n        Thread.sleep(2000);\n    }, 1, 1, TimeUnit.SECONDS);\n}\n\n/*start...Sat Apr 24 18:08:12 CST 2021\nrunning...Sat Apr 24 18:08:13 CST 2021\nrunning...Sat Apr 24 18:08:15 CST 2021\nrunning...Sat Apr 24 18:08:17 CST 2021\n</code></pre> <ul> <li>\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b scheduleWithFixedDelay\uff1a\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u7ed3\u675f\u200b\u5230\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u4e4b\u95f4\u200b\u7b49\u4e8e\u200b\u95f4\u9694\u65f6\u95f4\u200b\uff0c\u200b\u62a2\u5360\u200b\u5230\u200b CPU \u200b\u5c31\u200b\u4f1a\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u624d\u200b\u662f\u200b\u771f\u6b63\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u4e24\u4e2a\u200b\u4efb\u52a1\u200b\u4e4b\u95f4\u200b\u7684\u200b\u95f4\u9694\u200b</li> </ul> Java<pre><code>public static void main(String[] args){\n    ScheduledExecutorService pool = Executors.newScheduledThreadPool(3);\n    System.out.println(\"start...\" + new Date());\n\n    pool.scheduleWithFixedDelay(() -&gt; {\n        System.out.println(\"running...\" + new Date());\n        Thread.sleep(2000);\n    }, 1, 1, TimeUnit.SECONDS);\n}\n/*start...Sat Apr 24 18:11:41 CST 2021\nrunning...Sat Apr 24 18:11:42 CST 2021\nrunning...Sat Apr 24 18:11:45 CST 2021\nrunning...Sat Apr 24 18:11:48 CST 2021\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_135","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_136","title":"\u6210\u5458\u200b\u53d8\u91cf","text":"<ul> <li>shutdown \u200b\u540e\u200b\u662f\u5426\u200b\u7ee7\u7eed\u6267\u884c\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\uff1a</li> </ul> Java<pre><code>private volatile boolean continueExistingPeriodicTasksAfterShutdown;\n</code></pre> <ul> <li>shutdown \u200b\u540e\u200b\u662f\u5426\u200b\u7ee7\u7eed\u6267\u884c\u200b\u5ef6\u8fdf\u200b\u4efb\u52a1\u200b\uff1a</li> </ul> Java<pre><code>private volatile boolean executeExistingDelayedTasksAfterShutdown = true;\n</code></pre> <ul> <li>\u200b\u53d6\u6d88\u200b\u65b9\u6cd5\u200b\u662f\u5426\u200b\u5c06\u200b\u8be5\u200b\u4efb\u52a1\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u79fb\u9664\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u9ed8\u8ba4\u200b false\uff0c\u200b\u4e0d\u200b\u79fb\u9664\u200b\uff0c\u200b\u7b49\u5230\u200b\u7ebf\u7a0b\u200b\u62ff\u5230\u200b\u4efb\u52a1\u200b\u4e4b\u540e\u200b\u629b\u5f03\u200b\nprivate volatile boolean removeOnCancel = false;\n</code></pre> <ul> <li>\u200b\u4efb\u52a1\u200b\u7684\u200b\u5e8f\u5217\u53f7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u6bd4\u8f83\u200b\u4f18\u5148\u7ea7\u200b\uff1a</li> </ul> Java<pre><code>private static final AtomicLong sequencer = new AtomicLong();\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_137","title":"\u5ef6\u8fdf\u200b\u4efb\u52a1","text":"<p>ScheduledFutureTask \u200b\u7ee7\u627f\u200b FutureTask\uff0c\u200b\u5b9e\u73b0\u200b RunnableScheduledFuture \u200b\u63a5\u53e3\u200b\uff0c\u200b\u5177\u6709\u200b\u5ef6\u8fdf\u200b\u6267\u884c\u200b\u7684\u200b\u7279\u70b9\u200b\uff0c\u200b\u8986\u76d6\u200b FutureTask \u200b\u7684\u200b run \u200b\u65b9\u6cd5\u200b\u6765\u200b\u5b9e\u73b0\u200b\u5bf9\u200b\u5ef6\u65f6\u200b\u6267\u884c\u200b\u3001\u200b\u5468\u671f\u200b\u6267\u884c\u200b\u7684\u200b\u652f\u6301\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5ef6\u65f6\u200b\u4efb\u52a1\u200b\u8c03\u7528\u200b FutureTask#run\uff0c\u200b\u800c\u200b\u5bf9\u4e8e\u200b\u5468\u671f\u6027\u200b\u4efb\u52a1\u200b\u5219\u200b\u8c03\u7528\u200b FutureTask#runAndReset \u200b\u5e76\u4e14\u200b\u5728\u200b\u6210\u529f\u200b\u4e4b\u540e\u200b\u6839\u636e\u200b fixed-delay/fixed-rate \u200b\u6a21\u5f0f\u200b\u6765\u200b\u8bbe\u7f6e\u200b\u4e0b\u6b21\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u5e76\u200b\u91cd\u65b0\u200b\u5c06\u200b\u4efb\u52a1\u200b\u585e\u5230\u200b\u5de5\u4f5c\u200b\u961f\u5217\u200b</p> <p>\u200b\u5728\u200b\u8c03\u5ea6\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u65e0\u8bba\u662f\u200b runnable \u200b\u8fd8\u662f\u200b callable\uff0c\u200b\u65e0\u8bba\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u5ef6\u8fdf\u200b\u548c\u200b\u5b9a\u65f6\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u4efb\u52a1\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u5c01\u88c5\u200b\u6210\u200b ScheduledFutureTask</p> <p>\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u4efb\u52a1\u200b\u5e8f\u5217\u53f7\u200b\uff1a</li> </ul> Java<pre><code>private final long sequenceNumber;\n</code></pre> <ul> <li>\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\uff1a</li> </ul> Java<pre><code>private long time;            // \u200b\u4efb\u52a1\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ea4\u4ed8\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ee5\u200b\u7eb3\u79d2\u200b\u8868\u793a\u200b\nprivate final long period;    // 0 \u200b\u8868\u793a\u200b\u975e\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6b63\u6570\u200b\u8868\u793a\u200b fixed-rate \u200b\u6a21\u5f0f\u200b\u7684\u200b\u5468\u671f\u200b\uff0c\u200b\u8d1f\u6570\u200b\u8868\u793a\u200b fixed-delay \u200b\u6a21\u5f0f\u200b\n</code></pre> <p>fixed-rate\uff1a\u200b\u4e24\u6b21\u200b\u5f00\u59cb\u200b\u542f\u52a8\u200b\u7684\u200b\u95f4\u9694\u200b\uff0cfixed-delay\uff1a\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\u7ed3\u675f\u200b\u5230\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u5f00\u59cb\u200b\u542f\u52a8\u200b</p> <ul> <li>\u200b\u5b9e\u9645\u200b\u7684\u200b\u4efb\u52a1\u200b\u5bf9\u8c61\u200b\uff1a</li> </ul> Java<pre><code>RunnableScheduledFuture&lt;V&gt; outerTask = this;\n</code></pre> <ul> <li>\u200b\u4efb\u52a1\u200b\u5728\u200b\u961f\u5217\u200b\u6570\u7ec4\u200b\u4e2d\u200b\u7684\u200b\u7d22\u5f15\u200b\u4e0b\u6807\u200b\uff1a</li> </ul> Java<pre><code>// DelayedWorkQueue \u200b\u5e95\u5c42\u200b\u4f7f\u7528\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u662f\u200b\u6700\u5c0f\u200b\u5806\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u5f53\u524d\u4efb\u52a1\u200b\u5728\u200b\u5806\u200b\u4e2d\u200b\u7684\u200b\u7d22\u5f15\u200b\uff0c-1 \u200b\u4ee3\u8868\u200b\u5220\u9664\u200b\nint heapIndex;\n</code></pre> <p>\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>ScheduledFutureTask(Runnable r, V result, long ns, long period) {\n    super(r, result);\n    // \u200b\u4efb\u52a1\u200b\u7684\u200b\u89e6\u53d1\u200b\u65f6\u95f4\u200b\n    this.time = ns;\n    // \u200b\u4efb\u52a1\u200b\u7684\u200b\u5468\u671f\u200b\uff0c\u200b\u591a\u957f\u65f6\u95f4\u200b\u6267\u884c\u200b\u4e00\u6b21\u200b\n    this.period = period;\n    // \u200b\u4efb\u52a1\u200b\u7684\u200b\u5e8f\u53f7\u200b\n    this.sequenceNumber = sequencer.getAndIncrement();\n}\n</code></pre> <ul> <li>compareTo()\uff1aScheduledFutureTask \u200b\u6839\u636e\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b time \u200b\u6b63\u5e8f\u200b\u6392\u5217\u200b\uff0c\u200b\u5982\u679c\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u76f8\u540c\u200b\uff0c\u200b\u5728\u200b\u6309\u7167\u200b\u5e8f\u5217\u53f7\u200b sequenceNumber \u200b\u6b63\u5e8f\u200b\u6392\u5217\u200b\uff0c\u200b\u4efb\u52a1\u200b\u9700\u8981\u200b\u653e\u5165\u200b DelayedWorkQueue\uff0c\u200b\u5ef6\u8fdf\u200b\u961f\u5217\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u6309\u7167\u200b\u4ece\u5c0f\u5230\u5927\u200b\u8fdb\u884c\u200b\u6392\u5e8f\u200b</li> </ul> Java<pre><code>public int compareTo(Delayed other) {\n    if (other == this) // compare zero if same object\n        return 0;\n    if (other instanceof ScheduledFutureTask) {\n        // \u200b\u7c7b\u578b\u200b\u5f3a\u8f6c\u200b\n        ScheduledFutureTask&lt;?&gt; x = (ScheduledFutureTask&lt;?&gt;)other;\n        // \u200b\u6bd4\u8f83\u200b\u8005\u200b - \u200b\u88ab\u200b\u6bd4\u8f83\u200b\u8005\u200b\u7684\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\n        long diff = time - x.time;\n        // \u200b\u6bd4\u8f83\u200b\u8005\u200b\u5148\u200b\u6267\u884c\u200b\n        if (diff &lt; 0)\n            return -1;\n        // \u200b\u88ab\u200b\u6bd4\u8f83\u200b\u8005\u200b\u5148\u200b\u6267\u884c\u200b\n        else if (diff &gt; 0)\n            return 1;\n        // \u200b\u6bd4\u8f83\u200b\u8005\u200b\u7684\u200b\u5e8f\u5217\u53f7\u200b\u5c0f\u200b\n        else if (sequenceNumber &lt; x.sequenceNumber)\n            return -1;\n        else\n            return 1;\n    }\n    // \u200b\u4e0d\u662f\u200b ScheduledFutureTask \u200b\u7c7b\u578b\u200b\u65f6\u200b\uff0c\u200b\u6839\u636e\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u6392\u5e8f\u200b\n    long diff = getDelay(NANOSECONDS) - other.getDelay(NANOSECONDS);\n    return (diff &lt; 0) ? -1 : (diff &gt; 0) ? 1 : 0;\n}\n</code></pre> <ul> <li>run()\uff1a\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u975e\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u76f4\u63a5\u200b\u5b8c\u6210\u200b\u76f4\u63a5\u200b\u7ed3\u675f\u200b\uff0c\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7684\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\uff0c\u200b\u91cd\u65b0\u200b\u653e\u5165\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5c11\u4e8e\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u6dfb\u52a0\u200b Worker \u200b\u5f00\u542f\u200b\u65b0\u200b\u7ebf\u7a0b\u200b</li> </ul> Java<pre><code>public void run() {\n    // \u200b\u662f\u5426\u200b\u5468\u671f\u6027\u200b\uff0c\u200b\u5c31\u662f\u200b\u5224\u65ad\u200b period \u200b\u662f\u5426\u200b\u4e3a\u200b 0\n    boolean periodic = isPeriodic();\n    // \u200b\u6839\u636e\u200b\u662f\u5426\u662f\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200b\u72b6\u6001\u200b\u80fd\u5426\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u6267\u884c\u200b\u5c31\u200b\u53d6\u6d88\u200b\u4efb\u52a1\u200b\n    if (!canRunInCurrentRunState(periodic))\n        cancel(false);\n    // \u200b\u975e\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b FutureTask#run \u200b\u6267\u884c\u200b\n    else if (!periodic)\n        ScheduledFutureTask.super.run();\n    // \u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u8fd4\u56de\u200b true \u200b\u8868\u793a\u200b\u6267\u884c\u200b\u6210\u529f\u200b\n    else if (ScheduledFutureTask.super.runAndReset()) {\n        // \u200b\u8bbe\u7f6e\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u7684\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\n        setNextRunTime();\n        // \u200b\u4efb\u52a1\u200b\u7684\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\u5b89\u6392\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\uff0c\u200b\u52a0\u5165\u200b\u961f\u5217\u200b\uff0c\u200b\u5e76\u200b\u5f00\u542f\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\n        reExecutePeriodic(outerTask);\n    }\n}\n</code></pre> <p>\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u6b63\u5e38\u200b\u5b8c\u6210\u200b\u540e\u200b\u4efb\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b\u4e0d\u4f1a\u200b\u53d8\u5316\u200b\uff0c\u200b\u4f9d\u65e7\u200b\u662f\u200b NEW\uff0c\u200b\u4e0d\u4f1a\u200b\u8bbe\u7f6e\u200b outcome \u200b\u5c5e\u6027\u200b\u3002\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u672c\u6b21\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u51fa\u73b0\u5f02\u5e38\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u5165\u200b setException \u200b\u65b9\u6cd5\u200b\u5c06\u200b\u4efb\u52a1\u200b\u72b6\u6001\u200b\u7f6e\u200b\u4e3a\u200b\u5f02\u5e38\u200b\uff0c\u200b\u628a\u200b\u5f02\u5e38\u200b\u4fdd\u5b58\u200b\u5728\u200b outcome \u200b\u4e2d\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b false\uff0c\u200b\u540e\u7eed\u200b\u7684\u200b\u8be5\u200b\u4efb\u52a1\u200b\u5c06\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u5468\u671f\u200b\u7684\u200b\u6267\u884c\u200b</p> Java<pre><code>protected boolean runAndReset() {\n    // \u200b\u4efb\u52a1\u200b\u4e0d\u662f\u200b\u65b0\u5efa\u200b\u7684\u200b\u72b6\u6001\u200b\u4e86\u200b\uff0c\u200b\u6216\u8005\u200b\u88ab\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b false\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset, null, Thread.currentThread()))\n        return false;\n    boolean ran = false;\n    int s = state;\n    try {\n        Callable&lt;V&gt; c = callable;\n        if (c != null &amp;&amp; s == NEW) {\n            try {\n                // \u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6ca1\u6709\u200b\u8fd4\u56de\u503c\u200b\n                c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                // \u200b\u51fa\u73b0\u5f02\u5e38\u200b\uff0c\u200b\u628a\u200b\u4efb\u52a1\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5f02\u5e38\u200b\u72b6\u6001\u200b\uff0c\u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7684\u200b get \u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\n                setException(ex);\n            }\n        }\n    } finally {\n      // \u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\u628a\u200b\u6267\u884c\u200b\u7ebf\u7a0b\u200b\u5f15\u7528\u200b\u7f6e\u200b\u4e3a\u200b null\n        runner = null;\n        s = state;\n        // \u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u8fdb\u884c\u200b\u4e2d\u65ad\u200b\u5904\u7406\u200b\n        if (s &gt;= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n    // \u200b\u5982\u679c\u200b\u6b63\u5e38\u200b\u6267\u884c\u200b\uff0c\u200b\u8fd4\u56de\u200b true\uff0c\u200b\u5e76\u4e14\u200b\u4efb\u52a1\u200b\u72b6\u6001\u200b\u6ca1\u6709\u200b\u88ab\u200b\u53d6\u6d88\u200b\n    return ran &amp;&amp; s == NEW;\n}\n</code></pre> Java<pre><code>// \u200b\u4efb\u52a1\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7684\u200b\u89e6\u53d1\u200b\u65f6\u95f4\u200b\nprivate void setNextRunTime() {\n    long p = period;\n    if (p &gt; 0)\n        // fixed-rate \u200b\u6a21\u5f0f\u200b\uff0c\u3010\u200b\u65f6\u95f4\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u65f6\u95f4\u200b + p\u3011\uff0c\u200b\u4e24\u6b21\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u5dee\u200b\n        time += p;\n    else\n        // fixed-delay \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u662f\u200b\u3010\u200b\u5f53\u524d\u200b\u8fd9\u6b21\u200b\u4efb\u52a1\u200b\u7ed3\u675f\u200b\u7684\u200b\u65f6\u95f4\u200b\uff08\u200b\u5c31\u662f\u200b\u73b0\u5728\u200b\uff09 + delay \u200b\u503c\u200b\u3011\n        time = triggerTime(-p);\n}\n</code></pre> <ul> <li>reExecutePeriodic()\uff1a\u200b\u51c6\u5907\u200b\u4efb\u52a1\u200b\u7684\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\uff0c\u200b\u91cd\u65b0\u200b\u653e\u5165\u200b\u963b\u585e\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b</li> </ul> Java<pre><code>// ScheduledThreadPoolExecutor#reExecutePeriodic\nvoid reExecutePeriodic(RunnableScheduledFuture&lt;?&gt; task) {\n    if (canRunInCurrentRunState(true)) {\n        // \u3010\u200b\u653e\u5165\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\u3011\n        super.getQueue().add(task);\n        // \u200b\u5982\u679c\u200b\u63d0\u4ea4\u200b\u5b8c\u200b\u4efb\u52a1\u200b\u4e4b\u540e\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u53d8\u4e3a\u200b\u4e86\u200b shutdown \u200b\u72b6\u6001\u200b\uff0c\u200b\u9700\u8981\u200b\u518d\u6b21\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\uff0c\n        // \u200b\u5982\u679c\u200b\u4e0d\u80fd\u200b\u6267\u884c\u200b\u4e14\u200b\u4efb\u52a1\u200b\u8fd8\u200b\u5728\u200b\u961f\u5217\u200b\u4e2d\u672a\u200b\u88ab\u200b\u53d6\u200b\u8d70\u200b\uff0c\u200b\u5219\u200b\u53d6\u6d88\u200b\u4efb\u52a1\u200b\n        if (!canRunInCurrentRunState(true) &amp;&amp; remove(task))\n            task.cancel(false);\n        else\n            // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\uff0c\u200b\u52a0\u5165\u200b\u961f\u5217\u200b\uff0c\u200b\u5e76\u200b\u3010\u200b\u6839\u636e\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u662f\u5426\u200b\u5927\u4e8e\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u786e\u5b9a\u200b\u662f\u5426\u200b\u5f00\u542f\u200b\u65b0\u200b\u7ebf\u7a0b\u200b\u3011\n            ensurePrestart();\n    }\n}\n</code></pre> <ul> <li>cancel()\uff1a\u200b\u53d6\u6d88\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>public boolean cancel(boolean mayInterruptIfRunning) {\n    // \u200b\u8c03\u7528\u200b\u7236\u7c7b\u200b FutureTask#cancel \u200b\u6765\u200b\u53d6\u6d88\u200b\u4efb\u52a1\u200b\n    boolean cancelled = super.cancel(mayInterruptIfRunning);\n    // removeOnCancel \u200b\u7528\u4e8e\u200b\u63a7\u5236\u200b\u4efb\u52a1\u200b\u53d6\u6d88\u200b\u540e\u200b\u662f\u5426\u200b\u5e94\u8be5\u200b\u4ece\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u79fb\u9664\u200b\n    if (cancelled &amp;&amp; removeOnCancel &amp;&amp; heapIndex &gt;= 0)\n        // \u200b\u4ece\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u5220\u9664\u200b\u8be5\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5e76\u200b\u8c03\u7528\u200b tryTerminate() \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\n        remove(this);\n    return cancelled;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_138","title":"\u5ef6\u8fdf\u200b\u961f\u5217","text":"<p>DelayedWorkQueue \u200b\u662f\u200b\u652f\u6301\u200b\u5ef6\u65f6\u200b\u83b7\u53d6\u200b\u5143\u7d20\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u5185\u90e8\u200b\u91c7\u7528\u200b\u4f18\u5148\u200b\u961f\u5217\u200b PriorityQueue\uff08\u200b\u5c0f\u6839\u5806\u200b\u3001\u200b\u6ee1\u200b\u4e8c\u53c9\u6811\u200b\uff09\u200b\u5b58\u50a8\u200b\u5143\u7d20\u200b</p> <p>\u200b\u5176\u4ed6\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5b58\u50a8\u200b\u8282\u70b9\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u5927\u90fd\u200b\u662f\u200b\u94fe\u8868\u200b\uff0c\u200b\u5ef6\u8fdf\u200b\u961f\u5217\u200b\u662f\u200b\u6570\u7ec4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5ef6\u8fdf\u200b\u961f\u5217\u200b\u51fa\u961f\u200b\u5934\u200b\u5143\u7d20\u200b\u540e\u200b\u9700\u8981\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u5143\u7d20\u200b\uff08\u200b\u5c3e\u200b\uff09\u200b\u66ff\u6362\u200b\u5230\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u9632\u6b62\u200b\u7a7a\u200b\u6307\u9488\u200b\u5f02\u5e38\u200b</p> <p>\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li>\u200b\u5bb9\u91cf\u200b\uff1a</li> </ul> Java<pre><code>private static final int INITIAL_CAPACITY = 16;           // \u200b\u521d\u59cb\u200b\u5bb9\u91cf\u200b\nprivate int size = 0;                                 // \u200b\u8282\u70b9\u200b\u6570\u91cf\u200b\nprivate RunnableScheduledFuture&lt;?&gt;[] queue = \n    new RunnableScheduledFuture&lt;?&gt;[INITIAL_CAPACITY]; // \u200b\u5b58\u653e\u200b\u8282\u70b9\u200b\n</code></pre> <ul> <li>\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>private final ReentrantLock lock = new ReentrantLock();   // \u200b\u63a7\u5236\u200b\u5e76\u53d1\u200b\nprivate final Condition available = lock.newCondition();// \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\n</code></pre> <ul> <li>\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u5185\u200b\u7684\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u53bb\u200b take() \u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u5ef6\u8fdf\u200b\u961f\u5217\u200b\u9876\u5c42\u200b\u8282\u70b9\u200b\u4e0d\u200b\u4e3a\u200b null\uff08\u200b\u961f\u5217\u200b\u5185\u6709\u200b\u4efb\u52a1\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u8282\u70b9\u200b\u4efb\u52a1\u200b\u8fd8\u200b\u4e0d\u5230\u200b\u89e6\u53d1\u200b\u65f6\u95f4\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u53bb\u200b\u68c0\u67e5\u200b\u961f\u5217\u200b\u7684\u200b leader\u200b\u5b57\u200b\u6bb5\u200b\u662f\u5426\u200b\u88ab\u200b\u5360\u7528\u200b</li> <li>\u200b\u5982\u679c\u200b\u672a\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5360\u7528\u200b\u8be5\u5b57\u6bb5\u200b\uff0c\u200b\u7136\u540e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5230\u200b available \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u6307\u5b9a\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b <code>\u200b\u5806\u9876\u200b\u4efb\u52a1\u200b.time - now()</code> \u200b\u6302\u200b\u8d77\u200b</li> <li>\u200b\u5982\u679c\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u5230\u200b available \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u4e0d\u200b\u6307\u5b9a\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u7684\u200b\u6302\u200b\u8d77\u200b</li> </ul> Java<pre><code>// leader \u200b\u5728\u200b available \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u662f\u200b\u9996\u200b\u5143\u7d20\u200b\uff0c\u200b\u5b83\u200b\u8d85\u65f6\u200b\u4e4b\u540e\u200b\u4f1a\u200b\u9192\u8fc7\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u6b21\u200b\u5c06\u200b\u5806\u200b\u9876\u200b\u5143\u7d20\u200b\u83b7\u53d6\u200b\u8d70\u200b\uff0c\u200b\u83b7\u53d6\u200b\u8d70\u200b\u4e4b\u540e\u200b\uff0ctake()\u200b\u7ed3\u675f\u200b\u4e4b\u524d\u200b\uff0c\u200b\u4f1a\u200b\u8c03\u7528\u200b\u662f\u200b available.signal() \u200b\u5524\u9192\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u7684\u200b\u7b49\u5f85\u200b\u8005\u200b\uff0c\u200b\u7136\u540e\u200b\u91ca\u653e\u200b lock\uff0c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7b49\u5f85\u200b\u8005\u200b\u88ab\u200b\u5524\u9192\u200b\u540e\u200b\u53bb\u200b\u5230\u200b AQS \u200b\u961f\u5217\u200b\uff0c\u200b\u505a\u200b acquireQueue(node) \u200b\u903b\u8f91\u200b\nprivate Thread leader = null;\n</code></pre> <p>\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b</p> <ul> <li>offer()\uff1a\u200b\u63d2\u5165\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>public boolean offer(Runnable x) {\n    // \u200b\u5224\u7a7a\u200b\n    if (x == null)\n        throw new NullPointerException();\n    RunnableScheduledFuture&lt;?&gt; e = (RunnableScheduledFuture&lt;?&gt;)x;\n    // \u200b\u961f\u5217\u200b\u9501\u200b\uff0c\u200b\u589e\u52a0\u200b\u5220\u9664\u200b\u6570\u636e\u200b\u65f6\u200b\u90fd\u200b\u8981\u200b\u52a0\u9501\u200b\n    final ReentrantLock lock = this.lock;\n    lock.lock();\n    try {\n        int i = size;\n        // \u200b\u961f\u5217\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b\u5b58\u653e\u200b\u8282\u70b9\u200b\u7684\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u6269\u5bb9\u200b\n        if (i &gt;= queue.length)\n            // \u200b\u6269\u5bb9\u200b\u4e3a\u200b\u539f\u6765\u200b\u957f\u5ea6\u200b\u7684\u200b 1.5 \u200b\u500d\u200b\n            grow();\n        size = i + 1;\n        // \u200b\u5f53\u524d\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u8981\u200b\u63d2\u5165\u200b\u7684\u200b\u8282\u70b9\u200b\n        if (i == 0) {\n            queue[0] = e;\n            // \u200b\u4fee\u6539\u200b ScheduledFutureTask \u200b\u7684\u200b heapIndex \u200b\u5c5e\u6027\u200b\uff0c\u200b\u8868\u793a\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u5728\u200b\u961f\u5217\u200b\u91cc\u200b\u7684\u200b\u4e0b\u6807\u200b\n            setIndex(e, 0);\n        } else {\n            // \u200b\u5411\u4e0a\u200b\u8c03\u6574\u200b\u5143\u7d20\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5e76\u200b\u66f4\u65b0\u200b heapIndex \n            siftUp(i, e);\n        }\n        // \u200b\u60c5\u51b5\u200b1\uff1a\u200b\u5f53\u524d\u4efb\u52a1\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u52a0\u5165\u200b\u5230\u200b queue \u200b\u5185\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b\u5f53\u524d\u4efb\u52a1\u200b\u52a0\u5165\u200b\u5230\u200b queue \u200b\u4e4b\u524d\u200b\uff0ctake() \u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u76f4\u63a5\u200b\n        //        \u200b\u5230\u200b available \u200b\u961f\u5217\u200b\u4e0d\u200b\u8bbe\u7f6e\u200b\u8d85\u65f6\u200b\u7684\u200b\u6302\u200b\u8d77\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u53bb\u200b\u5360\u7528\u200b leader \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u9700\u4f1a\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b \u200b\u8ba9\u200b\u5b83\u200b\u53bb\u200b\u6d88\u8d39\u200b\n          // \u200b\u60c5\u51b5\u200b2\uff1a\u200b\u5f53\u524d\u4efb\u52a1\u200b\u3010\u200b\u4f18\u5148\u7ea7\u200b\u6700\u9ad8\u200b\u3011\uff0c\u200b\u539f\u5806\u200b\u9876\u200b\u4efb\u52a1\u200b\u53ef\u80fd\u200b\u8fd8\u200b\u672a\u200b\u5230\u200b\u89e6\u53d1\u200b\u65f6\u95f4\u200b\uff0cleader \u200b\u7ebf\u7a0b\u200b\u8bbe\u7f6e\u200b\u8d85\u65f6\u200b\u7684\u200b\u5728\u200b available \u200b\u6302\u200b\u8d77\u200b\n        //        \u200b\u539f\u5148\u200b\u7684\u200b leader \u200b\u7b49\u5f85\u200b\u7684\u200b\u662f\u200b\u539f\u5148\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u6240\u4ee5\u200b leader \u200b\u5df2\u7ecf\u200b\u65e0\u6548\u200b\uff0c\u200b\u9700\u8981\u200b\u5c06\u200b leader \u200b\u7ebf\u7a0b\u200b\u5524\u9192\u200b\uff0c\n        //        \u200b\u5524\u9192\u200b\u4e4b\u540e\u200b\u5b83\u4f1a\u200b\u68c0\u67e5\u200b\u5806\u9876\u200b\uff0c\u200b\u5982\u679c\u200b\u5806\u9876\u200b\u4efb\u52a1\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u6d88\u8d39\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\u8d70\u200b\uff0c\u200b\u5426\u5219\u200b\u7ee7\u7eed\u200b\u6210\u4e3a\u200b leader \u200b\u7b49\u5f85\u200b\u65b0\u5806\u200b\u9876\u200b\u4efb\u52a1\u200b\n        if (queue[0] == e) {\n            // \u200b\u5c06\u200b leader \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b null\n            leader = null;\n            // \u200b\u76f4\u63a5\u200b\u968f\u4fbf\u200b\u5524\u9192\u200b\u7b49\u5f85\u200b\u5934\u200b\u7ed3\u70b9\u200b\u7684\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\n            available.signal();\n        }\n    } finally {\n        lock.unlock();\n    }\n    return true;\n}\n</code></pre> Java<pre><code>// \u200b\u63d2\u5165\u200b\u65b0\u200b\u8282\u70b9\u200b\u540e\u200b\u5bf9\u200b\u5806\u200b\u8fdb\u884c\u200b\u8c03\u6574\u200b\uff0c\u200b\u8fdb\u884c\u200b\u8282\u70b9\u200b\u4e0a\u79fb\u200b\uff0c\u200b\u4fdd\u6301\u200b\u5176\u200b\u7279\u6027\u200b\u3010\u200b\u8282\u70b9\u200b\u7684\u200b\u503c\u200b\u5c0f\u4e8e\u200b\u5b50\u200b\u8282\u70b9\u200b\u7684\u200b\u503c\u200b\u3011\uff0c\u200b\u5c0f\u9876\u200b\u5806\u200b\nprivate void siftUp(int k, RunnableScheduledFuture&lt;?&gt; key) {\n    while (k &gt; 0) {\n        // \u200b\u7236\u200b\u8282\u70b9\u200b\uff0c\u200b\u5c31\u662f\u200b\u5806\u6392\u5e8f\u200b\n        int parent = (k - 1) &gt;&gt;&gt; 1;\n        RunnableScheduledFuture&lt;?&gt; e = queue[parent];\n        // key \u200b\u548c\u200b\u7236\u200b\u8282\u70b9\u200b\u6bd4\u200b\uff0c\u200b\u5982\u679c\u200b\u5927\u4e8e\u200b\u7236\u200b\u8282\u70b9\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5426\u5219\u200b\u5c31\u200b\u7ee7\u7eed\u200b\u4e0a\u6d6e\u200b\n        if (key.compareTo(e) &gt;= 0)\n            break;\n        queue[k] = e;\n        setIndex(e, k);\n        k = parent;\n    }\n    queue[k] = key;\n    setIndex(key, k);\n}\n</code></pre> <ul> <li>poll()\uff1a\u200b\u975e\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u83b7\u53d6\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u6700\u8fd1\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u7684\u200b</li> </ul> Java<pre><code>// \u200b\u975e\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\npublic RunnableScheduledFuture&lt;?&gt; poll() {\n    final ReentrantLock lock = this.lock;\n    lock.lock();\n    try {\n        // \u200b\u83b7\u53d6\u200b\u961f\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u662f\u200b\u5c0f\u9876\u200b\u5806\u200b\n        RunnableScheduledFuture&lt;?&gt; first = queue[0];\n        // \u200b\u5934\u200b\u7ed3\u70b9\u200b\u4e3a\u7a7a\u200b\u6216\u8005\u200b\u7684\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u6ca1\u200b\u5230\u200b\u8fd4\u56de\u200b null\n        if (first == null || first.getDelay(NANOSECONDS) &gt; 0)\n            return null;\n        else\n            // \u200b\u5934\u200b\u7ed3\u70b9\u200b\u8fbe\u5230\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\uff0c\u3010\u200b\u5c3e\u200b\u8282\u70b9\u200b\u6210\u4e3a\u200b\u66ff\u4ee3\u200b\u8282\u70b9\u200b\u4e0b\u79fb\u200b\u8c03\u6574\u200b\u5806\u200b\u7ed3\u6784\u200b\u3011\uff0c\u200b\u8fd4\u56de\u200b\u5934\u200b\u7ed3\u70b9\u200b\n            return finishPoll(first);\n    } finally {\n        lock.unlock();\n    }\n}\n</code></pre> Java<pre><code>private RunnableScheduledFuture&lt;?&gt; finishPoll(RunnableScheduledFuture&lt;?&gt; f) {\n    // \u200b\u83b7\u53d6\u200b\u5c3e\u200b\u7d22\u5f15\u200b\n    int s = --size;\n    // \u200b\u83b7\u53d6\u200b\u5c3e\u200b\u8282\u70b9\u200b\n    RunnableScheduledFuture&lt;?&gt; x = queue[s];\n    // \u200b\u5c06\u200b\u5806\u200b\u7ed3\u6784\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u5360\u7528\u200b\u7684\u200b slot \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b null\uff0c\u200b\u56e0\u4e3a\u200b\u8be5\u200b\u8282\u70b9\u200b\u8981\u200b\u5c1d\u8bd5\u200b\u5347\u7ea7\u200b\u6210\u5806\u200b\u9876\u200b\uff0c\u200b\u4f1a\u200b\u6839\u636e\u200b\u7279\u6027\u200b\u4e0b\u8c03\u200b\n    queue[s] = null;\n    // s == 0 \u200b\u8bf4\u660e\u200b \u200b\u5f53\u524d\u200b\u5806\u200b\u7ed3\u6784\u200b\u53ea\u6709\u200b\u5806\u9876\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e0d\u200b\u9700\u8981\u200b\u505a\u200b\u4efb\u4f55\u200b\u7684\u200b\u4e8b\u60c5\u200b\n    if (s != 0)\n        // \u200b\u4ece\u200b\u7d22\u5f15\u200b\u5904\u200b 0 \u200b\u5f00\u59cb\u200b\u5411\u4e0b\u200b\u8c03\u6574\u200b\n        siftDown(0, x);\n    // \u200b\u51fa\u961f\u200b\u7684\u200b\u5143\u7d20\u200b\u7d22\u5f15\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b -1\n    setIndex(f, -1);\n    return f;\n}\n</code></pre> <ul> <li>take()\uff1a\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b\u5806\u4e2d\u200b\u6700\u5c0f\u200b\u7684\u200b\u4e5f\u200b\u5c31\u662f\u200b\u89e6\u53d1\u200b\u65f6\u95f4\u200b\u6700\u8fd1\u200b\u7684\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>public RunnableScheduledFuture&lt;?&gt; take() throws InterruptedException {\n    final ReentrantLock lock = this.lock;\n    // \u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\n    lock.lockInterruptibly();\n    try {\n        for (;;) {\n            // \u200b\u5934\u200b\u8282\u70b9\u200b\n            RunnableScheduledFuture&lt;?&gt; first = queue[0];\n            if (first == null)\n                // \u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0d\u7a7a\u200b\uff0c\u200b\u76f4\u81f3\u200b\u6709\u200b\u4efb\u52a1\u200b\u901a\u8fc7\u200b offer \u200b\u5165\u961f\u200b\u5e76\u200b\u5524\u9192\u200b\n                available.await();\n            else {\n                // \u200b\u83b7\u53d6\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u662f\u5426\u200b\u5230\u200b\u65f6\u200b\n                long delay = first.getDelay(NANOSECONDS);\n                if (delay &lt;= 0)\n                    // \u200b\u5230\u8fbe\u200b\u89e6\u53d1\u200b\u65f6\u95f4\u200b\uff0c\u200b\u83b7\u53d6\u200b\u5934\u200b\u8282\u70b9\u200b\u5e76\u200b\u8c03\u6574\u200b\u5806\u200b\uff0c\u200b\u91cd\u65b0\u200b\u9009\u62e9\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u6700\u5c0f\u200b\u7684\u200b\u8282\u70b9\u200b\u653e\u5165\u200b\u5934\u90e8\u200b\n                    return finishPoll(first);\n\n                // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u8fd8\u200b\u6ca1\u5230\u200b\n                first = null;\n                // \u200b\u8bf4\u660e\u200b\u6709\u200b leader \u200b\u7ebf\u7a0b\u200b\u5728\u200b\u7b49\u5f85\u200b\u83b7\u53d6\u200b\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u53bb\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\n                if (leader != null)\n                    available.await();\n                else {\n                    // \u200b\u6ca1\u6709\u200b leader \u200b\u7ebf\u7a0b\u200b\uff0c\u3010\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4f5c\u4e3a\u200bleader\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u5934\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u4f5c\u4e3a\u200b\u963b\u585e\u200b\u65f6\u95f4\u200b\u3011\n                    Thread thisThread = Thread.currentThread();\n                    leader = thisThread;\n                    try {\n                        // \u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b available \u200b\u4f7f\u7528\u200b\u5e26\u200b\u8d85\u65f6\u200b\u7684\u200b\u6302\u200b\u8d77\u200b\uff08\u200b\u5806\u9876\u200b\u4efb\u52a1\u200b.time - now() \u200b\u7eb3\u79d2\u200b\u503c\u200b..\uff09\n                        available.awaitNanos(delay);\n                        // \u200b\u5230\u8fbe\u200b\u963b\u585e\u200b\u65f6\u95f4\u200b\u65f6\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4ece\u200b\u8fd9\u91cc\u200b\u9192\u6765\u200b\u6765\u200b\n                    } finally {\n                        // t\u200b\u5806\u9876\u200b\u66f4\u65b0\u200b\uff0cleader \u200b\u7f6e\u200b\u4e3a\u200b null\uff0coffer \u200b\u65b9\u6cd5\u200b\u91ca\u653e\u200b\u9501\u540e\u200b\uff0c\n                        // \u200b\u6709\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b take/poll \u200b\u62ff\u5230\u200b\u9501\u200b,\u200b\u8bfb\u200b\u5230\u200b leader == null\uff0c\u200b\u7136\u540e\u200b\u5c06\u200b\u81ea\u8eab\u200b\u66f4\u65b0\u200b\u4e3a\u200bleader\u3002\n                        if (leader == thisThread)\n                            // leader \u200b\u7f6e\u200b\u4e3a\u200b null \u200b\u7528\u4ee5\u200b\u63a5\u4e0b\u6765\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\u7ebf\u7a0b\u200b\n                            leader = null;\n                    }\n                }\n            }\n        }\n    } finally {\n        // \u200b\u6ca1\u6709\u200b leader \u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5934\u200b\u7ed3\u70b9\u200b\u4e0d\u200b\u4e3a\u200b null\uff0c\u200b\u5524\u9192\u200b\u963b\u585e\u200b\u83b7\u53d6\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\n        // \u3010\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u8fd9\u200b\u4e00\u6b65\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6709\u200b\u4e86\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f46\u662f\u200b\u6ca1\u6709\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u6267\u884c\u200b\u3011\n        if (leader == null &amp;&amp; queue[0] != null)\n            available.signal();\n        lock.unlock();\n    }\n}\n</code></pre> <ul> <li>remove()\uff1a\u200b\u5220\u9664\u200b\u8282\u70b9\u200b\uff0c\u200b\u5806\u200b\u79fb\u9664\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b O(log n)\uff0c\u200b\u5ef6\u8fdf\u200b\u4efb\u52a1\u200b\u7ef4\u62a4\u200b\u4e86\u200b heapIndex\uff0c\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b O(1)\uff0c\u200b\u4ece\u800c\u200b\u53ef\u4ee5\u200b\u66f4\u5feb\u200b\u7684\u200b\u79fb\u9664\u200b\u5143\u7d20\u200b\uff0c\u200b\u4efb\u52a1\u200b\u5728\u200b\u961f\u5217\u200b\u4e2d\u200b\u88ab\u200b\u53d6\u6d88\u200b\u540e\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u8be5\u200b\u903b\u8f91\u200b</li> </ul> Java<pre><code>public boolean remove(Object x) {\n    final ReentrantLock lock = this.lock;\n    lock.lock();\n    try {\n        // \u200b\u67e5\u627e\u200b\u5bf9\u8c61\u200b\u5728\u200b\u961f\u5217\u200b\u6570\u7ec4\u200b\u4e2d\u200b\u7684\u200b\u4e0b\u6807\u200b\n        int i = indexOf(x);\n        // \u200b\u8282\u70b9\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u8fd4\u56de\u200b false\n        if (i &lt; 0)\n            return false;\n      // \u200b\u4fee\u6539\u200b\u5143\u7d20\u200b\u7684\u200b heapIndex\uff0c-1 \u200b\u4ee3\u8868\u200b\u5220\u9664\u200b\n        setIndex(queue[i], -1);\n        // \u200b\u5c3e\u200b\u7d22\u5f15\u200b\u662f\u200b\u957f\u5ea6\u200b-1\n        int s = --size;\n        // \u200b\u5c3e\u200b\u8282\u70b9\u200b\u4f5c\u4e3a\u200b\u66ff\u4ee3\u200b\u8282\u70b9\u200b\n        RunnableScheduledFuture&lt;?&gt; replacement = queue[s];\n        queue[s] = null;\n        // s == i \u200b\u8bf4\u660e\u200b\u5934\u200b\u8282\u70b9\u200b\u5c31\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u961f\u5217\u200b\u7a7a\u200b\u4e86\u200b\n        if (s != i) {\n            // \u200b\u5411\u4e0b\u200b\u8c03\u6574\u200b\n            siftDown(i, replacement);\n            // \u200b\u8bf4\u660e\u200b\u6ca1\u200b\u53d1\u751f\u200b\u8c03\u6574\u200b\n            if (queue[i] == replacement)\n                // \u200b\u4e0a\u79fb\u200b\u548c\u200b\u4e0b\u79fb\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u540c\u65f6\u200b\u53d1\u751f\u200b\uff0c\u200b\u66ff\u4ee3\u200b\u8282\u70b9\u200b\u5927\u4e8e\u200b\u5b50\u200b\u8282\u70b9\u200b\u65f6\u200b\u4e0b\u79fb\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0a\u79fb\u200b\n                siftUp(i, replacement);\n        }\n        return true;\n    } finally {\n        lock.unlock();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_139","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_140","title":"\u63d0\u4ea4\u200b\u4efb\u52a1","text":"<ul> <li>schedule()\uff1a\u200b\u5ef6\u8fdf\u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u6307\u5b9a\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b</li> </ul> Java<pre><code>public void execute(Runnable command) {\n    // \u200b\u4ee5\u200b\u96f6\u200b\u5ef6\u65f6\u200b\u4efb\u52a1\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5b9e\u73b0\u200b\n    schedule(command, 0, NANOSECONDS);\n}\n</code></pre> Java<pre><code>public ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay, TimeUnit unit) {\n    // \u200b\u5224\u7a7a\u200b\n    if (command == null || unit == null) throw new NullPointerException();\n    // \u200b\u6ca1\u6709\u200b\u505a\u200b\u4efb\u4f55\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5c06\u200b task \u200b\u8fd4\u56de\u200b\uff0c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e3b\u8981\u200b\u76ee\u7684\u200b\u662f\u200b\u7528\u4e8e\u200b\u5b50\u7c7b\u200b\u6269\u5c55\u200b\uff0c\u200b\u5e76\u4e14\u200b\u3010\u200b\u6839\u636e\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u8bbe\u7f6e\u200b\u4efb\u52a1\u200b\u89e6\u53d1\u200b\u7684\u200b\u65f6\u95f4\u200b\u70b9\u200b\u3011\n    RunnableScheduledFuture&lt;?&gt; t = decorateTask(command, new ScheduledFutureTask&lt;Void&gt;(\n                                                  command, null, triggerTime(delay, unit)));\n    // \u200b\u5ef6\u8fdf\u200b\u6267\u884c\u200b\n    delayedExecute(t);\n    return t;\n}\n</code></pre> Java<pre><code>// \u200b\u8fd4\u56de\u200b\u3010\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b + \u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u3011\uff0c\u200b\u5c31\u662f\u200b\u89e6\u53d1\u200b\u5f53\u524d\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\nprivate long triggerTime(long delay, TimeUnit unit) {\n    // \u200b\u8bbe\u7f6e\u200b\u89e6\u53d1\u200b\u7684\u200b\u65f6\u95f4\u200b\n    return triggerTime(unit.toNanos((delay &lt; 0) ? 0 : delay));\n}\nlong triggerTime(long delay) {\n    // \u200b\u5982\u679c\u200b delay &lt; Long.Max_VALUE/2\uff0c\u200b\u5219\u200b\u4e0b\u6b21\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u4e3a\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b +delay\n    // \u200b\u5426\u5219\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u961f\u5217\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u7531\u4e8e\u200b\u6ea2\u51fa\u200b\u5bfc\u81f4\u200b\u7684\u200b\u6392\u5e8f\u200b\u7d0a\u4e71\u200b,\u200b\u9700\u8981\u200b\u8c03\u7528\u200boverflowFree\u200b\u6765\u200b\u4fee\u6b63\u200b\u4e00\u4e0b\u200bdelay\n    return now() + ((delay &lt; (Long.MAX_VALUE &gt;&gt; 1)) ? delay : overflowFree(delay));\n}\n</code></pre> <p>overflowFree \u200b\u7684\u200b\u539f\u56e0\u200b\uff1a\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b delay \u200b\u4e3a\u200b\u8d1f\u6570\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\uff08\u200b\u5176\u5b9e\u200b\u65e9\u8be5\u200b\u6267\u884c\u200b\u4e86\u200b\uff09\u3002\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u7ef4\u62a4\u200b\u4efb\u52a1\u200b\u987a\u5e8f\u200b\u662f\u200b\u57fa\u4e8e\u200b compareTo \u200b\u6bd4\u8f83\u200b\u7684\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u4e24\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u987a\u5e8f\u200b\u4f1a\u200b\u7528\u200b time \u200b\u76f8\u51cf\u200b\u3002\u200b\u90a3\u4e48\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b delay \u200b\u4e3a\u200b\u6b63\u6570\u200b\u51cf\u53bb\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4e3a\u200b\u8d1f\u6570\u200b\u7684\u200b delay\uff0c\u200b\u7ed3\u679c\u200b\u4e0a\u6ea2\u200b\u4e3a\u200b\u8d1f\u6570\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u5bfc\u81f4\u200b compareTo \u200b\u4ea7\u751f\u200b\u9519\u8bef\u200b\u7684\u200b\u7ed3\u679c\u200b</p> Java<pre><code>private long overflowFree(long delay) {\n    Delayed head = (Delayed) super.getQueue().peek();\n    if (head != null) {\n        long headDelay = head.getDelay(NANOSECONDS);\n        // \u200b\u5224\u65ad\u200b\u4e00\u4e0b\u200b\u961f\u9996\u200b\u7684\u200bdelay\u200b\u662f\u4e0d\u662f\u200b\u8d1f\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u6b63\u6570\u200b\u5c31\u200b\u4e0d\u7528\u200b\u7ba1\u200b\uff0c\u200b\u600e\u4e48\u200b\u51cf\u90fd\u200b\u4e0d\u4f1a\u200b\u6ea2\u51fa\u200b\n        // \u200b\u5426\u5219\u200b\u62ff\u200b\u5f53\u524d\u200b delay \u200b\u51cf\u53bb\u200b\u961f\u9996\u200b\u7684\u200b delay \u200b\u6765\u200b\u6bd4\u8f83\u200b\u770b\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u4e0a\u6ea2\u200b\uff0c\u200b\u6392\u5e8f\u200b\u4e0d\u4f1a\u200b\u4e71\u200b\n      // \u200b\u4e0d\u7136\u200b\u5c31\u200b\u628a\u200b\u5f53\u524d\u200b delay \u200b\u503c\u200b\u7ed9\u200b\u8c03\u6574\u200b\u4e3a\u200b Long.MAX_VALUE + \u200b\u961f\u9996\u200b delay\n        if (headDelay &lt; 0 &amp;&amp; (delay - headDelay &lt; 0))\n            delay = Long.MAX_VALUE + headDelay;\n    }\n    return delay;\n}\n</code></pre> <ul> <li>scheduleAtFixedRate()\uff1a\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b\uff0c\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u5230\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u7684\u200b\u95f4\u9694\u200b</li> </ul> Java<pre><code>public ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, long initialDelay, long period,\n                                              TimeUnit unit) {\n    if (command == null || unit == null)\n        throw new NullPointerException();\n    if (period &lt;= 0)\n        throw new IllegalArgumentException();\n    // \u200b\u4efb\u52a1\u200b\u5c01\u88c5\u200b\uff0c\u3010\u200b\u6307\u5b9a\u200b\u521d\u59cb\u200b\u7684\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u548c\u200b\u5468\u671f\u65f6\u95f4\u200b\u3011\n    ScheduledFutureTask&lt;Void&gt; sft =new ScheduledFutureTask&lt;Void&gt;(command, null,\n                                      triggerTime(initialDelay, unit), unit.toNanos(period));\n    // \u200b\u9ed8\u8ba4\u200b\u8fd4\u56de\u200b\u672c\u8eab\u200b\n    RunnableScheduledFuture&lt;Void&gt; t = decorateTask(command, sft);\n    sft.outerTask = t;\n    // \u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\n    delayedExecute(t);\n    return t;\n}\n</code></pre> <ul> <li>scheduleWithFixedDelay()\uff1a\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b\uff0c\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u7ed3\u675f\u200b\u5230\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u4efb\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u7684\u200b\u95f4\u9694\u200b</li> </ul> Java<pre><code>public ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command, long initialDelay, long delay,\n                                                 TimeUnit unit) {\n    if (command == null || unit == null) \n        throw new NullPointerException();\n    if (delay &lt;= 0)\n        throw new IllegalArgumentException();\n    // \u200b\u4efb\u52a1\u200b\u5c01\u88c5\u200b\uff0c\u3010\u200b\u6307\u5b9a\u200b\u521d\u59cb\u200b\u7684\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u548c\u200b\u5468\u671f\u65f6\u95f4\u200b\u3011\uff0c\u200b\u5468\u671f\u65f6\u95f4\u200b\u4e3a\u200b - \u200b\u8868\u793a\u200b\u662f\u200b fixed-delay \u200b\u6a21\u5f0f\u200b\n    ScheduledFutureTask&lt;Void&gt; sft = new ScheduledFutureTask&lt;Void&gt;(command, null,\n                                      triggerTime(initialDelay, unit), unit.toNanos(-delay));\n    RunnableScheduledFuture&lt;Void&gt; t = decorateTask(command, sft);\n    sft.outerTask = t;\n    delayedExecute(t);\n    return t;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_141","title":"\u8fd0\u884c\u200b\u4efb\u52a1","text":"<ul> <li>delayedExecute()\uff1a\u200b\u6821\u9a8c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\uff0c\u200b\u5ef6\u8fdf\u200b\u6216\u200b\u5468\u671f\u6027\u200b\u4efb\u52a1\u200b\u7684\u200b\u4e3b\u8981\u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>private void delayedExecute(RunnableScheduledFuture&lt;?&gt; task) {\n    // \u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b SHUTDOWN \u200b\u72b6\u6001\u200b\uff0c\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\n    if (isShutdown())\n        reject(task);\n    else {\n        // \u200b\u628a\u200b\u5f53\u524d\u4efb\u52a1\u200b\u653e\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u9700\u8981\u200b\u3010\u200b\u83b7\u53d6\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u6700\u8fd1\u200b\u7684\u200b\u3011\uff0c\u200b\u5f53\u524d\u4efb\u52a1\u200b\u9700\u8981\u200b\u6bd4\u8f83\u200b\n        super.getQueue().add(task);\n        // \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u4e3a\u200b SHUTDOWN \u200b\u5e76\u4e14\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u961f\u5217\u200b\u5220\u9664\u200b\u8be5\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u4efb\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n        if (isShutdown() &amp;&amp; !canRunInCurrentRunState(task.isPeriodic()) &amp;&amp; remove(task))\n            task.cancel(false);\n        else\n            // \u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\n            ensurePrestart();\n    }\n}\n</code></pre> <ul> <li>ensurePrestart()\uff1a\u200b\u5f00\u542f\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>// ThreadPoolExecutor#ensurePrestart\nvoid ensurePrestart() {\n    int wc = workerCountOf(ctl.get());\n    // worker\u200b\u6570\u76ee\u200b\u5c0f\u4e8e\u200bcorePoolSize\uff0c\u200b\u5219\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200bworker\u3002\n    if (wc &lt; corePoolSize)\n        // \u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b true \u200b\u8868\u793a\u200b\u91c7\u7528\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u9650\u5236\u200b\uff0cfalse \u200b\u8868\u793a\u200b\u91c7\u7528\u200b maximumPoolSize\n        addWorker(null, true);\n    // corePoolSize = 0\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u81f3\u5c11\u200b\u5f00\u542f\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u3010\u200b\u62c5\u4fdd\u200b\u673a\u5236\u200b\u3011\n    else if (wc == 0)\n        addWorker(null, false);\n}\n</code></pre> <ul> <li>canRunInCurrentRunState()\uff1a\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u65f6\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u8c03\u7528\u200b\u4ee5\u200b\u6821\u9a8c\u200b\u5f53\u524d\u200b\u72b6\u6001\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>boolean canRunInCurrentRunState(boolean periodic) {\n    // \u200b\u6839\u636e\u200b\u662f\u5426\u662f\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u5224\u65ad\u200b\uff0c\u200b\u5728\u7ebf\u200b\u7a0b\u6c60\u200b shutdown \u200b\u540e\u200b\u662f\u5426\u200b\u7ee7\u7eed\u6267\u884c\u200b\u8be5\u200b\u4efb\u52a1\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u975e\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\u662f\u200b\u7ee7\u7eed\u6267\u884c\u200b\u7684\u200b\n    return isRunningOrShutdown(periodic ? continueExistingPeriodicTasksAfterShutdown :\n                               executeExistingDelayedTasksAfterShutdown);\n}\n</code></pre> <ul> <li>onShutdown()\uff1a\u200b\u5220\u9664\u200b\u5e76\u200b\u53d6\u6d88\u200b\u5de5\u4f5c\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4e0d\u200b\u9700\u8981\u200b\u518d\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>void onShutdown() {\n    BlockingQueue&lt;Runnable&gt; q = super.getQueue();\n    // shutdown \u200b\u540e\u200b\u662f\u5426\u200b\u4ecd\u7136\u200b\u6267\u884c\u200b\u5ef6\u65f6\u200b\u4efb\u52a1\u200b\n    boolean keepDelayed = getExecuteExistingDelayedTasksAfterShutdownPolicy();\n    // shutdown \u200b\u540e\u200b\u662f\u5426\u200b\u4ecd\u7136\u200b\u6267\u884c\u200b\u5468\u671f\u200b\u4efb\u52a1\u200b\n    boolean keepPeriodic = getContinueExistingPeriodicTasksAfterShutdownPolicy();\n    // \u200b\u5982\u679c\u200b\u4e24\u8005\u200b\u7686\u200b\u4e0d\u53ef\u200b\uff0c\u200b\u5219\u200b\u5bf9\u200b\u961f\u5217\u200b\u4e2d\u200b\u3010\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u3011\u200b\u8c03\u7528\u200b cancel \u200b\u53d6\u6d88\u200b\u5e76\u200b\u6e05\u7a7a\u200b\u961f\u5217\u200b\n    if (!keepDelayed &amp;&amp; !keepPeriodic) {\n        for (Object e : q.toArray())\n            if (e instanceof RunnableScheduledFuture&lt;?&gt;)\n                ((RunnableScheduledFuture&lt;?&gt;) e).cancel(false);\n        q.clear();\n    }\n    else {\n        for (Object e : q.toArray()) {\n            if (e instanceof RunnableScheduledFuture) {\n                RunnableScheduledFuture&lt;?&gt; t = (RunnableScheduledFuture&lt;?&gt;)e;\n                // \u200b\u4e0d\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u5220\u9664\u200b\u5e76\u200b\u53d6\u6d88\u200b\uff0c\u200b\u5df2\u7ecf\u200b\u53d6\u6d88\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e5f\u200b\u9700\u8981\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u5220\u9664\u200b\n                if ((t.isPeriodic() ? !keepPeriodic : !keepDelayed) ||\n                    t.isCancelled()) {\n                    if (q.remove(t))\n                        t.cancel(false);\n                }\n            }\n        }\n    }\n    // \u200b\u56e0\u4e3a\u200b\u4efb\u52a1\u200b\u88ab\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u6e05\u7406\u200b\u6389\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u8c03\u7528\u200b tryTerminate \u200b\u5c1d\u8bd5\u200b\u3010\u200b\u6539\u53d8\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u72b6\u6001\u200b\u3011\n    tryTerminate();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#forkjoin","title":"ForkJoin","text":"<p>Fork/Join\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4f53\u73b0\u200b\u662f\u200b\u5206\u6cbb\u200b\u601d\u60f3\u200b\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u80fd\u591f\u200b\u8fdb\u884c\u200b\u4efb\u52a1\u200b\u62c6\u5206\u200b\u7684\u200b CPU \u200b\u5bc6\u96c6\u578b\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5e76\u884c\u8ba1\u7b97\u200b</p> <p>\u200b\u4efb\u52a1\u200b\u62c6\u5206\u200b\uff1a\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u5927\u200b\u4efb\u52a1\u200b\u62c6\u200b\u5206\u4e3a\u200b\u7b97\u6cd5\u200b\u4e0a\u200b\u76f8\u540c\u200b\u7684\u200b\u5c0f\u200b\u4efb\u52a1\u200b\uff0c\u200b\u76f4\u81f3\u200b\u4e0d\u80fd\u200b\u62c6\u5206\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u6c42\u89e3\u200b\u3002\u200b\u8ddf\u200b\u9012\u5f52\u200b\u76f8\u5173\u200b\u7684\u200b\u4e00\u4e9b\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u5982\u200b\u5f52\u5e76\u200b\u6392\u5e8f\u200b\u3001\u200b\u6590\u6ce2\u200b\u90a3\u5951\u200b\u6570\u5217\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u200b\u5206\u6cbb\u200b\u601d\u60f3\u200b\u8fdb\u884c\u200b\u6c42\u89e3\u200b</p> <ul> <li>Fork/Join \u200b\u5728\u200b\u5206\u6cbb\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u52a0\u5165\u200b\u4e86\u200b\u591a\u7ebf\u7a0b\u200b\uff0c\u200b\u628a\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u5206\u89e3\u200b\u548c\u200b\u5408\u5e76\u200b\u4ea4\u7ed9\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u5b8c\u6210\u200b\uff0c\u200b\u63d0\u5347\u200b\u4e86\u200b\u8fd0\u7b97\u200b\u6548\u7387\u200b</li> <li>ForkJoin \u200b\u4f7f\u7528\u200b ForkJoinPool \u200b\u6765\u200b\u542f\u52a8\u200b\uff0c\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e0e\u200b CPU \u200b\u6838\u5fc3\u200b\u6570\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> <li>\u200b\u4efb\u52a1\u200b\u6709\u200b\u8fd4\u56de\u503c\u200b\u7ee7\u627f\u200b RecursiveTask\uff0c\u200b\u6ca1\u6709\u200b\u8fd4\u56de\u503c\u200b\u7ee7\u627f\u200b RecursiveAction</li> </ul> Java<pre><code>public static void main(String[] args) {\n    ForkJoinPool pool = new ForkJoinPool(4);\n    System.out.println(pool.invoke(new MyTask(5)));\n    //\u200b\u62c6\u5206\u200b  5 + MyTask(4) --&gt; 4 + MyTask(3) --&gt;\n}\n\n// 1~ n \u200b\u4e4b\u95f4\u200b\u6574\u6570\u200b\u7684\u200b\u548c\u200b\nclass MyTask extends RecursiveTask&lt;Integer&gt; {\n    private int n;\n\n    public MyTask(int n) {\n        this.n = n;\n    }\n\n    @Override\n    public String toString() {\n        return \"MyTask{\" + \"n=\" + n + '}';\n    }\n\n    @Override\n    protected Integer compute() {\n        // \u200b\u5982\u679c\u200b n \u200b\u5df2\u7ecf\u200b\u4e3a\u200b 1\uff0c\u200b\u53ef\u4ee5\u200b\u6c42\u5f97\u200b\u7ed3\u679c\u200b\u4e86\u200b\n        if (n == 1) {\n            return n;\n        }\n        // \u200b\u5c06\u200b\u4efb\u52a1\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b(fork)\n        MyTask t1 = new MyTask(n - 1);\n        t1.fork();\n        // \u200b\u5408\u5e76\u200b(join)\u200b\u7ed3\u679c\u200b\n        int result = n + t1.join();\n        return result;\n    }\n}\n</code></pre> <p>\u200b\u7ee7\u7eed\u200b\u62c6\u5206\u200b\u4f18\u5316\u200b\uff1a</p> Java<pre><code>class AddTask extends RecursiveTask&lt;Integer&gt; {\n    int begin;\n    int end;\n    public AddTask(int begin, int end) {\n        this.begin = begin;\n        this.end = end;\n    }\n\n    @Override\n    public String toString() {\n        return \"{\" + begin + \",\" + end + '}';\n    }\n\n    @Override\n    protected Integer compute() {\n        // 5, 5\n        if (begin == end) {\n            return begin;\n        }\n        // 4, 5  \u200b\u9632\u6b62\u200b\u591a\u4f59\u200b\u7684\u200b\u62c6\u5206\u200b  \u200b\u63d0\u9ad8\u6548\u7387\u200b\n        if (end - begin == 1) {\n            return end + begin;\n        }\n        // 1 5\n        int mid = (end + begin) / 2; // 3\n        AddTask t1 = new AddTask(begin, mid); // 1,3\n        t1.fork();\n        AddTask t2 = new AddTask(mid + 1, end); // 4,5\n        t2.fork();\n        int result = t1.join() + t2.join();\n        return result;\n    }\n}\n</code></pre> <p>ForkJoinPool \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5de5\u4f5c\u200b\u7a83\u53d6\u200b\u7b97\u6cd5\u200b\u6765\u200b\u63d0\u9ad8\u200b CPU \u200b\u7684\u200b\u5229\u7528\u7387\u200b\uff1a</p> <ul> <li>\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53cc\u7aef\u200b\u961f\u5217\u200b\uff0c\u200b\u7528\u6765\u200b\u5b58\u50a8\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b</li> <li>\u200b\u5de5\u4f5c\u200b\u7a83\u53d6\u200b\u7b97\u6cd5\u200b\u5141\u8bb8\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4ece\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53cc\u7aef\u200b\u961f\u5217\u200b\u4e2d\u200b\u7a83\u53d6\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u6765\u200b\u6267\u884c\u200b</li> <li>\u200b\u7a83\u53d6\u200b\u7684\u200b\u5fc5\u987b\u200b\u662f\u200b\u6700\u665a\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u907f\u514d\u200b\u548c\u200b\u961f\u5217\u200b\u6240\u5c5e\u200b\u7ebf\u7a0b\u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b\uff0c\u200b\u4f46\u662f\u200b\u961f\u5217\u200b\u4e2d\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u65f6\u200b\u8fd8\u662f\u200b\u4f1a\u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_142","title":"\u4eab\u5143\u200b\u6a21\u5f0f","text":"<p>\u200b\u4eab\u5143\u200b\u6a21\u5f0f\u200b\uff08Flyweight pattern\uff09\uff1a \u200b\u7528\u4e8e\u200b\u51cf\u5c11\u200b\u521b\u5efa\u5bf9\u8c61\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u4ee5\u200b\u51cf\u5c11\u200b\u5185\u5b58\u200b\u5360\u7528\u200b\u548c\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u8bbe\u8ba1\u6a21\u5f0f\u200b\u5c5e\u4e8e\u200b\u7ed3\u6784\u578b\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u51cf\u5c11\u200b\u5bf9\u8c61\u200b\u6570\u91cf\u200b\u4ece\u800c\u200b\u6539\u5584\u200b\u5e94\u7528\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7ed3\u6784\u200b\u7684\u200b\u65b9\u5f0f\u200b</p> <p>\u200b\u5f02\u6b65\u200b\u6a21\u5f0f\u200b\uff1a\u200b\u8ba9\u200b\u6709\u9650\u200b\u7684\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\uff08Worker Thread\uff09\u200b\u6765\u200b\u8f6e\u6d41\u200b\u5f02\u6b65\u200b\u5904\u7406\u200b\u65e0\u9650\u200b\u591a\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u200b\u5c06\u200b\u5176\u200b\u5f52\u7c7b\u200b\u4e3a\u200b\u5206\u5de5\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5178\u578b\u200b\u5b9e\u73b0\u200b\u5c31\u662f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</p> <p>\u200b\u5de5\u4f5c\u200b\u673a\u5236\u200b\uff1a\u200b\u4eab\u5143\u200b\u6a21\u5f0f\u200b\u5c1d\u8bd5\u200b\u91cd\u7528\u200b\u73b0\u6709\u200b\u7684\u200b\u540c\u7c7b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5982\u679c\u200b\u672a\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5219\u200b\u521b\u5efa\u200b\u65b0\u200b\u5bf9\u8c61\u200b</p> <p>\u200b\u81ea\u5b9a\u4e49\u200b\u8fde\u63a5\u6c60\u200b\uff1a</p> Java<pre><code>public static void main(String[] args) {\n    Pool pool = new Pool(2);\n    for (int i = 0; i &lt; 5; i++) {\n        new Thread(() -&gt; {\n            Connection con = pool.borrow();\n            try {\n                Thread.sleep(new Random().nextInt(1000));\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            pool.free(con);\n        }).start();\n    }\n}\nclass Pool {\n    //\u200b\u8fde\u63a5\u6c60\u200b\u7684\u200b\u5927\u5c0f\u200b\n    private final int poolSize;\n    //\u200b\u8fde\u63a5\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6570\u7ec4\u200b\n    private Connection[] connections;\n    //\u200b\u8fde\u63a5\u200b\u72b6\u6001\u200b\u6570\u7ec4\u200b 0\u200b\u8868\u793a\u200b\u7a7a\u95f2\u200b  1\u200b\u8868\u793a\u200b\u7e41\u5fd9\u200b\n    private AtomicIntegerArray states;  //int[] -&gt; AtomicIntegerArray\n\n    //\u200b\u6784\u9020\u65b9\u6cd5\u200b\n    public Pool(int poolSize) {\n        this.poolSize = poolSize;\n        this.connections = new Connection[poolSize];\n        this.states = new AtomicIntegerArray(new int[poolSize]);\n        for (int i = 0; i &lt; poolSize; i++) {\n            connections[i] = new MockConnection(\"\u200b\u8fde\u63a5\u200b\" + (i + 1));\n        }\n    }\n\n    //\u200b\u4f7f\u7528\u200b\u8fde\u63a5\u200b\n    public Connection borrow() {\n        while (true) {\n            for (int i = 0; i &lt; poolSize; i++) {\n                if (states.get(i) == 0) {\n                    if (states.compareAndSet(i, 0, 1)) {\n                        System.out.println(Thread.currentThread().getName() + \" borrow \" +  connections[i]);\n                        return connections[i];\n                    }\n                }\n            }\n            //\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7a7a\u95f2\u200b\u8fde\u63a5\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\n            synchronized (this) {\n                try {\n                    System.out.println(Thread.currentThread().getName() + \" wait...\");\n                    this.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    //\u200b\u5f52\u8fd8\u200b\u8fde\u63a5\u200b\n    public void free(Connection con) {\n        for (int i = 0; i &lt; poolSize; i++) {\n            if (connections[i] == con) {//\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\n                states.set(i, 0);//\u200b\u4e0d\u7528\u200bcas\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\u53ea\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u8be5\u200b\u8fde\u63a5\u200b\n                synchronized (this) {\n                    System.out.println(Thread.currentThread().getName() + \" free \" + con);\n                    this.notifyAll();\n                }\n                break;\n            }\n        }\n    }\n\n}\n\nclass MockConnection implements Connection {\n    private String name;\n    //.....\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_143","title":"\u540c\u6b65\u5668","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#aqs","title":"AQS","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_144","title":"\u6838\u5fc3\u601d\u60f3","text":"<p>AQS\uff1aAbstractQueuedSynchronizer\uff0c\u200b\u662f\u200b\u963b\u585e\u200b\u5f0f\u200b\u9501\u200b\u548c\u200b\u76f8\u5173\u200b\u7684\u200b\u540c\u6b65\u5668\u200b\u5de5\u5177\u200b\u7684\u200b\u6846\u67b6\u200b\uff0c\u200b\u8bb8\u591a\u200b\u540c\u6b65\u200b\u7c7b\u200b\u5b9e\u73b0\u200b\u90fd\u200b\u4f9d\u8d56\u4e8e\u200b\u8be5\u200b\u540c\u6b65\u5668\u200b</p> <p>AQS \u200b\u7528\u200b\u72b6\u6001\u200b\u5c5e\u6027\u200b\u6765\u200b\u8868\u793a\u200b\u8d44\u6e90\u200b\u7684\u200b\u72b6\u6001\u200b\uff08\u200b\u5206\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\u548c\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\uff09\uff0c\u200b\u5b50\u7c7b\u200b\u9700\u8981\u200b\u5b9a\u4e49\u200b\u5982\u4f55\u200b\u7ef4\u62a4\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\uff0c\u200b\u63a7\u5236\u200b\u5982\u4f55\u200b\u83b7\u53d6\u200b\u9501\u200b\u548c\u200b\u91ca\u653e\u200b\u9501\u200b</p> <ul> <li>\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\u662f\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u80fd\u591f\u200b\u8bbf\u95ee\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5982\u200b ReentrantLock</li> <li>\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\u5141\u8bb8\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5982\u200b Semaphore\uff0cReentrantReadWriteLock \u200b\u662f\u200b\u7ec4\u5408\u5f0f\u200b</li> </ul> <p>AQS \u200b\u6838\u5fc3\u601d\u60f3\u200b\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b\u88ab\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5171\u4eab\u8d44\u6e90\u200b\u7a7a\u95f2\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u8d44\u6e90\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u6709\u6548\u200b\u7684\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5171\u4eab\u8d44\u6e90\u200b\u8bbe\u7f6e\u200b\u9501\u5b9a\u200b\u72b6\u6001\u200b</li> <li>\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5171\u4eab\u8d44\u6e90\u200b\u88ab\u200b\u5360\u7528\u200b\uff0cAQS \u200b\u7528\u200b\u961f\u5217\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u4ee5\u53ca\u200b\u88ab\u200b\u5524\u9192\u200b\u65f6\u9501\u200b\u5206\u914d\u200b\u7684\u200b\u673a\u5236\u200b\uff0c\u200b\u5c06\u200b\u6682\u65f6\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u52a0\u5165\u200b\u5230\u200b\u961f\u5217\u200b\u4e2d\u200b</li> </ul> <p>CLH \u200b\u662f\u200b\u4e00\u79cd\u200b\u57fa\u4e8e\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u9ad8\u6027\u80fd\u200b\u3001\u200b\u516c\u5e73\u200b\u7684\u200b\u81ea\u65cb\u200b\u9501\u200b\uff0cAQS \u200b\u662f\u200b\u5c06\u200b\u6bcf\u6761\u200b\u8bf7\u6c42\u200b\u5171\u4eab\u8d44\u6e90\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c01\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200b CLH \u200b\u9501\u200b\u961f\u5217\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\uff08Node\uff09\u200b\u6765\u200b\u5b9e\u73b0\u200b\u9501\u200b\u7684\u200b\u5206\u914d\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_145","title":"\u8bbe\u8ba1\u200b\u539f\u7406","text":"<p>\u200b\u8bbe\u8ba1\u200b\u539f\u7406\u200b\uff1a</p> <ul> <li>\u200b\u83b7\u53d6\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>while(state \u200b\u72b6\u6001\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u83b7\u53d6\u200b) {    // tryAcquire(arg)\n    if(\u200b\u961f\u5217\u200b\u4e2d\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6b64\u200b\u7ebf\u7a0b\u200b) {\n        \u200b\u5165\u961f\u200b\u5e76\u200b\u963b\u585e\u200b park\n    }\n}\n\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u51fa\u961f\u200b\n</code></pre> <ul> <li>\u200b\u91ca\u653e\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>if(state \u200b\u72b6\u6001\u200b\u5141\u8bb8\u200b\u4e86\u200b) { // tryRelease(arg)\n  \u200b\u6062\u590d\u200b\u963b\u585e\u200b\u7684\u200b\u7ebf\u7a0b\u200b(s) unpark\n}\n</code></pre> <p>AbstractQueuedSynchronizer \u200b\u4e2d\u200b state \u200b\u8bbe\u8ba1\u200b\uff1a</p> <ul> <li>state \u200b\u4f7f\u7528\u200b\u4e86\u200b 32bit int \u200b\u6765\u200b\u7ef4\u62a4\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff0c\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b 0 \u200b\u8868\u793a\u200b\u672a\u200b\u52a0\u9501\u200b\u72b6\u6001\u200b\uff0c\u200b\u5927\u4e8e\u200b 0 \u200b\u8868\u793a\u200b\u5df2\u7ecf\u200b\u52a0\u9501\u200b\u72b6\u6001\u200b</li> </ul> Java<pre><code>private volatile int state;\n</code></pre> <ul> <li>state \u200b\u4f7f\u7528\u200b volatile \u200b\u4fee\u9970\u200b\u914d\u5408\u200b cas \u200b\u4fdd\u8bc1\u200b\u5176\u200b\u4fee\u6539\u200b\u65f6\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b</li> <li>state \u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u91cd\u5165\u200b\u7684\u200b\u6b21\u6570\u200b\uff08\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\uff09\u200b\u6216\u8005\u200b\u5269\u4f59\u200b\u8bb8\u53ef\u200b\u6570\u200b\uff08\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\uff09</li> <li>state API\uff1a</li> <li><code>protected final int getState()</code>\uff1a\u200b\u83b7\u53d6\u200b state \u200b\u72b6\u6001\u200b</li> <li><code>protected final void setState(int newState)</code>\uff1a\u200b\u8bbe\u7f6e\u200b state \u200b\u72b6\u6001\u200b</li> <li><code>protected final boolean compareAndSetState(int expect,int update)</code>\uff1aCAS \u200b\u5b89\u5168\u200b\u8bbe\u7f6e\u200b state</li> </ul> <p>\u200b\u5c01\u88c5\u200b\u7ebf\u7a0b\u200b\u7684\u200b Node \u200b\u8282\u70b9\u200b\u4e2d\u200b waitstate \u200b\u8bbe\u8ba1\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b volatile \u200b\u4fee\u9970\u200b\u914d\u5408\u200b CAS \u200b\u4fdd\u8bc1\u200b\u5176\u200b\u4fee\u6539\u200b\u65f6\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b</li> <li>\u200b\u8868\u793a\u200b Node \u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u51e0\u79cd\u200b\u72b6\u6001\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 0\nvolatile int waitStatus;\n// \u200b\u7531\u4e8e\u200b\u8d85\u65f6\u200b\u6216\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u6b64\u200b\u8282\u70b9\u200b\u88ab\u200b\u53d6\u6d88\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u6539\u53d8\u200b\u72b6\u6001\u200b\nstatic final int CANCELLED =  1;\n// \u200b\u6b64\u200b\u8282\u70b9\u200b\u540e\u9762\u200b\u7684\u200b\u8282\u70b9\u200b\u5df2\u200b\uff08\u200b\u6216\u200b\u5373\u5c06\u200b\uff09\u200b\u88ab\u200b\u963b\u6b62\u200b\uff08\u200b\u901a\u8fc7\u200bpark\uff09\uff0c\u3010\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5728\u200b\u91ca\u653e\u200b\u6216\u200b\u53d6\u6d88\u200b\u65f6\u200b\u5fc5\u987b\u200b\u5524\u9192\u200b\u540e\u9762\u200b\u7684\u200b\u8282\u70b9\u200b\u3011\nstatic final int SIGNAL    = -1;\n// \u200b\u6b64\u200b\u8282\u70b9\u200b\u5f53\u524d\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u4e2d\u200b\nstatic final int CONDITION = -2;\n// \u200b\u5c06\u200breleaseShared\u200b\u4f20\u64ad\u200b\u5230\u200b\u5176\u4ed6\u200b\u8282\u70b9\u200b\nstatic final int PROPAGATE = -3;\n</code></pre> <p>\u200b\u963b\u585e\u200b\u6062\u590d\u200b\u8bbe\u8ba1\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b park &amp; unpark \u200b\u6765\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6682\u505c\u200b\u548c\u200b\u6062\u590d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u547d\u4ee4\u200b\u7684\u200b\u5148\u540e\u987a\u5e8f\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u7ed3\u679c\u200b</li> <li>park &amp; unpark \u200b\u662f\u200b\u9488\u5bf9\u200b\u7ebf\u7a0b\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u9488\u5bf9\u200b\u540c\u6b65\u5668\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u63a7\u5236\u200b\u7c92\u5ea6\u200b\u66f4\u4e3a\u200b\u7cbe\u7ec6\u200b</li> <li>park \u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b interrupt \u200b\u6253\u65ad\u200b</li> </ul> <p>\u200b\u961f\u5217\u200b\u8bbe\u8ba1\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b\u4e86\u200b FIFO \u200b\u5148\u5165\u200b\u5148\u51fa\u200b\u961f\u5217\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u652f\u6301\u200b\u4f18\u5148\u7ea7\u200b\u961f\u5217\u200b\uff0c\u200b\u540c\u6b65\u200b\u961f\u5217\u200b\u662f\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u51fa\u961f\u200b\u5165\u961f\u200b</li> </ul> Java<pre><code>// \u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u6307\u5411\u200b\u54d1\u5143\u200b\u8282\u70b9\u200b\nprivate transient volatile Node head;\n// \u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e0d\u200b\u5305\u542b\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u4ece\u200b head.next \u2192 tail \u200b\u8ba4\u4e3a\u200b\u662f\u200b\u963b\u585e\u200b\u961f\u5217\u200b\nprivate transient volatile Node tail;\n\nstatic final class Node {\n    // \u200b\u679a\u4e3e\u200b\uff1a\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\n    static final Node SHARED = new Node();\n    // \u200b\u679a\u4e3e\u200b\uff1a\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\n    static final Node EXCLUSIVE = null;\n    // node \u200b\u9700\u8981\u200b\u6784\u5efa\u200b\u6210\u200b FIFO \u200b\u961f\u5217\u200b\uff0cprev \u200b\u6307\u5411\u200b\u524d\u7ee7\u200b\u8282\u70b9\u200b\n    volatile Node prev;\n    // next \u200b\u6307\u5411\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n    volatile Node next;\n    // \u200b\u5f53\u524d\u200b node \u200b\u5c01\u88c5\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n    volatile Thread thread;\n    // \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u662f\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u53ea\u6709\u200b\u540e\u7ee7\u200b\u6307\u9488\u200b\uff0c\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u4f7f\u7528\u200b\u8be5\u200b\u5c5e\u6027\u200b\n    Node nextWaiter;\n}\n</code></pre> <p></p> <ul> <li>\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7b49\u5f85\u200b\u3001\u200b\u5524\u9192\u200b\u673a\u5236\u200b\uff0c\u200b\u652f\u6301\u200b\u591a\u4e2a\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b Monitor \u200b\u7684\u200b WaitSet\uff0c\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u662f\u200b\u5355\u5411\u200b\u94fe\u8868\u200b</li> </ul> Java<pre><code> public class ConditionObject implements Condition, java.io.Serializable {\n     // \u200b\u6307\u5411\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b node \u200b\u8282\u70b9\u200b\n     private transient Node firstWaiter;\n     // \u200b\u6307\u5411\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b node \u200b\u8282\u70b9\u200b\n     private transient Node lastWaiter;\n }\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_146","title":"\u6a21\u677f\u200b\u5bf9\u8c61","text":"<p>\u200b\u540c\u6b65\u5668\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u662f\u200b\u57fa\u4e8e\u200b\u6a21\u677f\u200b\u65b9\u6cd5\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u8be5\u200b\u6a21\u5f0f\u200b\u662f\u200b\u57fa\u4e8e\u200b\u7ee7\u627f\u200b\u7684\u200b\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u4e3a\u4e86\u200b\u5728\u200b\u4e0d\u200b\u6539\u53d8\u200b\u6a21\u677f\u200b\u7ed3\u6784\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\u5728\u200b\u5b50\u7c7b\u200b\u4e2d\u200b\u91cd\u65b0\u200b\u5b9a\u4e49\u200b\u6a21\u677f\u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\u4ee5\u200b\u5b9e\u73b0\u200b\u590d\u7528\u200b\u4ee3\u7801\u200b</p> <ul> <li>\u200b\u4f7f\u7528\u8005\u200b\u7ee7\u627f\u200b <code>AbstractQueuedSynchronizer</code> \u200b\u5e76\u200b\u91cd\u5199\u200b\u6307\u5b9a\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u5c06\u200b AQS \u200b\u7ec4\u5408\u200b\u5728\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u200b\u7ec4\u4ef6\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u8c03\u7528\u200b\u5176\u200b\u6a21\u677f\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u6a21\u677f\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u8c03\u7528\u200b\u4f7f\u7528\u8005\u200b\u91cd\u5199\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> </ul> <p>AQS \u200b\u4f7f\u7528\u200b\u4e86\u200b\u6a21\u677f\u200b\u65b9\u6cd5\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u65f6\u200b\u9700\u8981\u200b\u91cd\u5199\u200b\u4e0b\u9762\u200b\u51e0\u4e2a\u200b AQS \u200b\u63d0\u4f9b\u200b\u7684\u200b\u6a21\u677f\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>isHeldExclusively()     //\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u6b63\u5728\u200b\u72ec\u5360\u200b\u8d44\u6e90\u200b\u3002\u200b\u53ea\u6709\u200b\u7528\u5230\u200bcondition\u200b\u624d\u200b\u9700\u8981\u200b\u53bb\u200b\u5b9e\u73b0\u200b\u5b83\u200b\ntryAcquire(int)         //\u200b\u72ec\u5360\u200b\u65b9\u5f0f\u200b\u3002\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8d44\u6e90\u200b\uff0c\u200b\u6210\u529f\u200b\u5219\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u5931\u8d25\u200b\u5219\u200b\u8fd4\u56de\u200bfalse\ntryRelease(int)         //\u200b\u72ec\u5360\u200b\u65b9\u5f0f\u200b\u3002\u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u8d44\u6e90\u200b\uff0c\u200b\u6210\u529f\u200b\u5219\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u5931\u8d25\u200b\u5219\u200b\u8fd4\u56de\u200bfalse\ntryAcquireShared(int)   //\u200b\u5171\u4eab\u200b\u65b9\u5f0f\u200b\u3002\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8d44\u6e90\u200b\u3002\u200b\u8d1f\u6570\u200b\u8868\u793a\u200b\u5931\u8d25\u200b\uff1b0\u200b\u8868\u793a\u200b\u6210\u529f\u200b\u4f46\u200b\u6ca1\u6709\u200b\u5269\u4f59\u200b\u53ef\u7528\u200b\u8d44\u6e90\u200b\uff1b\u200b\u6b63\u6570\u200b\u8868\u793a\u200b\u6210\u529f\u200b\u4e14\u200b\u6709\u200b\u5269\u4f59\u200b\u8d44\u6e90\u200b\ntryReleaseShared(int)   //\u200b\u5171\u4eab\u200b\u65b9\u5f0f\u200b\u3002\u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u8d44\u6e90\u200b\uff0c\u200b\u6210\u529f\u200b\u5219\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u5931\u8d25\u200b\u5219\u200b\u8fd4\u56de\u200bfalse\n</code></pre> <ul> <li>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u629b\u51fa\u200b <code>UnsupportedOperationException</code></li> <li>\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u7684\u200b\u5b9e\u73b0\u200b\u5fc5\u987b\u200b\u662f\u200b\u5185\u90e8\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b</li> <li>AQS \u200b\u7c7b\u4e2d\u200b\u7684\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b final \uff0c\u200b\u6240\u4ee5\u200b\u65e0\u6cd5\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7c7b\u200b\u4f7f\u7528\u200b\uff0c\u200b\u53ea\u6709\u200b\u8fd9\u200b\u51e0\u4e2a\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7c7b\u200b\u4f7f\u7528\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_147","title":"\u81ea\u5b9a\u4e49","text":"<p>\u200b\u81ea\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u4e0d\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff1a</p> Java<pre><code>class MyLock implements Lock {\n    //\u200b\u72ec\u5360\u200b\u9501\u200b \u200b\u4e0d\u53ef\u200b\u91cd\u200b\u5165\u200b\n    class MySync extends AbstractQueuedSynchronizer {\n        @Override\n        protected boolean tryAcquire(int arg) {\n            if (compareAndSetState(0, 1)) {\n                // \u200b\u52a0\u4e0a\u200b\u9501\u200b \u200b\u8bbe\u7f6e\u200b owner \u200b\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n                setExclusiveOwnerThread(Thread.currentThread());\n                return true;\n            }\n            return false;\n        }\n        @Override   //\u200b\u89e3\u9501\u200b\n        protected boolean tryRelease(int arg) {\n            setExclusiveOwnerThread(null);\n            setState(0);//volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\u653e\u5728\u200b\u540e\u9762\u200b\uff0c\u200b\u9632\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\n            return true;\n        }\n        @Override   //\u200b\u662f\u5426\u200b\u6301\u6709\u200b\u72ec\u5360\u200b\u9501\u200b\n        protected boolean isHeldExclusively() {\n            return getState() == 1;\n        }\n        public Condition newCondition() {\n            return new ConditionObject();\n        }\n    }\n\n    private MySync sync = new MySync();\n\n    @Override   //\u200b\u52a0\u9501\u200b\uff08\u200b\u4e0d\u200b\u6210\u529f\u200b\u8fdb\u5165\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u7b49\u5f85\u200b\uff09\n    public void lock() {\n        sync.acquire(1);\n    }\n\n    @Override   //\u200b\u52a0\u9501\u200b \u200b\u53ef\u200b\u6253\u65ad\u200b\n    public void lockInterruptibly() throws InterruptedException {\n        sync.acquireInterruptibly(1);\n    }\n\n    @Override   //\u200b\u5c1d\u8bd5\u200b\u52a0\u9501\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\n    public boolean tryLock() {\n        return sync.tryAcquire(1);\n    }\n\n    @Override   //\u200b\u5c1d\u8bd5\u200b\u52a0\u9501\u200b\uff0c\u200b\u5e26\u200b\u8d85\u65f6\u200b\n    public boolean tryLock(long time, TimeUnit unit) throws InterruptedException {\n        return sync.tryAcquireNanos(1, unit.toNanos(time));\n    }\n\n    @Override   //\u200b\u89e3\u9501\u200b\n    public void unlock() {\n        sync.release(1);\n    }\n\n    @Override   //\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\n    public Condition newCondition() {\n        return sync.newCondition();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#re-lock","title":"Re-Lock","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_148","title":"\u9501\u200b\u5bf9\u6bd4","text":"<p>ReentrantLock \u200b\u76f8\u5bf9\u200b\u4e8e\u200b synchronized \u200b\u5177\u5907\u200b\u5982\u4e0b\u200b\u7279\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u9501\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1asynchronized \u200b\u662f\u200b JVM \u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u800c\u200b ReentrantLock \u200b\u662f\u200b JDK \u200b\u5b9e\u73b0\u200b\u7684\u200b</li> <li>\u200b\u6027\u80fd\u200b\uff1a\u200b\u65b0\u200b\u7248\u672c\u200b Java \u200b\u5bf9\u200b synchronized \u200b\u8fdb\u884c\u200b\u4e86\u200b\u5f88\u591a\u200b\u4f18\u5316\u200b\uff0csynchronized \u200b\u4e0e\u200b ReentrantLock \u200b\u5927\u81f4\u76f8\u540c\u200b</li> <li>\u200b\u4f7f\u7528\u200b\uff1aReentrantLock \u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u89e3\u9501\u200b\uff0csynchronized \u200b\u6267\u884c\u200b\u5b8c\u200b\u4ee3\u7801\u200b\u5757\u200b\u81ea\u52a8\u200b\u89e3\u9501\u200b</li> <li>\u200b\u53ef\u200b\u4e2d\u65ad\u200b\uff1aReentrantLock \u200b\u53ef\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u800c\u200b synchronized \u200b\u4e0d\u884c\u200b</li> <li>\u200b\u516c\u5e73\u200b\u9501\u200b\uff1a\u200b\u516c\u5e73\u200b\u9501\u200b\u662f\u200b\u6307\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u7b49\u5f85\u200b\u540c\u4e00\u4e2a\u200b\u9501\u65f6\u200b\uff0c\u200b\u5fc5\u987b\u200b\u6309\u7167\u200b\u7533\u8bf7\u200b\u9501\u200b\u7684\u200b\u65f6\u95f4\u200b\u987a\u5e8f\u200b\u6765\u200b\u4f9d\u6b21\u200b\u83b7\u5f97\u200b\u9501\u200b</li> <li>ReentrantLock \u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u516c\u5e73\u200b\u9501\u200b\uff0csynchronized \u200b\u4e2d\u200b\u7684\u200b\u9501\u200b\u662f\u975e\u200b\u516c\u5e73\u200b\u7684\u200b</li> <li>\u200b\u4e0d\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u542b\u4e49\u200b\u662f\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5185\u200b\u516c\u5e73\u200b\uff0c\u200b\u961f\u5217\u200b\u5916\u975e\u200b\u516c\u5e73\u200b</li> <li>\u200b\u9501\u200b\u8d85\u65f6\u200b\uff1a\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u8d85\u65f6\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u76f4\u63a5\u200b\u653e\u5f03\u200b\uff0c\u200b\u4e0d\u200b\u8fdb\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> <li>ReentrantLock \u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff0csynchronized \u200b\u4f1a\u200b\u4e00\u76f4\u200b\u7b49\u5f85\u200b</li> <li>\u200b\u9501\u200b\u7ed1\u5b9a\u200b\u591a\u4e2a\u200b\u6761\u4ef6\u200b\uff1a\u200b\u4e00\u4e2a\u200b ReentrantLock \u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u7ed1\u5b9a\u200b\u591a\u4e2a\u200b Condition \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u66f4\u200b\u7ec6\u7c92\u5ea6\u200b\u7684\u200b\u5524\u9192\u200b\u7ebf\u7a0b\u200b</li> <li>\u200b\u4e24\u8005\u200b\u90fd\u200b\u662f\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_149","title":"\u4f7f\u7528\u200b\u9501","text":"<p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a<code>ReentrantLock lock = new ReentrantLock();</code></p> <p>ReentrantLock \u200b\u7c7b\u200b API\uff1a</p> <ul> <li><code>public void lock()</code>\uff1a\u200b\u83b7\u5f97\u200b\u9501\u200b</li> <li>\u200b\u5982\u679c\u200b\u9501\u200b\u6ca1\u6709\u200b\u88ab\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5360\u7528\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u9501\u5b9a\u200b\u8ba1\u6570\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 1</li> <li>\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u4fdd\u6301\u200b\u9501\u5b9a\u200b\uff0c\u200b\u5219\u200b\u4fdd\u6301\u200b\u8ba1\u6570\u200b\u589e\u52a0\u200b 1 </li> <li>\u200b\u5982\u679c\u200b\u9501\u200b\u88ab\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4fdd\u6301\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u7981\u7528\u200b\u7ebf\u7a0b\u200b\u8c03\u5ea6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u9501\u5b9a\u200b\u5df2\u200b\u88ab\u200b\u83b7\u53d6\u200b\u4e4b\u524d\u200b\u5904\u4e8e\u200b\u4f11\u7720\u72b6\u6001\u200b</li> <li><code>public void unlock()</code>\uff1a\u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u9501\u200b</li> <li>\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u8be5\u200b\u9501\u200b\u7684\u200b\u6301\u6709\u8005\u200b\uff0c\u200b\u5219\u200b\u4fdd\u6301\u200b\u8ba1\u6570\u200b\u9012\u51cf\u200b</li> <li>\u200b\u5982\u679c\u200b\u4fdd\u6301\u200b\u8ba1\u6570\u200b\u73b0\u5728\u200b\u4e3a\u200b\u96f6\u200b\uff0c\u200b\u5219\u200b\u9501\u5b9a\u200b\u88ab\u200b\u91ca\u653e\u200b</li> <li>\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u662f\u200b\u8be5\u9501\u200b\u7684\u200b\u6301\u6709\u8005\u200b\uff0c\u200b\u5219\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> </ul> <p>\u200b\u57fa\u672c\u200b\u8bed\u6cd5\u200b\uff1a</p> Java<pre><code>// \u200b\u83b7\u53d6\u200b\u9501\u200b\nreentrantLock.lock();\ntry {\n    // \u200b\u4e34\u754c\u200b\u533a\u200b\n} finally {\n    // \u200b\u91ca\u653e\u200b\u9501\u200b\n    reentrantLock.unlock();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_150","title":"\u516c\u5e73\u200b\u9501","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_151","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a<code>ReentrantLock lock = new ReentrantLock(true)</code></p> Java<pre><code>public ReentrantLock(boolean fair) {\n    sync = fair ? new FairSync() : new NonfairSync();\n}\n</code></pre> <p>ReentrantLock \u200b\u9ed8\u8ba4\u200b\u662f\u200b\u4e0d\u200b\u516c\u5e73\u200b\u7684\u200b\uff1a</p> Java<pre><code>public ReentrantLock() {\n    sync = new NonfairSync();\n}\n</code></pre> <p>\u200b\u8bf4\u660e\u200b\uff1a\u200b\u516c\u5e73\u200b\u9501\u200b\u4e00\u822c\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\uff0c\u200b\u4f1a\u200b\u964d\u4f4e\u200b\u5e76\u53d1\u200b\u5ea6\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_152","title":"\u975e\u516c\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_153","title":"\u52a0\u9501","text":"<p>NonfairSync \u200b\u7ee7\u627f\u200b\u81ea\u200b AQS</p> Java<pre><code>public void lock() {\n    sync.lock();\n}\n</code></pre> <ul> <li>\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\uff1aExclusiveOwnerThread \u200b\u5c5e\u4e8e\u200b Thread-0\uff0cstate \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 1</li> </ul> Java<pre><code>// ReentrantLock.NonfairSync#lock\nfinal void lock() {\n    // \u200b\u7528\u200b cas \u200b\u5c1d\u8bd5\u200b\uff08\u200b\u4ec5\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\uff09\u200b\u5c06\u200b state \u200b\u4ece\u200b 0 \u200b\u6539\u4e3a\u200b 1, \u200b\u5982\u679c\u200b\u6210\u529f\u200b\u8868\u793a\u200b\u3010\u200b\u83b7\u5f97\u200b\u4e86\u200b\u72ec\u5360\u200b\u9501\u200b\u3011\n    if (compareAndSetState(0, 1))\n        // \u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b\u72ec\u5360\u200b\u7ebf\u7a0b\u200b\n        setExclusiveOwnerThread(Thread.currentThread());\n    else\n        acquire(1);//\u200b\u5931\u8d25\u200b\u8fdb\u5165\u200b\n}\n</code></pre> <ul> <li>\u200b\u7b2c\u4e00\u4e2a\u200b\u7ade\u4e89\u200b\u51fa\u73b0\u200b\uff1aThread-1 \u200b\u6267\u884c\u200b\uff0cCAS \u200b\u5c1d\u8bd5\u200b\u5c06\u200b state \u200b\u7531\u200b 0 \u200b\u6539\u4e3a\u200b 1\uff0c\u200b\u7ed3\u679c\u200b\u5931\u8d25\u200b\uff08\u200b\u7b2c\u4e00\u6b21\u200b\uff09\uff0c\u200b\u8fdb\u5165\u200b acquire \u200b\u903b\u8f91\u200b</li> </ul> Java<pre><code>// AbstractQueuedSynchronizer#acquire\npublic final void acquire(int arg) {\n    // tryAcquire \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u65f6\u200b, \u200b\u4f1a\u200b\u8c03\u7528\u200b addWaiter \u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c01\u88c5\u200b\u6210\u200bnode\u200b\u5165\u961f\u200b\uff0cacquireQueued \u200b\u963b\u585e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\n    // acquireQueued \u200b\u8fd4\u56de\u200b true \u200b\u8868\u793a\u200b\u6302\u200b\u8d77\u200b\u8fc7\u7a0b\u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u5524\u9192\u200b\u8fc7\u200b\uff0cfalse \u200b\u8868\u793a\u200b\u672a\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u8fc7\u200b\n    if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        // \u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u4e86\u200b\u903b\u8f91\u200b\u6765\u5230\u200b\u8fd9\u200b\uff0c\u200b\u5b8c\u6210\u200b\u4e00\u6b21\u200b\u771f\u6b63\u200b\u7684\u200b\u6253\u65ad\u200b\u6548\u679c\u200b\n        selfInterrupt();\n}\n</code></pre> <p></p> <ul> <li>\u200b\u8fdb\u5165\u200b tryAcquire \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\u903b\u8f91\u200b\uff0c\u200b\u8fd9\u65f6\u200b state \u200b\u5df2\u7ecf\u200b\u662f\u200b1\uff0c\u200b\u7ed3\u679c\u200b\u4ecd\u7136\u200b\u5931\u8d25\u200b\uff08\u200b\u7b2c\u4e8c\u6b21\u200b\uff09\uff0c\u200b\u52a0\u9501\u200b\u6210\u529f\u200b\u6709\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff1a</li> <li>\u200b\u5f53\u524d\u200b AQS \u200b\u5904\u4e8e\u200b\u65e0\u9501\u200b\u72b6\u6001\u200b</li> <li>\u200b\u52a0\u9501\u200b\u7ebf\u7a0b\u200b\u5c31\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8bf4\u660e\u200b\u53d1\u751f\u200b\u4e86\u200b\u9501\u200b\u91cd\u5165\u200b</li> </ul> Java<pre><code>// ReentrantLock.NonfairSync#tryAcquire\nprotected final boolean tryAcquire(int acquires) {\n    return nonfairTryAcquire(acquires);\n}\n// \u200b\u62a2\u5360\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b true\uff0c\u200b\u62a2\u5360\u200b\u5931\u8d25\u200b\u8fd4\u56de\u200b false\nfinal boolean nonfairTryAcquire(int acquires) {\n    final Thread current = Thread.currentThread();\n    // state \u200b\u503c\u200b\n    int c = getState();\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u5904\u4e8e\u200b\u3010\u200b\u65e0\u9501\u200b\u72b6\u6001\u200b\u3011\n    if (c == 0) {\n        //\u200b\u5982\u679c\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u7528\u200bcas\u200b\u83b7\u5f97\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4f53\u73b0\u200b\u975e\u200b\u516c\u5e73\u6027\u200b: \u200b\u4e0d\u53bb\u200b\u68c0\u67e5\u200b AQS \u200b\u961f\u5217\u200b\u662f\u5426\u200b\u6709\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\u9501\u200b        \n      if (compareAndSetState(0, acquires)) {\n            // \u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b\u72ec\u5360\u200b\u9501\u7ebf\u200b\u7a0b\u200b\u3002\n            setExclusiveOwnerThread(current);\n            return true;\n         }    \n  }    \n      // \u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\u4e86\u200b\u9501\u200b, \u200b\u72ec\u5360\u200b\u9501\u7ebf\u200b\u7a0b\u200b\u8fd8\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b, \u200b\u8868\u793a\u200b\u3010\u200b\u53d1\u751f\u200b\u4e86\u200b\u9501\u200b\u91cd\u5165\u200b\u3011\n  else if (current == getExclusiveOwnerThread()) {\n        // \u200b\u66f4\u65b0\u200b\u9501\u200b\u91cd\u5165\u200b\u7684\u200b\u503c\u200b\n        int nextc = c + acquires;\n        // \u200b\u8d8a\u754c\u200b\u5224\u65ad\u200b\uff0c\u200b\u5f53\u91cd\u5165\u200b\u7684\u200b\u6df1\u5ea6\u200b\u5f88\u200b\u6df1\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b nextc &lt; 0\uff0cint\u200b\u503c\u200b\u8fbe\u5230\u200b\u6700\u5927\u200b\u4e4b\u540e\u200b\u518d\u200b + 1 \u200b\u53d8\u200b\u8d1f\u6570\u200b\n        if (nextc &lt; 0) // overflow\n            throw new Error(\"Maximum lock count exceeded\");\n        // \u200b\u66f4\u65b0\u200b state \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u4f7f\u7528\u200b cas \u200b\u662f\u56e0\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6b63\u5728\u200b\u6301\u6709\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u7684\u200b\u64cd\u4f5c\u200b\u76f8\u5f53\u4e8e\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7ba1\u7a0b\u200b\u5185\u200b\n        setState(nextc);\n        return true;\n    }\n    // \u200b\u83b7\u53d6\u200b\u5931\u8d25\u200b\n    return false;\n}\n</code></pre> <ul> <li>\u200b\u63a5\u4e0b\u6765\u200b\u8fdb\u5165\u200b addWaiter \u200b\u903b\u8f91\u200b\uff0c\u200b\u6784\u9020\u200b Node \u200b\u961f\u5217\u200b\uff08\u200b\u4e0d\u662f\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff09\uff0c\u200b\u524d\u7f6e\u6761\u4ef6\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u8bf4\u660e\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u5360\u7528\u200b\u4e86\u200b\u9501\u200b</li> <li>\u200b\u56fe\u4e2d\u200b\u9ec4\u8272\u200b\u4e09\u89d2\u200b\u8868\u793a\u200b\u8be5\u200b Node \u200b\u7684\u200b waitStatus \u200b\u72b6\u6001\u200b\uff0c\u200b\u5176\u4e2d\u200b 0 \u200b\u4e3a\u200b\u9ed8\u8ba4\u200b\u6b63\u5e38\u200b\u72b6\u6001\u200b</li> <li>Node \u200b\u7684\u200b\u521b\u5efa\u200b\u662f\u200b\u61d2\u60f0\u200b\u7684\u200b\uff0c\u200b\u5176\u4e2d\u200b\u7b2c\u4e00\u4e2a\u200b Node \u200b\u79f0\u4e3a\u200b Dummy\uff08\u200b\u54d1\u5143\u200b\uff09\u200b\u6216\u200b\u54e8\u5175\u200b\uff0c\u200b\u7528\u6765\u200b\u5360\u4f4d\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u5173\u8054\u200b\u7ebf\u7a0b\u200b</li> </ul> Java<pre><code>// AbstractQueuedSynchronizer#addWaiter\uff0c\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b node \u200b\u8282\u70b9\u200b\nprivate Node addWaiter(Node mode) {\n    // \u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5173\u8054\u200b\u5230\u200b\u4e00\u4e2a\u200b Node \u200b\u5bf9\u8c61\u200b\u4e0a\u200b, \u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b   \n    Node node = new Node(Thread.currentThread(), mode);\n    Node pred = tail;\n    // \u200b\u5feb\u901f\u200b\u5165\u961f\u200b\uff0c\u200b\u5982\u679c\u200b tail \u200b\u4e0d\u200b\u4e3a\u200b null\uff0c\u200b\u8bf4\u660e\u200b\u5b58\u5728\u200b\u961f\u5217\u200b\n    if (pred != null) {\n        // \u200b\u5c06\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u6307\u5411\u200b \u200b\u5c3e\u200b\u8282\u70b9\u200b\n        node.prev = pred;\n        // \u200b\u901a\u8fc7\u200b cas \u200b\u5c06\u200b Node \u200b\u5bf9\u8c61\u200b\u52a0\u5165\u200b AQS \u200b\u961f\u5217\u200b\uff0c\u200b\u6210\u4e3a\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u3010\u200b\u5c3e\u200b\u63d2\u6cd5\u200b\u3011\n        if (compareAndSetTail(pred, node)) {\n            pred.next = node;// \u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\n            return node;\n        }\n    }\n    // \u200b\u521d\u59cb\u200b\u65f6\u961f\u200b\u5217\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u6216\u8005\u200b CAS \u200b\u5931\u8d25\u200b\u8fdb\u5165\u200b\u8fd9\u91cc\u200b\n    enq(node);\n    return node;\n}\n</code></pre> Java<pre><code>// AbstractQueuedSynchronizer#enq\nprivate Node enq(final Node node) {\n    // \u200b\u81ea\u65cb\u200b\u5165\u961f\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5165\u961f\u200b\u6210\u529f\u200b\u624d\u200b\u7ed3\u675f\u200b\u5faa\u73af\u200b\n    for (;;) {\n        Node t = tail;\n        // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u9501\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c\u200b\u4e14\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53ef\u80fd\u200b\u662f\u200b\u3010\u200b\u7b2c\u4e00\u4e2a\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u3011\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u3010\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5efa\u7acb\u200b\u961f\u5217\u200b\u3011\n        if (t == null) {\n            // \u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u3010\u200b\u54d1\u5143\u200b\u8282\u70b9\u200b\u3011\uff0c\u200b\u5934\u5c3e\u200b\u6307\u9488\u200b\u90fd\u200b\u6307\u5411\u200b\u8be5\u200b\u8282\u70b9\u200b\n            if (compareAndSetHead(new Node()))\n                tail = head;\n        } else {\n            // \u200b\u81ea\u65cb\u200b\u5230\u200b\u8fd9\u200b\uff0c\u200b\u666e\u901a\u200b\u5165\u961f\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u9996\u5148\u200b\u8d4b\u503c\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u3010\u200b\u5c3e\u200b\u63d2\u6cd5\u200b\u3011\n            node.prev = t;\n            // \u3010\u200b\u5728\u200b\u8bbe\u7f6e\u200b\u5b8c\u5c3e\u200b\u8282\u70b9\u200b\u540e\u200b\uff0c\u200b\u624d\u200b\u66f4\u65b0\u200b\u7684\u200b\u539f\u59cb\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6b64\u65f6\u200b\u4ece\u524d\u200b\u5f80\u540e\u200b\u904d\u5386\u200b\u4f1a\u200b\u4e22\u5931\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3011\n            if (compareAndSetTail(t, node)) {\n                //\u3010\u200b\u6b64\u65f6\u200b t.next  = null\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u91cc\u200b\u5df2\u7ecf\u200b CAS \u200b\u7ed3\u675f\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5e76\u200b\u4e0d\u662f\u200b\u5b89\u5168\u200b\u7684\u200b\u3011\n                t.next = node;\n                return t; // \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b node \u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\n            }\n        }\n    }\n}\n</code></pre> <p></p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u8282\u70b9\u200b\u52a0\u5165\u200b\u961f\u5217\u200b\u6210\u529f\u200b\uff0c\u200b\u8fdb\u5165\u200b AbstractQueuedSynchronizer#acquireQueued \u200b\u903b\u8f91\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b</li> <li>acquireQueued \u200b\u4f1a\u200b\u5728\u200b\u4e00\u4e2a\u200b\u81ea\u65cb\u200b\u4e2d\u200b\u4e0d\u65ad\u200b\u5c1d\u8bd5\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0c\u200b\u5931\u8d25\u200b\u540e\u200b\u8fdb\u5165\u200b park \u200b\u963b\u585e\u200b</li> <li>\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u5728\u200b head \u200b\u8282\u70b9\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u518d\u6b21\u200b tryAcquire \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0cstate \u200b\u4ecd\u4e3a\u200b 1 \u200b\u5219\u200b\u5931\u8d25\u200b\uff08\u200b\u7b2c\u4e09\u6b21\u200b\uff09</li> </ul> Java<pre><code>final boolean acquireQueued(final Node node, int arg) {\n    // true \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u62a2\u5360\u200b\u9501\u200b\u5931\u8d25\u200b\uff0cfalse \u200b\u8868\u793a\u200b\u6210\u529f\u200b\n    boolean failed = true;\n    try {\n        // \u200b\u4e2d\u65ad\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u4e2d\u65ad\u200b\n        boolean interrupted = false;\n        for (;;) {\n            // \u200b\u83b7\u5f97\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\n            final Node p = node.predecessor();\n            // \u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u662f\u200b head, FIFO \u200b\u961f\u5217\u200b\u7684\u200b\u7279\u6027\u200b\u8868\u793a\u200b\u8f6e\u200b\u5230\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u53bb\u200b\u83b7\u53d6\u200b\u9501\u200b\n            if (p == head &amp;&amp; tryAcquire(arg)) {\n                // \u200b\u83b7\u53d6\u200b\u6210\u529f\u200b, \u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u81ea\u5df1\u200b\u7684\u200b node \u200b\u4e3a\u200b head\n                setHead(node);\n                p.next = null; // help GC\n                // \u200b\u8868\u793a\u200b\u62a2\u5360\u200b\u9501\u200b\u6210\u529f\u200b\n                failed = false;\n                // \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u4e2d\u65ad\u200b\n                return interrupted;\n            }\n            // \u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5e94\u5f53\u200b park\uff0c\u200b\u8fd4\u56de\u200b false \u200b\u540e\u200b\u9700\u8981\u200b\u65b0\u4e00\u8f6e\u200b\u7684\u200b\u5faa\u73af\u200b\uff0c\u200b\u8fd4\u56de\u200b true \u200b\u8fdb\u5165\u200b\u6761\u4ef6\u200b\u4e8c\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt())\n                // \u200b\u6761\u4ef6\u200b\u4e8c\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6253\u65ad\u200b\u8fd4\u56de\u200b false \u200b\u4e0d\u200b\u8fdb\u5165\u200b\u8fd9\u91cc\u200b\u7684\u200b\u903b\u8f91\u200b\n                // \u3010\u200b\u5c31\u7b97\u200b\u88ab\u200b\u6253\u65ad\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u5faa\u73af\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u8fd4\u56de\u200b\u3011\n                interrupted = true;\n        }\n    } finally {\n        // \u3010\u200b\u53ef\u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\u624d\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u8be5\u200b\u903b\u8f91\u200b\u3011\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n</code></pre> <ul> <li>\u200b\u8fdb\u5165\u200b shouldParkAfterFailedAcquire \u200b\u903b\u8f91\u200b\uff0c\u200b\u5c06\u200b\u524d\u9a71\u200b node \u200b\u7684\u200b waitStatus \u200b\u6539\u4e3a\u200b -1\uff0c\u200b\u8fd4\u56de\u200b false\uff1bwaitStatus \u200b\u4e3a\u200b -1 \u200b\u7684\u200b\u8282\u70b9\u200b\u7528\u6765\u200b\u5524\u9192\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n    int ws = pred.waitStatus;\n    // \u200b\u8868\u793a\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u662f\u200b\u4e2a\u200b\u53ef\u4ee5\u200b\u5524\u9192\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u8fd4\u56de\u200b true\n    if (ws == Node.SIGNAL)\n        return true;\n    // \u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u5904\u4e8e\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\uff0c\u200b\u9700\u8981\u200b\u3010\u200b\u5220\u9664\u200b\u524d\u9762\u200b\u6240\u6709\u200b\u53d6\u6d88\u200b\u7684\u200b\u8282\u70b9\u200b\u3011, \u200b\u8fd4\u56de\u200b\u5230\u200b\u5916\u5c42\u200b\u5faa\u73af\u200b\u91cd\u8bd5\u200b\n    if (ws &gt; 0) {\n        do {\n            node.prev = pred = pred.prev;\n        } while (pred.waitStatus &gt; 0);\n        // \u200b\u83b7\u53d6\u200b\u5230\u200b\u975e\u200b\u53d6\u6d88\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u8fde\u63a5\u200b\u4e0a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\n        pred.next = node;\n    // \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b node \u200b\u7684\u200b waitStatus \u200b\u662f\u200b 0\uff0c\u200b\u8fdb\u5165\u200b\u8fd9\u91cc\u200b\u7684\u200b\u903b\u8f91\u200b\n    } else {\n        // \u3010\u200b\u8bbe\u7f6e\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u72b6\u6001\u200b\u4e3a\u200b Node.SIGNAL\u3011\uff0c\u200b\u8fd4\u56de\u200b\u5916\u5c42\u200b\u5faa\u73af\u200b\u91cd\u8bd5\u200b\n        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n    }\n    // \u200b\u8fd4\u56de\u200b\u4e0d\u200b\u5e94\u8be5\u200b park\uff0c\u200b\u518d\u6b21\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\n    return false;\n}\n</code></pre> <ul> <li>shouldParkAfterFailedAcquire \u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u56de\u5230\u200b acquireQueued \uff0c\u200b\u518d\u6b21\u200b tryAcquire \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u8fd9\u65f6\u200b state \u200b\u4ecd\u4e3a\u200b 1 \u200b\u83b7\u53d6\u200b\u5931\u8d25\u200b\uff08\u200b\u7b2c\u56db\u6b21\u200b\uff09</li> <li>\u200b\u5f53\u200b\u518d\u6b21\u200b\u8fdb\u5165\u200b shouldParkAfterFailedAcquire \u200b\u65f6\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u5176\u200b\u524d\u9a71\u200b node \u200b\u7684\u200b waitStatus \u200b\u5df2\u7ecf\u200b\u662f\u200b -1 \u200b\u4e86\u200b\uff0c\u200b\u8fd4\u56de\u200b true</li> <li>\u200b\u8fdb\u5165\u200b parkAndCheckInterrupt\uff0c Thread-1 park\uff08\u200b\u7070\u8272\u200b\u8868\u793a\u200b\uff09</li> </ul> Java<pre><code>private final boolean parkAndCheckInterrupt() {\n    // \u200b\u963b\u585e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\u5df2\u7ecf\u200b\u662f\u200b true, \u200b\u5219\u200b park \u200b\u4f1a\u200b\u5931\u6548\u200b\n    LockSupport.park(this);\n    // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\n    return Thread.interrupted();\n}\n</code></pre> <ul> <li>\u200b\u518d\u6709\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u7ecf\u5386\u200b\u7ade\u4e89\u200b\u5931\u8d25\u200b\u540e\u200b\uff1a</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_154","title":"\u89e3\u9501","text":"<p>ReentrantLock#unlock\uff1a\u200b\u91ca\u653e\u200b\u9501\u200b</p> Java<pre><code>public void unlock() {\n    sync.release(1);\n}\n</code></pre> <p>Thread-0 \u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200b release \u200b\u6d41\u7a0b\u200b</p> <ul> <li>\u200b\u8fdb\u5165\u200b tryRelease\uff0c\u200b\u8bbe\u7f6e\u200b exclusiveOwnerThread \u200b\u4e3a\u200b null\uff0cstate = 0</li> <li>\u200b\u5f53\u524d\u200b\u961f\u5217\u200b\u4e0d\u200b\u4e3a\u200b null\uff0c\u200b\u5e76\u4e14\u200b head \u200b\u7684\u200b waitStatus = -1\uff0c\u200b\u8fdb\u5165\u200b unparkSuccessor</li> </ul> Java<pre><code>// AbstractQueuedSynchronizer#release\npublic final boolean release(int arg) {\n    // \u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u9501\u200b\uff0ctryRelease \u200b\u8fd4\u56de\u200b true \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u3010\u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u91cd\u5165\u200b\u7684\u200b\u91ca\u653e\u200b\u4e86\u200b\u3011\n    if (tryRelease(arg)) {\n        // \u200b\u961f\u5217\u200b\u5934\u200b\u8282\u70b9\u200b\n        Node h = head;\n        // \u200b\u5934\u200b\u8282\u70b9\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u662f\u200b\u7a7a\u200b\uff1f\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u9501\u200b\u7ade\u4e89\u200b\uff0c\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b\u54d1\u5143\u200b\u8282\u70b9\u200b\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u6709\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u9700\u8981\u200b\u5524\u9192\u200b head \u200b\u8282\u70b9\u200b\u540e\u9762\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n        if (h != null &amp;&amp; h.waitStatus != 0)\n            unparkSuccessor(h);\n        return true;\n    }    \n    return false;\n}\n</code></pre> Java<pre><code>// ReentrantLock.Sync#tryRelease\nprotected final boolean tryRelease(int releases) {\n    // \u200b\u51cf\u53bb\u200b\u91ca\u653e\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u91cd\u200b\u5165\u200b\n    int c = getState() - releases;\n    // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u662f\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u62a5\u9519\u200b\n    if (Thread.currentThread() != getExclusiveOwnerThread())\n        throw new IllegalMonitorStateException();\n    // \u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\u9501\u200b\n    boolean free = false;\n    // \u200b\u652f\u6301\u200b\u9501\u200b\u91cd\u5165\u200b, \u200b\u53ea\u6709\u200b state \u200b\u51cf\u200b\u4e3a\u200b 0, \u200b\u624d\u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\u9501\u200b\u6210\u529f\u200b\n    if (c == 0) {\n        free = true;\n        setExclusiveOwnerThread(null);\n    }\n    // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c31\u662f\u200b\u6301\u6709\u200b\u9501\u7ebf\u200b\u7a0b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u66f4\u65b0\u200b\u9501\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b CAS\n    setState(c);\n    return free;\n}\n</code></pre> <ul> <li>\u200b\u8fdb\u5165\u200b AbstractQueuedSynchronizer#unparkSuccessor \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5524\u9192\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b</li> <li>\u200b\u627e\u5230\u200b\u961f\u5217\u200b\u4e2d\u8ddd\u79bb\u200b head \u200b\u6700\u8fd1\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6ca1\u200b\u53d6\u6d88\u200b\u7684\u200b Node\uff0cunpark \u200b\u6062\u590d\u200b\u5176\u200b\u8fd0\u884c\u200b\uff0c\u200b\u672c\u4f8b\u200b\u4e2d\u5373\u200b\u4e3a\u200b Thread-1</li> <li>\u200b\u56de\u5230\u200b Thread-1 \u200b\u7684\u200b acquireQueued \u200b\u6d41\u7a0b\u200b</li> </ul> Java<pre><code>private void unparkSuccessor(Node node) {\n    // \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\n    int ws = node.waitStatus;    \n    if (ws &lt; 0)        \n        // \u3010\u200b\u5c1d\u8bd5\u200b\u91cd\u7f6e\u200b\u72b6\u6001\u200b\u4e3a\u200b 0\u3011\uff0c\u200b\u56e0\u4e3a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u8981\u200b\u5b8c\u6210\u200b\u5bf9\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\u7684\u200b\u5524\u9192\u200b\u4efb\u52a1\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b -1 \u200b\u4e86\u200b\n        compareAndSetWaitStatus(node, ws, 0);    \n    // \u200b\u627e\u5230\u200b\u9700\u8981\u200b unpark \u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b    \n    Node s = node.next;    \n    // \u200b\u5df2\u200b\u53d6\u6d88\u200b\u7684\u200b\u8282\u70b9\u200b\u4e0d\u80fd\u200b\u5524\u9192\u200b\uff0c\u200b\u9700\u8981\u200b\u627e\u5230\u200b\u8ddd\u79bb\u200b\u5934\u200b\u8282\u70b9\u200b\u6700\u8fd1\u200b\u7684\u200b\u975e\u200b\u53d6\u6d88\u200b\u7684\u200b\u8282\u70b9\u200b\n    if (s == null || s.waitStatus &gt; 0) {\n        s = null;\n        // AQS \u200b\u961f\u5217\u200b\u3010\u200b\u4ece\u540e\u200b\u81f3\u200b\u524d\u200b\u3011\u200b\u627e\u200b\u9700\u8981\u200b unpark \u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u76f4\u5230\u200b t == \u200b\u5f53\u524d\u200b\u7684\u200b node \u200b\u4e3a\u6b62\u200b\uff0c\u200b\u627e\u200b\u4e0d\u5230\u200b\u5c31\u200b\u4e0d\u200b\u5524\u9192\u200b\u4e86\u200b\n        for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)\n            // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u72b6\u6001\u200b\u9700\u8981\u200b\u88ab\u200b\u5524\u9192\u200b\n            if (t.waitStatus &lt;= 0)\n                // \u200b\u7f6e\u6362\u200b\u5f15\u7528\u200b\n                s = t;\n    }\n    // \u3010\u200b\u627e\u5230\u200b\u5408\u9002\u200b\u7684\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5524\u9192\u200b\u7684\u200b node\uff0c\u200b\u5219\u200b\u5524\u9192\u200b\u7ebf\u7a0b\u200b\u3011\n    if (s != null)\n        LockSupport.unpark(s.thread);\n}\n</code></pre> <p>\u200b\u4ece\u540e\u200b\u5411\u524d\u200b\u7684\u200b\u5524\u9192\u200b\u7684\u200b\u539f\u56e0\u200b\uff1aenq \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u8282\u70b9\u200b\u662f\u200b\u5c3e\u200b\u63d2\u6cd5\u200b\uff0c\u200b\u9996\u5148\u200b\u8d4b\u503c\u200b\u7684\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b next \u200b\u5e76\u200b\u6ca1\u6709\u200b\u6307\u5411\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u4ece\u524d\u200b\u904d\u5386\u200b\u4f1a\u200b\u4e22\u5931\u200b\u5c3e\u200b\u8282\u70b9\u200b</p> <ul> <li>\u200b\u5524\u9192\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4ece\u200b park \u200b\u4f4d\u7f6e\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u52a0\u9501\u200b\u6210\u529f\u200b\uff08\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\uff09\uff0c\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b</li> <li>exclusiveOwnerThread \u200b\u4e3a\u200b Thread-1\uff0cstate = 1</li> <li>head \u200b\u6307\u5411\u200b\u521a\u521a\u200b Thread-1 \u200b\u6240\u5728\u200b\u7684\u200b Node\uff0c\u200b\u8be5\u200b Node \u200b\u4f1a\u200b\u6e05\u7a7a\u200b Thread</li> <li>\u200b\u539f\u672c\u200b\u7684\u200b head \u200b\u56e0\u4e3a\u200b\u4ece\u200b\u94fe\u8868\u200b\u65ad\u5f00\u200b\uff0c\u200b\u800c\u200b\u53ef\u200b\u88ab\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff08\u200b\u56fe\u4e2d\u200b\u6709\u200b\u9519\u8bef\u200b\uff0c\u200b\u539f\u6765\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b waitStatus \u200b\u88ab\u200b\u6539\u4e3a\u200b 0 \u200b\u4e86\u200b\uff09</li> </ul> <p></p> <ul> <li>\u200b\u5982\u679c\u200b\u8fd9\u65f6\u200b\u6709\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u7ade\u4e89\u200b\uff08\u200b\u975e\u200b\u516c\u5e73\u200b\uff09\uff0c\u200b\u4f8b\u5982\u200b\u8fd9\u65f6\u200b\u6709\u200b Thread-4 \u200b\u6765\u200b\u4e86\u200b\u5e76\u200b\u62a2\u5360\u200b\u4e86\u200b\u9501\u200b</li> <li>Thread-4 \u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b exclusiveOwnerThread\uff0cstate = 1</li> <li>Thread-1 \u200b\u518d\u6b21\u200b\u8fdb\u5165\u200b acquireQueued \u200b\u6d41\u7a0b\u200b\uff0c\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u91cd\u65b0\u200b\u8fdb\u5165\u200b park \u200b\u963b\u585e\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_155","title":"\u516c\u5e73\u200b\u539f\u7406","text":"<p>\u200b\u4e0e\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u4e3b\u8981\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b tryAcquire \u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5148\u200b\u68c0\u67e5\u200b AQS \u200b\u961f\u5217\u200b\u4e2d\u200b\u662f\u5426\u200b\u6709\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\uff0c\u200b\u6ca1\u6709\u200b\u624d\u200b\u53bb\u200b CAS \u200b\u7ade\u4e89\u200b</p> Java<pre><code>static final class FairSync extends Sync {\n    private static final long serialVersionUID = -3000897897090466540L;\n    final void lock() {\n        acquire(1);\n    }\n\n    protected final boolean tryAcquire(int acquires) {\n        final Thread current = Thread.currentThread();\n        int c = getState();\n        if (c == 0) {\n            // \u200b\u5148\u200b\u68c0\u67e5\u200b AQS \u200b\u961f\u5217\u200b\u4e2d\u200b\u662f\u5426\u200b\u6709\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b, \u200b\u6ca1\u6709\u200b(false)\u200b\u624d\u200b\u53bb\u200b\u7ade\u4e89\u200b\n            if (!hasQueuedPredecessors() &amp;&amp;\n                compareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        }\n        // \u200b\u9501\u200b\u91cd\u5165\u200b\n        return false;\n    }\n}\n</code></pre> Java<pre><code>public final boolean hasQueuedPredecessors() {    \n    Node t = tail;\n    Node h = head;\n    Node s;    \n    // \u200b\u5934\u5c3e\u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u94fe\u8868\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u8fd4\u56de\u200bfalse\n    return h != t &amp;&amp;\n        // \u200b\u5934\u5c3e\u200b\u4e4b\u95f4\u200b\u6709\u200b\u8282\u70b9\u200b\uff0c\u200b\u5224\u65ad\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u662f\u4e0d\u662f\u200b\u7a7a\u200b\n        // \u200b\u4e0d\u662f\u200b\u7a7a\u200b\u8fdb\u5165\u200b\u6700\u540e\u200b\u7684\u200b\u5224\u65ad\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u662f\u200b\u672c\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0d\u662f\u200b\u8fd4\u56de\u200b true\uff0c\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u6709\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\n        ((s = h.next) == null || s.thread != Thread.currentThread());\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_156","title":"\u53ef\u200b\u91cd\u5165","text":"<p>\u200b\u53ef\u200b\u91cd\u5165\u200b\u662f\u200b\u6307\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5982\u679c\u200b\u9996\u6b21\u200b\u83b7\u5f97\u200b\u4e86\u200b\u8fd9\u200b\u628a\u200b\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u662f\u200b\u8fd9\u200b\u628a\u200b\u9501\u200b\u7684\u200b\u62e5\u6709\u8005\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6709\u200b\u6743\u5229\u200b\u518d\u6b21\u200b\u83b7\u53d6\u200b\u8fd9\u200b\u628a\u200b\u9501\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7b2c\u4e8c\u6b21\u200b\u83b7\u5f97\u200b\u9501\u65f6\u200b\uff0c\u200b\u81ea\u5df1\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u9501\u200b\u6321\u4f4f\u200b\uff0c\u200b\u76f4\u63a5\u200b\u9020\u6210\u200b\u6b7b\u9501\u200b</p> <p>\u200b\u6e90\u7801\u200b\u89e3\u6790\u200b\u53c2\u8003\u200b\uff1a<code>nonfairTryAcquire(int acquires))</code> \u200b\u548c\u200b <code>tryRelease(int releases)</code></p> Java<pre><code>static ReentrantLock lock = new ReentrantLock();\npublic static void main(String[] args) {\n    method1();\n}\npublic static void method1() {\n    lock.lock();\n    try {\n        System.out.println(Thread.currentThread().getName() + \" execute method1\");\n        method2();\n    } finally {\n        lock.unlock();\n    }\n}\npublic static void method2() {\n    lock.lock();\n    try {\n        System.out.println(Thread.currentThread().getName() + \" execute method2\");\n    } finally {\n        lock.unlock();\n    }\n}\n</code></pre> <p>\u200b\u5728\u200b Lock \u200b\u65b9\u6cd5\u200b\u52a0\u200b\u4e24\u628a\u200b\u9501\u4f1a\u200b\u662f\u200b\u4ec0\u4e48\u200b\u60c5\u51b5\u200b\u5462\u200b\uff1f</p> <ul> <li>\u200b\u52a0\u9501\u200b\u4e24\u6b21\u200b\u89e3\u9501\u200b\u4e24\u6b21\u200b\uff1a\u200b\u6b63\u5e38\u200b\u6267\u884c\u200b</li> <li>\u200b\u52a0\u9501\u200b\u4e24\u6b21\u200b\u89e3\u9501\u200b\u4e00\u6b21\u200b\uff1a\u200b\u7a0b\u5e8f\u200b\u76f4\u63a5\u200b\u5361\u6b7b\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e0d\u80fd\u200b\u51fa\u6765\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u8bf4\u660e\u200b\u7533\u8bf7\u200b\u51e0\u628a\u200b\u9501\u200b\uff0c\u200b\u6700\u540e\u200b\u9700\u8981\u200b\u89e3\u9664\u200b\u51e0\u628a\u200b\u9501\u200b</li> <li>\u200b\u52a0\u9501\u200b\u4e00\u6b21\u200b\u89e3\u9501\u200b\u4e24\u6b21\u200b\uff1a\u200b\u8fd0\u884c\u200b\u7a0b\u5e8f\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u62a5\u9519\u200b</li> </ul> Java<pre><code>public void getLock() {\n    lock.lock();\n    lock.lock();\n    try {\n        System.out.println(Thread.currentThread().getName() + \"\\t get Lock\");\n    } finally {\n        lock.unlock();\n        //lock.unlock();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_157","title":"\u53ef\u200b\u6253\u65ad","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_158","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p><code>public void lockInterruptibly()</code>\uff1a\u200b\u83b7\u5f97\u200b\u53ef\u200b\u6253\u65ad\u200b\u7684\u200b\u9501\u200b</p> <ul> <li>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7ade\u4e89\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5c31\u200b\u4f1a\u200b\u83b7\u53d6\u200b lock \u200b\u5bf9\u8c61\u200b\u9501\u200b</li> <li>\u200b\u5982\u679c\u200b\u6709\u200b\u7ade\u4e89\u200b\u5c31\u200b\u8fdb\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7528\u200b interrupt \u200b\u6253\u65ad\u200b</li> </ul> <p>\u200b\u6ce8\u610f\u200b\uff1a\u200b\u5982\u679c\u200b\u662f\u200b\u4e0d\u53ef\u200b\u4e2d\u65ad\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5373\u4f7f\u200b\u4f7f\u7528\u200b\u4e86\u200b interrupt \u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u8ba9\u200b\u7b49\u5f85\u200b\u72b6\u6001\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e2d\u65ad\u200b</p> Java<pre><code>public static void main(String[] args) throws InterruptedException {    \n    ReentrantLock lock = new ReentrantLock();    \n    Thread t1 = new Thread(() -&gt; {        \n        try {            \n            System.out.println(\"\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\");            \n            lock.lockInterruptibly();        \n        } catch (InterruptedException e) {            \n            System.out.println(\"\u200b\u6ca1\u6709\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\uff0c\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\");            \n            return;        \n        }        \n        try {            \n            System.out.println(\"\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\");        \n        } finally {            \n            lock.unlock();        \n        }    \n    }, \"t1\");    \n    lock.lock();    \n    t1.start();    \n    Thread.sleep(2000);    \n    System.out.println(\"\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u8fdb\u884c\u200b\u6253\u65ad\u200b\u9501\u200b\");    \n    t1.interrupt();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_159","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"<ul> <li>\u200b\u4e0d\u53ef\u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b\uff1a\u200b\u5373\u4f7f\u200b\u5b83\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u4ecd\u4f1a\u200b\u9a7b\u7559\u200b\u5728\u200b AQS \u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\uff0c\u200b\u4e00\u76f4\u200b\u8981\u200b\u7b49\u5230\u200b\u83b7\u5f97\u200b\u9501\u540e\u200b\u624d\u80fd\u200b\u5f97\u77e5\u200b\u81ea\u5df1\u200b\u88ab\u200b\u6253\u65ad\u200b\u4e86\u200b</li> </ul> Java<pre><code>public final void acquire(int arg) {    \n    if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))//\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b        \n        // \u200b\u5982\u679c\u200bacquireQueued\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b interrupted = true        \n        selfInterrupt();\n}\nstatic void selfInterrupt() {\n    // \u200b\u77e5\u9053\u200b\u81ea\u5df1\u200b\u88ab\u200b\u6253\u65ad\u200b\u4e86\u200b\uff0c\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u4ea7\u751f\u200b\u4e00\u6b21\u200b\u4e2d\u65ad\u200b\u5b8c\u6210\u200b\u4e2d\u65ad\u200b\u6548\u679c\u200b\n    Thread.currentThread().interrupt();\n}\n</code></pre> Java<pre><code>final boolean acquireQueued(final Node node, int arg) {    \n    try {        \n        boolean interrupted = false;        \n        for (;;) {            \n            final Node p = node.predecessor();            \n            if (p == head &amp;&amp; tryAcquire(arg)) {                \n                setHead(node);                \n                p.next = null; // help GC                \n                failed = false;                \n                // \u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u83b7\u5f97\u200b\u9501\u540e\u200b, \u200b\u624d\u80fd\u200b\u8fd4\u56de\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\n                return interrupted;            \n            }            \n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()){\n                // \u200b\u6761\u4ef6\u200b\u4e8c\u4e2d\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u88ab\u200b\u6253\u65ad\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u8bbe\u7f6e\u200b\u4e2d\u65ad\u200b\u6807\u8bb0\u200b\u4e3a\u200b true\uff0c\u3010\u200b\u83b7\u53d6\u200b\u9501\u540e\u200b\u8fd4\u56de\u200b\u3011\n                interrupted = true;  \n            }                  \n        } \n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n private final boolean parkAndCheckInterrupt() {    \n     // \u200b\u963b\u585e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\u5df2\u7ecf\u200b\u662f\u200b true, \u200b\u5219\u200b park \u200b\u4f1a\u200b\u5931\u6548\u200b\n     LockSupport.park(this);    \n     // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u6e05\u9664\u200b\u6253\u65ad\u200b\u6807\u8bb0\u200b\uff0c\u200b\u88ab\u200b\u6253\u65ad\u200b\u8fd4\u56de\u200btrue\n     return Thread.interrupted();\n }\n</code></pre> <ul> <li>\u200b\u53ef\u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b\uff1aAbstractQueuedSynchronizer#acquireInterruptibly\uff0c\u200b\u88ab\u200b\u6253\u65ad\u200b\u540e\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> </ul> Java<pre><code>public void lockInterruptibly() throws InterruptedException {    \n    sync.acquireInterruptibly(1);\n}\npublic final void acquireInterruptibly(int arg) {\n    // \u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6253\u65ad\u200b\u4e86\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b false\n    if (Thread.interrupted())\n      throw new InterruptedException();\n    if (!tryAcquire(arg))\n        // \u200b\u6ca1\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200b\u8fd9\u91cc\u200b\n        doAcquireInterruptibly(arg);\n}\n</code></pre> Java<pre><code>private void doAcquireInterruptibly(int arg) throws InterruptedException {\n    // \u200b\u8fd4\u56de\u200b\u5c01\u88c5\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8282\u70b9\u200b\n    final Node node = addWaiter(Node.EXCLUSIVE);\n    boolean failed = true;\n    try {\n        for (;;) {\n            //...\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt())\n                // \u3010\u200b\u5728\u200b park \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5982\u679c\u200b\u88ab\u200b interrupt \u200b\u4f1a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u3011, \u200b\u800c\u200b\u4e0d\u4f1a\u200b\u518d\u6b21\u200b\u8fdb\u5165\u200b\u5faa\u73af\u200b\u83b7\u53d6\u200b\u9501\u540e\u200b\u624d\u200b\u5b8c\u6210\u200b\u6253\u65ad\u200b\u6548\u679c\u200b\n                throw new InterruptedException();\n        }    \n    } finally {\n        // \u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u524d\u4f1a\u200b\u8fdb\u5165\u200b\u8fd9\u91cc\u200b\n        if (failed)\n            // \u200b\u53d6\u6d88\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8282\u70b9\u200b\n            cancelAcquire(node);\n    }\n}\n</code></pre> Java<pre><code>// \u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u51fa\u961f\u200b\u7684\u200b\u903b\u8f91\u200b\nprivate void cancelAcquire(Node node) {\n    // \u200b\u5224\u7a7a\u200b\n    if (node == null)\n        return;\n  // \u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5c01\u88c5\u200b\u7684\u200b Thread \u200b\u7f6e\u200b\u4e3a\u200b\u7a7a\u200b\n    node.thread = null;\n  // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u53d6\u6d88\u200b\u7684\u200b node \u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\n    Node pred = node.prev;\n    // \u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u4e5f\u200b\u88ab\u200b\u53d6\u6d88\u200b\u4e86\u200b\uff0c\u200b\u5faa\u73af\u200b\u627e\u5230\u200b\u524d\u9762\u200b\u6700\u8fd1\u200b\u7684\u200b\u6ca1\u200b\u88ab\u200b\u53d6\u6d88\u200b\u7684\u200b\u8282\u70b9\u200b\n    while (pred.waitStatus &gt; 0)\n        node.prev = pred = pred.prev;\n\n  // \u200b\u83b7\u53d6\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u5f53\u524d\u200b node\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b waitStatus &gt; 0 \u200b\u7684\u200b\u8282\u70b9\u200b\n    Node predNext = pred.next;\n\n  // \u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b \u3010\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b 1\u3011\n    node.waitStatus = Node.CANCELLED;\n\n  // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5c3e\u200b\u8282\u70b9\u200b\n    if (node == tail &amp;&amp; compareAndSetTail(node, pred)) {\n        // \u200b\u628a\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u7f6e\u7a7a\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u76f4\u63a5\u200b\u628a\u200b\u6240\u6709\u200b\u7684\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u51fa\u961f\u200b\n        compareAndSetNext(pred, predNext, null);\n    } else {\n        // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e0d\u662f\u200b tail \u200b\u8282\u70b9\u200b\n        int ws;\n        // \u200b\u6761\u4ef6\u200b\u4e00\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e0d\u662f\u200b head.next \u200b\u8282\u70b9\u200b\n        if (pred != head &amp;&amp;\n            // \u200b\u5224\u65ad\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u662f\u4e0d\u662f\u200b -1\uff0c\u200b\u4e0d\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u524d\u9a71\u200b\u72b6\u6001\u200b\u53ef\u80fd\u200b\u662f\u200b 0 \u200b\u6216\u8005\u200b\u521a\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u53d6\u6d88\u200b\u6392\u961f\u200b\u4e86\u200b\n            ((ws = pred.waitStatus) == Node.SIGNAL ||\n             // \u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u4e0d\u662f\u200b -1\uff0c\u200b\u8bbe\u7f6e\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b -1\n             (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp;\n            // \u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u4e3a\u200bnull\n            pred.thread != null) {\n\n            Node next = node.next;\n            // \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u662f\u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b\n            if (next != null &amp;&amp; next.waitStatus &lt;= 0)\n                // \u200b\u628a\u200b \u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u3010\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u5220\u9664\u200b\u4e86\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u3011\n                compareAndSetNext(pred, predNext, next);\n        } else {\n            // \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b head.next \u200b\u8282\u70b9\u200b\uff0c\u200b\u5524\u9192\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n            unparkSuccessor(node);\n        }\n        node.next = node; // help GC\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_160","title":"\u9501\u200b\u8d85\u65f6","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_161","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p><code>public boolean tryLock()</code>\uff1a\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u83b7\u53d6\u200b\u5230\u200b\u8fd4\u56de\u200b true\uff0c\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u76f4\u63a5\u200b\u653e\u5f03\u200b\uff0c\u200b\u4e0d\u200b\u8fdb\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b</p> <p><code>public boolean tryLock(long timeout, TimeUnit unit)</code>\uff1a\u200b\u5728\u200b\u7ed9\u5b9a\u200b\u65f6\u95f4\u200b\u5185\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u5c31\u200b\u9000\u51fa\u200b</p> <p>\u200b\u6ce8\u610f\u200b\uff1atryLock \u200b\u671f\u95f4\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u6253\u65ad\u200b</p> Java<pre><code>public static void main(String[] args) {\n    ReentrantLock lock = new ReentrantLock();\n    Thread t1 = new Thread(() -&gt; {\n        try {\n            if (!lock.tryLock(2, TimeUnit.SECONDS)) {\n                System.out.println(\"\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u9501\u200b\");\n                return;\n            }\n        } catch (InterruptedException e) {\n            System.out.println(\"\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u9501\u200b\");\n            return;\n        }\n        try {\n            log.debug(\"\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\");\n        } finally {\n            lock.unlock();\n        }\n    }, \"t1\");\n    lock.lock();\n    System.out.println(\"\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\");\n    t1.start();\n\n    Thread.sleep(1000);\n    try {\n        System.out.println(\"\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u91ca\u653e\u200b\u4e86\u200b\u9501\u200b\");\n    } finally {\n        lock.unlock();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_162","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"<ul> <li>\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\uff1a\u200b\u6307\u5b9a\u200b\u8d85\u65f6\u200b\u9650\u5236\u200b\u7684\u200b\u9608\u503c\u200b\uff0c\u200b\u5c0f\u4e8e\u200b\u8be5\u503c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u6302\u200b\u8d77\u200b</li> </ul> Java<pre><code>static final long spinForTimeoutThreshold = 1000L;\n</code></pre> <p>\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5c0f\u4e8e\u200b\u8be5\u503c\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u7981\u6b62\u200b\u6302\u200b\u8d77\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u963b\u585e\u200b\u5728\u200b\u5524\u9192\u200b\u7684\u200b\u6210\u672c\u200b\u592a\u9ad8\u200b\uff0c\u200b\u4e0d\u5982\u200b\u9009\u62e9\u200b\u81ea\u65cb\u200b\u7a7a\u8f6c\u200b</p> <ul> <li>tryLock()</li> </ul> Java<pre><code>public boolean tryLock() {   \n    // \u200b\u53ea\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\n    return sync.nonfairTryAcquire(1);\n}\n</code></pre> <ul> <li>tryLock(long timeout, TimeUnit unit)</li> </ul> Java<pre><code>public final boolean tryAcquireNanos(int arg, long nanosTimeout) {\n    if (Thread.interrupted())        \n        throw new InterruptedException();    \n    // tryAcquire \u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\n    return tryAcquire(arg) || doAcquireNanos(arg, nanosTimeout);\n}\nprotected final boolean tryAcquire(int acquires) {    \n    return nonfairTryAcquire(acquires);\n}\n</code></pre> Java<pre><code>private boolean doAcquireNanos(int arg, long nanosTimeout) {    \n    if (nanosTimeout &lt;= 0L)\n        return false;\n    // \u200b\u83b7\u53d6\u200b\u6700\u540e\u200b\u671f\u9650\u200b\u7684\u200b\u65f6\u95f4\u200b\u6233\u200b\n    final long deadline = System.nanoTime() + nanosTimeout;\n    //...\n    try {\n        for (;;) {\n            //...\n            // \u200b\u8ba1\u7b97\u200b\u8fd8\u200b\u9700\u200b\u7b49\u5f85\u200b\u7684\u200b\u65f6\u95f4\u200b\n            nanosTimeout = deadline - System.nanoTime();\n            if (nanosTimeout &lt;= 0L)   //\u200b\u65f6\u95f4\u200b\u5df2\u5230\u200b     \n                return false;\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;\n                // \u200b\u5982\u679c\u200b nanosTimeout \u200b\u5927\u4e8e\u200b\u8be5\u503c\u200b\uff0c\u200b\u624d\u200b\u6709\u200b\u963b\u585e\u200b\u7684\u200b\u610f\u4e49\u200b\uff0c\u200b\u5426\u5219\u200b\u76f4\u63a5\u200b\u81ea\u65cb\u200b\u4f1a\u200b\u597d\u70b9\u200b\n                nanosTimeout &gt; spinForTimeoutThreshold)\n                LockSupport.parkNanos(this, nanosTimeout);\n            // \u3010\u200b\u88ab\u200b\u6253\u65ad\u200b\u4f1a\u200b\u62a5\u200b\u5f02\u5e38\u200b\u3011\n            if (Thread.interrupted())\n                throw new InterruptedException();\n        }    \n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_163","title":"\u54f2\u5b66\u5bb6\u200b\u5c31\u9910","text":"Java<pre><code>public static void main(String[] args) {\n    Chopstick c1 = new Chopstick(\"1\");//...\n    Chopstick c5 = new Chopstick(\"5\");\n    new Philosopher(\"\u200b\u82cf\u683c\u62c9\u5e95\u200b\", c1, c2).start();\n    new Philosopher(\"\u200b\u67cf\u62c9\u56fe\u200b\", c2, c3).start();\n    new Philosopher(\"\u200b\u4e9a\u91cc\u58eb\u591a\u5fb7\u200b\", c3, c4).start();\n    new Philosopher(\"\u200b\u8d6b\u62c9\u514b\u5229\u7279\u200b\", c4, c5).start();    \n    new Philosopher(\"\u200b\u963f\u57fa\u7c73\u5fb7\u200b\", c5, c1).start();\n}\nclass Philosopher extends Thread {\n    Chopstick left;\n    Chopstick right;\n    public void run() {\n        while (true) {\n            // \u200b\u5c1d\u8bd5\u200b\u83b7\u5f97\u200b\u5de6\u624b\u200b\u7b77\u5b50\u200b\n            if (left.tryLock()) {\n                try {\n                    // \u200b\u5c1d\u8bd5\u200b\u83b7\u5f97\u200b\u53f3\u624b\u200b\u7b77\u5b50\u200b\n                    if (right.tryLock()) {\n                        try {\n                            System.out.println(\"eating...\");\n                            Thread.sleep(1000);\n                        } finally {\n                            right.unlock();\n                        }\n                    }\n                } finally {\n                    left.unlock();\n                }\n            }\n        }\n    }\n}\nclass Chopstick extends ReentrantLock {\n    String name;\n    public Chopstick(String name) {\n        this.name = name;\n    }\n    @Override\n    public String toString() {\n        return \"\u200b\u7b77\u5b50\u200b{\" + name + '}';\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_164","title":"\u6761\u4ef6\u200b\u53d8\u91cf","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_165","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>synchronized \u200b\u7684\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\uff0c\u200b\u662f\u200b\u5f53\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u65f6\u200b\u8fdb\u5165\u200b WaitSet \u200b\u7b49\u5f85\u200b\uff1bReentrantLock \u200b\u7684\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\u6bd4\u200b synchronized \u200b\u5f3a\u5927\u200b\u4e4b\u200b\u5904\u200b\u5728\u4e8e\u200b\u652f\u6301\u200b\u591a\u4e2a\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b</p> <p>ReentrantLock \u200b\u7c7b\u200b\u83b7\u53d6\u200b Condition \u200b\u5bf9\u8c61\u200b\uff1a<code>public Condition newCondition()</code></p> <p>Condition \u200b\u7c7b\u200b API\uff1a</p> <ul> <li><code>void await()</code>\uff1a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4ece\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u8fdb\u5165\u200b\u7b49\u5f85\u200b\u72b6\u6001\u200b\uff0c\u200b\u91ca\u653e\u200b\u9501\u200b</li> <li><code>void signal()</code>\uff1a\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200b\u7b49\u5f85\u200b\u5728\u200b Condition \u200b\u4e0a\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4f46\u662f\u200b\u5fc5\u987b\u200b\u83b7\u5f97\u200b\u4e0e\u200b\u8be5\u200b Condition \u200b\u76f8\u5173\u200b\u7684\u200b\u9501\u200b</li> </ul> <p>\u200b\u4f7f\u7528\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>await / signal \u200b\u524d\u200b\u9700\u8981\u200b\u83b7\u5f97\u200b\u9501\u200b</li> <li>await \u200b\u6267\u884c\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u91ca\u653e\u200b\u9501\u200b\u8fdb\u5165\u200b ConditionObject \u200b\u7b49\u5f85\u200b</li> <li>await \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u5524\u9192\u200b\u53bb\u200b\u91cd\u65b0\u200b\u7ade\u4e89\u200b lock \u200b\u9501\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u88ab\u200b\u6253\u65ad\u200b\u4f1a\u200b\u629b\u51fa\u200b\u4e2d\u65ad\u200b\u5f02\u5e38\u200b</li> <li>\u200b\u7ade\u4e89\u200b lock \u200b\u9501\u200b\u6210\u529f\u200b\u540e\u200b\uff0c\u200b\u4ece\u200b await \u200b\u540e\u200b\u7ee7\u7eed\u6267\u884c\u200b</li> </ul> Java<pre><code>public static void main(String[] args) throws InterruptedException {    \n    ReentrantLock lock = new ReentrantLock();\n    //\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b\n    Condition condition1 = lock.newCondition();\n    Condition condition2 = lock.newCondition();\n    new Thread(() -&gt; {\n        try {\n            lock.lock();\n            System.out.println(\"\u200b\u8fdb\u5165\u200b\u7b49\u5f85\u200b\");\n            //\u200b\u8fdb\u5165\u200b\u4f11\u606f\u5ba4\u200b\u7b49\u5f85\u200b\n            condition1.await();\n            System.out.println(\"\u200b\u88ab\u200b\u5524\u9192\u200b\u4e86\u200b\");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }    \n    }).start();\n    Thread.sleep(1000);\n    //\u200b\u53eb\u9192\u200b\n    new Thread(() -&gt; {\n        try {            \n            lock.lock();\n            //\u200b\u5524\u9192\u200b\n            condition2.signal();\n        } finally {\n            lock.unlock();\n        }\n    }).start();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_166","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#await","title":"await","text":"<p>\u200b\u603b\u4f53\u200b\u6d41\u7a0b\u200b\u662f\u200b\u5c06\u200b await \u200b\u7ebf\u7a0b\u200b\u5305\u88c5\u200b\u6210\u200b node \u200b\u8282\u70b9\u200b\u653e\u5165\u200b ConditionObject \u200b\u7684\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u5524\u9192\u200b\u5c31\u200b\u5c06\u200b node \u200b\u8f6c\u79fb\u200b\u5230\u200b AQS \u200b\u7684\u200b\u6267\u884c\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u7b49\u5f85\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Condition \u200b\u5bf9\u8c61\u200b\u90fd\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b</p> <ul> <li>\u200b\u5f00\u59cb\u200b Thread-0 \u200b\u6301\u6709\u200b\u9501\u200b\uff0c\u200b\u8c03\u7528\u200b await\uff0c\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b ConditionObject \u200b\u7b49\u5f85\u200b\uff0c\u200b\u76f4\u5230\u200b\u88ab\u200b\u5524\u9192\u200b\u6216\u200b\u6253\u65ad\u200b\uff0c\u200b\u8c03\u7528\u200b await \u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u662f\u200b\u6301\u9501\u200b\u72b6\u6001\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8bf4\u200b\u903b\u8f91\u200b\u91cc\u200b\u4e0d\u200b\u5b58\u5728\u200b\u5e76\u53d1\u200b</li> </ul> Java<pre><code>public final void await() throws InterruptedException {\n     // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u662f\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\uff0c\u200b\u662f\u200b\u5c31\u200b\u76f4\u63a5\u200b\u7ed9\u200b\u4e2a\u200b\u4e2d\u65ad\u200b\u5f02\u5e38\u200b\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    // \u200b\u5c06\u200b\u8c03\u7528\u200b await \u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5305\u88c5\u200b\u6210\u200b Node\uff0c\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5e76\u200b\u8fd4\u56de\u200b\n    Node node = addConditionWaiter();\n    // \u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\u8282\u70b9\u200b\u6301\u6709\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5524\u9192\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u3010\u200b\u6301\u6709\u200b\u9501\u200b\u3011\n    int savedState = fullyRelease(node);\n\n    // \u200b\u8bbe\u7f6e\u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u72b6\u6001\u200b\u7801\u4e3a\u200b 0\n    int interruptMode = 0;\n\n    // \u200b\u5982\u679c\u200b\u8be5\u200b\u8282\u70b9\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8f6c\u79fb\u200b\u81f3\u200b AQS \u200b\u963b\u585e\u200b\u961f\u5217\u200b, park \u200b\u963b\u585e\u200b\uff0c\u200b\u7b49\u5f85\u200b\u8fdb\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b\n    while (!isOnSyncQueue(node)) {\n        LockSupport.park(this);\n        // \u200b\u5982\u679c\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u9000\u51fa\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b node \u3010\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u8fc1\u79fb\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u3011\u200b\u5c3e\u90e8\u200b\uff0c\u200b\u72b6\u6001\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 0\n        if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)\n            break;\n    }\n    // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u9000\u51fa\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u8fdb\u5165\u200b\u3010\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u3011\n\n    // \u200b\u5c1d\u8bd5\u200b\u67aa\u9501\u200b\uff0c\u200b\u91ca\u653e\u200b\u4e86\u200b\u591a\u5c11\u200b\u9501\u200b\u5c31\u200b\u3010\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u591a\u5c11\u200b\u9501\u200b\u3011\uff0c\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\u5224\u65ad\u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b\n    if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)\n        interruptMode = REINTERRUPT;\n\n    // node \u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u65f6\u200b \u200b\u5982\u679c\u200b\u88ab\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u4e2d\u65ad\u200b\u5524\u9192\u200b\uff0c\u200b\u4f1a\u200b\u52a0\u5165\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u4f46\u662f\u200b\u5e76\u672a\u200b\u8bbe\u200b nextWaiter = null\n    if (node.nextWaiter != null)\n        // \u200b\u6e05\u7406\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u6240\u6709\u200b\u5df2\u200b\u53d6\u6d88\u200b\u7684\u200b Node\n        unlinkCancelledWaiters();\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u6302\u200b\u8d77\u200b\u671f\u95f4\u200b\u53d1\u751f\u200b\u8fc7\u200b\u4e2d\u65ad\u200b\n    if (interruptMode != 0)\n        // \u200b\u5e94\u7528\u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b\n        reportInterruptAfterWait(interruptMode);\n}\n</code></pre> Java<pre><code>// \u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b - \u200b\u5728\u200b\u9000\u51fa\u200b\u7b49\u5f85\u200b\u65f6\u200b\u91cd\u65b0\u200b\u8bbe\u7f6e\u200b\u6253\u65ad\u200b\u72b6\u6001\u200b\nprivate static final int REINTERRUPT = 1;\n// \u200b\u6253\u65ad\u200b\u6a21\u5f0f\u200b - \u200b\u5728\u200b\u9000\u51fa\u200b\u7b49\u5f85\u200b\u65f6\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\nprivate static final int THROW_IE = -1;\n</code></pre> <p></p> <ul> <li>\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b Node \u200b\u72b6\u6001\u200b\u4e3a\u200b -2\uff08Node.CONDITION\uff09\uff0c\u200b\u5173\u8054\u200b Thread-0\uff0c\u200b\u52a0\u5165\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u5c3e\u90e8\u200b</li> </ul> Java<pre><code>private Node addConditionWaiter() {\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5230\u200b\u5c40\u90e8\u53d8\u91cf\u200b t \u200b\u4e2d\u200b\n    Node t = lastWaiter;\n    // \u200b\u5f53\u524d\u200b\u961f\u5217\u200b\u4e2d\u200b\u4e0d\u662f\u200b\u7a7a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u4e0d\u662f\u200b CONDITION\uff08-2\uff09\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u53d1\u751f\u200b\u4e86\u200b\u4e2d\u65ad\u200b\n    if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) {\n        // \u200b\u6e05\u7406\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u6240\u6709\u200b\u5df2\u200b\u53d6\u6d88\u200b\u7684\u200b Node\n        unlinkCancelledWaiters();\n        // \u200b\u6e05\u7406\u200b\u5b8c\u6210\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b \u200b\u5c3e\u200b\u8282\u70b9\u200b \u200b\u7684\u200b\u5f15\u7528\u200b\n        t = lastWaiter;\n    }\n    // \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5173\u8054\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u65b0\u200b node, \u200b\u8bbe\u7f6e\u200b\u72b6\u6001\u200b\u4e3a\u200b CONDITION(-2)\uff0c\u200b\u6dfb\u52a0\u200b\u81f3\u200b\u961f\u5217\u200b\u5c3e\u90e8\u200b\n    Node node = new Node(Thread.currentThread(), Node.CONDITION);\n    if (t == null)\n        firstWaiter = node;       // \u200b\u7a7a\u200b\u961f\u5217\u200b\u76f4\u63a5\u200b\u653e\u5728\u200b\u961f\u9996\u200b\u3010\u200b\u4e0d\u7528\u200bCAS\u200b\u56e0\u4e3a\u200b\u6267\u884c\u200b\u7ebf\u7a0b\u200b\u662f\u6301\u200b\u9501\u7ebf\u200b\u7a0b\u200b\uff0c\u200b\u5e76\u53d1\u200b\u5b89\u5168\u200b\u3011\n    else\n        t.nextWaiter = node;  // \u200b\u975e\u7a7a\u200b\u961f\u5217\u200b\u961f\u5c3e\u200b\u8ffd\u52a0\u200b\n    lastWaiter = node;            // \u200b\u66f4\u65b0\u200b\u961f\u5c3e\u200b\u7684\u200b\u5f15\u7528\u200b\n    return node;\n}\n</code></pre> Java<pre><code>// \u200b\u6e05\u7406\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u6240\u6709\u200b\u5df2\u200b\u53d6\u6d88\u200b\uff08\u200b\u4e0d\u662f\u200bCONDITION\uff09\u200b\u7684\u200b node\uff0c\u3010\u200b\u94fe\u8868\u200b\u5220\u9664\u200b\u7684\u200b\u903b\u8f91\u200b\u3011\nprivate void unlinkCancelledWaiters() {\n    // \u200b\u4ece\u5934\u200b\u8282\u70b9\u200b\u5f00\u59cb\u200b\u904d\u5386\u200b\u3010FIFO\u3011\n    Node t = firstWaiter;\n    // \u200b\u6307\u5411\u200b\u6b63\u5e38\u200b\u7684\u200b CONDITION \u200b\u8282\u70b9\u200b\n    Node trail = null;\n    // \u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0d\u7a7a\u200b\n    while (t != null) {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n        Node next = t.nextWaiter;\n        // \u200b\u5224\u65ad\u200b t \u200b\u8282\u70b9\u200b\u662f\u4e0d\u662f\u200b CONDITION \u200b\u8282\u70b9\u200b\uff0c\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u4e0d\u662f\u200b CONDITION \u200b\u5c31\u200b\u4e0d\u662f\u200b\u6b63\u5e38\u200b\u7684\u200b\n        if (t.waitStatus != Node.CONDITION) { \n            // \u200b\u4e0d\u662f\u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b\uff0c\u200b\u9700\u8981\u200b t \u200b\u4e0e\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u65ad\u5f00\u200b\n            t.nextWaiter = null;\n            // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u904d\u5386\u200b\u5230\u200b\u7684\u200b\u8282\u70b9\u200b\u8fd8\u200b\u672a\u200b\u78b0\u5230\u200b\u8fc7\u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b\n            if (trail == null)\n                // \u200b\u66f4\u65b0\u200b firstWaiter \u200b\u6307\u9488\u200b\u4e3a\u200b\u4e0b\u4e2a\u200b\u8282\u70b9\u200b\n                firstWaiter = next;\n            else\n                // \u200b\u8ba9\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b\u6307\u5411\u200b \u200b\u5f53\u524d\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u7684\u200b \u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u3010\u200b\u5220\u9664\u200b\u975e\u6b63\u5e38\u200b\u7684\u200b\u8282\u70b9\u200b\u3011\n                trail.nextWaiter = next;\n            // t \u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u4e86\u200b\uff0c\u200b\u66f4\u65b0\u200b lastWaiter \u200b\u6307\u5411\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b\n            if (next == null)\n                lastWaiter = trail;\n        } else {\n            // trail \u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b \n            trail = t;\n        }\n        // \u200b\u628a\u200b t.next \u200b\u8d4b\u503c\u200b\u7ed9\u200b t\uff0c\u200b\u5faa\u73af\u200b\u904d\u5386\u200b\n        t = next; \n    }\n}\n</code></pre> <ul> <li>\u200b\u63a5\u4e0b\u6765\u200b Thread-0 \u200b\u8fdb\u5165\u200b AQS \u200b\u7684\u200b fullyRelease \u200b\u6d41\u7a0b\u200b\uff0c\u200b\u91ca\u653e\u200b\u540c\u6b65\u5668\u200b\u4e0a\u200b\u7684\u200b\u9501\u200b</li> </ul> Java<pre><code>// \u200b\u7ebf\u7a0b\u200b\u53ef\u80fd\u200b\u91cd\u200b\u5165\u200b\uff0c\u200b\u9700\u8981\u200b\u5c06\u200b state \u200b\u5168\u90e8\u200b\u91ca\u653e\u200b\nfinal int fullyRelease(Node node) {\n    // \u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\u9501\u200b\u662f\u5426\u200b\u6210\u529f\u200b\uff0cfalse \u200b\u4ee3\u8868\u200b\u6210\u529f\u200b\n    boolean failed = true;\n    try {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u6301\u6709\u200b\u7684\u200b state \u200b\u503c\u200b\u603b\u6570\u200b\n        int savedState = getState();\n        // release -&gt; tryRelease \u200b\u89e3\u9501\u200b\u91cd\u5165\u200b\u9501\u200b\n        if (release(savedState)) {\n            // \u200b\u91ca\u653e\u200b\u6210\u529f\u200b\n            failed = false;\n            // \u200b\u8fd4\u56de\u200b\u89e3\u9501\u200b\u7684\u200b\u6df1\u5ea6\u200b\n            return savedState;\n        } else {\n            // \u200b\u89e3\u9501\u200b\u5931\u8d25\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n            throw new IllegalMonitorStateException();\n        }\n    } finally {\n        // \u200b\u6ca1\u6709\u200b\u91ca\u653e\u200b\u6210\u529f\u200b\uff0c\u200b\u5c06\u200b\u5f53\u524d\u200b node \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n        if (failed)\n            node.waitStatus = Node.CANCELLED;\n    }\n}\n</code></pre> <ul> <li>fullyRelease \u200b\u4e2d\u200b\u4f1a\u200b unpark AQS \u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u7ade\u4e89\u200b\u9501\u200b\uff0c\u200b\u5047\u8bbe\u200b Thread-1 \u200b\u7ade\u4e89\u200b\u6210\u529f\u200b</li> </ul> <p></p> <ul> <li>Thread-0 \u200b\u8fdb\u5165\u200b isOnSyncQueue \u200b\u903b\u8f91\u200b\u5224\u65ad\u200b\u8282\u70b9\u200b\u662f\u5426\u200b\u79fb\u52a8\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5c31\u200b park \u200b\u963b\u585e\u200b Thread-0</li> </ul> Java<pre><code>final boolean isOnSyncQueue(Node node) {\n    // node \u200b\u7684\u200b\u72b6\u6001\u200b\u662f\u200b CONDITION\uff0csignal \u200b\u65b9\u6cd5\u200b\u662f\u200b\u5148\u200b\u4fee\u6539\u200b\u72b6\u6001\u200b\u518d\u200b\u8fc1\u79fb\u200b\uff0c\u200b\u6240\u4ee5\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u4e3a\u7a7a\u200b\u8bc1\u660e\u200b\u8fd8\u200b\u3010\u200b\u6ca1\u6709\u200b\u5b8c\u6210\u200b\u8fc1\u79fb\u200b\u3011\n    if (node.waitStatus == Node.CONDITION || node.prev == null)\n        return false;\n    // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u6210\u529f\u200b\u5165\u961f\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u4e14\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u540e\u9762\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5176\u5b83\u200b node\uff0c\u200b\u56e0\u4e3a\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u7684\u200b next \u200b\u6307\u9488\u200b\u4e3a\u200b null\n    if (node.next != null)\n        return true;\n  // \u200b\u8bf4\u660e\u200b\u3010\u200b\u53ef\u80fd\u200b\u5728\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u4f46\u662f\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3011\n    // \u200b\u4ece\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\u5f00\u59cb\u200b\u5411\u524d\u200b\u3010\u200b\u904d\u5386\u200b\u67e5\u627e\u200b node\u3011\uff0c\u200b\u5982\u679c\u200b\u67e5\u627e\u200b\u5230\u200b\u8fd4\u56de\u200b true\uff0c\u200b\u67e5\u627e\u200b\u4e0d\u5230\u200b\u8fd4\u56de\u200b false\n    return findNodeFromTail(node);\n}\n</code></pre> <ul> <li>await \u200b\u7ebf\u7a0b\u200b park \u200b\u540e\u200b\u5982\u679c\u200b\u88ab\u200b unpark \u200b\u6216\u8005\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u8fdb\u5165\u200b checkInterruptWhileWaiting \u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff1a\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u88ab\u200b\u6253\u65ad\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> </ul> Java<pre><code>private int checkInterruptWhileWaiting(Node node) {\n    // Thread.interrupted() \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e2d\u65ad\u200b\u6807\u8bb0\u200b\u4f4d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91cd\u7f6e\u200b\u5f53\u524d\u200b\u6807\u8bb0\u200b\u4f4d\u200b \u200b\u4e3a\u200b false\n    // \u200b\u5982\u679c\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u4e86\u200b\uff0c\u200b\u6839\u636e\u200b\u662f\u5426\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u7684\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\u7801\u200b\n    return Thread.interrupted() ?(transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) : 0;\n}\n</code></pre> Java<pre><code>// \u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u53ea\u6709\u200b\u5728\u7ebf\u200b\u7a0b\u662f\u200b\u88ab\u200b\u6253\u65ad\u200b\u5524\u9192\u200b\u65f6\u624d\u200b\u4f1a\u200b\u8c03\u7528\u200b\nfinal boolean transferAfterCancelledWait(Node node) {\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200bnode\u200b\u4e00\u5b9a\u200b\u662f\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\uff0c\u200b\u56e0\u4e3a\u200b signal \u200b\u8fc1\u79fb\u200b\u8282\u70b9\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u4fee\u6539\u200b\u4e3a\u200b 0\n    if (compareAndSetWaitStatus(node, Node.CONDITION, 0)) {\n        // \u200b\u628a\u200b\u3010\u200b\u4e2d\u65ad\u200b\u5524\u9192\u200b\u7684\u200b node \u200b\u52a0\u5165\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u3011\n        enq(node);\n        // \u200b\u8868\u793a\u200b\u662f\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u4e86\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b THROW_IE \u200b\u4e3a\u200b -1\n        return true;\n    }\n\n    //\u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u91cc\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a\n    //1.\u200b\u5f53\u524d\u200bnode\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b signal \u200b\u65b9\u6cd5\u200b\u5c06\u200b\u5176\u200b\u8fc1\u79fb\u200b\u5230\u200b \u200b\u963b\u585e\u200b\u961f\u5217\u200b \u200b\u5185\u200b\u4e86\u200b\n    //2.\u200b\u5f53\u524d\u200bnode\u200b\u6b63\u5728\u200b\u88ab\u200b\u5916\u90e8\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b signal \u200b\u65b9\u6cd5\u200b\u5c06\u200b\u5176\u200b\u8fc1\u79fb\u200b\u81f3\u200b \u200b\u963b\u585e\u200b\u961f\u5217\u200b \u200b\u8fdb\u884c\u200b\u4e2d\u200b\u72b6\u6001\u200b\n\n    // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8fd8\u200b\u6ca1\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0c\u200b\u4e00\u76f4\u200b\u91ca\u653e\u200b CPU\n    while (!isOnSyncQueue(node))\n        Thread.yield();\n\n    // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u5524\u9192\u200b\u65f6\u200b\u4e0d\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u4e86\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b REINTERRUPT \u200b\u4e3a\u200b 1\n    return false;\n}\n</code></pre> <ul> <li>\u200b\u6700\u540e\u200b\u5f00\u59cb\u200b\u5904\u7406\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\uff1a</li> </ul> Java<pre><code>private void reportInterruptAfterWait(int interruptMode) throws InterruptedException {\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u3010\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u53d1\u751f\u200b\u8fc7\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u6b64\u65f6\u200b await \u200b\u65b9\u6cd5\u200b\u629b\u51fa\u200b\u4e2d\u65ad\u200b\u5f02\u5e38\u200b\u3011\n    if (interruptMode == THROW_IE)\n        throw new InterruptedException();\n\n    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u3010\u200b\u5728\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5916\u200b\u53d1\u751f\u200b\u7684\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e2d\u65ad\u200b\u6807\u8bb0\u200b\u4f4d\u4e3a\u200b true\u3011\n    else if (interruptMode == REINTERRUPT)\n        // \u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u81ea\u5df1\u200b\u6253\u65ad\u200b\uff0c\u200b\u4ea7\u751f\u200b\u4e2d\u65ad\u200b\u7684\u200b\u6548\u679c\u200b\n        selfInterrupt();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#signal","title":"signal","text":"<ul> <li>\u200b\u5047\u8bbe\u200b Thread-1 \u200b\u8981\u200b\u6765\u200b\u5524\u9192\u200b Thread-0\uff0c\u200b\u8fdb\u5165\u200b ConditionObject \u200b\u7684\u200b doSignal \u200b\u6d41\u7a0b\u200b\uff0c\u200b\u53d6\u5f97\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u7b2c\u4e00\u4e2a\u200b Node\uff0c\u200b\u5373\u200b Thread-0 \u200b\u6240\u5728\u200b Node\uff0c\u200b\u5fc5\u987b\u200b\u6301\u6709\u200b\u9501\u200b\u624d\u80fd\u200b\u5524\u9192\u200b, \u200b\u56e0\u6b64\u200b doSignal \u200b\u5185\u7ebf\u200b\u7a0b\u200b\u5b89\u5168\u200b</li> </ul> Java<pre><code>public final void signal() {\n    // \u200b\u5224\u65ad\u200b\u8c03\u7528\u200b signal \u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u662f\u200b\u72ec\u5360\u200b\u9501\u200b\u6301\u6709\u200b\u7ebf\u7a0b\u200b\n    if (!isHeldExclusively())\n        throw new IllegalMonitorStateException();\n    // \u200b\u83b7\u53d6\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u4e2d\u200b\u7b2c\u4e00\u4e2a\u200b Node\n    Node first = firstWaiter;\n    // \u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\u5c31\u200b\u5c06\u200b\u7b2c\u8be5\u200b\u8282\u70b9\u200b\u3010\u200b\u8fc1\u79fb\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u3011\n    if (first != null)\n        doSignal(first);\n}\n</code></pre> Java<pre><code>// \u200b\u5524\u9192\u200b - \u3010\u200b\u5c06\u200b\u6ca1\u200b\u53d6\u6d88\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u8f6c\u79fb\u200b\u81f3\u200b AQS \u200b\u961f\u5217\u200b\u5c3e\u90e8\u200b\u3011\nprivate void doSignal(Node first) {\n    do {\n        // \u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u662f\u200b null\uff0c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u4e86\u200b\uff0c\u200b\u961f\u5217\u200b\u4e2d\u200b\u53ea\u6709\u200b\u5f53\u524d\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u4e86\u200b\n        if ((firstWaiter = first.nextWaiter) == null)\n            lastWaiter = null;\n        first.nextWaiter = null;\n    // \u200b\u5c06\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b Node \u200b\u8f6c\u79fb\u200b\u81f3\u200b AQS \u200b\u961f\u5217\u200b\uff0c\u200b\u4e0d\u200b\u6210\u529f\u200b\u4e14\u200b\u8fd8\u6709\u200b\u8282\u70b9\u200b\u5219\u200b\u7ee7\u7eed\u200b\u5faa\u73af\u200b\n    } while (!transferForSignal(first) &amp;&amp; (first = firstWaiter) != null);\n}\n\n// signalAll() \u200b\u4f1a\u200b\u8c03\u7528\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\uff0c\u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7684\u200b\u8282\u70b9\u200b\nprivate void doSignalAll(Node first) {\n    lastWaiter = firstWaiter = null;\n    do {\n        Node next = first.nextWaiter;\n        first.nextWaiter = null;\n        transferForSignal(first);\n        first = next;\n    // \u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u90fd\u200b\u653e\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\n    } while (first != null);\n}\n</code></pre> <ul> <li>\u200b\u6267\u884c\u200b transferForSignal\uff0c\u200b\u5148\u200b\u5c06\u200b\u8282\u70b9\u200b\u7684\u200b waitStatus \u200b\u6539\u4e3a\u200b 0\uff0c\u200b\u7136\u540e\u200b\u52a0\u5165\u200b AQS \u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5c3e\u90e8\u200b\uff0c\u200b\u5c06\u200b Thread-3 \u200b\u7684\u200b waitStatus \u200b\u6539\u4e3a\u200b -1</li> </ul> Java<pre><code>// \u200b\u5982\u679c\u200b\u8282\u70b9\u200b\u72b6\u6001\u200b\u662f\u200b\u53d6\u6d88\u200b, \u200b\u8fd4\u56de\u200b false \u200b\u8868\u793a\u200b\u8f6c\u79fb\u200b\u5931\u8d25\u200b, \u200b\u5426\u5219\u200b\u8f6c\u79fb\u200b\u6210\u529f\u200b\nfinal boolean transferForSignal(Node node) {\n    // CAS \u200b\u4fee\u6539\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4fee\u6539\u200b\u4e3a\u200b 0\uff0c\u200b\u56e0\u4e3a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u9a6c\u4e0a\u200b\u8981\u200b\u8fc1\u79fb\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e86\u200b\n    // \u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u5df2\u7ecf\u200b\u4e0d\u662f\u200b CONDITION, \u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u53d6\u6d88\u200b\uff08await \u200b\u91ca\u653e\u200b\u5168\u90e8\u200b\u9501\u200b\u5931\u8d25\u200b\uff09\u200b\u6216\u8005\u200b\u88ab\u200b\u4e2d\u65ad\u200b\uff08\u200b\u53ef\u200b\u6253\u65ad\u200b cancelAcquire\uff09\n    if (!compareAndSetWaitStatus(node, Node.CONDITION, 0))\n        // \u200b\u8fd4\u56de\u200b\u51fd\u6570\u8c03\u7528\u200b\u5904\u200b\u7ee7\u7eed\u200b\u5bfb\u627e\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n        return false;\n\n    // \u3010\u200b\u5148\u6539\u200b\u72b6\u6001\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u8fc1\u79fb\u200b\u3011\n    // \u200b\u5c06\u200b\u5f53\u524d\u200b node \u200b\u5165\u200b\u963b\u585e\u200b\u961f\u5217\u200b\uff0cp \u200b\u662f\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5728\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7684\u200b\u3010\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u3011\n    Node p = enq(node);\n    int ws = p.waitStatus;\n\n    // \u200b\u5982\u679c\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u88ab\u200b\u53d6\u6d88\u200b\u6216\u8005\u200b\u4e0d\u80fd\u200b\u8bbe\u7f6e\u200b\u72b6\u6001\u200b\u4e3a\u200b Node.SIGNAL\uff0c\u200b\u5c31\u200b unpark \u200b\u53d6\u6d88\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u963b\u585e\u72b6\u6001\u200b, \n    // \u200b\u8ba9\u200b thread-0 \u200b\u7ebf\u7a0b\u200b\u7ade\u4e89\u200b\u9501\u200b\uff0c\u200b\u91cd\u65b0\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\n    if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))\n        LockSupport.unpark(node.thread);\n    return true;\n}\n</code></pre> <ul> <li>Thread-1 \u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200b unlock \u200b\u6d41\u7a0b\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#readwrite","title":"ReadWrite","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_167","title":"\u8bfb\u5199\u200b\u9501","text":"<p>\u200b\u72ec\u5360\u200b\u9501\u200b\uff1a\u200b\u6307\u8be5\u200b\u9501\u200b\u4e00\u6b21\u200b\u53ea\u80fd\u200b\u88ab\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u6301\u6709\u200b\uff0c\u200b\u5bf9\u200b ReentrantLock \u200b\u548c\u200b Synchronized \u200b\u800c\u8a00\u200b\u90fd\u200b\u662f\u200b\u72ec\u5360\u200b\u9501\u200b</p> <p>\u200b\u5171\u4eab\u200b\u9501\u200b\uff1a\u200b\u6307\u8be5\u200b\u9501\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u9501\u200b\u6301\u6709\u200b</p> <p>ReentrantReadWriteLock \u200b\u5176\u8bfb\u200b\u9501\u200b\u662f\u200b\u5171\u4eab\u200b\u9501\u200b\uff0c\u200b\u5199\u9501\u200b\u662f\u200b\u72ec\u5360\u200b\u9501\u200b</p> <p>\u200b\u4f5c\u7528\u200b\uff1a\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\u8bfb\u200b\u4e00\u4e2a\u200b\u8d44\u6e90\u200b\u7c7b\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b\u5e76\u53d1\u200b\u91cf\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u5171\u4eab\u8d44\u6e90\u200b\u5e94\u8be5\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u60f3\u200b\u53bb\u200b\u5199\u200b\u5171\u4eab\u8d44\u6e90\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u518d\u6709\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u8be5\u200b\u8d44\u6e90\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b</p> <p>\u200b\u4f7f\u7528\u200b\u89c4\u5219\u200b\uff1a</p> <ul> <li>\u200b\u52a0\u9501\u200b\u89e3\u9501\u200b\u683c\u5f0f\u200b\uff1a</li> </ul> Java<pre><code>r.lock();\ntry {\n    // \u200b\u4e34\u754c\u200b\u533a\u200b\n} finally {\n  r.unlock();\n}\n</code></pre> <ul> <li>\u200b\u8bfb\u200b-\u200b\u8bfb\u80fd\u200b\u5171\u5b58\u200b\u3001\u200b\u8bfb\u200b-\u200b\u5199\u200b\u4e0d\u80fd\u200b\u5171\u5b58\u200b\u3001\u200b\u5199\u200b-\u200b\u5199\u200b\u4e0d\u80fd\u200b\u5171\u5b58\u200b</li> <li>\u200b\u8bfb\u9501\u200b\u4e0d\u200b\u652f\u6301\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b</li> <li>\u200b\u91cd\u200b\u5165\u65f6\u200b\u5347\u7ea7\u200b\u4e0d\u200b\u652f\u6301\u200b\uff1a\u200b\u6301\u6709\u200b\u8bfb\u9501\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u53bb\u200b\u83b7\u53d6\u200b\u5199\u9501\u4f1a\u200b\u5bfc\u81f4\u200b\u83b7\u53d6\u200b\u5199\u9501\u200b\u6c38\u4e45\u200b\u7b49\u5f85\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u91ca\u653e\u200b\u8bfb\u200b\uff0c\u200b\u518d\u200b\u53bb\u200b\u83b7\u5f97\u200b\u5199\u200b</li> <li>\u200b\u91cd\u200b\u5165\u65f6\u200b\u964d\u7ea7\u200b\u652f\u6301\u200b\uff1a\u200b\u6301\u6709\u200b\u5199\u9501\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u53bb\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\uff0c\u200b\u9020\u6210\u200b\u53ea\u6709\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u6301\u6709\u200b\u8bfb\u9501\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5199\u9501\u4f1a\u200b\u4e92\u65a5\u200b\u5176\u4ed6\u200b\u7684\u200b\u9501\u200b</li> </ul> Java<pre><code>w.lock();\ntry {\n    r.lock();// \u200b\u964d\u7ea7\u200b\u4e3a\u200b\u8bfb\u9501\u200b, \u200b\u91ca\u653e\u200b\u5199\u9501\u200b, \u200b\u8fd9\u6837\u200b\u80fd\u591f\u200b\u8ba9\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u8bfb\u53d6\u200b\u7f13\u5b58\u200b\n    try {\n        // ...\n    } finally{\n      w.unlock();// \u200b\u8981\u200b\u5728\u200b\u5199\u200b\u9501\u200b\u91ca\u653e\u200b\u4e4b\u524d\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\n    }\n} finally{\n  r.unlock();\n}\n</code></pre> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>public ReentrantReadWriteLock()</code>\uff1a\u200b\u9ed8\u8ba4\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff0c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b</li> <li><code>public ReentrantReadWriteLock(boolean fair)</code>\uff1atrue \u200b\u4e3a\u200b\u516c\u5e73\u200b\u9501\u200b</li> </ul> <p>\u200b\u5e38\u7528\u200bAPI\uff1a</p> <ul> <li><code>public ReentrantReadWriteLock.ReadLock readLock()</code>\uff1a\u200b\u8fd4\u56de\u200b\u8bfb\u9501\u200b</li> <li><code>public ReentrantReadWriteLock.WriteLock writeLock()</code>\uff1a\u200b\u8fd4\u56de\u200b\u5199\u9501\u200b</li> <li><code>public void lock()</code>\uff1a\u200b\u52a0\u9501\u200b</li> <li><code>public void unlock()</code>\uff1a\u200b\u89e3\u9501\u200b</li> <li><code>public boolean tryLock()</code>\uff1a\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b</li> </ul> <p>\u200b\u8bfb\u8bfb\u200b\u5e76\u53d1\u200b\uff1a</p> Java<pre><code>public static void main(String[] args) {\n    ReentrantReadWriteLock rw = new ReentrantReadWriteLock();\n    ReentrantReadWriteLock.ReadLock r = rw.readLock();\n    ReentrantReadWriteLock.WriteLock w = rw.writeLock();\n\n    new Thread(() -&gt; {\n        r.lock();\n        try {\n            Thread.sleep(2000);\n            System.out.println(\"Thread 1 running \" + new Date());\n        } finally {\n            r.unlock();\n        }\n    },\"t1\").start();\n    new Thread(() -&gt; {\n        r.lock();\n        try {\n            Thread.sleep(2000);\n            System.out.println(\"Thread 2 running \" + new Date());\n        } finally {\n            r.unlock();\n        }\n    },\"t2\").start();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_168","title":"\u7f13\u5b58\u200b\u5e94\u7528","text":"<p>\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u65f6\u200b\uff0c\u200b\u662f\u200b\u5148\u6e05\u200b\u7f13\u5b58\u200b\u8fd8\u662f\u200b\u5148\u200b\u66f4\u65b0\u200b\u6570\u636e\u5e93\u200b</p> <ul> <li>\u200b\u5148\u6e05\u200b\u7f13\u5b58\u200b\uff1a\u200b\u53ef\u80fd\u200b\u9020\u6210\u200b\u521a\u200b\u6e05\u7406\u200b\u7f13\u5b58\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u66f4\u65b0\u200b\u6570\u636e\u5e93\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u67e5\u8be2\u200b\u4e86\u200b\u6570\u636e\u5e93\u200b\u66f4\u65b0\u200b\u8fc7\u671f\u6570\u636e\u200b\u5230\u200b\u7f13\u5b58\u200b</li> <li>\u200b\u5148\u200b\u66f4\u65b0\u200b\u636e\u5e93\u200b\uff1a\u200b\u53ef\u80fd\u200b\u9020\u6210\u200b\u521a\u200b\u66f4\u65b0\u200b\u6570\u636e\u5e93\u200b\uff0c\u200b\u8fd8\u200b\u6ca1\u200b\u6e05\u7a7a\u200b\u7f13\u5b58\u200b\u5c31\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u4ece\u200b\u7f13\u5b58\u200b\u62ff\u5230\u200b\u4e86\u200b\u65e7\u200b\u6570\u636e\u200b</li> <li>\u200b\u8865\u5145\u200b\u60c5\u51b5\u200b\uff1a\u200b\u67e5\u8be2\u200b\u7ebf\u7a0b\u200b A \u200b\u67e5\u8be2\u200b\u6570\u636e\u200b\u65f6\u200b\u6070\u597d\u200b\u7f13\u5b58\u6570\u636e\u200b\u7531\u4e8e\u200b\u65f6\u95f4\u200b\u5230\u671f\u200b\u5931\u6548\u200b\uff0c\u200b\u6216\u662f\u200b\u7b2c\u4e00\u6b21\u200b\u67e5\u8be2\u200b</li> </ul> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8bfb\u5199\u200b\u9501\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_169","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_170","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"<p>\u200b\u8bfb\u5199\u200b\u9501\u7528\u200b\u7684\u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b Sync \u200b\u540c\u6b65\u5668\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u3001state \u200b\u7b49\u200b\u4e5f\u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b\uff0c\u200b\u539f\u7406\u200b\u4e0e\u200b ReentrantLock \u200b\u52a0\u9501\u200b\u76f8\u6bd4\u200b\u6ca1\u6709\u200b\u7279\u6b8a\u200b\u4e4b\u200b\u5904\u200b\uff0c\u200b\u4e0d\u540c\u200b\u662f\u200b\u5199\u200b\u9501\u200b\u72b6\u6001\u200b\u5360\u200b\u4e86\u200b state \u200b\u7684\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\uff0c\u200b\u800c\u200b\u8bfb\u9501\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b state \u200b\u7684\u200b\u9ad8\u200b 16 \u200b\u4f4d\u200b</p> <ul> <li>\u200b\u8bfb\u5199\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>private final ReentrantReadWriteLock.ReadLock readerLock;     \nprivate final ReentrantReadWriteLock.WriteLock writerLock;\n</code></pre> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a\u200b\u9ed8\u8ba4\u200b\u662f\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u53c2\u6570\u200b\u521b\u5efa\u200b\u516c\u5e73\u200b\u9501\u200b</li> </ul> Java<pre><code>public ReentrantReadWriteLock(boolean fair) {\n    // true \u200b\u4e3a\u200b\u516c\u5e73\u200b\u9501\u200b\n    sync = fair ? new FairSync() : new NonfairSync();\n    // \u200b\u8fd9\u200b\u4e24\u4e2a\u200b lock \u200b\u5171\u4eab\u200b\u540c\u4e00\u4e2a\u200b sync \u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u7531\u200b ReentrantReadWriteLock \u200b\u7684\u200b sync \u200b\u63d0\u4f9b\u200b\u540c\u6b65\u200b\u5b9e\u73b0\u200b\n    readerLock = new ReadLock(this);\n    writerLock = new WriteLock(this);\n}\n</code></pre> <p>Sync \u200b\u7c7b\u200b\u7684\u200b\u5c5e\u6027\u200b\uff1a</p> <ul> <li>\u200b\u7edf\u8ba1\u200b\u53d8\u91cf\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u7528\u6765\u200b\u79fb\u4f4d\u200b\nstatic final int SHARED_SHIFT   = 16;\n// \u200b\u9ad8\u200b16\u200b\u4f4d\u200b\u7684\u200b1\nstatic final int SHARED_UNIT    = (1 &lt;&lt; SHARED_SHIFT);\n// 65535\uff0c16\u200b\u4e2a\u200b1\uff0c\u200b\u4ee3\u8868\u200b\u5199\u9501\u200b\u7684\u200b\u6700\u5927\u200b\u91cd\u200b\u5165\u200b\u6b21\u6570\u200b\nstatic final int MAX_COUNT      = (1 &lt;&lt; SHARED_SHIFT) - 1;\n// \u200b\u4f4e\u200b16\u200b\u4f4d\u200b\u63a9\u7801\u200b\uff1a0b 1111 1111 1111 1111\uff0c\u200b\u7528\u6765\u200b\u83b7\u53d6\u200b\u5199\u9501\u200b\u91cd\u5165\u200b\u7684\u200b\u6b21\u6570\u200b\nstatic final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;\n</code></pre> <ul> <li>\u200b\u83b7\u53d6\u200b\u8bfb\u5199\u200b\u9501\u200b\u7684\u200b\u6b21\u6570\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u83b7\u53d6\u200b\u8bfb\u5199\u200b\u9501\u200b\u7684\u200b\u8bfb\u9501\u200b\u5206\u914d\u200b\u7684\u200b\u603b\u200b\u6b21\u6570\u200b\nstatic int sharedCount(int c)    { return c &gt;&gt;&gt; SHARED_SHIFT; }\n// \u200b\u5199\u9501\u200b\uff08\u200b\u72ec\u5360\u200b\uff09\u200b\u9501\u200b\u7684\u200b\u91cd\u5165\u200b\u6b21\u6570\u200b\nstatic int exclusiveCount(int c) { return c &amp; EXCLUSIVE_MASK; }\n</code></pre> <ul> <li>\u200b\u5185\u90e8\u200b\u7c7b\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u8bb0\u5f55\u200b\u8bfb\u200b\u9501\u7ebf\u200b\u7a0b\u200b\u81ea\u5df1\u200b\u7684\u200b\u6301\u6709\u200b\u8bfb\u9501\u200b\u7684\u200b\u6570\u91cf\u200b\uff08\u200b\u91cd\u200b\u5165\u200b\u6b21\u6570\u200b\uff09\uff0c\u200b\u56e0\u4e3a\u200b state \u200b\u9ad8\u200b16\u200b\u4f4d\u200b\u8bb0\u5f55\u200b\u7684\u200b\u662f\u200b\u5168\u5c40\u200b\u8303\u56f4\u200b\u5185\u200b\u6240\u6709\u200b\u7684\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u7684\u200b\u603b\u91cf\u200b\nstatic final class HoldCounter {\n    int count = 0;\n    // Use id, not reference, to avoid garbage retention\n    final long tid = getThreadId(Thread.currentThread());\n}\n// \u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u5b58\u653e\u200b\u7ebf\u7a0b\u200b\u5404\u81ea\u200b\u7684\u200b HoldCounter \u200b\u5bf9\u8c61\u200b\nstatic final class ThreadLocalHoldCounter extends ThreadLocal&lt;HoldCounter&gt; {\n    public HoldCounter initialValue() {\n        return new HoldCounter();\n    }\n}\n</code></pre> <ul> <li>\u200b\u5185\u90e8\u200b\u7c7b\u200b\u5b9e\u4f8b\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u200b\u8bfb\u9501\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u8ba1\u6570\u200b\u4e3a\u200b 0 \u200b\u65f6\u200b\u5220\u9664\u200b\nprivate transient ThreadLocalHoldCounter readHolds;\n// \u200b\u8bb0\u5f55\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u83b7\u53d6\u200b\u3010\u200b\u8bfb\u9501\u200b\u3011\u200b\u7ebf\u7a0b\u200b\u7684\u200b HoldCounter \u200b\u5bf9\u8c61\u200b\nprivate transient HoldCounter cachedHoldCounter;\n</code></pre> <ul> <li>\u200b\u9996\u6b21\u200b\u83b7\u53d6\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u7b2c\u4e00\u4e2a\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\nprivate transient Thread firstReader = null;\n// \u200b\u8bb0\u5f55\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u7684\u200b\u8bfb\u9501\u200b\u6b21\u6570\u200b\uff08\u200b\u8bfb\u9501\u200b\u91cd\u5165\u200b\u6b21\u6570\u200b\uff09\nprivate transient int firstReaderHoldCount;\n</code></pre> <ul> <li>Sync \u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>Sync() {\n    readHolds = new ThreadLocalHoldCounter();\n    // \u200b\u786e\u4fdd\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6570\u636e\u200b\u53ef\u89c1\u200b\u6027\u200b\uff0cstate \u200b\u662f\u200b volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\uff0c\u200b\u91cd\u5199\u200b\u8be5\u503c\u200b\u4f1a\u200b\u5c06\u200b\u7ebf\u7a0b\u200b\u672c\u5730\u200b\u7f13\u5b58\u6570\u636e\u200b\u3010\u200b\u540c\u6b65\u200b\u81f3\u200b\u4e3b\u5b58\u200b\u3011\n    setState(getState()); \n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_171","title":"\u52a0\u9501\u200b\u539f\u7406","text":"<ul> <li>t1 \u200b\u7ebf\u7a0b\u200b\uff1aw.lock\uff08\u200b\u5199\u9501\u200b\uff09\uff0c\u200b\u6210\u529f\u200b\u4e0a\u9501\u200b state = 0_1</li> </ul> Java<pre><code>// lock()  -&gt; sync.acquire(1);\npublic void lock() {\n    sync.acquire(1);\n}\npublic final void acquire(int arg) {\n    // \u200b\u5c1d\u8bd5\u200b\u83b7\u5f97\u200b\u5199\u9501\u200b\uff0c\u200b\u83b7\u5f97\u200b\u5199\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5173\u8054\u200b\u5230\u200b\u4e00\u4e2a\u200b Node \u200b\u5bf9\u8c61\u200b\u4e0a\u200b, \u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b \n    if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n</code></pre> Java<pre><code>protected final boolean tryAcquire(int acquires) {\n    Thread current = Thread.currentThread();\n    int c = getState();\n    // \u200b\u83b7\u5f97\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b, \u200b\u4ee3\u8868\u200b\u5199\u9501\u200b\u7684\u200b state \u200b\u8ba1\u6570\u200b\n    int w = exclusiveCount(c);\n    // \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bfb\u9501\u200b\u6216\u8005\u200b\u5199\u9501\u200b\n    if (c != 0) {\n        // c != 0 and w == 0 \u200b\u8868\u793a\u200b\u6709\u200b\u8bfb\u9501\u200b\uff0c\u3010\u200b\u8bfb\u9501\u200b\u4e0d\u80fd\u200b\u5347\u7ea7\u200b\u3011\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b false\n        // w != 0 \u200b\u8bf4\u660e\u200b\u6709\u200b\u5199\u200b\u9501\u200b\uff0c\u200b\u5199\u9501\u200b\u7684\u200b\u62e5\u6709\u8005\u200b\u4e0d\u662f\u200b\u81ea\u5df1\u200b\uff0c\u200b\u83b7\u53d6\u200b\u5931\u8d25\u200b\n        if (w == 0 || current != getExclusiveOwnerThread())\n            return false;\n\n        // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u91cc\u200b\u53ea\u6709\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff1a\u3010\u200b\u5199\u9501\u200b\u91cd\u5165\u200b\u3011\uff0c\u200b\u6240\u4ee5\u200b\u4e0b\u9762\u200b\u51e0\u884c\u200b\u4ee3\u7801\u200b\u4e0d\u200b\u5b58\u5728\u200b\u5e76\u53d1\u200b\n        if (w + exclusiveCount(acquires) &gt; MAX_COUNT)\n            throw new Error(\"Maximum lock count exceeded\");\n        // \u200b\u5199\u9501\u200b\u91cd\u5165\u200b, \u200b\u83b7\u5f97\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5e76\u53d1\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u200b\u4f7f\u7528\u200b CAS\n        setState(c + acquires);\n        return true;\n    }\n\n    // c == 0\uff0c\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u9501\u200b\uff0c\u200b\u5224\u65ad\u200b\u5199\u9501\u200b\u662f\u5426\u200b\u8be5\u200b\u963b\u585e\u200b\uff0c\u200b\u662f\u200b false \u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u5931\u8d25\u200b\u8fd4\u56de\u200b false\n    if (writerShouldBlock() || !compareAndSetState(c, c + acquires))\n        return false;\n    // \u200b\u83b7\u5f97\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u9501\u200b\u7684\u200b\u6301\u6709\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n    setExclusiveOwnerThread(current);\n    return true;\n}\n// \u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b writerShouldBlock \u200b\u603b\u662f\u200b\u8fd4\u56de\u200b false, \u200b\u65e0\u9700\u200b\u963b\u585e\u200b\nfinal boolean writerShouldBlock() {\n    return false; \n}\n// \u200b\u516c\u5e73\u200b\u9501\u4f1a\u200b\u68c0\u67e5\u200b AQS \u200b\u961f\u5217\u200b\u4e2d\u200b\u662f\u5426\u200b\u6709\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b, \u200b\u6ca1\u6709\u200b(false)\u200b\u624d\u200b\u53bb\u200b\u7ade\u4e89\u200b\nfinal boolean writerShouldBlock() {\n    return hasQueuedPredecessors();\n}\n</code></pre> <ul> <li>t2 r.lock\uff08\u200b\u8bfb\u9501\u200b\uff09\uff0c\u200b\u8fdb\u5165\u200b tryAcquireShared \u200b\u6d41\u7a0b\u200b\uff1a</li> <li>\u200b\u8fd4\u56de\u200b -1 \u200b\u8868\u793a\u200b\u5931\u8d25\u200b</li> <li>\u200b\u5982\u679c\u200b\u8fd4\u56de\u200b 0 \u200b\u8868\u793a\u200b\u6210\u529f\u200b</li> <li>\u200b\u8fd4\u56de\u200b\u6b63\u6570\u200b\u8868\u793a\u200b\u8fd8\u6709\u200b\u591a\u5c11\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u652f\u6301\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u8bfb\u5199\u200b\u9501\u200b\u8fd4\u56de\u200b 1</li> </ul> Java<pre><code>public void lock() {\n    sync.acquireShared(1);\n}\npublic final void acquireShared(int arg) {\n    // tryAcquireShared \u200b\u8fd4\u56de\u200b\u8d1f\u6570\u200b, \u200b\u8868\u793a\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u5931\u8d25\u200b\n    if (tryAcquireShared(arg) &lt; 0)\n        doAcquireShared(arg);\n}\n</code></pre> Java<pre><code>// \u200b\u5c1d\u8bd5\u200b\u4ee5\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\u83b7\u53d6\u200b\nprotected final int tryAcquireShared(int unused) {\n    Thread current = Thread.currentThread();\n    int c = getState();\n    // exclusiveCount(c) \u200b\u4ee3\u8868\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b, \u200b\u5199\u9501\u200b\u7684\u200b state\uff0c\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u5199\u9501\u200b\n    // \u200b\u5199\u9501\u200b\u7684\u200b\u6301\u6709\u8005\u200b\u4e0d\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5219\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u5931\u8d25\u200b\uff0c\u3010\u200b\u5199\u9501\u200b\u5141\u8bb8\u200b\u964d\u7ea7\u200b\u3011\n    if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current)\n        return -1;\n\n    // \u200b\u9ad8\u200b 16 \u200b\u4f4d\u200b\uff0c\u200b\u4ee3\u8868\u200b\u8bfb\u9501\u200b\u7684\u200b state\uff0c\u200b\u5171\u4eab\u200b\u9501\u200b\u5206\u914d\u200b\u51fa\u53bb\u200b\u7684\u200b\u603b\u200b\u6b21\u6570\u200b\n    int r = sharedCount(c);\n    // \u200b\u8bfb\u9501\u200b\u662f\u5426\u200b\u5e94\u8be5\u200b\u963b\u585e\u200b\n    if (!readerShouldBlock() &amp;&amp;   r &lt; MAX_COUNT &amp;&amp;\n        compareAndSetState(c, c + SHARED_UNIT)) { // \u200b\u5c1d\u8bd5\u200b\u589e\u52a0\u200b\u8bfb\u9501\u200b\u8ba1\u6570\u200b\n        // \u200b\u52a0\u9501\u200b\u6210\u529f\u200b\n        // \u200b\u52a0\u9501\u200b\u4e4b\u524d\u200b\u8bfb\u9501\u200b\u4e3a\u200b 0\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u8bfb\u200b\u9501\u7ebf\u200b\u7a0b\u200b\n        if (r == 0) {\n            firstReader = current;\n            firstReaderHoldCount = 1;\n        // \u200b\u7b2c\u4e00\u4e2a\u200b\u8bfb\u200b\u9501\u7ebf\u200b\u7a0b\u662f\u200b\u81ea\u5df1\u200b\u5c31\u200b\u53d1\u751f\u200b\u4e86\u200b\u8bfb\u9501\u200b\u91cd\u5165\u200b\n        } else if (firstReader == current) {\n            firstReaderHoldCount++;\n        } else {\n            // cachedHoldCounter \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b holdCounter \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5373\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n            HoldCounter rh = cachedHoldCounter;\n            // \u200b\u8bf4\u660e\u200b\u8fd8\u200b\u6ca1\u200b\u8bbe\u7f6e\u200b rh\n            if (rh == null || rh.tid != getThreadId(current))\n                // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u9501\u200b\u91cd\u5165\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u8d4b\u503c\u200b\u7ed9\u200b cachedHoldCounter\n                cachedHoldCounter = rh = readHolds.get();\n            // \u200b\u8fd8\u200b\u6ca1\u200b\u91cd\u5165\u200b\n            else if (rh.count == 0)\n                readHolds.set(rh);\n            // \u200b\u91cd\u200b\u5165\u200b + 1\n            rh.count++;\n        }\n        // \u200b\u8bfb\u9501\u200b\u52a0\u9501\u200b\u6210\u529f\u200b\n        return 1;\n    }\n    // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b \u200b\u5e94\u8be5\u200b\u963b\u585e\u200b\uff0c\u200b\u6216\u8005\u200b cas \u200b\u52a0\u9501\u200b\u5931\u8d25\u200b\n    // \u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u5c1d\u8bd5\u200b for (;;) \u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b, \u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u65e0\u200b\u963b\u585e\u200b\n    return fullTryAcquireShared(current);\n}\n// \u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b readerShouldBlock \u200b\u504f\u5411\u200b\u5199\u9501\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u770b\u200b AQS \u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u7b2c\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u662f\u5426\u662f\u200b\u5199\u9501\u200b\uff0c\u200b\u662f\u200b\u5219\u200b\u963b\u585e\u200b\uff0c\u200b\u53cd\u4e4b\u200b\u4e0d\u200b\u963b\u585e\u200b\n// \u200b\u9632\u6b62\u200b\u4e00\u76f4\u200b\u6709\u8bfb\u200b\u9501\u7ebf\u200b\u7a0b\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5199\u200b\u9501\u7ebf\u200b\u7a0b\u200b\u9965\u997f\u200b\n// true \u200b\u5219\u200b\u8be5\u200b\u963b\u585e\u200b, false \u200b\u5219\u200b\u4e0d\u200b\u963b\u585e\u200b\nfinal boolean readerShouldBlock() {\n    return apparentlyFirstQueuedIsExclusive();\n}\nfinal boolean readerShouldBlock() {\n    return hasQueuedPredecessors();\n}\n</code></pre> Java<pre><code>final int fullTryAcquireShared(Thread current) {\n    // \u200b\u5f53\u524d\u200b\u8bfb\u200b\u9501\u7ebf\u200b\u7a0b\u200b\u6301\u6709\u200b\u7684\u200b\u8bfb\u9501\u200b\u6b21\u6570\u200b\u5bf9\u8c61\u200b\n    HoldCounter rh = null;\n    for (;;) {\n        int c = getState();\n        // \u200b\u8bf4\u660e\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u5199\u9501\u200b\n        if (exclusiveCount(c) != 0) {\n            // \u200b\u5199\u9501\u200b\u4e0d\u662f\u200b\u81ea\u5df1\u200b\u5219\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\n            if (getExclusiveOwnerThread() != current)\n                return -1;\n        } else if (readerShouldBlock()) {\n            // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b firstReader\uff0c\u200b\u5f53\u524d\u200b\u9501\u200b\u662f\u200b\u8bfb\u200b\u5fd9\u788c\u200b\u72b6\u6001\u200b\uff0c\u200b\u800c\u4e14\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u662f\u200b\u8bfb\u9501\u200b\u91cd\u5165\u200b\n            if (firstReader == current) {\n                // assert firstReaderHoldCount &gt; 0;\n            } else {\n                if (rh == null) {\n                    // \u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8bfb\u9501\u200b\u7684\u200b HoldCounter\n                    rh = cachedHoldCounter;\n                    // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8bfb\u9501\u200b\n                    if (rh == null || rh.tid != getThreadId(current)) {\n                        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b HoldCounter\n                        rh = readHolds.get();\n                        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b HoldCounter \u200b\u5bf9\u8c61\u200b\u662f\u200b\u4e0a\u200b\u4e00\u6b65\u200b\u4ee3\u7801\u200b\u65b0\u5efa\u200b\u7684\u200b\n                        // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u662f\u200b\u9501\u200b\u91cd\u5165\u200b\uff0c\u200b\u5728\u200b readerShouldBlock() \u200b\u8fd4\u56de\u200b true \u200b\u65f6\u200b\u9700\u8981\u200b\u53bb\u200b\u6392\u961f\u200b\n                        if (rh.count == 0)\n                            // \u200b\u9632\u6b62\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\n                            readHolds.remove();\n                    }\n                }\n                if (rh.count == 0)\n                    return -1;\n            }\n        }\n        // \u200b\u8d8a\u754c\u200b\u5224\u65ad\u200b\n        if (sharedCount(c) == MAX_COUNT)\n            throw new Error(\"Maximum lock count exceeded\");\n        // \u200b\u8bfb\u9501\u200b\u52a0\u9501\u200b\uff0c\u200b\u6761\u4ef6\u200b\u5185\u200b\u7684\u200b\u903b\u8f91\u200b\u4e0e\u200b tryAcquireShared \u200b\u76f8\u540c\u200b\n        if (compareAndSetState(c, c + SHARED_UNIT)) {\n            if (sharedCount(c) == 0) {\n                firstReader = current;\n                firstReaderHoldCount = 1;\n            } else if (firstReader == current) {\n                firstReaderHoldCount++;\n            } else {\n                if (rh == null)\n                    rh = cachedHoldCounter;\n                if (rh == null || rh.tid != getThreadId(current))\n                    rh = readHolds.get();\n                else if (rh.count == 0)\n                    readHolds.set(rh);\n                rh.count++;\n                cachedHoldCounter = rh; // cache for release\n            }\n            return 1;\n        }\n    }\n}\n</code></pre> <ul> <li>\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fdb\u5165\u200b sync.doAcquireShared(1) \u200b\u6d41\u7a0b\u200b\u5f00\u59cb\u200b\u963b\u585e\u200b\uff0c\u200b\u9996\u5148\u200b\u4e5f\u200b\u662f\u200b\u8c03\u7528\u200b addWaiter \u200b\u6dfb\u52a0\u200b\u8282\u70b9\u200b\uff0c\u200b\u4e0d\u540c\u4e4b\u5904\u200b\u5728\u4e8e\u200b\u8282\u70b9\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Node.SHARED \u200b\u6a21\u5f0f\u200b\u800c\u200b\u975e\u200b Node.EXCLUSIVE \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u6ce8\u610f\u200b\u6b64\u65f6\u200b t2 \u200b\u4ecd\u200b\u5904\u4e8e\u200b\u6d3b\u8dc3\u200b\u72b6\u6001\u200b</li> </ul> Java<pre><code>private void doAcquireShared(int arg) {\n    // \u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5173\u8054\u200b\u5230\u200b\u4e00\u4e2a\u200b Node \u200b\u5bf9\u8c61\u200b\u4e0a\u200b, \u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\n    final Node node = addWaiter(Node.SHARED);\n    boolean failed = true;\n    try {\n        boolean interrupted = false;\n        for (;;) {\n            // \u200b\u83b7\u53d6\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\n            final Node p = node.predecessor();\n            // \u200b\u5982\u679c\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u5c31\u5934\u200b\u8282\u70b9\u200b\u5c31\u200b\u53bb\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\n            if (p == head) {\n                // \u200b\u518d\u200b\u4e00\u6b21\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\n                int r = tryAcquireShared(arg);\n                // r &gt;= 0 \u200b\u8868\u793a\u200b\u83b7\u53d6\u200b\u6210\u529f\u200b\n                if (r &gt;= 0) {\n                    //\u3010\u200b\u8fd9\u91cc\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b\u81ea\u5df1\u200b\u4e3a\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u5524\u9192\u200b\u76f8\u8fde\u200b\u7684\u200b\u540e\u5e8f\u200b\u7684\u200b\u5171\u4eab\u200b\u8282\u70b9\u200b\u3011\n                    setHeadAndPropagate(node, r);\n                    p.next = null; // help GC\n                    if (interrupted)\n                        selfInterrupt();\n                    failed = false;\n                    return;\n                }\n            }\n            // \u200b\u662f\u5426\u200b\u5728\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u5931\u8d25\u200b\u65f6\u200b\u963b\u585e\u200b                        park \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt())\n                interrupted = true;\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6210\u529f\u200b\uff0c\u200b\u5728\u200b doAcquireShared \u200b\u5185\u200b for (;;) \u200b\u5faa\u73af\u200b\u4e00\u6b21\u200b\uff0cshouldParkAfterFailedAcquire \u200b\u5185\u200b\u628a\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b waitStatus \u200b\u6539\u4e3a\u200b -1\uff0c\u200b\u518d\u200b for (;;) \u200b\u5faa\u73af\u200b\u4e00\u6b21\u200b\u5c1d\u8bd5\u200b tryAcquireShared\uff0c\u200b\u4e0d\u200b\u6210\u529f\u200b\u5728\u200b parkAndCheckInterrupt() \u200b\u5904\u200b park</p> <p></p> <ul> <li>\u200b\u8fd9\u79cd\u200b\u72b6\u6001\u200b\u4e0b\u200b\uff0c\u200b\u5047\u8bbe\u200b\u53c8\u200b\u6709\u200b t3 r.lock\uff0ct4 w.lock\uff0c\u200b\u8fd9\u200b\u671f\u95f4\u200b t1 \u200b\u4ecd\u7136\u200b\u6301\u6709\u200b\u9501\u200b\uff0c\u200b\u5c31\u200b\u53d8\u6210\u200b\u4e86\u200b\u4e0b\u9762\u200b\u7684\u200b\u6837\u5b50\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_172","title":"\u89e3\u9501\u200b\u539f\u7406","text":"<ul> <li>t1 w.unlock\uff0c \u200b\u5199\u9501\u200b\u89e3\u9501\u200b</li> </ul> Java<pre><code>public void unlock() {\n    // \u200b\u91ca\u653e\u200b\u9501\u200b\n    sync.release(1);\n}\npublic final boolean release(int arg) {\n    // \u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u9501\u200b\n    if (tryRelease(arg)) {\n        Node h = head;\n        // \u200b\u5934\u200b\u8282\u70b9\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\u5e76\u4e14\u200b\u4e0d\u662f\u200b\u7b49\u5f85\u200b\u72b6\u6001\u200b\u4e0d\u662f\u200b 0\uff0c\u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\u7684\u200b\u975e\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\n        if (h != null &amp;&amp; h.waitStatus != 0)\n            unparkSuccessor(h);\n        return true;\n    }\n    return false;\n}\nprotected final boolean tryRelease(int releases) {\n    if (!isHeldExclusively())\n        throw new IllegalMonitorStateException();\n    int nextc = getState() - releases;\n    // \u200b\u56e0\u4e3a\u200b\u53ef\u200b\u91cd\u5165\u200b\u7684\u200b\u539f\u56e0\u200b, \u200b\u5199\u9501\u200b\u8ba1\u6570\u200b\u4e3a\u200b 0, \u200b\u624d\u200b\u7b97\u200b\u91ca\u653e\u200b\u6210\u529f\u200b\n    boolean free = exclusiveCount(nextc) == 0;\n    if (free)\n        setExclusiveOwnerThread(null);\n    setState(nextc);\n    return free;\n}\n</code></pre> <ul> <li>\u200b\u5524\u9192\u200b\u6d41\u7a0b\u200b sync.unparkSuccessor\uff0c\u200b\u8fd9\u65f6\u200b t2 \u200b\u5728\u200b doAcquireShared \u200b\u7684\u200b parkAndCheckInterrupt() \u200b\u5904\u200b\u6062\u590d\u200b\u8fd0\u884c\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u5faa\u73af\u200b\uff0c\u200b\u6267\u884c\u200b tryAcquireShared \u200b\u6210\u529f\u200b\u5219\u200b\u8ba9\u200b\u8bfb\u9501\u200b\u8ba1\u6570\u200b\u52a0\u4e00\u200b</li> <li>\u200b\u63a5\u4e0b\u6765\u200b t2 \u200b\u8c03\u7528\u200b setHeadAndPropagate(node, 1)\uff0c\u200b\u5b83\u200b\u539f\u672c\u200b\u6240\u5728\u200b\u8282\u70b9\u200b\u88ab\u200b\u7f6e\u200b\u4e3a\u200b\u5934\u200b\u8282\u70b9\u200b\uff1b\u200b\u8fd8\u4f1a\u200b\u68c0\u67e5\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u662f\u5426\u662f\u200b shared\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u5219\u200b\u8c03\u7528\u200b doReleaseShared() \u200b\u5c06\u200b head \u200b\u7684\u200b\u72b6\u6001\u200b\u4ece\u200b -1 \u200b\u6539\u4e3a\u200b 0 \u200b\u5e76\u200b\u5524\u9192\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u8fd9\u65f6\u200b t3 \u200b\u5728\u200b doAcquireShared \u200b\u5185\u200b parkAndCheckInterrupt() \u200b\u5904\u200b\u6062\u590d\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5524\u9192\u200b\u8fde\u7eed\u200b\u7684\u200b\u6240\u6709\u200b\u7684\u200b\u5171\u4eab\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>private void setHeadAndPropagate(Node node, int propagate) {\n    Node h = head; \n    // \u200b\u8bbe\u7f6e\u200b\u81ea\u5df1\u200b\u4e3a\u200b head \u200b\u8282\u70b9\u200b\n    setHead(node);\n    // propagate \u200b\u8868\u793a\u200b\u6709\u200b\u5171\u4eab\u8d44\u6e90\u200b\uff08\u200b\u4f8b\u5982\u200b\u5171\u4eab\u200b\u8bfb\u9501\u200b\u6216\u200b\u4fe1\u53f7\u91cf\u200b\uff09\uff0c\u200b\u4e3a\u200b 0 \u200b\u5c31\u200b\u6ca1\u6709\u200b\u8d44\u6e90\u200b\n    if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 ||\n        (h = head) == null || h.waitStatus &lt; 0) {\n        // \u200b\u83b7\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n        Node s = node.next;\n        // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u6216\u8005\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u662f\u200b\u3010\u200b\u7b49\u5f85\u200b\u5171\u4eab\u200b\u8bfb\u9501\u200b\u7684\u200b\u8282\u70b9\u200b\u3011\n        if (s == null || s.isShared())\n            // \u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n            doReleaseShared();\n    }\n}\n</code></pre> Java<pre><code>private void doReleaseShared() {\n    // \u200b\u5982\u679c\u200b head.waitStatus == Node.SIGNAL ==&gt; 0 \u200b\u6210\u529f\u200b, \u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b unpark\n  // \u200b\u5982\u679c\u200b head.waitStatus == 0 ==&gt; Node.PROPAGATE\n    for (;;) {\n        Node h = head;\n        if (h != null &amp;&amp; h != tail) {\n            int ws = h.waitStatus;\n            // SIGNAL \u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\n            if (ws == Node.SIGNAL) {\n                // \u200b\u56e0\u4e3a\u200b\u8bfb\u9501\u200b\u5171\u4eab\u200b\uff0c\u200b\u5982\u679c\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u5728\u200b\u91ca\u653e\u200b\u8bfb\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u5c06\u200b waitStatus \u200b\u5148\u200b\u6539\u4e3a\u200b 0\n              // \u200b\u9632\u6b62\u200b unparkSuccessor \u200b\u88ab\u200b\u591a\u6b21\u200b\u6267\u884c\u200b\n                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))\n                    continue;  \n                // \u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n                unparkSuccessor(h);\n            }\n            // \u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u662f\u200b 0 \u200b\u4e86\u200b\uff0c\u200b\u6539\u4e3a\u200b -3\uff0c\u200b\u7528\u6765\u200b\u89e3\u51b3\u200b\u4f20\u64ad\u200b\u6027\u200b\n            else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))\n                continue;                \n        }\n        // \u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u88ab\u200b\u5524\u9192\u200b\u7684\u200b\u8282\u70b9\u200b\u975e\u5e38\u200b\u79ef\u6781\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5c06\u200b\u81ea\u5df1\u200b\u8bbe\u7f6e\u200b\u4e3a\u4e86\u200b\u65b0\u200b\u7684\u200b head\uff0c\n        // \u200b\u6b64\u65f6\u200b\u5524\u9192\u200b\u5b83\u200b\u7684\u200b\u8282\u70b9\u200b\uff08\u200b\u524d\u9a71\u200b\uff09\u200b\u6267\u884c\u200b h == head \u200b\u4e0d\u200b\u6210\u7acb\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u4f1a\u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\uff0c\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u5524\u9192\u200b\u65b0\u200b\u7684\u200b head \u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n        if (h == head)                   \n            break;\n    }\n}\n</code></pre> <ul> <li>\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u4e0d\u662f\u200b shared \u200b\u4e86\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u4f1a\u200b\u7ee7\u7eed\u200b\u5524\u9192\u200b t4 \u200b\u6240\u5728\u200b\u8282\u70b9\u200b</li> <li>t2 \u200b\u8bfb\u9501\u200b\u89e3\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200b sync.releaseShared(1) \u200b\u4e2d\u200b\uff0c\u200b\u8c03\u7528\u200b tryReleaseShared(1) \u200b\u8ba9\u200b\u8ba1\u6570\u200b\u51cf\u4e00\u200b\uff0c\u200b\u4f46\u200b\u8ba1\u6570\u200b\u8fd8\u200b\u4e0d\u200b\u4e3a\u200b\u96f6\u200b\uff0ct3 \u200b\u540c\u6837\u200b\u8ba9\u200b\u8ba1\u6570\u200b\u51cf\u4e00\u200b\uff0c\u200b\u8ba1\u6570\u200b\u4e3a\u200b\u96f6\u200b\uff0c\u200b\u8fdb\u5165\u200bdoReleaseShared() \u200b\u5c06\u5934\u200b\u8282\u70b9\u200b\u4ece\u200b -1 \u200b\u6539\u4e3a\u200b 0 \u200b\u5e76\u200b\u5524\u9192\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>public void unlock() {\n    sync.releaseShared(1);\n}\npublic final boolean releaseShared(int arg) {\n    if (tryReleaseShared(arg)) {\n        doReleaseShared();\n        return true;\n    }\n    return false;\n}\n</code></pre> Java<pre><code>protected final boolean tryReleaseShared(int unused) {\n\n    for (;;) {\n        int c = getState();\n        int nextc = c - SHARED_UNIT;\n        // \u200b\u8bfb\u9501\u200b\u7684\u200b\u8ba1\u6570\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5176\u5b83\u200b\u83b7\u53d6\u200b\u8bfb\u200b\u9501\u7ebf\u200b\u7a0b\u200b, \u200b\u4f46\u4f1a\u200b\u5f71\u54cd\u200b\u5176\u5b83\u200b\u83b7\u53d6\u200b\u5199\u200b\u9501\u7ebf\u200b\u7a0b\u200b\uff0c\u200b\u8ba1\u6570\u200b\u4e3a\u200b 0 \u200b\u624d\u200b\u662f\u200b\u771f\u6b63\u200b\u91ca\u653e\u200b\n        if (compareAndSetState(c, nextc))\n            // \u200b\u8fd4\u56de\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\u4e86\u200b \n            return nextc == 0;\n    }\n}\n</code></pre> <ul> <li>t4 \u200b\u5728\u200b acquireQueued \u200b\u4e2d\u200b parkAndCheckInterrupt \u200b\u5904\u200b\u6062\u590d\u200b\u8fd0\u884c\u200b\uff0c\u200b\u518d\u6b21\u200b for (;;) \u200b\u8fd9\u6b21\u200b\u81ea\u5df1\u200b\u662f\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u4e34\u200b\u8282\u70b9\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u8282\u70b9\u200b\u7ade\u4e89\u200b\uff0ctryAcquire(1) \u200b\u6210\u529f\u200b\uff0c\u200b\u4fee\u6539\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u6d41\u7a0b\u200b\u7ed3\u675f\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#stamped","title":"Stamped","text":"<p>StampedLock\uff1a\u200b\u8bfb\u5199\u200b\u9501\u200b\uff0c\u200b\u8be5\u7c7b\u200b\u81ea\u200b JDK 8 \u200b\u52a0\u5165\u200b\uff0c\u200b\u662f\u200b\u4e3a\u4e86\u200b\u8fdb\u4e00\u6b65\u200b\u4f18\u5316\u200b\u8bfb\u200b\u6027\u80fd\u200b</p> <p>\u200b\u7279\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b\u4f7f\u7528\u200b\u8bfb\u9501\u200b\u3001\u200b\u5199\u9501\u200b\u65f6\u200b\u90fd\u200b\u5fc5\u987b\u200b\u914d\u5408\u200b\u6233\u200b\u4f7f\u7528\u200b</li> <li>StampedLock \u200b\u4e0d\u200b\u652f\u6301\u200b\u6761\u4ef6\u200b\u53d8\u91cf\u200b</li> <li>StampedLock \u200b\u4e0d\u200b\u652f\u6301\u200b\u91cd\u200b\u5165\u200b</li> </ul> <p>\u200b\u57fa\u672c\u200b\u7528\u6cd5\u200b</p> <ul> <li>\u200b\u52a0\u200b\u89e3\u8bfb\u200b\u9501\u200b\uff1a</li> </ul> Java<pre><code>long stamp = lock.readLock();\nlock.unlockRead(stamp);           // \u200b\u7c7b\u4f3c\u200b\u4e8e\u200b unpark\uff0c\u200b\u89e3\u200b\u6307\u5b9a\u200b\u7684\u200b\u9501\u200b\n</code></pre> <ul> <li>\u200b\u52a0\u89e3\u200b\u5199\u9501\u200b\uff1a</li> </ul> Java<pre><code>long stamp = lock.writeLock();\nlock.unlockWrite(stamp);\n</code></pre> <ul> <li>\u200b\u4e50\u89c2\u200b\u8bfb\u200b\uff0cStampedLock \u200b\u652f\u6301\u200b <code>tryOptimisticRead()</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u5b8c\u6bd5\u200b\u540e\u200b\u505a\u200b\u4e00\u6b21\u200b\u6233\u200b\u6821\u9a8c\u200b\uff0c\u200b\u5982\u679c\u200b\u6821\u9a8c\u200b\u901a\u8fc7\u200b\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u671f\u95f4\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6570\u636e\u200b\u53ef\u4ee5\u200b\u5b89\u5168\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5982\u679c\u200b\u6821\u9a8c\u200b\u6ca1\u200b\u901a\u8fc7\u200b\uff0c\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\uff0c\u200b\u4fdd\u8bc1\u6570\u636e\u200b\u4e00\u81f4\u6027\u200b</li> </ul> Java<pre><code>long stamp = lock.tryOptimisticRead();\n// \u200b\u9a8c\u6233\u200b\nif(!lock.validate(stamp)){\n  // \u200b\u9501\u200b\u5347\u7ea7\u200b\n}\n</code></pre> <p>\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u5bb9\u5668\u200b\u7c7b\u200b\u5185\u90e8\u200b\u5206\u522b\u200b\u4f7f\u7528\u200b\u8bfb\u9501\u200b\u4fdd\u62a4\u200b\u6570\u636e\u200b\u7684\u200b read() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5199\u9501\u200b\u4fdd\u62a4\u200b\u6570\u636e\u200b\u7684\u200b write() \u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u8bfb\u200b-\u200b\u8bfb\u200b\u53ef\u4ee5\u200b\u4f18\u5316\u200b</li> <li>\u200b\u8bfb\u200b-\u200b\u5199\u200b\u4f18\u5316\u200b\u8bfb\u200b\uff0c\u200b\u8865\u52a0\u200b\u8bfb\u9501\u200b</li> </ul> Java<pre><code>public static void main(String[] args) throws InterruptedException {\n    DataContainerStamped dataContainer = new DataContainerStamped(1);\n    new Thread(() -&gt; {\n        dataContainer.read(1000);\n    },\"t1\").start();\n    Thread.sleep(500);\n\n    new Thread(() -&gt; {\n        dataContainer.write(1000);\n    },\"t2\").start();\n}\n\nclass DataContainerStamped {\n    private int data;\n    private final StampedLock lock = new StampedLock();\n\n    public int read(int readTime) throws InterruptedException {\n        long stamp = lock.tryOptimisticRead();\n        System.out.println(new Date() + \" optimistic read locking\" + stamp);\n        Thread.sleep(readTime);\n        // \u200b\u6233\u200b\u6709\u6548\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b\n        if (lock.validate(stamp)) {\n            Sout(new Date() + \" optimistic read finish...\" + stamp);\n            return data;\n        }\n\n        // \u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u66f4\u6539\u200b\u4e86\u200b\u6233\u200b\uff0c\u200b\u9700\u8981\u200b\u9501\u200b\u5347\u7ea7\u200b\u4e86\u200b\uff0c\u200b\u4ece\u200b\u4e50\u89c2\u200b\u8bfb\u200b\u5347\u7ea7\u200b\u5230\u200b\u8bfb\u9501\u200b\n        System.out.println(new Date() + \" updating to read lock\" + stamp);\n        try {\n            stamp = lock.readLock();\n            System.out.println(new Date() + \" read lock\" + stamp);\n            Thread.sleep(readTime);\n            System.out.println(new Date() + \" read finish...\" + stamp);\n            return data;\n        } finally {\n            System.out.println(new Date() + \" read unlock \" +  stamp);\n            lock.unlockRead(stamp);\n        }\n    }\n\n    public void write(int newData) {\n        long stamp = lock.writeLock();\n        System.out.println(new Date() + \" write lock \" + stamp);\n        try {\n            Thread.sleep(2000);\n            this.data = newData;\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            System.out.println(new Date() + \" write unlock \" + stamp);\n            lock.unlockWrite(stamp);\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#countdown","title":"CountDown","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_173","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>CountDownLatch\uff1a\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u7528\u6765\u200b\u8fdb\u884c\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\u534f\u4f5c\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u5b8c\u6210\u200b</p> <p>\u200b\u6784\u9020\u200b\u5668\u200b\uff1a</p> <ul> <li><code>public CountDownLatch(int count)</code>\uff1a\u200b\u521d\u59cb\u5316\u200b\u5524\u9192\u200b\u9700\u8981\u200b\u7684\u200b down \u200b\u51e0\u6b65\u200b</li> </ul> <p>\u200b\u5e38\u7528\u200bAPI\uff1a</p> <ul> <li><code>public void await()</code>\uff1a\u200b\u8ba9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\uff0c\u200b\u5fc5\u987b\u200b down \u200b\u5b8c\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u6570\u5b57\u200b\u624d\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u5426\u5219\u200b\u8fdb\u5165\u200b\u65e0\u9650\u200b\u7b49\u5f85\u200b</li> <li><code>public void countDown()</code>\uff1a\u200b\u8ba1\u6570\u5668\u200b\u8fdb\u884c\u200b\u51cf\u200b 1\uff08down 1\uff09</li> </ul> <p>\u200b\u5e94\u7528\u200b\uff1a\u200b\u540c\u6b65\u200b\u7b49\u5f85\u200b\u591a\u4e2a\u200b Rest \u200b\u8fdc\u7a0b\u200b\u8c03\u7528\u200b\u7ed3\u675f\u200b</p> Java<pre><code>// LOL 10\u200b\u4eba\u200b\u8fdb\u5165\u200b\u6e38\u620f\u200b\u5012\u8ba1\u65f6\u200b\npublic static void main(String[] args) throws InterruptedException {\n    CountDownLatch latch = new CountDownLatch(10);\n    ExecutorService service = Executors.newFixedThreadPool(10);\n    String[] all = new String[10];\n    Random random = new Random();\n\n    for (int j = 0; j &lt; 10; j++) {\n        int finalJ = j;//\u200b\u5e38\u91cf\u200b\n        service.submit(() -&gt; {\n            for (int i = 0; i &lt;= 100; i++) {\n                Thread.sleep(random.nextInt(100));  //\u200b\u968f\u673a\u200b\u4f11\u7720\u200b\n                all[finalJ] = i + \"%\";\n                System.out.print(\"\\r\" + Arrays.toString(all));  // \\r\u200b\u4ee3\u8868\u200b\u8986\u76d6\u200b\n            }\n            latch.countDown();\n        });\n    }\n    latch.await();\n    System.out.println(\"\\n\u200b\u6e38\u620f\u200b\u5f00\u59cb\u200b\");\n    service.shutdown();\n}\n/*\n[100%, 100%, 100%, 100%, 100%, 100%, 100%, 100%, 100%, 100%]\n\u200b\u6e38\u620f\u200b\u5f00\u59cb\u200b\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_174","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"<p>\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b await() \u200b\u7b49\u5f85\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\uff1a\u200b\u652f\u6301\u200b\u6253\u65ad\u200b</li> </ul> Java<pre><code>public void await() throws InterruptedException {\n    sync.acquireSharedInterruptibly(1);\n}\n// AbstractQueuedSynchronizer#acquireSharedInterruptibly\npublic final void acquireSharedInterruptibly(int arg) throws InterruptedException {\n    // \u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u629b\u51fa\u200b\u6253\u65ad\u200b\u5f02\u5e38\u200b\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    // \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u5171\u4eab\u200b\u9501\u200b\uff0c\u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b state &gt; 0\uff0c\u200b\u6b64\u65f6\u200b\u7ebf\u7a0b\u200b\u5165\u961f\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\uff0c\u200b\u7b49\u5f85\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u5171\u4eab\u8d44\u6e90\u200b\n    // \u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b state = 0\uff0c\u200b\u6b64\u65f6\u200b\u4e0d\u200b\u9700\u8981\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u7ed3\u675f\u200b\u51fd\u6570\u8c03\u7528\u200b\n    if (tryAcquireShared(arg) &lt; 0)\n        doAcquireSharedInterruptibly(arg);\n}\n// CountDownLatch.Sync#tryAcquireShared\nprotected int tryAcquireShared(int acquires) {\n    return (getState() == 0) ? 1 : -1;\n}\n</code></pre> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b AbstractQueuedSynchronizer#doAcquireSharedInterruptibly \u200b\u51fd\u6570\u200b\u963b\u585e\u200b\u6302\u200b\u8d77\u200b\uff0c\u200b\u7b49\u5f85\u200b latch \u200b\u53d8\u4e3a\u200b 0\uff1a</li> </ul> Java<pre><code>private void doAcquireSharedInterruptibly(int arg) throws InterruptedException {\n    // \u200b\u5c06\u200b\u8c03\u7528\u200blatch.await()\u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ebf\u7a0b\u200b \u200b\u5305\u88c5\u200b\u6210\u200b SHARED \u200b\u7c7b\u578b\u200b\u7684\u200b node \u200b\u52a0\u5165\u200b\u5230\u200b AQS \u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\n    final Node node = addWaiter(Node.SHARED);\n    boolean failed = true;\n    try {\n        for (;;) {\n            // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\n            final Node p = node.predecessor();\n            // \u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u65f6\u5934\u200b\u8282\u70b9\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\n            if (p == head) {\n                // \u200b\u518d\u6b21\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u83b7\u53d6\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b 1\n                int r = tryAcquireShared(arg);\n                if (r &gt;= 0) {\n                    // \u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e3a\u200b head \u200b\u8282\u70b9\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5411\u200b\u540e\u200b\u4f20\u64ad\u200b\n                    setHeadAndPropagate(node, r);\n                    p.next = null; // help GC\n                    failed = false;\n                    return;\n                }\n            }\n            // \u200b\u963b\u585e\u200b\u5728\u200b\u8fd9\u91cc\u200b\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt())\n                throw new InterruptedException();\n        }\n    } finally {\n        // \u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u540e\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\uff0c\u200b\u8fdb\u5165\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u7684\u200b\u903b\u8f91\u200b\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n</code></pre> <ul> <li>\u200b\u83b7\u53d6\u200b\u5171\u4eab\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u8fdb\u5165\u200b\u5524\u9192\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u4e0e\u200b\u5934\u200b\u8282\u70b9\u200b\u76f8\u8fde\u200b\u7684\u200b SHARED \u200b\u6a21\u5f0f\u200b\u7684\u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>private void setHeadAndPropagate(Node node, int propagate) {\n    Node h = head;\n    // \u200b\u5c06\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u65b0\u200b\u7684\u200b head \u200b\u8282\u70b9\u200b\uff0c\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u548c\u200b\u6301\u6709\u200b\u7ebf\u7a0b\u200b\u7f6e\u200b\u4e3a\u200b null\n    setHead(node);\n  // propagate = 1\uff0c\u200b\u6761\u4ef6\u200b\u4e00\u200b\u6210\u7acb\u200b\n    if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n        Node s = node.next;\n        // \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u65f6\u200b next \u200b\u4e3a\u200b null\uff0c\u200b\u6216\u8005\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u662f\u200b SHARED \u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\n        if (s == null || s.isShared())\n            // \u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7684\u200b\u7b49\u5f85\u200b\u5171\u4eab\u200b\u9501\u200b\u7684\u200b\u8282\u70b9\u200b\n            doReleaseShared();\n    }\n}\n</code></pre> <p>\u200b\u8ba1\u6570\u200b\u51cf\u4e00\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b countDown() \u200b\u5b8c\u6210\u200b\u8ba1\u6570\u5668\u200b\u51cf\u4e00\u200b\uff08\u200b\u91ca\u653e\u200b\u9501\u200b\uff09\u200b\u7684\u200b\u64cd\u4f5c\u200b</li> </ul> Java<pre><code>public void countDown() {\n    sync.releaseShared(1);\n}\npublic final boolean releaseShared(int arg) {\n    // \u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u5171\u4eab\u200b\u9501\u200b\n    if (tryReleaseShared(arg)) {\n        // \u200b\u91ca\u653e\u200b\u9501\u200b\u6210\u529f\u200b\u5f00\u59cb\u200b\u5524\u9192\u200b\u963b\u585e\u200b\u8282\u70b9\u200b\n        doReleaseShared();\n        return true;\n    }\n    return false;\n}\n</code></pre> <ul> <li>\u200b\u66f4\u65b0\u200b state \u200b\u503c\u200b\uff0c\u200b\u6bcf\u200b\u8c03\u7528\u200b\u4e00\u6b21\u200b\uff0cstate \u200b\u503c\u51cf\u200b\u4e00\u200b\uff0c\u200b\u5f53\u200b state -1 \u200b\u6b63\u597d\u200b\u4e3a\u200b 0 \u200b\u65f6\u200b\uff0c\u200b\u8fd4\u56de\u200b true</li> </ul> Java<pre><code>protected boolean tryReleaseShared(int releases) {\n    for (;;) {\n        int c = getState();\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u524d\u9762\u200b\u3010\u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u89e6\u53d1\u200b\u5524\u9192\u200b\u64cd\u4f5c\u200b\u3011\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8fd4\u56de\u200b false\n        if (c == 0)\n            return false;\n        // \u200b\u8ba1\u6570\u5668\u200b\u51cf\u4e00\u200b\n        int nextc = c-1;\n        if (compareAndSetState(c, nextc))\n            // \u200b\u8ba1\u6570\u5668\u200b\u4e3a\u200b 0 \u200b\u65f6\u200b\u8fd4\u56de\u200b true\n            return nextc == 0;\n    }\n}\n</code></pre> <ul> <li>state = 0 \u200b\u65f6\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u5524\u9192\u200b\u963b\u585e\u200b\u8282\u70b9\u200b\u7684\u200b\u4efb\u52a1\u200b</li> </ul> Java<pre><code>private void doReleaseShared() {\n    for (;;) {\n        Node h = head;\n        // \u200b\u5224\u65ad\u200b\u961f\u5217\u200b\u662f\u5426\u662f\u200b\u7a7a\u200b\u961f\u5217\u200b\n        if (h != null &amp;&amp; h != tail) {\n            int ws = h.waitStatus;\n            // \u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b signal\uff0c\u200b\u8bf4\u660e\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5524\u9192\u200b\u8fc7\u200b\n            if (ws == Node.SIGNAL) {\n                // cas \u200b\u8bbe\u7f6e\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b 0\uff0c\u200b\u8bbe\u7f6e\u200b\u5931\u8d25\u200b\u7ee7\u7eed\u200b\u81ea\u65cb\u200b\n                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))\n                    continue;\n                // \u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n                unparkSuccessor(h);\n            }\n            // \u200b\u5982\u679c\u200b\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u91cd\u65b0\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b PROPAGATE \u200b\u4f20\u64ad\u200b\u5c5e\u6027\u200b\n            else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))\n                continue;\n        }\n        // \u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u88ab\u200b\u5524\u9192\u200b\u7684\u200b\u8282\u70b9\u200b\u975e\u5e38\u200b\u79ef\u6781\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5c06\u200b\u81ea\u5df1\u200b\u8bbe\u7f6e\u200b\u4e3a\u4e86\u200b\u65b0\u200b\u7684\u200bhead\uff0c\n        // \u200b\u6b64\u65f6\u200b\u5524\u9192\u200b\u5b83\u200b\u7684\u200b\u8282\u70b9\u200b\uff08\u200b\u524d\u9a71\u200b\uff09\u200b\u6267\u884c\u200b h == head \u200b\u4e0d\u200b\u6210\u7acb\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u4f1a\u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\uff0c\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u5524\u9192\u200b\u65b0\u200b\u7684\u200b head \u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n        if (h == head)\n            break;\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#cyclicbarrier","title":"CyclicBarrier","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_175","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>CyclicBarrier\uff1a\u200b\u5faa\u73af\u200b\u5c4f\u969c\u200b\uff0c\u200b\u7528\u6765\u200b\u8fdb\u884c\u200b\u7ebf\u7a0b\u200b\u534f\u4f5c\u200b\uff0c\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\u6ee1\u8db3\u200b\u67d0\u4e2a\u200b\u8ba1\u6570\u200b\uff0c\u200b\u624d\u80fd\u200b\u89e6\u53d1\u200b\u81ea\u5df1\u200b\u6267\u884c\u200b</p> <p>\u200b\u5e38\u7528\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>public CyclicBarrier(int parties, Runnable barrierAction)</code>\uff1a\u200b\u7528\u4e8e\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u5230\u8fbe\u200b\u5c4f\u969c\u200b parties \u200b\u65f6\u200b\uff0c\u200b\u6267\u884c\u200b barrierAction</li> <li>parties\uff1a\u200b\u4ee3\u8868\u200b\u591a\u5c11\u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u5230\u8fbe\u200b\u5c4f\u969c\u200b\u5f00\u59cb\u200b\u89e6\u53d1\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b</li> <li>barrierAction\uff1a\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b</li> <li><code>public int await()</code>\uff1a\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b await \u200b\u65b9\u6cd5\u200b\u901a\u77e5\u200b CyclicBarrier \u200b\u672c\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u5230\u8fbe\u200b\u5c4f\u969c\u200b</li> </ul> <p>\u200b\u4e0e\u200b CountDownLatch \u200b\u7684\u200b\u533a\u522b\u200b\uff1aCyclicBarrier \u200b\u662f\u200b\u53ef\u4ee5\u200b\u91cd\u7528\u200b\u7684\u200b</p> <p>\u200b\u5e94\u7528\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u591a\u7ebf\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u67d0\u4e2a\u200b\u4efb\u52a1\u200b\u5728\u200b\u7b49\u5f85\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u4ee5\u540e\u200b\u89e6\u53d1\u200b</p> Java<pre><code>public static void main(String[] args) {\n    ExecutorService service = Executors.newFixedThreadPool(2);\n    CyclicBarrier barrier = new CyclicBarrier(2, () -&gt; {\n        System.out.println(\"task1 task2 finish...\");\n    });\n\n    for (int i = 0; i &lt; 3; i++) { // \u200b\u5faa\u73af\u200b\u91cd\u7528\u200b\n        service.submit(() -&gt; {\n            System.out.println(\"task1 begin...\");\n            try {\n                Thread.sleep(1000);\n                barrier.await();    // 2 - 1 = 1\n            } catch (InterruptedException | BrokenBarrierException e) {\n                e.printStackTrace();\n            }\n        });\n\n        service.submit(() -&gt; {\n            System.out.println(\"task2 begin...\");\n            try {\n                Thread.sleep(2000);\n                barrier.await();    // 1 - 1 = 0\n            } catch (InterruptedException | BrokenBarrierException e) {\n                e.printStackTrace();\n            }\n        });\n    }\n    service.shutdown();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_176","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_177","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"<ul> <li>\u200b\u5168\u5c40\u200b\u9501\u200b\uff1a\u200b\u5229\u7528\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5de5\u5177\u200b\u7c7b\u200b</li> </ul> Java<pre><code>// barrier \u200b\u5b9e\u73b0\u200b\u662f\u200b\u4f9d\u8d56\u4e8e\u200bCondition\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\uff0ccondition \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5fc5\u987b\u200b\u4f9d\u8d56\u200block\u200b\u624d\u80fd\u200b\u4f7f\u7528\u200b\nprivate final ReentrantLock lock = new ReentrantLock();\n// \u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b\u5b9e\u73b0\u200b\u4f7f\u7528\u200b\u7684\u200b condition \u200b\u961f\u5217\u200b\uff0c\u200b\u5f53\u524d\u200b\u4ee3\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u5230\u4f4d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u624d\u200b\u4f1a\u200b\u88ab\u200b\u5524\u9192\u200b\nprivate final Condition trip = lock.newCondition();\n</code></pre> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\uff1a</li> </ul> Java<pre><code>private final int parties;    // \u200b\u4ee3\u8868\u200b\u591a\u5c11\u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u5230\u8fbe\u200b\u5c4f\u969c\u200b\u5f00\u59cb\u200b\u89e6\u53d1\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\nprivate int count;            // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u201c\u200b\u4ee3\u200b\u201d\u200b\u8fd8\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u672a\u200b\u5230\u4f4d\u200b\uff0c\u200b\u521d\u59cb\u503c\u200b\u4e3a\u200b parties\n</code></pre> <ul> <li>\u200b\u5f53\u524d\u200b\u4ee3\u4e2d\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5230\u4f4d\u200b\u540e\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u4e8b\u4ef6\u200b\uff1a</li> </ul> Java<pre><code>private final Runnable barrierCommand;\n</code></pre> <ul> <li>\u200b\u4ee3\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u8868\u793a\u200b barrier \u200b\u5bf9\u8c61\u200b\u5f53\u524d\u200b \u200b\u4ee3\u200b\nprivate Generation generation = new Generation();\nprivate static class Generation {\n    // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u201c\u200b\u4ee3\u200b\u201d\u200b\u662f\u5426\u200b\u88ab\u200b\u6253\u7834\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u6253\u7834\u200b\u518d\u200b\u6765\u5230\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u7684\u200b\u7ebf\u7a0b\u200b \u200b\u5c31\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u629b\u51fa\u200b BrokenException \u200b\u5f02\u5e38\u200b\n    // \u200b\u4e14\u200b\u5728\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u6302\u200b\u8d77\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u7136\u540e\u200b\u629b\u51fa\u200b BrokerException \u200b\u5f02\u5e38\u200b\u3002\n    boolean broken = false;\n}\n</code></pre> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>public CyclicBarrie(int parties, Runnable barrierAction) {\n    // \u200b\u56e0\u4e3a\u200b\u5c0f\u4e8e\u200b\u7b49\u4e8e\u200b 0 \u200b\u7684\u200b barrier \u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u610f\u4e49\u200b\n    if (parties &lt;= 0) throw new IllegalArgumentException();\n\n    this.parties = parties;\n    this.count = parties;\n    // \u200b\u53ef\u4ee5\u200b\u4e3a\u200b null\n    this.barrierCommand = barrierAction;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_178","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"<ul> <li>await()\uff1a\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u5230\u4f4d\u200b</li> </ul> Java<pre><code>public int await() throws InterruptedException, BrokenBarrierException {\n    try {\n        return dowait(false, 0L);\n    } catch (TimeoutException toe) {\n        throw new Error(toe); // cannot happen\n    }\n}\n</code></pre> Java<pre><code>// timed\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8c03\u7528\u200bawait\u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u6307\u5b9a\u200b\u4e86\u200b\u8d85\u65f6\u200b\u65f6\u200b\u957f\u200b\uff0c\u200b\u5982\u679c\u200b true \u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u54cd\u5e94\u200b\u8d85\u65f6\u200b\u7684\u200b\n// nanos\uff1a\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u8d85\u65f6\u200b\u65f6\u200b\u957f\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b\u7eb3\u79d2\u200b\nprivate int dowait(boolean timed, long nanos) {\n    final ReentrantLock lock = this.lock;\n    // \u200b\u52a0\u9501\u200b\n    lock.lock();\n    try {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u4ee3\u200b\n        final Generation g = generation;\n\n        // \u3010\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u4ee3\u662f\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u6253\u7834\u200b\u72b6\u6001\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b\u8c03\u7528\u200bawait\u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u629b\u51fa\u200bBroken\u200b\u5f02\u5e38\u200b\u3011\n        if (g.broken)\n            throw new BrokenBarrierException();\n      // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u4e86\u200b\uff0c\u200b\u5219\u200b\u6253\u7834\u200b\u5f53\u524d\u200b\u4ee3\u200b\uff0c\u200b\u7136\u540e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u629b\u51fa\u200b\u4e2d\u65ad\u200b\u5f02\u5e38\u200b\n        if (Thread.interrupted()) {\n            // \u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u4ee3\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b broken \u200b\u72b6\u6001\u200b\uff0c\u200b\u5524\u9192\u200b\u5728\u200b trip \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n            breakBarrier();\n            throw new InterruptedException();\n        }\n\n        // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\u662f\u200b false\uff0c \u200b\u5f53\u524d\u200b\u4ee3\u200b\u7684\u200b broken \u200b\u4e3a\u200b false\uff08\u200b\u672a\u200b\u6253\u7834\u200b\u72b6\u6001\u200b\uff09\n\n        // \u200b\u5047\u8bbe\u200b parties \u200b\u7ed9\u200b\u7684\u200b\u662f\u200b 5\uff0c\u200b\u90a3\u4e48\u200bindex\u200b\u5bf9\u5e94\u200b\u7684\u200b\u503c\u200b\u4e3a\u200b 4,3,2,1,0\n        int index = --count;\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5230\u8fbe\u200b barrier \u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u3010\u200b\u9700\u8981\u200b\u5f00\u542f\u200b\u65b0\u4ee3\u200b\uff0c\u200b\u5524\u9192\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\u3011\n        if (index == 0) {\n            // \u200b\u6805\u680f\u200b\u4efb\u52a1\u200b\u542f\u52a8\u200b\u6807\u8bb0\u200b\n            boolean ranAction = false;\n            try {\n                final Runnable command = barrierCommand;\n                if (command != null)\n                    // \u200b\u542f\u52a8\u200b\u89e6\u53d1\u200b\u7684\u200b\u4efb\u52a1\u200b\n                    command.run();\n                // run()\u200b\u672a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u7684\u8bdd\u200b\uff0c\u200b\u542f\u52a8\u200b\u6807\u8bb0\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b true\n                ranAction = true;\n                // \u200b\u5f00\u542f\u200b\u65b0\u200b\u7684\u200b\u4e00\u4ee3\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4f1a\u200b\u3010\u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u3011\n                nextGeneration();\n                // \u200b\u8fd4\u56de\u200b 0 \u200b\u56e0\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u6b64\u4ee3\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5230\u8fbe\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0cindex == 0\n                return 0;\n            } finally {\n                // \u200b\u5982\u679c\u200b command.run() \u200b\u6267\u884c\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u5230\u200b\u8fd9\u91cc\u200b\n                if (!ranAction)\n                    breakBarrier();\n            }\n        }\n\n        // \u200b\u81ea\u65cb\u200b\uff0c\u200b\u4e00\u76f4\u200b\u5230\u200b\u6761\u4ef6\u200b\u6ee1\u8db3\u200b\u3001\u200b\u5f53\u524d\u200b\u4ee3\u200b\u88ab\u200b\u6253\u7834\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u7b49\u5f85\u200b\u8d85\u65f6\u200b\n        for (;;) {\n            try {\n                // \u200b\u6839\u636e\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u8d85\u65f6\u200b\u7b49\u5f85\u200b\u9009\u62e9\u200b\u963b\u585e\u200b\u65b9\u6cd5\u200b\n                if (!timed)\n                    // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u91ca\u653e\u200b\u6389\u200b lock\uff0c\u3010\u200b\u8fdb\u5165\u200b\u5230\u200b trip \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u90e8\u200b\u6302\u200b\u8d77\u200b\u81ea\u5df1\u200b\u3011\uff0c\u200b\u7b49\u5f85\u200b\u88ab\u200b\u5524\u9192\u200b\n                    trip.await();\n                else if (nanos &gt; 0L)\n                    nanos = trip.awaitNanos(nanos);\n            } catch (InterruptedException ie) {\n                // \u200b\u88ab\u200b\u4e2d\u65ad\u200b\u540e\u6765\u200b\u5230\u200b\u8fd9\u91cc\u200b\u7684\u200b\u903b\u8f91\u200b\n\n                // \u200b\u5f53\u524d\u200b\u4ee3\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6253\u7834\u200b\n                if (g == generation &amp;&amp; !g.broken) {\n                    // \u200b\u6253\u7834\u200b\u5c4f\u969c\u200b\n                    breakBarrier();\n                    // node \u200b\u8282\u70b9\u200b\u5728\u200b\u3010\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u3011\u200b\u5185\u200b\u6536\u5230\u200b\u4e2d\u65ad\u200b\u4fe1\u53f7\u200b\u65f6\u200b \u200b\u4f1a\u200b\u629b\u51fa\u200b\u4e2d\u65ad\u200b\u5f02\u5e38\u200b\n                    throw ie;\n                } else {\n                    // \u200b\u7b49\u5f85\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4ee3\u200b\u53d8\u5316\u200b\u4e86\u200b\uff0c\u200b\u5b8c\u6210\u200b\u4e00\u6b21\u200b\u81ea\u6211\u200b\u6253\u65ad\u200b\n                    Thread.currentThread().interrupt();\n                }\n            }\n          // \u200b\u5524\u9192\u200b\u540e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u3010\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u4ee3\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u6253\u7834\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5524\u9192\u200b\u540e\u200b\u4f9d\u6b21\u200b\u629b\u51fa\u200b BrokenBarrier \u200b\u5f02\u5e38\u200b\u3011\n            if (g.broken)\n                throw new BrokenBarrierException();\n\n            // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b\u671f\u95f4\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5230\u4f4d\u200b\u4e86\u200b\uff0c\u200b\u7136\u540e\u200b\u89e6\u53d1\u200b\u4e86\u200b\u5f00\u542f\u200b\u65b0\u200b\u7684\u200b\u4e00\u4ee3\u200b\u7684\u200b\u903b\u8f91\u200b\n            if (g != generation)\n                return index;\n          // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b trip \u200b\u4e2d\u200b\u7b49\u5f85\u200b\u8d85\u65f6\u200b\uff0c\u200b\u7136\u540e\u200b\u4e3b\u52a8\u200b\u8f6c\u79fb\u200b\u5230\u200b\u963b\u585e\u200b\u961f\u5217\u200b\n            if (timed &amp;&amp; nanos &lt;= 0L) {\n                breakBarrier();\n                // \u200b\u629b\u51fa\u200b\u8d85\u65f6\u200b\u5f02\u5e38\u200b\n                throw new TimeoutException();\n            }\n        }\n    } finally {\n        // \u200b\u89e3\u9501\u200b\n        lock.unlock();\n    }\n}\n</code></pre> <ul> <li>breakBarrier()\uff1a\u200b\u6253\u7834\u200b Barrier \u200b\u5c4f\u969c\u200b</li> </ul> Java<pre><code>private void breakBarrier() {\n    // \u200b\u5c06\u4ee3\u4e2d\u200b\u7684\u200b broken \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b true\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u662f\u200b\u88ab\u200b\u6253\u7834\u200b\u4e86\u200b\uff0c\u200b\u518d\u200b\u6765\u5230\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n    generation.broken = true;\n    // \u200b\u91cd\u7f6e\u200b count \u200b\u4e3a\u200b parties\n    count = parties;\n    // \u200b\u5c06\u200b\u5728\u200btrip\u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u6302\u200b\u8d77\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5168\u90e8\u200b\u5524\u9192\u200b\uff0c\u200b\u5524\u9192\u200b\u540e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200b\u662f\u5426\u662f\u200b\u6253\u7834\u200b\u7684\u200b\uff0c\u200b\u7136\u540e\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n    trip.signalAll();\n}\n</code></pre> <ul> <li>nextGeneration()\uff1a\u200b\u5f00\u542f\u200b\u65b0\u200b\u7684\u200b\u4e0b\u4e00\u4ee3\u200b </li> </ul> Java<pre><code>private void nextGeneration() {\n    // \u200b\u5c06\u200b\u5728\u200b trip \u200b\u6761\u4ef6\u200b\u961f\u5217\u200b\u5185\u6302\u200b\u8d77\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5168\u90e8\u200b\u5524\u9192\u200b\n    trip.signalAll();\n    // \u200b\u91cd\u7f6e\u200b count \u200b\u4e3a\u200b parties\n    count = parties;\n\n    // \u200b\u5f00\u542f\u200b\u65b0\u200b\u7684\u200b\u4e00\u4ee3\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200bgeneration\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u8868\u793a\u200b\u65b0\u200b\u7684\u200b\u4e00\u4ee3\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b\u4e00\u4ee3\u200b\u548c\u200b\u4e0a\u200b\u4e00\u4ee3\u200b\u3010\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u5173\u7cfb\u200b\u3011\n    generation = new Generation();\n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://space.bilibili.com/457326371/</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#semaphore","title":"Semaphore","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_179","title":"\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>synchronized \u200b\u53ef\u4ee5\u200b\u8d77\u5230\u200b\u9501\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u4f46\u200b\u67d0\u4e2a\u200b\u65f6\u95f4\u6bb5\u200b\u5185\u200b\uff0c\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5141\u8bb8\u200b\u6267\u884c\u200b</p> <p>Semaphore\uff08\u200b\u4fe1\u53f7\u91cf\u200b\uff09\u200b\u7528\u6765\u200b\u9650\u5236\u200b\u80fd\u200b\u540c\u65f6\u200b\u8bbf\u95ee\u5171\u4eab\u200b\u8d44\u6e90\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0a\u9650\u200b\uff0c\u200b\u975e\u200b\u91cd\u5165\u200b\u9501\u200b</p> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>public Semaphore(int permits)</code>\uff1apermits \u200b\u8868\u793a\u200b\u8bb8\u53ef\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6570\u91cf\u200b\uff08state\uff09</li> <li><code>public Semaphore(int permits, boolean fair)</code>\uff1afair \u200b\u8868\u793a\u200b\u516c\u5e73\u6027\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbe\u200b\u4e3a\u200b true\uff0c\u200b\u4e0b\u6b21\u200b\u6267\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u662f\u200b\u7b49\u5f85\u200b\u6700\u4e45\u200b\u7684\u200b\u7ebf\u7a0b\u200b</li> </ul> <p>\u200b\u5e38\u7528\u200bAPI\uff1a</p> <ul> <li><code>public void acquire()</code>\uff1a\u200b\u8868\u793a\u200b\u83b7\u53d6\u200b\u8bb8\u53ef\u200b</li> <li><code>public void release()</code>\uff1a\u200b\u8868\u793a\u200b\u91ca\u653e\u200b\u8bb8\u53ef\u200b\uff0cacquire() \u200b\u548c\u200b release() \u200b\u65b9\u6cd5\u200b\u4e4b\u95f4\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e3a\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b</li> </ul> Java<pre><code>public static void main(String[] args) {\n    // 1.\u200b\u521b\u5efa\u200bSemaphore\u200b\u5bf9\u8c61\u200b\n    Semaphore semaphore = new Semaphore(3);\n\n    // 2. 10\u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\n    for (int i = 0; i &lt; 10; i++) {\n        new Thread(() -&gt; {\n            try {\n                // 3. \u200b\u83b7\u53d6\u200b\u8bb8\u53ef\u200b\n                semaphore.acquire();\n                sout(Thread.currentThread().getName() + \" running...\");\n                Thread.sleep(1000);\n                sout(Thread.currentThread().getName() + \" end...\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                // 4. \u200b\u91ca\u653e\u200b\u8bb8\u53ef\u200b\n                semaphore.release();\n            }\n        }).start();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_180","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"<p>\u200b\u52a0\u9501\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>Semaphore \u200b\u7684\u200b permits\uff08state\uff09\u200b\u4e3a\u200b 3\uff0c\u200b\u8fd9\u65f6\u200b 5 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u83b7\u53d6\u200b\u8d44\u6e90\u200b</li> </ul> Java<pre><code>Sync(int permits) {\n    setState(permits);\n}\n</code></pre> <p>\u200b\u5047\u8bbe\u200b\u5176\u4e2d\u200b Thread-1\uff0cThread-2\uff0cThread-4 CAS \u200b\u7ade\u4e89\u200b\u6210\u529f\u200b\uff0cpermits \u200b\u53d8\u4e3a\u200b 0\uff0c\u200b\u800c\u200b Thread-0 \u200b\u548c\u200b Thread-3 \u200b\u7ade\u4e89\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fdb\u5165\u200b AQS \u200b\u961f\u5217\u200bpark \u200b\u963b\u585e\u200b</p> Java<pre><code>// acquire() -&gt; sync.acquireSharedInterruptibly(1)\uff0c\u200b\u53ef\u200b\u4e2d\u65ad\u200b\npublic final void acquireSharedInterruptibly(int arg) {\n    if (Thread.interrupted())\n        throw new InterruptedException();\n    // \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u901a\u884c\u8bc1\u200b\uff0c\u200b\u83b7\u53d6\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b &gt;= 0\u200b\u7684\u200b\u503c\u200b\n    if (tryAcquireShared(arg) &lt; 0)\n        // \u200b\u83b7\u53d6\u200b\u8bb8\u53ef\u8bc1\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fdb\u5165\u200b\u963b\u585e\u200b\n        doAcquireSharedInterruptibly(arg);\n}\n\n// tryAcquireShared() -&gt; nonfairTryAcquireShared()\n// \u200b\u975e\u200b\u516c\u5e73\u200b\uff0c\u200b\u516c\u5e73\u200b\u9501\u4f1a\u200b\u5728\u200b\u5faa\u73af\u200b\u5185\u200b hasQueuedPredecessors()\u200b\u65b9\u6cd5\u200b\u5224\u65ad\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u662f\u5426\u200b\u6709\u200b\u4e34\u5934\u200b\u8282\u70b9\u200b(\u200b\u7b2c\u4e8c\u4e2a\u200b\u8282\u70b9\u200b)\nfinal int nonfairTryAcquireShared(int acquires) {\n    for (;;) {\n        // \u200b\u83b7\u53d6\u200b state \uff0cstate \u200b\u8fd9\u91cc\u200b\u3010\u200b\u8868\u793a\u200b\u901a\u884c\u8bc1\u200b\u3011\n        int available = getState();\n        // \u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u901a\u884c\u8bc1\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\uff0c\u200b\u901a\u884c\u8bc1\u200b\u8fd8\u200b\u5269\u4f59\u200b\u6570\u91cf\u200b\n        int remaining = available - acquires;\n        // \u200b\u5982\u679c\u200b\u8bb8\u53ef\u200b\u5df2\u7ecf\u200b\u7528\u200b\u5b8c\u200b, \u200b\u8fd4\u56de\u200b\u8d1f\u6570\u200b, \u200b\u8868\u793a\u200b\u83b7\u53d6\u200b\u5931\u8d25\u200b,\n        if (remaining &lt; 0 ||\n            // \u200b\u8bb8\u53ef\u8bc1\u200b\u8db3\u591f\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b cas \u200b\u91cd\u8bd5\u200b\u6210\u529f\u200b, \u200b\u8fd4\u56de\u200b\u6b63\u6570\u200b, \u200b\u8868\u793a\u200b\u83b7\u53d6\u200b\u6210\u529f\u200b\n            compareAndSetState(available, remaining))\n            return remaining;\n    }\n}\n</code></pre> Java<pre><code>private void doAcquireSharedInterruptibly(int arg) {\n    // \u200b\u5c06\u200b\u8c03\u7528\u200b Semaphore.aquire \u200b\u65b9\u6cd5\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5305\u88c5\u200b\u6210\u200b node \u200b\u52a0\u5165\u200b\u5230\u200b AQS \u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\n    final Node node = addWaiter(Node.SHARED);\n    // \u200b\u83b7\u53d6\u200b\u6807\u8bb0\u200b\n    boolean failed = true;\n    try {\n        for (;;) {\n            final Node p = node.predecessor();\n            // \u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u662f\u200b\u5934\u200b\u8282\u70b9\u200b\u53ef\u4ee5\u200b\u518d\u6b21\u200b\u83b7\u53d6\u200b\u8bb8\u53ef\u200b\n            if (p == head) {\n                // \u200b\u518d\u6b21\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8bb8\u53ef\u200b\uff0c\u3010\u200b\u8fd4\u56de\u200b\u5269\u4f59\u200b\u7684\u200b\u8bb8\u53ef\u8bc1\u200b\u6570\u91cf\u200b\u3011\n                int r = tryAcquireShared(arg);\n                if (r &gt;= 0) {\n                    // \u200b\u6210\u529f\u200b\u540e\u672c\u200b\u7ebf\u7a0b\u200b\u51fa\u961f\u200b\uff08AQS\uff09, \u200b\u6240\u5728\u200b Node\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b head\n                    // r \u200b\u8868\u793a\u200b\u3010\u200b\u53ef\u7528\u200b\u8d44\u6e90\u200b\u6570\u200b\u3011, \u200b\u4e3a\u200b 0 \u200b\u5219\u200b\u4e0d\u4f1a\u200b\u7ee7\u7eed\u200b\u4f20\u64ad\u200b\n                    setHeadAndPropagate(node, r); \n                    p.next = null; // help GC\n                    failed = false;\n                    return;\n                }\n            }\n            // \u200b\u4e0d\u200b\u6210\u529f\u200b, \u200b\u8bbe\u7f6e\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b waitStatus = Node.SIGNAL, \u200b\u4e0b\u8f6e\u200b\u8fdb\u5165\u200b park \u200b\u963b\u585e\u200b\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt())\n                throw new InterruptedException();\n        }\n    } finally {\n        // \u200b\u88ab\u200b\u6253\u65ad\u200b\u540e\u200b\u8fdb\u5165\u200b\u8be5\u200b\u903b\u8f91\u200b\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n</code></pre> Java<pre><code>private void setHeadAndPropagate(Node node, int propagate) {    \n    Node h = head;\n    // \u200b\u8bbe\u7f6e\u200b\u81ea\u5df1\u200b\u4e3a\u200b head \u200b\u8282\u70b9\u200b\n    setHead(node);\n    // propagate \u200b\u8868\u793a\u200b\u6709\u200b\u3010\u200b\u5171\u4eab\u8d44\u6e90\u200b\u3011\uff08\u200b\u4f8b\u5982\u200b\u5171\u4eab\u200b\u8bfb\u9501\u200b\u6216\u200b\u4fe1\u53f7\u91cf\u200b\uff09\n    // head waitStatus == Node.SIGNAL \u200b\u6216\u200b Node.PROPAGATE\uff0cdoReleaseShared \u200b\u51fd\u6570\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u7684\u200b\n    if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 ||\n        (h = head) == null || h.waitStatus &lt; 0) {\n        Node s = node.next;\n        // \u200b\u5982\u679c\u200b\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u6216\u8005\u200b\u662f\u200b\u7b49\u5f85\u200b\u5171\u4eab\u200b\u8bfb\u9501\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u505a\u200b\u4e00\u6b21\u200b\u5524\u9192\u200b\n        if (s == null || s.isShared())\n            doReleaseShared();\n    }\n}\n</code></pre> <p></p> <ul> <li>\u200b\u8fd9\u65f6\u200b Thread-4 \u200b\u91ca\u653e\u200b\u4e86\u200b permits\uff0c\u200b\u72b6\u6001\u200b\u5982\u4e0b\u200b</li> </ul> Java<pre><code>// release() -&gt; releaseShared()\npublic final boolean releaseShared(int arg) {\n    // \u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u9501\u200b\n    if (tryReleaseShared(arg)) {\n        doReleaseShared();\n        return true;\n    }    \n    return false;\n}\nprotected final boolean tryReleaseShared(int releases) {    \n    for (;;) {\n        // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u9501\u200b\u8d44\u6e90\u200b\u7684\u200b\u53ef\u7528\u200b\u8bb8\u53ef\u8bc1\u200b\u6570\u91cf\u200b\n        int current = getState();\n        int next = current + releases;\n        // \u200b\u7d22\u5f15\u200b\u8d8a\u754c\u200b\u5224\u65ad\u200b\n        if (next &lt; current)            \n            throw new Error(\"Maximum permit count exceeded\");        \n        // \u200b\u91ca\u653e\u200b\u9501\u200b\n        if (compareAndSetState(current, next))            \n            return true;    \n    }\n}\nprivate void doReleaseShared() {    \n    // PROPAGATE \u200b\u8be6\u89e3\u200b    \n    // \u200b\u5982\u679c\u200b head.waitStatus == Node.SIGNAL ==&gt; 0 \u200b\u6210\u529f\u200b, \u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b unpark   \n    // \u200b\u5982\u679c\u200b head.waitStatus == 0 ==&gt; Node.PROPAGATE\n}\n</code></pre> <p></p> <ul> <li>\u200b\u63a5\u4e0b\u6765\u200b Thread-0 \u200b\u7ade\u4e89\u200b\u6210\u529f\u200b\uff0cpermits \u200b\u518d\u6b21\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 0\uff0c\u200b\u8bbe\u7f6e\u200b\u81ea\u5df1\u200b\u4e3a\u200b head \u200b\u8282\u70b9\u200b\uff0c\u200b\u5e76\u4e14\u200b unpark \u200b\u63a5\u4e0b\u6765\u200b\u7684\u200b\u5171\u4eab\u200b\u72b6\u6001\u200b\u7684\u200b Thread-3 \u200b\u8282\u70b9\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b permits \u200b\u662f\u200b 0\uff0c\u200b\u56e0\u6b64\u200b Thread-3 \u200b\u5728\u200b\u5c1d\u8bd5\u200b\u4e0d\u200b\u6210\u529f\u200b\u540e\u200b\u518d\u6b21\u200b\u8fdb\u5165\u200b park \u200b\u72b6\u6001\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#propagate","title":"PROPAGATE","text":"<p>\u200b\u5047\u8bbe\u200b\u5b58\u5728\u200b\u67d0\u6b21\u200b\u5faa\u73af\u200b\u4e2d\u200b\u961f\u5217\u200b\u91cc\u200b\u6392\u961f\u200b\u7684\u200b\u7ed3\u70b9\u200b\u60c5\u51b5\u200b\u4e3a\u200b <code>head(-1) \u2192 t1(-1) \u2192 t2(0)</code>\uff0c\u200b\u5b58\u5728\u200b\u5c06\u8981\u200b\u91ca\u653e\u200b\u4fe1\u53f7\u91cf\u200b\u7684\u200b T3 \u200b\u548c\u200b T4\uff0c\u200b\u91ca\u653e\u200b\u987a\u5e8f\u200b\u4e3a\u5148\u200b T3 \u200b\u540e\u200b T4</p> Java<pre><code>// \u200b\u8001\u200b\u7248\u672c\u200b\u4ee3\u7801\u200b\nprivate void setHeadAndPropagate(Node node, int propagate) {    \n    setHead(node);    \n    // \u200b\u6709\u200b\u7a7a\u95f2\u200b\u8d44\u6e90\u200b    \n    if (propagate &gt; 0 &amp;&amp; node.waitStatus != 0) {        \n        Node s = node.next;        \n        // \u200b\u4e0b\u200b\u4e00\u4e2a\u200b        \n        if (s == null || s.isShared())            \n            unparkSuccessor(node);        \n    }\n}\n</code></pre> <p>\u200b\u6b63\u5e38\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>T3 \u200b\u8c03\u7528\u200b releaseShared(1)\uff0c\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u4e86\u200b unparkSuccessor(head)\uff0chead.waitStatus \u200b\u4ece\u200b -1 \u200b\u53d8\u4e3a\u200b 0</li> <li>T1 \u200b\u7531\u4e8e\u200b T3 \u200b\u91ca\u653e\u200b\u4fe1\u53f7\u91cf\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u7136\u540e\u200b T4 \u200b\u91ca\u653e\u200b\uff0c\u200b\u5524\u9192\u200b T2</li> </ul> <p>BUG \u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>T3 \u200b\u8c03\u7528\u200b releaseShared(1)\uff0c\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u4e86\u200b unparkSuccessor(head)\uff0chead.waitStatus \u200b\u4ece\u200b -1 \u200b\u53d8\u4e3a\u200b 0</li> <li>T1 \u200b\u7531\u4e8e\u200b T3 \u200b\u91ca\u653e\u200b\u4fe1\u53f7\u91cf\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u8c03\u7528\u200b tryAcquireShared\uff0c\u200b\u8fd4\u56de\u503c\u200b\u4e3a\u200b 0\uff08\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u5269\u4f59\u200b\u8d44\u6e90\u91cf\u200b\uff09</li> <li>T1 \u200b\u8fd8\u200b\u6ca1\u200b\u8c03\u7528\u200b setHeadAndPropagate \u200b\u65b9\u6cd5\u200b\uff0cT4 \u200b\u8c03\u7528\u200b releaseShared(1)\uff0c\u200b\u6b64\u65f6\u200b head.waitStatus \u200b\u4e3a\u200b 0\uff08\u200b\u6b64\u65f6\u200b\u8bfb\u5230\u200b\u7684\u200b head \u200b\u548c\u200b 1 \u200b\u4e2d\u4e3a\u200b\u540c\u4e00\u4e2a\u200b head\uff09\uff0c\u200b\u4e0d\u200b\u6ee1\u8db3\u6761\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u200b\u8c03\u7528\u200b unparkSuccessor(head)</li> <li>T1 \u200b\u83b7\u53d6\u200b\u4fe1\u53f7\u91cf\u200b\u6210\u529f\u200b\uff0c\u200b\u8c03\u7528\u200b setHeadAndPropagate(t1.node, 0) \u200b\u65f6\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e0d\u200b\u6ee1\u8db3\u200b propagate &gt; 0\uff08\u200b\u5269\u4f59\u200b\u8d44\u6e90\u91cf\u200b == 0\uff09\uff0c\u200b\u4ece\u800c\u200b\u4e0d\u4f1a\u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\u7ed3\u70b9\u200b\uff0c T2 \u200b\u7ebf\u7a0b\u200b\u5f97\u4e0d\u5230\u200b\u5524\u9192\u200b</li> </ul> <p>\u200b\u66f4\u65b0\u200b\u540e\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>T3 \u200b\u8c03\u7528\u200b releaseShared(1)\uff0c\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u4e86\u200b unparkSuccessor(head)\uff0chead.waitStatus \u200b\u4ece\u200b -1 \u200b\u53d8\u4e3a\u200b 0</li> <li>T1 \u200b\u7531\u4e8e\u200b T3 \u200b\u91ca\u653e\u200b\u4fe1\u53f7\u91cf\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u8c03\u7528\u200b tryAcquireShared\uff0c\u200b\u8fd4\u56de\u503c\u200b\u4e3a\u200b 0\uff08\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u5269\u4f59\u200b\u8d44\u6e90\u91cf\u200b\uff09</li> <li>T1 \u200b\u8fd8\u200b\u6ca1\u200b\u8c03\u7528\u200b setHeadAndPropagate \u200b\u65b9\u6cd5\u200b\uff0cT4 \u200b\u8c03\u7528\u200b releaseShared()\uff0c\u200b\u6b64\u65f6\u200b head.waitStatus \u200b\u4e3a\u200b 0\uff08\u200b\u6b64\u65f6\u200b\u8bfb\u5230\u200b\u7684\u200b head \u200b\u548c\u200b 1 \u200b\u4e2d\u4e3a\u200b\u540c\u4e00\u4e2a\u200b head\uff09\uff0c\u200b\u8c03\u7528\u200b doReleaseShared() \u200b\u5c06\u200b\u7b49\u5f85\u200b\u72b6\u6001\u200b\u7f6e\u200b\u4e3a\u200b PROPAGATE\uff08-3\uff09</li> <li>T1 \u200b\u83b7\u53d6\u200b\u4fe1\u53f7\u91cf\u200b\u6210\u529f\u200b\uff0c\u200b\u8c03\u7528\u200b setHeadAndPropagate \u200b\u65f6\u200b\uff0c\u200b\u8bfb\u200b\u5230\u200b h.waitStatus &lt; 0\uff0c\u200b\u4ece\u800c\u200b\u8c03\u7528\u200b doReleaseShared() \u200b\u5524\u9192\u200b T2</li> </ul> Java<pre><code>private void setHeadAndPropagate(Node node, int propagate) {    \n    Node h = head;\n    // \u200b\u8bbe\u7f6e\u200b\u81ea\u5df1\u200b\u4e3a\u200b head \u200b\u8282\u70b9\u200b\n    setHead(node);\n    // propagate \u200b\u8868\u793a\u200b\u6709\u200b\u5171\u4eab\u8d44\u6e90\u200b\uff08\u200b\u4f8b\u5982\u200b\u5171\u4eab\u200b\u8bfb\u9501\u200b\u6216\u200b\u4fe1\u53f7\u91cf\u200b\uff09\n    // head waitStatus == Node.SIGNAL \u200b\u6216\u200b Node.PROPAGATE\n    if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 ||\n        (h = head) == null || h.waitStatus &lt; 0) {\n        Node s = node.next;\n        // \u200b\u5982\u679c\u200b\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u6216\u8005\u200b\u662f\u200b\u7b49\u5f85\u200b\u5171\u4eab\u200b\u8bfb\u9501\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u505a\u200b\u4e00\u6b21\u200b\u5524\u9192\u200b\n        if (s == null || s.isShared())\n            doReleaseShared();\n    }\n}\n</code></pre> Java<pre><code>// \u200b\u5524\u9192\u200b\nprivate void doReleaseShared() {\n    // \u200b\u5982\u679c\u200b head.waitStatus == Node.SIGNAL ==&gt; 0 \u200b\u6210\u529f\u200b, \u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b unpark \n    // \u200b\u5982\u679c\u200b head.waitStatus == 0 ==&gt; Node.PROPAGATE    \n    for (;;) {\n        Node h = head;\n        if (h != null &amp;&amp; h != tail) {\n            int ws = h.waitStatus;\n            if (ws == Node.SIGNAL) {\n                // \u200b\u9632\u6b62\u200b unparkSuccessor \u200b\u88ab\u200b\u591a\u6b21\u200b\u6267\u884c\u200b\n                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))\n                    continue;\n                // \u200b\u5524\u9192\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n                unparkSuccessor(h);\n            }\n            // \u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u662f\u200b 0 \u200b\u4e86\u200b\uff0c\u200b\u6539\u4e3a\u200b -3\uff0c\u200b\u7528\u6765\u200b\u89e3\u51b3\u200b\u4f20\u64ad\u200b\u6027\u200b\n            else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))\n                continue;\n        }\n        if (h == head)\n            break;\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#exchanger","title":"Exchanger","text":"<p>Exchanger\uff1a\u200b\u4ea4\u6362\u5668\u200b\uff0c\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u534f\u4f5c\u200b\u7684\u200b\u5de5\u5177\u200b\u7c7b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8fdb\u884c\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u7684\u200b\u6570\u636e\u4ea4\u6362\u200b</p> <p>\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b exchange \u200b\u65b9\u6cd5\u200b\u4ea4\u6362\u200b\u6570\u636e\u200b\uff0c\u200b\u5982\u679c\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5148\u200b\u6267\u884c\u200b exchange() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u4e00\u76f4\u200b\u7b49\u5f85\u200b\u7b2c\u4e8c\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u6267\u884c\u200b exchange \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5f53\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u5230\u8fbe\u200b\u540c\u6b65\u200b\u70b9\u65f6\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4ea4\u6362\u200b\u6570\u636e\u200b</p> <p>\u200b\u5e38\u7528\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>public Exchanger()</code>\uff1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u4ea4\u6362\u5668\u200b</li> <li><code>public V exchange(V x)</code>\uff1a\u200b\u7b49\u5f85\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5230\u8fbe\u200b\u6b64\u200b\u4ea4\u6362\u200b\u70b9\u200b</li> <li><code>public V exchange(V x, long timeout, TimeUnit unit)</code>\uff1a\u200b\u7b49\u5f85\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u200b</li> </ul> Java<pre><code>public class ExchangerDemo {\n    public static void main(String[] args) {\n        // \u200b\u521b\u5efa\u200b\u4ea4\u6362\u200b\u5bf9\u8c61\u200b\uff08\u200b\u4fe1\u4f7f\u200b\uff09\n        Exchanger&lt;String&gt; exchanger = new Exchanger&lt;&gt;();\n        new ThreadA(exchanger).start();\n        new ThreadB(exchanger).start();\n    } \n}\nclass ThreadA extends Thread{\n    private Exchanger&lt;String&gt; exchanger();\n\n    public ThreadA(Exchanger&lt;String&gt; exchanger){\n        this.exchanger = exchanger;\n    }\n\n    @Override\n    public void run() {\n        try{\n            sout(\"\u200b\u7ebf\u7a0b\u200bA\uff0c\u200b\u505a\u597d\u200b\u4e86\u200b\u793c\u7269\u200bA\uff0c\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200bB\u200b\u9001\u6765\u200b\u7684\u200b\u793c\u7269\u200bB\");\n            //\u200b\u5982\u679c\u200b\u7b49\u5f85\u200b\u4e86\u200b5s\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u4ea4\u6362\u200b\u5c31\u200b\u6b7b\u4ea1\u200b\uff08\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\uff09\uff01\n            String s = exchanger.exchange(\"\u200b\u793c\u7269\u200bA\",5,TimeUnit.SECONDS);\n            sout(\"\u200b\u7ebf\u7a0b\u200bA\u200b\u6536\u5230\u200b\u7ebf\u7a0b\u200bB\u200b\u7684\u200b\u793c\u7269\u200b\uff1a\" + s);\n        } catch (Exception e) {\n            System.out.println(\"\u200b\u7ebf\u7a0b\u200bA\u200b\u7b49\u5f85\u200b\u4e86\u200b5s\uff0c\u200b\u6ca1\u6709\u200b\u6536\u5230\u200b\u793c\u7269\u200b,\u200b\u6700\u7ec8\u200b\u5c31\u200b\u6267\u884c\u200b\u7ed3\u675f\u200b\u4e86\u200b!\");\n        }\n    }\n}\nclass ThreadB extends Thread{\n    private Exchanger&lt;String&gt; exchanger;\n\n    public ThreadB(Exchanger&lt;String&gt; exchanger) {\n        this.exchanger = exchanger;\n    }\n\n    @Override\n    public void run() {\n        try {\n            sout(\"\u200b\u7ebf\u7a0b\u200bB,\u200b\u505a\u597d\u200b\u4e86\u200b\u793c\u7269\u200bB,\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200bA\u200b\u9001\u6765\u200b\u7684\u200b\u793c\u7269\u200bA.....\");\n            // \u200b\u5f00\u59cb\u200b\u4ea4\u6362\u200b\u793c\u7269\u200b\u3002\u200b\u53c2\u6570\u200b\u662f\u200b\u9001\u7ed9\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u793c\u7269\u200b!\n            sout(\"\u200b\u7ebf\u7a0b\u200bB\u200b\u6536\u5230\u200b\u7ebf\u7a0b\u200bA\u200b\u7684\u200b\u793c\u7269\u200b\uff1a\" + exchanger.exchange(\"\u200b\u793c\u7269\u200bB\"));\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_181","title":"\u5e76\u200b\u53d1\u5305","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#conhashmap","title":"ConHashMap","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_182","title":"\u5e76\u53d1\u200b\u96c6\u5408","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_183","title":"\u96c6\u5408\u200b\u5bf9\u6bd4","text":"<p>\u200b\u4e09\u79cd\u200b\u96c6\u5408\u200b\uff1a</p> <ul> <li>HashMap \u200b\u662f\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u6027\u80fd\u200b\u597d\u200b</li> <li>Hashtable \u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u57fa\u4e8e\u200b synchronized\uff0c\u200b\u7efc\u5408\u6027\u200b\u80fd\u5dee\u200b\uff0c\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u6dd8\u6c70\u200b</li> <li>ConcurrentHashMap \u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u7efc\u5408\u6027\u200b\u80fd\u200b\u8f83\u200b\u597d\u200b\uff0c\u200b\u4e0d\u6b62\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u800c\u4e14\u200b\u6548\u7387\u9ad8\u200b\uff0c\u200b\u6027\u80fd\u200b\u597d\u200b</li> </ul> <p>\u200b\u96c6\u5408\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ol> <li>Hashtable \u200b\u7ee7\u627f\u200b Dictionary \u200b\u7c7b\u200b\uff0cHashMap\u3001ConcurrentHashMap \u200b\u7ee7\u627f\u200b AbstractMap\uff0c\u200b\u5747\u200b\u5b9e\u73b0\u200b Map \u200b\u63a5\u53e3\u200b</li> <li>Hashtable \u200b\u5e95\u5c42\u200b\u662f\u200b\u6570\u7ec4\u200b + \u200b\u94fe\u8868\u200b\uff0cJDK8 \u200b\u4ee5\u540e\u200b HashMap \u200b\u548c\u200b ConcurrentHashMap \u200b\u5e95\u5c42\u200b\u662f\u200b\u6570\u7ec4\u200b + \u200b\u94fe\u8868\u200b + \u200b\u7ea2\u9ed1\u6811\u200b</li> <li>HashMap \u200b\u7ebf\u7a0b\u200b\u975e\u200b\u5b89\u5168\u200b\uff0cHashtable \u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0cHashtable \u200b\u7684\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u52a0\u200b\u4e86\u200b synchronized \u200b\u5173\u6765\u200b\u786e\u4fdd\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b</li> <li>ConcurrentHashMap\u3001Hashtable \u200b\u4e0d\u200b\u5141\u8bb8\u200b null \u200b\u503c\u200b\uff0cHashMap \u200b\u5141\u8bb8\u200b null \u200b\u503c\u200b</li> <li>ConcurrentHashMap\u3001HashMap \u200b\u7684\u200b\u521d\u59cb\u200b\u5bb9\u91cf\u200b\u4e3a\u200b 16\uff0cHashtable \u200b\u521d\u59cb\u200b\u5bb9\u91cf\u200b\u4e3a\u200b11\uff0c\u200b\u586b\u5145\u200b\u56e0\u5b50\u200b\u9ed8\u8ba4\u200b\u90fd\u200b\u662f\u200b 0.75\uff0c\u200b\u4e24\u79cd\u200b Map \u200b\u6269\u5bb9\u200b\u662f\u200b\u5f53\u524d\u200b\u5bb9\u91cf\u200b\u7ffb\u500d\u200b\uff1acapacity * 2\uff0cHashtable \u200b\u6269\u5bb9\u200b\u65f6\u200b\u662f\u200b\u5bb9\u91cf\u200b\u7ffb\u500d\u200b + 1\uff1acapacity*2 + 1</li> </ol> <p></p> <p>\u200b\u5de5\u4f5c\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u4f7f\u7528\u200b cas \u200b\u6765\u200b\u4fdd\u8bc1\u200b\u5e76\u53d1\u200b\u5b89\u5168\u200b\uff0c\u200b\u61d2\u60f0\u200b\u521d\u59cb\u5316\u200b table</li> <li>\u200b\u6811\u5316\u200b\uff0c\u200b\u5f53\u200b table.length &lt; 64 \u200b\u65f6\u200b\uff0c\u200b\u5148\u200b\u5c1d\u8bd5\u200b\u6269\u5bb9\u200b\uff0c\u200b\u8d85\u8fc7\u200b 64 \u200b\u65f6\u200b\uff0c\u200b\u5e76\u4e14\u200b bin.length &gt; 8 \u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u94fe\u8868\u200b\u6811\u5316\u200b\uff0c\u200b\u6811\u5316\u200b\u8fc7\u7a0b\u200b\u4f1a\u200b\u7528\u200b synchronized \u200b\u9501\u4f4f\u200b\u94fe\u8868\u200b\u5934\u200b</li> </ol> <p>\u200b\u8bf4\u660e\u200b\uff1a\u200b\u9501\u4f4f\u200b\u67d0\u4e2a\u200b\u69fd\u200b\u4f4d\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5934\u200b\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u7ec6\u7c92\u5ea6\u200b\u7684\u200b\u52a0\u9501\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u7c7b\u4f3c\u200b MySQL \u200b\u4e2d\u200b\u7684\u200b\u884c\u9501\u200b</p> <ol> <li>put\uff0c\u200b\u5982\u679c\u200b\u8be5\u200b bin \u200b\u5c1a\u672a\u200b\u521b\u5efa\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b cas \u200b\u521b\u5efa\u200b bin\uff1b\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6709\u200b\u4e86\u200b\uff0c\u200b\u9501\u4f4f\u200b\u94fe\u8868\u200b\u5934\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b put \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5143\u7d20\u200b\u6dfb\u52a0\u200b\u81f3\u200b bin \u200b\u7684\u200b\u5c3e\u90e8\u200b</li> <li>get\uff0c\u200b\u65e0\u9501\u200b\u64cd\u4f5c\u200b\u4ec5\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u53ef\u89c1\u200b\u6027\u200b\uff0c\u200b\u6269\u5bb9\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b get \u200b\u64cd\u4f5c\u200b\u62ff\u5230\u200b\u7684\u200b\u662f\u200b ForwardingNode \u200b\u4f1a\u200b\u8ba9\u200b get \u200b\u64cd\u4f5c\u200b\u5728\u200b\u65b0\u200b table \u200b\u8fdb\u884c\u200b\u641c\u7d22\u200b</li> <li>\u200b\u6269\u5bb9\u200b\uff0c\u200b\u6269\u5bb9\u200b\u65f6\u4ee5\u200b bin \u200b\u4e3a\u200b\u5355\u4f4d\u200b\u8fdb\u884c\u200b\uff0c\u200b\u9700\u8981\u200b\u5bf9\u200b bin \u200b\u8fdb\u884c\u200b synchronized\uff0c\u200b\u4f46\u200b\u8fd9\u65f6\u200b\u5176\u5b83\u200b\u7ade\u4e89\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u65e0\u4e8b\u200b\u53ef\u200b\u505a\u200b\uff0c\u200b\u5b83\u4eec\u200b\u4f1a\u200b\u5e2e\u52a9\u200b\u628a\u200b\u5176\u5b83\u200b bin \u200b\u8fdb\u884c\u200b\u6269\u5bb9\u200b</li> <li>size\uff0c\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\u4fdd\u5b58\u200b\u5728\u200b baseCount \u200b\u4e2d\u200b\uff0c\u200b\u5e76\u53d1\u200b\u65f6\u200b\u7684\u200b\u4e2a\u6570\u200b\u53d8\u52a8\u200b\u4fdd\u5b58\u200b\u5728\u200b CounterCell[] \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u6700\u540e\u200b\u7edf\u8ba1\u200b\u6570\u91cf\u200b\u65f6\u200b\u7d2f\u52a0\u200b</li> </ol> Java<pre><code>//\u200b\u9700\u6c42\u200b\uff1a\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\u5f80\u200bHashMap\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u5b58\u5165\u200b\u6570\u636e\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\npublic class ConcurrentHashMapDemo{\n    public static Map&lt;String,String&gt; map = new ConcurrentHashMap();\n\n    public static void main(String[] args){\n        new AddMapDataThread().start();\n        new AddMapDataThread().start();\n\n        Thread.sleep(1000 * 5);//\u200b\u4f11\u606f\u200b5\u200b\u79d2\u200b\uff0c\u200b\u786e\u4fdd\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\n        System.out.println(\"Map\u200b\u5927\u5c0f\u200b\uff1a\" + map.size());//20\u200b\u4e07\u200b\n    }\n}\n\npublic class AddMapDataThread extends Thread{\n    @Override\n    public void run() {\n        for(int i = 0 ; i &lt; 1000000 ; i++ ){\n            ConcurrentHashMapDemo.map.put(\"\u200b\u952e\u200b\uff1a\"+i , \"\u200b\u503c\u200b\"+i);\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_184","title":"\u5e76\u53d1\u200b\u6b7b\u94fe","text":"<p>JDK1.7 \u200b\u7684\u200b HashMap \u200b\u91c7\u7528\u200b\u7684\u200b\u5934\u200b\u63d2\u6cd5\u200b\uff08\u200b\u62c9\u94fe\u200b\u6cd5\u200b\uff09\u200b\u8fdb\u884c\u200b\u8282\u70b9\u200b\u7684\u200b\u6dfb\u52a0\u200b\uff0cHashMap \u200b\u7684\u200b\u6269\u5bb9\u200b\u957f\u5ea6\u200b\u4e3a\u200b\u539f\u6765\u200b\u7684\u200b 2 \u200b\u500d\u200b</p> <p>resize() \u200b\u4e2d\u200b\u8282\u70b9\u200b\uff08Entry\uff09\u200b\u8f6c\u79fb\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>void transfer(Entry[] newTable, boolean rehash) {\n    int newCapacity = newTable.length;//\u200b\u5f97\u5230\u200b\u65b0\u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b   \n    // \u200b\u904d\u5386\u200b\u6574\u4e2a\u200b\u6570\u7ec4\u200b\u5bf9\u5e94\u200b\u4e0b\u6807\u200b\u4e0b\u200b\u7684\u200b\u94fe\u8868\u200b\uff0ce\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n    for (Entry&lt;K,V&gt; e : table) {   \n        // \u200b\u5f53\u200be == null\u200b\u65f6\u200b\uff0c\u200b\u5219\u200b\u8be5\u200b\u94fe\u8868\u200b\u904d\u5386\u200b\u5b8c\u200b\u4e86\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u904d\u5386\u200b\u4e0b\u200b\u4e00\u200b\u6570\u7ec4\u200b\u4e0b\u200b\u6807\u7684\u200b\u94fe\u8868\u200b \n        while(null != e) { \n            // \u200b\u5148\u200b\u628a\u200be\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u200b\u8282\u70b9\u200b\u5b58\u200b\u8d77\u6765\u200b\n            Entry&lt;K,V&gt; next = e.next; \n            if (rehash) {              //\u200b\u5f97\u5230\u200b\u65b0\u200b\u7684\u200bhash\u200b\u503c\u200b\n                e.hash = null == e.key ? 0 : hash(e.key);  \n            }\n            // \u200b\u5728\u200b\u65b0\u200b\u6570\u7ec4\u200b\u4e0b\u200b\u5f97\u5230\u200b\u65b0\u200b\u7684\u200b\u6570\u7ec4\u200b\u4e0b\u6807\u200b\n            int i = indexFor(e.hash, newCapacity);  \n             // \u200b\u5c06\u200be\u200b\u7684\u200bnext\u200b\u6307\u9488\u200b\u6307\u5411\u200b\u65b0\u200b\u6570\u7ec4\u200b\u4e0b\u200b\u6807\u7684\u200b\u4f4d\u7f6e\u200b\n            e.next = newTable[i];   \n            // \u200b\u5c06\u200b\u8be5\u200b\u6570\u7ec4\u200b\u4e0b\u200b\u6807\u7684\u200b\u8282\u70b9\u200b\u53d8\u4e3a\u200be\u200b\u8282\u70b9\u200b\n            newTable[i] = e; \n            // \u200b\u904d\u5386\u200b\u94fe\u8868\u200b\u7684\u200b\u4e0b\u200b\u4e00\u200b\u8282\u70b9\u200b\n            e = next;                                   \n        }\n    }\n}\n</code></pre> <p>JDK 8 \u200b\u867d\u7136\u200b\u5c06\u200b\u6269\u5bb9\u200b\u7b97\u6cd5\u200b\u505a\u200b\u4e86\u200b\u8c03\u6574\u200b\uff0c\u200b\u6539\u7528\u200b\u4e86\u200b\u5c3e\u200b\u63d2\u6cd5\u200b\uff0c\u200b\u4f46\u200b\u4ecd\u200b\u4e0d\u200b\u610f\u5473\u7740\u200b\u80fd\u591f\u200b\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u73af\u5883\u200b\u4e0b\u200b\u80fd\u591f\u200b\u5b89\u5168\u200b\u6269\u5bb9\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u51fa\u73b0\u200b\u5176\u5b83\u200b\u95ee\u9898\u200b\uff08\u200b\u5982\u200b\u6269\u5bb9\u200b\u4e22\u200b\u6570\u636e\u200b\uff09</p> <p>B\u200b\u7ad9\u200b\u89c6\u9891\u200b\u89e3\u6790\u200b\uff1ahttps://www.bilibili.com/video/BV1n541177Ea</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_185","title":"\u6210\u5458\u200b\u5c5e\u6027","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_186","title":"\u53d8\u91cf","text":"<ul> <li>\u200b\u5b58\u50a8\u200b\u6570\u7ec4\u200b\uff1a</li> </ul> Java<pre><code>transient volatile Node&lt;K,V&gt;[] table;\n</code></pre> <ul> <li>\u200b\u6563\u200b\u5217\u8868\u200b\u7684\u200b\u957f\u5ea6\u200b\uff1a</li> </ul> Java<pre><code>private static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;  // \u200b\u6700\u5927\u200b\u957f\u5ea6\u200b\nprivate static final int DEFAULT_CAPACITY = 16;           // \u200b\u9ed8\u8ba4\u200b\u957f\u5ea6\u200b\n</code></pre> <ul> <li>\u200b\u5e76\u53d1\u200b\u7ea7\u522b\u200b\uff0cJDK7 \u200b\u9057\u7559\u4e0b\u6765\u200b\uff0c1.8 \u200b\u4e2d\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u5e76\u53d1\u200b\u7ea7\u522b\u200b\uff1a</li> </ul> Java<pre><code>private static final int DEFAULT_CONCURRENCY_LEVEL = 16;\n</code></pre> <ul> <li>\u200b\u8d1f\u8f7d\u200b\u56e0\u5b50\u200b\uff0cJDK1.8 \u200b\u7684\u200b ConcurrentHashMap \u200b\u4e2d\u662f\u200b\u56fa\u5b9a\u503c\u200b\uff1a</li> </ul> Java<pre><code>private static final float LOAD_FACTOR = 0.75f;\n</code></pre> <ul> <li>\u200b\u9608\u503c\u200b\uff1a</li> </ul> Java<pre><code>static final int TREEIFY_THRESHOLD = 8;       // \u200b\u94fe\u8868\u200b\u6811\u5316\u200b\u7684\u200b\u9608\u503c\u200b\nstatic final int UNTREEIFY_THRESHOLD = 6; // \u200b\u7ea2\u9ed1\u6811\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u94fe\u8868\u200b\u7684\u200b\u9608\u503c\u200b\nstatic final int MIN_TREEIFY_CAPACITY = 64;   // \u200b\u5f53\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u8fbe\u5230\u200b64\u200b\u4e14\u200b\u67d0\u4e2a\u200b\u6876\u200b\u4f4d\u200b\u4e2d\u200b\u7684\u200b\u94fe\u8868\u200b\u957f\u5ea6\u200b\u8d85\u8fc7\u200b8\uff0c\u200b\u624d\u200b\u4f1a\u200b\u771f\u6b63\u200b\u6811\u5316\u200b\n</code></pre> <ul> <li>\u200b\u6269\u5bb9\u200b\u76f8\u5173\u200b\uff1a</li> </ul> Java<pre><code>private static final int MIN_TRANSFER_STRIDE = 16;    // \u200b\u7ebf\u7a0b\u200b\u8fc1\u79fb\u200b\u6570\u636e\u200b\u3010\u200b\u6700\u5c0f\u200b\u6b65\u957f\u200b\u3011\uff0c\u200b\u63a7\u5236\u7ebf\u200b\u7a0b\u200b\u8fc1\u79fb\u200b\u4efb\u52a1\u200b\u7684\u200b\u6700\u5c0f\u200b\u533a\u95f4\u200b\nprivate static int RESIZE_STAMP_BITS = 16;            // \u200b\u7528\u6765\u200b\u8ba1\u7b97\u200b\u6269\u5bb9\u200b\u65f6\u200b\u751f\u6210\u200b\u7684\u200b\u3010\u200b\u6807\u8bc6\u200b\u6233\u200b\u3011\nprivate static final int MAX_RESIZERS = (1 &lt;&lt; (32 - RESIZE_STAMP_BITS)) - 1;// 65535-1\u200b\u5e76\u53d1\u200b\u6269\u5bb9\u200b\u6700\u200b\u591a\u7ebf\u7a0b\u200b\u6570\u200b\nprivate static final int RESIZE_STAMP_SHIFT = 32 - RESIZE_STAMP_BITS;     // \u200b\u6269\u5bb9\u200b\u65f6\u200b\u4f7f\u7528\u200b\n</code></pre> <ul> <li>\u200b\u8282\u70b9\u200b\u54c8\u5e0c\u200b\u503c\u200b\uff1a</li> </ul> Java<pre><code>static final int MOVED     = -1;          // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b FWD \u200b\u8282\u70b9\u200b\nstatic final int TREEBIN   = -2;          // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u6811\u5316\u200b\uff0c\u200b\u4e14\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e3a\u200b TreeBin \u200b\u5bf9\u8c61\u200b\nstatic final int RESERVED  = -3;          // \u200b\u8868\u793a\u200b\u8282\u70b9\u200b\u65f6\u200b\u4e34\u65f6\u200b\u8282\u70b9\u200b\nstatic final int HASH_BITS = 0x7fffffff;  // \u200b\u6b63\u5e38\u200b\u8282\u70b9\u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b\u7684\u200b\u53ef\u7528\u200b\u7684\u200b\u4f4d\u6570\u200b\n</code></pre> <ul> <li>\u200b\u6269\u5bb9\u200b\u8fc7\u7a0b\u200b\uff1avolatile \u200b\u4fee\u9970\u200b\u4fdd\u8bc1\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b</li> </ul> Java<pre><code>// \u200b\u6269\u5bb9\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u6269\u5bb9\u200b\u4e2d\u200b\u7684\u200b\u65b0\u200b table \u200b\u8d4b\u503c\u200b\u7ed9\u200b nextTable \u200b\u4fdd\u6301\u200b\u5f15\u7528\u200b\uff0c\u200b\u6269\u5bb9\u200b\u7ed3\u675f\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4f1a\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b null\nprivate transient volatile Node&lt;K,V&gt;[] nextTable;\n// \u200b\u8bb0\u5f55\u200b\u6269\u5bb9\u200b\u8fdb\u5ea6\u200b\uff0c\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u8981\u200b\u4ece\u200b 0 - transferIndex \u200b\u4e2d\u200b\u5206\u914d\u200b\u533a\u95f4\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7b80\u5355\u200b\u8bf4\u200b\u5c31\u662f\u200b\u8001\u8868\u200b\u8f6c\u79fb\u200b\u5230\u200b\u54ea\u200b\u4e86\u200b\uff0c\u200b\u7d22\u5f15\u200b\u4ece\u200b\u9ad8\u5230\u200b\u4f4e\u200b\u8f6c\u79fb\u200b\nprivate transient volatile int transferIndex;\n</code></pre> <ul> <li>\u200b\u7d2f\u52a0\u200b\u7edf\u8ba1\u200b\uff1a</li> </ul> Java<pre><code>// LongAdder \u200b\u4e2d\u200b\u7684\u200b baseCount \u200b\u672a\u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b\u65f6\u200b\u6216\u8005\u200b\u5f53\u524d\u200bLongAdder\u200b\u5904\u4e8e\u200b\u52a0\u9501\u200b\u72b6\u6001\u200b\u65f6\u200b\uff0c\u200b\u589e\u91cf\u200b\u7d2f\u5230\u200b\u5230\u200b baseCount \u200b\u4e2d\u200b\nprivate transient volatile long baseCount;\n// LongAdder \u200b\u4e2d\u200b\u7684\u200b cellsBuzy\uff0c0 \u200b\u8868\u793a\u200b\u5f53\u524d\u200b LongAdder \u200b\u5bf9\u8c61\u200b\u65e0\u9501\u200b\u72b6\u6001\u200b\uff0c1 \u200b\u8868\u793a\u200b\u5f53\u524d\u200b LongAdder \u200b\u5bf9\u8c61\u200b\u52a0\u9501\u200b\u72b6\u6001\u200b\nprivate transient volatile int cellsBusy;\n// LongAdder \u200b\u4e2d\u200b\u7684\u200b cells \u200b\u6570\u7ec4\u200b\uff0c\nprivate transient volatile CounterCell[] counterCells;\n</code></pre> <ul> <li>\u200b\u63a7\u5236\u53d8\u91cf\u200b\uff1a</li> </ul> <p>sizeCtl &lt; 0\uff1a</p> <ul> <li>-1 \u200b\u8868\u793a\u200b\u5f53\u524d\u200b table \u200b\u6b63\u5728\u200b\u521d\u59cb\u5316\u200b\uff08\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u521b\u5efa\u200b table \u200b\u6570\u7ec4\u200b\uff09\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u81ea\u65cb\u200b\u7b49\u5f85\u200b</li> <li>\u200b\u5176\u4ed6\u200b\u8d1f\u6570\u200b\u8868\u793a\u200b\u5f53\u524d\u200b map \u200b\u7684\u200b table \u200b\u6570\u7ec4\u200b\u6b63\u5728\u200b\u8fdb\u884c\u200b\u6269\u5bb9\u200b\uff0c\u200b\u9ad8\u200b 16 \u200b\u4f4d\u200b\u8868\u793a\u200b\u6269\u5bb9\u200b\u7684\u200b\u6807\u8bc6\u200b\u6233\u200b\uff1b\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\u8868\u793a\u200b (1 + nThread) \u200b\u5f53\u524d\u200b\u53c2\u4e0e\u200b\u5e76\u53d1\u200b\u6269\u5bb9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b + 1</li> </ul> <p>sizeCtl = 0\uff0c\u200b\u8868\u793a\u200b\u521b\u5efa\u200b table \u200b\u6570\u7ec4\u200b\u65f6\u200b\u4f7f\u7528\u200b DEFAULT_CAPACITY \u200b\u4e3a\u200b\u6570\u7ec4\u200b\u5927\u5c0f\u200b</p> <p>sizeCtl &gt; 0\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b table \u200b\u672a\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u8868\u793a\u200b\u521d\u59cb\u5316\u200b\u5927\u5c0f\u200b</li> <li>\u200b\u5982\u679c\u200b table \u200b\u5df2\u7ecf\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u8868\u793a\u200b\u4e0b\u6b21\u200b\u6269\u5bb9\u200b\u65f6\u200b\u7684\u200b\u89e6\u53d1\u200b\u6761\u4ef6\u200b\uff08\u200b\u9608\u503c\u200b\uff0c\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u4e0d\u662f\u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b\uff09</li> </ul> Java<pre><code>private transient volatile int sizeCtl;       // volatile \u200b\u4fdd\u6301\u200b\u53ef\u89c1\u200b\u6027\u200b\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_187","title":"\u5185\u90e8\u200b\u7c7b","text":"<ul> <li>Node \u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>static class Node&lt;K,V&gt; implements Entry&lt;K,V&gt; {\n    // \u200b\u8282\u70b9\u200b\u54c8\u5e0c\u200b\u503c\u200b\n    final int hash;\n    final K key;\n    volatile V val;\n    // \u200b\u5355\u5411\u200b\u94fe\u8868\u200b\n    volatile Node&lt;K,V&gt; next;\n}\n</code></pre> <ul> <li>TreeBin \u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code> static final class TreeBin&lt;K,V&gt; extends Node&lt;K,V&gt; {\n     // \u200b\u7ea2\u9ed1\u200b\u6811\u6839\u200b\u8282\u70b9\u200b\n     TreeNode&lt;K,V&gt; root;\n     // \u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\n     volatile TreeNode&lt;K,V&gt; first;\n     // \u200b\u7b49\u5f85\u200b\u8005\u200b\u7ebf\u7a0b\u200b\n     volatile Thread waiter;\n\n     volatile int lockState;\n     // \u200b\u5199\u9501\u200b\u72b6\u6001\u200b \u200b\u5199\u9501\u200b\u662f\u200b\u72ec\u5360\u200b\u72b6\u6001\u200b\uff0c\u200b\u4ee5\u6563\u200b\u5217\u8868\u200b\u6765\u770b\u200b\uff0c\u200b\u771f\u6b63\u200b\u8fdb\u5165\u200b\u5230\u200b TreeBin \u200b\u4e2d\u200b\u7684\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\n     static final int WRITER = 1;\n     // \u200b\u7b49\u5f85\u200b\u8005\u200b\u72b6\u6001\u200b\uff08\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u7b49\u5f85\u200b\uff09\uff0c\u200b\u5f53\u200b TreeBin \u200b\u4e2d\u6709\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\u76ee\u524d\u200b\u6b63\u5728\u200b\u8bfb\u53d6\u6570\u636e\u200b\u65f6\u200b\uff0c\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u65e0\u6cd5\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\n     static final int WAITER = 2;\n     // \u200b\u8bfb\u9501\u200b\u72b6\u6001\u200b\u662f\u200b\u5171\u4eab\u200b\uff0c\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b \u200b\u540c\u65f6\u200b\u8fdb\u5165\u200b\u5230\u200b TreeBi \u200b\u5bf9\u8c61\u200b\u4e2d\u200b\u83b7\u53d6\u6570\u636e\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u7ed9\u200b lockState + 4\n     static final int READER = 4;\n }\n</code></pre> <ul> <li>TreeNode \u200b\u8282\u70b9\u200b\uff1a</li> </ul> Java<pre><code>static final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; {\n    TreeNode&lt;K,V&gt; parent;  // red-black tree links\n    TreeNode&lt;K,V&gt; left;\n    TreeNode&lt;K,V&gt; right;\n    TreeNode&lt;K,V&gt; prev;   //\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\n    boolean red;\n}\n</code></pre> <ul> <li>ForwardingNode \u200b\u8282\u70b9\u200b\uff1a\u200b\u8f6c\u79fb\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code> static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; {\n     // \u200b\u6301\u6709\u200b\u6269\u5bb9\u200b\u540e\u200b\u65b0\u200b\u7684\u200b\u54c8\u5e0c\u200b\u8868\u200b\u7684\u200b\u5f15\u7528\u200b\n     final Node&lt;K,V&gt;[] nextTable;\n     ForwardingNode(Node&lt;K,V&gt;[] tab) {\n         // ForwardingNode \u200b\u8282\u70b9\u200b\u7684\u200b hash \u200b\u503c\u8bbe\u200b\u4e3a\u200b -1\n         super(MOVED, null, null, null);\n         this.nextTable = tab;\n     }\n }\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_188","title":"\u4ee3\u7801\u200b\u5757","text":"<ul> <li>\u200b\u53d8\u91cf\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u8868\u793a\u200bsizeCtl\u200b\u5c5e\u6027\u200b\u5728\u200b ConcurrentHashMap \u200b\u4e2d\u200b\u5185\u5b58\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\nprivate static final long SIZECTL;\n// \u200b\u8868\u793a\u200btransferIndex\u200b\u5c5e\u6027\u200b\u5728\u200b ConcurrentHashMap \u200b\u4e2d\u200b\u5185\u5b58\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\nprivate static final long TRANSFERINDEX;\n// \u200b\u8868\u793a\u200bbaseCount\u200b\u5c5e\u6027\u200b\u5728\u200b ConcurrentHashMap \u200b\u4e2d\u200b\u5185\u5b58\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\nprivate static final long BASECOUNT;\n// \u200b\u8868\u793a\u200bcellsBusy\u200b\u5c5e\u6027\u200b\u5728\u200b ConcurrentHashMap \u200b\u4e2d\u200b\u5185\u5b58\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\nprivate static final long CELLSBUSY;\n// \u200b\u8868\u793a\u200bcellValue\u200b\u5c5e\u6027\u200b\u5728\u200b CounterCell \u200b\u4e2d\u200b\u5185\u5b58\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\nprivate static final long CELLVALUE;\n// \u200b\u8868\u793a\u200b\u6570\u7ec4\u200b\u7b2c\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\nprivate static final long ABASE;\n// \u200b\u7528\u200b\u4f4d\u79fb\u200b\u8fd0\u7b97\u200b\u66ff\u4ee3\u200b\u4e58\u6cd5\u200b\nprivate static final int ASHIFT;\n</code></pre> <ul> <li>\u200b\u8d4b\u503c\u200b\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>// \u200b\u8868\u793a\u200b\u6570\u7ec4\u200b\u5355\u5143\u200b\u6240\u200b\u5360\u7528\u200b\u7a7a\u95f4\u200b\u5927\u5c0f\u200b\uff0cscale \u200b\u8868\u793a\u200b Node[] \u200b\u6570\u7ec4\u200b\u4e2d\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u5355\u5143\u200b\u6240\u200b\u5360\u7528\u200b\u7a7a\u95f4\u200b\u5927\u5c0f\u200b\uff0cint \u200b\u662f\u200b 4 \u200b\u5b57\u8282\u200b\nint scale = U.arrayIndexScale(ak);\n// \u200b\u5224\u65ad\u200b\u4e00\u4e2a\u200b\u6570\u200b\u662f\u4e0d\u662f\u200b 2 \u200b\u7684\u200b n \u200b\u6b21\u200b\u5e42\u200b\uff0c\u200b\u6bd4\u5982\u200b 8\uff1a1000 &amp; 0111 = 0000\nif ((scale &amp; (scale - 1)) != 0)\n    throw new Error(\"data type scale not a power of two\");\n\n// numberOfLeadingZeros(n)\uff1a\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u6570\u503c\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u4e8c\u8fdb\u5236\u200b\u540e\u200b\uff0c\u200b\u4ece\u200b\u9ad8\u4f4d\u200b\u5230\u200b\u4f4e\u4f4d\u200b\u5f00\u59cb\u200b\u7edf\u8ba1\u200b\uff0c\u200b\u770b\u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b0\u200b\u8fde\u7eed\u200b\u5728\u200b\u4e00\u8d77\u200b\n// 8 \u2192 1000 numberOfLeadingZeros(8) = 28\n// 4 \u2192 100 numberOfLeadingZeros(4) = 29   int \u200b\u503c\u200b\u5c31\u662f\u200b\u5360\u200b4\u200b\u4e2a\u200b\u5b57\u8282\u200b\nASHIFT = 31 - Integer.numberOfLeadingZeros(scale);\n\n// ASHIFT = 31 - 29 = 2 \uff0cint \u200b\u7684\u200b\u5927\u5c0f\u200b\u5c31\u662f\u200b 2 \u200b\u7684\u200b 2 \u200b\u6b21\u65b9\u200b\uff0c\u200b\u83b7\u53d6\u200b\u6b21\u65b9\u200b\u6570\u200b\n// ABASE + \uff085 &lt;&lt; ASHIFT\uff09 \u200b\u7528\u200b\u4f4d\u79fb\u200b\u8fd0\u7b97\u200b\u66ff\u4ee3\u200b\u4e86\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u83b7\u53d6\u200b arr[5] \u200b\u7684\u200b\u503c\u200b\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_189","title":"\u6784\u9020\u65b9\u6cd5","text":"<ul> <li>\u200b\u65e0\u53c2\u200b\u6784\u9020\u200b\uff0c \u200b\u6563\u200b\u5217\u8868\u200b\u7ed3\u6784\u200b\u5ef6\u8fdf\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u6570\u7ec4\u200b\u5927\u5c0f\u200b\u662f\u200b 16\uff1a</li> </ul> Java<pre><code>public ConcurrentHashMap() {\n}\n</code></pre> <ul> <li>\u200b\u6709\u200b\u53c2\u200b\u6784\u9020\u200b\uff1a</li> </ul> Java<pre><code>public ConcurrentHashMap(int initialCapacity) {\n    // \u200b\u6307\u5b9a\u200b\u5bb9\u91cf\u200b\u521d\u59cb\u5316\u200b\n    if (initialCapacity &lt; 0) throw new IllegalArgumentException();\n    int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ?\n               MAXIMUM_CAPACITY :\n               // \u200b\u5047\u5982\u200b\u4f20\u5165\u200b\u7684\u200b\u53c2\u6570\u200b\u662f\u200b 16\uff0c16 + 8 + 1 \uff0c\u200b\u6700\u540e\u200b\u5f97\u5230\u200b 32\n               // \u200b\u4f20\u5165\u200b 12\uff0c 12 + 6 + 1 = 19\uff0c\u200b\u6700\u540e\u200b\u5f97\u5230\u200b 32\uff0c\u200b\u5c3d\u53ef\u80fd\u200b\u7684\u200b\u5927\u200b\uff0c\u200b\u4e0e\u200b HashMap\u200b\u4e0d\u200b\u4e00\u6837\u200b\n               tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1));\n    // sizeCtl &gt; 0\uff0c\u200b\u5f53\u200b\u76ee\u524d\u200b table \u200b\u672a\u200b\u521d\u59cb\u5316\u200b\u65f6\u200b\uff0csizeCtl \u200b\u8868\u793a\u200b\u521d\u59cb\u5316\u200b\u5bb9\u91cf\u200b\n    this.sizeCtl = cap;\n}\n</code></pre> Java<pre><code>private static final int tableSizeFor(int c) {\n    int n = c - 1;\n    n |= n &gt;&gt;&gt; 1;\n    n |= n &gt;&gt;&gt; 2;\n    n |= n &gt;&gt;&gt; 4;\n    n |= n &gt;&gt;&gt; 8;\n    n |= n &gt;&gt;&gt; 16;\n    return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;\n}\n</code></pre> <p>HashMap \u200b\u90e8\u5206\u200b\u8be6\u89e3\u200b\u4e86\u200b\u8be5\u200b\u51fd\u6570\u200b\uff0c\u200b\u6838\u5fc3\u601d\u60f3\u200b\u5c31\u662f\u200b\u628a\u200b\u6700\u9ad8\u200b\u4f4d\u662f\u200b 1 \u200b\u7684\u200b\u4f4d\u200b\u4ee5\u53ca\u200b\u53f3\u8fb9\u200b\u7684\u200b\u4f4d\u200b\u5168\u90e8\u200b\u7f6e\u200b 1\uff0c\u200b\u7ed3\u679c\u200b\u52a0\u200b 1 \u200b\u540e\u200b\u5c31\u662f\u200b 2 \u200b\u7684\u200b n \u200b\u6b21\u200b\u5e42\u200b</p> <ul> <li>\u200b\u591a\u4e2a\u200b\u53c2\u6570\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) {\n    if (!(loadFactor &gt; 0.0f) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0)\n        throw new IllegalArgumentException();\n    // \u200b\u521d\u59cb\u200b\u5bb9\u91cf\u200b\u5c0f\u4e8e\u200b\u5e76\u53d1\u200b\u7ea7\u522b\u200b\n    if (initialCapacity &lt; concurrencyLevel)  \n        // \u200b\u628a\u200b\u5e76\u53d1\u200b\u7ea7\u522b\u200b\u8d4b\u503c\u200b\u7ed9\u200b\u521d\u59cb\u200b\u5bb9\u91cf\u200b\n        initialCapacity = concurrencyLevel; \n  // loadFactor \u200b\u9ed8\u8ba4\u200b\u662f\u200b 0.75\n    long size = (long)(1.0 + (long)initialCapacity / loadFactor);\n    int cap = (size &gt;= (long)MAXIMUM_CAPACITY) ?\n        MAXIMUM_CAPACITY : tableSizeFor((int)size);\n    // sizeCtl &gt; 0\uff0c\u200b\u5f53\u200b\u76ee\u524d\u200b table \u200b\u672a\u200b\u521d\u59cb\u5316\u200b\u65f6\u200b\uff0csizeCtl \u200b\u8868\u793a\u200b\u521d\u59cb\u5316\u200b\u5bb9\u91cf\u200b\n    this.sizeCtl = cap;\n}\n</code></pre> <ul> <li>\u200b\u96c6\u5408\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>public ConcurrentHashMap(Map&lt;? extends K, ? extends V&gt; m) {\n    this.sizeCtl = DEFAULT_CAPACITY;  // \u200b\u9ed8\u8ba4\u200b16\n    putAll(m);\n}\npublic void putAll(Map&lt;? extends K, ? extends V&gt; m) {\n    // \u200b\u5c1d\u8bd5\u200b\u89e6\u53d1\u200b\u6269\u5bb9\u200b\n    tryPresize(m.size());\n    for (Entry&lt;? extends K, ? extends V&gt; e : m.entrySet())\n        putVal(e.getKey(), e.getValue(), false);\n}\n</code></pre> Java<pre><code>private final void tryPresize(int size) {\n    // \u200b\u6269\u5bb9\u200b\u4e3a\u200b\u5927\u4e8e\u200b 2 \u200b\u500d\u200b\u7684\u200b\u6700\u5c0f\u200b\u7684\u200b 2 \u200b\u7684\u200b n \u200b\u6b21\u200b\u5e42\u200b\n    int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY :\n      tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1);\n    int sc;\n    while ((sc = sizeCtl) &gt;= 0) {\n        Node&lt;K,V&gt;[] tab = table; int n;\n        // \u200b\u6570\u7ec4\u200b\u8fd8\u200b\u672a\u200b\u521d\u59cb\u5316\u200b\uff0c\u3010\u200b\u4e00\u822c\u200b\u662f\u200b\u8c03\u7528\u200b\u96c6\u5408\u200b\u6784\u9020\u65b9\u6cd5\u200b\u624d\u200b\u4f1a\u200b\u6210\u7acb\u200b\uff0cput \u200b\u540e\u200b\u8c03\u7528\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b\u4e0d\u200b\u6210\u7acb\u200b\u7684\u200b\u3011\n        if (tab == null || (n = tab.length) == 0) {\n            n = (sc &gt; c) ? sc : c;\n            if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) {\n                try {\n                    if (table == tab) {\n                        Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n];\n                        table = nt;\n                        sc = n - (n &gt;&gt;&gt; 2);// \u200b\u6269\u5bb9\u200b\u9608\u503c\u200b\uff1an - 1/4 n\n                    }\n                } finally {\n                    sizeCtl = sc; // \u200b\u6269\u5bb9\u200b\u9608\u503c\u200b\u8d4b\u503c\u200b\u7ed9\u200bsizeCtl\n                }\n            }\n        }\n        // \u200b\u672a\u200b\u8fbe\u5230\u200b\u6269\u5bb9\u200b\u9608\u503c\u200b\u6216\u8005\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u5df2\u7ecf\u200b\u5927\u4e8e\u200b\u6700\u5927\u200b\u957f\u5ea6\u200b\n        else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY)\n            break;\n        // \u200b\u4e0e\u200b addCount \u200b\u903b\u8f91\u200b\u76f8\u540c\u200b\n        else if (tab == table) {\n\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_190","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_191","title":"\u6570\u636e\u200b\u8bbf\u5b58","text":"<ul> <li>tabAt()\uff1a\u200b\u83b7\u53d6\u200b\u6570\u7ec4\u200b\u67d0\u4e2a\u200b\u69fd\u200b\u4f4d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u6570\u7ec4\u200b\u4e2d\u200b\u7684\u200b\u76f4\u63a5\u200b\u5bfb\u5740\u200b arr[i]</li> </ul> Java<pre><code>// i \u200b\u662f\u200b\u6570\u7ec4\u200b\u7d22\u5f15\u200b\nstatic final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) {\n    // (i &lt;&lt; ASHIFT) + ABASE == ABASE + i * 4 \uff08\u200b\u4e00\u4e2a\u200b int \u200b\u5360\u200b 4 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff09\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u5bfb\u5740\u200b\uff0c\u200b\u66ff\u4ee3\u200b\u4e86\u200b\u4e58\u6cd5\u200b\n    return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);\n}\n</code></pre> <ul> <li>casTabAt()\uff1a\u200b\u6307\u5b9a\u200b\u6570\u7ec4\u200b\u7d22\u5f15\u200b\u4f4d\u7f6e\u200b\u4fee\u6539\u200b\u539f\u503c\u200b\u4e3a\u200b\u6307\u5b9a\u200b\u7684\u200b\u503c\u200b</li> </ul> Java<pre><code>static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) {\n    return U.compareAndSwapObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);\n}\n</code></pre> <ul> <li>setTabAt()\uff1a\u200b\u6307\u5b9a\u200b\u6570\u7ec4\u200b\u7d22\u5f15\u200b\u4f4d\u7f6e\u200b\u8bbe\u7f6e\u200b\u503c\u200b</li> </ul> Java<pre><code>static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) {\n    U.putObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_192","title":"\u6dfb\u52a0\u200b\u65b9\u6cd5","text":"Java<pre><code>public V put(K key, V value) {\n    // \u200b\u7b2c\u4e09\u4e2a\u200b\u53c2\u6570\u200b onlyIfAbsent \u200b\u4e3a\u200b false \u200b\u8868\u793a\u200b\u54c8\u5e0c\u200b\u8868\u4e2d\u200b\u5b58\u5728\u200b\u76f8\u540c\u200b\u7684\u200b key \u200b\u65f6\u200b\u3010\u200b\u7528\u200b\u5f53\u524d\u200b\u6570\u636e\u200b\u8986\u76d6\u200b\u65e7\u200b\u6570\u636e\u200b\u3011\n    return putVal(key, value, false);\n}\n</code></pre> <ul> <li>putVal()</li> </ul> Java<pre><code>final V putVal(K key, V value, boolean onlyIfAbsent) {\n    // \u3010ConcurrentHashMap \u200b\u4e0d\u80fd\u200b\u5b58\u653e\u200b null \u200b\u503c\u200b\u3011\n    if (key == null || value == null) throw new NullPointerException();\n    // \u200b\u6270\u52a8\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u9ad8\u4f4e\u200b\u4f4d\u200b\u90fd\u200b\u53c2\u4e0e\u200b\u5bfb\u5740\u200b\u8fd0\u7b97\u200b\n    int hash = spread(key.hashCode());\n    // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b k-v \u200b\u5c01\u88c5\u200b\u6210\u200b node \u200b\u540e\u200b\u63d2\u5165\u200b\u5230\u200b\u6307\u5b9a\u200b\u6876\u200b\u4f4d\u540e\u200b\uff0c\u200b\u5728\u200b\u6876\u200b\u4f4d\u200b\u4e2d\u200b\u7684\u200b\u6240\u5c5e\u200b\u94fe\u8868\u200b\u7684\u200b\u4e0b\u6807\u200b\u4f4d\u7f6e\u200b\n    int binCount = 0;\n    // tab \u200b\u5f15\u7528\u200b\u5f53\u524d\u200b map \u200b\u7684\u200b\u6570\u7ec4\u200b table\uff0c\u200b\u5f00\u59cb\u200b\u81ea\u65cb\u200b\n    for (Node&lt;K,V&gt;[] tab = table;;) {\n        // f \u200b\u8868\u793a\u200b\u6876\u200b\u4f4d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\uff0cn \u200b\u8868\u793a\u200b\u54c8\u5e0c\u200b\u8868\u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b\n        // i \u200b\u8868\u793a\u200b key \u200b\u901a\u8fc7\u200b\u5bfb\u5740\u200b\u8ba1\u7b97\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u6876\u200b\u4f4d\u200b\u4e0b\u6807\u200b\uff0cfh \u200b\u8868\u793a\u200b\u6876\u200b\u4f4d\u5934\u200b\u7ed3\u70b9\u200b\u7684\u200b hash \u200b\u503c\u200b\n        Node&lt;K,V&gt; f; int n, i, fh;\n\n        // \u3010CASE1\u3011\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b map \u200b\u4e2d\u200b\u7684\u200b table \u200b\u5c1a\u672a\u200b\u521d\u59cb\u5316\u200b\n        if (tab == null || (n = tab.length) == 0)\n            //\u3010\u200b\u5ef6\u8fdf\u200b\u521d\u59cb\u5316\u200b\u3011\n            tab = initTable();\n\n        // \u3010CASE2\u3011\uff1ai \u200b\u8868\u793a\u200b key \u200b\u4f7f\u7528\u200b\u3010\u200b\u5bfb\u5740\u200b\u7b97\u6cd5\u200b\u3011\u200b\u5f97\u5230\u200b key \u200b\u5bf9\u5e94\u200b\u6570\u7ec4\u200b\u7684\u200b\u4e0b\u6807\u200b\u4f4d\u7f6e\u200b\uff0ctabAt \u200b\u83b7\u53d6\u200b\u6307\u5b9a\u200b\u6876\u200b\u4f4d\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200bf\n        else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) {\n            // \u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u7ec4\u200b\u4e3a\u200b null \u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u54c8\u5e0c\u200b\u51b2\u7a81\u200b\uff0c\u200b\u76f4\u63a5\u200b\u65b0\u5efa\u200b\u8282\u70b9\u200b\u6dfb\u52a0\u200b\u5230\u8868\u4e2d\u200b\n            if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null)))\n                break;\n        }\n        // \u3010CASE3\u3011\uff1a\u200b\u903b\u8f91\u200b\u8bf4\u660e\u200b\u6570\u7ec4\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u524d\u200b key \u200b\u5bf9\u5e94\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0d\u200b\u4e3a\u200b null\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b\u4e3a\u200b FWD \u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8868\u793a\u200b\u76ee\u524d\u200b map \u200b\u6b63\u200b\u5904\u4e8e\u200b\u6269\u5bb9\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\n        else if ((fh = f.hash) == MOVED)\n            // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u3010\u200b\u9700\u8981\u200b\u53bb\u200b\u5e2e\u52a9\u200b\u54c8\u5e0c\u200b\u8868\u200b\u5b8c\u6210\u200b\u6269\u5bb9\u200b\u3011\n            tab = helpTransfer(tab, f);\n\n        // \u3010CASE4\u3011\uff1a\u200b\u54c8\u5e0c\u200b\u8868\u200b\u6ca1\u6709\u200b\u5728\u200b\u6269\u5bb9\u200b\uff0c\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u53ef\u80fd\u200b\u662f\u200b\u94fe\u8868\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u7ea2\u200b\u9ed1\u6811\u200b\n        else {\n            // \u200b\u5f53\u200b\u63d2\u5165\u200b key \u200b\u5b58\u5728\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u65e7\u503c\u200b\u8d4b\u503c\u200b\u7ed9\u200b oldVal \u200b\u8fd4\u56de\u200b\n            V oldVal = null;\n            // \u3010\u200b\u9501\u4f4f\u200b\u5f53\u524d\u200b key \u200b\u5bfb\u5740\u200b\u7684\u200b\u6876\u200b\u4f4d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\u3011\n            synchronized (f) {\n                // \u200b\u8fd9\u91cc\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u4e00\u4e0b\u200b\u6876\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\u6709\u6ca1\u6709\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ef\u80fd\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u8fc7\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u83b7\u53d6\u200b\n                if (tabAt(tab, i) == f) {\n                    // \u3010\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b\u5927\u4e8e\u200b 0 \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u662f\u200b\u666e\u901a\u200b\u7684\u200b\u94fe\u8868\u200b\u8282\u70b9\u200b\u3011\n                    if (fh &gt;= 0) {\n                        // \u200b\u5f53\u524d\u200b\u7684\u200b\u63d2\u5165\u200b\u64cd\u4f5c\u200b\u6ca1\u200b\u51fa\u73b0\u200b\u91cd\u590d\u200b\u7684\u200b key\uff0c\u200b\u8ffd\u52a0\u200b\u5230\u200b\u94fe\u8868\u200b\u7684\u200b\u672b\u5c3e\u200b\uff0cbinCount\u200b\u8868\u793a\u200b\u94fe\u8868\u200b\u957f\u5ea6\u200b -1\n                        // \u200b\u63d2\u5165\u200b\u7684\u200bkey\u200b\u4e0e\u200b\u94fe\u8868\u200b\u4e2d\u200b\u7684\u200b\u67d0\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b key \u200b\u4e00\u81f4\u200b\uff0c\u200b\u53d8\u6210\u200b\u66ff\u6362\u200b\u64cd\u4f5c\u200b\uff0cbinCount \u200b\u8868\u793a\u200b\u7b2c\u51e0\u4e2a\u200b\u8282\u70b9\u200b\u51b2\u7a81\u200b\n                        binCount = 1;\n                        // \u200b\u8fed\u4ee3\u200b\u5faa\u73af\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u7684\u200b\u94fe\u8868\u200b\uff0ce \u200b\u662f\u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u5904\u7406\u200b\u8282\u70b9\u200b\uff0ce \u200b\u521d\u59cb\u200b\u662f\u200b\u5934\u200b\u8282\u70b9\u200b\n                        for (Node&lt;K,V&gt; e = f;; ++binCount) {\n                            // \u200b\u5f53\u524d\u200b\u5faa\u73af\u200b\u8282\u70b9\u200b key\n                            K ek;\n                            // key \u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b\u4e0e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u54c8\u5e0c\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5e76\u4e14\u200b key \u200b\u7684\u200b\u503c\u200b\u4e5f\u200b\u76f8\u540c\u200b\n                            if (e.hash == hash &amp;&amp;\n                                ((ek = e.key) == key ||\n                                 (ek != null &amp;&amp; key.equals(ek)))) {\n                                // \u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b value \u200b\u8d4b\u503c\u200b\u7ed9\u200b oldVal\n                                oldVal = e.val;\n                                // \u200b\u5141\u8bb8\u200b\u8986\u76d6\u200b\n                                if (!onlyIfAbsent)\n                                    // \u200b\u65b0\u200b\u6570\u636e\u200b\u8986\u76d6\u200b\u65e7\u200b\u6570\u636e\u200b\n                                    e.val = value;\n                                // \u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\n                                break;\n                            }\n                            Node&lt;K,V&gt; pred = e;\n                            // \u200b\u5982\u679c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u5c01\u88c5\u200b\u6210\u200b\u8282\u70b9\u200b\u63d2\u5165\u200b\u94fe\u8868\u200b\u5c3e\u90e8\u200b\uff0c\u3010binCount \u200b\u4ee3\u8868\u200b\u957f\u5ea6\u200b - 1\u3011\n                            if ((e = e.next) == null) {\n                                pred.next = new Node&lt;K,V&gt;(hash, key,\n                                                          value, null);\n                                break;\n                            }\n                        }\n                    }\n                    // \u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u5934\u200b\u8282\u70b9\u200b\u662f\u200b\u7ea2\u200b\u9ed1\u6811\u200b\n                    else if (f instanceof TreeBin) {\n                        Node&lt;K,V&gt; p;\n                        binCount = 2;\n                        if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,\n                                                              value)) != null) {\n                            oldVal = p.val;\n                            if (!onlyIfAbsent)\n                                p.val = value;\n                        }\n                    }\n                }\n            }\n\n            // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u662f\u200b\u94fe\u8868\u200b\u6216\u8005\u200b\u7ea2\u9ed1\u6811\u200b\n            if (binCount != 0) {\n                // \u200b\u5982\u679c\u200b binCount &gt;= 8 \u200b\u8868\u793a\u200b\u5904\u7406\u200b\u7684\u200b\u6876\u200b\u4f4d\u200b\u4e00\u5b9a\u200b\u662f\u200b\u94fe\u8868\u200b\uff0c\u200b\u8bf4\u660e\u200b\u957f\u5ea6\u200b\u662f\u200b 9\n                if (binCount &gt;= TREEIFY_THRESHOLD)\n                    // \u200b\u6811\u5316\u200b\n                    treeifyBin(tab, i);\n                if (oldVal != null)\n                    return oldVal;\n                break;\n            }\n        }\n    }\n    // \u200b\u7edf\u8ba1\u200b\u5f53\u524d\u200b table \u200b\u4e00\u5171\u200b\u6709\u200b\u591a\u5c11\u200b\u6570\u636e\u200b\uff0c\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8fbe\u5230\u200b\u6269\u5bb9\u200b\u9608\u503c\u200b\u6807\u51c6\u200b\uff0c\u200b\u89e6\u53d1\u200b\u6269\u5bb9\u200b\n    // binCount = 0 \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u4e3a\u200b null\uff0cnode \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u653e\u5165\u200b\uff0c2 \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u5df2\u7ecf\u200b\u662f\u200b\u7ea2\u200b\u9ed1\u6811\u200b\n    addCount(1L, binCount);\n    return null;\n}\n</code></pre> <ul> <li>spread()\uff1a\u200b\u6270\u52a8\u200b\u51fd\u6570\u200b</li> </ul> <p>\u200b\u5c06\u200b hashCode \u200b\u65e0\u200b\u7b26\u53f7\u200b\u53f3\u79fb\u200b 16 \u200b\u4f4d\u200b\uff0c\u200b\u9ad8\u200b 16bit \u200b\u548c\u200b\u4f4e\u200b 16bit \u200b\u505a\u200b\u5f02\u6216\u200b\uff0c\u200b\u6700\u540e\u200b\u4e0e\u200b HASH_BITS \u200b\u76f8\u4e0e\u200b\u53d8\u6210\u200b\u6b63\u6570\u200b\uff0c\u200b\u4e0e\u200b\u6811\u5316\u200b\u8282\u70b9\u200b\u548c\u200b\u8f6c\u79fb\u200b\u8282\u70b9\u200b\u533a\u5206\u200b\uff0c\u200b\u628a\u200b\u9ad8\u4f4e\u200b\u4f4d\u200b\u90fd\u200b\u5229\u7528\u200b\u8d77\u6765\u200b\u51cf\u5c11\u200b\u54c8\u5e0c\u200b\u51b2\u7a81\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6563\u5217\u200b\u7684\u200b\u5747\u5300\u200b\u6027\u200b</p> Java<pre><code>static final int spread(int h) {\n    return (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS; // 0111 1111 1111 1111 1111 1111 1111 1111\n}\n</code></pre> <ul> <li>initTable()\uff1a\u200b\u521d\u59cb\u5316\u200b\u6570\u7ec4\u200b\uff0c\u200b\u5ef6\u8fdf\u200b\u521d\u59cb\u5316\u200b</li> </ul> Java<pre><code>private final Node&lt;K,V&gt;[] initTable() {\n    // tab \u200b\u5f15\u7528\u200b map.table\uff0csc \u200b\u5f15\u7528\u200b sizeCtl\n    Node&lt;K,V&gt;[] tab; int sc;\n    // table \u200b\u5c1a\u672a\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u5f00\u59cb\u200b\u81ea\u65cb\u200b\n    while ((tab = table) == null || tab.length == 0) {\n        // sc &lt; 0 \u200b\u8bf4\u660e\u200b table \u200b\u6b63\u5728\u200b\u521d\u59cb\u5316\u200b\u6216\u8005\u200b\u6b63\u5728\u200b\u6269\u5bb9\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u91ca\u653e\u200b CPU \u200b\u8d44\u6e90\u200b\n        if ((sc = sizeCtl) &lt; 0)\n            Thread.yield();\n        // sizeCtl \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b -1\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u52a0\u9501\u200b\uff0c\u3010\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u662f\u200b SIZECTL \u200b\u4f4d\u7f6e\u200b\u7684\u200b\u6570\u636e\u200b\u3011\uff0c\n        // \u200b\u56e0\u4e3a\u200b\u662f\u200b sizeCtl \u200b\u662f\u200b\u57fa\u672c\u200b\u7c7b\u578b\u200b\uff0c\u200b\u4e0d\u662f\u200b\u5f15\u7528\u200b\u7c7b\u578b\u200b\uff0c\u200b\u6240\u4ee5\u200b sc \u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u6570\u636e\u200b\u7684\u200b\u526f\u672c\u200b\n        else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) {\n            try {\n                // \u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u5224\u65ad\u200b\n                if ((tab = table) == null || tab.length == 0) {\n                    // sc &gt; 0 \u200b\u521b\u5efa\u200b table \u200b\u65f6\u200b\u4f7f\u7528\u200b sc \u200b\u4e3a\u200b\u6307\u5b9a\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5426\u5219\u200b\u4f7f\u7528\u200b 16 \u200b\u9ed8\u8ba4\u503c\u200b\n                    int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY;\n                    // \u200b\u521b\u5efa\u200b\u54c8\u5e0c\u200b\u8868\u200b\u6570\u7ec4\u200b\n                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n];\n                    table = tab = nt;\n                    // \u200b\u6269\u5bb9\u200b\u9608\u503c\u200b\uff0cn &gt;&gt;&gt; 2  =&gt; \u200b\u7b49\u4e8e\u200b 1/4 n \uff0cn - (1/4)n = 3/4 n =&gt; 0.75 * n\n                    sc = n - (n &gt;&gt;&gt; 2);\n                }\n            } finally {\n                // \u200b\u89e3\u9501\u200b\uff0c\u200b\u628a\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u6269\u5bb9\u200b\u7684\u200b\u9608\u503c\u200b\u8d4b\u503c\u200b\u7ed9\u200b sizeCtl\n                sizeCtl = sc;\n            }\n            break;\n        }\n    }\n    return tab;\n}\n</code></pre> <ul> <li>treeifyBin()\uff1a\u200b\u6811\u5316\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) {\n    Node&lt;K,V&gt; b; int n, sc;\n    if (tab != null) {\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\uff1a\u3010\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b table \u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u672a\u200b\u8fbe\u5230\u200b 64\uff0c\u200b\u6b64\u65f6\u200b\u4e0d\u200b\u8fdb\u884c\u200b\u6811\u5316\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8fdb\u884c\u200b\u6269\u5bb9\u200b\u64cd\u4f5c\u200b\u3011\n        if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY)\n            // \u200b\u5f53\u524d\u200b\u5bb9\u91cf\u200b\u7684\u200b 2 \u200b\u500d\u200b\n            tryPresize(n &lt;&lt; 1);\n\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\uff1a\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u4e14\u200b\u662f\u200b\u666e\u901a\u200b node \u200b\u6570\u636e\u200b\u3002\n        else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) {\n            // \u3010\u200b\u6811\u5316\u200b\u52a0\u9501\u200b\u3011\n            synchronized (b) {\n                // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\uff1a\u200b\u8868\u793a\u200b\u52a0\u9501\u200b\u6ca1\u200b\u95ee\u9898\u200b\u3002\n                if (tabAt(tab, index) == b) {\n                    TreeNode&lt;K,V&gt; hd = null, tl = null;\n                    for (Node&lt;K,V&gt; e = b; e != null; e = e.next) {\n                        TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;(e.hash, e.key, e.val,null, null);\n                        if ((p.prev = tl) == null)\n                            hd = p;\n                        else\n                            tl.next = p;\n                        tl = p;\n                    }\n                    setTabAt(tab, index, new TreeBin&lt;K,V&gt;(hd));\n                }\n            }\n        }\n    }\n}\n</code></pre> <ul> <li>addCount()\uff1a\u200b\u6dfb\u52a0\u200b\u8ba1\u6570\u200b\uff0c\u200b\u4ee3\u8868\u200b\u54c8\u5e0c\u200b\u8868\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u603b\u91cf\u200b</li> </ul> Java<pre><code>private final void addCount(long x, int check) {\n    // \u3010\u200b\u4e0a\u9762\u200b\u8fd9\u90e8\u5206\u200b\u7684\u200b\u903b\u8f91\u200b\u5c31\u662f\u200b LongAdder \u200b\u7684\u200b\u7d2f\u52a0\u200b\u903b\u8f91\u200b\u3011\n    CounterCell[] as; long b, s;\n    // \u200b\u5224\u65ad\u200b\u7d2f\u52a0\u200b\u6570\u7ec4\u200b cells \u200b\u662f\u5426\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5c31\u200b\u53bb\u200b\u7d2f\u52a0\u200b base \u200b\u57df\u200b\uff0c\u200b\u7d2f\u52a0\u200b\u5931\u8d25\u200b\u8fdb\u5165\u200b\u6761\u4ef6\u200b\u5185\u200b\u903b\u8f91\u200b\n    if ((as = counterCells) != null ||\n        !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x)) {\n        CounterCell a; long v; int m;\n        // true \u200b\u672a\u200b\u7ade\u4e89\u200b\uff0cfalse \u200b\u53d1\u751f\u200b\u7ade\u4e89\u200b\n        boolean uncontended = true;\n        // \u200b\u5224\u65ad\u200b cells \u200b\u662f\u5426\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u521d\u59cb\u5316\u200b\n        if (as == null || (m = as.length - 1) &lt; 0 ||\n            // \u200b\u524d\u9762\u200b\u7684\u200b\u6761\u4ef6\u200b\u4e3a\u200b fasle \u200b\u8bf4\u660e\u200b cells \u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u901a\u8fc7\u200b hash \u200b\u5bfb\u5740\u200b\u5bf9\u5e94\u200b\u7684\u200b\u69fd\u200b\u4f4d\u200b\n            (a = as[ThreadLocalRandom.getProbe() &amp; m]) == null ||\n            // \u200b\u5c1d\u8bd5\u200b\u53bb\u200b\u5bf9\u5e94\u200b\u7684\u200b\u69fd\u200b\u4f4d\u200b\u7d2f\u52a0\u200b\uff0c\u200b\u7d2f\u52a0\u200b\u5931\u8d25\u200b\u8fdb\u5165\u200b fullAddCount \u200b\u8fdb\u884c\u200b\u91cd\u8bd5\u200b\u6216\u8005\u200b\u6269\u5bb9\u200b\n            !(uncontended = U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) {\n            // \u200b\u4e0e\u200b Striped64#longAccumulate \u200b\u65b9\u6cd5\u200b\u76f8\u540c\u200b\n            fullAddCount(x, uncontended);\n            return;\n        }\n        // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u662f\u200b null\uff0c\u200b\u6216\u8005\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u8282\u70b9\u200b\n        if (check &lt;= 1)   \n            return;\n      // \u3010\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u6563\u200b\u5217\u8868\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\u3011\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u671f\u671b\u503c\u200b\n        s = sumCount();\n    }\n\n    // \u200b\u8868\u793a\u200b\u4e00\u5b9a\u200b \u3010\u200b\u662f\u200b\u4e00\u4e2a\u200b put \u200b\u64cd\u4f5c\u200b\u8c03\u7528\u200b\u7684\u200b addCount\u3011\n    if (check &gt;= 0) {\n        Node&lt;K,V&gt;[] tab, nt; int n, sc;\n\n        // \u200b\u6761\u4ef6\u200b\u4e00\u200b\uff1atrue \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b sizeCtl \u200b\u53ef\u80fd\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u8d1f\u6570\u200b\u8868\u793a\u200b\u6b63\u5728\u200b\u6269\u5bb9\u200b\u4e2d\u200b\uff0c\u200b\u6216\u8005\u200b sizeCtl \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6b63\u6570\u200b\uff0c\u200b\u8868\u793a\u200b\u6269\u5bb9\u200b\u9608\u503c\u200b\n        //        false \u200b\u8868\u793a\u200b\u54c8\u5e0c\u200b\u8868\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u6570\u91cf\u200b\u6ca1\u200b\u8fbe\u5230\u200b\u6269\u5bb9\u200b\u6761\u4ef6\u200b\n        // \u200b\u7136\u540e\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b table \u200b\u6570\u7ec4\u200b\u662f\u5426\u200b\u521d\u59cb\u5316\u200b\u4e86\u200b\uff0c\u200b\u5f53\u524d\u200b table \u200b\u957f\u5ea6\u200b\u662f\u5426\u200b\u5c0f\u4e8e\u200b\u6700\u5927\u503c\u200b\u9650\u5236\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u6269\u5bb9\u200b\n        while (s &gt;= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp;\n               (n = tab.length) &lt; MAXIMUM_CAPACITY) {\n            // 16 -&gt; 32 \u200b\u6269\u5bb9\u200b \u200b\u6807\u8bc6\u200b\u4e3a\u200b\uff1a1000 0000 0001 1011\uff0c\u3010\u200b\u8d1f\u6570\u200b\uff0c\u200b\u6269\u5bb9\u200b\u6279\u6b21\u200b\u552f\u4e00\u200b\u6807\u8bc6\u200b\u6233\u200b\u3011\n            int rs = resizeStamp(n);\n\n            // \u200b\u8868\u793a\u200b\u5f53\u524d\u200b table\uff0c\u3010\u200b\u6b63\u5728\u200b\u6269\u5bb9\u200b\u3011\uff0csc \u200b\u9ad8\u200b 16 \u200b\u4f4d\u662f\u200b\u6269\u5bb9\u200b\u6807\u8bc6\u200b\u6233\u200b\uff0c\u200b\u4f4e\u200b 16 \u200b\u4f4d\u662f\u200b\u7ebf\u7a0b\u200b\u6570\u200b + 1\n            if (sc &lt; 0) {\n                // \u200b\u6761\u4ef6\u200b\u4e00\u200b\uff1a\u200b\u5224\u65ad\u200b\u6269\u5bb9\u200b\u6807\u8bc6\u200b\u6233\u200b\u662f\u5426\u200b\u4e00\u6837\u200b\uff0cfasle \u200b\u4ee3\u8868\u200b\u4e00\u6837\u200b\n                // \u200b\u52d8\u8bef\u200b\u4e24\u4e2a\u200b\u6761\u4ef6\u200b\uff1a\n                // \u200b\u6761\u4ef6\u200b\u4e8c\u662f\u200b\uff1asc == (rs &lt;&lt; 16 ) + 1\uff0ctrue \u200b\u4ee3\u8868\u200b\u6269\u5bb9\u200b\u5b8c\u6210\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4f4e\u200b16\u200b\u4f4d\u662f\u200b1\u200b\u4ee3\u8868\u200b\u6ca1\u6709\u200b\u7ebf\u7a0b\u200b\u6269\u5bb9\u200b\u4e86\u200b\n                // \u200b\u6761\u4ef6\u200b\u4e09\u662f\u200b\uff1asc == (rs &lt;&lt; 16) + MAX_RESIZERS\uff0c\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u8d85\u8fc7\u200b\u6700\u5927\u200b\u5141\u8bb8\u200b\u7684\u200b\u5e76\u53d1\u200b\u6269\u5bb9\u200b\u7ebf\u7a0b\u200b\u6570\u200b\n                // \u200b\u6761\u4ef6\u200b\u56db\u200b\uff1a\u200b\u5224\u65ad\u200b\u65b0\u8868\u200b\u7684\u200b\u5f15\u7528\u200b\u662f\u5426\u662f\u200b null\uff0c\u200b\u4ee3\u8868\u200b\u6269\u5bb9\u200b\u5b8c\u6210\u200b\n                // \u200b\u6761\u4ef6\u200b\u4e94\u200b\uff1a\u3010\u200b\u6269\u5bb9\u200b\u662f\u4ece\u200b\u9ad8\u4f4d\u200b\u5230\u200b\u4f4e\u4f4d\u200b\u8f6c\u79fb\u200b\u3011\uff0ctransferIndex &lt; 0 \u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u533a\u95f4\u200b\u9700\u8981\u200b\u6269\u5bb9\u200b\u4e86\u200b\n                if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||\n                    sc == rs + MAX_RESIZERS || (nt = nextTable) == null ||\n                    transferIndex &lt;= 0)\n                    break;\n\n                // \u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53c2\u4e0e\u200b\u5230\u200b\u6269\u5bb9\u200b\u4efb\u52a1\u200b\u4e2d\u200b\uff0c\u200b\u5c06\u200b sc \u200b\u4f4e\u200b 16 \u200b\u4f4d\u503c\u52a0\u200b 1\uff0c\u200b\u8868\u793a\u200b\u591a\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u53c2\u4e0e\u200b\u6269\u5bb9\u200b\n                // \u200b\u8bbe\u7f6e\u200b\u5931\u8d25\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6216\u8005\u200b transfer \u200b\u5185\u90e8\u200b\u4fee\u6539\u200b\u4e86\u200b sizeCtl \u200b\u503c\u200b\n                if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1))\n                    //\u3010\u200b\u534f\u52a9\u200b\u6269\u5bb9\u200b\u7ebf\u7a0b\u200b\u3011\uff0c\u200b\u6301\u6709\u200bnextTable\u200b\u53c2\u6570\u200b\n                    transfer(tab, nt);\n            }\n            // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u89e6\u53d1\u200b\u6269\u5bb9\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b + 2\n            // 1000 0000 0001 1011 0000 0000 0000 0000 +2 =&gt; 1000 0000 0001 1011 0000 0000 0000 0010\n            else if (U.compareAndSwapInt(this, SIZECTL, sc,(rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2))\n                //\u3010\u200b\u89e6\u53d1\u200b\u6269\u5bb9\u200b\u6761\u4ef6\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u3011\uff0c\u200b\u4e0d\u200b\u6301\u6709\u200b nextTable\uff0c\u200b\u521d\u59cb\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u65b0\u5efa\u200b nextTable\n                transfer(tab, null);\n            s = sumCount();\n        }\n    }\n}\n</code></pre> <ul> <li>resizeStamp()\uff1a\u200b\u6269\u5bb9\u200b\u6807\u8bc6\u7b26\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u6269\u5bb9\u200b\u90fd\u200b\u4f1a\u200b\u4ea7\u751f\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u4e0d\u662f\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u4ea7\u751f\u200b\uff0c16 \u200b\u6269\u5bb9\u200b\u5230\u200b 32 \u200b\u4ea7\u751f\u200b\u4e00\u4e2a\u200b\uff0c32 \u200b\u6269\u5bb9\u200b\u5230\u200b 64 \u200b\u4ea7\u751f\u200b\u4e00\u4e2a\u200b</li> </ul> Java<pre><code>/**\n * \u200b\u6269\u5bb9\u200b\u7684\u200b\u6807\u8bc6\u7b26\u200b\n * 16 -&gt; 32 \u200b\u4ece\u200b16\u200b\u6269\u5bb9\u200b\u5230\u200b32\n * numberOfLeadingZeros(16) =&gt; 1 0000 =&gt; 32 - 5 = 27 =&gt; 0000 0000 0001 1011\n * (1 &lt;&lt; (RESIZE_STAMP_BITS - 1)) =&gt; 1000 0000 0000 0000 =&gt; 32768\n * ---------------------------------------------------------------\n * 0000 0000 0001 1011\n * 1000 0000 0000 0000\n * 1000 0000 0001 1011\n * \u200b\u6c38\u8fdc\u200b\u662f\u200b\u8d1f\u6570\u200b\n */\nstatic final int resizeStamp(int n) {\n    // \u200b\u6216\u200b\u8fd0\u7b97\u200b\n    return Integer.numberOfLeadingZeros(n) | (1 &lt;&lt; (RESIZE_STAMP_BITS - 1)); // (16 -1 = 15)\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_193","title":"\u6269\u5bb9\u200b\u65b9\u6cd5","text":"<p>\u200b\u6269\u5bb9\u200b\u673a\u5236\u200b\uff1a</p> <ul> <li>\u200b\u5f53\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\u8d85\u8fc7\u200b 8 \u200b\u4e2a\u200b\uff0c\u200b\u6570\u7ec4\u200b\u7684\u200b\u5927\u5c0f\u200b\u8fd8\u200b\u672a\u200b\u8d85\u8fc7\u200b 64 \u200b\u65f6\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8fdb\u884c\u200b\u6570\u7ec4\u200b\u7684\u200b\u6269\u5bb9\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u5219\u200b\u5c06\u200b\u94fe\u8868\u200b\u8f6c\u5316\u6210\u200b\u7ea2\u9ed1\u6811\u200b</li> <li>put \u200b\u6570\u636e\u200b\u540e\u200b\u8c03\u7528\u200b addCount() \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u54c8\u5e0c\u200b\u8868\u200b\u7684\u200b\u5bb9\u91cf\u200b\u8d85\u8fc7\u200b\u9608\u503c\u200b sizeCtl\uff0c\u200b\u8d85\u8fc7\u200b\u8fdb\u884c\u200b\u6269\u5bb9\u200b</li> <li>\u200b\u589e\u5220\u200b\u6539\u200b\u7ebf\u7a0b\u200b\u53d1\u73b0\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6b63\u5728\u200b\u6269\u5bb9\u200b\uff0c\u200b\u5e2e\u5176\u200b\u6269\u5bb9\u200b</li> </ul> <p>\u200b\u5e38\u89c1\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>transfer()\uff1a\u200b\u6570\u636e\u200b\u8f6c\u79fb\u200b\u5230\u200b\u65b0\u8868\u4e2d\u200b\uff0c\u200b\u5b8c\u6210\u200b\u6269\u5bb9\u200b</li> </ul> Java<pre><code>private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) {\n    // n \u200b\u8868\u793a\u200b\u6269\u5bb9\u200b\u4e4b\u524d\u200b table \u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b\n    int n = tab.length, stride;\n    // stride \u200b\u8868\u793a\u200b\u5206\u914d\u200b\u7ed9\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u7684\u200b\u6b65\u957f\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u5c31\u662f\u200b 16 \n    if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)\n        stride = MIN_TRANSFER_STRIDE;\n    // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b\u89e6\u53d1\u200b\u672c\u6b21\u200b\u6269\u5bb9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u9700\u8981\u200b\u505a\u200b\u4e00\u4e9b\u200b\u6269\u5bb9\u200b\u51c6\u5907\u200b\u5de5\u4f5c\u200b\uff0c\u3010\u200b\u534f\u52a9\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u505a\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u3011\n    if (nextTab == null) {\n        try {\n            // \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5bb9\u91cf\u200b\u662f\u200b\u4e4b\u524d\u200b\u3010\u200b\u4e8c\u500d\u200b\u7684\u200b table \u200b\u6570\u7ec4\u200b\u3011\n            Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1];\n            nextTab = nt;\n        } catch (Throwable ex) {\n            sizeCtl = Integer.MAX_VALUE;\n            return;\n        }\n        // \u200b\u628a\u200b\u65b0\u8868\u200b\u8d4b\u503c\u200b\u7ed9\u200b\u5bf9\u8c61\u200b\u5c5e\u6027\u200b nextTable\uff0c\u200b\u65b9\u4fbf\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u65b0\u8868\u200b\n        nextTable = nextTab;\n        // \u200b\u8bb0\u5f55\u200b\u8fc1\u79fb\u200b\u6570\u636e\u200b\u6574\u4f53\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6807\u8bb0\u200b\uff0ctransferIndex \u200b\u8ba1\u6570\u200b\u4ece\u200b1\u200b\u5f00\u59cb\u200b\u4e0d\u662f\u200b 0\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u662f\u200b\u957f\u5ea6\u200b\uff0c\u200b\u4e0d\u662f\u200b\u957f\u5ea6\u200b-1\n        transferIndex = n;\n    }\n    // \u200b\u65b0\u200b\u6570\u7ec4\u200b\u7684\u200b\u957f\u5ea6\u200b\n    int nextn = nextTab.length;\n    // \u200b\u5f53\u200b\u67d0\u4e2a\u200b\u6876\u200b\u4f4d\u200b\u6570\u636e\u5904\u7406\u200b\u5b8c\u6bd5\u200b\u540e\u200b\uff0c\u200b\u5c06\u200b\u6b64\u6876\u200b\u4f4d\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b fwd \u200b\u8282\u70b9\u200b\uff0c\u200b\u5176\u5b83\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u6216\u8bfb\u200b\u7ebf\u7a0b\u200b\u770b\u5230\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4ece\u4e2d\u200b\u83b7\u53d6\u200b\u5230\u200b\u65b0\u8868\u200b\n    ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab);\n    // \u200b\u63a8\u8fdb\u200b\u6807\u8bb0\u200b\n    boolean advance = true;\n    // \u200b\u5b8c\u6210\u200b\u6807\u8bb0\u200b\n    boolean finishing = false;\n\n    // i \u200b\u8868\u793a\u200b\u5206\u914d\u200b\u7ed9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6267\u884c\u200b\u5230\u200b\u7684\u200b\u6876\u200b\u4f4d\u200b\n    // bound \u200b\u8868\u793a\u200b\u5206\u914d\u200b\u7ed9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u7684\u200b\u4e0b\u754c\u200b\u9650\u5236\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u662f\u200b\u5012\u5e8f\u200b\u8fc1\u79fb\u200b\uff0c16 \u200b\u8fc1\u79fb\u200b\u5b8c\u200b \u200b\u8fc1\u79fb\u200b 15\uff0c15\u200b\u5b8c\u6210\u200b\u53bb\u200b\u8fc1\u79fb\u200b14\n    for (int i = 0, bound = 0;;) {\n        Node&lt;K,V&gt; f; int fh;\n\n        // \u200b\u7ed9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u3010\u200b\u5206\u914d\u4efb\u52a1\u200b\u533a\u95f4\u200b\u3011\n        while (advance) {\n            // \u200b\u5206\u914d\u4efb\u52a1\u200b\u7684\u200b\u5f00\u59cb\u200b\u4e0b\u6807\u200b\uff0c\u200b\u5206\u914d\u4efb\u52a1\u200b\u7684\u200b\u7ed3\u675f\u200b\u4e0b\u6807\u200b\n            int nextIndex, nextBound;\n\n            // --i \u200b\u8ba9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5904\u7406\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7d22\u5f15\u200b\uff0ctrue\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7684\u200b\u8fc1\u79fb\u200b\u4efb\u52a1\u200b\u5c1a\u672a\u200b\u5b8c\u6210\u200b\uff0cfalse\u200b\u8bf4\u660e\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\u6216\u8005\u200b\u8fd8\u200b\u672a\u200b\u5206\u914d\u200b\n            if (--i &gt;= bound || finishing)\n                advance = false;\n            // \u200b\u8fc1\u79fb\u200b\u7684\u200b\u5f00\u59cb\u200b\u4e0b\u6807\u200b\uff0c\u200b\u5c0f\u4e8e\u200b0\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u533a\u95f4\u200b\u9700\u8981\u200b\u8fc1\u79fb\u200b\u4e86\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b i \u200b\u53d8\u91cf\u200b\u4e3a\u200b -1 \u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\n            else if ((nextIndex = transferIndex) &lt;= 0) {\n                i = -1;\n                advance = false;\n            }\n            // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u8fd8\u6709\u200b\u533a\u95f4\u200b\u9700\u8981\u200b\u5206\u914d\u200b\uff0c\u200b\u7136\u540e\u200b\u7ed9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5206\u914d\u4efb\u52a1\u200b\uff0c\n            else if (U.compareAndSwapInt(this, TRANSFERINDEX, nextIndex,\n                      // \u200b\u5224\u65ad\u200b\u533a\u95f4\u200b\u662f\u5426\u200b\u8fd8\u200b\u591f\u200b\u4e00\u4e2a\u200b\u6b65\u957f\u200b\uff0c\u200b\u4e0d\u591f\u200b\u5c31\u200b\u5168\u90e8\u200b\u5206\u914d\u200b\n                      nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) {\n                // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ed3\u675f\u200b\u4e0b\u6807\u200b\n                bound = nextBound;\n                // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f00\u59cb\u200b\u4e0b\u6807\u200b\uff0c\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7ed3\u675f\u200b\u7684\u200b\u4e0b\u200b\u6807\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7d22\u5f15\u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u5f00\u59cb\u200b\u7684\u200b\u4e0b\u6807\u200b\n                i = nextIndex - 1;\n                // \u200b\u4efb\u52a1\u5206\u914d\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\u6267\u884c\u200b\u8fc1\u79fb\u200b\u64cd\u4f5c\u200b\n                advance = false;\n            }\n        }\n\n        // \u3010\u200b\u5206\u914d\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5f00\u59cb\u200b\u6570\u636e\u200b\u8fc1\u79fb\u200b\u64cd\u4f5c\u200b\u3011\n        // \u3010CASE1\u3011\uff1ai &lt; 0 \u200b\u6210\u7acb\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u672a\u200b\u5206\u914d\u200b\u5230\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6216\u8005\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u5b8c\u200b\u4e86\u200b\n        if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) {\n            int sc;\n            // \u200b\u5982\u679c\u200b\u8fc1\u79fb\u200b\u5b8c\u6210\u200b\n            if (finishing) {\n                nextTable = null; // help GC\n                table = nextTab;  // \u200b\u65b0\u8868\u200b\u8d4b\u503c\u200b\u7ed9\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\n                sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1);// \u200b\u6269\u5bb9\u200b\u9608\u503c\u200b\u4e3a\u200b 2n - n/2 = 3n/2 = 0.75*(2n)\n                return;\n            }\n            // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5206\u914d\u200b\u7684\u200b\u4efb\u52a1\u200b\u533a\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9000\u51fa\u200b\uff0c\u200b\u5148\u200b\u628a\u200b sizeCtl \u200b\u8d4b\u503c\u200b\u7ed9\u200b sc \u200b\u4fdd\u7559\u200b\n            if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {\n                // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u4e0d\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0d\u662f\u200b\u7684\u8bdd\u200b\u76f4\u63a5\u200b return\uff0c\n                if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)\n                    return;\n                // \u200b\u6240\u4ee5\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u9000\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0csizeCtl \u200b\u7684\u200b\u4f4e\u200b 16 \u200b\u4f4d\u4e3a\u200b 1\n                finishing = advance = true;\n                // \u3010\u200b\u8fd9\u91cc\u200b\u8868\u793a\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u68c0\u67e5\u200b\u4e00\u904d\u200b\u662f\u5426\u200b\u6709\u200b\u6f0f\u6389\u200b\u7684\u200b\u533a\u95f4\u200b\u3011\n                i = n;\n            }\n        }\n\n        // \u3010CASE2\u3011\uff1a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u672a\u200b\u5b58\u653e\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5c06\u200b\u6b64\u5904\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b fwd \u200b\u8282\u70b9\u200b\u5373\u53ef\u200b\u3002\n        else if ((f = tabAt(tab, i)) == null)\n            advance = casTabAt(tab, i, null, fwd);\n        // \u3010CASE3\u3011\uff1a\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u5df2\u7ecf\u200b\u8fc1\u79fb\u200b\u8fc7\u200b\u4e86\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u7528\u200b\u518d\u200b\u5904\u7406\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5904\u7406\u200b\u4e0b\u200b\u4e00\u4e2a\u6876\u200b\u4f4d\u200b\u5373\u53ef\u200b\n        else if ((fh = f.hash) == MOVED)\n            advance = true; \n        // \u3010CASE4\u3011\uff1a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u800c\u4e14\u200b node \u200b\u8282\u70b9\u200b\u4e0d\u662f\u200b fwd \u200b\u8282\u70b9\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8fd9\u4e9b\u200b\u6570\u636e\u200b\u9700\u8981\u200b\u8fc1\u79fb\u200b\n        else {\n            // \u3010\u200b\u9501\u4f4f\u200b\u5934\u200b\u8282\u70b9\u200b\u3011\n            synchronized (f) {\n                // \u200b\u4e8c\u6b21\u200b\u68c0\u67e5\u200b\uff0c\u200b\u9632\u6b62\u200b\u5934\u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u4fee\u6539\u200b\u4e86\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u624d\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u8bbf\u95ee\u200b\n                if (tabAt(tab, i) == f) {\n                    // \u3010\u200b\u8fc1\u79fb\u200b\u6570\u636e\u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u548c\u200b HashMap \u200b\u76f8\u4f3c\u200b\u3011\n\n                    // ln \u200b\u8868\u793a\u200b\u4f4e\u4f4d\u200b\u94fe\u8868\u200b\u5f15\u7528\u200b\n                    // hn \u200b\u8868\u793a\u200b\u9ad8\u4f4d\u200b\u94fe\u8868\u200b\u5f15\u7528\u200b\n                    Node&lt;K,V&gt; ln, hn;\n                    // \u200b\u54c8\u5e0c\u200b &gt; 0 \u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u662f\u200b\u94fe\u8868\u200b\u6876\u200b\u4f4d\u200b\n                    if (fh &gt;= 0) {\n                        // \u200b\u548c\u200b HashMap \u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\u4e00\u81f4\u200b\uff0c\u200b\u4e0e\u200b\u8001\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u76f8\u4e0e\u200b\uff0c16 \u200b\u662f\u200b 10000\n                        // \u200b\u5224\u65ad\u200b\u5bf9\u5e94\u200b\u7684\u200b 1 \u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\u662f\u200b 0 \u200b\u6216\u200b 1 \u200b\u5206\u6210\u200b\u9ad8\u4f4e\u200b\u4f4d\u200b\u94fe\u8868\u200b\n                        int runBit = fh &amp; n;\n                        Node&lt;K,V&gt; lastRun = f;\n                        // \u200b\u904d\u5386\u200b\u94fe\u8868\u200b\uff0c\u200b\u5bfb\u627e\u200b\u3010\u200b\u9006\u5e8f\u200b\u770b\u200b\u3011\u200b\u6700\u957f\u200b\u7684\u200b\u5bf9\u5e94\u200b\u4f4d\u200b\u76f8\u540c\u200b\u7684\u200b\u94fe\u8868\u200b\uff0c\u200b\u770b\u200b\u4e0b\u9762\u200b\u7684\u200b\u56fe\u200b\u66f4\u597d\u200b\u7684\u200b\u7406\u89e3\u200b\n                        for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) {\n                            // \u200b\u5c06\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u54c8\u5e0c\u200b \u200b\u4e0e\u200b n\n                            int b = p.hash &amp; n;\n                            // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u503c\u200b\u4e0e\u200b\u524d\u9762\u200b\u8282\u70b9\u200b\u7684\u200b\u503c\u200b \u200b\u5bf9\u5e94\u200b\u4f4d\u200b \u200b\u4e0d\u540c\u200b\uff0c\u200b\u5219\u200b\u4fee\u6539\u200b runBit\uff0c\u200b\u628a\u200b lastRun \u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\n                            if (b != runBit) {\n                                runBit = b;\n                                lastRun = p;\n                            }\n                        }\n                        // \u200b\u5224\u65ad\u200b\u7b5b\u9009\u200b\u51fa\u200b\u7684\u200b\u94fe\u8868\u200b\u662f\u200b\u4f4e\u4f4d\u200b\u7684\u200b\u8fd8\u662f\u200b\u9ad8\u4f4d\u200b\u7684\u200b\n                        if (runBit == 0) {\n                            ln = lastRun; // ln \u200b\u6307\u5411\u200b\u8be5\u200b\u94fe\u8868\u200b\n                            hn = null;        // hn \u200b\u4e3a\u200b null\n                        }\n                        // \u200b\u8bf4\u660e\u200b lastRun \u200b\u5f15\u7528\u200b\u7684\u200b\u94fe\u8868\u200b\u4e3a\u200b\u9ad8\u4f4d\u200b\u94fe\u8868\u200b\uff0c\u200b\u5c31\u8ba9\u200b hn \u200b\u6307\u5411\u200b\u9ad8\u4f4d\u200b\u94fe\u8868\u200b\u5934\u200b\u8282\u70b9\u200b\n                        else {\n                            hn = lastRun;\n                            ln = null;\n                        }\n                        // \u200b\u4ece\u5934\u5f00\u59cb\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u7684\u200b\u94fe\u8868\u200b\u8282\u70b9\u200b\uff0c\u200b\u8fed\u4ee3\u200b\u5230\u200b p == lastRun \u200b\u8282\u70b9\u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\n                        for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) {\n                            int ph = p.hash; K pk = p.key; V pv = p.val;\n                            if ((ph &amp; n) == 0)\n                                // \u3010\u200b\u5934\u200b\u63d2\u6cd5\u200b\u3011\uff0c\u200b\u4ece\u53f3\u200b\u5f80\u200b\u5de6\u200b\u770b\u200b\uff0c\u200b\u9996\u5148\u200b ln \u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\n                                // \u200b\u6240\u4ee5\u200b\u8fd9\u6b21\u200b\u65b0\u5efa\u200b\u7684\u200b\u8282\u70b9\u200b\u7684\u200b next \u200b\u6307\u5411\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b ln \u200b\u7684\u200b\u5f15\u7528\u200b\n                                ln = new Node&lt;K,V&gt;(ph, pk, pv, ln);\n                            else\n                                hn = new Node&lt;K,V&gt;(ph, pk, pv, hn);\n                        }\n                        // \u200b\u9ad8\u4f4e\u200b\u4f4d\u94fe\u200b\u8bbe\u7f6e\u200b\u5230\u200b\u65b0\u8868\u4e2d\u200b\u7684\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\n                        setTabAt(nextTab, i, ln);\n                        setTabAt(nextTab, i + n, hn);\n                        // \u200b\u8001\u8868\u200b\u4e2d\u200b\u7684\u200b\u8be5\u200b\u6876\u200b\u4f4d\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b fwd \u200b\u8282\u70b9\u200b\n                        setTabAt(tab, i, fwd);\n                        advance = true;\n                    }\n                    // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u662f\u200b \u200b\u7ea2\u9ed1\u6811\u200b\u7ed3\u70b9\u200b\n                    else if (f instanceof TreeBin) {\n                        TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;\n                        TreeNode&lt;K,V&gt; lo = null, loTail = null;\n                        TreeNode&lt;K,V&gt; hi = null, hiTail = null;\n                        int lc = 0, hc = 0;\n                        // \u200b\u8fed\u4ee3\u200b TreeBin \u200b\u4e2d\u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4ece\u5934\u200b\u7ed3\u70b9\u200b\u81f3\u5c3e\u200b\u8282\u70b9\u200b\n                        for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) {\n                            // \u200b\u8fed\u4ee3\u200b\u7684\u200b\u5f53\u524d\u200b\u5143\u7d20\u200b\u7684\u200b hash\n                            int h = e.hash;\n                            TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;\n                                (h, e.key, e.val, null, null);\n                            // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u5faa\u73af\u200b\u8282\u70b9\u200b\u5c5e\u4e8e\u200b\u4f4e\u4f4d\u200b\u94fe\u200b\u8282\u70b9\u200b\n                            if ((h &amp; n) == 0) {\n                                if ((p.prev = loTail) == null)\n                                    lo = p;\n                                else\n                                    //\u3010\u200b\u5c3e\u200b\u63d2\u6cd5\u200b\u3011\n                                    loTail.next = p;\n                                // loTail \u200b\u6307\u5411\u200b\u5c3e\u200b\u8282\u70b9\u200b\n                                loTail = p;\n                                ++lc;\n                            }\n                            else {\n                                if ((p.prev = hiTail) == null)\n                                    hi = p;\n                                else\n                                    hiTail.next = p;\n                                hiTail = p;\n                                ++hc;\n                            }\n                        }\n                        // \u200b\u62c6\u6210\u200b\u7684\u200b\u9ad8\u4f4d\u200b\u4f4e\u4f4d\u200b\u4e24\u4e2a\u200b\u94fe\u200b\uff0c\u3010\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u9700\u8981\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u94fe\u8868\u200b\u3011\uff0c\u200b\u53cd\u4e4b\u200b\u4fdd\u6301\u200b\u6811\u5316\u200b\n                        ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :\n                        (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t;\n                        hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :\n                        (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t;\n                        setTabAt(nextTab, i, ln);\n                        setTabAt(nextTab, i + n, hn);\n                        setTabAt(tab, i, fwd);\n                        advance = true;\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre> <p>\u200b\u94fe\u8868\u200b\u5904\u7406\u200b\u7684\u200b LastRun \u200b\u673a\u5236\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u8282\u70b9\u200b\u7684\u200b\u521b\u5efa\u200b</p> <p></p> <ul> <li>helpTransfer()\uff1a\u200b\u5e2e\u52a9\u200b\u6269\u5bb9\u200b\u673a\u5236\u200b</li> </ul> Java<pre><code>final Node&lt;K,V&gt;[] helpTransfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt; f) {\n    Node&lt;K,V&gt;[] nextTab; int sc;\n    // \u200b\u6570\u7ec4\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u8282\u70b9\u200b\u662f\u200b\u8f6c\u53d1\u200b\u8282\u70b9\u200b\uff0c\u200b\u83b7\u53d6\u200b\u8f6c\u53d1\u200b\u8282\u70b9\u200b\u6307\u5411\u200b\u7684\u200b\u65b0\u8868\u200b\u5f00\u59cb\u200b\u534f\u52a9\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u6269\u5bb9\u200b\n    if (tab != null &amp;&amp; (f instanceof ForwardingNode) &amp;&amp;\n        (nextTab = ((ForwardingNode&lt;K,V&gt;)f).nextTable) != null) {\n        // \u200b\u6269\u5bb9\u200b\u6807\u8bc6\u200b\u6233\u200b\n        int rs = resizeStamp(tab.length);\n        // \u200b\u5224\u65ad\u200b\u6570\u636e\u200b\u8fc1\u79fb\u200b\u662f\u5426\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fc1\u79fb\u200b\u5b8c\u6210\u200b\u4f1a\u200b\u628a\u200b \u200b\u65b0\u8868\u200b\u8d4b\u503c\u200b\u7ed9\u200b nextTable \u200b\u5c5e\u6027\u200b\n        while (nextTab == nextTable &amp;&amp; table == tab &amp;&amp; (sc = sizeCtl) &lt; 0) {\n            if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||\n                sc == rs + MAX_RESIZERS || transferIndex &lt;= 0)\n                break;\n            // \u200b\u8bbe\u7f6e\u200b\u6269\u5bb9\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b + 1\n            if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) {\n                // \u200b\u534f\u52a9\u200b\u6269\u5bb9\u200b\n                transfer(tab, nextTab);\n                break;\n            }\n        }\n        return nextTab;\n    }\n    return table;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_194","title":"\u83b7\u53d6\u200b\u65b9\u6cd5","text":"<p>ConcurrentHashMap \u200b\u4f7f\u7528\u200b get() \u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u6307\u5b9a\u200b key \u200b\u7684\u200b\u6570\u636e\u200b</p> <ul> <li>get()\uff1a\u200b\u83b7\u53d6\u200b\u6307\u5b9a\u200b\u6570\u636e\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>public V get(Object key) {\n    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek;\n    // \u200b\u6270\u52a8\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u83b7\u53d6\u200b key \u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b\n    int h = spread(key.hashCode());\n    // \u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u54c8\u5e0c\u200b\u8868\u200b\u7684\u200b\u6570\u7ec4\u200b\u662f\u5426\u200b\u521d\u59cb\u5316\u200b\n    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;\n        // \u200b\u5982\u679c\u200b table \u200b\u5df2\u7ecf\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u8fdb\u884c\u200b\u3010\u200b\u54c8\u5e0c\u200b\u5bfb\u5740\u200b\u3011\uff0c\u200b\u6620\u5c04\u200b\u5230\u200b\u6570\u7ec4\u200b\u5bf9\u5e94\u200b\u7d22\u5f15\u200b\u5904\u200b\uff0c\u200b\u83b7\u53d6\u200b\u8be5\u200b\u7d22\u5f15\u200b\u5904\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\n        (e = tabAt(tab, (n - 1) &amp; h)) != null) {\n        // \u200b\u5bf9\u6bd4\u200b\u5934\u200b\u7ed3\u70b9\u200b hash \u200b\u4e0e\u200b\u67e5\u8be2\u200b key \u200b\u7684\u200b hash \u200b\u662f\u5426\u200b\u4e00\u81f4\u200b\n        if ((eh = e.hash) == h) {\n            // \u200b\u8fdb\u884c\u200b\u503c\u200b\u7684\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b\u6210\u529f\u200b\u5c31\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5c31\u662f\u200b\u8981\u200b\u67e5\u8be2\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\n            if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))\n                return e.val;\n        }\n        // \u200b\u5f53\u524d\u200b\u69fd\u200b\u4f4d\u200b\u7684\u200b\u3010\u200b\u54c8\u5e0c\u200b\u503c\u200b\u5c0f\u4e8e\u200b0\u3011\u200b\u8bf4\u660e\u200b\u662f\u200b\u7ea2\u200b\u9ed1\u6811\u200b\u8282\u70b9\u200b\u6216\u8005\u200b\u662f\u200b\u6b63\u5728\u200b\u6269\u5bb9\u200b\u7684\u200b fwd \u200b\u8282\u70b9\u200b\n        else if (eh &lt; 0)\n            return (p = e.find(h, key)) != null ? p.val : null;\n        // \u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u662f\u200b\u3010\u200b\u94fe\u8868\u200b\u3011\uff0c\u200b\u5faa\u73af\u200b\u904d\u5386\u200b\u67e5\u627e\u200b\n        while ((e = e.next) != null) {\n            if (e.hash == h &amp;&amp;\n                ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))))\n                return e.val;\n        }\n    }\n    return null;\n}\n</code></pre> <ul> <li>ForwardingNode#find\uff1a\u200b\u8f6c\u79fb\u200b\u8282\u70b9\u200b\u7684\u200b\u67e5\u627e\u200b\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>Node&lt;K,V&gt; find(int h, Object k) {\n    // \u200b\u83b7\u53d6\u200b\u65b0\u8868\u200b\u7684\u200b\u5f15\u7528\u200b\n    outer: for (Node&lt;K,V&gt;[] tab = nextTable;;)  {\n        // e \u200b\u8868\u793a\u200b\u5728\u200b\u6269\u5bb9\u200b\u800c\u200b\u521b\u5efa\u200b\u65b0\u8868\u200b\u4f7f\u7528\u200b\u5bfb\u5740\u200b\u7b97\u6cd5\u200b\u5f97\u5230\u200b\u7684\u200b\u6876\u200b\u4f4d\u5934\u200b\u7ed3\u70b9\u200b\uff0cn \u200b\u8868\u793a\u200b\u4e3a\u200b\u6269\u5bb9\u200b\u800c\u200b\u521b\u5efa\u200b\u7684\u200b\u65b0\u8868\u200b\u7684\u200b\u957f\u5ea6\u200b\n        Node&lt;K,V&gt; e; int n;\n\n        if (k == null || tab == null || (n = tab.length) == 0 ||\n            // \u200b\u5728\u200b\u65b0\u8868\u4e2d\u200b\u91cd\u65b0\u200b\u5b9a\u4f4d\u200b hash \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8868\u793a\u200b\u5728\u200b oldTable \u200b\u4e2d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6876\u200b\u4f4d\u200b\u5728\u200b\u8fc1\u79fb\u200b\u4e4b\u524d\u200b\u5c31\u662f\u200b null\n            (e = tabAt(tab, (n - 1) &amp; h)) == null)\n            return null;\n\n        for (;;) {\n            int eh; K ek;\n            // \u3010\u200b\u54c8\u5e0c\u200b\u76f8\u540c\u200b\u503c\u200b\u4e5f\u200b\u76f8\u540c\u200b\u3011\uff0c\u200b\u8868\u793a\u200b\u65b0\u8868\u200b\u5f53\u524d\u200b\u547d\u4e2d\u200b\u6876\u200b\u4f4d\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5373\u200b\u4e3a\u200b\u67e5\u8be2\u200b\u60f3\u8981\u200b\u6570\u636e\u200b\n            if ((eh = e.hash) == h &amp;&amp; ((ek = e.key) == k || (ek != null &amp;&amp; k.equals(ek))))\n                return e;\n\n            // eh &lt; 0 \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u65b0\u8868\u4e2d\u200b\u8be5\u200b\u7d22\u5f15\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\u662f\u200b TreeBin \u200b\u7c7b\u578b\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b FWD \u200b\u7c7b\u578b\u200b\n            if (eh &lt; 0) {\n                // \u200b\u5728\u200b\u5e76\u53d1\u200b\u5f88\u5927\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u65b0\u200b\u6269\u5bb9\u200b\u7684\u200b\u8868\u200b\u8fd8\u200b\u6ca1\u200b\u5b8c\u6210\u200b\u53ef\u80fd\u200b\u3010\u200b\u518d\u6b21\u200b\u6269\u5bb9\u200b\u3011\uff0c\u200b\u5728\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5904\u200b\u518d\u6b21\u200b\u62ff\u5230\u200b FWD \u200b\u7c7b\u578b\u200b\n                if (e instanceof ForwardingNode) {\n                    // \u200b\u7ee7\u7eed\u200b\u83b7\u53d6\u200b\u65b0\u200b\u7684\u200b fwd \u200b\u6307\u5411\u200b\u7684\u200b\u65b0\u200b\u6570\u7ec4\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u9012\u5f52\u200b\u4e86\u200b\n                    tab = ((ForwardingNode&lt;K,V&gt;)e).nextTable;\n                    continue outer;\n                }\n                else\n                    // \u200b\u8bf4\u660e\u200b\u6b64\u6876\u200b\u4f4d\u4e3a\u200b TreeBin \u200b\u8282\u70b9\u200b\uff0c\u200b\u4f7f\u7528\u200bTreeBin.find \u200b\u67e5\u627e\u200b\u7ea2\u200b\u9ed1\u6811\u4e2d\u200b\u76f8\u5e94\u200b\u8282\u70b9\u200b\u3002\n                    return e.find(h, k);\n            }\n\n            // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u662f\u200b\u94fe\u8868\u200b\uff0c\u200b\u5c06\u200b\u5f53\u524d\u200b\u5143\u7d20\u200b\u6307\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u5143\u7d20\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u4f4d\u7f6e\u200b\u662f\u5426\u200b\u4e3a\u7a7a\u200b\n            if ((e = e.next) == null)\n                // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u8fed\u4ee3\u200b\u5230\u200b\u94fe\u8868\u200b\u672b\u5c3e\u200b\uff0c\u3010\u200b\u672a\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd4\u56de\u200b null\u3011\n                return null;\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_195","title":"\u5220\u9664\u200b\u65b9\u6cd5","text":"<ul> <li>remove()\uff1a\u200b\u5220\u9664\u200b\u6307\u5b9a\u200b\u5143\u7d20\u200b</li> </ul> Java<pre><code>public V remove(Object key) {\n    return replaceNode(key, null, null);\n}\n</code></pre> <ul> <li>replaceNode()\uff1a\u200b\u66ff\u4ee3\u200b\u6307\u5b9a\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u4f1a\u200b\u534f\u52a9\u200b\u6269\u5bb9\u200b\uff0c\u200b\u589e\u5220\u200b\u6539\u200b\uff08\u200b\u5199\u200b\uff09\u200b\u90fd\u200b\u4f1a\u200b\u534f\u52a9\u200b\u6269\u5bb9\u200b\uff0c\u200b\u67e5\u8be2\u200b\uff08\u200b\u8bfb\u200b\uff09\u200b\u64cd\u4f5c\u200b\u4e0d\u4f1a\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u52a0\u9501\u200b</li> </ul> Java<pre><code>final V replaceNode(Object key, V value, Object cv) {\n    // \u200b\u8ba1\u7b97\u200b key \u200b\u6270\u52a8\u200b\u8fd0\u7b97\u200b\u540e\u200b\u7684\u200b hash\n    int hash = spread(key.hashCode());\n    // \u200b\u5f00\u59cb\u200b\u81ea\u65cb\u200b\n    for (Node&lt;K,V&gt;[] tab = table;;) {\n        Node&lt;K,V&gt; f; int n, i, fh;\n\n        // \u3010CASE1\u3011\uff1atable \u200b\u8fd8\u200b\u672a\u200b\u521d\u59cb\u5316\u200b\u6216\u8005\u200b\u54c8\u5e0c\u200b\u5bfb\u5740\u200b\u7684\u200b\u6570\u7ec4\u200b\u7d22\u5f15\u200b\u5904\u4e3a\u200b null\uff0c\u200b\u76f4\u63a5\u200b\u7ed3\u675f\u200b\u81ea\u65cb\u200b\uff0c\u200b\u8fd4\u56de\u200b null\n        if (tab == null || (n = tab.length) == 0 || (f = tabAt(tab, i = (n - 1) &amp; hash)) == null)\n            break;\n        // \u3010CASE2\u3011\uff1a\u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b table \u200b\u6b63\u5728\u200b\u6269\u5bb9\u200b\uff0c\u3010\u200b\u5f53\u524d\u200b\u662f\u200b\u4e2a\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u534f\u52a9\u200b table \u200b\u5b8c\u6210\u200b\u6269\u5bb9\u200b\u3011\n        else if ((fh = f.hash) == MOVED)\n            tab = helpTransfer(tab, f);\n        // \u3010CASE3\u3011\uff1a\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u200b\u53ef\u80fd\u200b\u662f\u200b \u200b\u94fe\u8868\u200b \u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b \u200b\u7ea2\u9ed1\u6811\u200b \n        else {\n            // \u200b\u4fdd\u7559\u200b\u66ff\u6362\u200b\u4e4b\u524d\u200b\u6570\u636e\u200b\u5f15\u7528\u200b\n            V oldVal = null;\n            // \u200b\u6821\u9a8c\u200b\u6807\u8bb0\u200b\n            boolean validated = false;\n            // \u3010\u200b\u52a0\u9501\u200b\u5f53\u524d\u200b\u6876\u200b\u4f4d\u5934\u200b\u7ed3\u70b9\u200b\u3011\uff0c\u200b\u52a0\u9501\u200b\u6210\u529f\u200b\u4e4b\u540e\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u4ee3\u7801\u200b\u5757\u200b\n            synchronized (f) {\n                // \u200b\u53cc\u91cd\u200b\u68c0\u67e5\u200b\n                if (tabAt(tab, i) == f) {\n                    // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u94fe\u8868\u200b\u8282\u70b9\u200b\n                    if (fh &gt;= 0) {\n                        validated = true;\n                        //\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u7684\u200b\u8282\u70b9\u200b\n                        for (Node&lt;K,V&gt; e = f, pred = null;;) {\n                            K ek;\n                            // hash \u200b\u548c\u200b\u503c\u200b\u90fd\u200b\u76f8\u540c\u200b\uff0c\u200b\u5b9a\u4f4d\u200b\u5230\u200b\u4e86\u200b\u5177\u4f53\u200b\u7684\u200b\u8282\u70b9\u200b\n                            if (e.hash == hash &amp;&amp;\n                                ((ek = e.key) == key ||\n                                 (ek != null &amp;&amp; key.equals(ek)))) {\n                                // \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200bvalue\n                                V ev = e.val;\n                                if (cv == null || cv == ev ||\n                                    (ev != null &amp;&amp; cv.equals(ev))) {\n                                    // \u200b\u5c06\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u503c\u200b \u200b\u8d4b\u503c\u200b\u7ed9\u200b oldVal \u200b\u540e\u7eed\u200b\u8fd4\u56de\u200b\u4f1a\u200b\u7528\u5230\u200b\n                                    oldVal = ev;\n                                    if (value != null)        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u662f\u200b\u66ff\u6362\u200b\u64cd\u4f5c\u200b\n                                        e.val = value;    \n                                    else if (pred != null)    // \u200b\u975e\u5934\u200b\u8282\u70b9\u200b\u5220\u9664\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u65ad\u5f00\u200b\u94fe\u8868\u200b\n                                        pred.next = e.next;   \n                                    else\n                                        // \u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5373\u200b\u4e3a\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u5c06\u200b\u6876\u200b\u4f4d\u5934\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4ee5\u524d\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n                                        setTabAt(tab, i, e.next);\n                                }\n                                break;\n                            }\n                            pred = e;\n                            if ((e = e.next) == null)\n                                break;\n                        }\n                    }\n                    // \u200b\u8bf4\u660e\u200b\u662f\u200b\u7ea2\u200b\u9ed1\u6811\u200b\u8282\u70b9\u200b\n                    else if (f instanceof TreeBin) {\n                        validated = true;\n                        TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;\n                        TreeNode&lt;K,V&gt; r, p;\n                        if ((r = t.root) != null &amp;&amp;\n                            (p = r.findTreeNode(hash, key, null)) != null) {\n                            V pv = p.val;\n                            if (cv == null || cv == pv ||\n                                (pv != null &amp;&amp; cv.equals(pv))) {\n                                oldVal = pv;\n                                // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b\u66ff\u6362\u200b\u64cd\u4f5c\u200b\n                                if (value != null)\n                                    p.val = value;\n                                // \u200b\u5220\u9664\u200b\u64cd\u4f5c\u200b\n                                else if (t.removeTreeNode(p))\n                                    setTabAt(tab, i, untreeify(t.first));\n                            }\n                        }\n                    }\n                }\n            }\n            // \u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u8fc7\u6876\u200b\u4f4d\u5934\u200b\u7ed3\u70b9\u200b\u65f6\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b sync \u200b\u5934\u200b\u7ed3\u70b9\u200b\u9501\u9519\u200b\u5bf9\u8c61\u200b\uff0cvalidated \u200b\u4e3a\u200b false\uff0c\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u4e0b\u6b21\u200b for \u200b\u81ea\u65cb\u200b\n            if (validated) {\n                if (oldVal != null) {\n                    // \u200b\u66ff\u6362\u200b\u7684\u200b\u503c\u200b\u4e3a\u200b null\uff0c\u3010\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u662f\u200b\u4e00\u6b21\u200b\u5220\u9664\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u66f4\u65b0\u200b\u5f53\u524d\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\u8ba1\u6570\u5668\u200b\u3011\n                    if (value == null)\n                        addCount(-1L, -1);\n                    return oldVal;\n                }\n                break;\n            }\n        }\n    }\n    return null;\n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://space.bilibili.com/457326371/</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#jdk7","title":"JDK7\u200b\u539f\u7406","text":"<p>ConcurrentHashMap \u200b\u5bf9\u9501\u200b\u7c92\u5ea6\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4f18\u5316\u200b\uff0c\u200b\u5206\u6bb5\u200b\u9501\u200b\u6280\u672f\u200b\uff0c\u200b\u5c06\u200b\u6574\u5f20\u200b\u8868\u200b\u5206\u6210\u200b\u4e86\u200b\u591a\u4e2a\u200b\u6570\u7ec4\u200b\uff08Segment\uff09\uff0c\u200b\u6bcf\u4e2a\u200b\u6570\u7ec4\u200b\u53c8\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7c7b\u4f3c\u200b HashMap \u200b\u6570\u7ec4\u200b\u7684\u200b\u7ed3\u6784\u200b\u3002\u200b\u5141\u8bb8\u200b\u591a\u4e2a\u200b\u4fee\u6539\u200b\u64cd\u4f5c\u200b\u5e76\u53d1\u200b\u8fdb\u884c\u200b\uff0cSegment \u200b\u662f\u200b\u4e00\u79cd\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff0c\u200b\u7ee7\u627f\u200b ReentrantLock\uff0c\u200b\u5e76\u53d1\u200b\u65f6\u200b\u9501\u4f4f\u200b\u7684\u200b\u662f\u200b\u6bcf\u4e2a\u200b Segment\uff0c\u200b\u5176\u4ed6\u200b Segment \u200b\u8fd8\u662f\u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u7684\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e0d\u540c\u200b Segment \u200b\u4e4b\u95f4\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u5e76\u53d1\u200b\uff0c\u200b\u5927\u5927\u63d0\u9ad8\u200b\u6548\u7387\u200b\u3002</p> <p>\u200b\u5e95\u5c42\u200b\u7ed3\u6784\u200b\uff1a Segment \u200b\u6570\u7ec4\u200b + HashEntry \u200b\u6570\u7ec4\u200b + \u200b\u94fe\u8868\u200b\uff08\u200b\u6570\u7ec4\u200b + \u200b\u94fe\u8868\u200b\u662f\u200b HashMap \u200b\u7684\u200b\u7ed3\u6784\u200b\uff09</p> <ul> <li>\u200b\u4f18\u70b9\u200b\uff1a\u200b\u5982\u679c\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\u4e0d\u540c\u200b\u7684\u200b segment\uff0c\u200b\u5b9e\u9645\u200b\u662f\u200b\u6ca1\u6709\u200b\u51b2\u7a81\u200b\u7684\u200b\uff0c\u200b\u8fd9\u200b\u4e0e\u200b JDK8 \u200b\u4e2d\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b</li> <li>\u200b\u7f3a\u70b9\u200b\uff1aSegments \u200b\u6570\u7ec4\u200b\u9ed8\u8ba4\u200b\u5927\u5c0f\u200b\u4e3a\u200b16\uff0c\u200b\u8fd9\u4e2a\u200b\u5bb9\u91cf\u200b\u521d\u59cb\u5316\u200b\u6307\u5b9a\u200b\u540e\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u6539\u53d8\u200b\u4e86\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u662f\u200b\u61d2\u60f0\u200b\u521d\u59cb\u5316\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#copyonwrite","title":"CopyOnWrite","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_196","title":"\u539f\u7406\u200b\u5206\u6790","text":"<p>CopyOnWriteArrayList \u200b\u91c7\u7528\u200b\u4e86\u200b\u5199\u5165\u200b\u65f6\u200b\u62f7\u8d1d\u200b\u7684\u200b\u601d\u60f3\u200b\uff0c\u200b\u589e\u5220\u200b\u6539\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u5c06\u200b\u5e95\u5c42\u200b\u6570\u7ec4\u200b\u62f7\u8d1d\u200b\u4e00\u4efd\u200b\uff0c\u200b\u5728\u200b\u65b0\u200b\u6570\u7ec4\u200b\u4e0a\u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u5176\u5b83\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5e76\u53d1\u200b\u8bfb\u200b\uff0c\u200b\u8bfb\u5199\u200b\u5206\u79bb\u200b</p> <p>CopyOnWriteArraySet \u200b\u5e95\u5c42\u200b\u5bf9\u200b CopyOnWriteArrayList \u200b\u8fdb\u884c\u200b\u4e86\u200b\u5305\u88c5\u200b\uff0c\u200b\u88c5\u9970\u200b\u5668\u200b\u6a21\u5f0f\u200b</p> Java<pre><code>public CopyOnWriteArraySet() {\n    al = new CopyOnWriteArrayList&lt;E&gt;();\n}\n</code></pre> <ul> <li>\u200b\u5b58\u50a8\u200b\u7ed3\u6784\u200b\uff1a</li> </ul> Java<pre><code>private transient volatile Object[] array;    // volatile \u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u8bfb\u5199\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b\n</code></pre> <ul> <li>\u200b\u5168\u5c40\u200b\u9501\u200b\uff1a\u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\u5b89\u5168\u200b</li> </ul> Java<pre><code>final transient ReentrantLock lock = new ReentrantLock();\n</code></pre> <ul> <li>\u200b\u65b0\u589e\u200b\u6570\u636e\u200b\uff1a\u200b\u9700\u8981\u200b\u52a0\u9501\u200b\uff0c\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u6570\u7ec4\u200b\u64cd\u4f5c\u200b</li> </ul> Java<pre><code>public boolean add(E e) {\n    final ReentrantLock lock = this.lock;\n    // \u200b\u52a0\u9501\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\n    lock.lock();\n    try {\n        // \u200b\u83b7\u53d6\u200b\u65e7\u200b\u7684\u200b\u6570\u7ec4\u200b\n        Object[] elements = getArray();\n        int len = elements.length;\n        // \u3010\u200b\u62f7\u8d1d\u200b\u65b0\u200b\u7684\u200b\u6570\u7ec4\u200b\uff08\u200b\u8fd9\u91cc\u200b\u662f\u200b\u6bd4\u8f83\u200b\u8017\u65f6\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u5176\u5b83\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\uff09\u3011\n        Object[] newElements = Arrays.copyOf(elements, len + 1);\n        // \u200b\u6dfb\u52a0\u200b\u65b0\u5143\u7d20\u200b\n        newElements[len] = e;\n        // \u200b\u66ff\u6362\u200b\u65e7\u200b\u7684\u200b\u6570\u7ec4\u200b\uff0c\u3010\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u6570\u7ec4\u200b\u5c31\u662f\u200b\u83b7\u53d6\u200b\u7684\u200b\u65b0\u200b\u6570\u7ec4\u200b\u4e86\u200b\u3011\n        setArray(newElements);\n        return true;\n    } finally {\n        lock.unlock();\n    }\n}\n</code></pre> <ul> <li>\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff1a\u200b\u4e0d\u200b\u52a0\u9501\u200b\uff0c\u200b\u5728\u200b\u539f\u200b\u6570\u7ec4\u200b\u4e0a\u200b\u64cd\u4f5c\u200b</li> </ul> Java<pre><code>public E get(int index) {\n    return get(getArray(), index);\n}\nprivate E get(Object[] a, int index) {\n    return (E) a[index];\n}\n</code></pre> <p>\u200b\u9002\u5408\u200b\u8bfb\u591a\u200b\u5199\u5c11\u200b\u7684\u200b\u5e94\u7528\u200b\u573a\u666f\u200b</p> <ul> <li>\u200b\u8fed\u4ee3\u200b\u5668\u200b\uff1aCopyOnWriteArrayList \u200b\u5728\u200b\u8fd4\u56de\u200b\u8fed\u4ee3\u200b\u5668\u65f6\u200b\uff0c\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5185\u90e8\u200b\u6570\u7ec4\u200b\u5f53\u524d\u200b\u7684\u200b\u5feb\u7167\u200b\uff08\u200b\u5f15\u7528\u200b\uff09\uff0c\u200b\u5373\u4f7f\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u66ff\u6362\u200b\u4e86\u200b\u539f\u59cb\u200b\u6570\u7ec4\u200b\uff0c\u200b\u8fed\u4ee3\u200b\u5668\u200b\u904d\u5386\u200b\u7684\u200b\u5feb\u7167\u200b\u4f9d\u7136\u200b\u5f15\u7528\u200b\u7684\u200b\u662f\u200b\u521b\u5efa\u200b\u5feb\u7167\u200b\u65f6\u200b\u7684\u200b\u6570\u7ec4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u79cd\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u4e5f\u200b\u5b58\u5728\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6570\u636e\u200b\u5ef6\u8fdf\u200b\u6027\u200b\uff0c\u200b\u5bf9\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5e76\u884c\u200b\u6dfb\u52a0\u200b\u7684\u200b\u6570\u636e\u200b\u4e0d\u200b\u53ef\u89c1\u200b</li> </ul> Java<pre><code>public Iterator&lt;E&gt; iterator() {\n    // \u200b\u83b7\u53d6\u200b\u5230\u200b\u6570\u7ec4\u200b\u5f15\u7528\u200b\uff0c\u200b\u6574\u4e2a\u200b\u904d\u5386\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u8be5\u200b\u6570\u7ec4\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u53d8\u200b\uff0c\u200b\u4e00\u76f4\u200b\u5f15\u7528\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u8001\u200b\u6570\u7ec4\u200b\uff0c\n    return new COWIterator&lt;E&gt;(getArray(), 0);\n}\n\n// \u200b\u8fed\u4ee3\u200b\u5668\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5e95\u5c42\u200barray\u200b\u7684\u200b\u5feb\u7167\u200b\uff0c\u200b\u6545\u4e3b\u200b\u7c7b\u200b\u7684\u200b\u4fee\u6539\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u8be5\u200b\u5feb\u7167\u200b\nstatic final class COWIterator&lt;E&gt; implements ListIterator&lt;E&gt; {\n    // \u200b\u5185\u90e8\u200b\u6570\u7ec4\u200b\u5feb\u7167\u200b\n    private final Object[] snapshot;\n\n    private COWIterator(Object[] elements, int initialCursor) {\n        cursor = initialCursor;\n        // \u200b\u6570\u7ec4\u200b\u7684\u200b\u5f15\u7528\u200b\u5728\u200b\u8fed\u4ee3\u200b\u8fc7\u7a0b\u200b\u4e0d\u4f1a\u200b\u6539\u53d8\u200b\n        snapshot = elements;\n    }\n    // \u3010\u200b\u4e0d\u200b\u652f\u6301\u200b\u5199\u200b\u64cd\u4f5c\u200b\u3011\uff0c\u200b\u56e0\u4e3a\u200b\u662f\u200b\u5728\u200b\u5feb\u7167\u200b\u4e0a\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u540c\u6b65\u200b\u56de\u53bb\u200b\n    public void remove() {\n        throw new UnsupportedOperationException();\n    } \n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_197","title":"\u5f31\u200b\u4e00\u81f4\u6027","text":"<p>\u200b\u6570\u636e\u200b\u4e00\u81f4\u6027\u200b\u5c31\u662f\u200b\u8bfb\u200b\u5230\u200b\u6700\u65b0\u66f4\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\uff1a</p> <ul> <li>\u200b\u5f3a\u200b\u4e00\u81f4\u6027\u200b\uff1a\u200b\u5f53\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4efb\u4f55\u200b\u591a\u4e2a\u200b\u540e\u7eed\u200b\u8fdb\u7a0b\u200b\u6216\u8005\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8bbf\u95ee\u200b\u90fd\u200b\u4f1a\u200b\u8fd4\u56de\u200b\u6700\u65b0\u200b\u7684\u200b\u66f4\u65b0\u200b\u8fc7\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5f31\u200b\u4e00\u81f4\u6027\u200b\uff1a\u200b\u7cfb\u7edf\u200b\u5e76\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u8fdb\u7a0b\u200b\u6216\u8005\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8bbf\u95ee\u200b\u90fd\u200b\u4f1a\u200b\u8fd4\u56de\u200b\u6700\u65b0\u200b\u7684\u200b\u66f4\u65b0\u200b\u8fc7\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u627f\u8bfa\u200b\u591a\u4e45\u200b\u4e4b\u540e\u200b\u53ef\u4ee5\u200b\u8bfb\u200b\u5230\u200b</li> </ul> <p></p> \u200b\u65f6\u95f4\u200b\u70b9\u200b \u200b\u64cd\u4f5c\u200b 1 Thread-0 getArray() 2 Thread-1 getArray() 3 Thread-1 setArray(arrayCopy) 4 Thread-0 array[index] <p>Thread-0 \u200b\u8bfb\u5230\u200b\u4e86\u200b\u810f\u200b\u6570\u636e\u200b</p> <p>\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u5f31\u200b\u4e00\u81f4\u6027\u200b\u5c31\u200b\u4e0d\u597d\u200b</p> <ul> <li>\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u4e8b\u52a1\u200b\u9694\u79bb\u200b\u7ea7\u522b\u200b\u5c31\u662f\u200b\u5f31\u200b\u4e00\u81f4\u6027\u200b\u7684\u200b\u8868\u73b0\u200b</li> <li>\u200b\u5e76\u53d1\u200b\u9ad8\u200b\u548c\u200b\u4e00\u81f4\u6027\u200b\u662f\u200b\u77db\u76fe\u200b\u7684\u200b\uff0c\u200b\u9700\u8981\u200b\u6743\u8861\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_198","title":"\u5b89\u5168\u200b\u5931\u8d25","text":"<p>\u200b\u5728\u200b java.util \u200b\u5305\u200b\u7684\u200b\u96c6\u5408\u200b\u7c7b\u200b\u5c31\u200b\u90fd\u200b\u662f\u200b\u5feb\u901f\u200b\u5931\u8d25\u200b\u7684\u200b\uff0c\u200b\u800c\u200b java.util.concurrent \u200b\u5305\u4e0b\u200b\u7684\u200b\u7c7b\u200b\u90fd\u200b\u662f\u200b\u5b89\u5168\u200b\u5931\u8d25\u200b</p> <ul> <li>\u200b\u5feb\u901f\u200b\u5931\u8d25\u200b\uff1a\u200b\u5728\u200b A \u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u8fed\u4ee3\u200b\u5668\u200b\u5bf9\u200b\u96c6\u5408\u200b\u8fdb\u884c\u200b\u904d\u5386\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b B \u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u96c6\u5408\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff08\u200b\u589e\u5220\u200b\u6539\u200b\uff09\uff0c\u200b\u6216\u8005\u200b A \u200b\u7ebf\u7a0b\u200b\u5728\u200b\u904d\u5386\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5bf9\u200b\u96c6\u5408\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b A \u200b\u7ebf\u7a0b\u200b\u629b\u51fa\u200b ConcurrentModificationException \u200b\u5f02\u5e38\u200b</li> <li>AbstractList \u200b\u7c7b\u4e2d\u200b\u7684\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b modCount\uff0c\u200b\u7528\u6765\u200b\u8bb0\u5f55\u200b List \u200b\u7ed3\u6784\u200b\u53d1\u751f\u53d8\u5316\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u7ed3\u6784\u200b\u53d1\u751f\u53d8\u5316\u200b\u662f\u200b\u6307\u200b\u6dfb\u52a0\u200b\u6216\u8005\u200b\u5220\u9664\u200b\u81f3\u5c11\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b\u8c03\u6574\u200b\u5185\u90e8\u200b\u6570\u7ec4\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4ec5\u4ec5\u200b\u8bbe\u7f6e\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u4e0d\u7b97\u200b\u7ed3\u6784\u200b\u53d1\u751f\u53d8\u5316\u200b</li> <li> <p>\u200b\u5728\u200b\u8fdb\u884c\u200b\u5e8f\u5217\u5316\u200b\u6216\u8005\u200b\u8fed\u4ee3\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u6bd4\u8f83\u200b\u64cd\u4f5c\u200b\u524d\u540e\u200b modCount \u200b\u662f\u5426\u200b\u6539\u53d8\u200b\uff0c\u200b\u5982\u679c\u200b\u6539\u53d8\u200b\u4e86\u200b\u629b\u51fa\u200b CME \u200b\u5f02\u5e38\u200b</p> </li> <li> <p>\u200b\u5b89\u5168\u200b\u5931\u8d25\u200b\uff1a\u200b\u91c7\u7528\u200b\u5b89\u5168\u200b\u5931\u8d25\u200b\u673a\u5236\u200b\u7684\u200b\u96c6\u5408\u200b\u5bb9\u5668\u200b\uff0c\u200b\u5728\u200b\u8fed\u4ee3\u200b\u5668\u904d\u200b\u5386\u65f6\u200b\u76f4\u63a5\u200b\u5728\u200b\u539f\u200b\u96c6\u5408\u200b\u6570\u7ec4\u200b\u5185\u5bb9\u200b\u4e0a\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4f46\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u589e\u5220\u200b\u6539\u90fd\u4f1a\u200b\u65b0\u5efa\u200b\u6570\u7ec4\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff0c\u200b\u5c31\u7b97\u200b\u4fee\u6539\u200b\u4e86\u200b\u96c6\u5408\u200b\u5e95\u5c42\u200b\u7684\u200b\u6570\u7ec4\u200b\u5bb9\u5668\u200b\uff0c\u200b\u8fed\u4ee3\u200b\u5668\u200b\u4f9d\u7136\u200b\u5f15\u7528\u200b\u7740\u200b\u4ee5\u524d\u200b\u7684\u200b\u6570\u7ec4\u200b\uff08\u200b\u5feb\u7167\u200b\u601d\u60f3\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u5f02\u5e38\u200b</p> </li> </ul> <p>ConcurrentHashMap \u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u5e76\u53d1\u200b\u65f6\u200b\u7684\u200b\u8fed\u4ee3\u200b\u5f02\u5e38\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5728\u200b\u8fed\u4ee3\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b CHM \u200b\u7684\u200b\u8fed\u4ee3\u200b\u5668\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5224\u65ad\u200b\u7ed3\u6784\u200b\u7684\u200b\u53d8\u5316\u200b\uff0c\u200b\u8fed\u4ee3\u200b\u5668\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u8fed\u4ee3\u200b\u7684\u200b\u8282\u70b9\u200b\u72b6\u6001\u200b\u53bb\u200b\u5bfb\u627e\u200b\u5e76\u53d1\u200b\u6269\u5bb9\u200b\u65f6\u200b\u7684\u200b\u65b0\u8868\u200b\u8fdb\u884c\u200b\u8fed\u4ee3\u200b</p> Java<pre><code>ConcurrentHashMap map = new ConcurrentHashMap();\n// KeyIterator\nIterator iterator = map.keySet().iterator();\n</code></pre> Java<pre><code> Traverser(Node&lt;K,V&gt;[] tab, int size, int index, int limit) {\n     // \u200b\u5f15\u7528\u200b\u8fd8\u662f\u200b\u539f\u6765\u200b\u96c6\u5408\u200b\u7684\u200b Node \u200b\u6570\u7ec4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u6570\u636e\u200b\u7684\u200b\u4fee\u6539\u200b\u662f\u200b\u53ef\u89c1\u200b\u7684\u200b\n     this.tab = tab;\n     this.baseSize = size;\n     this.baseIndex = this.index = index;\n     this.baseLimit = limit;\n     this.next = null;\n }\n</code></pre> Java<pre><code>public final boolean hasNext() { return next != null; }\npublic final K next() {\n    Node&lt;K,V&gt; p;\n    if ((p = next) == null)\n        throw new NoSuchElementException();\n    K k = p.key;\n    lastReturned = p;\n    // \u200b\u5728\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u7684\u200b\u83b7\u53d6\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u69fd\u200b\u4f4d\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u5224\u65ad\u200b\n    advance();\n    return k;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#collections","title":"Collections","text":"<p>Collections\u200b\u7c7b\u200b\u662f\u200b\u7528\u6765\u200b\u64cd\u4f5c\u200b\u96c6\u5408\u200b\u7684\u200b\u5de5\u5177\u200b\u7c7b\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u96c6\u5408\u200b\u8f6c\u6362\u6210\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code> public static &lt;T&gt; Collection&lt;T&gt; synchronizedCollection(Collection&lt;T&gt; c) {\n     return new SynchronizedCollection&lt;&gt;(c);\n }\npublic static &lt;K,V&gt; Map&lt;K,V&gt; synchronizedMap(Map&lt;K,V&gt; m) {\n    return new SynchronizedMap&lt;&gt;(m);\n}\n</code></pre> <p>\u200b\u6e90\u7801\u200b\uff1a\u200b\u5e95\u5c42\u200b\u4e5f\u200b\u662f\u200b\u5bf9\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u52a0\u9501\u200b</p> Java<pre><code>public boolean add(E e) {\n    synchronized (mutex) {return c.add(e);}\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#skiplistmap","title":"SkipListMap","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_199","title":"\u5e95\u5c42\u200b\u7ed3\u6784","text":"<p>\u200b\u8df3\u8868\u200b SkipList \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6709\u5e8f\u200b\u7684\u200b\u94fe\u8868\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u5347\u5e8f\u200b\uff0c\u200b\u5e95\u5c42\u200b\u662f\u200b\u94fe\u8868\u200b\u52a0\u200b\u591a\u7ea7\u200b\u7d22\u5f15\u200b\u7684\u200b\u7ed3\u6784\u200b\u3002\u200b\u8df3\u8868\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5143\u7d20\u200b\u8fdb\u884c\u200b\u5feb\u901f\u200b\u67e5\u8be2\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u5e73\u8861\u200b\u6811\u200b\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u5229\u7528\u200b\u7a7a\u95f4\u200b\u6362\u200b\u65f6\u95f4\u200b\u7684\u200b\u7b97\u6cd5\u200b</p> <p>\u200b\u5bf9\u4e8e\u200b\u5355\u94fe\u200b\u8868\u200b\uff0c\u200b\u5373\u4f7f\u200b\u94fe\u8868\u200b\u662f\u200b\u6709\u5e8f\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u67e5\u627e\u200b\u6570\u636e\u200b\u4e5f\u200b\u53ea\u80fd\u200b\u4ece\u5934\u5230\u5c3e\u200b\u904d\u5386\u200b\u94fe\u8868\u200b\uff0c\u200b\u6240\u4ee5\u200b\u91c7\u7528\u200b\u94fe\u8868\u200b\u4e0a\u5efa\u200b\u7d22\u5f15\u200b\u7684\u200b\u65b9\u5f0f\u200b\u63d0\u9ad8\u6548\u7387\u200b\uff0c\u200b\u8df3\u8868\u200b\u7684\u200b\u67e5\u8be2\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b O(logn)\uff0c\u200b\u7a7a\u95f4\u200b\u590d\u6742\u5ea6\u200b O(n)</p> <p>ConcurrentSkipListMap \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u79cd\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u5e76\u53d1\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6392\u5e8f\u200b\u6620\u5c04\u200b\u8868\u200b\uff0c\u200b\u5185\u90e8\u200b\u662f\u200b\u8df3\u8868\u200b\u7ed3\u6784\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u901a\u8fc7\u200b CAS + volatile \u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b</p> <p>\u200b\u5e73\u8861\u200b\u6811\u200b\u548c\u200b\u8df3\u8868\u200b\u7684\u200b\u533a\u522b\u200b\uff1a</p> <ul> <li>\u200b\u5bf9\u200b\u5e73\u8861\u200b\u6811\u200b\u7684\u200b\u63d2\u5165\u200b\u548c\u200b\u5220\u9664\u200b\u5f80\u5f80\u200b\u5f88\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u5e73\u8861\u200b\u6811\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u5168\u5c40\u200b\u7684\u200b\u8c03\u6574\u200b\uff1b\u200b\u800c\u200b\u5bf9\u200b\u8df3\u8868\u200b\u7684\u200b\u63d2\u5165\u200b\u548c\u200b\u5220\u9664\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5bf9\u200b\u6574\u4e2a\u200b\u7ed3\u6784\u200b\u7684\u200b\u5c40\u90e8\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u5728\u200b\u9ad8\u200b\u5e76\u53d1\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6574\u4e2a\u200b\u5e73\u8861\u200b\u6811\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u5168\u5c40\u200b\u9501\u200b\uff1b\u200b\u5bf9\u4e8e\u200b\u8df3\u8868\u200b\u5219\u200b\u53ea\u200b\u9700\u8981\u200b\u90e8\u5206\u200b\u9501\u200b\uff0c\u200b\u62e5\u6709\u200b\u66f4\u597d\u200b\u7684\u200b\u6027\u80fd\u200b</li> </ul> <p></p> <p>BaseHeader \u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\uff0cheadIndex \u200b\u5b58\u50a8\u200b\u7d22\u5f15\u200b\uff0c\u200b\u7eb5\u5411\u200b\u4e0a\u200b\u6240\u6709\u200b\u7d22\u5f15\u200b\u90fd\u200b\u6307\u5411\u200b\u94fe\u8868\u200b\u6700\u200b\u4e0b\u9762\u200b\u7684\u200b\u8282\u70b9\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_200","title":"\u6210\u5458\u200b\u53d8\u91cf","text":"<ul> <li>\u200b\u6807\u8bc6\u200b\u7d22\u5f15\u200b\u5934\u200b\u8282\u70b9\u200b\u4f4d\u7f6e\u200b</li> </ul> Java<pre><code>private static final Object BASE_HEADER = new Object();\n</code></pre> <ul> <li>\u200b\u8df3\u8868\u200b\u7684\u200b\u9876\u5c42\u200b\u7d22\u5f15\u200b</li> </ul> Java<pre><code>private transient volatile HeadIndex&lt;K,V&gt; head;\n</code></pre> <ul> <li>\u200b\u6bd4\u8f83\u200b\u5668\u200b\uff0c\u200b\u4e3a\u200b null \u200b\u5219\u200b\u4f7f\u7528\u200b\u81ea\u7136\u200b\u6392\u5e8f\u200b</li> </ul> Java<pre><code>final Comparator&lt;? super K&gt; comparator;\n</code></pre> <ul> <li>Node \u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>static final class Node&lt;K, V&gt;{\n    final K key;                  // key \u200b\u662f\u200b final \u200b\u7684\u200b, \u200b\u8bf4\u660e\u200b\u8282\u70b9\u200b\u4e00\u65e6\u200b\u5b9a\u200b\u4e0b\u6765\u200b, \u200b\u9664\u4e86\u200b\u5220\u9664\u200b, \u200b\u4e00\u822c\u200b\u4e0d\u4f1a\u200b\u6539\u52a8\u200b key\n    volatile Object value;        // \u200b\u5bf9\u5e94\u200b\u7684\u200b value\n    volatile Node&lt;K, V&gt; next;     // \u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\n}\n</code></pre> <ul> <li>\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b Index\uff0c\u200b\u53ea\u6709\u200b\u5411\u4e0b\u200b\u548c\u200b\u5411\u200b\u53f3\u200b\u7684\u200b\u6307\u9488\u200b</li> </ul> Java<pre><code>static class Index&lt;K, V&gt;{\n    final Node&lt;K, V&gt; node;        // \u200b\u7d22\u5f15\u200b\u6307\u5411\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u90fd\u200b\u4f1a\u200b\u6307\u5411\u200b\u6570\u636e\u200b\u8282\u70b9\u200b\n    final Index&lt;K, V&gt; down;   // \u200b\u4e0b\u8fb9\u200blevel\u200b\u5c42\u200b\u7684\u200bIndex\uff0c\u200b\u5206\u5c42\u200b\u7d22\u5f15\u200b\n    volatile Index&lt;K, V&gt; right; // \u200b\u53f3\u8fb9\u200b\u7684\u200bIndex\uff0c\u200b\u5355\u5411\u200b\n\n    // \u200b\u5728\u200b index \u200b\u672c\u8eab\u200b\u548c\u200b succ \u200b\u4e4b\u95f4\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u8282\u70b9\u200b newSucc\n    final boolean link(Index&lt;K, V&gt; succ, Index&lt;K, V&gt; newSucc){\n        Node&lt;K, V&gt; n = node;\n        newSucc.right = succ;\n        // \u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u53f3\u200b\u6307\u9488\u200b\u4ece\u200b succ \u200b\u6539\u4e3a\u200b newSucc\n        return n.value != null &amp;&amp; casRight(succ, newSucc);\n    }\n\n    // \u200b\u65ad\u5f00\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u548c\u200b succ \u200b\u8282\u70b9\u200b\uff0c\u200b\u5c06\u200b\u5f53\u524d\u200b\u7684\u200b\u8282\u70b9\u200b index \u200b\u8bbe\u7f6e\u200b\u5176\u200b\u7684\u200b right \u200b\u4e3a\u200b succ.right\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b succ \u200b\u5220\u9664\u200b\n    final boolean unlink(Index&lt;K, V&gt; succ){\n        return node.value != null &amp;&amp; casRight(succ, succ.right);\n    }\n}\n</code></pre> <ul> <li>\u200b\u5934\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b HeadIndex</li> </ul> Java<pre><code>static final class HeadIndex&lt;K,V&gt; extends Index&lt;K,V&gt; {\n    final int level;  // \u200b\u8868\u793a\u200b\u7d22\u5f15\u200b\u5c42\u7ea7\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b HeadIndex \u200b\u90fd\u200b\u6307\u5411\u200b\u540c\u4e00\u4e2a\u200b Base_header \u200b\u8282\u70b9\u200b\n    HeadIndex(Node&lt;K,V&gt; node, Index&lt;K,V&gt; down, Index&lt;K,V&gt; right, int level) {\n        super(node, down, right);\n        this.level = level;\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_201","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_202","title":"\u5176\u4ed6\u200b\u65b9\u6cd5","text":"<ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>public ConcurrentSkipListMap() {\n    this.comparator = null;   // comparator \u200b\u4e3a\u200b null\uff0c\u200b\u4f7f\u7528\u200b key \u200b\u7684\u200b\u81ea\u7136\u200b\u5e8f\u200b\uff0c\u200b\u5982\u200b\u5b57\u5178\u200b\u5e8f\u200b\n    initialize();\n}\n</code></pre> Java<pre><code>private void initialize() {\n    keySet = null;\n    entrySet = null;\n    values = null;\n    descendingMap = null;\n    // \u200b\u521d\u59cb\u5316\u200b\u7d22\u5f15\u200b\u5934\u200b\u8282\u70b9\u200b\uff0cNode \u200b\u7684\u200b key \u200b\u4e3a\u200b null\uff0cvalue \u200b\u4e3a\u200b BASE_HEADER \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u4e3a\u200b null\n    // head \u200b\u7684\u200b\u5206\u5c42\u200b\u7d22\u5f15\u200b down \u200b\u4e3a\u200b null\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u540e\u7eed\u200b\u7d22\u5f15\u200b right \u200b\u4e3a\u200b null\uff0c\u200b\u5c42\u7ea7\u200b level \u200b\u4e3a\u200b\u7b2c\u200b 1 \u200b\u5c42\u200b\n    head = new HeadIndex&lt;K,V&gt;(new Node&lt;K,V&gt;(null, BASE_HEADER, null), null, null, 1);\n}\n</code></pre> <ul> <li>cpr\uff1a\u200b\u6392\u5e8f\u200b</li> </ul> Java<pre><code>//\u3000x \u200b\u662f\u200b\u6bd4\u8f83\u200b\u8005\u200b\uff0cy \u200b\u662f\u200b\u88ab\u200b\u6bd4\u8f83\u200b\u8005\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u8005\u200b\u5927\u4e8e\u200b\u88ab\u200b\u6bd4\u8f83\u200b\u8005\u200b \u200b\u8fd4\u56de\u200b\u6b63\u6570\u200b\uff0c\u200b\u5c0f\u4e8e\u200b\u8fd4\u56de\u200b\u8d1f\u6570\u200b\uff0c\u200b\u76f8\u7b49\u200b\u8fd4\u56de\u200b 0\nstatic final int cpr(Comparator c, Object x, Object y) {\n    return (c != null) ? c.compare(x, y) : ((Comparable)x).compareTo(y);\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_203","title":"\u6dfb\u52a0\u200b\u65b9\u6cd5","text":"<ul> <li>findPredecessor()\uff1a\u200b\u5bfb\u627e\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b</li> </ul> <p>\u200b\u4ece\u200b\u6700\u4e0a\u5c42\u200b\u7684\u200b\u5934\u200b\u7d22\u5f15\u200b\u5f00\u59cb\u200b\u5411\u200b\u53f3\u200b\u67e5\u627e\u200b\uff08\u200b\u94fe\u8868\u200b\u7684\u200b\u540e\u7eed\u200b\u7d22\u5f15\u200b\uff09\uff0c\u200b\u5982\u679c\u200b\u540e\u7eed\u200b\u7d22\u5f15\u200b\u7684\u200b\u8282\u70b9\u200b\u7684\u200b key \u200b\u5927\u4e8e\u200b\u8981\u200b\u67e5\u627e\u200b\u7684\u200b key\uff0c\u200b\u5219\u200b\u5934\u200b\u7d22\u5f15\u200b\u79fb\u200b\u5230\u200b\u4e0b\u5c42\u200b\u94fe\u8868\u200b\uff0c\u200b\u5728\u200b\u4e0b\u5c42\u200b\u94fe\u8868\u200b\u67e5\u627e\u200b\uff0c\u200b\u4ee5\u6b64\u200b\u53cd\u590d\u200b\uff0c\u200b\u4e00\u76f4\u200b\u67e5\u627e\u200b\u5230\u200b\u6ca1\u6709\u200b\u4e0b\u5c42\u200b\u7684\u200b\u5206\u5c42\u200b\u7d22\u5f15\u200b\u4e3a\u6b62\u200b\uff0c\u200b\u8fd4\u56de\u200b\u8be5\u200b\u7d22\u5f15\u200b\u7684\u200b\u8282\u70b9\u200b\u3002\u200b\u5982\u679c\u200b\u540e\u7eed\u200b\u7d22\u5f15\u200b\u7684\u200b\u8282\u70b9\u200b\u7684\u200b key \u200b\u5c0f\u4e8e\u200b\u8981\u200b\u67e5\u627e\u200b\u7684\u200b key\uff0c\u200b\u5219\u200b\u5728\u200b\u8be5\u5c42\u200b\u94fe\u8868\u200b\u4e2d\u5411\u200b\u540e\u200b\u67e5\u627e\u200b\u3002\u200b\u7531\u4e8e\u200b\u67e5\u627e\u200b\u7684\u200b key \u200b\u53ef\u80fd\u200b\u6c38\u8fdc\u200b\u5927\u4e8e\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b\u7684\u200b key\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u80fd\u200b\u627e\u5230\u200b\u76ee\u6807\u200b\u7684\u200b\u524d\u7f6e\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b\u3002\u200b\u5982\u679c\u200b\u9047\u5230\u200b\u7a7a\u503c\u200b\u7d22\u5f15\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u901a\u8fc7\u200b CAS \u200b\u6765\u200b\u65ad\u5f00\u200b\u7d22\u5f15\u200b</p> Java<pre><code>private Node&lt;K,V&gt; findPredecessor(Object key, Comparator&lt;? super K&gt; cmp) {\n    if (key == null)\n        throw new NullPointerException(); // don't postpone errors\n    for (;;) {\n        // 1.\u200b\u521d\u59cb\u200b\u6570\u636e\u200b q \u200b\u662f\u200b head\uff0cr \u200b\u662f\u200b\u6700\u200b\u9876\u5c42\u200b h \u200b\u7684\u200b\u53f3\u200b Index \u200b\u8282\u70b9\u200b\n        for (Index&lt;K,V&gt; q = head, r = q.right, d;;) {\n            // 2.\u200b\u53f3\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u5219\u200b\u8fdb\u884c\u200b\u5411\u4e0b\u200b\u67e5\u627e\u200b\n            if (r != null) {\n                Node&lt;K,V&gt; n = r.node;\n                K k = n.key;\n                // 3.n.value \u200b\u4e3a\u200b null \u200b\u8bf4\u660e\u200b\u8282\u70b9\u200b n \u200b\u6b63\u5728\u200b\u5220\u9664\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u3010\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5e2e\u5176\u200b\u5220\u9664\u200b\u7d22\u5f15\u200b\u3011\n                if (n.value == null) {\n                    // \u200b\u5728\u200b index \u200b\u5c42\u200b\u76f4\u63a5\u200b\u5220\u9664\u200b r \u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b\n                    if (!q.unlink(r))\n                        // \u200b\u5220\u9664\u200b\u5931\u8d25\u200b\u91cd\u65b0\u200b\u4ece\u200b head \u200b\u8282\u70b9\u200b\u5f00\u59cb\u67e5\u627e\u200b\uff0cbreak \u200b\u4e00\u4e2a\u200b for \u200b\u5230\u200b\u6b65\u9aa4\u200b 1\uff0c\u200b\u53c8\u200b\u4ece\u200b\u521d\u59cb\u503c\u200b\u5f00\u59cb\u200b\n                        break;\n\n                    // \u200b\u5220\u9664\u200b\u8282\u70b9\u200b r \u200b\u6210\u529f\u200b\uff0c\u200b\u83b7\u53d6\u200b\u65b0\u200b\u7684\u200b r \u200b\u8282\u70b9\u200b,\n                    r = q.right;\n                    // \u200b\u56de\u5230\u200b\u6b65\u9aa4\u200b 2\uff0c\u200b\u8fd8\u662f\u200b\u4ece\u200b\u8fd9\u5c42\u200b\u7d22\u5f15\u200b\u5f00\u59cb\u200b\u5411\u200b\u53f3\u200b\u904d\u5386\u200b\n                    continue;\n                }\n                // 4.\u200b\u82e5\u200b\u53c2\u6570\u200b key &gt; r.node.key\uff0c\u200b\u5219\u200b\u7ee7\u7eed\u200b\u5411\u200b\u53f3\u200b\u904d\u5386\u200b, continue \u200b\u5230\u200b\u6b65\u9aa4\u200b 2 \u200b\u5904\u200b\u83b7\u53d6\u200b\u53f3\u200b\u8282\u70b9\u200b\n                //   \u200b\u82e5\u200b\u53c2\u6570\u200b key &lt; r.node.key\uff0c\u200b\u8bf4\u660e\u200b\u9700\u8981\u200b\u8fdb\u5165\u200b\u4e0b\u5c42\u200b\u7d22\u5f15\u200b\uff0c\u200b\u5230\u200b\u6b65\u9aa4\u200b 5\n                if (cpr(cmp, key, k) &gt; 0) {\n                    q = r;\n                    r = r.right;\n                    continue;\n                }\n            }\n            // 5.\u200b\u5148\u200b\u8ba9\u200b d \u200b\u6307\u5411\u200b q \u200b\u7684\u200b\u4e0b\u200b\u4e00\u5c42\u200b\uff0c\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b null\uff0c\u200b\u662f\u200b\u5219\u200b\u8bf4\u660e\u200b\u5df2\u7ecf\u200b\u5230\u200b\u4e86\u200b\u6570\u636e\u200b\u5c42\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u7b2c\u4e00\u5c42\u200b\n            if ((d = q.down) == null) \n                return q.node;\n            // 6.\u200b\u672a\u5230\u200b\u6570\u636e\u200b\u5c42\u200b, \u200b\u8fdb\u884c\u200b\u91cd\u65b0\u200b\u8d4b\u503c\u200b\u5411\u4e0b\u200b\u626b\u63cf\u200b\n            q = d;        // q \u200b\u6307\u5411\u200b d\n            r = d.right;// r \u200b\u6307\u5411\u200b q \u200b\u7684\u200b\u540e\u7eed\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b\uff0c\u200b\u6b64\u65f6\u200b(q.key &lt; key &lt; r.key)\n        }\n    }\n}\n</code></pre> <p></p> <ul> <li>put()\uff1a\u200b\u6dfb\u52a0\u200b\u6570\u636e\u200b</li> </ul> Java<pre><code>public V put(K key, V value) {\n    // \u200b\u975e\u7a7a\u200b\u5224\u65ad\u200b\uff0cvalue\u200b\u4e0d\u80fd\u200b\u4e3a\u7a7a\u200b\n    if (value == null)\n        throw new NullPointerException();\n    return doPut(key, value, false);\n}\n</code></pre> Java<pre><code>private V doPut(K key, V value, boolean onlyIfAbsent) {\n    Node&lt;K,V&gt; z;\n    // \u200b\u975e\u7a7a\u200b\u5224\u65ad\u200b\uff0ckey \u200b\u4e0d\u80fd\u200b\u4e3a\u7a7a\u200b\n    if (key == null)\n        throw new NullPointerException();\n    Comparator&lt;? super K&gt; cmp = comparator;\n    // outer \u200b\u5faa\u73af\u200b\uff0c\u3010\u200b\u628a\u200b\u5f85\u200b\u63d2\u5165\u200b\u6570\u636e\u200b\u63d2\u5165\u200b\u5230\u200b\u6570\u636e\u200b\u5c42\u200b\u7684\u200b\u5408\u9002\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u626b\u63cf\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5904\u7406\u200b\u5df2\u200b\u5220\u9664\u200b(value = null)\u200b\u7684\u200b\u6570\u636e\u200b\u3011\n    outer: for (;;) {\n        //0.for (;;)\n        //1.\u200b\u5c06\u200b key \u200b\u5bf9\u5e94\u200b\u7684\u200b\u524d\u200b\u7ee7\u200b\u8282\u70b9\u200b\u627e\u5230\u200b, b \u200b\u4e3a\u200b\u524d\u200b\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u200b\u662f\u200b\u6570\u636e\u200b\u5c42\u200b\u7684\u200b, n \u200b\u662f\u200b\u524d\u200b\u7ee7\u200b\u8282\u70b9\u200b\u7684\u200b next, \n      //  \u200b\u82e5\u200b\u6ca1\u200b\u53d1\u751f\u200b\u6761\u4ef6\u200b\u7ade\u4e89\u200b\uff0c\u200b\u6700\u7ec8\u200b key \u200b\u5728\u200b b \u200b\u4e0e\u200b n \u200b\u4e4b\u95f4\u200b (\u200b\u627e\u5230\u200b\u7684\u200b b \u200b\u5728\u200b base_level \u200b\u4e0a\u200b)\n        for (Node&lt;K,V&gt; b = findPredecessor(key, cmp), n = b.next;;) {\n            // 2.n \u200b\u4e0d\u200b\u4e3a\u200b null \u200b\u8bf4\u660e\u200b b \u200b\u4e0d\u662f\u200b\u94fe\u8868\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n            if (n != null) {\n                Object v; int c;\n                // 3.\u200b\u83b7\u53d6\u200b n \u200b\u7684\u200b\u53f3\u200b\u8282\u70b9\u200b\n                Node&lt;K,V&gt; f = n.next;\n                // 4.\u200b\u6761\u4ef6\u200b\u7ade\u4e89\u200b\uff0c\u200b\u5e76\u53d1\u200b\u4e0b\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5728\u200b b \u200b\u4e4b\u540e\u200b\u63d2\u5165\u200b\u8282\u70b9\u200b\u6216\u200b\u76f4\u63a5\u200b\u5220\u9664\u200b\u8282\u70b9\u200b n, break \u200b\u5230\u200b\u6b65\u9aa4\u200b 0\n                if (n != b.next)              \n                    break;\n                //  \u200b\u82e5\u200b\u8282\u70b9\u200b n \u200b\u5df2\u7ecf\u200b\u5220\u9664\u200b, \u200b\u5219\u200b\u8c03\u7528\u200b helpDelete \u200b\u8fdb\u884c\u200b\u3010\u200b\u5e2e\u52a9\u200b\u5220\u9664\u200b\u8282\u70b9\u200b\u3011\n                if ((v = n.value) == null) {\n                    n.helpDelete(b, f);\n                    break;\n                }\n                // 5.\u200b\u8282\u70b9\u200b b \u200b\u88ab\u200b\u5220\u9664\u200b\u4e2d\u200b\uff0c\u200b\u5219\u200b break \u200b\u5230\u200b\u6b65\u9aa4\u200b 0,\n              //  \u3010\u200b\u8c03\u7528\u200bfindPredecessor\u200b\u5e2e\u52a9\u200b\u5220\u9664\u200bindex\u200b\u5c42\u200b\u7684\u200b\u6570\u636e\u200b, node\u200b\u5c42\u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u901a\u8fc7\u200bhelpDelete\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u5220\u9664\u200b\u3011\n                if (b.value == null || v == n) \n                    break;\n                // 6.\u200b\u82e5\u200b key &gt; n.key\uff0c\u200b\u5219\u200b\u8fdb\u884c\u200b\u5411\u200b\u540e\u200b\u626b\u63cf\u200b\n                //   \u200b\u82e5\u200b key &lt; n.key\uff0c\u200b\u5219\u200b\u8bc1\u660e\u200b key \u200b\u5e94\u8be5\u200b\u5b58\u50a8\u200b\u5728\u200b b \u200b\u548c\u200b n \u200b\u4e4b\u95f4\u200b\n                if ((c = cpr(cmp, key, n.key)) &gt; 0) {\n                    b = n;\n                    n = f;\n                    continue;\n                }\n                // 7.key \u200b\u7684\u200b\u503c\u200b\u548c\u200b n.key \u200b\u76f8\u7b49\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8986\u76d6\u200b\u8d4b\u503c\u200b\n                if (c == 0) {\n                    // onlyIfAbsent \u200b\u9ed8\u8ba4\u200b false\uff0c\n                    if (onlyIfAbsent || n.casValue(v, value)) {\n                        @SuppressWarnings(\"unchecked\") V vv = (V)v;\n                        // \u200b\u8fd4\u56de\u200b\u88ab\u200b\u8986\u76d6\u200b\u7684\u200b\u503c\u200b\n                        return vv;\n                    }\n                    // cas\u200b\u5931\u8d25\u200b\uff0cbreak \u200b\u4e00\u5c42\u200b\u5faa\u73af\u200b\uff0c\u200b\u8fd4\u56de\u200b 0 \u200b\u91cd\u8bd5\u200b\n                    break;\n                }\n                // else c &lt; 0; fall through\n            }\n            // 8.\u200b\u6b64\u65f6\u200b\u7684\u200b\u60c5\u51b5\u200b b.key &lt; key &lt; n.key\uff0c\u200b\u5bf9\u5e94\u200b\u6d41\u7a0b\u56fe\u200b1\u200b\u4e2d\u200b\u7684\u200b7\uff0c\u200b\u521b\u5efa\u200bz\u200b\u8282\u70b9\u200b\u6307\u5411\u200bn\n            z = new Node&lt;K,V&gt;(key, value, n);\n            // 9.\u200b\u5c1d\u8bd5\u200b\u628a\u200b b.next \u200b\u4ece\u200b n \u200b\u8bbe\u7f6e\u200b\u6210\u200b z\n            if (!b.casNext(n, z))\n                // cas\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5230\u200b\u6b65\u9aa4\u200b0\uff0c\u200b\u91cd\u8bd5\u200b\n                break;\n            // 10.break outer \u200b\u540e\u200b, \u200b\u4e0a\u9762\u200b\u7684\u200b for \u200b\u5faa\u73af\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u6267\u884c\u200b, \u200b\u800c\u540e\u200b\u6267\u884c\u200b\u4e0b\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\n            break outer;\n        }\n    }\n  // \u3010\u200b\u4ee5\u4e0a\u200b\u63d2\u5165\u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u4efb\u52a1\u200b\u8981\u200b\u6839\u636e\u200b\u968f\u673a\u6570\u200b\u7684\u200b\u503c\u6765\u200b\u8868\u793a\u200b\u662f\u5426\u200b\u5411\u4e0a\u200b\u589e\u52a0\u200b\u5c42\u6570\u200b\u4e0e\u200b\u4e0a\u5c42\u200b\u7d22\u5f15\u200b\u3011\n\n    // \u200b\u968f\u673a\u6570\u200b\n    int rnd = ThreadLocalRandom.nextSecondarySeed();\n\n    // \u200b\u5982\u679c\u200b\u968f\u673a\u6570\u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u4e0e\u200b 10000000000000000000000000000001 \u200b\u8fdb\u884c\u200b\u4e0e\u200b\u8fd0\u7b97\u200b\u4e3a\u200b 0\n    // \u200b\u5373\u200b\u968f\u673a\u6570\u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u6700\u9ad8\u200b\u4f4d\u200b\u4e0e\u200b\u6700\u200b\u672b\u5c3e\u200b\u5fc5\u987b\u200b\u4e3a\u200b 0\uff0c\u200b\u5176\u4ed6\u200b\u4f4d\u200b\u65e0\u6240\u8c13\u200b\uff0c\u200b\u5c31\u200b\u8fdb\u5165\u200b\u8be5\u200b\u5faa\u73af\u200b\n    // \u200b\u5982\u679c\u200b\u968f\u673a\u6570\u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u6700\u9ad8\u200b\u4f4d\u200b\u4e0e\u200b\u6700\u200b\u672b\u4f4d\u200b\u4e0d\u200b\u4e3a\u200b 0\uff0c\u200b\u4e0d\u200b\u589e\u52a0\u200b\u65b0\u200b\u8282\u70b9\u200b\u7684\u200b\u5c42\u6570\u200b\n\n    // 11.\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b level\uff0c32 \u200b\u4f4d\u200b\n    if ((rnd &amp; 0x80000001) == 0) {\n        // \u200b\u7d22\u5f15\u200b\u5c42\u200b level\uff0c\u200b\u4ece\u200b 1 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u5c31\u662f\u200b\u6700\u5e95\u5c42\u200b\n        int level = 1, max;\n        // 12.\u200b\u5224\u65ad\u200b\u6700\u4f4e\u200b\u4f4d\u200b\u524d\u9762\u200b\u6709\u200b\u51e0\u4e2a\u200b 1\uff0c\u200b\u6709\u200b\u51e0\u4e2a\u200bleve\u200b\u5c31\u52a0\u200b\u51e0\u200b\uff1a0..0 0001 1110\uff0c\u200b\u8fd9\u662f\u200b4\u200b\u4e2a\u200b\uff0c\u200b\u5219\u200b1+4=5\n        //    \u3010\u200b\u6700\u5927\u200b\u6709\u200b30\u200b\u4e2a\u200b\u5c31\u662f\u200b 1 + 30 = 31\n        while (((rnd &gt;&gt;&gt;= 1) &amp; 1) != 0)\n            ++level;\n        // \u200b\u6700\u7ec8\u200b\u4f1a\u200b\u6307\u5411\u200b z \u200b\u8282\u70b9\u200b\uff0c\u200b\u5c31\u662f\u200b\u6dfb\u52a0\u200b\u7684\u200b\u8282\u70b9\u200b \n        Index&lt;K,V&gt; idx = null;\n        // \u200b\u6307\u5411\u200b\u5934\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b\n        HeadIndex&lt;K,V&gt; h = head;\n\n        // 13.\u200b\u5224\u65ad\u200blevel\u200b\u662f\u5426\u200b\u6bd4\u200b\u5f53\u524d\u200b\u6700\u9ad8\u200b\u7d22\u5f15\u200b\u5c0f\u200b\uff0c\u200b\u56fe\u4e2d\u200b max \u200b\u4e3a\u200b 3\n        if (level &lt;= (max = h.level)) {\n            for (int i = 1; i &lt;= level; ++i)\n                // \u200b\u6839\u636e\u200b\u5c42\u6570\u200blevel\u200b\u4e0d\u65ad\u200b\u521b\u5efa\u200b\u65b0\u589e\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0a\u5c42\u200b\u7d22\u5f15\u200b\uff0c\u200b\u7d22\u5f15\u200b\u7684\u200b\u540e\u7ee7\u200b\u7d22\u5f15\u200b\u7559\u7a7a\u200b\n                // \u200b\u7b2c\u4e00\u6b21\u200bidx\u200b\u4e3a\u200bnull\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0b\u5c42\u200b\u7d22\u5f15\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u7b2c\u4e8c\u6b21\u200b\u628a\u200b\u4e0a\u6b21\u200b\u7684\u200b\u7d22\u5f15\u200b\u4f5c\u4e3a\u200b\u4e0b\u5c42\u200b\u7d22\u5f15\u200b\uff0c\u3010\u200b\u7c7b\u4f3c\u200b\u5934\u200b\u63d2\u6cd5\u200b\u3011\n                idx = new Index&lt;K,V&gt;(z, idx, null);\n            // \u200b\u5faa\u73af\u200b\u4ee5\u540e\u200b\u7684\u200b\u7d22\u5f15\u200b\u7ed3\u6784\u200b\n            // index-3    \u2190 idx\n            //   \u2193\n            // index-2\n            //   \u2193\n            // index-1\n            //   \u2193\n            //  z-node\n        }\n        // 14.\u200b\u82e5\u200b level &gt; max\uff0c\u200b\u5219\u200b\u3010\u200b\u53ea\u200b\u589e\u52a0\u200b\u4e00\u5c42\u200b index \u200b\u7d22\u5f15\u200b\u5c42\u200b\u3011\uff0c3 + 1 = 4\n        else { \n            level = max + 1;\n            //\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b index \u200b\u6570\u7ec4\u200b\uff0c\u200b\u957f\u5ea6\u200b\u662f\u200b level+1\uff0c\u200b\u5047\u8bbe\u200b level \u200b\u662f\u200b 4\uff0c\u200b\u521b\u5efa\u200b\u7684\u200b\u6570\u7ec4\u200b\u957f\u5ea6\u200b\u4e3a\u200b 5\n            Index&lt;K,V&gt;[] idxs = (Index&lt;K,V&gt;[])new Index&lt;?,?&gt;[level+1];\n            // index[0]\u200b\u7684\u200b\u6570\u7ec4\u200b slot \u200b\u5e76\u200b\u6ca1\u6709\u200b\u4f7f\u7528\u200b\uff0c\u200b\u53ea\u200b\u4f7f\u7528\u200b [1,level] \u200b\u8fd9\u4e9b\u200b\u6570\u7ec4\u200b\u7684\u200b slot\n            for (int i = 1; i &lt;= level; ++i)\n                idxs[i] = idx = new Index&lt;K,V&gt;(z, idx, null);\n                      // index-4   \u2190 idx\n                    //   \u2193\n                      // ......\n                    //   \u2193\n                    // index-1\n                    //   \u2193\n                    //  z-node\n\n            for (;;) {\n                h = head;\n                // \u200b\u83b7\u53d6\u200b\u5934\u200b\u7d22\u5f15\u200b\u7684\u200b\u5c42\u6570\u200b\uff0c3\n                int oldLevel = h.level;\n                // \u200b\u5982\u679c\u200b level &lt;= oldLevel\uff0c\u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u4e86\u200b index \u200b\u5c42\u200b\u589e\u52a0\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u9000\u51fa\u200b\u5faa\u73af\u200b\n                if (level &lt;= oldLevel)\n                    break;\n                // \u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u5934\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b\n                HeadIndex&lt;K,V&gt; newh = h;\n                // \u200b\u83b7\u53d6\u200b\u5934\u200b\u7d22\u5f15\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u5c31\u662f\u200b BASE_HEADER\n                Node&lt;K,V&gt; oldbase = h.node;\n                // \u200b\u5347\u7ea7\u200b baseHeader \u200b\u7d22\u5f15\u200b\uff0c\u200b\u5347\u9ad8\u200b\u4e00\u7ea7\u200b\uff0c\u200b\u5e76\u53d1\u200b\u4e0b\u200b\u53ef\u80fd\u200b\u5347\u9ad8\u200b\u591a\u7ea7\u200b\n                for (int j = oldLevel + 1; j &lt;= level; ++j)\n                    // \u200b\u53c2\u6570\u200b1\uff1a\u200b\u5e95\u5c42\u200bnode\uff0c\u200b\u53c2\u6570\u200b\u4e8c\u200b\uff1adown\uff0c\u200b\u4e3a\u200b\u4ee5\u524d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\uff0c\u200b\u53c2\u6570\u200b\u4e09\u200b\uff1aright\uff0c\u200b\u65b0\u5efa\u200b\n                    newh = new HeadIndex&lt;K,V&gt;(oldbase, newh, idxs[j], j);\n                // \u200b\u6267\u884c\u200b\u5b8c\u200bfor\u200b\u5faa\u73af\u200b\u4e4b\u540e\u200b\uff0cbaseHeader \u200b\u7d22\u5f15\u200b\u957f\u200b\u8fd9\u4e2a\u200b\u6837\u5b50\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u53ea\u200b\u5347\u9ad8\u200b\u4e00\u7ea7\u200b\n                // index-4             \u2192             index-4  \u2190 idx\n                //   \u2193                                  \u2193\n                // index-3                           index-3     \n                //   \u2193                                  \u2193\n                // index-2                           index-2\n                //   \u2193                                  \u2193\n                // index-1                           index-1\n                //   \u2193                                  \u2193\n                // baseHeader    \u2192    ....      \u2192     z-node\n\n                // cas \u200b\u6210\u529f\u200b\u540e\u200b\uff0chead \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b\u6700\u65b0\u200b\u7684\u200b headIndex\uff0cbaseHeader \u200b\u7684\u200b index-4\n                if (casHead(h, newh)) {\n                    // h \u200b\u6307\u5411\u200b\u6700\u65b0\u200b\u7684\u200b index-4 \u200b\u8282\u70b9\u200b\n                    h = newh;\n                    // \u200b\u8ba9\u200b idx \u200b\u6307\u5411\u200b z-node \u200b\u7684\u200b index-3 \u200b\u8282\u70b9\u200b\uff0c\n                  // \u200b\u56e0\u4e3a\u200b\u4ece\u200b index-3 - index-1 \u200b\u7684\u200b\u8fd9\u4e9b\u200b z-node \u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b \u200b\u90fd\u200b\u6ca1\u6709\u200b\u63d2\u5165\u200b\u5230\u200b\u7d22\u5f15\u200b\u94fe\u8868\u200b\n                    idx = idxs[level = oldLevel];\n                    break;\n                }\n            }\n        }\n        // 15.\u3010\u200b\u628a\u200b\u65b0\u52a0\u200b\u7684\u200b\u7d22\u5f15\u200b\u63d2\u5165\u200b\u7d22\u5f15\u200b\u94fe\u8868\u200b\u4e2d\u200b\u3011\uff0c\u200b\u6709\u200b\u4e0a\u8ff0\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e00\u79cd\u200b\u7d22\u5f15\u200b\u9ad8\u5ea6\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u53e6\u200b\u4e00\u79cd\u200b\u662f\u200b\u9ad8\u5ea6\u200b\u52a0\u200b 1\n        // \u200b\u8981\u200b\u63d2\u5165\u200b\u7684\u200b\u662f\u200b\u7b2c\u51e0\u5c42\u200b\u7684\u200b\u7d22\u5f15\u200b\n        splice: for (int insertionLevel = level;;) {\n            // \u200b\u83b7\u53d6\u200b\u5934\u200b\u7d22\u5f15\u200b\u7684\u200b\u5c42\u6570\u200b\uff0c\u200b\u60c5\u51b5\u200b 1 \u200b\u662f\u200b 3\uff0c\u200b\u60c5\u51b5\u200b 2 \u200b\u662f\u200b 4\n            int j = h.level;\n            // \u3010\u200b\u904d\u5386\u200b insertionLevel \u200b\u5c42\u200b\u7684\u200b\u7d22\u5f15\u200b\uff0c\u200b\u627e\u5230\u200b\u5408\u9002\u200b\u7684\u200b\u63d2\u5165\u200b\u4f4d\u7f6e\u200b\u3011\n            for (Index&lt;K,V&gt; q = h, r = q.right, t = idx;;) {\n                // \u200b\u5982\u679c\u200b\u5934\u200b\u7d22\u5f15\u200b\u4e3a\u200b null \u200b\u6216\u8005\u200b\u65b0\u589e\u200b\u8282\u70b9\u200b\u7d22\u5f15\u200b\u4e3a\u200b null\uff0c\u200b\u9000\u51fa\u200b\u63d2\u5165\u200b\u7d22\u5f15\u200b\u7684\u200b\u603b\u200b\u5faa\u73af\u200b\n                if (q == null || t == null)\n                    // \u200b\u6b64\u5904\u200b\u8868\u793a\u200b\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5220\u9664\u200b\u4e86\u200b\u5934\u200b\u7d22\u5f15\u200b\u6216\u8005\u200b\u65b0\u589e\u200b\u8282\u70b9\u200b\u7684\u200b\u7d22\u5f15\u200b\n                    break splice;\n                // \u200b\u5934\u200b\u7d22\u5f15\u200b\u7684\u200b\u94fe\u8868\u200b\u540e\u7eed\u200b\u7d22\u5f15\u200b\u5b58\u5728\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u65b0\u5c42\u200b\u5219\u200b\u4e3a\u200b\u65b0\u200b\u8282\u70b9\u200b\u7d22\u5f15\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u8001\u5c42\u200b\u5219\u200b\u4e3a\u200b\u539f\u200b\u7d22\u5f15\u200b\n                if (r != null) {\n                    // \u200b\u83b7\u53d6\u200br\u200b\u7684\u200b\u8282\u70b9\u200b\n                    Node&lt;K,V&gt; n = r.node;\n                    // \u200b\u63d2\u5165\u200b\u7684\u200bkey\u200b\u548c\u200bn.key\u200b\u7684\u200b\u6bd4\u8f83\u200b\u503c\u200b\n                    int c = cpr(cmp, key, n.key);\n                    // \u3010\u200b\u5220\u9664\u200b\u7a7a\u503c\u200b\u7d22\u5f15\u200b\u3011\n                    if (n.value == null) {\n                        if (!q.unlink(r))\n                            break;\n                        r = q.right;\n                        continue;\n                    }\n                    // key &gt; r.node.key\uff0c\u200b\u5411\u200b\u53f3\u200b\u626b\u63cf\u200b\n                    if (c &gt; 0) {\n                        q = r;\n                        r = r.right;\n                        continue;\n                    }\n                }\n                // \u200b\u6267\u884c\u200b\u5230\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u8bf4\u660e\u200b key &lt; r.node.key\uff0c\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b\u7b2c\u200b j \u200b\u5c42\u200b\u63d2\u5165\u200b\u65b0\u589e\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u7f6e\u200b\u7d22\u5f15\u200b\n                if (j == insertionLevel) {\n                    // \u3010\u200b\u5c06\u200b\u65b0\u200b\u7d22\u5f15\u200b\u8282\u70b9\u200b t \u200b\u63d2\u5165\u200b q r \u200b\u4e4b\u95f4\u200b\u3011\n                    if (!q.link(r, t))\n                        break; \n                    // \u200b\u5982\u679c\u200b\u65b0\u589e\u200b\u8282\u70b9\u200b\u7684\u200b\u503c\u200b\u4e3a\u200b null\uff0c\u200b\u8868\u793a\u200b\u8be5\u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5220\u9664\u200b\n                    if (t.node.value == null) {\n                        // \u200b\u627e\u5230\u200b\u8be5\u200b\u8282\u70b9\u200b\n                        findNode(key);\n                        break splice;\n                    }\n                    // \u200b\u63d2\u5165\u200b\u5c42\u200b\u9010\u5c42\u200b\u81ea\u51cf\u200b\uff0c\u200b\u5f53\u4e3a\u200b\u6700\u5e95\u5c42\u200b\u65f6\u200b\u9000\u51fa\u200b\u5faa\u73af\u200b\n                    if (--insertionLevel == 0)\n                        break splice;\n                }\n              // \u200b\u5176\u4ed6\u200b\u8282\u70b9\u200b\u968f\u7740\u200b\u63d2\u5165\u200b\u8282\u70b9\u200b\u7684\u200b\u5c42\u6570\u200b\u4e0b\u79fb\u200b\u800c\u200b\u4e0b\u79fb\u200b\n                if (--j &gt;= insertionLevel &amp;&amp; j &lt; level)\n                    t = t.down;\n                q = q.down;\n                r = q.right;\n            }\n        }\n    }\n    return null;\n}\n</code></pre> <ul> <li>findNode()</li> </ul> Java<pre><code>private Node&lt;K,V&gt; findNode(Object key) {\n    // \u200b\u539f\u7406\u200b\u4e0e\u200bdoGet\u200b\u76f8\u540c\u200b\uff0c\u200b\u65e0\u975e\u200b\u662f\u200b findNode \u200b\u8fd4\u56de\u200b\u8282\u70b9\u200b\uff0cdoGet \u200b\u8fd4\u56de\u200b value\n    if ((c = cpr(cmp, key, n.key)) == 0)\n        return n;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_204","title":"\u83b7\u53d6\u200b\u65b9\u6cd5","text":"<ul> <li>get(key)\uff1a\u200b\u83b7\u53d6\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u636e\u200b</li> </ul> Java<pre><code>public V get(Object key) {\n    return doGet(key);\n}\n</code></pre> <ul> <li>doGet()\uff1a\u200b\u626b\u63cf\u200b\u8fc7\u7a0b\u200b\u4f1a\u200b\u5bf9\u200b\u5df2\u200b value = null \u200b\u7684\u200b\u5143\u7d20\u200b\u8fdb\u884c\u200b\u5220\u9664\u200b\u5904\u7406\u200b</li> </ul> Java<pre><code>private V doGet(Object key) {\n    if (key == null)\n        throw new NullPointerException();\n    Comparator&lt;? super K&gt; cmp = comparator;\n    outer: for (;;) {\n        // 1.\u200b\u627e\u5230\u200b\u6700\u5e95\u5c42\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\n        for (Node&lt;K,V&gt; b = findPredecessor(key, cmp), n = b.next;;) {\n            Object v; int c;\n            // 2.\u3010\u200b\u5982\u679c\u200b\u8be5\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u7684\u200b\u94fe\u8868\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\u4e3a\u200b null\uff0c\u200b\u8bf4\u660e\u200b\u4e0d\u200b\u5b58\u5728\u200b\u8be5\u200b\u8282\u70b9\u200b\u3011\n            if (n == null)\n                break outer;\n            // b \u2192 n \u2192 f\n            Node&lt;K,V&gt; f = n.next;\n            // 3.\u200b\u5982\u679c\u200bn\u200b\u4e0d\u200b\u4e3a\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\uff0c\u200b\u8868\u793a\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5220\u9664\u200b\u4e86\u200b\u8be5\u200b\u8282\u70b9\u200b\n            if (n != b.next) \n                break;\n            // 4.\u200b\u5982\u679c\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\u7684\u200b\u503c\u200b\u4e3a\u200bnull\uff0c\u3010\u200b\u9700\u8981\u200b\u5e2e\u52a9\u200b\u5220\u9664\u200b\u8be5\u200b\u8282\u70b9\u200b\u3011\n            if ((v = n.value) == null) {\n                n.helpDelete(b, f);\n                break;\n            }\n            // 5.\u200b\u5982\u679c\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u5df2\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5220\u9664\u200b\uff0c\u200b\u91cd\u65b0\u200b\u5faa\u73af\u200b\n            if (b.value == null || v == n)\n                break;\n             // 6.\u200b\u5982\u679c\u200b\u8981\u200b\u83b7\u53d6\u200b\u7684\u200bkey\u200b\u4e0e\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\u7684\u200bkey\u200b\u76f8\u7b49\u200b\uff0c\u200b\u8fd4\u56de\u200b\u8282\u70b9\u200b\u7684\u200bvalue\n            if ((c = cpr(cmp, key, n.key)) == 0) {\n                @SuppressWarnings(\"unchecked\") V vv = (V)v;\n                return vv;\n            }\n            // 7.key &lt; n.key\uff0c\u200b\u56e0\u4f4d\u200b key &gt; b.key\uff0cb \u200b\u548c\u200b n \u200b\u76f8\u8fde\u200b\uff0c\u200b\u8bf4\u660e\u200b\u4e0d\u200b\u5b58\u5728\u200b\u8be5\u200b\u8282\u70b9\u200b\u6216\u8005\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5220\u9664\u200b\u4e86\u200b\n            if (c &lt; 0)\n                break outer;\n            b = n;\n            n = f;\n        }\n    }\n    return null;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_205","title":"\u5220\u9664\u200b\u65b9\u6cd5","text":"<ul> <li>remove()</li> </ul> Java<pre><code>public V remove(Object key) {\n    return doRemove(key, null);\n}\nfinal V doRemove(Object key, Object value) {\n    if (key == null)\n        throw new NullPointerException();\n    Comparator&lt;? super K&gt; cmp = comparator;\n    outer: for (;;) {\n        // 1.\u200b\u627e\u5230\u200b\u6700\u5e95\u5c42\u200b\u76ee\u6807\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\uff0cb.key &lt; key\n        for (Node&lt;K,V&gt; b = findPredecessor(key, cmp), n = b.next;;) {\n            Object v; int c;\n            // 2.\u200b\u5982\u679c\u200b\u8be5\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u7684\u200b\u94fe\u8868\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\u4e3a\u200b null\uff0c\u200b\u9000\u51fa\u200b\u5faa\u73af\u200b\uff0c\u200b\u8bf4\u660e\u200b\u4e0d\u200b\u5b58\u5728\u200b\u8fd9\u4e2a\u200b\u5143\u7d20\u200b\n            if (n == null)\n                break outer;\n            // b \u2192 n \u2192 f\n            Node&lt;K,V&gt; f = n.next;\n            if (n != b.next)                    // inconsistent read\n                break;\n            if ((v = n.value) == null) {        // n is deleted\n                n.helpDelete(b, f);\n                break;\n            }\n            if (b.value == null || v == n)      // b is deleted\n                break;\n            //3.key &lt; n.key\uff0c\u200b\u8bf4\u660e\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5220\u9664\u200b\u4e86\u200b\uff0c\u200b\u6216\u8005\u200b\u4e0d\u200b\u5b58\u5728\u200b\u8be5\u200b\u8282\u70b9\u200b\n            if ((c = cpr(cmp, key, n.key)) &lt; 0)\n                break outer;\n            //4.key &gt; n.key\uff0c\u200b\u7ee7\u7eed\u200b\u5411\u200b\u540e\u200b\u626b\u63cf\u200b\n            if (c &gt; 0) {\n                b = n;\n                n = f;\n                continue;\n            }\n            //5.\u200b\u5230\u200b\u8fd9\u91cc\u200b\u662f\u200b key = n.key\uff0cvalue \u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5224\u65ad\u200b value \u200b\u548c\u200b n.value \u200b\u662f\u5426\u200b\u76f8\u7b49\u200b\n            if (value != null &amp;&amp; !value.equals(v))\n                break outer;\n            //6.\u3010\u200b\u628a\u200b n \u200b\u8282\u70b9\u200b\u7684\u200b value \u200b\u7f6e\u7a7a\u200b\u3011\n            if (!n.casValue(v, null))\n                break;\n            //7.\u3010\u200b\u7ed9\u200b n \u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u5220\u9664\u200b\u6807\u5fd7\u200b mark\u3011\uff0cmark.next = f\uff0c\u200b\u7136\u540e\u200b\u628a\u200b b.next \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b f\uff0c\u200b\u6210\u529f\u200b\u540e\u200bn\u200b\u51fa\u961f\u200b\n            if (!n.appendMarker(f) || !b.casNext(n, f))\n                // \u200b\u5bf9\u200b key \u200b\u5bf9\u5e94\u200b\u7684\u200b index \u200b\u8fdb\u884c\u200b\u5220\u9664\u200b\uff0c\u200b\u8c03\u7528\u200b\u4e86\u200b findPredecessor \u200b\u65b9\u6cd5\u200b\n                findNode(key);\n            else {\n                // \u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u5931\u8d25\u200b\u540e\u200b\u901a\u8fc7\u200b findPredecessor \u200b\u4e2d\u200b\u8fdb\u884c\u200b index \u200b\u7684\u200b\u5220\u9664\u200b\n                findPredecessor(key, cmp);\n                if (head.right == null)\n                    // \u200b\u8fdb\u884c\u200bheadIndex \u200b\u5bf9\u5e94\u200b\u7684\u200bindex \u200b\u5c42\u200b\u7684\u200b\u5220\u9664\u200b\n                    tryReduceLevel();\n            }\n            @SuppressWarnings(\"unchecked\") V vv = (V)v;\n            return vv;\n        }\n    }\n    return null;\n}\n</code></pre> <p>\u200b\u7ecf\u8fc7\u200b findPredecessor() \u200b\u4e2d\u200b\u7684\u200b unlink() \u200b\u540e\u200b\u7d22\u5f15\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5220\u9664\u200b</p> <p></p> <ul> <li>appendMarker()\uff1a\u200b\u6dfb\u52a0\u200b\u5220\u9664\u200b\u6807\u8bb0\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>boolean appendMarker(Node&lt;K,V&gt; f) {\n    // \u200b\u901a\u8fc7\u200b CAS \u200b\u8ba9\u200b n.next \u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b key \u200b\u4e3a\u200b null\uff0cvalue \u200b\u4e3a\u200b this\uff0cnext \u200b\u4e3a\u200b f \u200b\u7684\u200b\u6807\u8bb0\u200b\u8282\u70b9\u200b\n    return casNext(f, new Node&lt;K,V&gt;(f));\n}\n</code></pre> <ul> <li>helpDelete()\uff1a\u200b\u5c06\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u5220\u9664\u200b\u6807\u8bb0\u200b\u7684\u200b\u8282\u70b9\u200b\u6e05\u9664\u200b\uff0c\u200b\u53c2\u6570\u200b\u662f\u200b\u8be5\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u548c\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>void helpDelete(Node&lt;K,V&gt; b, Node&lt;K,V&gt; f) {\n    // this \u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\u4e3a\u200b f\uff0c\u200b\u4e14\u200b\u672c\u8eab\u200b\u4e3a\u200b b \u200b\u7684\u200b\u540e\u7eed\u200b\u8282\u70b9\u200b\uff0c\u200b\u4e00\u822c\u200b\u90fd\u200b\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\uff0c\u200b\u9664\u975e\u200b\u88ab\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u5220\u9664\u200b\n    if (f == next &amp;&amp; this == b.next) {\n        // \u200b\u5982\u679c\u200b n \u200b\u8fd8\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6807\u8bb0\u200b\n        if (f == null || f.value != f) \n            casNext(f, new Node&lt;K,V&gt;(f));\n        else\n            // \u200b\u901a\u8fc7\u200b CAS\uff0c\u200b\u5c06\u200b b \u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b n \u200b\u53d8\u6210\u200b f.next\uff0c\u200b\u5373\u200b\u6210\u4e3a\u200b\u56fe\u4e2d\u200b\u7684\u200b\u6837\u5f0f\u200b\n            b.casNext(this, f.next);\n    }\n}\n</code></pre> <ul> <li>tryReduceLevel()\uff1a\u200b\u5220\u9664\u200b\u7d22\u5f15\u200b</li> </ul> Java<pre><code>private void tryReduceLevel() {\n    HeadIndex&lt;K,V&gt; h = head;\n    HeadIndex&lt;K,V&gt; d;\n    HeadIndex&lt;K,V&gt; e;\n    if (h.level &gt; 3 &amp;&amp;\n        (d = (HeadIndex&lt;K,V&gt;)h.down) != null &amp;&amp;\n        (e = (HeadIndex&lt;K,V&gt;)d.down) != null &amp;&amp;\n        e.right == null &amp;&amp;\n        d.right == null &amp;&amp;\n        h.right == null &amp;&amp;\n        // \u200b\u8bbe\u7f6e\u200b\u5934\u200b\u7d22\u5f15\u200b\n        casHead(h, d) &amp;&amp; \n        // \u200b\u91cd\u65b0\u200b\u68c0\u67e5\u200b\n        h.right != null) \n        // \u200b\u91cd\u65b0\u200b\u68c0\u67e5\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u8bf4\u660e\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u589e\u52a0\u200b\u4e86\u200b\u7d22\u5f15\u200b\u5c42\u7ea7\u200b\uff0c\u200b\u628a\u200b\u7d22\u5f15\u200b\u5934\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u56de\u6765\u200b\n        casHead(d, h);   \n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://my.oschina.net/u/3768341/blog/3135659</p> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://www.bilibili.com/video/BV1Er4y1P7k1</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#noblocking","title":"NoBlocking","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_206","title":"\u975e\u200b\u963b\u585e\u200b\u961f\u5217","text":"<p>\u200b\u5e76\u53d1\u200b\u7f16\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u7528\u5230\u200b\u5b89\u5168\u200b\u7684\u200b\u961f\u5217\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5b89\u5168\u200b\u961f\u5217\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b 2 \u200b\u79cd\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>\u200b\u52a0\u9501\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u662f\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u5faa\u73af\u200b CAS \u200b\u7b97\u6cd5\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u662f\u975e\u200b\u963b\u585e\u200b\u961f\u5217\u200b</li> </ul> <p>ConcurrentLinkedQueue \u200b\u662f\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b\u94fe\u63a5\u200b\u8282\u70b9\u200b\u7684\u200b\u65e0\u200b\u754c\u7ebf\u200b\u7a0b\u200b\u5b89\u5168\u200b\u961f\u5217\u200b\uff0c\u200b\u91c7\u7528\u200b\u5148\u8fdb\u5148\u51fa\u200b\u7684\u200b\u89c4\u5219\u200b\u5bf9\u200b\u8282\u70b9\u200b\u8fdb\u884c\u200b\u6392\u5e8f\u200b\uff0c\u200b\u5f53\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u6dfb\u52a0\u200b\u5230\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u90e8\u200b\uff0c\u200b\u5f53\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u8fd4\u56de\u200b\u961f\u5217\u200b\u5934\u90e8\u200b\u7684\u200b\u5143\u7d20\u200b</p> <p>\u200b\u8865\u5145\u200b\uff1aConcurrentLinkedDeque \u200b\u662f\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ed3\u6784\u200b\u7684\u200b\u65e0\u754c\u200b\u5e76\u53d1\u200b\u961f\u5217\u200b</p> <p>ConcurrentLinkedQueue \u200b\u4f7f\u7528\u200b\u7ea6\u5b9a\u200b\uff1a</p> <ol> <li>\u200b\u4e0d\u200b\u5141\u8bb8\u200b null \u200b\u5165\u5217\u200b</li> <li>\u200b\u961f\u5217\u200b\u4e2d\u200b\u6240\u6709\u200b\u672a\u200b\u5220\u9664\u200b\u7684\u200b\u8282\u70b9\u200b\u7684\u200b item \u200b\u90fd\u200b\u4e0d\u80fd\u200b\u4e3a\u200b null \u200b\u4e14\u200b\u90fd\u200b\u80fd\u200b\u4ece\u200b head \u200b\u8282\u70b9\u200b\u904d\u5386\u200b\u5230\u200b</li> <li>\u200b\u5220\u9664\u200b\u8282\u70b9\u200b\u662f\u200b\u5c06\u200b item \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b null\uff0c\u200b\u961f\u5217\u200b\u8fed\u4ee3\u200b\u65f6\u200b\u8df3\u200b\u8fc7\u200b item \u200b\u4e3a\u200b null \u200b\u8282\u70b9\u200b</li> <li>head \u200b\u8282\u70b9\u200b\u8ddf\u200b tail \u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u6307\u5411\u200b\u5934\u200b\u8282\u70b9\u200b\u6216\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u6ede\u540e\u6027\u200b</li> </ol> <p>ConcurrentLinkedQueue \u200b\u7531\u200b head \u200b\u8282\u70b9\u200b\u548c\u200b tail \u200b\u8282\u70b9\u200b\u7ec4\u6210\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8282\u70b9\u200b\u7531\u200b\u8282\u70b9\u200b\u5143\u7d20\u200b\u548c\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u7684\u200b\u5f15\u7528\u200b\u7ec4\u6210\u200b\uff0c\u200b\u7ec4\u6210\u200b\u4e00\u5f20\u200b\u94fe\u8868\u200b\u7ed3\u6784\u200b\u7684\u200b\u961f\u5217\u200b</p> Java<pre><code>private transient volatile Node&lt;E&gt; head;\nprivate transient volatile Node&lt;E&gt; tail;\n\nprivate static class Node&lt;E&gt; {\n    volatile E item;\n    volatile Node&lt;E&gt; next;\n    //.....\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_207","title":"\u6784\u9020\u65b9\u6cd5","text":"<ul> <li>\u200b\u65e0\u53c2\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> </ul> Java<pre><code>public ConcurrentLinkedQueue() {\n    // \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b head \u200b\u8282\u70b9\u200b\u5b58\u50a8\u200b\u7684\u200b\u5143\u7d20\u200b\u4e3a\u7a7a\u200b\uff0cdummy \u200b\u8282\u70b9\u200b\uff0ctail \u200b\u8282\u70b9\u200b\u7b49\u4e8e\u200b head \u200b\u8282\u70b9\u200b\n    head = tail = new Node&lt;E&gt;(null);\n}\n</code></pre> <ul> <li>\u200b\u6709\u200b\u53c2\u200b\u6784\u9020\u65b9\u6cd5\u200b</li> </ul> Java<pre><code>public ConcurrentLinkedQueue(Collection&lt;? extends E&gt; c) {\n    Node&lt;E&gt; h = null, t = null;\n    // \u200b\u904d\u5386\u200b\u8282\u70b9\u200b\n    for (E e : c) {\n        checkNotNull(e);\n        Node&lt;E&gt; newNode = new Node&lt;E&gt;(e);\n        if (h == null)\n            h = t = newNode;\n        else {\n            // \u200b\u5355\u5411\u200b\u94fe\u8868\u200b\n            t.lazySetNext(newNode);\n            t = newNode;\n        }\n    }\n    if (h == null)\n        h = t = new Node&lt;E&gt;(null);\n    head = h;\n    tail = t;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_208","title":"\u5165\u961f\u200b\u65b9\u6cd5","text":"<p>\u200b\u4e0e\u200b\u4f20\u7edf\u200b\u7684\u200b\u94fe\u8868\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5355\u7ebf\u7a0b\u200b\u5165\u961f\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>\u200b\u5c06\u200b\u5165\u961f\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u6210\u200b\u5f53\u524d\u200b\u961f\u5217\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b</li> <li>\u200b\u66f4\u65b0\u200b tail \u200b\u8282\u70b9\u200b\uff0c\u200b\u5982\u679c\u200b tail \u200b\u8282\u70b9\u200b\u7684\u200b next \u200b\u8282\u70b9\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u5165\u961f\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u6210\u200b tail \u200b\u8282\u70b9\u200b\uff1b\u200b\u5982\u679c\u200b tail \u200b\u8282\u70b9\u200b\u7684\u200b next \u200b\u8282\u70b9\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u5165\u961f\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u6210\u200b tail \u200b\u7684\u200b next \u200b\u8282\u70b9\u200b\uff0c\u200b\u6240\u4ee5\u200b tail \u200b\u8282\u70b9\u200b\u4e0d\u200b\u603b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u5b58\u5728\u200b\u6ede\u540e\u6027\u200b</li> </ul> Java<pre><code>public boolean offer(E e) {\n    checkNotNull(e);\n    // \u200b\u521b\u5efa\u200b\u5165\u961f\u200b\u8282\u70b9\u200b\n    final Node&lt;E&gt; newNode = new Node&lt;E&gt;(e);\n\n    // \u200b\u5faa\u73af\u200b CAS \u200b\u76f4\u5230\u200b\u5165\u961f\u200b\u6210\u529f\u200b\n    for (Node&lt;E&gt; t = tail, p = t;;) {\n        // p \u200b\u7528\u6765\u200b\u8868\u793a\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u521d\u59cb\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7b49\u4e8e\u200b tail \u200b\u8282\u70b9\u200b\uff0cq \u200b\u662f\u200b p \u200b\u7684\u200b next \u200b\u8282\u70b9\u200b\n        Node&lt;E&gt; q = p.next;\n        // \u200b\u6761\u4ef6\u200b\u6210\u7acb\u200b\u8bf4\u660e\u200b p \u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\n        if (q == null) {\n            // p \u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u8bbe\u7f6e\u200b p \u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u4e3a\u200b\u65b0\u200b\u8282\u70b9\u200b\n            // \u200b\u8bbe\u7f6e\u200b\u6210\u529f\u200b\u5219\u200b casNext \u200b\u8fd4\u56de\u200b true\uff0c\u200b\u5426\u5219\u200b\u8fd4\u56de\u200b false\uff0c\u200b\u8bf4\u660e\u200b\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u66f4\u65b0\u200b\u8fc7\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u5bfb\u627e\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u7ee7\u7eed\u200b CAS\n            if (p.casNext(null, newNode)) {\n                // \u200b\u9996\u6b21\u200b\u6dfb\u52a0\u200b\u65f6\u200b\uff0cp \u200b\u7b49\u4e8e\u200b t\uff0c\u200b\u4e0d\u200b\u8fdb\u884c\u200b\u5c3e\u200b\u8282\u70b9\u200b\u66f4\u65b0\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c3e\u200b\u8282\u70b9\u200b\u5b58\u5728\u200b\u6ede\u540e\u6027\u200b\n                if (p != t)\n                    // \u200b\u5c06\u200b tail \u200b\u8bbe\u7f6e\u200b\u6210\u65b0\u200b\u5165\u961f\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5931\u8d25\u200b\u8868\u793a\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u66f4\u65b0\u200b\u4e86\u200b tail \u200b\u8282\u70b9\u200b\n                    casTail(t, newNode); \n                return true;\n            }\n        }\n        else if (p == q)\n            // \u200b\u5f53\u200b tail \u200b\u4e0d\u200b\u6307\u5411\u200b\u6700\u540e\u200b\u8282\u70b9\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u6267\u884c\u200b\u51fa\u200b\u5217\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5c06\u200b tail \u200b\u4e5f\u200b\u79fb\u9664\u200b\uff0ctail \u200b\u4e0d\u200b\u5728\u200b\u94fe\u8868\u200b\u4e2d\u200b \n            // \u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u5bf9\u200b tail \u200b\u8282\u70b9\u200b\u8fdb\u884c\u200b\u590d\u4f4d\u200b\uff0c\u200b\u590d\u4f4d\u200b\u5230\u200b head \u200b\u8282\u70b9\u200b\n            p = (t != (t = tail)) ? t : head;\n        else\n            // \u200b\u63a8\u52a8\u200b tail \u200b\u5c3e\u200b\u8282\u70b9\u200b\u5f80\u961f\u200b\u5c3e\u200b\u79fb\u52a8\u200b\n            p = (p != t &amp;&amp; t != (t = tail)) ? t : q;\n    }\n}\n</code></pre> <p>\u200b\u56fe\u89e3\u200b\u5165\u961f\u200b\uff1a</p> <p></p> <p></p> <p></p> <p>\u200b\u5f53\u200b tail \u200b\u8282\u70b9\u200b\u548c\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u8ddd\u79bb\u200b\u5927\u4e8e\u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u200b\uff08\u200b\u6bcf\u200b\u5165\u961f\u200b\u4e24\u6b21\u200b\uff09\u200b\u66f4\u65b0\u200b tail\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b CAS \u200b\u66f4\u65b0\u200b tail \u200b\u8282\u70b9\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u5165\u961f\u200b\u6548\u7387\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b 1 \u200b\u7ebf\u7a0b\u200b 2 \u200b\u540c\u65f6\u200b\u5165\u961f\u200b\uff0c\u200b\u65e0\u8bba\u200b\u4ece\u200b\u54ea\u4e2a\u200b\u4f4d\u7f6e\u200b\u5f00\u59cb\u200b\u5e76\u53d1\u200b\u5165\u961f\u200b\uff0c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5faa\u73af\u200b CAS\uff0c\u200b\u76f4\u5230\u200b\u5165\u961f\u200b\u6210\u529f\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b 1 \u200b\u904d\u5386\u200b\uff0c\u200b\u7ebf\u7a0b\u200b 2 \u200b\u5165\u961f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9020\u6210\u200b ConcurrentLinkedQueue \u200b\u7684\u200b size \u200b\u662f\u200b\u53d8\u5316\u200b\uff0c\u200b\u9700\u8981\u200b\u52a0\u9501\u200b\u4fdd\u8bc1\u200b\u5b89\u5168\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b 1 \u200b\u7ebf\u7a0b\u200b 2 \u200b\u540c\u65f6\u200b\u51fa\u200b\u5217\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_209","title":"\u51fa\u961f\u200b\u65b9\u6cd5","text":"<p>\u200b\u51fa\u200b\u961f\u5217\u200b\u7684\u200b\u5c31\u200b\u662f\u4ece\u200b\u961f\u5217\u200b\u91cc\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u5143\u7d20\u200b\uff0c\u200b\u5e76\u200b\u6e05\u7a7a\u200b\u8be5\u200b\u8282\u70b9\u200b\u5bf9\u200b\u5143\u7d20\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u6bcf\u6b21\u200b\u51fa\u961f\u200b\u90fd\u200b\u66f4\u65b0\u200b head \u200b\u8282\u70b9\u200b</p> <ul> <li>\u200b\u5f53\u200b head \u200b\u8282\u70b9\u200b\u91cc\u200b\u6709\u200b\u5143\u7d20\u200b\u65f6\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5f39\u200b\u51fa\u200b head \u200b\u8282\u70b9\u200b\u91cc\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u66f4\u65b0\u200b head \u200b\u8282\u70b9\u200b</li> <li>\u200b\u5f53\u200b head \u200b\u8282\u70b9\u200b\u91cc\u200b\u6ca1\u6709\u200b\u5143\u7d20\u200b\u65f6\u200b\uff0c\u200b\u51fa\u961f\u200b\u64cd\u4f5c\u200b\u624d\u200b\u4f1a\u200b\u66f4\u65b0\u200b head \u200b\u8282\u70b9\u200b</li> </ul> <p>\u200b\u6279\u5904\u7406\u200b\u65b9\u5f0f\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u4f7f\u7528\u200b CAS \u200b\u66f4\u65b0\u200b head \u200b\u8282\u70b9\u200b\u7684\u200b\u6d88\u8017\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u9ad8\u200b\u51fa\u961f\u200b\u6548\u7387\u200b</p> Java<pre><code>public E poll() {\n    restartFromHead:\n    for (;;) {\n        // p \u200b\u8282\u70b9\u200b\u8868\u793a\u200b\u9996\u200b\u8282\u70b9\u200b\uff0c\u200b\u5373\u200b\u9700\u8981\u200b\u51fa\u961f\u200b\u7684\u200b\u8282\u70b9\u200b\uff0cFIFO\n        for (Node&lt;E&gt; h = head, p = h, q;;) {\n            E item = p.item;\n            // \u200b\u5982\u679c\u200b p \u200b\u8282\u70b9\u200b\u7684\u200b\u5143\u7d20\u200b\u4e0d\u200b\u4e3a\u200b null\uff0c\u200b\u5219\u200b\u901a\u8fc7\u200b CAS \u200b\u6765\u200b\u8bbe\u7f6e\u200b p \u200b\u8282\u70b9\u200b\u5f15\u7528\u200b\u5143\u7d20\u200b\u4e3a\u200b null\uff0c\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b item\n            if (item != null &amp;&amp; p.casItem(item, null)) {\n                if (p != h) \n                    // \u200b\u5bf9\u200b head \u200b\u8fdb\u884c\u200b\u79fb\u52a8\u200b\n                    updateHead(h, ((q = p.next) != null) ? q : p);\n                return item;\n            }\n            // \u200b\u903b\u8f91\u200b\u5230\u200b\u8fd9\u200b\u8bf4\u660e\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u5143\u7d20\u200b\u4e3a\u7a7a\u200b\u6216\u5934\u200b\u8282\u70b9\u200b\u53d1\u751f\u200b\u4e86\u200b\u53d8\u5316\u200b\uff0c\u200b\u5934\u200b\u8282\u70b9\u200b\u88ab\u200b\u53e6\u5916\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u4e86\u200b\n            // \u200b\u90a3\u4e48\u200b\u83b7\u53d6\u200b p \u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u5982\u679c\u200b p \u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u200b\u8282\u70b9\u200b\u4e5f\u200b\u4e3a\u200b null\uff0c\u200b\u5219\u200b\u8868\u660e\u200b\u961f\u5217\u200b\u5df2\u7ecf\u200b\u7a7a\u200b\u4e86\u200b\n            else if ((q = p.next) == null) {\n                updateHead(h, p);\n                return null;\n            }\n            // \u200b\u7b2c\u4e00\u8f6e\u200b\u64cd\u4f5c\u200b\u5931\u8d25\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u7ee7\u7eed\u200b\uff0c\u200b\u8c03\u200b\u56de\u5230\u200b\u5faa\u73af\u200b\u524d\u200b\n            else if (p == q)\n                continue restartFromHead;\n            // \u200b\u5982\u679c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u5934\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u6210\u5934\u200b\u8282\u70b9\u200b\n            else\n                p = q;\n        }\n    }\n}\nfinal void updateHead(Node&lt;E&gt; h, Node&lt;E&gt; p) {\n    if (h != p &amp;&amp; casHead(h, p))\n        // \u200b\u5c06\u200b\u65e7\u200b\u7ed3\u70b9\u200b h \u200b\u7684\u200b next \u200b\u57df\u200b\u6307\u5411\u200b\u4e3a\u200b h\uff0chelp gc\n        h.lazySetNext(h);\n}\n</code></pre> <p>\u200b\u5728\u200b\u66f4\u65b0\u200b\u5b8c\u200b head \u200b\u4e4b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u65e7\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b h \u200b\u7684\u200b next \u200b\u57df\u200b\u6307\u5411\u200b\u4e3a\u200b h\uff0c\u200b\u56fe\u4e2d\u200b\u6240\u793a\u200b\u7684\u200b\u865a\u7ebf\u200b\u4e5f\u200b\u5c31\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u8282\u70b9\u200b\u7684\u200b\u81ea\u200b\u5f15\u7528\u200b\uff0c\u200b\u88ab\u200b\u79fb\u52a8\u200b\u7684\u200b\u8282\u70b9\u200b\uff08item \u200b\u4e3a\u200b null \u200b\u7684\u200b\u8282\u70b9\u200b\uff09\u200b\u4f1a\u200b\u88ab\u200b GC \u200b\u56de\u6536\u200b</p> <p></p> <p></p> <p></p> <p>\u200b\u5982\u679c\u200b\u8fd9\u65f6\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u6dfb\u52a0\u200b\u5143\u7d20\u200b\uff0c\u200b\u901a\u8fc7\u200b tail \u200b\u83b7\u53d6\u200b\u7684\u200b next \u200b\u8282\u70b9\u200b\u5219\u200b\u4ecd\u7136\u200b\u662f\u200b\u5b83\u200b\u672c\u8eab\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200bp == q \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u51fa\u73b0\u200b\u8be5\u79cd\u200b\u60c5\u51b5\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u6267\u884c\u200b head \u200b\u7684\u200b\u66f4\u65b0\u200b\uff0c\u200b\u5c06\u200b p \u200b\u8282\u70b9\u200b\u91cd\u65b0\u200b\u6307\u5411\u200b\u4e3a\u200b head</p> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://www.jianshu.com/p/231caf90f30b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_210","title":"\u6210\u5458\u200b\u65b9\u6cd5","text":"<ul> <li>peek()\uff1a\u200b\u4f1a\u200b\u6539\u53d8\u200b head \u200b\u6307\u5411\u200b\uff0c\u200b\u6267\u884c\u200b peek() \u200b\u65b9\u6cd5\u200b\u540e\u200b head \u200b\u4f1a\u200b\u6307\u5411\u200b\u7b2c\u4e00\u4e2a\u200b\u5177\u6709\u200b\u975e\u7a7a\u200b\u5143\u7d20\u200b\u7684\u200b\u8282\u70b9\u200b</li> </ul> Java<pre><code>// \u200b\u83b7\u53d6\u200b\u94fe\u8868\u200b\u7684\u200b\u9996\u90e8\u200b\u5143\u7d20\u200b\uff0c\u200b\u53ea\u200b\u8bfb\u53d6\u200b\u800c\u200b\u4e0d\u200b\u79fb\u9664\u200b\npublic E peek() {\n    restartFromHead:\n    for (;;) {\n        for (Node&lt;E&gt; h = head, p = h, q;;) {\n            E item = p.item;\n            if (item != null || (q = p.next) == null) {\n                // \u200b\u66f4\u6539\u200bh\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e3a\u200b\u975e\u7a7a\u200b\u5143\u7d20\u200b\u8282\u70b9\u200b\n                updateHead(h, p);\n                return item;\n            }\n            else if (p == q)\n                continue restartFromHead;\n            else\n                p = q;\n        }\n    }\n}\n</code></pre> <ul> <li>size()\uff1a\u200b\u7528\u6765\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u961f\u5217\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u90fd\u200b\u6ca1\u6709\u200b\u52a0\u9501\u200b\uff0c\u200b\u5728\u200b\u5e76\u53d1\u200b\u73af\u5883\u200b\u4e2d\u200b\u4ece\u200b\u8c03\u7528\u200b size \u200b\u65b9\u6cd5\u200b\u5230\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u671f\u95f4\u200b\u6709\u200b\u53ef\u80fd\u200b\u589e\u5220\u200b\u5143\u7d20\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7edf\u8ba1\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\u4e0d\u200b\u7cbe\u786e\u200b</li> </ul> Java<pre><code>public int size() {\n    int count = 0;\n    // first() \u200b\u83b7\u53d6\u200b\u7b2c\u4e00\u4e2a\u200b\u5177\u6709\u200b\u975e\u7a7a\u200b\u5143\u7d20\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u82e5\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u8fd4\u56de\u200b null\n    // succ(p) \u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b p \u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u200b\u82e5\u200b p == p.next\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b head\n    // \u200b\u7c7b\u4f3c\u200b\u904d\u5386\u200b\u94fe\u8868\u200b\n    for (Node&lt;E&gt; p = first(); p != null; p = succ(p))\n        if (p.item != null)\n            // \u200b\u6700\u5927\u200b\u8fd4\u56de\u200bInteger.MAX_VALUE\n            if (++count == Integer.MAX_VALUE)\n                break;\n    return count;\n}\n</code></pre> <ul> <li>remove()\uff1a\u200b\u79fb\u9664\u200b\u5143\u7d20\u200b</li> </ul> Java<pre><code>public boolean remove(Object o) {\n    // \u200b\u5220\u9664\u200b\u7684\u200b\u5143\u7d20\u200b\u4e0d\u80fd\u200b\u4e3a\u200bnull\n    if (o != null) {\n        Node&lt;E&gt; next, pred = null;\n        for (Node&lt;E&gt; p = first(); p != null; pred = p, p = next) {\n            boolean removed = false;\n            E item = p.item;\n            // \u200b\u8282\u70b9\u200b\u5143\u7d20\u200b\u4e0d\u200b\u4e3a\u200bnull\n            if (item != null) {\n                // \u200b\u82e5\u200b\u4e0d\u200b\u5339\u914d\u200b\uff0c\u200b\u5219\u200b\u83b7\u53d6\u200bnext\u200b\u8282\u70b9\u200b\u7ee7\u7eed\u200b\u5339\u914d\u200b\n                if (!o.equals(item)) {\n                    next = succ(p);\n                    continue;\n                }\n                // \u200b\u82e5\u200b\u5339\u914d\u200b\uff0c\u200b\u5219\u200b\u901a\u8fc7\u200b CAS \u200b\u64cd\u4f5c\u200b\u5c06\u200b\u5bf9\u5e94\u200b\u8282\u70b9\u200b\u5143\u7d20\u200b\u7f6e\u200b\u4e3a\u200b null\n                removed = p.casItem(item, null);\n            }\n            // \u200b\u83b7\u53d6\u200b\u5220\u9664\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n            next = succ(p);\n            // \u200b\u5c06\u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b\u8282\u70b9\u200b\u79fb\u9664\u200b\u961f\u5217\u200b\n            if (pred != null &amp;&amp; next != null) // unlink\n                pred.casNext(p, next);\n            if (removed)\n                return true;\n        }\n    }\n    return false;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#net","title":"NET","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#des","title":"DES","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_211","title":"\u7f51\u7edc\u200b\u7f16\u7a0b","text":"<p>\u200b\u7f51\u7edc\u200b\u7f16\u7a0b\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u4e00\u5b9a\u200b\u7684\u200b\u534f\u8bae\u200b\u4e0b\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e24\u53f0\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b\u901a\u4fe1\u200b\u7684\u200b\u6280\u672f\u200b</p> <p>\u200b\u901a\u4fe1\u200b\u4e00\u5b9a\u200b\u662f\u200b\u57fa\u4e8e\u200b\u8f6f\u4ef6\u7ed3\u6784\u200b\u5b9e\u73b0\u200b\u7684\u200b:</p> <ul> <li>C/S \u200b\u7ed3\u6784\u200b \uff1a\u200b\u5168\u200b\u79f0\u4e3a\u200b Client/Server \u200b\u7ed3\u6784\u200b\uff0c\u200b\u662f\u200b\u6307\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b\u670d\u52a1\u5668\u200b\u7ed3\u6784\u200b\uff0c\u200b\u5e38\u89c1\u200b\u7a0b\u5e8f\u200b\u6709\u200b QQ\u3001IDEA \u200b\u7b49\u200b\u8f6f\u4ef6\u200b</li> <li>B/S \u200b\u7ed3\u6784\u200b \uff1a\u200b\u5168\u200b\u79f0\u4e3a\u200b Browser/Server \u200b\u7ed3\u6784\u200b\uff0c\u200b\u662f\u200b\u6307\u200b\u6d4f\u89c8\u5668\u200b\u548c\u200b\u670d\u52a1\u5668\u200b\u7ed3\u6784\u200b</li> </ul> <p>\u200b\u4e24\u79cd\u200b\u67b6\u6784\u200b\u5404\u6709\u200b\u4f18\u52bf\u200b\uff0c\u200b\u4f46\u662f\u200b\u65e0\u8bba\u200b\u54ea\u200b\u79cd\u200b\u67b6\u6784\u200b\uff0c\u200b\u90fd\u200b\u79bb\u4e0d\u5f00\u200b\u7f51\u7edc\u200b\u7684\u200b\u652f\u6301\u200b</p> <p>\u200b\u7f51\u7edc\u901a\u4fe1\u200b\u7684\u200b\u4e09\u8981\u7d20\u200b\uff1a</p> <ol> <li>\u200b\u534f\u8bae\u200b\uff1a\u200b\u8ba1\u7b97\u673a\u7f51\u7edc\u200b\u5ba2\u6237\u7aef\u200b\u4e0e\u200b\u670d\u52a1\u7aef\u200b\u901a\u4fe1\u200b\u5fc5\u987b\u200b\u7ea6\u5b9a\u200b\u548c\u200b\u5f7c\u6b64\u200b\u9075\u5b88\u200b\u7684\u200b\u901a\u4fe1\u200b\u89c4\u5219\u200b\uff0cHTTP\u3001FTP\u3001TCP\u3001UDP\u3001SMTP</li> <li> <p>IP \u200b\u5730\u5740\u200b\uff1a\u200b\u4e92\u8054\u7f51\u534f\u8bae\u200b\u5730\u5740\u200b\uff08Internet Protocol Address\uff09\uff0c\u200b\u7528\u6765\u200b\u7ed9\u200b\u4e00\u4e2a\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u8ba1\u7b97\u673a\u8bbe\u5907\u200b\u505a\u200b\u552f\u4e00\u200b\u7684\u200b\u7f16\u53f7\u200b</p> </li> <li> <p>IPv4\uff1a4 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c32 \u200b\u4f4d\u200b\u7ec4\u6210\u200b\uff0c192.168.1.1</p> </li> <li>IPv6\uff1a\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4e3a\u200b\u6240\u6709\u200b\u8bbe\u5907\u200b\u5206\u914d\u200b IP\uff0c128 \u200b\u4f4d\u200b</li> <li>ipconfig\uff1a\u200b\u67e5\u770b\u200b\u672c\u673a\u200b\u7684\u200b IP<ul> <li>ping \u200b\u68c0\u67e5\u200b\u672c\u673a\u200b\u4e0e\u200b\u67d0\u4e2a\u200b IP \u200b\u6307\u5b9a\u200b\u7684\u200b\u673a\u5668\u200b\u662f\u5426\u200b\u8054\u901a\u200b\uff0c\u200b\u6216\u8005\u8bf4\u200b\u662f\u200b\u68c0\u6d4b\u200b\u5bf9\u65b9\u200b\u662f\u5426\u200b\u5728\u7ebf\u200b\u3002</li> <li>ping \u200b\u7a7a\u683c\u200b IP\u200b\u5730\u5740\u200b \uff1aping 220.181.57.216\uff0cping www.baidu.com</li> </ul> </li> </ol> <p>\u200b\u7279\u6b8a\u200b\u7684\u200bIP\u200b\u5730\u5740\u200b\uff1a \u200b\u672c\u200b\u673a\u200bIP\u200b\u5730\u5740\u200b\uff0c127.0.0.1 == localhost\uff0c\u200b\u56de\u73af\u200b\u6d4b\u8bd5\u200b</p> <ol> <li>\u200b\u7aef\u53e3\u200b\uff1a\u200b\u7aef\u53e3\u53f7\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u552f\u4e00\u200b\u6807\u8bc6\u200b\u8bbe\u5907\u200b\u4e2d\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff08\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff09\u3002\u200b\u7aef\u53e3\u53f7\u200b\u662f\u200b\u7528\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u8868\u793a\u200b\u7684\u200b\u6574\u6570\u200b\uff0c\u200b\u53d6\u503c\u200b\u8303\u56f4\u200b\u662f\u200b 0-65535\uff0c0-1023 \u200b\u4e4b\u95f4\u200b\u7684\u200b\u7aef\u53e3\u53f7\u200b\u7528\u4e8e\u200b\u4e00\u4e9b\u200b\u77e5\u540d\u200b\u7684\u200b\u7f51\u7edc\u670d\u52a1\u200b\u548c\u200b\u5e94\u7528\u200b\u666e\u901a\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b 1024 \u200b\u4ee5\u4e0a\u200b\u7684\u200b\u7aef\u53e3\u53f7\u200b\u3002\u200b\u5982\u679c\u200b\u7aef\u53e3\u53f7\u200b\u88ab\u200b\u53e6\u5916\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u200b\u6216\u200b\u5e94\u7528\u200b\u6240\u200b\u5360\u7528\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5f53\u524d\u200b\u7a0b\u5e8f\u200b\u542f\u52a8\u200b\u5931\u8d25\u200b\uff0c\u200b\u62a5\u51fa\u200b\u7aef\u53e3\u200b\u88ab\u200b\u5360\u7528\u200b\u5f02\u5e38\u200b</li> </ol> <p>\u200b\u5229\u7528\u200b\u534f\u8bae\u200b+IP \u200b\u5730\u5740\u200b+\u200b\u7aef\u53e3\u53f7\u200b\u4e09\u5143\u200b\u7ec4\u5408\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6807\u8bc6\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fdb\u7a0b\u200b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u8fd9\u4e2a\u200b\u6807\u8bc6\u200b\u4e0e\u200b\u5176\u5b83\u200b\u8fdb\u7a0b\u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b</p> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://www.bilibili.com/video/BV1kT4y1M7vt</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_212","title":"\u901a\u4fe1\u534f\u8bae","text":"<p>\u200b\u7f51\u7edc\u901a\u4fe1\u200b\u534f\u8bae\u200b\uff1a\u200b\u5bf9\u200b\u8ba1\u7b97\u673a\u200b\u5fc5\u987b\u200b\u9075\u5b88\u200b\u7684\u200b\u89c4\u5219\u200b\uff0c\u200b\u53ea\u6709\u200b\u9075\u5b88\u200b\u8fd9\u4e9b\u200b\u89c4\u5219\u200b\uff0c\u200b\u8ba1\u7b97\u673a\u200b\u4e4b\u95f4\u200b\u624d\u80fd\u200b\u8fdb\u884c\u200b\u901a\u4fe1\u200b</p> <p>\u200b\u901a\u4fe1\u200b\u662f\u200b\u8fdb\u7a0b\u200b\u4e0e\u200b\u8fdb\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\uff0c\u200b\u4e0d\u662f\u200b\u4e3b\u673a\u200b\u4e0e\u200b\u4e3b\u673a\u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b</p> <p>TCP/IP\u200b\u534f\u8bae\u200b\uff1a\u200b\u4f20\u8f93\u63a7\u5236\u534f\u8bae\u200b (Transmission Control Protocol)</p> <p>\u200b\u4f20\u8f93\u63a7\u5236\u534f\u8bae\u200b TCP\uff08Transmission Control Protocol\uff09\u200b\u662f\u200b\u9762\u5411\u200b\u8fde\u63a5\u200b\u7684\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u53ef\u9760\u200b\u4ea4\u4ed8\u200b\uff0c\u200b\u6709\u200b\u6d41\u91cf\u200b\u63a7\u5236\u200b\uff0c\u200b\u62e5\u585e\u200b\u63a7\u5236\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u5168\u53cc\u5de5\u200b\u901a\u4fe1\u200b\uff0c\u200b\u9762\u5411\u200b\u5b57\u8282\u200b\u6d41\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u6761\u200b TCP \u200b\u8fde\u63a5\u200b\u53ea\u80fd\u200b\u662f\u200b\u70b9\u5bf9\u70b9\u200b\u7684\u200b\uff08\u200b\u4e00\u5bf9\u4e00\u200b\uff09</p> <ul> <li>\u200b\u5728\u200b\u901a\u4fe1\u200b\u4e4b\u524d\u200b\u5fc5\u987b\u200b\u786e\u5b9a\u200b\u5bf9\u65b9\u200b\u5728\u7ebf\u200b\u5e76\u4e14\u200b\u8fde\u63a5\u200b\u6210\u529f\u200b\u624d\u200b\u53ef\u4ee5\u200b\u901a\u4fe1\u200b</li> <li>\u200b\u4f8b\u5982\u200b\u4e0b\u8f7d\u200b\u6587\u4ef6\u200b\u3001\u200b\u6d4f\u89c8\u200b\u7f51\u9875\u200b\u7b49\u200b\uff08\u200b\u8981\u6c42\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\uff09</li> </ul> <p>\u200b\u7528\u6237\u200b\u6570\u636e\u200b\u62a5\u200b\u534f\u8bae\u200b UDP\uff08User Datagram Protocol\uff09\u200b\u662f\u200b\u65e0\u200b\u8fde\u63a5\u200b\u7684\u200b\uff0c\u200b\u5c3d\u200b\u6700\u5927\u200b\u53ef\u80fd\u200b\u4ea4\u4ed8\u200b\uff0c\u200b\u4e0d\u200b\u53ef\u9760\u200b\uff0c\u200b\u6ca1\u6709\u200b\u62e5\u585e\u200b\u63a7\u5236\u200b\uff0c\u200b\u9762\u5411\u200b\u62a5\u6587\u200b\uff0c\u200b\u652f\u6301\u200b\u4e00\u5bf9\u4e00\u200b\u3001\u200b\u4e00\u5bf9\u200b\u591a\u200b\u3001\u200b\u591a\u200b\u5bf9\u200b\u4e00\u200b\u548c\u200b\u591a\u200b\u5bf9\u200b\u591a\u200b\u7684\u200b\u4ea4\u4e92\u200b\u901a\u4fe1\u200b</p> <ul> <li>\u200b\u76f4\u63a5\u200b\u53d1\u6d88\u606f\u200b\u7ed9\u200b\u5bf9\u65b9\u200b\uff0c\u200b\u4e0d\u7ba1\u200b\u5bf9\u65b9\u200b\u662f\u5426\u200b\u5728\u7ebf\u200b\uff0c\u200b\u53d1\u6d88\u606f\u200b\u540e\u200b\u4e5f\u200b\u4e0d\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b</li> <li>\u200b\u65e0\u7ebf\u200b\uff08\u200b\u89c6\u9891\u4f1a\u8bae\u200b\uff0c\u200b\u901a\u8bdd\u200b\uff09\uff0c\u200b\u6027\u80fd\u200b\u597d\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e22\u5931\u200b\u4e00\u4e9b\u200b\u6570\u636e\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#java","title":"Java\u200b\u6a21\u578b","text":"<p>\u200b\u76f8\u5173\u200b\u6982\u5ff5\u200b\uff1a</p> <ul> <li>\u200b\u540c\u6b65\u200b\uff1a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8981\u200b\u81ea\u5df1\u200b\u8fdb\u884c\u200b\u6570\u636e\u200b\u7684\u200b\u8bfb\u5199\u64cd\u4f5c\u200b\uff08\u200b\u81ea\u5df1\u200b\u53bb\u200b\u94f6\u884c\u200b\u53d6\u200b\u94b1\u200b\uff09</li> <li>\u200b\u5f02\u6b65\u200b\uff1a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u53bb\u200b\u505a\u200b\u5176\u4ed6\u200b\u4e8b\u60c5\u200b\uff08\u200b\u59d4\u6258\u200b\u522b\u4eba\u200b\u62ff\u200b\u94f6\u884c\u5361\u200b\u5230\u200b\u94f6\u884c\u200b\u53d6\u200b\u94b1\u200b\uff0c\u200b\u7136\u540e\u200b\u7ed9\u200b\u4f60\u200b\uff09</li> <li>\u200b\u963b\u585e\u200b\uff1a\u200b\u5728\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8fd8\u662f\u200b\u8981\u200b\u7ee7\u7eed\u200b\u7b49\u5f85\u200b\u7740\u200b\u8bfb\u200b\uff08\u200b\u6392\u961f\u200b\u7b49\u5f85\u200b\uff09</li> <li>\u200b\u975e\u200b\u963b\u585e\u200b\uff1a\u200b\u5728\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4f1a\u200b\u53bb\u200b\u505a\u200b\u5176\u4ed6\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4e00\u65e6\u200b\u6709\u200b\u4e86\u200b\u6570\u636e\u200b\u518d\u200b\u6765\u200b\u83b7\u53d6\u200b\uff08\u200b\u67dc\u53f0\u200b\u53d6\u6b3e\u200b\uff0c\u200b\u53d6\u4e2a\u200b\u53f7\u200b\uff0c\u200b\u7136\u540e\u200b\u5750\u5728\u200b\u6905\u5b50\u200b\u4e0a\u200b\u505a\u200b\u5176\u5b83\u200b\u4e8b\u200b\uff0c\u200b\u7b49\u200b\u53f7\u200b\u5e7f\u64ad\u200b\u4f1a\u200b\u901a\u77e5\u200b\u4f60\u200b\u529e\u7406\u200b\uff09 </li> </ul> <p>Java \u200b\u4e2d\u200b\u7684\u200b\u901a\u4fe1\u6a21\u578b\u200b:</p> <ol> <li>BIO \u200b\u8868\u793a\u200b\u540c\u6b65\u200b\u963b\u585e\u200b\u5f0f\u200b\u901a\u4fe1\u200b\uff0c\u200b\u670d\u52a1\u5668\u200b\u5b9e\u73b0\u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u8fde\u63a5\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5373\u200b\u5ba2\u6237\u7aef\u200b\u6709\u200b\u8fde\u63a5\u200b\u8bf7\u6c42\u200b\u65f6\u200b\u670d\u52a1\u5668\u7aef\u200b\u5c31\u200b\u9700\u8981\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u8fde\u63a5\u200b\u4e0d\u200b\u505a\u200b\u4efb\u4f55\u200b\u4e8b\u60c5\u200b\u4f1a\u200b\u9020\u6210\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5f00\u9500\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u673a\u5236\u200b\u6539\u5584\u200b</li> </ol> <p>\u200b\u540c\u6b65\u200b\u963b\u585e\u200b\u5f0f\u200b\u6027\u80fd\u200b\u6781\u5dee\u200b\uff1a\u200b\u5927\u91cf\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5927\u91cf\u200b\u963b\u585e\u200b</p> <ol> <li>\u200b\u4f2a\u200b\u5f02\u6b65\u200b\u901a\u4fe1\u200b\uff1a\u200b\u5f15\u5165\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u590d\u200b\u7528\u6765\u200b\u5904\u7406\u200b\u5f88\u591a\u200b\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u53ef\u63a7\u200b</li> </ol> <p>\u200b\u9ad8\u200b\u5e76\u53d1\u200b\u4e0b\u200b\u6027\u80fd\u200b\u8fd8\u662f\u200b\u5f88\u5dee\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u5c11\u200b\uff0c\u200b\u6570\u636e\u200b\u4f9d\u7136\u200b\u662f\u200b\u963b\u585e\u200b\u7684\u200b\uff0c\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u6765\u200b\u7ebf\u7a0b\u200b\u8fd8\u662f\u200b\u8981\u200b\u7b49\u5f85\u200b</p> <ol> <li>NIO \u200b\u8868\u793a\u200b\u540c\u6b65\u200b\u975e\u200b\u963b\u585e\u200b IO\uff0c\u200b\u670d\u52a1\u5668\u200b\u5b9e\u73b0\u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u8bf7\u6c42\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u7684\u200b\u8fde\u63a5\u200b\u4f1a\u200b\u6ce8\u518c\u200b\u5230\u200b\u591a\u8def\u590d\u7528\u200b\u5668\u4e0a\u200b\uff0c\u200b\u591a\u8def\u590d\u7528\u200b\u5668\u200b\u8f6e\u8be2\u200b\u5230\u200b\u8fde\u63a5\u200b\u6709\u200b I/O \u200b\u8bf7\u6c42\u200b\u65f6\u624d\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b</li> </ol> <p>\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\uff1a1 \u200b\u4e2a\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u4e13\u95e8\u200b\u8d1f\u8d23\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\uff0c1 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u8f6e\u8be2\u200b\u6240\u6709\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u53d1\u6765\u200b\u4e86\u200b\u6570\u636e\u200b\u624d\u200b\u4f1a\u200b\u5f00\u542f\u200b\u7ebf\u7a0b\u200b\u5904\u7406\u200b</p> <p>\u200b\u540c\u6b65\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u8fd8\u8981\u200b\u4e0d\u65ad\u200b\u7684\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5904\u7406\u200b\u6570\u636e\u200b</p> <p>\u200b\u975e\u200b\u963b\u585e\u200b\uff1a\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u7ba1\u9053\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8f6e\u8be2\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ba1\u9053\u200b\u662f\u5426\u200b\u6709\u200b\u6570\u636e\u200b</p> <ol> <li>AIO \u200b\u8868\u793a\u200b\u5f02\u6b65\u200b\u975e\u200b\u963b\u585e\u200b IO\uff0cAIO \u200b\u5f15\u5165\u200b\u5f02\u6b65\u200b\u901a\u9053\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e86\u200b Proactor \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u6709\u6548\u200b\u7684\u200b\u8bf7\u6c42\u200b\u624d\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u7279\u70b9\u200b\u662f\u200b\u5148\u200b\u7531\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5b8c\u6210\u200b\u540e\u200b\u624d\u200b\u901a\u77e5\u200b\u670d\u52a1\u7aef\u200b\u7a0b\u5e8f\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u5904\u7406\u200b\uff0c\u200b\u4e00\u822c\u200b\u9002\u7528\u200b\u4e8e\u200b\u8fde\u63a5\u6570\u200b\u8f83\u591a\u4e14\u200b\u8fde\u63a5\u65f6\u95f4\u200b\u8f83\u957f\u200b\u7684\u200b\u5e94\u7528\u200b</li> </ol> <p>\u200b\u5f02\u6b65\u200b\uff1a\u200b\u670d\u52a1\u7aef\u200b\u7ebf\u7a0b\u200b\u63a5\u6536\u200b\u5230\u200b\u4e86\u200b\u5ba2\u6237\u7aef\u200b\u7ba1\u9053\u200b\u4ee5\u540e\u200b\u5c31\u200b\u4ea4\u7ed9\u200b\u5e95\u5c42\u200b\u5904\u7406\u200b IO \u200b\u901a\u4fe1\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u505a\u200b\u5176\u4ed6\u200b\u4e8b\u60c5\u200b</p> <p>\u200b\u975e\u200b\u963b\u585e\u200b\uff1a\u200b\u5e95\u5c42\u200b\u4e5f\u200b\u662f\u200b\u5ba2\u6237\u7aef\u200b\u6709\u200b\u6570\u636e\u200b\u624d\u200b\u4f1a\u200b\u5904\u7406\u200b\uff0c\u200b\u6709\u200b\u4e86\u200b\u6570\u636e\u200b\u4ee5\u540e\u200b\u5904\u7406\u200b\u597d\u200b\u901a\u77e5\u200b\u670d\u52a1\u5668\u200b\u5e94\u7528\u200b\u6765\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b</p> <p>\u200b\u5404\u79cd\u200b\u6a21\u578b\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a</p> <ul> <li>BIO \u200b\u9002\u7528\u200b\u4e8e\u200b\u8fde\u63a5\u200b\u6570\u76ee\u200b\u6bd4\u8f83\u200b\u5c0f\u4e14\u200b\u56fa\u5b9a\u200b\u7684\u200b\u67b6\u6784\u200b\uff0c\u200b\u8be5\u200b\u65b9\u5f0f\u200b\u5bf9\u200b\u670d\u52a1\u5668\u8d44\u6e90\u200b\u8981\u6c42\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\uff0c\u200b\u5e76\u53d1\u200b\u5c40\u9650\u4e8e\u200b\u5e94\u7528\u200b\u4e2d\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u7b80\u5355\u200b</li> <li>NIO \u200b\u9002\u7528\u200b\u4e8e\u200b\u8fde\u63a5\u200b\u6570\u76ee\u200b\u591a\u4e14\u200b\u8fde\u63a5\u200b\u6bd4\u8f83\u200b\u77ed\u200b\uff08\u200b\u8f7b\u200b\u64cd\u4f5c\u200b\uff09\u200b\u7684\u200b\u67b6\u6784\u200b\uff0c\u200b\u5982\u200b\u804a\u5929\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5e76\u53d1\u200b\u5c40\u9650\u4e8e\u200b\u5e94\u7528\u200b\u4e2d\u200b\uff0c\u200b\u7f16\u7a0b\u200b\u590d\u6742\u200b\uff0cJDK 1.4 \u200b\u5f00\u59cb\u200b\u652f\u6301\u200b</li> <li>AIO \u200b\u9002\u7528\u200b\u4e8e\u200b\u8fde\u63a5\u200b\u6570\u76ee\u200b\u591a\u4e14\u200b\u8fde\u63a5\u200b\u6bd4\u8f83\u200b\u957f\u200b\uff08\u200b\u91cd\u200b\u64cd\u4f5c\u200b\uff09\u200b\u7684\u200b\u67b6\u6784\u200b\uff0c\u200b\u5982\u200b\u76f8\u518c\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5145\u5206\u200b\u8c03\u7528\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53c2\u4e0e\u200b\u5e76\u53d1\u200b\u64cd\u4f5c\u200b\uff0cJDK 1.7 \u200b\u5f00\u59cb\u200b\u652f\u6301\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#io","title":"I/O","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#io_1","title":"IO\u200b\u6a21\u578b","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_213","title":"\u4e94\u79cd\u200b\u6a21\u578b","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u5957\u200b\u63a5\u5b57\u200b\u4e0a\u200b\u7684\u200b\u8f93\u5165\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\u4ece\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u5230\u8fbe\u200b\uff0c\u200b\u5f53\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u65f6\u200b\u88ab\u200b\u590d\u5236\u5230\u200b\u5185\u6838\u200b\u4e2d\u200b\u7684\u200b\u67d0\u4e2a\u200b\u7f13\u51b2\u533a\u200b\u3002\u200b\u7b2c\u4e8c\u6b65\u200b\u5c31\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b</p> <p>Linux \u200b\u6709\u200b\u4e94\u79cd\u200b I/O \u200b\u6a21\u578b\u200b\uff1a</p> <ul> <li>\u200b\u963b\u585e\u200b\u5f0f\u200b I/O</li> <li>\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O</li> <li>I/O \u200b\u590d\u7528\u200b\uff08select \u200b\u548c\u200b poll\uff09</li> <li>\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b\u5f0f\u200b I/O\uff08SIGIO\uff09</li> <li>\u200b\u5f02\u6b65\u200b I/O\uff08AIO\uff09</li> </ul> <p>\u200b\u4e94\u79cd\u200b\u6a21\u578b\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>\u200b\u540c\u6b65\u200b I/O \u200b\u5305\u62ec\u200b\u963b\u585e\u200b\u5f0f\u200b I/O\u3001\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O\u3001I/O \u200b\u590d\u7528\u200b\u548c\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b\u4e3b\u8981\u200b\u533a\u522b\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b\u9636\u6bb5\u200b\uff0c\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O \u3001\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \u200b\u548c\u200b\u5f02\u6b65\u200b I/O \u200b\u5728\u200b\u7b2c\u4e00\u9636\u6bb5\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b</li> <li>\u200b\u540c\u6b65\u200b I/O\uff1a\u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u9636\u6bb5\u200b\uff08\u200b\u7b2c\u4e8c\u9636\u6bb5\u200b\uff09\uff0c\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4f1a\u200b\u963b\u585e\u200b</li> <li>\u200b\u5f02\u6b65\u200b I/O\uff1a\u200b\u7b2c\u4e8c\u9636\u6bb5\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#io_2","title":"\u963b\u585e\u200b\u5f0f\u200bIO","text":"<p>\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u901a\u8fc7\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b recvfrom \u200b\u63a5\u6536\u6570\u636e\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u76f4\u5230\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u624d\u200b\u8fd4\u56de\u200b\u3002\u200b\u963b\u585e\u200b\u4e0d\u200b\u610f\u5473\u7740\u200b\u6574\u4e2a\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u90fd\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u5176\u5b83\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\uff0c\u200b\u53ea\u662f\u200b\u5f53\u524d\u200b\u963b\u585e\u200b\u8fdb\u7a0b\u200b\u4e0d\u200b\u6d88\u8017\u200b CPU \u200b\u65f6\u95f4\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u7684\u200b CPU \u200b\u5229\u7528\u7387\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u9ad8\u200b</p> <p>recvfrom() \u200b\u7528\u4e8e\u200b\u63a5\u6536\u200b Socket \u200b\u4f20\u6765\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b buf \u200b\u4e2d\u200b\uff0c\u200b\u628a\u200b recvfrom() \u200b\u5f53\u6210\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_214","title":"\u975e\u200b\u963b\u585e\u200b\u5f0f","text":"<p>\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u901a\u8fc7\u200b recvfrom \u200b\u8c03\u7528\u200b\u4e0d\u505c\u200b\u7684\u200b\u53bb\u200b\u548c\u200b\u5185\u6838\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u76f4\u5230\u200b\u5185\u6838\u200b\u51c6\u5907\u200b\u597d\u200b\u6570\u636e\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u51c6\u5907\u200b\u597d\u200b\u6570\u636e\u200b\uff0c\u200b\u5185\u6838\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u9519\u8bef\u7801\u200b\uff0c\u200b\u8fc7\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u518d\u200b\u6267\u884c\u200b recvfrom \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5728\u200b\u4e24\u6b21\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u95f4\u6bb5\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u79f0\u4e3a\u200b\u8f6e\u8be2\u200b\uff08polling\uff09</p> <p>\u200b\u7531\u4e8e\u200b CPU \u200b\u8981\u200b\u5904\u7406\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u7684\u200b CPU \u200b\u5229\u7528\u7387\u200b\u6bd4\u8f83\u200b\u4f4e\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_215","title":"\u4fe1\u53f7\u200b\u9a71\u52a8","text":"<p>\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4f7f\u7528\u200b sigaction \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5185\u6838\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\u9636\u6bb5\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u662f\u975e\u200b\u963b\u585e\u200b\u7684\u200b\u3002\u200b\u5f53\u200b\u5185\u6838\u200b\u6570\u636e\u200b\u51c6\u5907\u5c31\u7eea\u200b\u65f6\u5411\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u53d1\u9001\u200b SIGIO \u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u6536\u5230\u200b\u4e4b\u540e\u200b\u5728\u200b\u4fe1\u53f7\u5904\u7406\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u8c03\u7528\u200b recvfrom \u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4e2d\u200b</p> <p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O \u200b\u7684\u200b\u8f6e\u8be2\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \u200b\u7684\u200b CPU \u200b\u5229\u7528\u7387\u200b\u66f4\u9ad8\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#io_3","title":"IO \u200b\u590d\u7528","text":"<p>IO \u200b\u590d\u7528\u200b\u6a21\u578b\u200b\u4f7f\u7528\u200b select \u200b\u6216\u8005\u200b poll \u200b\u51fd\u6570\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\uff0cselect \u200b\u4f1a\u200b\u76d1\u542c\u200b\u6240\u6709\u200b\u6ce8\u518c\u200b\u597d\u200b\u7684\u200b IO\uff0c\u200b\u7b49\u5f85\u200b\u591a\u4e2a\u200b\u5957\u200b\u63a5\u5b57\u200b\u4e2d\u200b\u7684\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200b\u53d8\u4e3a\u200b\u53ef\u200b\u8bfb\u200b\uff0c\u200b\u7b49\u5f85\u200b\u8fc7\u7a0b\u200b\u4f1a\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u5f53\u200b\u67d0\u4e2a\u200b\u5957\u200b\u63a5\u5b57\u200b\u51c6\u5907\u200b\u597d\u200b\u6570\u636e\u200b\u53d8\u4e3a\u200b\u53ef\u8bfb\u200b\u65f6\u200b select \u200b\u8c03\u7528\u200b\u5c31\u200b\u8fd4\u56de\u200b\uff0c\u200b\u7136\u540e\u200b\u8c03\u7528\u200b recvfrom \u200b\u628a\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u590d\u5236\u5230\u200b\u8fdb\u7a0b\u200b\u4e2d\u200b</p> <p>IO \u200b\u590d\u7528\u200b\u8ba9\u200b\u5355\u4e2a\u200b\u8fdb\u7a0b\u200b\u5177\u6709\u200b\u5904\u7406\u200b\u591a\u4e2a\u200b I/O \u200b\u4e8b\u4ef6\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u53c8\u200b\u88ab\u200b\u79f0\u4e3a\u200b Event Driven I/O\uff0c\u200b\u5373\u200b\u4e8b\u4ef6\u9a71\u52a8\u200b I/O</p> <p>\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b Web \u200b\u670d\u52a1\u5668\u200b\u6ca1\u6709\u200b I/O \u200b\u590d\u7528\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u200b\u4e00\u4e2a\u200b Socket \u200b\u8fde\u63a5\u200b\u90fd\u200b\u8981\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u5904\u7406\u200b\uff0c\u200b\u5982\u679c\u200b\u540c\u65f6\u200b\u6709\u200b\u51e0\u4e07\u4e2a\u200b\u8fde\u63a5\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u521b\u5efa\u200b\u76f8\u540c\u200b\u6570\u91cf\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u3002\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u591a\u200b\u8fdb\u7a0b\u200b\u548c\u200b\u591a\u7ebf\u7a0b\u200b\u6280\u672f\u200b\uff0cI/O \u200b\u590d\u7528\u200b\u4e0d\u200b\u9700\u8981\u200b\u8fdb\u7a0b\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b\u548c\u200b\u5207\u6362\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u5f00\u9500\u200b\u66f4\u200b\u5c0f\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#io_4","title":"\u5f02\u6b65\u200b IO","text":"<p>\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u6267\u884c\u200b aio_read \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u4f1a\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b\uff0c\u200b\u7ed9\u200b\u5185\u6838\u200b\u4f20\u9012\u200b\u63cf\u8ff0\u7b26\u200b\u3001\u200b\u7f13\u51b2\u533a\u200b\u6307\u9488\u200b\u3001\u200b\u7f13\u51b2\u533a\u200b\u5927\u5c0f\u200b\u7b49\u200b\u3002\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u6267\u884c\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u5185\u6838\u200b\u4f1a\u200b\u5728\u200b\u6240\u6709\u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\u5411\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u53d1\u9001\u200b\u4fe1\u53f7\u200b</p> <p>\u200b\u5f02\u6b65\u200b I/O \u200b\u4e0e\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5f02\u6b65\u200b I/O \u200b\u7684\u200b\u4fe1\u53f7\u200b\u662f\u200b\u901a\u77e5\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b I/O \u200b\u5b8c\u6210\u200b\uff0c\u200b\u800c\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \u200b\u7684\u200b\u4fe1\u53f7\u200b\u662f\u200b\u901a\u77e5\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u5f00\u59cb\u200b I/O</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_216","title":"\u591a\u8def\u590d\u7528","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#select","title":"select","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_217","title":"\u51fd\u6570","text":"<p>Socket \u200b\u4e0d\u662f\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b\u6807\u8bc6\u7b26\u200b\uff0c\u200b\u4f46\u662f\u200b Unix \u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u628a\u200b\u6240\u6709\u200b\u4e1c\u897f\u200b\u90fd\u200b\u770b\u4f5c\u200b\u662f\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6240\u4ee5\u200b Socket \u200b\u8bf4\u6210\u200b file descriptor\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b fd</p> <p>select \u200b\u5141\u8bb8\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u76d1\u89c6\u200b\u4e00\u7ec4\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u7b49\u5f85\u200b\u4e00\u4e2a\u200b\u6216\u8005\u200b\u591a\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\u6210\u4e3a\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b8c\u6210\u200b I/O \u200b\u64cd\u4f5c\u200b\u3002</p> C<pre><code>int select(int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);\n</code></pre> <ul> <li>fd_set \u200b\u4f7f\u7528\u200b bitmap \u200b\u6570\u7ec4\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6570\u7ec4\u200b\u5927\u5c0f\u200b\u7528\u200b FD_SETSIZE \u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5355\u200b\u8fdb\u7a0b\u200b\u53ea\u80fd\u200b\u76d1\u542c\u200b\u5c11\u4e8e\u200b FD_SETSIZE \u200b\u6570\u91cf\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\uff0c32 \u200b\u4f4d\u673a\u200b\u9ed8\u8ba4\u200b\u662f\u200b 1024 \u200b\u4e2a\u200b\uff0c64 \u200b\u4f4d\u673a\u200b\u9ed8\u8ba4\u200b\u662f\u200b 2048\uff0c\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff0c\u200b\u7136\u540e\u200b\u91cd\u65b0\u200b\u7f16\u8bd1\u200b\u5185\u6838\u200b</li> <li>fd_set \u200b\u6709\u200b\u4e09\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\uff1areadset\u3001writeset\u3001exceptset\uff0c\u200b\u5bf9\u5e94\u200b\u8bfb\u200b\u3001\u200b\u5199\u200b\u3001\u200b\u5f02\u5e38\u200b\u6761\u4ef6\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u96c6\u5408\u200b</li> <li>n \u200b\u662f\u200b\u76d1\u6d4b\u200b\u7684\u200b socket \u200b\u7684\u200b\u6700\u5927\u200b\u6570\u91cf\u200b</li> <li>timeout \u200b\u4e3a\u200b\u8d85\u65f6\u200b\u53c2\u6570\u200b\uff0c\u200b\u8c03\u7528\u200b select \u200b\u4f1a\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\u76f4\u5230\u200b\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5230\u8fbe\u200b\u6216\u8005\u200b\u7b49\u5f85\u200b\u7684\u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b timeout</li> </ul> C<pre><code>struct timeval{\n    long tv_sec;  //\u200b\u79d2\u200b\n    long tv_usec; //\u200b\u5fae\u79d2\u200b\n}\n</code></pre> <ul> <li>timeout == null\uff1a\u200b\u7b49\u5f85\u200b\u65e0\u9650\u200b\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>tv_sec == 0 &amp;&amp; tv_usec == 0\uff1a\u200b\u83b7\u53d6\u200b\u540e\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\uff0c\u200b\u4e0d\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b</li> <li>tv_sec != 0 || tv_usec != 0\uff1a\u200b\u7b49\u5f85\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u65b9\u6cd5\u200b\u6210\u529f\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e3a\u200b\u5c31\u7eea\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u4e2a\u6570\u200b\uff0c\u200b\u51fa\u9519\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e3a\u200b -1\uff0c\u200b\u8d85\u65f6\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e3a\u200b 0</li> </ul> <p>Linux \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u7ec4\u200b\u5b8f\u4e3a\u200b fd_set \u200b\u8fdb\u884c\u200b\u8d4b\u503c\u200b\u64cd\u4f5c\u200b\uff1a</p> C<pre><code>int FD_ZERO(fd_set *fdset);         // \u200b\u5c06\u200b\u4e00\u4e2a\u200b fd_set \u200b\u7c7b\u578b\u200b\u53d8\u91cf\u200b\u7684\u200b\u6240\u6709\u200b\u503c\u200b\u90fd\u200b\u7f6e\u200b\u4e3a\u200b 0\nint FD_CLR(int fd, fd_set *fdset);  // \u200b\u5c06\u200b\u4e00\u4e2a\u200b fd_set \u200b\u7c7b\u578b\u200b\u53d8\u91cf\u200b\u7684\u200b fd \u200b\u4f4d\u7f6e\u200b\u4e3a\u200b 0\nint FD_SET(int fd, fd_set *fdset);  // \u200b\u5c06\u200b\u4e00\u4e2a\u200b fd_set \u200b\u7c7b\u578b\u200b\u53d8\u91cf\u200b\u7684\u200b fd \u200b\u4f4d\u7f6e\u200b\u4e3a\u200b 1\nint FD_ISSET(int fd, fd_set *fdset);// \u200b\u5224\u65ad\u200b fd \u200b\u4f4d\u200b\u662f\u5426\u200b\u88ab\u200b\u7f6e\u200b\u4e3a\u200b 1\n</code></pre> <p>\u200b\u793a\u4f8b\u200b\uff1a</p> C<pre><code>sockfd = socket(AF_INET, SOCK_STREAM, 0);\nmemset(&amp;addr, 0, sizeof(addr)));\naddr.sin_family = AF_INET;\naddr.sin_port = htons(2000);\naddr.sin_addr.s_addr = INADDR_ANY;\nbind(sockfd, (struct sockaddr*)&amp;addr, sizeof(addr));//\u200b\u7ed1\u5b9a\u200b\u8fde\u63a5\u200b\nlisten(sockfd, 5);//\u200b\u76d1\u542c\u200b5\u200b\u4e2a\u200b\u7aef\u53e3\u200b\nfor(i = 0; i &lt; 5; i++) {\n    memset(&amp;client, e, sizeof(client));\n    addrlen = sizeof(client);\n    fds[i] = accept(sockfd, (struct sockaddr*)&amp;client, &amp;addrlen);\n    //\u200b\u5c06\u200b\u76d1\u542c\u200b\u7684\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200bfd\u200b\u5b58\u5165\u200bfds\uff1a[3,4,5,6,7]\n    if(fds[i] &gt; max)\n        max = fds[i];\n}\nwhile(1) {\n    FD_ZERO(&amp;rset);//\u200b\u7f6e\u200b\u4e3a\u200b0\n    for(i = 0; i &lt; 5; i++) {\n        FD_SET(fds[i], &amp;rset);//\u200b\u5bf9\u5e94\u200b\u4f4d\u7f6e\u200b1 [0001 1111 00.....]\n    }\n    print(\"round again\");\n    select(max + 1, &amp;rset, NULL, NULL, NULL);//\u200b\u76d1\u542c\u200b\n\n    for(i = 0; i &lt;5; i++) {\n        if(FD_ISSET(fds[i], &amp;rset)) {//\u200b\u5224\u65ad\u200b\u76d1\u542c\u200b\u54ea\u200b\u4e00\u4e2a\u200b\u7aef\u53e3\u200b\n            memset(buffer, 0, MAXBUF);\n            read(fds[i], buffer, MAXBUF);//\u200b\u8fdb\u5165\u200b\u5185\u6838\u200b\u6001\u200b\u8bfb\u6570\u636e\u200b\n            print(buffer);\n        }\n    }\n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://www.bilibili.com/video/BV19D4y1o797</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_218","title":"\u6d41\u7a0b","text":"<p>select \u200b\u8c03\u7528\u200b\u6d41\u7a0b\u56fe\u200b\uff1a</p> <p></p> <ol> <li>\u200b\u4f7f\u7528\u200b copy_from_user \u200b\u4ece\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u62f7\u8d1d\u200b fd_set \u200b\u5230\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u963b\u585e\u200b</li> <li>\u200b\u6ce8\u518c\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b _pollwait</li> <li>\u200b\u904d\u5386\u200b\u6240\u6709\u200b fd\uff0c\u200b\u8c03\u7528\u200b\u5176\u200b\u5bf9\u5e94\u200b\u7684\u200b poll \u200b\u65b9\u6cd5\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u662f\u5426\u200b\u51c6\u5907\u5c31\u7eea\u200b\uff0c\u200b\u5bf9\u4e8e\u200b socket\uff0c\u200b\u8fd9\u4e2a\u200b poll \u200b\u65b9\u6cd5\u200b\u662f\u200b sock_poll\uff0csock_poll \u200b\u6839\u636e\u200b\u60c5\u51b5\u200b\u4f1a\u200b\u8c03\u7528\u200b\u5230\u200b tcp_poll\u3001udp_poll \u200b\u6216\u8005\u200b datagram_poll\uff0c\u200b\u4ee5\u200b tcp_poll \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5176\u200b\u6838\u5fc3\u200b\u5b9e\u73b0\u200b\u5c31\u662f\u200b _pollwait</li> <li>_pollwait \u200b\u628a\u200b current\uff08\u200b\u8c03\u7528\u200b select \u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff09\u200b\u6302\u5230\u200b\u8bbe\u5907\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u4e0d\u540c\u200b\u8bbe\u5907\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u5bf9\u4e8e\u200b tcp_poll \uff0c\u200b\u5176\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u662f\u200b sk \u2192 sk_sleep\uff08\u200b\u628a\u200b\u8fdb\u7a0b\u200b\u6302\u5230\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u5e76\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u8fdb\u7a0b\u200b\u5df2\u7ecf\u200b\u7761\u7720\u200b\uff09\uff0c\u200b\u5728\u200b\u8bbe\u5907\u200b\u6536\u5230\u200b\u6d88\u606f\u200b\uff08\u200b\u7f51\u7edc\u8bbe\u5907\u200b\uff09\u200b\u6216\u200b\u586b\u5199\u200b\u5b8c\u200b\u6587\u4ef6\u200b\u6570\u636e\u200b\uff08\u200b\u78c1\u76d8\u200b\u8bbe\u5907\u200b\uff09\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u5524\u9192\u200b\u8bbe\u5907\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0a\u200b\u7761\u7720\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u8fd9\u65f6\u200b current \u200b\u4fbf\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u8fdb\u5165\u200b\u5c31\u7eea\u200b\u961f\u5217\u200b</li> <li>poll \u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u65f6\u4f1a\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u63cf\u8ff0\u200b\u8bfb\u5199\u64cd\u4f5c\u200b\u662f\u5426\u200b\u5c31\u7eea\u200b\u7684\u200b mask \u200b\u63a9\u7801\u200b\uff0c\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b mask \u200b\u63a9\u7801\u200b\u7ed9\u200b fd_set \u200b\u8d4b\u503c\u200b</li> <li>\u200b\u5982\u679c\u200b\u904d\u5386\u200b\u5b8c\u200b\u6240\u6709\u200b\u7684\u200b fd\uff0c\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u53ef\u200b\u8bfb\u5199\u200b\u7684\u200b mask \u200b\u63a9\u7801\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u8c03\u7528\u200b schedule_timeout \u200b\u8ba9\u200b current \u200b\u8fdb\u7a0b\u200b\u8fdb\u5165\u200b\u7761\u7720\u200b\u3002\u200b\u5f53\u200b\u8bbe\u5907\u200b\u9a71\u52a8\u200b\u53d1\u751f\u200b\u81ea\u8eab\u200b\u8d44\u6e90\u200b\u53ef\u200b\u8bfb\u5199\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u5524\u9192\u200b\u5176\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0a\u200b\u7761\u7720\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u4e00\u5b9a\u200b\u7684\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff08schedule_timeout\uff09\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5524\u9192\u200b\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b select \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u4f1a\u200b\u91cd\u65b0\u200b\u88ab\u200b\u5524\u9192\u200b\u83b7\u5f97\u200b CPU\uff0c\u200b\u8fdb\u800c\u200b\u91cd\u65b0\u200b\u904d\u5386\u200b fd\uff0c\u200b\u5224\u65ad\u200b\u6709\u6ca1\u6709\u200b\u5c31\u7eea\u200b\u7684\u200b fd</li> <li>\u200b\u628a\u200b fd_set \u200b\u4ece\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u963b\u585e\u200b\u8fdb\u7a0b\u200b\u7ee7\u7eed\u6267\u884c\u200b</li> </ol> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://www.cnblogs.com/anker/p/3265058.html</p> <p>\u200b\u5176\u4ed6\u200b\u6d41\u7a0b\u56fe\u200b\uff1ahttps://www.processon.com/view/link/5f62b9a6e401fd2ad7e5d6d1</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#poll","title":"poll","text":"<p>poll \u200b\u7684\u200b\u529f\u80fd\u200b\u4e0e\u200b select \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7b49\u5f85\u200b\u4e00\u7ec4\u200b\u63cf\u8ff0\u7b26\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6210\u4e3a\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b</p> C<pre><code>int poll(struct pollfd *fds, unsigned int nfds, int timeout);\n</code></pre> <p>poll \u200b\u4e2d\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u662f\u200b pollfd \u200b\u7c7b\u578b\u200b\u7684\u200b\u6570\u7ec4\u200b\uff0cpollfd \u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> C<pre><code>struct pollfd {\n    int   fd;         /* file descriptor */\n    short events;     /* requested events */\n    short revents;    /* returned events */\n};\n</code></pre> <p>select \u200b\u548c\u200b poll \u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>select \u200b\u4f1a\u200b\u4fee\u6539\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u800c\u200b poll \u200b\u4e0d\u4f1a\u200b</li> <li>select \u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u7c7b\u578b\u200b\u4f7f\u7528\u200b\u6570\u7ec4\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u9650\u5236\u200b\uff1b\u200b\u800c\u200b poll \u200b\u4f7f\u7528\u200b\u94fe\u8868\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6ca1\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u91cf\u200b\u7684\u200b\u9650\u5236\u200b</li> <li>poll \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bf9\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u91cd\u590d\u200b\u5229\u7528\u200b\u4e0a\u200b\u6bd4\u200b select \u200b\u9ad8\u200b</li> <li>select \u200b\u548c\u200b poll \u200b\u901f\u5ea6\u200b\u90fd\u200b\u6bd4\u8f83\u6162\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u8c03\u7528\u200b\u90fd\u200b\u9700\u8981\u200b\u5c06\u200b\u5168\u90e8\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u7ec4\u200b fd \u200b\u4ece\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u540c\u65f6\u200b\u6bcf\u6b21\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b\u5185\u6838\u200b\u904d\u5386\u200b\u4f20\u9012\u200b\u8fdb\u6765\u200b\u7684\u200b\u6240\u6709\u200b fd \uff0c\u200b\u8fd9\u4e2a\u200b\u5f00\u9500\u200b\u5728\u200b fd \u200b\u5f88\u591a\u200b\u65f6\u4f1a\u200b\u5f88\u5927\u200b</li> <li>\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b\u7684\u200b\u7cfb\u7edf\u200b\u90fd\u200b\u652f\u6301\u200b select\uff0c\u200b\u4f46\u662f\u200b\u53ea\u6709\u200b\u6bd4\u8f83\u200b\u65b0\u200b\u7684\u200b\u7cfb\u7edf\u200b\u652f\u6301\u200b poll</li> <li>select \u200b\u548c\u200b poll \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b O(n)\uff0c\u200b\u5bf9\u200b socket \u200b\u8fdb\u884c\u200b\u626b\u63cf\u200b\u65f6\u200b\u662f\u200b\u7ebf\u6027\u200b\u626b\u63cf\u200b\uff0c\u200b\u5373\u200b\u91c7\u7528\u200b\u8f6e\u8be2\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6548\u7387\u200b\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5e76\u4e0d\u77e5\u9053\u200b\u5177\u4f53\u200b\u662f\u200b\u54ea\u4e2a\u200b socket \u200b\u5177\u6709\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u6240\u4ee5\u200b\u968f\u7740\u200b fd \u200b\u6570\u91cf\u200b\u7684\u200b\u589e\u52a0\u200b\u4f1a\u200b\u9020\u6210\u200b\u904d\u5386\u200b\u901f\u5ea6\u6162\u200b\u7684\u200b\u7ebf\u6027\u200b\u4e0b\u964d\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b</li> <li>poll \u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u7279\u70b9\u200b\u662f\u200b\u6c34\u5e73\u200b\u89e6\u53d1\u200b\uff0c\u200b\u5982\u679c\u200b\u62a5\u544a\u200b\u4e86\u200b fd \u200b\u540e\u200b\uff0c\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5904\u7406\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e0b\u6b21\u200b poll \u200b\u65f6\u4f1a\u200b\u518d\u6b21\u200b\u62a5\u544a\u200b\u8be5\u200b fd</li> <li>\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u67d0\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\u8c03\u7528\u200b\u4e86\u200b select \u200b\u6216\u8005\u200b poll\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5173\u95ed\u200b\u4e86\u200b\u8be5\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u8c03\u7528\u200b\u7ed3\u679c\u200b\u4e0d\u200b\u786e\u5b9a\u200b</li> </ul> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://github.com/CyC2018/CS-Notes/blob/master/notes/Socket.md</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#epoll","title":"epoll","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_219","title":"\u51fd\u6570","text":"<p>epoll \u200b\u4f7f\u7528\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u5c31\u7eea\u200b\u901a\u77e5\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u901a\u8fc7\u200b epoll_ctl() \u200b\u5411\u200b\u5185\u6838\u200b\u6ce8\u518c\u200b\u65b0\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u6216\u8005\u200b\u662f\u200b\u6539\u53d8\u200b\u67d0\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u5df2\u200b\u6ce8\u518c\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u5728\u200b\u5185\u6838\u200b\u4e2d\u4f1a\u200b\u88ab\u200b\u7ef4\u62a4\u200b\u5728\u200b\u4e00\u68f5\u200b\u7ea2\u9ed1\u200b\u6811\u4e0a\u200b\uff0c\u200b\u4e00\u65e6\u200b\u8be5\u200b fd \u200b\u5c31\u7eea\u200b\uff0c\u200b\u5185\u6838\u200b\u901a\u8fc7\u200b callback \u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u5c06\u200b I/O \u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u52a0\u5165\u200b\u5230\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u4e2d\u200b\u7ba1\u7406\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u8c03\u7528\u200b epoll_wait() \u200b\u4fbf\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4e8b\u4ef6\u200b\u5c31\u7eea\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b</p> C<pre><code>int epoll_create(int size);\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)\uff1b\nint epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);\n</code></pre> <ul> <li>epall_create\uff1a\u200b\u4e00\u4e2a\u200b\u7cfb\u7edf\u200b\u51fd\u6570\u200b\uff0c\u200b\u51fd\u6570\u200b\u5c06\u200b\u5728\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u5185\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b epoll \u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b epoll \u200b\u7ed3\u6784\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8fd4\u56de\u503c\u200b\u4e3a\u200b epoll \u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7f16\u53f7\u200b\uff0c\u200b\u4ee5\u540e\u200b\u6709\u200b client \u200b\u8fde\u63a5\u200b\u65f6\u200b\uff0c\u200b\u5411\u200b\u8be5\u200b epoll \u200b\u7ed3\u6784\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u76d1\u542c\u200b\uff0c\u200b\u6240\u4ee5\u200b epoll \u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b</li> <li>epall_ctl\uff1aepoll \u200b\u7684\u200b\u4e8b\u4ef6\u200b\u6ce8\u518c\u200b\u51fd\u6570\u200b\uff0cselect \u200b\u51fd\u6570\u200b\u662f\u200b\u8c03\u7528\u200b\u65f6\u200b\u6307\u5b9a\u200b\u9700\u8981\u200b\u76d1\u542c\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u548c\u200b\u4e8b\u4ef6\u200b\uff0cepoll \u200b\u5148\u200b\u5c06\u200b\u7528\u6237\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u4e8b\u4ef6\u200b\u6ce8\u518c\u200b\u5230\u200b epoll \u200b\u7a7a\u95f4\u200b\u3002\u200b\u6b64\u200b\u51fd\u6570\u200b\u662f\u975e\u200b\u963b\u585e\u200b\u51fd\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u589e\u5220\u200b\u6539\u200b epoll \u200b\u7a7a\u95f4\u200b\u5185\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u53c2\u6570\u200b\u89e3\u91ca\u200b\uff1a</li> <li>epfd\uff1aepoll \u200b\u7ed3\u6784\u200b\u7684\u200b\u8fdb\u7a0b\u200b fd \u200b\u7f16\u53f7\u200b\uff0c\u200b\u51fd\u6570\u200b\u5c06\u200b\u4f9d\u9760\u200b\u8be5\u200b\u7f16\u53f7\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b epoll \u200b\u7ed3\u6784\u200b</li> <li>op\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\uff0c\u200b\u6709\u200b\u4e09\u4e2a\u200b\u5b8f\u200b\u5b9a\u4e49\u200b\uff1a<ul> <li>EPOLL_CTL_ADD\uff1a\u200b\u6ce8\u518c\u200b\u65b0\u200b\u7684\u200b fd \u200b\u5230\u200b epfd \u200b\u4e2d\u200b</li> <li>EPOLL_CTL_MOD\uff1a\u200b\u4fee\u6539\u200b\u5df2\u7ecf\u200b\u6ce8\u518c\u200b\u7684\u200b fd \u200b\u7684\u200b\u76d1\u542c\u200b\u4e8b\u4ef6\u200b</li> <li>EPOLL_CTI_DEL\uff1a\u200b\u4ece\u200b epfd \u200b\u4e2d\u200b\u5220\u9664\u200b\u4e00\u4e2a\u200b fd</li> </ul> </li> <li>fd\uff1a\u200b\u9700\u8981\u200b\u76d1\u542c\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4e00\u822c\u200b\u6307\u200b socket_fd</li> <li> <p>event\uff1a\u200b\u544a\u8bc9\u200b\u5185\u6838\u200b\u5bf9\u200b\u8be5\u200b fd \u200b\u8d44\u6e90\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u4e8b\u4ef6\u200b\uff0cepoll_event \u200b\u7684\u200b\u7ed3\u6784\u200b\uff1a</p> C<pre><code>struct epoll_event {\n    _uint32_t events;   /*epoll events*/\n    epoll_data_t data;  /*user data variable*/\n}\n</code></pre> <p>events \u200b\u53ef\u4ee5\u200b\u662f\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u5b8f\u200b\u96c6\u5408\u200b\uff1aEPOLLIN\u3001EPOLOUT\u3001EPOLLPRI\u3001EPOLLERR\u3001EPOLLHUP\uff08\u200b\u6302\u65ad\u200b\uff09\u3001EPOLET\uff08\u200b\u8fb9\u7f18\u200b\u89e6\u53d1\u200b\uff09\u3001EPOLLONESHOT\uff08\u200b\u53ea\u200b\u76d1\u542c\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e8b\u4ef6\u200b\u89e6\u53d1\u200b\u540e\u200b\u81ea\u52a8\u200b\u6e05\u9664\u200b\u8be5\u200b fd\uff0c\u200b\u4ece\u200b epoll \u200b\u5217\u8868\u200b\uff09</p> </li> <li> <p>epoll_wait\uff1a\u200b\u7b49\u5f85\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u4ea7\u751f\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b select() \u200b\u8c03\u7528\u200b\uff0c\u200b\u8fd4\u56de\u503c\u200b\u4e3a\u200b\u672c\u6b21\u200b\u5c31\u7eea\u200b\u7684\u200b fd \u200b\u4e2a\u6570\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4ece\u200b\u5c31\u7eea\u200b\u94fe\u8868\u200b\u83b7\u53d6\u200b\uff0c\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b O(1)</p> </li> <li>epfd\uff1a\u200b\u6307\u5b9a\u200b\u611f\u5174\u8da3\u200b\u7684\u200b epoll \u200b\u4e8b\u4ef6\u200b\u5217\u8868\u200b</li> <li>events\uff1a\u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b epoll_event \u200b\u7ed3\u6784\u200b\u6570\u7ec4\u200b\uff0c\u200b\u5f53\u200b\u51fd\u6570\u200b\u8fd4\u56de\u200b\u65f6\u200b\uff0c\u200b\u5185\u6838\u200b\u4f1a\u200b\u628a\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b\u7684\u200b\u6570\u636e\u200b\u62f7\u8d1d\u5230\u200b\u8be5\u200b\u6570\u7ec4\u200b</li> <li>maxevents\uff1a\u200b\u6807\u660e\u200b epoll_event \u200b\u6570\u7ec4\u200b\u6700\u591a\u80fd\u200b\u63a5\u6536\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\uff0c\u200b\u5373\u200b\u672c\u6b21\u200b\u64cd\u4f5c\u200b\u6700\u591a\u80fd\u200b\u83b7\u53d6\u200b\u591a\u5c11\u200b\u5c31\u7eea\u200b\u6570\u636e\u200b</li> <li>timeout\uff1a\u200b\u5355\u4f4d\u200b\u4e3a\u200b\u6beb\u79d2\u200b<ul> <li>0\uff1a\u200b\u8868\u793a\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b\uff0c\u200b\u975e\u200b\u963b\u585e\u200b\u8c03\u7528\u200b</li> <li>-1\uff1a\u200b\u963b\u585e\u200b\u8c03\u7528\u200b\uff0c\u200b\u76f4\u5230\u200b\u6709\u200b\u7528\u6237\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5c31\u7eea\u200b\u4e3a\u6b62\u200b</li> <li>\u200b\u5927\u4e8e\u200b 0\uff1a\u200b\u963b\u585e\u200b\u8c03\u7528\u200b\uff0c\u200b\u963b\u585e\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b\u5185\u200b\u5982\u679c\u200b\u6709\u200b\u4e8b\u4ef6\u200b\u5c31\u7eea\u200b\u5219\u200b\u63d0\u524d\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5426\u5219\u200b\u7b49\u5f85\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b\u540e\u200b\u8fd4\u56de\u200b</li> </ul> </li> </ul> <p>epoll \u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u4e8b\u4ef6\u200b\u6709\u200b\u4e24\u79cd\u200b\u89e6\u53d1\u200b\u6a21\u5f0f\u200b\uff1aLT\uff08level trigger\uff09\u200b\u548c\u200b ET\uff08edge trigger\uff09\uff1a</p> <ul> <li>LT \u200b\u6a21\u5f0f\u200b\uff1a\u200b\u5f53\u200b epoll_wait() \u200b\u68c0\u6d4b\u200b\u5230\u200b\u63cf\u8ff0\u7b26\u200b\u4e8b\u4ef6\u200b\u5230\u8fbe\u200b\u65f6\u200b\uff0c\u200b\u5c06\u200b\u6b64\u200b\u4e8b\u4ef6\u200b\u901a\u77e5\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u7acb\u5373\u200b\u5904\u7406\u200b\u8be5\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u8c03\u7528\u200b epoll_wait() \u200b\u4f1a\u200b\u518d\u6b21\u200b\u901a\u77e5\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u662f\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u4e00\u79cd\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u540c\u65f6\u200b\u652f\u6301\u200b Blocking \u200b\u548c\u200b No-Blocking</li> <li>ET \u200b\u6a21\u5f0f\u200b\uff1a\u200b\u901a\u77e5\u200b\u4e4b\u540e\u200b\u8fdb\u7a0b\u200b\u5fc5\u987b\u200b\u7acb\u5373\u200b\u5904\u7406\u4e8b\u4ef6\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u518d\u200b\u8c03\u7528\u200b epoll_wait() \u200b\u65f6\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u5f97\u5230\u200b\u4e8b\u4ef6\u200b\u5230\u8fbe\u200b\u7684\u200b\u901a\u77e5\u200b\u3002\u200b\u51cf\u5c11\u200b\u4e86\u200b epoll \u200b\u4e8b\u4ef6\u200b\u88ab\u200b\u91cd\u590d\u200b\u89e6\u53d1\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6548\u7387\u200b\u8981\u200b\u6bd4\u200b LT \u200b\u6a21\u5f0f\u200b\u9ad8\u200b\uff1b\u200b\u53ea\u200b\u652f\u6301\u200b No-Blocking\uff0c\u200b\u4ee5\u200b\u907f\u514d\u200b\u7531\u4e8e\u200b\u4e00\u4e2a\u200b fd \u200b\u7684\u200b\u963b\u585e\u200b\u8bfb\u200b/\u200b\u963b\u585e\u200b\u5199\u200b\u64cd\u4f5c\u200b\u628a\u200b\u5904\u7406\u200b\u591a\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u4efb\u52a1\u200b\u9965\u997f\u200b</li> </ul> C<pre><code>// \u200b\u521b\u5efa\u200b epoll \u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u7528\u4e8e\u200b\u76d1\u63a7\u200b\u6240\u6709\u200b\u5957\u200b\u63a5\u5b57\u200b\nint pollingfd = epoll_create(0xCAFE);\nif ( pollingfd &lt; 0 )// report error\n// \u200b\u521d\u59cb\u5316\u200b epoll \u200b\u7ed3\u6784\u200b\nstruct epoll_event ev = { 0 };\n\n// \u200b\u5c06\u200b\u8fde\u63a5\u200b\u7c7b\u200b\u5b9e\u4f8b\u200b\u4e0e\u200b\u4e8b\u4ef6\u200b\u76f8\u5173\u8054\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5173\u8054\u200b\u4efb\u4f55\u200b\u60f3\u8981\u200b\u7684\u200b\u4e1c\u897f\u200b\nev.data.ptr = pConnection1;\n\n// \u200b\u76d1\u89c6\u200b\u8f93\u5165\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u4e8b\u4ef6\u200b\u53d1\u751f\u200b\u540e\u200b\u4e0d\u200b\u81ea\u52a8\u200b\u91cd\u65b0\u200b\u51c6\u5907\u200b\u63cf\u8ff0\u7b26\u200b\nev.events = EPOLLIN | EPOLLONESHOT;\n// \u200b\u5c06\u200b\u63cf\u8ff0\u7b26\u200b\u6dfb\u52a0\u200b\u5230\u200b\u76d1\u63a7\u200b\u5217\u8868\u200b\u4e2d\u200b\uff0c\u200b\u5373\u4f7f\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200bepoll_wait\u200b\u4e2d\u200b\u7b49\u5f85\u200b\uff0c\u200b\u63cf\u8ff0\u7b26\u200b\u5c06\u200b\u88ab\u200b\u6b63\u786e\u200b\u6dfb\u52a0\u200b\nif ( epoll_ctl( epollfd, EPOLL_CTL_ADD, pConnection1-&gt;getSocket(), &amp;ev) != 0 )\n    // report error\n\n// \u200b\u6700\u200b\u591a\u200b\u7b49\u5f85\u200b 20 \u200b\u4e2a\u200b\u4e8b\u4ef6\u200b\nstruct epoll_event pevents[20];\n\n// \u200b\u7b49\u5f85\u200b10\u200b\u79d2\u200b\uff0c\u200b\u68c0\u7d22\u200b20\u200b\u4e2a\u200b\u5e76\u200b\u5b58\u5165\u200bepoll_event\u200b\u6570\u7ec4\u200b\nint ready = epoll_wait(pollingfd, pevents, 20, 10000);\n// \u200b\u68c0\u67e5\u200bepoll\u200b\u662f\u5426\u200b\u6210\u529f\u200b\nif ( ret == -1)// report error and abort\nelse if ( ret == 0)// timeout; no event detected\nelse\n{\n    for (int i = 0; i &lt; ready; i+ )\n    {\n        if ( pevents[i].events &amp; EPOLLIN )\n        {\n            // \u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\u6307\u9488\u200b\n            Connection * c = (Connection*) pevents[i].data.ptr;\n            c-&gt;handleReadEvent();\n         }\n    }\n}\n</code></pre> <p>\u200b\u6d41\u7a0b\u56fe\u200b\uff1ahttps://gitee.com/seazean/images/blob/master/Java/IO-epoll%E5%8E%9F%E7%90%86%E5%9B%BE.jpg</p> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://www.bilibili.com/video/BV19D4y1o797</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_220","title":"\u7279\u70b9","text":"<p>epoll \u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ul> <li>epoll \u200b\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b Linux \u200b\u7cfb\u7edf\u200b</li> <li>epoll \u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u5c06\u200b\u7528\u6237\u200b\u5173\u5fc3\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5b58\u653e\u200b\u5230\u200b\u5185\u6838\u200b\u7684\u200b\u4e00\u4e2a\u200b\u4e8b\u4ef6\u200b\u8868\u200b\uff08\u200b\u4e2a\u4eba\u200b\u7406\u89e3\u200b\u6210\u54d1\u200b\u5143\u200b\u8282\u70b9\u200b\uff09</li> <li>\u200b\u6ca1\u6709\u200b\u6700\u5927\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u91cf\u200b\uff08\u200b\u5e76\u53d1\u200b\u8fde\u63a5\u200b\uff09\u200b\u7684\u200b\u9650\u5236\u200b\uff0c\u200b\u6253\u5f00\u200b fd \u200b\u7684\u200b\u4e0a\u9650\u200b\u8fdc\u5927\u4e8e\u200b1024\uff081G \u200b\u5185\u5b58\u200b\u80fd\u200b\u76d1\u542c\u200b\u7ea6\u200b 10 \u200b\u4e07\u4e2a\u200b\u7aef\u53e3\u200b\uff09</li> <li>epoll \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b O(1)\uff0cepoll \u200b\u7406\u89e3\u200b\u4e3a\u200b event poll\uff0c\u200b\u4e0d\u540c\u4e8e\u200b\u5fd9\u200b\u8f6e\u8be2\u200b\u548c\u200b\u65e0\u5dee\u522b\u200b\u8f6e\u8be2\u200b\uff0c\u200b\u8c03\u7528\u200b epoll_wait \u200b\u53ea\u662f\u200b\u8f6e\u8be2\u200b\u5c31\u7eea\u200b\u94fe\u8868\u200b\u3002\u200b\u5f53\u200b\u76d1\u542c\u200b\u5217\u8868\u200b\u6709\u200b\u8bbe\u5907\u200b\u5c31\u7eea\u200b\u65f6\u200b\u8c03\u7528\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\uff0c\u200b\u628a\u200b\u5c31\u7eea\u200b fd \u200b\u653e\u5165\u200b\u5c31\u7eea\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u5524\u9192\u200b\u5728\u200b epoll_wait \u200b\u4e2d\u200b\u963b\u585e\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u6240\u4ee5\u200b epoll \u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u4e8b\u4ef6\u9a71\u52a8\u200b\uff08\u200b\u6bcf\u4e2a\u200b\u4e8b\u4ef6\u200b\u5173\u8054\u200b\u4e0a\u200bfd\uff09\u200b\u7684\u200b\uff0c\u200b\u964d\u4f4e\u200b\u4e86\u200b system call \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b</li> <li>epoll \u200b\u5185\u6838\u200b\u4e2d\u200b\u6839\u636e\u200b\u6bcf\u4e2a\u200b fd \u200b\u4e0a\u200b\u7684\u200b callback \u200b\u51fd\u6570\u200b\u6765\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ea\u6709\u200b\u6d3b\u8dc3\u200b\u7684\u200b socket \u200b\u624d\u200b\u4f1a\u200b\u4e3b\u52a8\u200b\u8c03\u7528\u200b callback\uff0c\u200b\u6240\u4ee5\u200b\u4f7f\u7528\u200b epoll \u200b\u6ca1\u6709\u200b\u524d\u9762\u200b\u4e24\u8005\u200b\u7684\u200b\u7ebf\u6027\u200b\u4e0b\u964d\u200b\u7684\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b\uff0c\u200b\u6548\u7387\u200b\u63d0\u9ad8\u200b</li> <li>epoll \u200b\u6ce8\u518c\u200b\u65b0\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u662f\u200b\u6ce8\u518c\u200b\u5230\u200b\u5230\u200b\u5185\u6838\u200b\u4e2d\u200b epoll \u200b\u53e5\u67c4\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u6bcf\u6b21\u200b\u8c03\u7528\u200b epoll_wait \u200b\u65f6\u200b\u91cd\u590d\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5bf9\u6bd4\u200b\u524d\u9762\u200b\u4e24\u79cd\u200b\u53ea\u200b\u9700\u8981\u200b\u5c06\u200b\u63cf\u8ff0\u7b26\u200b\u4ece\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u5411\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u62f7\u8d1d\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b mmap() \u200b\u6587\u4ef6\u200b\u6620\u5c04\u200b\u5185\u5b58\u200b\u52a0\u901f\u200b\u4e0e\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7684\u200b\u6d88\u606f\u4f20\u9012\u200b\uff08\u200b\u53ea\u662f\u200b\u53ef\u4ee5\u200b\u7528\u200b\uff0c\u200b\u5e76\u200b\u6ca1\u6709\u200b\u7528\u200b\uff09</li> <li>\u200b\u524d\u9762\u200b\u4e24\u8005\u200b\u8981\u200b\u628a\u200b current \u200b\u5f80\u200b\u8bbe\u5907\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u6302\u200b\u4e00\u6b21\u200b\uff0cepoll \u200b\u4e5f\u200b\u53ea\u200b\u628a\u200b current \u200b\u5f80\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0a\u200b\u6302\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u5e76\u200b\u4e0d\u662f\u200b\u8bbe\u5907\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b epoll \u200b\u5185\u90e8\u200b\u5b9a\u4e49\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u8282\u7701\u200b\u5f00\u9500\u200b</li> <li>epoll \u200b\u5bf9\u200b\u591a\u7ebf\u7a0b\u200b\u7f16\u7a0b\u200b\u66f4\u200b\u6709\u200b\u53cb\u597d\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b\u4e86\u200b epoll_wait() \u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5173\u95ed\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u4ea7\u751f\u200b\u50cf\u200b select \u200b\u548c\u200b poll \u200b\u7684\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u60c5\u51b5\u200b</li> </ul> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://www.jianshu.com/p/dfd940e7fca2</p> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://www.cnblogs.com/anker/p/3265058.html</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_221","title":"\u5e94\u7528","text":"<p>\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a </p> <ul> <li>select \u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a</li> <li>select \u200b\u7684\u200b timeout \u200b\u53c2\u6570\u200b\u7cbe\u5ea6\u200b\u4e3a\u200b\u5fae\u79d2\u200b\uff0cpoll \u200b\u548c\u200b epoll \u200b\u4e3a\u200b\u6beb\u79d2\u200b\uff0c\u200b\u56e0\u6b64\u200b select \u200b\u9002\u7528\u200b\u5b9e\u65f6\u6027\u200b\u8981\u6c42\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6838\u53cd\u5e94\u5806\u200b\u7684\u200b\u63a7\u5236\u200b</li> <li>select \u200b\u53ef\u79fb\u690d\u6027\u200b\u66f4\u597d\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u88ab\u200b\u6240\u6709\u200b\u4e3b\u6d41\u200b\u5e73\u53f0\u200b\u6240\u200b\u652f\u6301\u200b</li> <li>poll \u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1apoll \u200b\u6ca1\u6709\u200b\u6700\u5927\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u91cf\u200b\u7684\u200b\u9650\u5236\u200b\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u5e73\u53f0\u200b\u652f\u6301\u200b\u5e76\u4e14\u200b\u5bf9\u200b\u5b9e\u65f6\u6027\u200b\u8981\u6c42\u200b\u4e0d\u9ad8\u200b\u7684\u200b\u60c5\u51b5\u200b</li> <li>epoll \u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a</li> <li>\u200b\u8fd0\u884c\u200b\u5728\u200b Linux \u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0c\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u8f6e\u8be2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e9b\u200b\u8fde\u63a5\u200b\u6700\u597d\u200b\u662f\u200b\u957f\u200b\u8fde\u63a5\u200b</li> <li>\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u76d1\u63a7\u200b\u5c0f\u4e8e\u200b 1000 \u200b\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u6ca1\u200b\u5fc5\u8981\u200b\u4f7f\u7528\u200b epoll\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u4e2a\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\u4e0b\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u4f53\u73b0\u200b epoll \u200b\u7684\u200b\u4f18\u52bf\u200b</li> <li>\u200b\u9700\u8981\u200b\u76d1\u63a7\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u72b6\u6001\u200b\u53d8\u5316\u200b\u591a\u200b\uff0c\u200b\u800c\u4e14\u200b\u662f\u200b\u975e\u5e38\u200b\u77ed\u6682\u200b\u7684\u200b\uff0c\u200b\u5c31\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u4f7f\u7528\u200b epoll\u3002\u200b\u56e0\u4e3a\u200b epoll \u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u90fd\u200b\u5b58\u50a8\u200b\u5728\u200b\u5185\u6838\u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u5bf9\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u72b6\u6001\u200b\u6539\u53d8\u200b\u90fd\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b epoll_ctl() \u200b\u8fdb\u884c\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u9891\u7e41\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u964d\u4f4e\u200b\u6548\u7387\u200b\uff0c\u200b\u5e76\u4e14\u200b epoll \u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u5b58\u50a8\u200b\u5728\u200b\u5185\u6838\u200b\uff0c\u200b\u4e0d\u200b\u5bb9\u6613\u200b\u8c03\u8bd5\u200b</li> </ul> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://github.com/CyC2018/CS-Notes/blob/master/notes/Socket.md</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_222","title":"\u7cfb\u7edf\u200b\u8c03\u7528","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_223","title":"\u5185\u6838\u200b\u6001","text":"<p>\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\uff1a\u200b\u7528\u6237\u200b\u4ee3\u7801\u200b\u3001\u200b\u7528\u6237\u200b\u5806\u6808\u200b</p> <p>\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\uff1a\u200b\u5185\u6838\u200b\u4ee3\u7801\u200b\u3001\u200b\u5185\u6838\u200b\u8c03\u5ea6\u200b\u7a0b\u5e8f\u200b\u3001\u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b\uff08\u200b\u5185\u6838\u200b\u5806\u6808\u200b\u3001thread_info \u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b\uff09</p> <ul> <li>\u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b\u548c\u200b\u7528\u6237\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u662f\u200b\u4e00\u4e00\u5bf9\u5e94\u200b\u7684\u200b</li> <li>SYS_API \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff1a\u200b\u5982\u200b read\u3001write\uff0c\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u5c31\u662f\u200b 0X80 \u200b\u4e2d\u65ad\u200b</li> <li>\u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b pd\uff1a\u200b\u8fdb\u7a0b\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u7528\u6237\u200b\u6001\u65f6\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u4fe1\u606f\u200b\u5728\u200b PCB \u200b\u4e2d\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\uff1a\u200b\u7528\u6237\u7a0b\u5e8f\u200b\u57fa\u200b\u5730\u5740\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u8ba1\u6570\u5668\u200b\u3001cpu cache\u3001\u200b\u5bc4\u5b58\u5668\u200b\u7b49\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u7a0b\u5e8f\u200b\u5207\u56de\u200b\u7528\u6237\u200b\u6001\u65f6\u200b\u6062\u590d\u200b\u73b0\u573a\u200b</li> <li>\u200b\u5185\u6838\u200b\u5806\u6808\u200b\uff1a\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u51fd\u6570\u200b\u4e5f\u200b\u662f\u200b\u8981\u200b\u521b\u5efa\u200b\u53d8\u91cf\u200b\u7684\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u53d8\u91cf\u200b\u5728\u200b\u5185\u6838\u200b\u5806\u6808\u200b\u4e0a\u200b\u5206\u914d\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#80","title":"80\u200b\u4e2d\u65ad","text":"<p>\u200b\u5728\u200b\u7528\u6237\u7a0b\u5e8f\u200b\u4e2d\u200b\u8c03\u7528\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u63d0\u4f9b\u200b\u7684\u200b\u6838\u5fc3\u200b\u6001\u200b\u7ea7\u522b\u200b\u7684\u200b\u5b50\u200b\u529f\u80fd\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u7cfb\u7edf\u5b89\u5168\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u8f6c\u6362\u200b\uff0c\u200b\u72b6\u6001\u200b\u7684\u200b\u8f6c\u6362\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b CPU \u200b\u4e2d\u65ad\u200b\uff0c\u200b\u4e2d\u65ad\u200b\u5206\u4e3a\u200b\u786c\u200b\u4e2d\u65ad\u200b\u548c\u200b\u8f6f\u200b\u4e2d\u65ad\u200b\uff1a</p> <ul> <li>\u200b\u786c\u200b\u4e2d\u65ad\u200b\uff1a\u200b\u5982\u200b\u7f51\u7edc\u200b\u4f20\u8f93\u200b\u4e2d\u200b\uff0c\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u7f51\u5361\u200b\u540e\u200b\uff0c\u200b\u7f51\u5361\u200b\u7ecf\u8fc7\u200b\u4e00\u7cfb\u5217\u200b\u64cd\u4f5c\u200b\u540e\u200b\u53d1\u8d77\u200b\u786c\u4ef6\u200b\u4e2d\u65ad\u200b</li> <li>\u200b\u8f6f\u200b\u4e2d\u65ad\u200b\uff1a\u200b\u5982\u200b\u7a0b\u5e8f\u8fd0\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u672c\u8eab\u200b\u4ea7\u751f\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4e2d\u65ad\u200b</li> <li>\u200b\u53d1\u8d77\u200b <code>0X80</code> \u200b\u4e2d\u65ad\u200b</li> <li>\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u78b0\u5230\u200b\u9664\u200b 0 \u200b\u5f02\u5e38\u200b</li> </ul> <p>\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b system_call \u200b\u51fd\u6570\u200b\u6240\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4e2d\u65ad\u200b\u6307\u4ee4\u200b\u7f16\u53f7\u200b\u662f\u200b 0X80\uff08\u200b\u5341\u8fdb\u5236\u200b\u662f\u200b 8\u00d716=128\uff09\uff0c\u200b\u800c\u200b\u8be5\u200b\u6307\u4ee4\u200b\u7f16\u53f7\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5c31\u662f\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5165\u53e3\u200b\uff0c\u200b\u6240\u4ee5\u200b\u79f0\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u4e3a\u200b 80 \u200b\u4e2d\u65ad\u200b</p> <p>\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b CPU \u200b\u5bc4\u5b58\u5668\u200b\u91cc\u5b58\u200b\u4e00\u4e2a\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u53f7\u200b\uff0c\u200b\u8868\u793a\u200b\u54ea\u4e2a\u200b\u7cfb\u7edf\u200b\u51fd\u6570\u200b\uff0c\u200b\u6bd4\u5982\u200b read</li> <li>\u200b\u5c06\u200b CPU \u200b\u7684\u200b\u4e34\u65f6\u200b\u6570\u636e\u200b\u90fd\u200b\u4fdd\u5b58\u200b\u5230\u200b thread_info \u200b\u4e2d\u200b</li> <li>\u200b\u6267\u884c\u200b 80 \u200b\u4e2d\u65ad\u200b\u5904\u7406\u7a0b\u5e8f\u200b\uff0c\u200b\u627e\u5230\u200b\u521a\u521a\u200b\u5b58\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u53f7\u200b\uff08read\uff09\uff0c\u200b\u5148\u200b\u68c0\u67e5\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u6709\u6ca1\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5c31\u200b\u53bb\u200b\u78c1\u76d8\u200b\u4e2d\u200b\u52a0\u8f7d\u200b\u5230\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u7136\u540e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u6700\u540e\u200b\u6062\u590d\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b\uff0c\u200b\u901a\u8fc7\u200b thread_info \u200b\u6062\u590d\u200b\u73b0\u573a\u200b\uff0c\u200b\u7528\u6237\u200b\u6001\u200b\u7ee7\u7eed\u6267\u884c\u200b</li> </ul> <p></p> <p>\u200b\u53c2\u8003\u200b\u89c6\u9891\u200b\uff1ahttps://www.bilibili.com/video/BV19D4y1o797</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_224","title":"\u96f6\u200b\u62f7\u8d1d","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#dma","title":"DMA","text":"<p>DMA (Direct Memory Access) \uff1a\u200b\u76f4\u63a5\u200b\u5b58\u50a8\u5668\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u8ba9\u200b\u5916\u90e8\u8bbe\u5907\u200b\u4e0d\u200b\u901a\u8fc7\u200b CPU \u200b\u76f4\u63a5\u200b\u4e0e\u200b\u7cfb\u7edf\u200b\u5185\u5b58\u200b\u4ea4\u6362\u200b\u6570\u636e\u200b\u7684\u200b\u63a5\u53e3\u6280\u672f\u200b</p> <p>\u200b\u4f5c\u7528\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200b\u6279\u91cf\u200b\u6570\u636e\u200b\u7684\u200b\u8f93\u5165\u200b/\u200b\u8f93\u51fa\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f7f\u200b\u6570\u636e\u200b\u7684\u200b\u4f20\u9001\u901f\u5ea6\u200b\u53d6\u51b3\u4e8e\u200b\u5b58\u50a8\u5668\u200b\u548c\u200b\u5916\u8bbe\u200b\u7684\u200b\u5de5\u4f5c\u200b\u901f\u5ea6\u200b</p> <p>\u200b\u628a\u200b\u5185\u5b58\u200b\u6570\u636e\u4f20\u8f93\u200b\u5230\u200b\u7f51\u5361\u200b\u7136\u540e\u200b\u53d1\u9001\u200b\uff1a</p> <ul> <li>\u200b\u6ca1\u6709\u200b DMA\uff1aCPU \u200b\u8bfb\u200b\u5185\u5b58\u200b\u6570\u636e\u200b\u5230\u200b CPU \u200b\u9ad8\u901f\u7f13\u5b58\u200b\uff0c\u200b\u518d\u200b\u5199\u200b\u5230\u200b\u7f51\u5361\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u628a\u200b CPU \u200b\u7684\u200b\u901f\u5ea6\u200b\u62c9\u4f4e\u200b\u5230\u200b\u548c\u200b\u7f51\u5361\u200b\u4e00\u4e2a\u200b\u901f\u5ea6\u200b</li> <li>\u200b\u4f7f\u7528\u200b DMA\uff1a\u200b\u628a\u200b\u6570\u636e\u200b\u8bfb\u200b\u5230\u200b Socket \u200b\u5185\u6838\u200b\u7f13\u5b58\u200b\u533a\u200b\uff08CPU \u200b\u590d\u5236\u200b\uff09\uff0cCPU \u200b\u5206\u914d\u200b\u7ed9\u200b DMA \u200b\u5f00\u59cb\u200b\u5f02\u6b65\u200b\u64cd\u4f5c\u200b\uff0cDMA \u200b\u8bfb\u53d6\u200b Socket \u200b\u7f13\u51b2\u533a\u200b\u5230\u200b DMA \u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u7136\u540e\u200b\u5199\u200b\u5230\u200b\u7f51\u5361\u200b\u3002DMA \u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u4e2d\u65ad\u200b\uff08\u200b\u5c31\u662f\u200b\u901a\u77e5\u200b\uff09 CPU\uff0c\u200b\u8fd9\u65f6\u200b Socket \u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u4e3a\u7a7a\u200b\uff0cCPU \u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u200b\uff0c\u200b\u6267\u884c\u200b\u4e2d\u65ad\u200b\u5904\u7406\u7a0b\u5e8f\u200b\uff0c\u200b\u5c06\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b Socket \u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u963b\u585e\u200b\u8fdb\u7a0b\u200b\u79fb\u200b\u5230\u200b\u5c31\u7eea\u200b\u961f\u5217\u200b</li> </ul> <p>\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b DMA \u200b\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u5fc5\u987b\u200b\u7ecf\u5386\u200b DMA \u200b\u8bf7\u6c42\u200b\u3001DMA \u200b\u54cd\u5e94\u200b\u3001DMA \u200b\u4f20\u8f93\u200b\u3001DMA \u200b\u7ed3\u675f\u200b\u56db\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <p></p> <p>DMA \u200b\u65b9\u5f0f\u200b\u662f\u200b\u4e00\u79cd\u200b\u5b8c\u5168\u200b\u7531\u200b\u786c\u4ef6\u200b\u8fdb\u884c\u200b\u4fe1\u606f\u200b\u4f20\u9001\u200b\u7684\u200b\u63a7\u5236\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u901a\u5e38\u200b\u7cfb\u7edf\u603b\u7ebf\u200b\u7531\u200b CPU \u200b\u7ba1\u7406\u200b\uff0c\u200b\u5728\u200b DMA \u200b\u65b9\u5f0f\u200b\u4e2d\u200b\uff0cCPU \u200b\u7684\u200b\u4e3b\u5b58\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\u88ab\u200b\u7981\u6b62\u200b\u4f7f\u7528\u200b\uff0cCPU \u200b\u628a\u200b\u603b\u7ebf\u200b\uff08\u200b\u5730\u5740\u603b\u7ebf\u200b\u3001\u200b\u6570\u636e\u603b\u7ebf\u200b\u3001\u200b\u63a7\u5236\u200b\u603b\u7ebf\u200b\uff09\u200b\u8ba9\u200b\u51fa\u6765\u200b\u7531\u200b DMA \u200b\u63a7\u5236\u5668\u200b\u63a5\u7ba1\u200b\uff0c\u200b\u7528\u6765\u200b\u63a7\u5236\u200b\u4f20\u9001\u200b\u7684\u200b\u5b57\u8282\u6570\u200b\u3001\u200b\u5224\u65ad\u200b DMA \u200b\u662f\u5426\u200b\u7ed3\u675f\u200b\u3001\u200b\u4ee5\u53ca\u200b\u53d1\u51fa\u200b DMA \u200b\u7ed3\u675f\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6240\u4ee5\u200b DMA \u200b\u63a7\u5236\u5668\u200b\u5fc5\u987b\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u529f\u80fd\u200b\uff1a</p> <ul> <li>\u200b\u63a5\u53d7\u200b\u5916\u8bbe\u200b\u53d1\u51fa\u200b\u7684\u200b DMA \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5e76\u200b\u5411\u200b CPU \u200b\u53d1\u51fa\u200b\u603b\u7ebf\u200b\u63a5\u7ba1\u200b\u8bf7\u6c42\u200b</li> <li>\u200b\u5f53\u200b CPU \u200b\u53d1\u51fa\u200b\u5141\u8bb8\u200b\u63a5\u7ba1\u200b\u4fe1\u53f7\u200b\u540e\u200b\uff0c\u200b\u8fdb\u5165\u200b DMA \u200b\u64cd\u4f5c\u200b\u5468\u671f\u200b</li> <li>\u200b\u786e\u5b9a\u200b\u4f20\u9001\u6570\u636e\u200b\u7684\u200b\u4e3b\u5b58\u200b\u5355\u5143\u200b\u5730\u5740\u200b\u53ca\u200b\u957f\u5ea6\u200b\uff0c\u200b\u5e76\u200b\u81ea\u52a8\u200b\u4fee\u6539\u200b\u4e3b\u5b58\u200b\u5730\u5740\u200b\u8ba1\u6570\u200b\u548c\u200b\u4f20\u9001\u200b\u957f\u5ea6\u200b\u8ba1\u6570\u200b</li> <li>\u200b\u89c4\u5b9a\u200b\u6570\u636e\u200b\u5728\u200b\u4e3b\u5b58\u200b\u548c\u200b\u5916\u8bbe\u200b\u95f4\u200b\u7684\u200b\u4f20\u9001\u200b\u65b9\u5411\u200b\uff0c\u200b\u53d1\u51fa\u200b\u8bfb\u5199\u200b\u7b49\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6267\u884c\u200b\u6570\u636e\u200b\u4f20\u9001\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u5224\u65ad\u200b DMA \u200b\u4f20\u9001\u200b\u662f\u5426\u200b\u7ed3\u675f\u200b\uff0c\u200b\u53d1\u51fa\u200b DMA \u200b\u7ed3\u675f\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u4f7f\u200b CPU \u200b\u6062\u590d\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u72b6\u6001\u200b\uff08\u200b\u4e2d\u65ad\u200b\uff09</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#bio","title":"BIO","text":"<p>\u200b\u4f20\u7edf\u200b\u7684\u200b I/O \u200b\u64cd\u4f5c\u200b\u8fdb\u884c\u200b\u4e86\u200b 4 \u200b\u6b21\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u4e0e\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u4ee5\u53ca\u200b 4 \u200b\u6b21\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b\uff1a</p> <ul> <li>JVM \u200b\u53d1\u51fa\u200b read \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0cOS \u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6a21\u5f0f\u200b\uff08\u200b\u5207\u6362\u200b 1\uff09\u200b\u5e76\u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200b\u7f51\u5361\u200b\u6216\u200b\u786c\u76d8\u200b\u7b49\u200b\u8bbe\u5907\u200b\u901a\u8fc7\u200b DMA \u200b\u8bfb\u53d6\u200b\u5230\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7f13\u51b2\u533a\u200b\uff08\u200b\u62f7\u8d1d\u200b 1\uff09\uff0c\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u78c1\u76d8\u200b\u9ad8\u901f\u7f13\u5b58\u200b\uff08PageCache\uff09</li> <li>OS \u200b\u5185\u6838\u200b\u5c06\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u7f13\u51b2\u533a\u200b\uff08\u200b\u62f7\u8d1d\u200b 2\uff09\uff0c\u200b\u7136\u540e\u200b read \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\uff0c\u200b\u53c8\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e00\u6b21\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff08\u200b\u5207\u6362\u200b 2\uff09</li> <li>JVM \u200b\u5904\u7406\u200b\u4ee3\u7801\u200b\u903b\u8f91\u200b\u5e76\u200b\u53d1\u9001\u200b write() \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0cOS \u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6a21\u5f0f\u200b\uff08\u200b\u5207\u6362\u200b3\uff09\u200b\u5e76\u200b\u4ece\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u200b\u6570\u636e\u200b\u5230\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7f13\u51b2\u533a\u200b\uff08\u200b\u62f7\u8d1d\u200b3\uff09</li> <li>\u200b\u5c06\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u200b\u5230\u200b hardware\uff08\u200b\u62f7\u8d1d\u200b4\uff09\uff0cwrite \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u7684\u200b\u518d\u6b21\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff08\u200b\u5207\u6362\u200b4\uff09</li> </ul> <p>\u200b\u6d41\u7a0b\u56fe\u200b\u4e2d\u200b\u7684\u200b\u7bad\u5934\u200b\u53cd\u8fc7\u6765\u200b\u4e5f\u200b\u6210\u7acb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u7f51\u5361\u200b\u83b7\u53d6\u6570\u636e\u200b</p> <p></p> <p>read \u200b\u8c03\u7528\u200b\u56fe\u793a\u200b\uff1aread\u3001write \u200b\u90fd\u200b\u662f\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u6307\u4ee4\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#mmap","title":"mmap","text":"<p>mmap\uff08Memory Mapped Files\uff09\u200b\u5185\u5b58\u200b\u6620\u5c04\u200b\u52a0\u200b write \u200b\u5b9e\u73b0\u200b\u96f6\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u96f6\u200b\u62f7\u8d1d\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u590d\u5236\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b</p> <p>\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u548c\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u90fd\u200b\u4f7f\u7528\u200b\u5185\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u540c\u200b\u4e00\u5757\u200b\u7269\u7406\u200b\u5185\u5b58\u5730\u5740\u200b\uff0c\u200b\u7701\u53bb\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u4e4b\u95f4\u200b\u7684\u200b\u62f7\u8d1d\u200b\u3002\u200b\u5199\u200b\u7f51\u5361\u200b\u65f6\u200b\uff0c\u200b\u5171\u4eab\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5185\u5bb9\u200b\u62f7\u8d1d\u5230\u200b Socket \u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u7136\u540e\u200b\u4ea4\u7ed9\u200b DMA \u200b\u53d1\u9001\u5230\u200b\u7f51\u5361\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b 3 \u200b\u6b21\u200b\u590d\u5236\u200b</p> <p>\u200b\u8fdb\u884c\u200b\u4e86\u200b 4 \u200b\u6b21\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u4e0e\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u4ee5\u53ca\u200b 3 \u200b\u6b21\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b\uff082 \u200b\u6b21\u200b DMA\uff0c\u200b\u4e00\u6b21\u200b CPU \u200b\u590d\u5236\u200b\uff09\uff1a</p> <ul> <li>\u200b\u53d1\u51fa\u200b mmap \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0cDMA \u200b\u62f7\u8d1d\u5230\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u6620\u5c04\u200b\u5230\u200b\u5171\u4eab\u200b\u7f13\u51b2\u533a\u200b\uff1bmmap \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\uff0c\u200b\u65e0\u9700\u200b\u62f7\u8d1d\u200b</li> <li>\u200b\u53d1\u51fa\u200b write \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u62f7\u8d1d\u5230\u200b\u5185\u6838\u200b Socket \u200b\u7f13\u51b2\u533a\u200b\uff1bwrite \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\uff0cDMA \u200b\u5c06\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b Socket \u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u4f20\u9012\u200b\u5230\u200b\u534f\u8bae\u200b\u5f15\u64ce\u200b</li> </ul> <p></p> <p>\u200b\u539f\u7406\u200b\uff1a\u200b\u5229\u7528\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b Page \u200b\u6765\u200b\u5b9e\u73b0\u200b\u6587\u4ef6\u200b\u5230\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u7684\u200b\u76f4\u63a5\u200b\u6620\u5c04\u200b\uff0c\u200b\u5b8c\u6210\u200b\u6620\u5c04\u200b\u540e\u200b\u5bf9\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u7684\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u88ab\u200b\u540c\u6b65\u200b\u5230\u200b\u786c\u76d8\u200b\u4e0a\u200b</p> <p>\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u4e0d\u200b\u53ef\u9760\u200b\uff0c\u200b\u5199\u200b\u5230\u200b mmap \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5e76\u200b\u6ca1\u6709\u200b\u88ab\u200b\u771f\u6b63\u200b\u7684\u200b\u5199\u200b\u5230\u200b\u786c\u76d8\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4f1a\u200b\u5728\u200b\u7a0b\u5e8f\u200b\u4e3b\u52a8\u200b\u8c03\u7528\u200b flush \u200b\u7684\u200b\u65f6\u5019\u200b\u624d\u200b\u628a\u200b\u6570\u636e\u200b\u771f\u6b63\u200b\u7684\u200b\u5199\u200b\u5230\u200b\u786c\u76d8\u200b</p> <p>Java NIO \u200b\u63d0\u4f9b\u200b\u4e86\u200b MappedByteBuffer \u200b\u7c7b\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5b9e\u73b0\u200b mmap \u200b\u5185\u5b58\u200b\u6620\u5c04\u200b\uff0cMappedByteBuffer \u200b\u7c7b\u200b\u5bf9\u8c61\u200b\u53ea\u80fd\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b <code>FileChannel.map()</code> \u200b\u83b7\u53d6\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#sendfile","title":"sendfile","text":"<p>sendfile \u200b\u5b9e\u73b0\u200b\u96f6\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u6253\u5f00\u200b\u6587\u4ef6\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b fd \u200b\u548c\u200b socket \u200b\u7684\u200b fd \u200b\u4f20\u9012\u200b\u7ed9\u200b sendfile\uff0c\u200b\u7136\u540e\u200b\u7ecf\u8fc7\u200b 3 \u200b\u6b21\u200b\u590d\u5236\u200b\u548c\u200b 2 \u200b\u6b21\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u5207\u6362\u200b</p> <p>\u200b\u539f\u7406\u200b\uff1a\u200b\u6570\u636e\u200b\u6839\u672c\u200b\u4e0d\u200b\u7ecf\u8fc7\u200b\u7528\u6237\u200b\u6001\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u8fdb\u5165\u200b\u5230\u200b Socket Buffer\uff0c\u200b\u7531\u4e8e\u200b\u548c\u200b\u7528\u6237\u200b\u6001\u200b\u5b8c\u5168\u200b\u65e0\u5173\u200b\uff0c\u200b\u5c31\u200b\u51cf\u5c11\u200b\u4e86\u200b\u4e24\u6b21\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b</p> <p>\u200b\u8bf4\u660e\u200b\uff1a\u200b\u96f6\u200b\u62f7\u8d1d\u200b\u6280\u672f\u200b\u662f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u8fdb\u7a0b\u200b\u5bf9\u200b\u6587\u4ef6\u200b\u5185\u5bb9\u200b\u4f5c\u200b\u8fdb\u4e00\u6b65\u200b\u7684\u200b\u52a0\u5de5\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\u538b\u7f29\u200b\u6570\u636e\u200b\u518d\u200b\u53d1\u9001\u200b</p> <p></p> <p>sendfile2.4 \u200b\u4e4b\u540e\u200b\uff0csendfile \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u66f4\u200b\u7b80\u5355\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u6587\u4ef6\u200b\u5230\u8fbe\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u540e\u200b\uff0c\u200b\u4e0d\u5fc5\u200b\u518d\u200b\u5c06\u200b\u6570\u636e\u200b\u5168\u90e8\u200b\u590d\u5236\u5230\u200b socket buffer \u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u800c\u662f\u200b\u53ea\u200b\u5c06\u200b\u8bb0\u5f55\u200b\u6570\u636e\u200b\u4f4d\u7f6e\u200b\u548c\u200b\u957f\u5ea6\u200b\u76f8\u5173\u200b\u7b49\u200b\u63cf\u8ff0\u7b26\u200b\u4fe1\u606f\u200b\u4fdd\u5b58\u200b\u5230\u200b socket buffer\uff0cDMA \u200b\u6839\u636e\u200b Socket \u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u63cf\u8ff0\u7b26\u200b\u63d0\u4f9b\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u548c\u200b\u504f\u79fb\u91cf\u200b\u4fe1\u606f\u200b\u76f4\u63a5\u200b\u5c06\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u62f7\u8d1d\u5230\u200b\u534f\u8bae\u200b\u5f15\u64ce\u200b\u4e0a\u200b\uff082 \u200b\u6b21\u200b\u590d\u5236\u200b 2 \u200b\u6b21\u200b\u5207\u6362\u200b\uff09</p> <p>Java NIO \u200b\u5bf9\u200b sendfile \u200b\u7684\u200b\u652f\u6301\u200b\u662f\u200b <code>FileChannel.transferTo()/transferFrom()</code>\uff0c\u200b\u628a\u200b\u78c1\u76d8\u200b\u6587\u4ef6\u200b\u8bfb\u53d6\u200b OS \u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u540e\u200b\u7684\u200b fileChannel\uff0c\u200b\u76f4\u63a5\u200b\u8f6c\u7ed9\u200b socketChannel \u200b\u53d1\u9001\u200b\uff0c\u200b\u5e95\u5c42\u200b\u5c31\u662f\u200b sendfile</p> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://blog.csdn.net/hancoder/article/details/112149121</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#bio_1","title":"BIO","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#inet","title":"Inet","text":"<p>\u200b\u4e00\u4e2a\u200b InetAddress \u200b\u7c7b\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5c31\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b IP \u200b\u5730\u5740\u200b\u5bf9\u8c61\u200b</p> <p>\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>static InetAddress getLocalHost()</code>\uff1a\u200b\u83b7\u5f97\u200b\u672c\u5730\u200b\u4e3b\u673a\u200b IP \u200b\u5730\u5740\u200b\u5bf9\u8c61\u200b</li> <li><code>static InetAddress getByName(String host)</code>\uff1a\u200b\u6839\u636e\u200b IP \u200b\u5730\u5740\u200b\u5b57\u7b26\u4e32\u200b\u6216\u200b\u4e3b\u673a\u540d\u200b\u83b7\u5f97\u200b\u5bf9\u5e94\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u5bf9\u8c61\u200b</li> <li><code>String getHostName()</code>\uff1a\u200b\u83b7\u53d6\u200b\u4e3b\u673a\u540d\u200b</li> <li><code>String getHostAddress()</code>\uff1a\u200b\u83b7\u5f97\u200b IP \u200b\u5730\u5740\u200b\u5b57\u7b26\u4e32\u200b</li> </ul> Java<pre><code>public class InetAddressDemo {\n    public static void main(String[] args) throws Exception {\n        // 1.\u200b\u83b7\u53d6\u200b\u672c\u200b\u673a\u200b\u5730\u5740\u200b\u5bf9\u8c61\u200b\n        InetAddress ip = InetAddress.getLocalHost();\n        System.out.println(ip.getHostName());//DESKTOP-NNMBHQR\n        System.out.println(ip.getHostAddress());//192.168.11.1\n        // 2.\u200b\u83b7\u53d6\u200b\u57df\u540d\u200bip\u200b\u5bf9\u8c61\u200b\n        InetAddress ip2 = InetAddress.getByName(\"www.baidu.com\");\n        System.out.println(ip2.getHostName());//www.baidu.com\n        System.out.println(ip2.getHostAddress());//14.215.177.38\n        // 3.\u200b\u83b7\u53d6\u200b\u516c\u7f51\u200bIP\u200b\u5bf9\u8c61\u200b\u3002\n        InetAddress ip3 = InetAddress.getByName(\"182.61.200.6\");\n        System.out.println(ip3.getHostName());//182.61.200.6\n        System.out.println(ip3.getHostAddress());//182.61.200.6\n\n        // 4.\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u80fd\u901a\u200b\uff1a ping  5s\u200b\u4e4b\u524d\u200b\u6d4b\u8bd5\u200b\u662f\u5426\u200b\u53ef\u901a\u200b\n        System.out.println(ip2.isReachable(5000)); // ping\u200b\u767e\u5ea6\u200b\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#udp","title":"UDP","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_225","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>UDP\uff08User Datagram Protocol\uff09\u200b\u534f\u8bae\u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u9762\u5411\u200b\u65e0\u200b\u8fde\u63a5\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u53d1\u9001\u200b\u7aef\u200b\u53ea\u7ba1\u200b\u53d1\u9001\u200b\uff0c\u200b\u4e0d\u200b\u786e\u8ba4\u200b\u5bf9\u65b9\u200b\u662f\u5426\u200b\u80fd\u200b\u6536\u5230\u200b\uff0c\u200b\u901f\u5ea6\u200b\u5feb\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u53ef\u9760\u200b\uff0c\u200b\u4f1a\u200b\u4e22\u5931\u200b\u6570\u636e\u200b</li> <li>\u200b\u5c3d\u200b\u6700\u5927\u200b\u52aa\u529b\u200b\u4ea4\u4ed8\u200b\uff0c\u200b\u6ca1\u6709\u200b\u62e5\u585e\u200b\u63a7\u5236\u200b</li> <li>\u200b\u57fa\u4e8e\u200b\u6570\u636e\u5305\u200b\u8fdb\u884c\u200b\u6570\u636e\u4f20\u8f93\u200b\uff0c\u200b\u53d1\u9001\u6570\u636e\u200b\u7684\u200b\u5305\u200b\u7684\u200b\u5927\u5c0f\u200b\u9650\u5236\u200b 64KB \u200b\u4ee5\u5185\u200b</li> <li>\u200b\u652f\u6301\u200b\u4e00\u5bf9\u4e00\u200b\u3001\u200b\u4e00\u5bf9\u200b\u591a\u200b\u3001\u200b\u591a\u200b\u5bf9\u200b\u4e00\u200b\u3001\u200b\u591a\u200b\u5bf9\u200b\u591a\u200b\u7684\u200b\u4ea4\u4e92\u200b\u901a\u4fe1\u200b</li> </ul> <p>UDP \u200b\u534f\u8bae\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u5728\u7ebf\u89c6\u9891\u200b\u3001\u200b\u7f51\u7edc\u200b\u8bed\u97f3\u200b\u3001\u200b\u7535\u8bdd\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#udp_1","title":"\u5b9e\u73b0\u200bUDP","text":"<p>UDP \u200b\u534f\u8bae\u200b\u76f8\u5173\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7c7b\u200b\uff1a</p> <ul> <li>DatagramPacket\uff08\u200b\u6570\u636e\u5305\u200b\u5bf9\u8c61\u200b\uff09\uff1a\u200b\u7528\u6765\u200b\u5c01\u88c5\u200b\u8981\u200b\u53d1\u9001\u200b\u6216\u200b\u8981\u200b\u63a5\u6536\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a\u200b\u96c6\u88c5\u7bb1\u200b</li> <li>DatagramSocket\uff08\u200b\u53d1\u9001\u200b\u5bf9\u8c61\u200b\uff09\uff1a\u200b\u7528\u6765\u200b\u53d1\u9001\u200b\u6216\u200b\u63a5\u6536\u200b\u6570\u636e\u5305\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a\u200b\u7801\u5934\u200b</li> </ul> <p>DatagramPacket\uff1a</p> <ul> <li>DatagramPacket \u200b\u7c7b\u200b\uff1a</li> </ul> <p><code>public new DatagramPacket(byte[] buf, int length, InetAddress address, int port)</code>\uff1a\u200b\u521b\u5efa\u200b\u53d1\u9001\u200b\u7aef\u200b\u6570\u636e\u5305\u200b\u5bf9\u8c61\u200b </p> <ul> <li>buf\uff1a\u200b\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5b57\u8282\u200b\u6570\u7ec4\u200b</li> <li>length\uff1a\u200b\u8981\u200b\u53d1\u9001\u200b\u5185\u5bb9\u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b\u5b57\u8282\u200b</li> <li>address\uff1a\u200b\u63a5\u6536\u7aef\u200b\u7684\u200bIP\u200b\u5730\u5740\u200b\u5bf9\u8c61\u200b</li> <li>port\uff1a\u200b\u63a5\u6536\u7aef\u200b\u7684\u200b\u7aef\u53e3\u53f7\u200b</li> </ul> <p><code>public new DatagramPacket(byte[] buf, int length)</code>\uff1a\u200b\u521b\u5efa\u200b\u63a5\u6536\u7aef\u200b\u7684\u200b\u6570\u636e\u5305\u200b\u5bf9\u8c61\u200b</p> <ul> <li>buf\uff1a\u200b\u7528\u6765\u200b\u5b58\u50a8\u200b\u63a5\u6536\u200b\u5230\u200b\u5185\u5bb9\u200b       </li> <li>length\uff1a\u200b\u80fd\u591f\u200b\u63a5\u6536\u200b\u5185\u5bb9\u200b\u7684\u200b\u957f\u5ea6\u200b</li> <li> <p>DatagramPacket \u200b\u7c7b\u200b\u5e38\u7528\u200b\u65b9\u6cd5\u200b\uff1a</p> </li> <li> <p><code>public int getLength()</code>\uff1a\u200b\u83b7\u5f97\u200b\u5b9e\u9645\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u5b57\u8282\u200b\u4e2a\u6570\u200b</p> </li> <li><code>public byte[] getData()</code>\uff1a\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b\u7f13\u51b2\u533a\u200b</li> </ul> <p>DatagramSocket\uff1a</p> <ul> <li>DatagramSocket \u200b\u7c7b\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</li> <li><code>protected DatagramSocket()</code>\uff1a\u200b\u521b\u5efa\u200b\u53d1\u9001\u200b\u7aef\u7684\u200b Socket \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u4f1a\u200b\u968f\u673a\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u7aef\u53e3\u53f7\u200b</li> <li><code>protected DatagramSocket(int port)</code>\uff1a\u200b\u521b\u5efa\u200b\u63a5\u6536\u7aef\u200b\u7684\u200b Socket \u200b\u5bf9\u8c61\u200b\u5e76\u200b\u6307\u5b9a\u200b\u7aef\u53e3\u53f7\u200b</li> <li>DatagramSocket \u200b\u7c7b\u200b\u6210\u5458\u200b\u65b9\u6cd5\u200b\uff1a</li> <li><code>public void send(DatagramPacket dp)</code>\uff1a\u200b\u53d1\u9001\u200b\u6570\u636e\u5305\u200b</li> <li><code>public void receive(DatagramPacket p)</code>\uff1a\u200b\u63a5\u6536\u200b\u6570\u636e\u5305\u200b</li> <li><code>public void close()</code>\uff1a\u200b\u5173\u95ed\u200b\u6570\u636e\u200b\u62a5\u5957\u200b\u63a5\u5b57\u200b</li> </ul> Java<pre><code>public class UDPClientDemo {\n    public static void main(String[] args) throws Exception {\n        System.out.println(\"===\u200b\u542f\u52a8\u200b\u5ba2\u6237\u7aef\u200b===\");\n        // 1.\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u96c6\u88c5\u7bb1\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5c01\u88c5\u200b\u9700\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u5305\u200b!\n        byte[] buffer = \"\u200b\u6211\u5b66\u200bJava\".getBytes();\n        DatagramPacket packet = new DatagramPacket(buffer,bubffer.length,InetAddress.getLoclHost,8000);\n        // 2.\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7801\u5934\u200b\u5bf9\u8c61\u200b\n        DatagramSocket socket = new DatagramSocket();\n        // 3.\u200b\u5f00\u59cb\u200b\u53d1\u9001\u200b\u6570\u636e\u5305\u200b\u5bf9\u8c61\u200b\n        socket.send(packet);\n        socket.close();\n    }\n}\npublic class UDPServerDemo{\n    public static void main(String[] args) throws Exception {\n        System.out.println(\"==\u200b\u542f\u52a8\u200b\u670d\u52a1\u7aef\u200b\u7a0b\u5e8f\u200b==\");\n        // 1.\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u63a5\u6536\u200b\u5ba2\u6237\u200b\u90fd\u200b\u7aef\u7684\u200b\u6570\u636e\u5305\u200b\u5bf9\u8c61\u200b\uff08\u200b\u96c6\u88c5\u7bb1\u200b\uff09\n        byte[] buffer = new byte[1024*64];\n        DatagramPacket packet = new DatagramPacket(buffer, bubffer.length);\n        // 2.\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u63a5\u6536\u7aef\u200b\u7684\u200b\u7801\u5934\u200b\u5bf9\u8c61\u200b\n        DatagramSocket socket = new DatagramSocket(8000);\n        // 3.\u200b\u5f00\u59cb\u200b\u63a5\u6536\u200b\n        socket.receive(packet);\n        // 4.\u200b\u4ece\u200b\u96c6\u88c5\u7bb1\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u672c\u6b21\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\n        int len = packet.getLength();\n        // 5.\u200b\u8f93\u51fa\u200b\u6570\u636e\u200b\n        // String rs = new String(socket.getData(), 0, len)\n        String rs = new String(buffer , 0 , len);\n        System.out.println(rs);\n        // 6.\u200b\u670d\u52a1\u7aef\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u53d1\u6765\u200b\u4fe1\u606f\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200bIP\u200b\u548c\u200b\u7aef\u53e3\u200b\u3002\n        String ip = packet.getAddress().getHostAdress();\n        int port = packet.getPort();\n        socket.close();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_226","title":"\u901a\u8baf\u200b\u65b9\u5f0f","text":"<p>UDP \u200b\u901a\u4fe1\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>\u200b\u5355\u64ad\u200b\uff1a\u200b\u7528\u4e8e\u200b\u4e24\u4e2a\u200b\u4e3b\u673a\u200b\u4e4b\u95f4\u200b\u7684\u200b\u7aef\u200b\u5bf9\u200b\u7aef\u200b\u901a\u4fe1\u200b</li> <li>\u200b\u7ec4\u64ad\u200b\uff1a\u200b\u7528\u4e8e\u200b\u5bf9\u200b\u4e00\u7ec4\u200b\u7279\u5b9a\u200b\u7684\u200b\u4e3b\u673a\u200b\u8fdb\u884c\u200b\u901a\u4fe1\u200b</li> </ul> <p>IP : 224.0.1.0</p> <p>Socket \u200b\u5bf9\u8c61\u200b : MulticastSocket</p> <ul> <li>\u200b\u5e7f\u64ad\u200b\uff1a\u200b\u7528\u4e8e\u200b\u4e00\u4e2a\u200b\u4e3b\u673a\u200b\u5bf9\u200b\u6574\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u4e0a\u200b\u6240\u6709\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u901a\u4fe1\u200b</li> </ul> <p>IP : 255.255.255.255</p> <p>Socket \u200b\u5bf9\u8c61\u200b : DatagramSocket</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#tcp","title":"TCP","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_227","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>TCP/IP (Transfer Control Protocol) \u200b\u534f\u8bae\u200b\uff0c\u200b\u4f20\u8f93\u63a7\u5236\u534f\u8bae\u200b</p> <p>TCP/IP \u200b\u534f\u8bae\u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u9762\u5411\u200b\u8fde\u63a5\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u53ef\u9760\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u901f\u5ea6\u6162\u200b</li> <li>\u200b\u70b9\u5bf9\u70b9\u200b\u7684\u200b\u5168\u53cc\u5de5\u200b\u901a\u4fe1\u200b</li> <li>\u200b\u901a\u8fc7\u200b\u4e09\u6b21\u200b\u63e1\u624b\u200b\u5efa\u7acb\u200b\u8fde\u63a5\u200b\uff0c\u200b\u8fde\u63a5\u200b\u6210\u529f\u200b\u5f62\u6210\u200b\u6570\u636e\u4f20\u8f93\u200b\u901a\u9053\u200b\uff1b\u200b\u901a\u8fc7\u200b\u56db\u6b21\u200b\u6325\u624b\u200b\u65ad\u5f00\u8fde\u63a5\u200b</li> <li>\u200b\u57fa\u4e8e\u200b\u5b57\u8282\u200b\u6d41\u200b\u8fdb\u884c\u200b\u6570\u636e\u4f20\u8f93\u200b\uff0c\u200b\u4f20\u8f93\u6570\u636e\u200b\u5927\u5c0f\u200b\u6ca1\u6709\u200b\u9650\u5236\u200b</li> </ul> <p>TCP \u200b\u534f\u8bae\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u6587\u4ef6\u200b\u4e0a\u4f20\u200b\u548c\u200b\u4e0b\u8f7d\u200b\u3001\u200b\u90ae\u4ef6\u200b\u53d1\u9001\u200b\u548c\u200b\u63a5\u6536\u200b\u3001\u200b\u8fdc\u7a0b\u200b\u767b\u5f55\u200b</p> <p>\u200b\u6ce8\u610f\u200b\uff1aTCP \u200b\u4e0d\u4f1a\u200b\u4e3a\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u7684\u200b ACK \u200b\u8d85\u65f6\u200b\u91cd\u4f20\u200b</p> <p></p> <p></p> <p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1ahttps://yuanrengu.com/2020/77eef79f.html</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#socket","title":"Socket","text":"<p>TCP \u200b\u901a\u4fe1\u200b\u4e5f\u200b\u53eb\u200b Socket \u200b\u7f51\u7edc\u200b\u7f16\u7a0b\u200b\uff0c\u200b\u53ea\u8981\u200b\u4ee3\u7801\u200b\u57fa\u4e8e\u200b Socket \u200b\u5f00\u53d1\u200b\uff0c\u200b\u5e95\u5c42\u200b\u5c31\u662f\u200b\u57fa\u4e8e\u200b\u4e86\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\u7684\u200b TCP \u200b\u901a\u4fe1\u200b</p> <p>\u200b\u53cc\u5411\u901a\u4fe1\u200b\uff1aJava Socket \u200b\u662f\u200b\u5168\u53cc\u5de5\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u4efb\u610f\u200b\u65f6\u523b\u200b\uff0c\u200b\u7ebf\u8def\u200b\u4e0a\u200b\u5b58\u5728\u200b <code>A -&gt; B</code> \u200b\u548c\u200b <code>B -&gt; A</code> \u200b\u7684\u200b\u53cc\u5411\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\uff0c\u200b\u5373\u4f7f\u200b\u662f\u200b\u963b\u585e\u200b IO\uff0c\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u4e5f\u200b\u662f\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u7684\u200b\uff0c\u200b\u53ea\u8981\u200b\u5206\u522b\u200b\u91c7\u7528\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u5373\u53ef\u200b\uff0c\u200b\u8bfb\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b\u5199\u200b\u3001\u200b\u5199\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b\u8bfb\u200b</p> <p>TCP \u200b\u534f\u8bae\u200b\u76f8\u5173\u200b\u7684\u200b\u7c7b\u200b\uff1a</p> <ul> <li>Socket\uff1a\u200b\u4e00\u4e2a\u200b\u8be5\u7c7b\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5c31\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u7a0b\u5e8f\u200b\u3002</li> <li>ServerSocket\uff1a\u200b\u4e00\u4e2a\u200b\u8be5\u7c7b\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5c31\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u5668\u7aef\u200b\u7a0b\u5e8f\u200b\u3002</li> </ul> <p>Socket \u200b\u7c7b\u200b\uff1a</p> <ul> <li> <p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> </li> <li> <p><code>Socket(InetAddress address,int port)</code>\uff1a\u200b\u521b\u5efa\u200b\u6d41\u5957\u200b\u63a5\u5b57\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u8fde\u63a5\u200b\u5230\u200b\u6307\u5b9a\u200b IP \u200b\u6307\u5b9a\u200b\u7aef\u53e3\u53f7\u200b</p> </li> <li> <p><code>Socket(String host, int port)</code>\uff1a\u200b\u6839\u636e\u200b IP \u200b\u5730\u5740\u200b\u5b57\u7b26\u4e32\u200b\u548c\u200b\u7aef\u53e3\u53f7\u200b\u521b\u5efa\u200b\u5ba2\u6237\u7aef\u200b Socket \u200b\u5bf9\u8c61\u200b</p> <p>\u200b\u6ce8\u610f\u4e8b\u9879\u200b\uff1a\u200b\u6267\u884c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u7acb\u5373\u200b\u8fde\u63a5\u200b\u6307\u5b9a\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u8fde\u63a5\u200b\u6210\u529f\u200b\uff0c\u200b\u5219\u200b\u8868\u793a\u200b\u4e09\u6b21\u200b\u63e1\u624b\u200b\u901a\u8fc7\u200b\uff0c\u200b\u53cd\u4e4b\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</p> </li> <li> <p>\u200b\u5e38\u7528\u200b API\uff1a</p> </li> <li> <p><code>OutputStream getOutputStream()</code>\uff1a\u200b\u83b7\u5f97\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u5bf9\u8c61\u200b</p> </li> <li><code>InputStream getInputStream()</code>\uff1a\u200b\u83b7\u5f97\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u200b\u5bf9\u8c61\u200b</li> <li><code>void shutdownInput()</code>\uff1a\u200b\u505c\u6b62\u200b\u63a5\u53d7\u200b</li> <li><code>void shutdownOutput()</code>\uff1a\u200b\u505c\u6b62\u200b\u53d1\u9001\u6570\u636e\u200b\uff0c\u200b\u7ec8\u6b62\u200b\u901a\u4fe1\u200b</li> <li><code>SocketAddress getRemoteSocketAddress()</code>\uff1a\u200b\u8fd4\u56de\u200b\u5957\u200b\u63a5\u5b57\u200b\u8fde\u63a5\u200b\u5230\u200b\u7684\u200b\u7aef\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u672a\u200b\u8fde\u63a5\u200b\u8fd4\u56de\u200b null</li> </ul> <p>ServerSocket \u200b\u7c7b\u200b\uff1a</p> <ul> <li>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a<code>public ServerSocket(int port)</code></li> <li>\u200b\u5e38\u7528\u200b API\uff1a<code>public Socket accept()</code>\uff0c\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u63a5\u6536\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b Socket \u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8fde\u63a5\u200b\u6210\u529f\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b Socket \u200b\u5bf9\u8c61\u200b</li> </ul> <p>\u200b\u4e09\u6b21\u200b\u63e1\u624b\u200b\u540e\u200b TCP \u200b\u8fde\u63a5\u200b\u5efa\u7acb\u200b\u6210\u529f\u200b\uff0c\u200b\u670d\u52a1\u5668\u200b\u5185\u6838\u200b\u4f1a\u200b\u628a\u200b\u8fde\u63a5\u200b\u4ece\u200b SYN \u200b\u534a\u200b\u8fde\u63a5\u200b\u961f\u5217\u200b\uff08\u200b\u4e00\u6b21\u200b\u63e1\u624b\u200b\u65f6\u200b\u5728\u200b\u670d\u52a1\u7aef\u200b\u5efa\u7acb\u200b\u7684\u200b\u961f\u5217\u200b\uff09\u200b\u4e2d\u200b\u79fb\u51fa\u200b\uff0c\u200b\u79fb\u5165\u200b accept \u200b\u5168\u200b\u8fde\u63a5\u200b\u961f\u5217\u200b\uff0c\u200b\u7b49\u5f85\u200b\u8fdb\u7a0b\u200b\u8c03\u7528\u200b accept \u200b\u51fd\u6570\u200b\u65f6\u200b\u628a\u200b\u8fde\u63a5\u200b\u53d6\u51fa\u200b\u3002\u200b\u5982\u679c\u200b\u8fdb\u7a0b\u200b\u4e0d\u80fd\u200b\u53ca\u65f6\u200b\u8c03\u7528\u200b accept \u200b\u51fd\u6570\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u9020\u6210\u200b accept \u200b\u961f\u5217\u200b\u6ea2\u51fa\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5bfc\u81f4\u200b\u5efa\u7acb\u200b\u597d\u200b\u7684\u200b TCP \u200b\u8fde\u63a5\u200b\u88ab\u200b\u4e22\u5f03\u200b</p> <p></p> <p>\u200b\u76f8\u5f53\u4e8e\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b\u670d\u52a1\u5668\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u7ba1\u9053\u200b\uff08\u200b\u865a\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e0d\u662f\u200b\u771f\u6b63\u200b\u7684\u200b\u7269\u7406\u200b\u8fde\u63a5\u200b\uff09\uff0c\u200b\u7ba1\u9053\u200b\u4e00\u822c\u200b\u4e0d\u7528\u200b close</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#tcp_1","title":"\u5b9e\u73b0\u200bTCP","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_228","title":"\u5f00\u53d1\u200b\u6d41\u7a0b","text":"<p>\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u5f00\u53d1\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u5ba2\u6237\u7aef\u200b\u8981\u200b\u8bf7\u6c42\u200b\u4e8e\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b Socket \u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b</li> <li>\u200b\u4ece\u200b Socket \u200b\u901a\u4fe1\u200b\u7ba1\u9053\u200b\u4e2d\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b</li> <li>\u200b\u901a\u8fc7\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u7ed9\u200b\u670d\u52a1\u7aef\u200b\u5199\u51fa\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u5f00\u53d1\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u7528\u200b ServerSocket \u200b\u6ce8\u518c\u200b\u7aef\u53e3\u200b</li> <li>\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b Socket \u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b</li> <li>\u200b\u4ece\u200b Socket \u200b\u901a\u4fe1\u200b\u7ba1\u9053\u200b\u4e2d\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u200b</li> <li>\u200b\u4ece\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u4e2d\u200b\u8bfb\u53d6\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u6765\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p></p> <p></p> <ul> <li>\u200b\u5982\u679c\u200b\u8f93\u51fa\u200b\u7f13\u51b2\u533a\u200b\u7a7a\u95f4\u200b\u4e0d\u591f\u200b\u5b58\u653e\u200b\u4e3b\u673a\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u8f93\u5165\u200b\u7f13\u51b2\u533a\u200b\u540c\u7406\u200b</li> <li>\u200b\u7f13\u51b2\u533a\u200b\u4e0d\u200b\u5c5e\u4e8e\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u5c5e\u4e8e\u200b\u5185\u6838\u200b</li> <li>TCP \u200b\u4ece\u200b\u8f93\u51fa\u200b\u7f13\u51b2\u533a\u200b\u8bfb\u53d6\u6570\u636e\u200b\u4f1a\u200b\u52a0\u9501\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_229","title":"\u5b9e\u73b0\u200b\u901a\u4fe1","text":"<p>\u200b\u9700\u6c42\u200b\u4e00\u200b\uff1a\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u4e00\u884c\u200b\u6570\u636e\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u63a5\u6536\u200b\u4e00\u884c\u200b\u6570\u636e\u200b</p> Java<pre><code>public class ClientDemo {\n    public static void main(String[] args) throws Exception {\n        // 1.\u200b\u5ba2\u6237\u7aef\u200b\u8981\u200b\u8bf7\u6c42\u200b\u4e8e\u200b\u670d\u52a1\u7aef\u200b\u7684\u200bsocket\u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b\u3002\n        Socket socket = new Socket(\"127.0.0.1\", 8080);\n        // 2.\u200b\u4ece\u200bsocket\u200b\u901a\u4fe1\u200b\u7ba1\u9053\u200b\u4e2d\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\n        OutputStream os = socket.getOutputStream();\n        // 3.\u200b\u628a\u200b\u4f4e\u7ea7\u200b\u7684\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u5305\u88c5\u200b\u6210\u200b\u9ad8\u7ea7\u200b\u7684\u200b\u6253\u5370\u200b\u6d41\u200b\u3002\n        PrintStream ps = new PrintStream(os);\n        // 4.\u200b\u5f00\u59cb\u200b\u53d1\u6d88\u606f\u200b\u51fa\u53bb\u200b\n        ps.println(\"\u200b\u6211\u200b\u662f\u200b\u5ba2\u6237\u7aef\u200b\");\n        ps.flush();//\u200b\u4e00\u822c\u200b\u4e0d\u200b\u5173\u95ed\u200bIO\u200b\u6d41\u200b\n        System.out.println(\"\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u5b8c\u6bd5\u200b~~~~\");\n    }\n}\npublic class ServerDemo{\n    public static void main(String[] args) throws Exception {\n        System.out.println(\"----\u200b\u670d\u52a1\u7aef\u200b\u542f\u52a8\u200b----\");\n        // 1.\u200b\u6ce8\u518c\u200b\u7aef\u53e3\u200b: public ServerSocket(int port)\n        ServerSocket serverSocket = new ServerSocket(8080);\n        // 2.\u200b\u5f00\u59cb\u200b\u7b49\u5f85\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200bSocket\u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b\u3002\n        Socket socket = serverSocket.accept();\n        // 3.\u200b\u4ece\u200bsocket\u200b\u901a\u4fe1\u200b\u7ba1\u9053\u200b\u4e2d\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u200b\u3002\n        InputStream is = socket.getInputStream();\n        // 4.\u200b\u628a\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u8f6c\u200b\u6362\u6210\u200b\u5b57\u7b26\u200b\u8f93\u5165\u200b\u6d41\u200b\n        BufferedReader br = new BufferedReader(new InputStreamReader(is));\n        // 6.\u200b\u6309\u7167\u200b\u884c\u200b\u8bfb\u53d6\u200b\u6d88\u606f\u200b \u3002\n        String line;\n        if((line = br.readLine()) != null){\n            System.out.println(line);\n        }\n    }\n}\n</code></pre> <p>\u200b\u9700\u6c42\u200b\u4e8c\u200b\uff1a\u200b\u5ba2\u6237\u7aef\u200b\u53ef\u4ee5\u200b\u53cd\u590d\u200b\u53d1\u9001\u6570\u636e\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u53ef\u4ee5\u200b\u53cd\u590d\u200b\u6570\u636e\u200b</p> Java<pre><code>public class ClientDemo {\n    public static void main(String[] args) throws Exception {\n        // 1.\u200b\u5ba2\u6237\u7aef\u200b\u8981\u200b\u8bf7\u6c42\u200b\u4e8e\u200b\u670d\u52a1\u7aef\u200b\u7684\u200bsocket\u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b\u3002\n        Socket socket = new Socket(\"127.0.0.1\",8080);\n        // 2.\u200b\u4ece\u200bsocket\u200b\u901a\u4fe1\u200b\u7ba1\u9053\u200b\u4e2d\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\n        OutputStream os = socket.getOutputStream();\n        // 3.\u200b\u628a\u200b\u4f4e\u7ea7\u200b\u7684\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u5305\u88c5\u200b\u6210\u200b\u9ad8\u7ea7\u200b\u7684\u200b\u6253\u5370\u200b\u6d41\u200b\u3002\n        PrintStream ps = new PrintStream(os);\n        // 4.\u200b\u5f00\u59cb\u200b\u53d1\u6d88\u606f\u200b\u51fa\u53bb\u200b\n         while(true){\n            Scanner sc = new Scanner(System.in);\n            System.out.print(\"\u200b\u8bf7\u200b\u8bf4\u200b\uff1a\");\n            ps.println(sc.nextLine());\n            ps.flush();\n        }\n    }\n}\npublic class ServerDemo{\n    public static void main(String[] args) throws Exception {\n        System.out.println(\"----\u200b\u670d\u52a1\u7aef\u200b\u542f\u52a8\u200b----\");\n        // 1.\u200b\u6ce8\u518c\u200b\u7aef\u53e3\u200b: public ServerSocket(int port)\n        ServerSocket serverSocket = new ServerSocket(8080);\n        // 2.\u200b\u5f00\u59cb\u200b\u7b49\u5f85\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200bSocket\u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b\u3002\n        Socket socket = serverSocket.accept();\n        // 3.\u200b\u4ece\u200bsocket\u200b\u901a\u4fe1\u200b\u7ba1\u9053\u200b\u4e2d\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u200b\u3002\n        InputStream is = socket.getInputStream();\n        // 4.\u200b\u628a\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u8f6c\u200b\u6362\u6210\u200b\u5b57\u7b26\u200b\u8f93\u5165\u200b\u6d41\u200b\n        BufferedReader br = new BufferedReader(new InputStreamReader(is));\n        // 6.\u200b\u6309\u7167\u200b\u884c\u200b\u8bfb\u53d6\u200b\u6d88\u606f\u200b \u3002\n        String line;\n        while((line = br.readLine()) != null){\n            System.out.println(line);\n        }\n    }\n}\n</code></pre> <p>\u200b\u9700\u6c42\u200b\u4e09\u200b\uff1a\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u7aef\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u63a5\u6536\u200b\u591a\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u6d88\u606f\u200b</p> Java<pre><code>public class ClientDemo {\n    public static void main(String[] args) throws Exception {\n        Socket socket = new Socket(\"127.0.0.1\",8080);\n        OutputStream os = new socket.getOutputStream();\n        PrintStream ps = new PrintStream(os);\n        while(true){\n            Scanner sc = new Scanner(System.in);\n            System.out.print(\"\u200b\u8bf7\u200b\u8bf4\u200b\uff1a\");\n            ps.println(sc.nextLine());\n            ps.flush();\n        }\n    }\n}\npublic class ServerDemo{\n    public static void main(String[] args) throws Exception {\n        System.out.println(\"----\u200b\u670d\u52a1\u7aef\u200b\u542f\u52a8\u200b----\");\n        ServerSocket serverSocket = new ServerSocket(8080);\n        while(true){\n            // \u200b\u5f00\u59cb\u200b\u7b49\u5f85\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200bSocket\u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b\u3002\n             Socket socket = serverSocket.accept();\n            // \u200b\u6bcf\u200b\u63a5\u6536\u200b\u5230\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u5fc5\u987b\u200b\u4e3a\u200b\u8fd9\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u7ba1\u9053\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u5904\u7406\u200b\u4e0e\u200b\u4e4b\u200b\u901a\u4fe1\u200b\u3002\n            new ServerReaderThread(socket).start();\n        }\n    }\n}\nclass ServerReaderThread extends Thread{\n    privat Socket socket;\n    public ServerReaderThread(Socket socket){this.socket = socket;}\n    @Override\n    public void run() {\n        try(InputStream is = socket.getInputStream();\n            BufferedReader br = new BufferedReader(new InputStreamReader(is))\n           ){\n            String line;\n            while((line = br.readLine()) != null){\n                sout(socket.getRemoteSocketAddress() + \":\" + line);\n            }\n        }catch(Exception e){\n            sout(socket.getRemoteSocketAddress() + \"\u200b\u4e0b\u7ebf\u200b\u4e86\u200b~~~~~~\");\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_230","title":"\u4f2a\u200b\u5f02\u6b65","text":"<p>\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u8981\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5e76\u53d1\u200b\u8d8a\u9ad8\u200b\u7cfb\u7edf\u200b\u762b\u75ea\u200b\u7684\u200b\u8d8a\u200b\u5feb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u670d\u52a1\u7aef\u200b\u5f15\u5165\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u6765\u200b\u5904\u7406\u200b\u4e0e\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u6d88\u606f\u200b\u901a\u4fe1\u200b</p> <ul> <li>\u200b\u4f18\u52bf\u200b\uff1a\u200b\u4e0d\u4f1a\u200b\u5f15\u8d77\u200b\u7cfb\u7edf\u200b\u7684\u200b\u6b7b\u673a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u5e76\u53d1\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6570\u91cf\u200b</li> <li>\u200b\u52a3\u52bf\u200b\uff1a\u200b\u540c\u65f6\u200b\u53ef\u4ee5\u200b\u5e76\u53d1\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u53d7\u5230\u9650\u5236\u200b</li> </ul> Java<pre><code>public class BIOServer {\n    public static void main(String[] args) throws Exception {\n        //\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u673a\u5236\u200b\n        //\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5ba2\u6237\u7aef\u200b\u8fde\u63a5\u200b\uff0c\u200b\u5c31\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0e\u200b\u4e4b\u200b\u901a\u8baf\u200b(\u200b\u5355\u72ec\u200b\u5199\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b)\n        ExecutorService newCachedThreadPool = Executors.newCachedThreadPool();\n        //\u200b\u521b\u5efa\u200bServerSocket\n        ServerSocket serverSocket = new ServerSocket(6666);\n        System.out.println(\"\u200b\u670d\u52a1\u5668\u200b\u542f\u52a8\u200b\u4e86\u200b\");\n        while (true) {\n            System.out.println(\"\u200b\u7ebf\u7a0b\u200b\u540d\u5b57\u200b = \" + Thread.currentThread().getName());\n            //\u200b\u76d1\u542c\u200b\uff0c\u200b\u7b49\u5f85\u200b\u5ba2\u6237\u7aef\u200b\u8fde\u63a5\u200b\n            System.out.println(\"\u200b\u7b49\u5f85\u200b\u8fde\u63a5\u200b....\");\n            final Socket socket = serverSocket.accept();\n            System.out.println(\"\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\");\n            //\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0e\u200b\u4e4b\u200b\u901a\u8baf\u200b\n            newCachedThreadPool.execute(new Runnable() {\n                public void run() {\n                    //\u200b\u53ef\u4ee5\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\u901a\u8baf\u200b\n                    handler(socket);\n                }\n            });\n        }\n    }\n\n    //\u200b\u7f16\u5199\u200b\u4e00\u4e2a\u200bhandler\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\u901a\u8baf\u200b\n    public static void handler(Socket socket) {\n        try {\n            System.out.println(\"\u200b\u7ebf\u7a0b\u200b\u540d\u5b57\u200b = \" + Thread.currentThread().getName());\n            byte[] bytes = new byte[1024];\n            //\u200b\u901a\u8fc7\u200bsocket\u200b\u83b7\u53d6\u200b\u8f93\u5165\u200b\u6d41\u200b\n            InputStream inputStream = socket.getInputStream();\n            int len;\n            //\u200b\u5faa\u73af\u200b\u7684\u200b\u8bfb\u53d6\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u200b\n            while ((len = inputStream.read(bytes)) != -1) {\n                System.out.println(\"\u200b\u7ebf\u7a0b\u200b\u540d\u5b57\u200b = \" + Thread.currentThread().getName());\n                //\u200b\u8f93\u51fa\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u200b\n                System.out.println(new String(bytes, 0, read));\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            System.out.println(\"\u200b\u5173\u95ed\u200b\u548c\u200bclient\u200b\u7684\u200b\u8fde\u63a5\u200b\");\n            try {\n                socket.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_231","title":"\u6587\u4ef6\u4f20\u8f93","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_232","title":"\u5b57\u8282\u200b\u6d41","text":"<p>\u200b\u5ba2\u6237\u7aef\u200b\uff1a\u200b\u672c\u5730\u200b\u56fe\u7247\u200b: \u202aE:\\seazean\\\u200b\u56fe\u7247\u200b\u8d44\u6e90\u200b\\beautiful.jpg \u200b\u670d\u52a1\u7aef\u200b\uff1a\u200b\u670d\u52a1\u5668\u200b\u8def\u5f84\u200b\uff1aE:\\seazean\\\u200b\u56fe\u7247\u200b\u670d\u52a1\u5668\u200b</p> <p>UUID. randomUUID() : \u200b\u65b9\u6cd5\u200b\u751f\u6210\u200b\u968f\u673a\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b</p> <p>socket.shutdownOutput()\uff1a\u200b\u8fd9\u4e2a\u200b\u5fc5\u987b\u200b\u6267\u884c\u200b\uff0c\u200b\u4e0d\u7136\u200b\u670d\u52a1\u5668\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u5faa\u73af\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\uff0c\u200b\u6700\u540e\u200b\u6587\u4ef6\u200b\u635f\u574f\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u62a5\u9519\u200b</p> Java<pre><code>//\u200b\u5e38\u91cf\u200b\u5305\u200b\npublic class Constants {\n    public static final String SRC_IMAGE = \"D:\\\\seazean\\\\\u200b\u56fe\u7247\u200b\u8d44\u6e90\u200b\\\\beautiful.jpg\";\n    public static final String SERVER_DIR = \"D:\\\\seazean\\\\\u200b\u56fe\u7247\u200b\u670d\u52a1\u5668\u200b\\\\\";\n    public static final String SERVER_IP = \"127.0.0.1\";\n    public static final int SERVER_PORT = 8888;\n\n}\npublic class ClientDemo {\n    public static void main(String[] args) throws Exception {\n        Socket socket = new Socket(Constants.ERVER_IP,Constants.SERVER_PORT);\n        BufferedOutputStream bos=new BufferedOutputStream(socket.getOutputStream());\n        //\u200b\u63d0\u53d6\u200b\u672c\u673a\u200b\u7684\u200b\u56fe\u7247\u200b\u4e0a\u200b\u4f20\u7ed9\u200b\u670d\u52a1\u7aef\u200b\u3002Constants.SRC_IMAGE\n        BufferedInputStream bis = new BufferedInputStream(new FileInputStream());\n        byte[] buffer = new byte[1024];\n        int len ;\n        while((len = bis.read(buffer)) != -1) {\n            bos.write(buffer, 0 ,len);\n        }\n        bos.flush();// \u200b\u5237\u65b0\u200b\u56fe\u7247\u200b\u6570\u636e\u200b\u5230\u200b\u670d\u52a1\u7aef\u200b\uff01\uff01\n        socket.shutdownOutput();// \u200b\u544a\u8bc9\u200b\u670d\u52a1\u7aef\u200b\u6211\u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u53d1\u9001\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u4e0d\u8981\u200b\u5728\u200b\u7b49\u200b\u6211\u200b\u4e86\u200b\uff01\n        bis.close();\n\n        //\u200b\u7b49\u5f85\u200b\u7740\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u54cd\u5e94\u200b\u6570\u636e\u200b\uff01\uff01\n        BufferedReader br = new BufferedReader(\n                         new InputStreamReader(socket.getInputStream()));\n        System.out.println(\"\u200b\u6536\u5230\u200b\u670d\u52a1\u7aef\u200b\u54cd\u5e94\u200b\uff1a\"+br.readLine());\n    }\n}\n</code></pre> Java<pre><code>public class ServerDemo {\n    public static void main(String[] args) throws Exception {\n        System.out.println(\"----\u200b\u670d\u52a1\u7aef\u200b\u542f\u52a8\u200b----\");\n        // 1.\u200b\u6ce8\u518c\u200b\u7aef\u53e3\u200b: \n        ServerSocket serverSocket = new ServerSocket(Constants.SERVER_PORT);\n        // 2.\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u5faa\u73af\u4e0d\u65ad\u200b\u7684\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u8fde\u63a5\u200b\u8bf7\u6c42\u200b\n        while(true){\n            // 3.\u200b\u5f00\u59cb\u200b\u7b49\u5f85\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200bSocket\u200b\u7ba1\u9053\u200b\u8fde\u63a5\u200b\u3002\n            Socket socket = serverSocket.accept();\n            // 4.\u200b\u6bcf\u200b\u63a5\u6536\u200b\u5230\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u5fc5\u987b\u200b\u4e3a\u200b\u8fd9\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u7ba1\u9053\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u5904\u7406\u200b\u4e0e\u200b\u4e4b\u200b\u901a\u4fe1\u200b\u3002\n            new ServerReaderThread(socket).start();\n        }\n    }\n}\nclass ServerReaderThread extends Thread{\n    private Socket socket ;\n    public ServerReaderThread(Socket socket){this.socket = socket;}\n    @Override\n    public void run() {\n        try{\n            InputStream is = socket.getInputStream();\n            BufferedInputStream bis = new BufferedInputStream(is);\n            BufferedOutputStream bos = new BufferedOutputStream(\n                new FileOutputStream\n                (Constants.SERVER_DIR+UUID.randomUUID().toString()+\".jpg\"));\n            byte[] buffer = new byte[1024];\n            int len;\n            while((len = bis.read(buffer)) != -1){\n                bos.write(buffer,0,len);\n            }\n            bos.close();\n            System.out.println(\"\u200b\u670d\u52a1\u7aef\u200b\u63a5\u6536\u200b\u5b8c\u6bd5\u200b\u4e86\u200b\uff01\");\n\n            // 4.\u200b\u54cd\u5e94\u200b\u6570\u636e\u200b\u7ed9\u200b\u5ba2\u6237\u7aef\u200b\n            PrintStream ps = new PrintStream(socket.getOutputStream());\n            ps.println(\"\u200b\u60a8\u597d\u200b\uff0c\u200b\u5df2\u200b\u6210\u529f\u200b\u63a5\u6536\u200b\u60a8\u200b\u4e0a\u4f20\u200b\u7684\u200b\u56fe\u7247\u200b\uff01\");\n            ps.flush();\n            Thread.sleep(10000);\n        }catch (Exception e){\n            sout(socket.getRemoteSocketAddress() + \"\u200b\u4e0b\u7ebf\u200b\u4e86\u200b\");\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_233","title":"\u6570\u636e\u6d41","text":"<p>\u200b\u6784\u9020\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>DataOutputStream(OutputStream out)</code> : \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u6d41\u200b\uff0c\u200b\u4ee5\u200b\u5c06\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u6307\u5b9a\u200b\u7684\u200b\u5e95\u5c42\u200b\u8f93\u51fa\u200b\u6d41\u200b</li> <li><code>DataInputStream(InputStream in)</code> : \u200b\u521b\u5efa\u200b\u4f7f\u7528\u200b\u6307\u5b9a\u200b\u7684\u200b\u5e95\u5c42\u200b InputStream \u200b\u7684\u200b DataInputStream</li> </ul> <p>\u200b\u5e38\u7528\u200bAPI\uff1a</p> <ul> <li><code>final void writeUTF(String str)</code> : \u200b\u4f7f\u7528\u200b\u673a\u5668\u200b\u65e0\u5173\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4f7f\u7528\u200b UTF-8 \u200b\u7f16\u7801\u200b\u5c06\u200b\u5b57\u7b26\u4e32\u200b\u5199\u5165\u200b\u5e95\u5c42\u200b\u8f93\u51fa\u200b\u6d41\u200b</li> <li><code>final String readUTF()</code> : \u200b\u8bfb\u53d6\u200b\u4ee5\u200b modified UTF-8 \u200b\u683c\u5f0f\u200b\u7f16\u7801\u200b\u7684\u200b Unicode \u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u8fd4\u56de\u200b String \u200b\u7c7b\u578b\u200b</li> </ul> Java<pre><code>public class Client {\n    public static void main(String[] args) {\n        InputStream is = new FileInputStream(\"path\");\n            //  1\u3001\u200b\u8bf7\u6c42\u200b\u4e0e\u200b\u670d\u52a1\u7aef\u200b\u7684\u200bSocket\u200b\u94fe\u63a5\u200b\n            Socket socket = new Socket(\"127.0.0.1\" , 8888);\n            //  2\u3001\u200b\u628a\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u5305\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u6d41\u200b\n            DataOutputStream dos = new DataOutputStream(socket.getOutputStream());\n            //  3\u3001\u200b\u5148\u200b\u53d1\u9001\u200b\u4e0a\u4f20\u200b\u6587\u4ef6\u200b\u7684\u200b\u540e\u7f00\u200b\u7ed9\u200b\u670d\u52a1\u7aef\u200b\n            dos.writeUTF(\".png\");\n            //  4\u3001\u200b\u628a\u200b\u6587\u4ef6\u200b\u6570\u636e\u200b\u53d1\u9001\u7ed9\u200b\u670d\u52a1\u7aef\u200b\u8fdb\u884c\u200b\u63a5\u6536\u200b\n            byte[] buffer = new byte[1024];\n            int len;\n            while((len = is.read(buffer)) &gt; 0 ){\n                dos.write(buffer , 0 , len);\n            }\n            dos.flush();\n            Thread.sleep(10000);\n    }\n}\n\npublic class Server {\n    public static void main(String[] args) {\n        ServerSocket ss = new ServerSocket(8888);\n        Socket socket = ss.accept();\n        // 1\u3001\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u8f93\u5165\u200b\u6d41\u200b\u8bfb\u53d6\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u8fc7\u6765\u200b\u7684\u200b\u6570\u636e\u200b\n        DataInputStream dis = new DataInputStream(socket.getInputStream());\n        // 2\u3001\u200b\u8bfb\u53d6\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u8fc7\u6765\u200b\u7684\u200b\u6587\u4ef6\u7c7b\u578b\u200b\n        String suffix = dis.readUTF();\n        // 3\u3001\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u7ba1\u9053\u200b\u8d1f\u8d23\u200b\u628a\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u6765\u200b\u7684\u200b\u6587\u4ef6\u200b\u6570\u636e\u200b\u5199\u51fa\u53bb\u200b\n        OutputStream os = new FileOutputStream(\"path\"+\n                    UUID.randomUUID().toString()+suffix);\n        // 4\u3001\u200b\u4ece\u200b\u6570\u636e\u200b\u8f93\u5165\u200b\u6d41\u4e2d\u200b\u8bfb\u53d6\u200b\u6587\u4ef6\u200b\u6570\u636e\u200b\uff0c\u200b\u5199\u51fa\u200b\u5230\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u4e2d\u200b\u53bb\u200b\n        byte[] buffer = new byte[1024];\n        int len;\n        while((len = dis.read(buffer)) &gt; 0){\n            os.write(buffer,0, len);\n        }\n        os.close();\n        System.out.println(\"\u200b\u670d\u52a1\u7aef\u200b\u63a5\u6536\u200b\u6587\u4ef6\u200b\u4fdd\u5b58\u200b\u6210\u529f\u200b\uff01\");\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#nio","title":"NIO","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_234","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>NIO\u200b\u7684\u200b\u4ecb\u7ecd\u200b\uff1a</p> <p>Java NIO\uff08New IO\u3001Java non-blocking IO\uff09\uff0c\u200b\u4ece\u200b Java 1.4 \u200b\u7248\u672c\u200b\u5f00\u59cb\u200b\u5f15\u5165\u200b\u7684\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b IO API\uff0c\u200b\u53ef\u4ee5\u200b\u66ff\u4ee3\u200b\u6807\u51c6\u200b\u7684\u200b Java IO API\uff0cNIO \u200b\u652f\u6301\u200b\u9762\u5411\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u3001\u200b\u57fa\u4e8e\u200b\u901a\u9053\u200b\u7684\u200b IO \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4ee5\u200b\u66f4\u52a0\u200b\u9ad8\u6548\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fdb\u884c\u200b\u6587\u4ef6\u200b\u7684\u200b\u8bfb\u5199\u64cd\u4f5c\u200b</p> <ul> <li>NIO \u200b\u6709\u4e09\u5927\u200b\u6838\u5fc3\u200b\u90e8\u5206\u200b\uff1aChannel\uff08\u200b\u901a\u9053\u200b\uff09\uff0cBuffer\uff08\u200b\u7f13\u51b2\u533a\u200b\uff09\uff0cSelector\uff08\u200b\u9009\u62e9\u5668\u200b\uff09</li> <li>NIO \u200b\u662f\u975e\u200b\u963b\u585e\u200b IO\uff0c\u200b\u4f20\u7edf\u200b IO \u200b\u7684\u200b read \u200b\u548c\u200b write \u200b\u53ea\u80fd\u200b\u963b\u585e\u200b\u6267\u884c\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u8bfb\u5199\u200b IO \u200b\u671f\u95f4\u200b\u4e0d\u80fd\u200b\u5e72\u200b\u5176\u4ed6\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8c03\u7528\u200b socket.accept()\uff0c\u200b\u5982\u679c\u200b\u670d\u52a1\u5668\u200b\u6ca1\u6709\u200b\u6570\u636e\u4f20\u8f93\u200b\u8fc7\u6765\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\uff0c\u200b\u800c\u200b NIO \u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b Socket \u200b\u4e3a\u200b\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b</li> <li>NIO \u200b\u53ef\u4ee5\u200b\u505a\u5230\u200b\u7528\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u5904\u7406\u200b\u591a\u4e2a\u200b\u64cd\u4f5c\u200b\u7684\u200b\u3002\u200b\u5047\u8bbe\u200b\u6709\u200b 1000 \u200b\u4e2a\u200b\u8bf7\u6c42\u200b\u8fc7\u6765\u200b\uff0c\u200b\u6839\u636e\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u53ef\u4ee5\u200b\u5206\u914d\u200b 20 \u200b\u6216\u8005\u200b 80 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u5904\u7406\u200b\uff0c\u200b\u4e0d\u50cf\u200b\u4e4b\u524d\u200b\u7684\u200b\u963b\u585e\u200b IO \u200b\u90a3\u6837\u200b\u5206\u914d\u200b 1000 \u200b\u4e2a\u200b</li> </ul> <p>NIO \u200b\u548c\u200b BIO \u200b\u7684\u200b\u6bd4\u8f83\u200b\uff1a</p> <ul> <li>BIO \u200b\u4ee5\u6d41\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5904\u7406\u200b\u6570\u636e\u200b\uff0c\u200b\u800c\u200b NIO \u200b\u4ee5\u5757\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5904\u7406\u200b\u6570\u636e\u200b\uff0c\u200b\u5757\u200b I/O \u200b\u7684\u200b\u6548\u7387\u200b\u6bd4\u6d41\u200b I/O \u200b\u9ad8\u200b\u5f88\u591a\u200b</li> <li>BIO \u200b\u662f\u200b\u963b\u585e\u200b\u7684\u200b\uff0cNIO \u200b\u5219\u200b\u662f\u975e\u200b\u963b\u585e\u200b\u7684\u200b</li> <li>BIO \u200b\u57fa\u4e8e\u200b\u5b57\u8282\u200b\u6d41\u200b\u548c\u200b\u5b57\u7b26\u200b\u6d41\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u800c\u200b NIO \u200b\u57fa\u4e8e\u200b Channel \u200b\u548c\u200b Buffer \u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6570\u636e\u200b\u4ece\u200b\u901a\u9053\u200b\u8bfb\u53d6\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\uff0c\u200b\u6216\u8005\u200b\u4ece\u200b\u7f13\u51b2\u533a\u200b\u5199\u5165\u200b\u5230\u200b\u901a\u9053\u200b\u4e2d\u200b\u3002Selector \u200b\u7528\u4e8e\u200b\u76d1\u542c\u200b\u591a\u4e2a\u200b\u901a\u9053\u200b\u7684\u200b\u4e8b\u4ef6\u200b\uff08\u200b\u6bd4\u5982\u200b\uff1a\u200b\u8fde\u63a5\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u7b49\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u4f7f\u7528\u200b\u5355\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u76d1\u542c\u200b\u591a\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u901a\u9053\u200b</li> </ul> NIO BIO \u200b\u9762\u5411\u200b\u7f13\u51b2\u533a\u200b\uff08Buffer\uff09 \u200b\u9762\u5411\u200b\u6d41\u200b\uff08Stream\uff09 \u200b\u975e\u200b\u963b\u585e\u200b\uff08Non Blocking IO\uff09 \u200b\u963b\u585e\u200bIO(Blocking IO) \u200b\u9009\u62e9\u5668\u200b\uff08Selectors\uff09","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_235","title":"\u5b9e\u73b0\u200b\u539f\u7406","text":"<p>NIO \u200b\u4e09\u5927\u200b\u6838\u5fc3\u200b\u90e8\u5206\u200b\uff1aChannel (\u200b\u901a\u9053\u200b)\u3001Buffer (\u200b\u7f13\u51b2\u533a\u200b)\u3001Selector (\u200b\u9009\u62e9\u5668\u200b)</p> <ul> <li>Buffer \u200b\u7f13\u51b2\u533a\u200b</li> </ul> <p>\u200b\u7f13\u51b2\u533a\u200b\u672c\u8d28\u200b\u662f\u200b\u4e00\u5757\u200b\u53ef\u4ee5\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u3001\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u5e95\u5c42\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\uff0c\u200b\u8fd9\u5757\u200b\u5185\u5b58\u200b\u88ab\u200b\u5305\u88c5\u200b\u6210\u200b NIO Buffer \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u65b9\u6cd5\u200b\u7528\u6765\u200b\u64cd\u4f5c\u200b\u8fd9\u5757\u200b\u5185\u5b58\u200b\uff0c\u200b\u76f8\u200b\u6bd4\u8f83\u200b\u76f4\u63a5\u200b\u5bf9\u200b\u6570\u7ec4\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0cBuffer \u200b\u7684\u200b API \u200b\u66f4\u52a0\u200b\u5bb9\u6613\u200b\u64cd\u4f5c\u200b\u548c\u200b\u7ba1\u7406\u200b</p> <ul> <li>Channel \u200b\u901a\u9053\u200b</li> </ul> <p>Java NIO \u200b\u7684\u200b\u901a\u9053\u200b\u7c7b\u4f3c\u200b\u6d41\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u901a\u9053\u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u53c8\u200b\u53ef\u4ee5\u200b\u5199\u200b\u6570\u636e\u200b\u5230\u200b\u901a\u9053\u200b\uff0c\u200b\u6d41\u200b\u7684\u200b\u8bfb\u5199\u200b\u901a\u5e38\u200b\u662f\u200b\u5355\u5411\u200b\u7684\u200b\uff0c\u200b\u901a\u9053\u200b\u53ef\u4ee5\u200b\u975e\u200b\u963b\u585e\u200b\u8bfb\u53d6\u200b\u548c\u200b\u5199\u5165\u200b\u901a\u9053\u200b\uff0c\u200b\u652f\u6301\u200b\u8bfb\u53d6\u200b\u6216\u200b\u5199\u5165\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u4e5f\u200b\u652f\u6301\u200b\u5f02\u6b65\u200b\u5730\u200b\u8bfb\u5199\u200b</p> <ul> <li>Selector \u200b\u9009\u62e9\u5668\u200b</li> </ul> <p>Selector \u200b\u662f\u200b\u4e00\u4e2a\u200b Java NIO \u200b\u7ec4\u4ef6\u200b\uff0c\u200b\u80fd\u591f\u200b\u68c0\u67e5\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b NIO \u200b\u901a\u9053\u200b\uff0c\u200b\u5e76\u200b\u786e\u5b9a\u200b\u54ea\u4e9b\u200b\u901a\u9053\u200b\u5df2\u7ecf\u200b\u51c6\u5907\u200b\u597d\u200b\u8fdb\u884c\u200b\u8bfb\u53d6\u200b\u6216\u200b\u5199\u5165\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b channel\uff0c\u200b\u4ece\u800c\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u7f51\u7edc\u8fde\u63a5\u200b\uff0c\u200b\u63d0\u9ad8\u6548\u7387\u200b</p> <p>NIO \u200b\u7684\u200b\u5b9e\u73b0\u200b\u6846\u67b6\u200b\uff1a</p> <p></p> <ul> <li>\u200b\u6bcf\u4e2a\u200b Channel \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b Buffer</li> <li>\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b Selector \uff0c \u200b\u4e00\u4e2a\u200b Selector \u200b\u5bf9\u5e94\u200b\u591a\u4e2a\u200b Channel\uff08\u200b\u8fde\u63a5\u200b\uff09</li> <li>\u200b\u7a0b\u5e8f\u200b\u5207\u6362\u200b\u5230\u200b\u54ea\u4e2a\u200b Channel \u200b\u662f\u200b\u7531\u200b\u4e8b\u4ef6\u200b\u51b3\u5b9a\u200b\u7684\u200b\uff0cEvent \u200b\u662f\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u6982\u5ff5\u200b</li> <li>Selector \u200b\u4f1a\u200b\u6839\u636e\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u5728\u200b\u5404\u4e2a\u200b\u901a\u9053\u200b\u4e0a\u200b\u5207\u6362\u200b</li> <li>Buffer \u200b\u662f\u200b\u4e00\u4e2a\u200b\u5185\u5b58\u200b\u5757\u200b \uff0c \u200b\u5e95\u5c42\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b</li> <li>\u200b\u6570\u636e\u200b\u7684\u200b\u8bfb\u53d6\u200b\u5199\u5165\u200b\u662f\u200b\u901a\u8fc7\u200b Buffer \u200b\u5b8c\u6210\u200b\u7684\u200b , BIO \u200b\u4e2d\u200b\u8981\u4e48\u200b\u662f\u200b\u8f93\u5165\u200b\u6d41\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b\u8f93\u51fa\u200b\u6d41\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u53cc\u5411\u200b\uff0cNIO \u200b\u7684\u200b Buffer \u200b\u662f\u200b\u53ef\u4ee5\u200b\u8bfb\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5199\u200b\uff0c flip() \u200b\u5207\u6362\u200b Buffer \u200b\u7684\u200b\u5de5\u4f5c\u200b\u6a21\u5f0f\u200b</li> </ul> <p>Java NIO \u200b\u7cfb\u7edf\u200b\u7684\u200b\u6838\u5fc3\u200b\u5728\u4e8e\u200b\uff1a\u200b\u901a\u9053\u200b\u548c\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u901a\u9053\u200b\u8868\u793a\u200b\u6253\u5f00\u200b\u7684\u200b IO \u200b\u8bbe\u5907\u200b\uff08\u200b\u4f8b\u5982\u200b\uff1a\u200b\u6587\u4ef6\u200b\u3001 \u200b\u5957\u200b\u63a5\u5b57\u200b\uff09\u200b\u7684\u200b\u8fde\u63a5\u200b\u3002\u200b\u82e5\u200b\u8981\u200b\u4f7f\u7528\u200b NIO \u200b\u7cfb\u7edf\u200b\uff0c\u200b\u83b7\u53d6\u200b\u7528\u4e8e\u200b\u8fde\u63a5\u200b IO \u200b\u8bbe\u5907\u200b\u7684\u200b\u901a\u9053\u200b\u4ee5\u53ca\u200b\u7528\u4e8e\u200b\u5bb9\u7eb3\u200b\u6570\u636e\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u7136\u540e\u200b\u64cd\u4f5c\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u5bf9\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\u3002\u200b\u7b80\u800c\u8a00\u4e4b\u200b\uff0cChannel \u200b\u8d1f\u8d23\u200b\u4f20\u8f93\u200b\uff0c Buffer \u200b\u8d1f\u8d23\u200b\u5b58\u53d6\u6570\u636e\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_236","title":"\u7f13\u51b2\u533a","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_237","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u7f13\u51b2\u533a\u200b\uff08Buffer\uff09\uff1a\u200b\u7f13\u51b2\u533a\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u8bfb\u5199\u200b\u6570\u636e\u200b\u7684\u200b\u5185\u5b58\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7279\u5b9a\u200b\u57fa\u672c\u200b\u6570\u636e\u7c7b\u578b\u200b\u7684\u200b\u5bb9\u5668\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4e0e\u200b NIO \u200b\u901a\u9053\u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u6570\u636e\u200b\u662f\u4ece\u200b\u901a\u9053\u200b\u8bfb\u5165\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u4ece\u200b\u7f13\u51b2\u533a\u200b\u5199\u5165\u200b\u901a\u9053\u200b\u4e2d\u200b\u7684\u200b</p> <p></p> <p>Buffer \u200b\u5e95\u5c42\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b\u591a\u4e2a\u200b\u76f8\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6839\u636e\u200b\u6570\u636e\u7c7b\u578b\u200b\u4e0d\u540c\u200b \uff0c\u200b\u6709\u200b\u4ee5\u4e0b\u200b Buffer \u200b\u5e38\u7528\u200b\u5b50\u7c7b\u200b\uff1aByteBuffer\u3001CharBuffer\u3001ShortBuffer\u3001IntBuffer\u3001LongBuffer\u3001FloatBuffer\u3001DoubleBuffer </p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_238","title":"\u57fa\u672c\u200b\u5c5e\u6027","text":"<ul> <li>\u200b\u5bb9\u91cf\u200b\uff08capacity\uff09\uff1a\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u5185\u5b58\u200b\u5757\u200b\uff0cBuffer \u200b\u5177\u6709\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\uff0c\u200b\u7f13\u51b2\u533a\u200b\u5bb9\u91cf\u200b\u4e0d\u80fd\u200b\u4e3a\u200b\u8d1f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u521b\u5efa\u200b\u540e\u200b\u4e0d\u80fd\u200b\u66f4\u6539\u200b</li> <li>\u200b\u9650\u5236\u200b \uff08limit\uff09\uff1a\u200b\u8868\u793a\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u6570\u636e\u200b\u7684\u200b\u5927\u5c0f\u200b\uff08limit \u200b\u540e\u200b\u6570\u636e\u200b\u4e0d\u80fd\u200b\u8fdb\u884c\u200b\u8bfb\u5199\u200b\uff09\uff0c\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u9650\u5236\u200b\u4e0d\u80fd\u200b\u4e3a\u200b\u8d1f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u80fd\u200b\u5927\u4e8e\u200b\u5176\u200b\u5bb9\u91cf\u200b\u3002\u200b\u5199\u5165\u200b\u6a21\u5f0f\u200b\uff0climit \u200b\u7b49\u4e8e\u200b buffer \u200b\u7684\u200b\u5bb9\u91cf\u200b\uff1b\u200b\u8bfb\u53d6\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0climit \u200b\u7b49\u4e8e\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u91cf\u200b</li> <li>\u200b\u4f4d\u7f6e\u200b\uff08position\uff09\uff1a\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8981\u200b\u8bfb\u53d6\u200b\u6216\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u7d22\u5f15\u200b\uff0c\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0d\u80fd\u200b\u4e3a\u200b\u8d1f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u80fd\u200b\u5927\u4e8e\u200b\u5176\u200b\u9650\u5236\u200b</li> <li>\u200b\u6807\u8bb0\u200b\uff08mark\uff09\u200b\u4e0e\u200b\u91cd\u7f6e\u200b\uff08reset\uff09\uff1a\u200b\u6807\u8bb0\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7d22\u5f15\u200b\uff0c\u200b\u901a\u8fc7\u200b Buffer \u200b\u4e2d\u200b\u7684\u200b mark() \u200b\u65b9\u6cd5\u200b\u6307\u5b9a\u200b Buffer \u200b\u4e2d\u200b\u4e00\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b reset() \u200b\u65b9\u6cd5\u200b\u6062\u590d\u200b\u5230\u200b\u8fd9\u4e2a\u200b position</li> <li>\u200b\u4f4d\u7f6e\u200b\u3001\u200b\u9650\u5236\u200b\u3001\u200b\u5bb9\u91cf\u200b\u9075\u5b88\u200b\u4ee5\u4e0b\u200b\u4e0d\u53d8\u5f0f\u200b\uff1a 0 &lt;= position &lt;= limit &lt;= capacity</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#api_2","title":"\u5e38\u7528\u200bAPI","text":"<p><code>static XxxBuffer allocate(int capacity)</code>\uff1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5bb9\u91cf\u200b\u4e3a\u200b capacity \u200b\u7684\u200b XxxBuffer \u200b\u5bf9\u8c61\u200b</p> <p>Buffer \u200b\u57fa\u672c\u64cd\u4f5c\u200b\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public Buffer clear() \u200b\u6e05\u7a7a\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u4e0d\u200b\u6e05\u7a7a\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5c06\u200b\u4f4d\u7f6e\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\uff0c\u200b\u9650\u5236\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5bb9\u91cf\u200b public Buffer flip() \u200b\u7ffb\u8f6c\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u5c06\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u754c\u9650\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\uff0cposition \u200b\u7f6e\u200b 0 public int capacity() \u200b\u8fd4\u56de\u200b Buffer\u200b\u7684\u200b capacity \u200b\u5927\u5c0f\u200b public final int limit() \u200b\u8fd4\u56de\u200b Buffer \u200b\u7684\u200b\u754c\u9650\u200b limit \u200b\u7684\u200b\u4f4d\u7f6e\u200b public Buffer limit(int n) \u200b\u8bbe\u7f6e\u200b\u7f13\u51b2\u533a\u200b\u754c\u9650\u200b\u4e3a\u200b n public Buffer mark() \u200b\u5728\u200b\u6b64\u200b\u4f4d\u7f6e\u200b\u5bf9\u200b\u7f13\u51b2\u533a\u200b\u8bbe\u7f6e\u200b\u6807\u8bb0\u200b public final int position() \u200b\u8fd4\u56de\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b position public Buffer position(int n) \u200b\u8bbe\u7f6e\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\u4e3a\u200bn public Buffer reset() \u200b\u5c06\u200b\u4f4d\u7f6e\u200b position \u200b\u91cd\u7f6e\u200b\u4e3a\u200b\u5148\u524d\u200b mark \u200b\u6807\u8bb0\u200b\u7684\u200b\u4f4d\u7f6e\u200b public Buffer rewind() \u200b\u5c06\u200b\u4f4d\u7f6e\u200b\u8bbe\u4e3a\u200b\u4e3a\u200b 0\uff0c\u200b\u53d6\u6d88\u200b\u8bbe\u7f6e\u200b\u7684\u200b mark public final int remaining() \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b position \u200b\u548c\u200b limit \u200b\u4e4b\u95f4\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b public final boolean hasRemaining() \u200b\u5224\u65ad\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u662f\u5426\u200b\u8fd8\u6709\u200b\u5143\u7d20\u200b public static ByteBuffer wrap(byte[] array) \u200b\u5c06\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u6570\u7ec4\u200b\u5305\u88c5\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b abstract ByteBuffer asReadOnlyBuffer() \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u53ea\u8bfb\u200b\u5b57\u8282\u200b\u7f13\u51b2\u533a\u200b public abstract ByteBuffer compact() \u200b\u7f13\u51b2\u533a\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\u4e0e\u5176\u200b\u9650\u5236\u200b\uff08\u200b\u5982\u679c\u200b\u6709\u200b\uff09\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5b57\u8282\u200b\u88ab\u200b\u590d\u5236\u5230\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5f00\u5934\u200b <p>Buffer \u200b\u6570\u636e\u200b\u64cd\u4f5c\u200b\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public abstract byte get() \u200b\u8bfb\u53d6\u200b\u8be5\u200b\u7f13\u51b2\u533a\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u5355\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u7136\u540e\u200b\u4f4d\u7f6e\u200b + 1 public ByteBuffer get(byte[] dst) \u200b\u8bfb\u53d6\u200b\u591a\u4e2a\u200b\u5b57\u8282\u200b\u5230\u200b\u5b57\u8282\u200b\u6570\u7ec4\u200b dst \u200b\u4e2d\u200b public abstract byte get(int index) \u200b\u8bfb\u53d6\u200b\u6307\u5b9a\u200b\u7d22\u5f15\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u5b57\u8282\u200b\uff0c\u200b\u4e0d\u200b\u79fb\u52a8\u200b position public abstract ByteBuffer put(byte b) \u200b\u5c06\u200b\u7ed9\u5b9a\u200b\u5355\u4e2a\u200b\u5b57\u8282\u200b\u5199\u5165\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\uff0cposition+1 public final ByteBuffer put(byte[] src) \u200b\u5c06\u200b src \u200b\u5b57\u8282\u200b\u6570\u7ec4\u200b\u5199\u5165\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b public abstract ByteBuffer put(int index, byte b) \u200b\u5c06\u200b\u6307\u5b9a\u200b\u5b57\u8282\u200b\u5199\u5165\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u7d22\u5f15\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e0d\u200b\u79fb\u52a8\u200b position <p>\u200b\u63d0\u793a\u200b\uff1a\"\\n\"\uff0c\u200b\u5360\u7528\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_239","title":"\u8bfb\u5199\u200b\u6570\u636e","text":"<p>\u200b\u4f7f\u7528\u200b Buffer \u200b\u8bfb\u5199\u200b\u6570\u636e\u200b\u4e00\u822c\u200b\u9075\u5faa\u200b\u4ee5\u4e0b\u200b\u56db\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ul> <li>\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b Buffer</li> <li>\u200b\u8c03\u7528\u200b flip()\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u8bfb\u53d6\u200b\u6a21\u5f0f\u200b</li> <li>\u200b\u4ece\u200b Buffer \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b</li> <li>\u200b\u8c03\u7528\u200b buffer.clear() \u200b\u65b9\u6cd5\u200b\u6e05\u9664\u200b\u7f13\u51b2\u533a\u200b\uff08\u200b\u4e0d\u662f\u200b\u6e05\u7a7a\u200b\u4e86\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u662f\u200b\u91cd\u7f6e\u200b\u6307\u9488\u200b\uff09</li> </ul> Java<pre><code>public class TestBuffer {\n    @Test\n    public void test(){\n        String str = \"seazean\";\n        //1. \u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u6307\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        System.out.println(\"-----------------allocate()----------------\");\n        System.out.println(bufferf.position());//0\n        System.out.println(buffer.limit());//1024\n        System.out.println(buffer.capacity());//1024\n\n        //2. \u200b\u5229\u7528\u200b put() \u200b\u5b58\u5165\u200b\u6570\u636e\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\n        buffer.put(str.getBytes());\n        System.out.println(\"-----------------put()----------------\");\n        System.out.println(bufferf.position());//7\n        System.out.println(buffer.limit());//1024\n        System.out.println(buffer.capacity());//1024\n\n        //3. \u200b\u5207\u6362\u200b\u8bfb\u53d6\u6570\u636e\u200b\u6a21\u5f0f\u200b\n        buffer.flip();\n        System.out.println(\"-----------------flip()----------------\");\n        System.out.println(buffer.position());//0\n        System.out.println(buffer.limit());//7\n        System.out.println(buffer.capacity());//1024\n\n        //4. \u200b\u5229\u7528\u200b get() \u200b\u8bfb\u53d6\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\n        byte[] dst = new byte[buffer.limit()];\n        buffer.get(dst);\n        System.out.println(dst.length);\n        System.out.println(new String(dst, 0, dst.length));\n        System.out.println(buffer.position());//7\n        System.out.println(buffer.limit());//7\n\n        //5. clear() : \u200b\u6e05\u7a7a\u200b\u7f13\u51b2\u533a\u200b. \u200b\u4f46\u662f\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u4f9d\u7136\u200b\u5b58\u5728\u200b\uff0c\u200b\u4f46\u662f\u200b\u5904\u4e8e\u200b\u201c\u200b\u88ab\u200b\u9057\u5fd8\u200b\u201d\u200b\u72b6\u6001\u200b\n        System.out.println(buffer.hasRemaining());//true\n        buffer.clear();\n        System.out.println(buffer.hasRemaining());//true\n        System.out.println(\"-----------------clear()----------------\");\n        System.out.println(buffer.position());//0\n        System.out.println(buffer.limit());//1024\n        System.out.println(buffer.capacity());//1024\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_240","title":"\u7c98\u5305\u200b\u62c6\u5305","text":"<p>\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u6709\u200b\u591a\u6761\u200b\u6570\u636e\u200b\u53d1\u9001\u7ed9\u200b\u670d\u52a1\u7aef\u200b\uff0c\u200b\u6570\u636e\u200b\u4e4b\u95f4\u200b\u4f7f\u7528\u200b \\n \u200b\u8fdb\u884c\u200b\u5206\u9694\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u4e9b\u200b\u6570\u636e\u200b\u5728\u200b\u63a5\u6536\u200b\u65f6\u200b\uff0c\u200b\u88ab\u200b\u8fdb\u884c\u200b\u4e86\u200b\u91cd\u65b0\u7ec4\u5408\u200b</p> Java<pre><code>// Hello,world\\n\n// I'm zhangsan\\n\n// How are you?\\n\n------ &gt; \u200b\u9ecf\u5305\u200b\uff0c\u200b\u534a\u5305\u200b\n// Hello,world\\nI'm zhangsan\\nHo\n// w are you?\\n\n</code></pre> Java<pre><code>public static void main(String[] args) {\n    ByteBuffer source = ByteBuffer.allocate(32);\n    //                     11            24\n    source.put(\"Hello,world\\nI'm zhangsan\\nHo\".getBytes());\n    split(source);\n\n    source.put(\"w are you?\\nhaha!\\n\".getBytes());\n    split(source);\n}\n\nprivate static void split(ByteBuffer source) {\n    source.flip();\n    int oldLimit = source.limit();\n    for (int i = 0; i &lt; oldLimit; i++) {\n        if (source.get(i) == '\\n') {\n            // \u200b\u6839\u636e\u200b\u6570\u636e\u200b\u7684\u200b\u957f\u5ea6\u200b\u8bbe\u7f6e\u200b\u7f13\u51b2\u533a\u200b\n            ByteBuffer target = ByteBuffer.allocate(i + 1 - source.position());\n            // 0 ~ limit\n            source.limit(i + 1);\n            target.put(source); // \u200b\u4ece\u200bsource \u200b\u8bfb\u200b\uff0c\u200b\u5411\u200b target \u200b\u5199\u200b\n            // debugAll(target); \u200b\u8bbf\u95ee\u200b buffer \u200b\u7684\u200b\u65b9\u6cd5\u200b\n            source.limit(oldLimit);\n        }\n    }\n    // \u200b\u8bbf\u95ee\u200b\u8fc7\u200b\u7684\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b\u5f00\u5934\u200b\n    source.compact();\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_241","title":"\u76f4\u63a5\u200b\u5185\u5b58","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_242","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>Byte Buffer \u200b\u6709\u200b\u4e24\u79cd\u200b\u7c7b\u578b\u200b\uff0c\u200b\u4e00\u79cd\u200b\u662f\u200b\u57fa\u4e8e\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\uff08\u200b\u4e5f\u200b\u5c31\u200b\u662f\u975e\u200b\u5806\u200b\u5185\u5b58\u200b\uff09\uff0c\u200b\u53e6\u200b\u4e00\u79cd\u200b\u662f\u975e\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5806\u200b\u5185\u5b58\u200b\uff09</p> <p>Direct Memory \u200b\u4f18\u70b9\u200b\uff1a</p> <ul> <li>Java \u200b\u7684\u200b NIO \u200b\u5e93\u200b\u5141\u8bb8\u200b Java \u200b\u7a0b\u5e8f\u200b\u4f7f\u7528\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\uff0c\u200b\u4f7f\u7528\u200b native \u200b\u51fd\u6570\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u5806\u5916\u200b\u5185\u5b58\u200b</li> <li>\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u9ad8\u200b\uff0c\u200b\u8bfb\u5199\u200b\u9891\u7e41\u200b\u7684\u200b\u573a\u5408\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b</li> <li>\u200b\u5927\u5927\u63d0\u9ad8\u200b IO \u200b\u6027\u80fd\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u5728\u200b Java \u200b\u5806\u200b\u548c\u200b native \u200b\u5806\u200b\u6765\u56de\u200b\u590d\u5236\u200b\u6570\u636e\u200b</li> </ul> <p>\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u4e0d\u80fd\u200b\u4f7f\u7528\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b Page Cache \u200b\u7684\u200b\u7f13\u5b58\u200b\u4f18\u52bf\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7f13\u5b58\u200b\u6700\u8fd1\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u4f7f\u7528\u200b\u9884\u8bfb\u200b\u529f\u80fd\u200b</li> <li>\u200b\u5206\u914d\u200b\u56de\u6536\u200b\u6210\u672c\u200b\u8f83\u200b\u9ad8\u200b\uff0c\u200b\u4e0d\u200b\u53d7\u200b JVM \u200b\u5185\u5b58\u200b\u56de\u6536\u200b\u7ba1\u7406\u200b</li> <li>\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b OutOfMemoryError \u200b\u5f02\u5e38\u200b\uff1aOutOfMemoryError: Direct buffer memory</li> <li>\u200b\u56de\u6536\u200b\u4f9d\u8d56\u200b System.gc() \u200b\u7684\u200b\u8c03\u7528\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u8c03\u7528\u200b JVM \u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u6267\u884c\u200b\u3001\u200b\u4e5f\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u4f55\u65f6\u200b\u6267\u884c\u200b\uff0c\u200b\u884c\u4e3a\u200b\u662f\u200b\u4e0d\u200b\u53ef\u63a7\u200b\u7684\u200b\u3002\u200b\u7a0b\u5e8f\u200b\u4e00\u822c\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u7ba1\u7406\u200b\uff0c\u200b\u6210\u5bf9\u200b\u53bb\u200b\u8c03\u7528\u200b malloc\u3001free</li> </ul> <p>\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a</p> <ul> <li>\u200b\u4f20\u8f93\u200b\u5f88\u5927\u200b\u7684\u200b\u6570\u636e\u6587\u4ef6\u200b\uff0c\u200b\u6570\u636e\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u5f88\u957f\u200b\uff0c\u200b\u5bfc\u81f4\u200b Page Cache \u200b\u6ca1\u6709\u200b\u8d77\u5230\u200b\u7f13\u5b58\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u4e00\u822c\u200b\u91c7\u7528\u200b\u76f4\u63a5\u200b IO \u200b\u7684\u200b\u65b9\u5f0f\u200b</li> <li>\u200b\u9002\u5408\u200b\u9891\u7e41\u200b\u7684\u200b IO \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7f51\u7edc\u200b\u5e76\u53d1\u200b\u573a\u666f\u200b</li> </ul> <p>\u200b\u6570\u636e\u6d41\u200b\u7684\u200b\u89d2\u5ea6\u200b\uff1a</p> <ul> <li>\u200b\u975e\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u7684\u200b\u4f5c\u7528\u200b\u94fe\u200b\uff1a\u200b\u672c\u5730\u200b IO \u2192 \u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u2192 \u200b\u7528\u6237\u200b\uff08JVM\uff09\u200b\u7f13\u51b2\u533a\u200b \u2192\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b \u2192 \u200b\u672c\u5730\u200b IO</li> <li>\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u662f\u200b\uff1a\u200b\u672c\u5730\u200b IO \u2192 \u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b \u2192 \u200b\u672c\u5730\u200b IO</li> </ul> <p>JVM \u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u56fe\u89e3\u200b\uff1a</p> <p></p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_243","title":"\u901a\u4fe1\u200b\u539f\u7406","text":"<p>\u200b\u5806\u5916\u200b\u5185\u5b58\u200b\u4e0d\u200b\u53d7\u200b JVM GC \u200b\u63a7\u5236\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5806\u5916\u200b\u5185\u5b58\u200b\u8fdb\u884c\u200b\u901a\u4fe1\u200b\uff0c\u200b\u9632\u6b62\u200b GC \u200b\u540e\u200b\u7f13\u51b2\u533a\u200b\u4f4d\u7f6e\u200b\u53d1\u751f\u53d8\u5316\u200b\u7684\u200b\u60c5\u51b5\u200b</p> <p>NIO \u200b\u4f7f\u7528\u200b\u7684\u200b SocketChannel \u200b\u4e5f\u200b\u662f\u200b\u4f7f\u7528\u200b\u7684\u200b\u5806\u5916\u200b\u5185\u5b58\u200b\uff0c\u200b\u6e90\u7801\u200b\u89e3\u6790\u200b\uff1a</p> <ul> <li>SocketChannel#write(java.nio.ByteBuffer) \u2192 SocketChannelImpl#write(java.nio.ByteBuffer)</li> </ul> Java<pre><code>public int write(ByteBuffer var1) throws IOException {\n     do {\n         var3 = IOUtil.write(this.fd, var1, -1L, nd);\n     } while(var3 == -3 &amp;&amp; this.isOpen());\n}\n</code></pre> <ul> <li>IOUtil#write(java.io.FileDescriptor, java.nio.ByteBuffer, long, sun.nio.ch.NativeDispatcher)</li> </ul> Java<pre><code>static int write(FileDescriptor var0, ByteBuffer var1, long var2, NativeDispatcher var4) {\n    // \u3010\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\uff0c\u200b\u662f\u200b\u5219\u200b\u76f4\u63a5\u200b\u5199\u51fa\u200b\uff0c\u200b\u4e0d\u662f\u200b\u5219\u200b\u5c01\u88c5\u200b\u5230\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u3011\n    if (var1 instanceof DirectBuffer) {\n        return writeFromNativeBuffer(var0, var1, var2, var4);\n    } else {\n        //....\n        // \u200b\u4ece\u5806\u200b\u5185\u200bbuffer\u200b\u62f7\u8d1d\u5230\u200b\u5806\u5916\u200bbuffer\n        ByteBuffer var8 = Util.getTemporaryDirectBuffer(var7);\n        var8.put(var1);\n        //...\n        // \u200b\u4ece\u5806\u200b\u5916\u200b\u5199\u200b\u5230\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\n      int var9 = writeFromNativeBuffer(var0, var8, var2, var4);\n  }\n}\n</code></pre> <ul> <li>\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u76f8\u540c\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_244","title":"\u5206\u914d\u200b\u56de\u6536","text":"<p>\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u521b\u5efa\u200b Buffer \u200b\u5bf9\u8c61\u200b\uff1a<code>static XxxBuffer allocateDirect(int capacity)</code></p> <p>DirectByteBuffer \u200b\u6e90\u7801\u200b\u5206\u6790\u200b\uff1a</p> Java<pre><code>DirectByteBuffer(int cap) { \n    //....\n    long base = 0;\n    try {\n        // \u200b\u5206\u914d\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\n        base = unsafe.allocateMemory(size);\n    }\n    // \u200b\u5185\u5b58\u200b\u8d4b\u503c\u200b\n    unsafe.setMemory(base, size, (byte) 0);\n    if (pa &amp;&amp; (base % ps != 0)) {\n        address = base + ps - (base &amp; (ps - 1));\n    } else {\n        address = base;\n    }\n    // \u200b\u521b\u5efa\u200b\u56de\u6536\u200b\u51fd\u6570\u200b\n    cleaner = Cleaner.create(this, new Deallocator(base, size, cap));\n}\nprivate static class Deallocator implements Runnable {\n    public void run() {\n        unsafe.freeMemory(address);\n        //...\n    }\n}\n</code></pre> <p>\u200b\u5206\u914d\u200b\u548c\u200b\u56de\u6536\u200b\u539f\u7406\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b\u4e86\u200b Unsafe \u200b\u5bf9\u8c61\u200b\u7684\u200b allocateMemory \u200b\u65b9\u6cd5\u200b\u5b8c\u6210\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u7684\u200b\u5206\u914d\u200b\uff0csetMemory \u200b\u65b9\u6cd5\u200b\u5b8c\u6210\u200b\u8d4b\u503c\u200b</li> <li>ByteBuffer \u200b\u7684\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u5185\u90e8\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e86\u200b Cleaner\uff08\u200b\u865a\u200b\u5f15\u7528\u200b\uff09\u200b\u6765\u200b\u76d1\u6d4b\u200b ByteBuffer \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4e00\u65e6\u200b ByteBuffer \u200b\u5bf9\u8c61\u200b\u88ab\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u90a3\u4e48\u200b ReferenceHandler \u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b Cleaner \u200b\u7684\u200b clean \u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b Deallocator \u200b\u7684\u200b run\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6700\u540e\u200b\u901a\u8fc7\u200b freeMemory \u200b\u6765\u200b\u91ca\u653e\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b</li> </ul> Java<pre><code>/**\n * \u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u7684\u200b\u5e95\u5c42\u200b\u539f\u7406\u200b\uff1aUnsafe\n */\npublic class Demo1_27 {\n    static int _1Gb = 1024 * 1024 * 1024;\n\n    public static void main(String[] args) throws IOException {\n        Unsafe unsafe = getUnsafe();\n        // \u200b\u5206\u914d\u5185\u5b58\u200b\n        long base = unsafe.allocateMemory(_1Gb);\n        unsafe.setMemory(base, _1Gb, (byte) 0);\n        System.in.read();\n        // \u200b\u91ca\u653e\u200b\u5185\u5b58\u200b\n        unsafe.freeMemory(base);\n        System.in.read();\n    }\n\n    public static Unsafe getUnsafe() {\n        try {\n            Field f = Unsafe.class.getDeclaredField(\"theUnsafe\");\n            f.setAccessible(true);\n            Unsafe unsafe = (Unsafe) f.get(null);\n            return unsafe;\n        } catch (NoSuchFieldException | IllegalAccessException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_245","title":"\u5171\u4eab\u5185\u5b58","text":"<p>FileChannel \u200b\u63d0\u4f9b\u200b map \u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b MappedByteBuffer \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u6587\u4ef6\u200b\u6620\u5c04\u200b\u5230\u200b\u5185\u5b58\u200b\uff0c\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u53ef\u4ee5\u200b\u6620\u5c04\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5982\u679c\u200b\u6587\u4ef6\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5206\u6bb5\u200b\u6620\u5c04\u200b\uff0c\u200b\u5b8c\u6210\u200b\u6620\u5c04\u200b\u540e\u200b\u5bf9\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u7684\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u88ab\u200b\u540c\u6b65\u200b\u5230\u200b\u786c\u76d8\u200b\u4e0a\u200b</p> <p>FileChannel \u200b\u4e2d\u200b\u7684\u200b\u6210\u5458\u200b\u5c5e\u6027\u200b\uff1a</p> <ul> <li>MapMode.mode\uff1a\u200b\u5185\u5b58\u200b\u6620\u50cf\u200b\u6587\u4ef6\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5171\u200b\u4e09\u79cd\u200b\uff1a</li> <li><code>MapMode.READ_ONLY</code>\uff1a\u200b\u53ea\u8bfb\u200b\uff0c\u200b\u4fee\u6539\u200b\u5f97\u5230\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u5c06\u200b\u5bfc\u81f4\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> <li><code>MapMode.READ_WRITE</code>\uff1a\u200b\u8bfb\u200b/\u200b\u5199\u200b\uff0c\u200b\u5bf9\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u66f4\u6539\u200b\u6700\u7ec8\u200b\u5c06\u200b\u5199\u5165\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f46\u200b\u6b64\u6b21\u200b\u4fee\u6539\u200b\u5bf9\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u200b\u6587\u4ef6\u200b\u7684\u200b\u5176\u4ed6\u200b\u7a0b\u5e8f\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u662f\u200b\u53ef\u89c1\u200b</li> <li><code>MapMode.PRIVATE</code>\uff1a\u200b\u79c1\u7528\u200b\uff0c\u200b\u53ef\u8bfb\u200b\u53ef\u200b\u5199\u200b\uff0c\u200b\u4f46\u662f\u200b\u4fee\u6539\u200b\u7684\u200b\u5185\u5bb9\u200b\u4e0d\u4f1a\u200b\u5199\u5165\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ea\u662f\u200b buffer \u200b\u81ea\u8eab\u200b\u7684\u200b\u6539\u53d8\u200b</li> <li><code>public final FileLock lock()</code>\uff1a\u200b\u83b7\u53d6\u200b\u6b64\u200b\u6587\u4ef6\u200b\u901a\u9053\u200b\u7684\u200b\u6392\u200b\u4ed6\u200b\u9501\u200b</li> </ul> <p>MappedByteBuffer\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u6587\u4ef6\u200b\u5728\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\uff08\u200b\u5806\u5916\u200b\u5185\u5b58\u200b\uff09\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u53eb\u505a\u200b\u5185\u5b58\u200b\u6620\u5c04\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u7cfb\u7edf\u200b\u5e95\u5c42\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u6ca1\u6709\u200b JVM \u200b\u548c\u200b OS \u200b\u4e4b\u95f4\u200b\u7684\u200b\u590d\u5236\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u4f20\u8f93\u200b\u6548\u7387\u200b\uff0c\u200b\u4f5c\u7528\u200b\uff1a</p> <ul> <li>\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u8fdb\u7a0b\u200b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\uff0c\u200b\u80fd\u200b\u8fbe\u5230\u200b\u5171\u4eab\u5185\u5b58\u200b\u9875\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u9ad8\u200b\u5e76\u53d1\u200b\u4e0b\u8981\u200b\u5bf9\u200b\u6587\u4ef6\u200b\u5185\u5b58\u200b\u8fdb\u884c\u200b\u52a0\u9501\u200b\uff0c\u200b\u9632\u6b62\u51fa\u73b0\u200b\u8bfb\u5199\u200b\u5185\u5bb9\u200b\u6df7\u4e71\u200b\u548c\u200b\u4e0d\u4e00\u81f4\u6027\u200b\uff0cJava \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6587\u4ef6\u200b\u9501\u200b FileLock\uff0c\u200b\u4f46\u200b\u5728\u200b\u7236\u200b/\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\u4e2d\u200b\u9501\u5b9a\u200b\u540e\u200b\u53e6\u200b\u4e00\u200b\u8fdb\u7a0b\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u7b49\u5f85\u200b\uff0c\u200b\u6548\u7387\u200b\u4e0d\u9ad8\u200b</li> <li>\u200b\u8bfb\u5199\u200b\u90a3\u4e9b\u200b\u592a\u5927\u800c\u200b\u4e0d\u80fd\u200b\u653e\u8fdb\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5206\u6bb5\u200b\u6620\u5c04\u200b</li> </ul> <p>MappedByteBuffer \u200b\u8f83\u4e4b\u200b ByteBuffer \u200b\u65b0\u589e\u200b\u7684\u200b\u4e09\u4e2a\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>final MappedByteBuffer force()</code>\uff1a\u200b\u7f13\u51b2\u533a\u200b\u662f\u200b READ_WRITE \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5bf9\u200b\u7f13\u51b2\u533a\u200b\u5185\u5bb9\u200b\u7684\u200b\u4fee\u6539\u200b\u5f3a\u5236\u200b\u5199\u5165\u200b\u6587\u4ef6\u200b</li> <li><code>final MappedByteBuffer load()</code>\uff1a\u200b\u5c06\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5185\u5bb9\u200b\u8f7d\u5165\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\uff0c\u200b\u5e76\u200b\u8fd4\u56de\u200b\u8be5\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5f15\u7528\u200b</li> <li><code>final boolean isLoaded()</code>\uff1a\u200b\u5982\u679c\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u5185\u5bb9\u200b\u5728\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u771f\u200b\uff0c\u200b\u5426\u5219\u200b\u8fd4\u56de\u200b\u5047\u200b</li> </ul> Java<pre><code>public class MappedByteBufferTest {\n    public static void main(String[] args) throws Exception {\n        // \u200b\u8bfb\u5199\u200b\u6a21\u5f0f\u200b\n        RandomAccessFile ra = new RandomAccessFile(\"1.txt\", \"rw\");\n        // \u200b\u83b7\u53d6\u200b\u5bf9\u5e94\u200b\u7684\u200b\u901a\u9053\u200b\n        FileChannel channel = ra.getChannel();\n\n        /**\n         * \u200b\u53c2\u6570\u200b1  FileChannel.MapMode.READ_WRITE \u200b\u4f7f\u7528\u200b\u7684\u200b\u8bfb\u5199\u200b\u6a21\u5f0f\u200b\n         * \u200b\u53c2\u6570\u200b2  0: \u200b\u6587\u4ef6\u200b\u6620\u5c04\u200b\u65f6\u200b\u7684\u200b\u8d77\u59cb\u200b\u4f4d\u7f6e\u200b\n         * \u200b\u53c2\u6570\u200b3  5: \u200b\u662f\u200b\u6620\u5c04\u200b\u5230\u200b\u5185\u5b58\u200b\u7684\u200b\u5927\u5c0f\u200b\uff08\u200b\u4e0d\u662f\u200b\u7d22\u5f15\u200b\u4f4d\u7f6e\u200b\uff09\uff0c\u200b\u5373\u5c06\u200b 1.txt \u200b\u7684\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5b57\u8282\u200b\u6620\u5c04\u200b\u5230\u200b\u5185\u5b58\u200b\n         * \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4fee\u6539\u200b\u7684\u200b\u8303\u56f4\u200b\u5c31\u662f\u200b 0-5\n         * \u200b\u5b9e\u9645\u200b\u7c7b\u578b\u200b DirectByteBuffer\n         */\n        MappedByteBuffer buffer = channel.map(FileChannel.MapMode.READ_WRITE, 0, 5);\n\n        buffer.put(0, (byte) 'H');\n        buffer.put(3, (byte) '9');\n        buffer.put(5, (byte) 'Y');  //IndexOutOfBoundsException\n\n        ra.close();\n        System.out.println(\"\u200b\u4fee\u6539\u200b\u6210\u529f\u200b~~\");\n    }\n}\n</code></pre> <p>\u200b\u4ece\u200b\u786c\u76d8\u200b\u4e0a\u5c06\u200b\u6587\u4ef6\u200b\u8bfb\u5165\u200b\u5185\u5b58\u200b\uff0c\u200b\u8981\u200b\u7ecf\u8fc7\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u8fdb\u884c\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u62f7\u8d1d\u200b\u64cd\u4f5c\u200b\u662f\u200b\u7531\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u548c\u200b\u786c\u4ef6\u200b\u9a71\u52a8\u200b\u5b9e\u73b0\u200b\u3002\u200b\u901a\u8fc7\u200b\u5185\u5b58\u200b\u6620\u5c04\u200b\u7684\u200b\u65b9\u6cd5\u200b\u8bbf\u95ee\u200b\u786c\u76d8\u200b\u4e0a\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u62f7\u8d1d\u200b\u6570\u636e\u200b\u7684\u200b\u6548\u7387\u200b\u8981\u200b\u6bd4\u200b read \u200b\u548c\u200b write \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u9ad8\u200b\uff1a</p> <ul> <li>read() \u200b\u662f\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u9996\u5148\u200b\u5c06\u200b\u6587\u4ef6\u200b\u4ece\u200b\u786c\u76d8\u200b\u62f7\u8d1d\u5230\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u518d\u200b\u5c06\u200b\u8fd9\u4e9b\u200b\u6570\u636e\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e24\u6b21\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b</li> <li>mmap() \u200b\u4e5f\u200b\u662f\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u8fdb\u884c\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5f53\u200b\u7f3a\u9875\u200b\u4e2d\u65ad\u200b\u53d1\u751f\u200b\u65f6\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5c06\u200b\u6587\u4ef6\u200b\u4ece\u200b\u786c\u76d8\u200b\u62f7\u8d1d\u5230\u200b\u5171\u4eab\u5185\u5b58\u200b\uff0c\u200b\u53ea\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u6b21\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b</li> </ul> <p>\u200b\u6ce8\u610f\u200b\uff1ammap \u200b\u7684\u200b\u6587\u4ef6\u200b\u6620\u5c04\u200b\uff0c\u200b\u5728\u200b Full GC \u200b\u65f6\u624d\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u91ca\u653e\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u6e05\u9664\u200b\u5185\u5b58\u200b\u6620\u5c04\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53cd\u5c04\u200b\u8c03\u7528\u200b sun.misc.Cleaner \u200b\u65b9\u6cd5\u200b</p> <p>\u200b\u53c2\u8003\u200b\u6587\u7ae0\u200b\uff1ahttps://www.jianshu.com/p/f90866dcbffc</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_246","title":"\u901a\u9053","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_247","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u901a\u9053\u200b\uff08Channel\uff09\uff1a\u200b\u8868\u793a\u200b IO \u200b\u6e90\u200b\u4e0e\u200b\u76ee\u6807\u200b\u6253\u5f00\u200b\u7684\u200b\u8fde\u63a5\u200b\uff0cChannel \u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u4f20\u7edf\u200b\u7684\u200b\u6d41\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b Channel \u200b\u672c\u8eab\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u6570\u636e\u200b\uff0cChannel \u200b\u53ea\u80fd\u200b\u4e0e\u200b Buffer \u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b</p> <ol> <li>NIO \u200b\u7684\u200b\u901a\u9053\u200b\u7c7b\u4f3c\u200b\u4e8e\u6d41\u200b\uff0c\u200b\u4f46\u200b\u6709\u4e9b\u200b\u533a\u522b\u200b\u5982\u4e0b\u200b\uff1a</li> <li>\u200b\u901a\u9053\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u8bfb\u5199\u200b\uff0c\u200b\u800c\u6d41\u200b\u53ea\u80fd\u200b\u8bfb\u200b\u6216\u8005\u200b\u53ea\u80fd\u200b\u5199\u200b</li> <li>\u200b\u901a\u9053\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u5f02\u6b65\u200b\u8bfb\u5199\u200b\u6570\u636e\u200b</li> <li> <p>\u200b\u901a\u9053\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u7f13\u51b2\u200b\u8bfb\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5199\u200b\u6570\u636e\u200b\u5230\u200b\u7f13\u51b2\u200b</p> </li> <li> <p>BIO \u200b\u4e2d\u200b\u7684\u200b Stream \u200b\u662f\u200b\u5355\u5411\u200b\u7684\u200b\uff0cNIO \u200b\u4e2d\u200b\u7684\u200b Channel \u200b\u662f\u200b\u53cc\u5411\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5199\u200b\u64cd\u4f5c\u200b</p> </li> <li>Channel \u200b\u5728\u200b NIO \u200b\u4e2d\u662f\u200b\u4e00\u4e2a\u200b\u63a5\u53e3\u200b\uff1a<code>public interface Channel extends Closeable{}</code></li> </ol> <p>Channel \u200b\u5b9e\u73b0\u200b\u7c7b\u200b\uff1a</p> <ul> <li>FileChannel\uff1a\u200b\u7528\u4e8e\u200b\u8bfb\u53d6\u200b\u3001\u200b\u5199\u5165\u200b\u3001\u200b\u6620\u5c04\u200b\u548c\u200b\u64cd\u4f5c\u200b\u6587\u4ef6\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u53ea\u80fd\u200b\u5de5\u4f5c\u200b\u5728\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\u4e0b\u200b</li> <li>\u200b\u901a\u8fc7\u200b FileInputStream \u200b\u83b7\u53d6\u200b\u7684\u200b Channel \u200b\u53ea\u80fd\u200b\u8bfb\u200b</li> <li>\u200b\u901a\u8fc7\u200b FileOutputStream \u200b\u83b7\u53d6\u200b\u7684\u200b Channel \u200b\u53ea\u80fd\u200b\u5199\u200b</li> <li> <p>\u200b\u901a\u8fc7\u200b RandomAccessFile \u200b\u662f\u5426\u200b\u80fd\u200b\u8bfb\u5199\u200b\u6839\u636e\u200b\u6784\u9020\u200b RandomAccessFile \u200b\u65f6\u200b\u7684\u200b\u8bfb\u5199\u200b\u6a21\u5f0f\u200b\u51b3\u5b9a\u200b</p> </li> <li> <p>DatagramChannel\uff1a\u200b\u901a\u8fc7\u200b UDP \u200b\u8bfb\u5199\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u901a\u9053\u200b</p> </li> <li>SocketChannel\uff1a\u200b\u901a\u8fc7\u200b TCP \u200b\u8bfb\u5199\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>ServerSocketChannel\uff1a\u200b\u53ef\u4ee5\u200b\u76d1\u542c\u200b\u65b0\u200b\u8fdb\u6765\u200b\u7684\u200b TCP \u200b\u8fde\u63a5\u200b\uff0c\u200b\u5bf9\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u8fdb\u6765\u200b\u7684\u200b\u8fde\u63a5\u200b\u90fd\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b SocketChannel</li> </ul> <p>\u200b\u63d0\u793a\u200b\uff1aServerSocketChanne \u200b\u7c7b\u4f3c\u200b ServerSocket\u3001SocketChannel \u200b\u7c7b\u4f3c\u200b Socket</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#api_3","title":"\u5e38\u7528\u200bAPI","text":"<p>\u200b\u83b7\u53d6\u200b Channel \u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>\u200b\u5bf9\u200b\u652f\u6301\u200b\u901a\u9053\u200b\u7684\u200b\u5bf9\u8c61\u200b\u8c03\u7528\u200b <code>getChannel()</code> \u200b\u65b9\u6cd5\u200b</li> <li>\u200b\u901a\u8fc7\u200b\u901a\u9053\u200b\u7684\u200b\u9759\u6001\u65b9\u6cd5\u200b <code>open()</code> \u200b\u6253\u5f00\u200b\u5e76\u200b\u8fd4\u56de\u200b\u6307\u5b9a\u200b\u901a\u9053\u200b</li> <li>\u200b\u4f7f\u7528\u200b Files \u200b\u7c7b\u200b\u7684\u200b\u9759\u6001\u65b9\u6cd5\u200b <code>newByteChannel()</code> \u200b\u83b7\u53d6\u200b\u5b57\u8282\u200b\u901a\u9053\u200b</li> </ul> <p>Channel \u200b\u57fa\u672c\u64cd\u4f5c\u200b\uff1a\u200b\u8bfb\u5199\u200b\u90fd\u200b\u662f\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u5185\u5b58\u200b\u6765\u770b\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u7f13\u51b2\u533a\u200b</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public abstract int read(ByteBuffer dst) \u200b\u4ece\u200b Channel \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b ByteBuffer\uff0c\u200b\u4ece\u200b position \u200b\u5f00\u59cb\u200b\u50a8\u5b58\u200b public final long read(ByteBuffer[] dsts) \u200b\u5c06\u200b Channel \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5206\u6563\u200b\u5230\u200b ByteBuffer[] public abstract int write(ByteBuffer src) \u200b\u5c06\u200b ByteBuffer \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b Channel\uff0c\u200b\u4ece\u200b position \u200b\u5f00\u59cb\u200b\u5199\u51fa\u200b public final long write(ByteBuffer[] srcs) \u200b\u5c06\u200b ByteBuffer[] \u200b\u5230\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u805a\u96c6\u200b\u5230\u200b Channel public abstract long position() \u200b\u8fd4\u56de\u200b\u6b64\u200b\u901a\u9053\u200b\u7684\u200b\u6587\u4ef6\u200b\u4f4d\u7f6e\u200b FileChannel position(long newPosition) \u200b\u8bbe\u7f6e\u200b\u6b64\u200b\u901a\u9053\u200b\u7684\u200b\u6587\u4ef6\u200b\u4f4d\u7f6e\u200b public abstract long size() \u200b\u8fd4\u56de\u200b\u6b64\u200b\u901a\u9053\u200b\u7684\u200b\u6587\u4ef6\u200b\u7684\u200b\u5f53\u524d\u200b\u5927\u5c0f\u200b <p>SelectableChannel \u200b\u7684\u200b\u64cd\u4f5c\u200b API\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b SocketChannel accept() \u200b\u5982\u679c\u200b\u901a\u9053\u200b\u5904\u4e8e\u200b\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u6ca1\u6709\u200b\u8bf7\u6c42\u200b\u8fde\u63a5\u200b\u65f6\u6b64\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b NULL\uff0c\u200b\u5426\u5219\u200b\u5c06\u200b\u963b\u585e\u200b\u76f4\u5230\u200b\u6709\u200b\u65b0\u200b\u7684\u200b\u8fde\u63a5\u200b\u6216\u200b\u53d1\u751f\u200b I/O \u200b\u9519\u8bef\u200b\uff0c\u200b\u901a\u8fc7\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u7684\u200b\u5957\u200b\u63a5\u5b57\u200b\u901a\u9053\u200b\u5c06\u200b\u5904\u4e8e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b SelectionKey register(Selector sel, int ops) \u200b\u5c06\u200b\u901a\u9053\u200b\u6ce8\u518c\u200b\u5230\u200b\u9009\u62e9\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5e76\u200b\u6307\u5b9a\u200b\u76d1\u542c\u200b\u4e8b\u4ef6\u200b SelectionKey register(Selector sel, int ops, Object att) \u200b\u5c06\u200b\u901a\u9053\u200b\u6ce8\u518c\u200b\u5230\u200b\u9009\u62e9\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u5f53\u524d\u200b\u901a\u9053\u200b\u7ed1\u5b9a\u200b\u4e00\u4e2a\u200b\u9644\u4ef6\u200b\u5bf9\u8c61\u200b\uff0cObject \u200b\u4ee3\u8868\u200b\u53ef\u4ee5\u200b\u662f\u200b\u4efb\u4f55\u200b\u7c7b\u578b","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_248","title":"\u6587\u4ef6\u200b\u8bfb\u5199","text":"Java<pre><code>public class ChannelTest {\n    @Test\n    public void write() throws Exception{\n        // 1\u3001\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u901a\u200b\u5411\u200b\u76ee\u6807\u200b\u6587\u4ef6\u200b\n        FileOutputStream fos = new FileOutputStream(\"data01.txt\");\n        // 2\u3001\u200b\u5f97\u5230\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u5bf9\u5e94\u200b\u7684\u200b\u901a\u9053\u200b  \u3010FileChannel\u3011\n        FileChannel channel = fos.getChannel();\n        // 3\u3001\u200b\u5206\u914d\u200b\u7f13\u51b2\u533a\u200b\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        buffer.put(\"hello,\u200b\u9ed1\u9a6c\u200bJava\u200b\u7a0b\u5e8f\u5458\u200b\uff01\".getBytes());\n        // 4\u3001\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u5207\u6362\u200b\u6210\u200b\u5199\u51fa\u200b\u6a21\u5f0f\u200b\n        buffer.flip();\n        channel.write(buffer);\n        channel.close();\n        System.out.println(\"\u200b\u5199\u200b\u6570\u636e\u200b\u5230\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff01\");\n    }\n    @Test\n    public void read() throws Exception {\n        // 1\u3001\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u200b\u4e0e\u200b\u6e90\u6587\u4ef6\u200b\u63a5\u901a\u200b\n        FileInputStream fis = new FileInputStream(\"data01.txt\");\n        // 2\u3001\u200b\u9700\u8981\u200b\u5f97\u5230\u200b\u6587\u4ef6\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u200b\u7684\u200b\u6587\u4ef6\u200b\u901a\u9053\u200b\n        FileChannel channel = fis.getChannel();\n        // 3\u3001\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u7f13\u51b2\u533a\u200b\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        // 4\u3001\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\n        channel.read(buffer);\n        buffer.flip();\n        // 5\u3001\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5e76\u200b\u8f93\u51fa\u200b\u5373\u53ef\u200b\n        String rs = new String(buffer.array(),0,buffer.remaining());\n        System.out.println(rs);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_249","title":"\u6587\u4ef6\u200b\u590d\u5236","text":"<p>Channel \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1asendfile \u200b\u5b9e\u73b0\u200b\u96f6\u200b\u62f7\u8d1d\u200b</p> <ul> <li><code>abstract long transferFrom(ReadableByteChannel src, long position, long count)</code>\uff1a\u200b\u4ece\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u53ef\u8bfb\u200b\u5b57\u8282\u200b\u901a\u9053\u200b\u5c06\u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b\u5230\u200b\u8be5\u200b\u901a\u9053\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e2d\u200b</li> <li>src\uff1a\u200b\u6e90\u200b\u901a\u9053\u200b</li> <li>position\uff1a\u200b\u6587\u4ef6\u200b\u4e2d\u8981\u200b\u8fdb\u884c\u200b\u4f20\u8f93\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5fc5\u987b\u200b\u662f\u975e\u200b\u8d1f\u200b\u7684\u200b </li> <li>count\uff1a\u200b\u8981\u200b\u4f20\u8f93\u200b\u7684\u200b\u6700\u5927\u200b\u5b57\u8282\u6570\u200b\uff0c\u200b\u5fc5\u987b\u200b\u662f\u975e\u200b\u8d1f\u200b\u7684\u200b </li> <li><code>abstract long transferTo(long position, long count, WritableByteChannel target)</code>\uff1a\u200b\u5c06\u200b\u8be5\u200b\u901a\u9053\u200b\u6587\u4ef6\u200b\u7684\u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b\u5230\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u53ef\u200b\u5199\u200b\u5b57\u8282\u200b\u901a\u9053\u200b\u3002</li> <li>position\uff1a\u200b\u4f20\u8f93\u200b\u5f00\u59cb\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u4f4d\u7f6e\u200b; \u200b\u5fc5\u987b\u200b\u662f\u975e\u200b\u8d1f\u200b\u7684\u200b </li> <li>count\uff1a\u200b\u8981\u200b\u4f20\u8f93\u200b\u7684\u200b\u6700\u5927\u200b\u5b57\u8282\u6570\u200b; \u200b\u5fc5\u987b\u200b\u662f\u975e\u200b\u8d1f\u200b\u7684\u200b </li> <li>target\uff1a\u200b\u76ee\u6807\u200b\u901a\u9053\u200b </li> </ul> <p>\u200b\u6587\u4ef6\u200b\u590d\u5236\u200b\u7684\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff1a</p> <ol> <li>Buffer</li> <li>\u200b\u4f7f\u7528\u200b\u4e0a\u8ff0\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b</li> </ol> <p></p> Java<pre><code>public class ChannelTest {\n    @Test\n    public void copy1() throws Exception {\n        File srcFile = new File(\"C:\\\\\u200b\u58c1\u7eb8\u200b.jpg\");\n        File destFile = new File(\"C:\\\\Users\\\\\u200b\u58c1\u7eb8\u200bnew.jpg\");\n        // \u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u6d41\u200b\n        FileInputStream fis = new FileInputStream(srcFile);\n        // \u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\n        FileOutputStream fos = new FileOutputStream(destFile);\n        // \u200b\u5f97\u5230\u200b\u7684\u200b\u662f\u200b\u6587\u4ef6\u200b\u901a\u9053\u200b\n        FileChannel isChannel = fis.getChannel();\n        FileChannel osChannel = fos.getChannel();\n        // \u200b\u5206\u914d\u200b\u7f13\u51b2\u533a\u200b\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        while(true){\n            // \u200b\u5fc5\u987b\u200b\u5148\u200b\u6e05\u7a7a\u200b\u7f13\u51b2\u200b\u7136\u540e\u200b\u518d\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\n            buffer.clear();\n            // \u200b\u5f00\u59cb\u200b\u8bfb\u53d6\u200b\u4e00\u6b21\u200b\u6570\u636e\u200b\n            int flag = isChannel.read(buffer);\n            if(flag == -1){\n                break;\n            }\n            // \u200b\u5df2\u7ecf\u200b\u8bfb\u53d6\u200b\u4e86\u200b\u6570\u636e\u200b \uff0c\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u6a21\u5f0f\u200b\u5207\u6362\u200b\u6210\u53ef\u8bfb\u200b\u6a21\u5f0f\u200b\n            buffer.flip();\n            // \u200b\u628a\u200b\u6570\u636e\u200b\u5199\u51fa\u200b\u5230\u200b\n            osChannel.write(buffer);\n        }\n        isChannel.close();\n        osChannel.close();\n        System.out.println(\"\u200b\u590d\u5236\u200b\u5b8c\u6210\u200b\uff01\");\n    }\n\n    @Test\n    public void copy02() throws Exception {\n        // 1\u3001\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u7ba1\u9053\u200b\n        FileInputStream fis = new FileInputStream(\"data01.txt\");\n        FileChannel isChannel = fis.getChannel();\n        // 2\u3001\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u7ba1\u9053\u200b\n        FileOutputStream fos = new FileOutputStream(\"data03.txt\");\n        FileChannel osChannel = fos.getChannel();\n        // 3\u3001\u200b\u590d\u5236\u200b\n        osChannel.transferFrom(isChannel,isChannel.position(),isChannel.size());\n        isChannel.close();\n        osChannel.close();\n    }\n\n    @Test\n    public void copy03() throws Exception {\n        // 1\u3001\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u7ba1\u9053\u200b\n        FileInputStream fis = new FileInputStream(\"data01.txt\");\n        FileChannel isChannel = fis.getChannel();\n        // 2\u3001\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u7ba1\u9053\u200b\n        FileOutputStream fos = new FileOutputStream(\"data04.txt\");\n        FileChannel osChannel = fos.getChannel();\n        // 3\u3001\u200b\u590d\u5236\u200b\n        isChannel.transferTo(isChannel.position() , isChannel.size() , osChannel);\n        isChannel.close();\n        osChannel.close();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_250","title":"\u5206\u6563\u200b\u805a\u96c6","text":"<p>\u200b\u5206\u6563\u200b\u8bfb\u53d6\u200b\uff08Scatter \uff09\uff1a\u200b\u662f\u200b\u6307\u200b\u628a\u200b Channel \u200b\u901a\u9053\u200b\u7684\u200b\u6570\u636e\u200b\u8bfb\u5165\u200b\u5230\u200b\u591a\u4e2a\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53bb\u200b</p> <p>\u200b\u805a\u96c6\u200b\u5199\u5165\u200b\uff08Gathering \uff09\uff1a\u200b\u662f\u200b\u6307\u200b\u5c06\u200b\u591a\u4e2a\u200b Buffer \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u805a\u96c6\u200b\u5230\u200b Channel</p> Java<pre><code>public class ChannelTest {\n    @Test\n    public void test() throws IOException{\n        // 1\u3001\u200b\u5b57\u8282\u200b\u8f93\u5165\u200b\u7ba1\u9053\u200b\n        FileInputStream is = new FileInputStream(\"data01.txt\");\n        FileChannel isChannel = is.getChannel();\n        // 2\u3001\u200b\u5b57\u8282\u200b\u8f93\u51fa\u200b\u6d41\u200b\u7ba1\u9053\u200b\n        FileOutputStream fos = new FileOutputStream(\"data02.txt\");\n        FileChannel osChannel = fos.getChannel();\n        // 3\u3001\u200b\u5b9a\u4e49\u200b\u591a\u4e2a\u200b\u7f13\u51b2\u533a\u200b\u505a\u200b\u6570\u636e\u200b\u5206\u6563\u200b\n        ByteBuffer buffer1 = ByteBuffer.allocate(4);\n        ByteBuffer buffer2 = ByteBuffer.allocate(1024);\n        ByteBuffer[] buffers = {buffer1 , buffer2};\n        // 4\u3001\u200b\u4ece\u200b\u901a\u9053\u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5206\u6563\u200b\u5230\u200b\u5404\u4e2a\u200b\u7f13\u51b2\u533a\u200b\n        isChannel.read(buffers);\n        // 5\u3001\u200b\u4ece\u200b\u6bcf\u4e2a\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u67e5\u8be2\u200b\u662f\u5426\u200b\u6709\u200b\u6570\u636e\u200b\u8bfb\u53d6\u200b\u5230\u200b\u4e86\u200b\n        for(ByteBuffer buffer : buffers){\n            buffer.flip();// \u200b\u5207\u6362\u200b\u5230\u200b\u8bfb\u6570\u636e\u200b\u6a21\u5f0f\u200b\n            System.out.println(new String(buffer.array() , 0 , buffer.remaining()));\n        }\n        // 6\u3001\u200b\u805a\u96c6\u200b\u5199\u5165\u200b\u5230\u200b\u901a\u9053\u200b\n        osChannel.write(buffers);\n        isChannel.close();\n        osChannel.close();\n        System.out.println(\"\u200b\u6587\u4ef6\u200b\u590d\u5236\u200b~~\");\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_251","title":"\u9009\u62e9\u5668","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_252","title":"\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u9009\u62e9\u5668\u200b\uff08Selector\uff09 \u200b\u662f\u200b SelectableChannle \u200b\u5bf9\u8c61\u200b\u7684\u200b\u591a\u8def\u590d\u7528\u200b\u5668\u200b\uff0cSelector \u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u76d1\u63a7\u200b\u591a\u4e2a\u200b\u901a\u9053\u200b\u7684\u200b\u72b6\u51b5\u200b\uff0c\u200b\u5229\u7528\u200b Selector \u200b\u53ef\u200b\u4f7f\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b Channel\uff0cSelector \u200b\u662f\u975e\u200b\u963b\u585e\u200b IO \u200b\u7684\u200b\u6838\u5fc3\u200b</p> <p></p> <ul> <li>Selector \u200b\u80fd\u591f\u200b\u68c0\u6d4b\u200b\u591a\u4e2a\u200b\u6ce8\u518c\u200b\u7684\u200b\u901a\u9053\u200b\u4e0a\u200b\u662f\u5426\u200b\u6709\u200b\u4e8b\u4ef6\u200b\u53d1\u751f\u200b\uff08\u200b\u591a\u4e2a\u200b Channel \u200b\u4ee5\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u65b9\u5f0f\u200b\u53ef\u4ee5\u200b\u6ce8\u518c\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Selector)\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u4e8b\u4ef6\u200b\u53d1\u751f\u200b\uff0c\u200b\u5c31\u200b\u83b7\u53d6\u200b\u4e8b\u4ef6\u200b\u7136\u540e\u200b\u9488\u5bf9\u200b\u6bcf\u4e2a\u200b\u4e8b\u4ef6\u200b\u8fdb\u884c\u200b\u76f8\u5e94\u200b\u7684\u200b\u5904\u7406\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53ea\u7528\u200b\u4e00\u4e2a\u200b\u5355\u7ebf\u7a0b\u200b\u53bb\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u901a\u9053\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u8fde\u63a5\u200b\u548c\u200b\u8bf7\u6c42\u200b</li> <li>\u200b\u53ea\u6709\u200b\u5728\u200b\u8fde\u63a5\u200b/\u200b\u901a\u9053\u200b\u771f\u6b63\u200b\u6709\u200b\u8bfb\u5199\u200b\u4e8b\u4ef6\u200b\u53d1\u751f\u200b\u65f6\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u8bfb\u5199\u200b\uff0c\u200b\u5c31\u200b\u5927\u5927\u200b\u5730\u200b\u51cf\u5c11\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u5f00\u9500\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u5fc5\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u8fde\u63a5\u200b\u90fd\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e0d\u7528\u200b\u53bb\u200b\u7ef4\u62a4\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b</li> <li>\u200b\u907f\u514d\u200b\u4e86\u200b\u591a\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u5bfc\u81f4\u200b\u7684\u200b\u5f00\u9500\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#api_4","title":"\u5e38\u7528\u200bAPI","text":"<p>\u200b\u521b\u5efa\u200b Selector\uff1a<code>Selector selector = Selector.open();</code></p> <p>\u200b\u5411\u200b\u9009\u62e9\u5668\u200b\u6ce8\u518c\u200b\u901a\u9053\u200b\uff1a<code>SelectableChannel.register(Selector sel, int ops, Object att)</code></p> <ul> <li>\u200b\u53c2\u6570\u200b\u4e00\u200b\uff1a\u200b\u9009\u62e9\u5668\u200b\uff0c\u200b\u6307\u5b9a\u200b\u5f53\u524d\u200b Channel \u200b\u6ce8\u518c\u200b\u5230\u200b\u7684\u200b\u9009\u62e9\u5668\u200b</li> <li>\u200b\u53c2\u6570\u200b\u4e8c\u200b\uff1a\u200b\u9009\u62e9\u5668\u200b\u5bf9\u200b\u901a\u9053\u200b\u7684\u200b\u76d1\u542c\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u76d1\u542c\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u7c7b\u578b\u200b\u7528\u200b\u56db\u4e2a\u200b\u5e38\u91cf\u200b\u8868\u793a\u200b</li> <li>\u200b\u8bfb\u200b : SelectionKey.OP_READ \uff081\uff09</li> <li>\u200b\u5199\u200b : SelectionKey.OP_WRITE \uff084\uff09</li> <li>\u200b\u8fde\u63a5\u200b : SelectionKey.OP_CONNECT \uff088\uff09</li> <li>\u200b\u63a5\u6536\u200b : SelectionKey.OP_ACCEPT \uff0816\uff09</li> <li>\u200b\u82e5\u200b\u4e0d\u6b62\u200b\u76d1\u542c\u200b\u4e00\u4e2a\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4f4d\u200b\u6216\u200b\u64cd\u4f5c\u7b26\u200b\u8fde\u63a5\u200b\uff1a<code>int interest = SelectionKey.OP_READ | SelectionKey.OP_WRITE</code></li> <li>\u200b\u53c2\u6570\u200b\u4e09\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u5173\u8054\u200b\u4e00\u4e2a\u200b\u9644\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u4efb\u4f55\u200b\u5bf9\u8c61\u200b</li> </ul> <p>Selector API\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public static Selector open() \u200b\u6253\u5f00\u200b\u9009\u62e9\u5668\u200b public abstract void close() \u200b\u5173\u95ed\u200b\u6b64\u200b\u9009\u62e9\u5668\u200b public abstract int select() \u200b\u963b\u585e\u200b\u9009\u62e9\u200b\u4e00\u7ec4\u200b\u901a\u9053\u200b\u51c6\u5907\u200b\u597d\u200b\u8fdb\u884c\u200b I/O \u200b\u64cd\u4f5c\u200b\u7684\u200b\u952e\u200b public abstract int select(long timeout) \u200b\u963b\u585e\u200b\u7b49\u5f85\u200b timeout \u200b\u6beb\u79d2\u200b public abstract int selectNow() \u200b\u83b7\u53d6\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4e0d\u200b\u963b\u585e\u200b\uff0c\u200b\u7acb\u523b\u200b\u8fd4\u56de\u200b public abstract Selector wakeup() \u200b\u5524\u9192\u200b\u6b63\u5728\u200b\u963b\u585e\u200b\u7684\u200b selector public abstract Set selectedKeys() \u200b\u8fd4\u56de\u200b\u6b64\u200b\u9009\u62e9\u5668\u200b\u7684\u200b\u9009\u62e9\u952e\u200b\u96c6\u200b <p>SelectionKey API:</p> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public abstract void cancel() \u200b\u53d6\u6d88\u200b\u8be5\u952e\u200b\u7684\u200b\u901a\u9053\u200b\u4e0e\u5176\u200b\u9009\u62e9\u5668\u200b\u7684\u200b\u6ce8\u518c\u200b public abstract SelectableChannel channel() \u200b\u8fd4\u56de\u200b\u521b\u5efa\u200b\u6b64\u952e\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5728\u200b\u53d6\u6d88\u200b\u952e\u200b\u4e4b\u540e\u200b\u4ecd\u200b\u5c06\u200b\u8fd4\u56de\u200b\u901a\u9053\u200b public final Object attachment() \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b key \u200b\u5173\u8054\u200b\u7684\u200b\u9644\u4ef6\u200b public final boolean isAcceptable() \u200b\u68c0\u6d4b\u200b\u6b64\u200b\u5bc6\u94a5\u200b\u7684\u200b\u901a\u9053\u200b\u662f\u5426\u200b\u5df2\u200b\u51c6\u5907\u200b\u597d\u200b\u63a5\u53d7\u200b\u65b0\u200b\u7684\u200b\u5957\u200b\u63a5\u5b57\u200b\u8fde\u63a5\u200b public final boolean isConnectable() \u200b\u68c0\u6d4b\u200b\u6b64\u200b\u5bc6\u94a5\u200b\u7684\u200b\u901a\u9053\u200b\u662f\u5426\u200b\u5df2\u200b\u5b8c\u6210\u200b\u6216\u200b\u672a\u200b\u5b8c\u6210\u200b\u5176\u5957\u200b\u63a5\u5b57\u200b\u8fde\u63a5\u200b\u64cd\u4f5c\u200b public final boolean isReadable() \u200b\u68c0\u6d4b\u200b\u6b64\u200b\u5bc6\u94a5\u200b\u7684\u200b\u9891\u9053\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b public final boolean isWritable() \u200b\u68c0\u6d4b\u200b\u6b64\u200b\u5bc6\u94a5\u200b\u7684\u200b\u901a\u9053\u200b\u662f\u5426\u200b\u51c6\u5907\u200b\u597d\u200b\u8fdb\u884c\u200b\u5199\u5165\u200b <p>\u200b\u57fa\u672c\u200b\u6b65\u9aa4\u200b\uff1a</p> Java<pre><code>//1.\u200b\u83b7\u53d6\u200b\u901a\u9053\u200b\nServerSocketChannel ssChannel = ServerSocketChannel.open();\n//2.\u200b\u5207\u6362\u200b\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\nssChannel.configureBlocking(false);\n//3.\u200b\u7ed1\u5b9a\u200b\u8fde\u63a5\u200b\nssChannel.bin(new InetSocketAddress(9999));\n//4.\u200b\u83b7\u53d6\u200b\u9009\u62e9\u5668\u200b\nSelector selector = Selector.open();\n//5.\u200b\u5c06\u200b\u901a\u9053\u200b\u6ce8\u518c\u200b\u5230\u200b\u9009\u62e9\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6307\u5b9a\u200b\u201c\u200b\u76d1\u542c\u200b\u63a5\u6536\u200b\u4e8b\u4ef6\u200b\u201d\nssChannel.register(selector, SelectionKey.OP_ACCEPT);\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#nio_1","title":"NIO\u200b\u5b9e\u73b0","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#api_5","title":"\u5e38\u7528\u200bAPI","text":"<ul> <li>SelectableChannel_API</li> </ul> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public final SelectableChannel configureBlocking(boolean block) \u200b\u8bbe\u7f6e\u200b\u6b64\u200b\u901a\u9053\u200b\u7684\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b public final SelectionKey register(Selector sel, int ops) \u200b\u5411\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u9009\u62e9\u5668\u200b\u6ce8\u518c\u200b\u6b64\u200b\u901a\u9053\u200b\uff0c\u200b\u5e76\u200b\u9009\u62e9\u200b\u5173\u6ce8\u200b\u7684\u200b\u7684\u200b\u4e8b\u4ef6\u200b <ul> <li>SocketChannel_API\uff1a</li> </ul> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public static SocketChannel open() \u200b\u6253\u5f00\u200b\u5957\u200b\u63a5\u5b57\u200b\u901a\u9053\u200b public static SocketChannel open(SocketAddress remote) \u200b\u6253\u5f00\u200b\u5957\u200b\u63a5\u5b57\u200b\u901a\u9053\u200b\u5e76\u200b\u8fde\u63a5\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u5730\u5740\u200b public abstract boolean connect(SocketAddress remote) \u200b\u8fde\u63a5\u200b\u6b64\u200b\u901a\u9053\u200b\u7684\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u5730\u5740\u200b public abstract SocketChannel bind(SocketAddress local) \u200b\u5c06\u200b\u901a\u9053\u200b\u7684\u200b\u5957\u200b\u63a5\u5b57\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u672c\u5730\u200b\u5730\u5740\u200b public abstract SocketAddress getLocalAddress() \u200b\u8fd4\u56de\u200b\u5957\u200b\u63a5\u5b57\u200b\u7ed1\u5b9a\u200b\u7684\u200b\u672c\u5730\u200b\u5957\u200b\u63a5\u5b57\u200b\u5730\u5740\u200b public abstract SocketAddress getRemoteAddress() \u200b\u8fd4\u56de\u200b\u5957\u200b\u63a5\u5b57\u200b\u8fde\u63a5\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u5957\u200b\u63a5\u5b57\u200b\u5730\u5740\u200b <ul> <li>ServerSocketChannel_API\uff1a</li> </ul> \u200b\u65b9\u6cd5\u200b \u200b\u8bf4\u660e\u200b public static ServerSocketChannel open() \u200b\u6253\u5f00\u200b\u670d\u52a1\u5668\u200b\u5957\u200b\u63a5\u5b57\u200b\u901a\u9053\u200b public final ServerSocketChannel bind(SocketAddress local) \u200b\u5c06\u200b\u901a\u9053\u200b\u7684\u200b\u5957\u200b\u63a5\u5b57\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u672c\u5730\u200b\u5730\u5740\u200b\uff0c\u200b\u5e76\u200b\u914d\u7f6e\u200b\u5957\u200b\u63a5\u5b57\u200b\u4ee5\u200b\u76d1\u542c\u200b\u8fde\u63a5\u200b public abstract SocketChannel accept() \u200b\u63a5\u53d7\u200b\u4e0e\u200b\u6b64\u200b\u901a\u9053\u200b\u5957\u200b\u63a5\u5b57\u200b\u7684\u200b\u8fde\u63a5\u200b\uff0c\u200b\u901a\u8fc7\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u7684\u200b\u5957\u200b\u63a5\u5b57\u200b\u901a\u9053\u200b\u5c06\u200b\u5904\u4e8e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b <ul> <li>\u200b\u5982\u679c\u200b ServerSocketChannel \u200b\u5904\u4e8e\u200b\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6302\u200b\u8d77\u200b\u8fde\u63a5\u200b\uff0c\u200b\u5219\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b null</li> <li>\u200b\u5982\u679c\u200b\u901a\u9053\u200b\u5904\u4e8e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6302\u200b\u8d77\u200b\u8fde\u63a5\u200b\u5c06\u200b\u65e0\u9650\u671f\u200b\u5730\u200b\u963b\u585e\u200b\uff0c\u200b\u76f4\u5230\u200b\u6709\u200b\u65b0\u200b\u7684\u200b\u8fde\u63a5\u200b\u6216\u200b\u53d1\u751f\u200b I/O \u200b\u9519\u8bef\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#_253","title":"\u4ee3\u7801\u200b\u5b9e\u73b0","text":"<p>\u200b\u670d\u52a1\u7aef\u200b \uff1a</p> <ol> <li>\u200b\u83b7\u53d6\u200b\u901a\u9053\u200b\uff0c\u200b\u5f53\u200b\u5ba2\u6237\u7aef\u200b\u8fde\u63a5\u200b\u670d\u52a1\u7aef\u200b\u65f6\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u4f1a\u200b\u901a\u8fc7\u200b <code>ServerSocketChannel.accept</code> \u200b\u5f97\u5230\u200b SocketChannel </li> <li>\u200b\u5207\u6362\u200b\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b</li> <li>\u200b\u7ed1\u5b9a\u200b\u8fde\u63a5\u200b</li> <li>\u200b\u83b7\u53d6\u200b\u9009\u62e9\u5668\u200b</li> <li>\u200b\u5c06\u200b\u901a\u9053\u200b\u6ce8\u518c\u200b\u5230\u200b\u9009\u62e9\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6307\u5b9a\u200b\u76d1\u542c\u200b\u63a5\u6536\u200b\u4e8b\u4ef6\u200b</li> <li>\u200b\u8f6e\u8be2\u200b\u5f0f\u200b\u7684\u200b\u83b7\u53d6\u200b\u9009\u62e9\u5668\u200b\u4e0a\u200b\u5df2\u7ecf\u200b\u51c6\u5907\u5c31\u7eea\u200b\u7684\u200b\u4e8b\u4ef6\u200b</li> </ol> <p>\u200b\u5ba2\u6237\u7aef\u200b\uff1a</p> <ol> <li>\u200b\u83b7\u53d6\u200b\u901a\u9053\u200b\uff1a<code>SocketChannel sc = SocketChannel.open(new InetSocketAddress(HOST, PORT))</code></li> <li>\u200b\u5207\u6362\u200b\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b</li> <li>\u200b\u5206\u914d\u200b\u6307\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\uff1a<code>ByteBuffer buffer = ByteBuffer.allocate(1024)</code></li> <li>\u200b\u53d1\u9001\u6570\u636e\u200b\u7ed9\u200b\u670d\u52a1\u7aef\u200b</li> </ol> <p>37 \u200b\u884c\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5982\u679c\u200b\u5224\u65ad\u200b\u6761\u4ef6\u200b\u6539\u4e3a\u200b !=-1\uff0c\u200b\u9700\u8981\u200b\u5ba2\u6237\u7aef\u200b close \u200b\u4e00\u4e0b\u200b</p> Java<pre><code>public class Server {\n    public static void main(String[] args){\n        // 1\u3001\u200b\u83b7\u53d6\u200b\u901a\u9053\u200b\n        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\n        // 2\u3001\u200b\u5207\u6362\u200b\u4e3a\u200b\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\n        serverSocketChannel.configureBlocking(false);\n        // 3\u3001\u200b\u7ed1\u5b9a\u200b\u8fde\u63a5\u200b\u7684\u200b\u7aef\u53e3\u200b\n        serverSocketChannel.bind(new InetSocketAddress(9999));\n        // 4\u3001\u200b\u83b7\u53d6\u200b\u9009\u62e9\u5668\u200bSelector\n        Selector selector = Selector.open();\n        // 5\u3001\u200b\u5c06\u200b\u901a\u9053\u200b\u90fd\u200b\u6ce8\u518c\u200b\u5230\u200b\u9009\u62e9\u5668\u200b\u4e0a\u53bb\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f00\u59cb\u200b\u6307\u5b9a\u200b\u76d1\u542c\u200b\u63a5\u6536\u200b\u4e8b\u4ef6\u200b\n        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);\n        // 6\u3001\u200b\u4f7f\u7528\u200bSelector\u200b\u9009\u62e9\u5668\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u8f6e\u200b\u5df2\u7ecf\u200b\u5c31\u7eea\u200b\u597d\u200b\u7684\u200b\u4e8b\u4ef6\u200b\n        while (selector.select() &gt; 0) {\n            System.out.println(\"----\u200b\u5f00\u59cb\u200b\u65b0\u4e00\u8f6e\u200b\u7684\u200b\u65f6\u95f4\u200b\u5904\u7406\u200b----\");\n            // 7\u3001\u200b\u83b7\u53d6\u200b\u9009\u62e9\u5668\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u6ce8\u518c\u200b\u7684\u200b\u901a\u9053\u200b\u4e2d\u200b\u5df2\u7ecf\u200b\u5c31\u7eea\u200b\u597d\u200b\u7684\u200b\u4e8b\u4ef6\u200b\n            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();\n            Iterator&lt;SelectionKey&gt; it = selectionKeys.iterator();\n            // 8\u3001\u200b\u5f00\u59cb\u200b\u904d\u5386\u200b\u8fd9\u4e9b\u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u4e8b\u4ef6\u200b\n            while (it.hasNext()) {\n                SelectionKey key = it.next();// \u200b\u63d0\u53d6\u200b\u5f53\u524d\u200b\u8fd9\u4e2a\u200b\u4e8b\u4ef6\u200b\n                // 9\u3001\u200b\u5224\u65ad\u200b\u8fd9\u4e2a\u200b\u4e8b\u4ef6\u200b\u5177\u4f53\u200b\u662f\u200b\u4ec0\u4e48\u200b\n                if (key.isAcceptable()) {\n                    // 10\u3001\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u63a5\u5165\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u901a\u9053\u200b\n                    SocketChannel socketChannel = serverSocketChannel.accept();\n                    // 11 \u3001\u200b\u5207\u6362\u200b\u6210\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\n                    socketChannel.configureBlocking(false);\n                    /*\n                     ByteBuffer buffer = ByteBuffer.allocate(16);\n                     // \u200b\u5c06\u200b\u4e00\u4e2a\u200b byteBuffer \u200b\u4f5c\u4e3a\u200b\u9644\u4ef6\u200b\u3010\u200b\u5173\u8054\u200b\u3011\u200b\u5230\u200b selectionKey \u200b\u4e0a\u200b\n                     SelectionKey scKey = sc.register(selector, 0, buffer);\n                    */\n                    // 12\u3001\u200b\u5c06\u200b\u672c\u200b\u5ba2\u6237\u7aef\u200b\u901a\u9053\u200b\u6ce8\u518c\u200b\u5230\u200b\u9009\u62e9\u5668\u200b\n                    socketChannel.register(selector, SelectionKey.OP_READ);\n                } else if (key.isReadable()) {\n                    // 13\u3001\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u9009\u62e9\u5668\u200b\u4e0a\u200b\u7684\u200b\u8bfb\u200b\u5c31\u7eea\u200b\u4e8b\u4ef6\u200b\n                    SelectableChannel channel = key.channel();\n                    SocketChannel socketChannel = (SocketChannel) channel;\n                    // 14\u3001\u200b\u8bfb\u53d6\u6570\u636e\u200b\n                    ByteBuffer buffer = ByteBuffer.allocate(1024);\n                    // \u200b\u83b7\u53d6\u200b\u5173\u8054\u200b\u7684\u200b\u9644\u4ef6\u200b\n                    // ByteBuffer buffer = (ByteBuffer) key.attachment();\n                    int len;\n                    while ((len = socketChannel.read(buffer)) &gt; 0) {\n                        buffer.flip();\n                        System.out.println(socketChannel.getRemoteAddress() + \":\" + new String(buffer.array(), 0, len));\n                        buffer.clear();// \u200b\u6e05\u9664\u200b\u4e4b\u524d\u200b\u7684\u200b\u6570\u636e\u200b\n                    }\n                }\n                // \u200b\u5220\u9664\u200b\u5f53\u524d\u200b\u7684\u200b selectionKey\uff0c\u200b\u9632\u6b62\u200b\u91cd\u590d\u200b\u64cd\u4f5c\u200b\n                it.remove();\n            }\n        }\n    }\n}\n</code></pre> Java<pre><code>public class Client {\n    public static void main(String[] args) throws Exception {\n        // 1\u3001\u200b\u83b7\u53d6\u200b\u901a\u9053\u200b\n        SocketChannel socketChannel = SocketChannel.open(new InetSocketAddress(\"127.0.0.1\", 9999));\n        // 2\u3001\u200b\u5207\u6362\u200b\u6210\u975e\u200b\u963b\u585e\u200b\u6a21\u5f0f\u200b\n        socketChannel.configureBlocking(false);\n        // 3\u3001\u200b\u5206\u914d\u200b\u6307\u5b9a\u200b\u7f13\u51b2\u533a\u200b\u5927\u5c0f\u200b\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        // 4\u3001\u200b\u53d1\u9001\u6570\u636e\u200b\u7ed9\u200b\u670d\u52a1\u7aef\u200b\n        Scanner sc = new Scanner(System.in);\n        while (true){\n            System.out.print(\"\u200b\u8bf7\u200b\u8bf4\u200b\uff1a\");\n            String msg = sc.nextLine();\n            buffer.put((\"Client\uff1a\" + msg).getBytes());\n            buffer.flip();\n            socketChannel.write(buffer);\n            buffer.clear();\n        }\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/#aio","title":"AIO","text":"<p>Java AIO(NIO.2) \uff1a AsynchronousI/O\uff0c\u200b\u5f02\u6b65\u200b\u975e\u200b\u963b\u585e\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e86\u200b Proactor \u200b\u6a21\u5f0f\u200b\u3002\u200b\u670d\u52a1\u5668\u200b\u5b9e\u73b0\u200b\u6a21\u5f0f\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u6709\u6548\u200b\u8bf7\u6c42\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b I/O \u200b\u8bf7\u6c42\u200b\u90fd\u200b\u662f\u200b\u7531\u200b OS \u200b\u5148\u200b\u5b8c\u6210\u200b\u4e86\u200b\u518d\u200b\u901a\u77e5\u200b\u670d\u52a1\u5668\u200b\u5e94\u7528\u200b\u53bb\u200b\u542f\u52a8\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b</p> Java<pre><code>AIO\u200b\u5f02\u6b65\u200b\u975e\u200b\u963b\u585e\u200b\uff0c\u200b\u57fa\u4e8e\u200bNIO\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u79f0\u4e4b\u4e3a\u200bNIO2.0\n  BIO                     NIO                                AIO        \nSocket                SocketChannel                    AsynchronousSocketChannel\nServerSocket          ServerSocketChannel          AsynchronousServerSocketChannel\n</code></pre> <p>\u200b\u5f53\u200b\u8fdb\u884c\u200b\u8bfb\u5199\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u8c03\u7528\u200b API \u200b\u7684\u200b read \u200b\u6216\u200b write \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\u5747\u200b\u4e3a\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u5b8c\u6210\u200b\u540e\u200b\u4f1a\u200b\u4e3b\u52a8\u200b\u8c03\u7528\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\uff1a</p> <ul> <li>\u200b\u5bf9\u4e8e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5f53\u6709\u6d41\u200b\u53ef\u200b\u8bfb\u53d6\u200b\u65f6\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4f1a\u200b\u5c06\u200b\u53ef\u8bfb\u200b\u7684\u200b\u6d41\u4f20\u200b\u5165\u200b read \u200b\u65b9\u6cd5\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5f53\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5c06\u200b write \u200b\u65b9\u6cd5\u200b\u4f20\u9012\u200b\u7684\u200b\u6d41\u200b\u5199\u5165\u200b\u5b8c\u6bd5\u200b\u65f6\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e3b\u52a8\u200b\u901a\u77e5\u200b\u5e94\u7528\u7a0b\u5e8f\u200b</li> </ul> <p>\u200b\u5728\u200b JDK1.7 \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u90e8\u5206\u200b\u5185\u5bb9\u200b\u88ab\u79f0\u4f5c\u200b NIO.2\uff0c\u200b\u4e3b\u8981\u200b\u5728\u200b Java.nio.channels \u200b\u5305\u200b\u4e0b\u200b\u589e\u52a0\u200b\u4e86\u200b\u4e0b\u9762\u200b\u56db\u4e2a\u200b\u5f02\u6b65\u200b\u901a\u9053\u200b\uff1a AsynchronousSocketChannel\u3001AsynchronousServerSocketChannel\u3001AsynchronousFileChannel\u3001AsynchronousDatagramChannel</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/","title":"Java\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u53ca\u5176\u200b\u5728\u200b\u7f8e\u56e2\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u8df5","text":"<p> \u200b\u7ea6\u200b 8897 \u200b\u4e2a\u200b\u5b57\u200b  18 \u200b\u884c\u200b\u4ee3\u7801\u200b  30 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 30 \u200b\u5206\u949f\u200b</p> <p>Tip</p> <p>\u200b\u539f\u6587\u200b\u94fe\u63a5\u200b\uff1aJava\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u53ca\u5176\u200b\u5728\u200b\u7f8e\u56e2\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u8df5\u200b - \u200b\u7f8e\u56e2\u200b\u6280\u672f\u200b\u56e2\u961f\u200b</p> <p>\u200b\u968f\u7740\u200b\u8ba1\u7b97\u673a\u884c\u4e1a\u200b\u7684\u200b\u98de\u901f\u53d1\u5c55\u200b\uff0c\u200b\u6469\u5c14\u5b9a\u5f8b\u200b\u9010\u6e10\u200b\u5931\u6548\u200b\uff0c\u200b\u591a\u6838\u200bCPU\u200b\u6210\u4e3a\u200b\u4e3b\u6d41\u200b\u3002\u200b\u4f7f\u7528\u200b\u591a\u7ebf\u7a0b\u200b\u5e76\u884c\u8ba1\u7b97\u200b\u9010\u6e10\u200b\u6210\u4e3a\u200b\u5f00\u53d1\u4eba\u5458\u200b\u63d0\u5347\u200b\u670d\u52a1\u5668\u200b\u6027\u80fd\u200b\u7684\u200b\u57fa\u672c\u200b\u6b66\u5668\u200b\u3002J.U.C\u200b\u63d0\u4f9b\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff1aThreadPoolExecutor\u200b\u7c7b\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u5f00\u53d1\u4eba\u5458\u200b\u7ba1\u7406\u200b\u7ebf\u7a0b\u200b\u5e76\u200b\u65b9\u4fbf\u200b\u5730\u200b\u6267\u884c\u200b\u5e76\u884c\u4efb\u52a1\u200b\u3002\u200b\u4e86\u89e3\u200b\u5e76\u200b\u5408\u7406\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5f00\u53d1\u4eba\u5458\u200b\u5fc5\u4fee\u200b\u7684\u200b\u57fa\u672c\u529f\u200b\u3002</p> <p>\u200b\u672c\u6587\u200b\u5f00\u7bc7\u200b\u7b80\u8ff0\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6982\u5ff5\u200b\u548c\u200b\u7528\u9014\u200b\uff0c\u200b\u63a5\u7740\u200b\u7ed3\u5408\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u6e90\u7801\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u8bfb\u8005\u200b\u9886\u7565\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u601d\u8def\u200b\uff0c\u200b\u6700\u540e\u200b\u56de\u5f52\u200b\u5b9e\u8df5\u200b\uff0c\u200b\u901a\u8fc7\u200b\u6848\u4f8b\u200b\u8bb2\u8ff0\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u9047\u5230\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5e76\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4e00\u79cd\u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u89e3\u51b3\u65b9\u6848\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#_1","title":"\u4e00\u200b\u3001\u200b\u5199\u200b\u5728\u200b\u524d\u9762","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#11","title":"1.1 \u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b\u4ec0\u4e48","text":"<p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff08Thread Pool\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u57fa\u4e8e\u200b\u6c60\u5316\u200b\u601d\u60f3\u200b\u7ba1\u7406\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u7ecf\u5e38\u51fa\u73b0\u200b\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\uff0c\u200b\u5982\u200bMySQL\u3002</p> <p>\u200b\u7ebf\u7a0b\u200b\u8fc7\u591a\u4f1a\u200b\u5e26\u6765\u200b\u989d\u5916\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5305\u62ec\u200b\u521b\u5efa\u200b\u9500\u6bc1\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f00\u9500\u200b\u3001\u200b\u8c03\u5ea6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f00\u9500\u200b\u7b49\u7b49\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u964d\u4f4e\u200b\u4e86\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b\u6574\u4f53\u200b\u6027\u80fd\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7ef4\u62a4\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u7b49\u5f85\u200b\u76d1\u7763\u200b\u7ba1\u7406\u8005\u200b\u5206\u914d\u200b\u53ef\u200b\u5e76\u53d1\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\u200b\u8fd9\u79cd\u200b\u505a\u6cd5\u200b\uff0c\u200b\u4e00\u65b9\u9762\u200b\u907f\u514d\u200b\u4e86\u200b\u5904\u7406\u200b\u4efb\u52a1\u200b\u65f6\u200b\u521b\u5efa\u200b\u9500\u6bc1\u200b\u7ebf\u7a0b\u200b\u5f00\u9500\u200b\u7684\u200b\u4ee3\u4ef7\u200b\uff0c\u200b\u53e6\u4e00\u65b9\u9762\u200b\u907f\u514d\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u81a8\u80c0\u200b\u5bfc\u81f4\u200b\u7684\u200b\u8fc7\u5206\u200b\u8c03\u5ea6\u200b\u95ee\u9898\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5bf9\u200b\u5185\u6838\u200b\u7684\u200b\u5145\u5206\u5229\u7528\u200b\u3002</p> <p>\u200b\u800c\u200b\u672c\u6587\u200b\u63cf\u8ff0\u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200bJDK\u200b\u4e2d\u200b\u63d0\u4f9b\u200b\u7684\u200bThreadPoolExecutor\u200b\u7c7b\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53ef\u4ee5\u200b\u5e26\u6765\u200b\u4e00\u7cfb\u5217\u200b\u597d\u5904\u200b\uff1a</p> <ul> <li>\u200b\u964d\u4f4e\u200b\u8d44\u6e90\u200b\u6d88\u8017\u200b\uff1a\u200b\u901a\u8fc7\u200b\u6c60\u5316\u200b\u6280\u672f\u200b\u91cd\u590d\u200b\u5229\u7528\u200b\u5df2\u200b\u521b\u5efa\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u964d\u4f4e\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b\u548c\u200b\u9500\u6bc1\u200b\u9020\u6210\u200b\u7684\u200b\u635f\u8017\u200b\u3002</li> <li>\u200b\u63d0\u9ad8\u200b\u54cd\u5e94\u901f\u5ea6\u200b\uff1a\u200b\u4efb\u52a1\u200b\u5230\u8fbe\u200b\u65f6\u200b\uff0c\u200b\u65e0\u9700\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b\u5373\u53ef\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\u3002</li> <li>\u200b\u63d0\u9ad8\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53ef\u7ba1\u7406\u6027\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u7a00\u7f3a\u8d44\u6e90\u200b\uff0c\u200b\u5982\u679c\u200b\u65e0\u200b\u9650\u5236\u200b\u521b\u5efa\u200b\uff0c\u200b\u4e0d\u4ec5\u200b\u4f1a\u200b\u6d88\u8017\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u56e0\u4e3a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e0d\u5408\u7406\u200b\u5206\u5e03\u200b\u5bfc\u81f4\u200b\u8d44\u6e90\u200b\u8c03\u5ea6\u200b\u5931\u8861\u200b\uff0c\u200b\u964d\u4f4e\u200b\u7cfb\u7edf\u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\u3002\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u7edf\u4e00\u200b\u7684\u200b\u5206\u914d\u200b\u3001\u200b\u8c03\u4f18\u200b\u548c\u200b\u76d1\u63a7\u200b\u3002</li> <li>\u200b\u63d0\u4f9b\u200b\u66f4\u200b\u591a\u200b\u66f4\u200b\u5f3a\u5927\u200b\u7684\u200b\u529f\u80fd\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5177\u5907\u200b\u53ef\u200b\u62d3\u5c55\u200b\u6027\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5f00\u53d1\u4eba\u5458\u200b\u5411\u200b\u5176\u4e2d\u200b\u589e\u52a0\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u6bd4\u5982\u200b\u5ef6\u65f6\u200b\u5b9a\u65f6\u200b\u7ebf\u7a0b\u200b\u6c60\u200bScheduledThreadPoolExecutor\uff0c\u200b\u5c31\u200b\u5141\u8bb8\u200b\u4efb\u52a1\u200b\u5ef6\u671f\u200b\u6267\u884c\u200b\u6216\u200b\u5b9a\u671f\u200b\u6267\u884c\u200b\u3002</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#12","title":"1.2 \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u89e3\u51b3\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\u4ec0\u4e48","text":"<p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u89e3\u51b3\u200b\u7684\u200b\u6838\u5fc3\u200b\u95ee\u9898\u200b\u5c31\u662f\u200b\u8d44\u6e90\u7ba1\u7406\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200b\u5e76\u53d1\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u4e0d\u200b\u80fd\u591f\u200b\u786e\u5b9a\u200b\u5728\u200b\u4efb\u610f\u200b\u65f6\u523b\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u591a\u5c11\u200b\u4efb\u52a1\u200b\u9700\u8981\u200b\u6267\u884c\u200b\uff0c\u200b\u6709\u200b\u591a\u5c11\u200b\u8d44\u6e90\u200b\u9700\u8981\u200b\u6295\u5165\u200b\u3002\u200b\u8fd9\u79cd\u200b\u4e0d\u786e\u5b9a\u6027\u200b\u5c06\u200b\u5e26\u6765\u200b\u4ee5\u4e0b\u200b\u82e5\u5e72\u200b\u95ee\u9898\u200b\uff1a</p> <ol> <li>\u200b\u9891\u7e41\u200b\u7533\u8bf7\u200b/\u200b\u9500\u6bc1\u200b\u8d44\u6e90\u200b\u548c\u200b\u8c03\u5ea6\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5c06\u200b\u5e26\u6765\u200b\u989d\u5916\u200b\u7684\u200b\u6d88\u8017\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u975e\u5e38\u200b\u5de8\u5927\u200b\u3002</li> <li>\u200b\u5bf9\u200b\u8d44\u6e90\u200b\u65e0\u9650\u200b\u7533\u8bf7\u200b\u7f3a\u5c11\u200b\u6291\u5236\u200b\u624b\u6bb5\u200b\uff0c\u200b\u6613\u200b\u5f15\u53d1\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\u8017\u5c3d\u200b\u7684\u200b\u98ce\u9669\u200b\u3002</li> <li>\u200b\u7cfb\u7edf\u200b\u65e0\u6cd5\u200b\u5408\u7406\u200b\u7ba1\u7406\u200b\u5185\u90e8\u200b\u7684\u200b\u8d44\u6e90\u200b\u5206\u5e03\u200b\uff0c\u200b\u4f1a\u200b\u964d\u4f4e\u200b\u7cfb\u7edf\u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\u3002</li> </ol> <p>\u200b\u4e3a\u200b\u89e3\u51b3\u200b\u8d44\u6e90\u5206\u914d\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u91c7\u7528\u200b\u4e86\u200b\u201c\u200b\u6c60\u5316\u200b\u201d\uff08Pooling\uff09\u200b\u601d\u60f3\u200b\u3002\u200b\u6c60\u5316\u200b\uff0c\u200b\u987e\u540d\u601d\u4e49\u200b\uff0c\u200b\u662f\u200b\u4e3a\u4e86\u200b\u6700\u5927\u5316\u200b\u6536\u76ca\u200b\u5e76\u200b\u6700\u5c0f\u5316\u200b\u98ce\u9669\u200b\uff0c\u200b\u800c\u200b\u5c06\u200b\u8d44\u6e90\u200b\u7edf\u4e00\u200b\u5728\u200b\u4e00\u8d77\u200b\u7ba1\u7406\u200b\u7684\u200b\u4e00\u79cd\u200b\u601d\u60f3\u200b\u3002</p> <p>Pooling is the grouping together of resources (assets, equipment, personnel, effort, etc.) for the purposes of maximizing advantage or minimizing risk to the users. The term is used in finance, computing and equipment management.\u2014\u2014wikipedia</p> <p>\u201c\u200b\u6c60\u5316\u200b\u201d\u200b\u601d\u60f3\u200b\u4e0d\u4ec5\u4ec5\u200b\u80fd\u200b\u5e94\u7528\u200b\u5728\u200b\u8ba1\u7b97\u673a\u9886\u57df\u200b\uff0c\u200b\u5728\u200b\u91d1\u878d\u200b\u3001\u200b\u8bbe\u5907\u200b\u3001\u200b\u4eba\u5458\u200b\u7ba1\u7406\u200b\u3001\u200b\u5de5\u4f5c\u200b\u7ba1\u7406\u200b\u7b49\u200b\u9886\u57df\u200b\u4e5f\u200b\u6709\u200b\u76f8\u5173\u200b\u7684\u200b\u5e94\u7528\u200b\u3002</p> <p>\u200b\u5728\u200b\u8ba1\u7b97\u673a\u9886\u57df\u200b\u4e2d\u200b\u7684\u200b\u8868\u73b0\u200b\u4e3a\u200b\uff1a\u200b\u7edf\u4e00\u200b\u7ba1\u7406\u200bIT\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5305\u62ec\u200b\u670d\u52a1\u5668\u200b\u3001\u200b\u5b58\u50a8\u200b\u3001\u200b\u548c\u200b\u7f51\u7edc\u8d44\u6e90\u200b\u7b49\u7b49\u200b\u3002\u200b\u901a\u8fc7\u200b\u5171\u4eab\u8d44\u6e90\u200b\uff0c\u200b\u4f7f\u200b\u7528\u6237\u200b\u5728\u200b\u4f4e\u200b\u6295\u5165\u200b\u4e2d\u200b\u83b7\u76ca\u200b\u3002\u200b\u9664\u53bb\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u8fd8\u6709\u200b\u5176\u4ed6\u200b\u6bd4\u8f83\u200b\u5178\u578b\u200b\u7684\u200b\u51e0\u79cd\u200b\u4f7f\u7528\u200b\u7b56\u7565\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>\u200b\u5185\u5b58\u200b\u6c60\u200b(Memory Pooling)\uff1a\u200b\u9884\u5148\u200b\u7533\u8bf7\u200b\u5185\u5b58\u200b\uff0c\u200b\u63d0\u5347\u200b\u7533\u8bf7\u200b\u5185\u5b58\u200b\u901f\u5ea6\u200b\uff0c\u200b\u51cf\u5c11\u200b\u5185\u5b58\u200b\u788e\u7247\u200b\u3002</li> <li>\u200b\u8fde\u63a5\u6c60\u200b(Connection Pooling)\uff1a\u200b\u9884\u5148\u200b\u7533\u8bf7\u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b\uff0c\u200b\u63d0\u5347\u200b\u7533\u8bf7\u200b\u8fde\u63a5\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u964d\u4f4e\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5f00\u9500\u200b\u3002</li> <li>\u200b\u5b9e\u4f8b\u200b\u6c60\u200b(Object Pooling)\uff1a\u200b\u5faa\u73af\u200b\u4f7f\u7528\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u51cf\u5c11\u200b\u8d44\u6e90\u200b\u5728\u200b\u521d\u59cb\u5316\u200b\u548c\u200b\u91ca\u653e\u200b\u65f6\u200b\u7684\u200b\u6602\u8d35\u200b\u635f\u8017\u200b\u3002</li> </ol> <p>\u200b\u5728\u200b\u4e86\u89e3\u200b\u5b8c\u200b\u201c\u200b\u662f\u200b\u4ec0\u4e48\u200b\u201d\u200b\u548c\u200b\u201c\u200b\u4e3a\u4ec0\u4e48\u200b\u201d\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u6765\u200b\u4e00\u8d77\u200b\u6df1\u5165\u200b\u4e00\u4e0b\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#_2","title":"\u4e8c\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6838\u5fc3\u200b\u8bbe\u8ba1\u200b\u4e0e\u200b\u5b9e\u73b0","text":"<p>\u200b\u5728\u200b\u524d\u200b\u6587\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e86\u89e3\u200b\u5230\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b\u4e00\u79cd\u200b\u901a\u8fc7\u200b\u201c\u200b\u6c60\u5316\u200b\u201d\u200b\u601d\u60f3\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u6211\u4eec\u200b\u7ba1\u7406\u200b\u7ebf\u7a0b\u200b\u800c\u200b\u83b7\u53d6\u200b\u5e76\u53d1\u200b\u6027\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u5728\u200bJava\u200b\u4e2d\u200b\u7684\u200b\u4f53\u73b0\u200b\u662f\u200bThreadPoolExecutor\u200b\u7c7b\u200b\u3002\u200b\u90a3\u4e48\u200b\u5b83\u200b\u7684\u200b\u7684\u200b\u8be6\u7ec6\u200b\u8bbe\u8ba1\u200b\u4e0e\u200b\u5b9e\u73b0\u200b\u662f\u200b\u4ec0\u4e48\u6837\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u6211\u4eec\u200b\u4f1a\u200b\u5728\u200b\u672c\u7ae0\u200b\u8fdb\u884c\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#21","title":"2.1 \u200b\u603b\u4f53\u8bbe\u8ba1","text":"<p>Java\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6838\u5fc3\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u662f\u200bThreadPoolExecutor\uff0c\u200b\u672c\u7ae0\u200b\u57fa\u4e8e\u200bJDK 1.8\u200b\u7684\u200b\u6e90\u7801\u200b\u6765\u200b\u5206\u6790\u200bJava\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u6838\u5fc3\u200b\u8bbe\u8ba1\u200b\u4e0e\u200b\u5b9e\u73b0\u200b\u3002\u200b\u6211\u4eec\u200b\u9996\u5148\u200b\u6765\u770b\u200b\u4e00\u4e0b\u200bThreadPoolExecutor\u200b\u7684\u200bUML\u200b\u7c7b\u56fe\u200b\uff0c\u200b\u4e86\u89e3\u200b\u4e0b\u200bThreadPoolExecutor\u200b\u7684\u200b\u7ee7\u627f\u200b\u5173\u7cfb\u200b\u3002</p> <p></p> <p>\u200b\u56fe\u200b1 ThreadPoolExecutor UML\u200b\u7c7b\u56fe\u200b</p> <p>ThreadPoolExecutor\u200b\u5b9e\u73b0\u200b\u7684\u200b\u9876\u5c42\u200b\u63a5\u53e3\u200b\u662f\u200bExecutor\uff0c\u200b\u9876\u5c42\u200b\u63a5\u53e3\u200bExecutor\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u79cd\u200b\u601d\u60f3\u200b\uff1a\u200b\u5c06\u200b\u4efb\u52a1\u200b\u63d0\u4ea4\u200b\u548c\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u8fdb\u884c\u200b\u89e3\u200b\u8026\u200b\u3002\u200b\u7528\u6237\u200b\u65e0\u9700\u200b\u5173\u6ce8\u200b\u5982\u4f55\u200b\u521b\u5efa\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5982\u4f55\u200b\u8c03\u5ea6\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7528\u6237\u200b\u53ea\u200b\u9700\u200b\u63d0\u4f9b\u200bRunnable\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5c06\u200b\u4efb\u52a1\u200b\u7684\u200b\u8fd0\u884c\u200b\u903b\u8f91\u200b\u63d0\u4ea4\u200b\u5230\u200b\u6267\u884c\u5668\u200b(Executor)\u200b\u4e2d\u200b\uff0c\u200b\u7531\u200bExecutor\u200b\u6846\u67b6\u200b\u5b8c\u6210\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8c03\u914d\u200b\u548c\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\u90e8\u5206\u200b\u3002ExecutorService\u200b\u63a5\u53e3\u200b\u589e\u52a0\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u80fd\u529b\u200b\uff1a\uff081\uff09\u200b\u6269\u5145\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u8865\u5145\u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u6216\u200b\u4e00\u6279\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u751f\u6210\u200bFuture\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1b\uff082\uff09\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u7ba1\u63a7\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6bd4\u5982\u200b\u505c\u6b62\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\u3002AbstractExecutorService\u200b\u5219\u200b\u662f\u200b\u4e0a\u5c42\u200b\u7684\u200b\u62bd\u8c61\u7c7b\u200b\uff0c\u200b\u5c06\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u6d41\u7a0b\u200b\u4e32\u8054\u200b\u4e86\u200b\u8d77\u6765\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e0b\u5c42\u200b\u7684\u200b\u5b9e\u73b0\u200b\u53ea\u200b\u9700\u200b\u5173\u6ce8\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5373\u53ef\u200b\u3002\u200b\u6700\u200b\u4e0b\u5c42\u200b\u7684\u200b\u5b9e\u73b0\u200b\u7c7b\u200bThreadPoolExecutor\u200b\u5b9e\u73b0\u200b\u6700\u200b\u590d\u6742\u200b\u7684\u200b\u8fd0\u884c\u200b\u90e8\u5206\u200b\uff0cThreadPoolExecutor\u200b\u5c06\u4f1a\u200b\u4e00\u65b9\u9762\u200b\u7ef4\u62a4\u200b\u81ea\u8eab\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\uff0c\u200b\u53e6\u4e00\u65b9\u9762\u200b\u540c\u65f6\u200b\u7ba1\u7406\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f7f\u200b\u4e24\u8005\u200b\u826f\u597d\u200b\u7684\u200b\u7ed3\u5408\u200b\u4ece\u800c\u200b\u6267\u884c\u200b\u5e76\u884c\u4efb\u52a1\u200b\u3002</p> <p>ThreadPoolExecutor\u200b\u662f\u200b\u5982\u4f55\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5982\u4f55\u200b\u540c\u65f6\u200b\u7ef4\u62a4\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u5176\u200b\u8fd0\u884c\u673a\u5236\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b2 ThreadPoolExecutor\u200b\u8fd0\u884c\u200b\u6d41\u7a0b\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u5728\u200b\u5185\u90e8\u200b\u5b9e\u9645\u4e0a\u200b\u6784\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u751f\u4ea7\u8005\u200b\u6d88\u8d39\u8005\u200b\u6a21\u578b\u200b\uff0c\u200b\u5c06\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u4efb\u52a1\u200b\u4e24\u8005\u200b\u89e3\u200b\u8026\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u76f4\u63a5\u200b\u5173\u8054\u200b\uff0c\u200b\u4ece\u800c\u200b\u826f\u597d\u200b\u7684\u200b\u7f13\u51b2\u200b\u4efb\u52a1\u200b\uff0c\u200b\u590d\u7528\u200b\u7ebf\u7a0b\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\u4e3b\u8981\u200b\u5206\u6210\u200b\u4e24\u200b\u90e8\u5206\u200b\uff1a\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u7ba1\u7406\u200b\u3002\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u200b\u90e8\u5206\u200b\u5145\u5f53\u200b\u751f\u4ea7\u8005\u200b\u7684\u200b\u89d2\u8272\u200b\uff0c\u200b\u5f53\u200b\u4efb\u52a1\u200b\u63d0\u4ea4\u200b\u540e\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u4f1a\u200b\u5224\u65ad\u200b\u8be5\u200b\u4efb\u52a1\u200b\u540e\u7eed\u200b\u7684\u200b\u6d41\u8f6c\u200b\uff1a\uff081\uff09\u200b\u76f4\u63a5\u200b\u7533\u8bf7\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u8be5\u200b\u4efb\u52a1\u200b\uff1b\uff082\uff09\u200b\u7f13\u51b2\u200b\u5230\u200b\u961f\u5217\u200b\u4e2d\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\uff1b\uff083\uff09\u200b\u62d2\u7edd\u200b\u8be5\u200b\u4efb\u52a1\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u7ba1\u7406\u200b\u90e8\u5206\u200b\u662f\u200b\u6d88\u8d39\u8005\u200b\uff0c\u200b\u5b83\u4eec\u200b\u88ab\u200b\u7edf\u4e00\u200b\u7ef4\u62a4\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u6c60\u5185\u200b\uff0c\u200b\u6839\u636e\u200b\u4efb\u52a1\u200b\u8bf7\u6c42\u200b\u8fdb\u884c\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u5b8c\u200b\u4efb\u52a1\u200b\u540e\u200b\u5219\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u83b7\u53d6\u200b\u65b0\u200b\u7684\u200b\u4efb\u52a1\u200b\u53bb\u200b\u6267\u884c\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u4efb\u52a1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u6309\u7167\u200b\u4ee5\u4e0b\u200b\u4e09\u4e2a\u200b\u90e8\u5206\u200b\u53bb\u200b\u8be6\u7ec6\u200b\u8bb2\u89e3\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u673a\u5236\u200b\uff1a</p> <ol> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5982\u4f55\u200b\u7ef4\u62a4\u200b\u81ea\u8eab\u200b\u72b6\u6001\u200b\u3002</li> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5982\u4f55\u200b\u7ba1\u7406\u200b\u4efb\u52a1\u200b\u3002</li> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5982\u4f55\u200b\u7ba1\u7406\u200b\u7ebf\u7a0b\u200b\u3002</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#22","title":"2.2 \u200b\u751f\u547d\u5468\u671f\u200b\u7ba1\u7406","text":"<p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u7528\u6237\u200b\u663e\u5f0f\u200b\u8bbe\u7f6e\u200b\u7684\u200b\uff0c\u200b\u800c\u662f\u200b\u4f34\u968f\u200b\u7740\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\uff0c\u200b\u7531\u200b\u5185\u90e8\u200b\u6765\u200b\u7ef4\u62a4\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5185\u90e8\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u7ef4\u62a4\u200b\u4e24\u4e2a\u200b\u503c\u200b\uff1a\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b(runState)\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b (workerCount)\u3002\u200b\u5728\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u4e2d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u5c06\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b(runState)\u3001\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b (workerCount)\u200b\u4e24\u4e2a\u200b\u5173\u952e\u200b\u53c2\u6570\u200b\u7684\u200b\u7ef4\u62a4\u200b\u653e\u5728\u200b\u4e86\u200b\u4e00\u8d77\u200b\uff0c\u200b\u5982\u4e0b\u200b\u4ee3\u7801\u200b\u6240\u793a\u200b\uff1a</p> Java<pre><code>private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\n</code></pre> <p><code>ctl</code>\u200b\u8fd9\u4e2a\u200bAtomicInteger\u200b\u7c7b\u578b\u200b\uff0c\u200b\u662f\u200b\u5bf9\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u6709\u6548\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6570\u91cf\u200b\u8fdb\u884c\u200b\u63a7\u5236\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\uff0c \u200b\u5b83\u200b\u540c\u65f6\u200b\u5305\u542b\u200b\u4e24\u200b\u90e8\u5206\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b (runState) \u200b\u548c\u200b\u7ebf\u7a0b\u200b\u6c60\u5185\u200b\u6709\u6548\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6570\u91cf\u200b (workerCount)\uff0c\u200b\u9ad8\u200b3\u200b\u4f4d\u200b\u4fdd\u5b58\u200brunState\uff0c\u200b\u4f4e\u200b29\u200b\u4f4d\u200b\u4fdd\u5b58\u200bworkerCount\uff0c\u200b\u4e24\u4e2a\u200b\u53d8\u91cf\u200b\u4e4b\u95f4\u200b\u4e92\u4e0d\u200b\u5e72\u6270\u200b\u3002\u200b\u7528\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u53bb\u200b\u5b58\u50a8\u200b\u4e24\u4e2a\u200b\u503c\u200b\uff0c\u200b\u53ef\u200b\u907f\u514d\u200b\u5728\u200b\u505a\u200b\u76f8\u5173\u200b\u51b3\u7b56\u200b\u65f6\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e0d\u5fc5\u200b\u4e3a\u4e86\u200b\u7ef4\u62a4\u200b\u4e24\u8005\u200b\u7684\u200b\u4e00\u81f4\u200b\uff0c\u200b\u800c\u200b\u5360\u7528\u200b\u9501\u200b\u8d44\u6e90\u200b\u3002\u200b\u901a\u8fc7\u200b\u9605\u8bfb\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6e90\u4ee3\u7801\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u7ecf\u5e38\u51fa\u73b0\u200b\u8981\u200b\u540c\u65f6\u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u82e5\u5e72\u200b\u65b9\u6cd5\u200b\u53bb\u200b\u4f9b\u200b\u7528\u6237\u200b\u83b7\u5f97\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5f53\u524d\u200b\u7684\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u4e2a\u6570\u200b\u3002\u200b\u8fd9\u91cc\u200b\u90fd\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u57fa\u672c\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u901f\u5ea6\u200b\u4e5f\u200b\u4f1a\u200b\u5feb\u200b\u5f88\u591a\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b\u5185\u90e8\u200b\u5c01\u88c5\u200b\u7684\u200b\u83b7\u53d6\u200b\u751f\u547d\u5468\u671f\u200b\u72b6\u6001\u200b\u3001\u200b\u83b7\u53d6\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\u7684\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u5982\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u6240\u793a\u200b\uff1a</p> Java<pre><code>private static int runStateOf(int c)     { return c &amp; ~CAPACITY; } //\u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\nprivate static int workerCountOf(int c)  { return c &amp; CAPACITY; }  //\u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6570\u91cf\u200b\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }   //\u200b\u901a\u8fc7\u200b\u72b6\u6001\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u751f\u6210\u200bctl\n</code></pre> <p>ThreadPoolExecutor\u200b\u7684\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u6709\u200b5\u200b\u79cd\u200b\uff0c\u200b\u5206\u522b\u200b\u4e3a\u200b\uff1a</p> <p></p> <p>\u200b\u5176\u200b\u751f\u547d\u5468\u671f\u200b\u8f6c\u6362\u200b\u5982\u4e0b\u200b\u5165\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b3 \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u751f\u547d\u5468\u671f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#23","title":"2.3 \u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u673a\u5236","text":"<p>2.3.1 \u200b\u4efb\u52a1\u8c03\u5ea6\u200b</p> <p>\u200b\u4efb\u52a1\u8c03\u5ea6\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u4e3b\u8981\u200b\u5165\u53e3\u200b\uff0c\u200b\u5f53\u200b\u7528\u6237\u200b\u63d0\u4ea4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\u5c06\u200b\u5982\u4f55\u200b\u6267\u884c\u200b\u90fd\u200b\u662f\u200b\u7531\u200b\u8fd9\u4e2a\u200b\u9636\u6bb5\u200b\u51b3\u5b9a\u200b\u7684\u200b\u3002\u200b\u4e86\u89e3\u200b\u8fd9\u90e8\u5206\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u4e86\u89e3\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u6838\u5fc3\u200b\u8fd0\u884c\u673a\u5236\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u7684\u200b\u8c03\u5ea6\u200b\u90fd\u200b\u662f\u200b\u7531\u200bexecute\u200b\u65b9\u6cd5\u200b\u5b8c\u6210\u200b\u7684\u200b\uff0c\u200b\u8fd9\u90e8\u5206\u200b\u5b8c\u6210\u200b\u7684\u200b\u5de5\u4f5c\u200b\u662f\u200b\uff1a\u200b\u68c0\u67e5\u200b\u73b0\u5728\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u3001\u200b\u8fd0\u884c\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u3001\u200b\u8fd0\u884c\u200b\u7b56\u7565\u200b\uff0c\u200b\u51b3\u5b9a\u200b\u63a5\u4e0b\u6765\u200b\u6267\u884c\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u662f\u200b\u76f4\u63a5\u200b\u7533\u8bf7\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\uff0c\u200b\u6216\u662f\u200b\u7f13\u51b2\u200b\u5230\u200b\u961f\u5217\u200b\u4e2d\u200b\u6267\u884c\u200b\uff0c\u200b\u4ea6\u200b\u6216\u662f\u200b\u76f4\u63a5\u200b\u62d2\u7edd\u200b\u8be5\u200b\u4efb\u52a1\u200b\u3002\u200b\u5176\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u68c0\u6d4b\u7ebf\u200b\u7a0b\u6c60\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u662f\u200bRUNNING\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u62d2\u7edd\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u8981\u200b\u4fdd\u8bc1\u200b\u5728\u200bRUNNING\u200b\u7684\u200b\u72b6\u6001\u200b\u4e0b\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u3002</li> <li>\u200b\u5982\u679c\u200bworkerCount &lt; corePoolSize\uff0c\u200b\u5219\u200b\u521b\u5efa\u200b\u5e76\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u6267\u884c\u200b\u65b0\u200b\u63d0\u4ea4\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002</li> <li>\u200b\u5982\u679c\u200bworkerCount &gt;= corePoolSize\uff0c\u200b\u4e14\u200b\u7ebf\u7a0b\u200b\u6c60\u5185\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u672a\u6ee1\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u4efb\u52a1\u200b\u6dfb\u52a0\u200b\u5230\u200b\u8be5\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u3002</li> <li>\u200b\u5982\u679c\u200bworkerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSize\uff0c\u200b\u4e14\u200b\u7ebf\u7a0b\u200b\u6c60\u5185\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5df2\u6ee1\u200b\uff0c\u200b\u5219\u200b\u521b\u5efa\u200b\u5e76\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u6267\u884c\u200b\u65b0\u200b\u63d0\u4ea4\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002</li> <li>\u200b\u5982\u679c\u200bworkerCount &gt;= maximumPoolSize\uff0c\u200b\u5e76\u4e14\u200b\u7ebf\u7a0b\u200b\u6c60\u5185\u200b\u7684\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5df2\u6ee1\u200b, \u200b\u5219\u200b\u6839\u636e\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\u6765\u200b\u5904\u7406\u200b\u8be5\u200b\u4efb\u52a1\u200b, \u200b\u9ed8\u8ba4\u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\u662f\u200b\u76f4\u63a5\u200b\u629b\u200b\u5f02\u5e38\u200b\u3002</li> </ol> <p>\u200b\u5176\u200b\u6267\u884c\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b4 \u200b\u4efb\u52a1\u8c03\u5ea6\u200b\u6d41\u7a0b\u200b</p> <p>2.3.2 \u200b\u4efb\u52a1\u200b\u7f13\u51b2\u200b</p> <p>\u200b\u4efb\u52a1\u200b\u7f13\u51b2\u200b\u6a21\u5757\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u80fd\u591f\u200b\u7ba1\u7406\u200b\u4efb\u52a1\u200b\u7684\u200b\u6838\u5fc3\u200b\u90e8\u5206\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u672c\u8d28\u200b\u662f\u200b\u5bf9\u200b\u4efb\u52a1\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7ba1\u7406\u200b\uff0c\u200b\u800c\u200b\u505a\u5230\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u6700\u200b\u5173\u952e\u200b\u7684\u200b\u601d\u60f3\u200b\u5c31\u662f\u200b\u5c06\u200b\u4efb\u52a1\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u4e24\u8005\u200b\u89e3\u200b\u8026\u200b\uff0c\u200b\u4e0d\u8ba9\u200b\u4e24\u8005\u200b\u76f4\u63a5\u200b\u5173\u8054\u200b\uff0c\u200b\u624d\u200b\u53ef\u4ee5\u200b\u505a\u200b\u540e\u7eed\u200b\u7684\u200b\u5206\u914d\u200b\u5de5\u4f5c\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u662f\u200b\u4ee5\u200b\u751f\u4ea7\u8005\u200b\u6d88\u8d39\u8005\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e00\u4e2a\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7f13\u5b58\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\u4ece\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u3002</p> <p>\u200b\u963b\u585e\u200b\u961f\u5217\u200b(BlockingQueue)\u200b\u662f\u200b\u4e00\u4e2a\u200b\u652f\u6301\u200b\u4e24\u4e2a\u200b\u9644\u52a0\u200b\u64cd\u4f5c\u200b\u7684\u200b\u961f\u5217\u200b\u3002\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u9644\u52a0\u200b\u7684\u200b\u64cd\u4f5c\u200b\u662f\u200b\uff1a\u200b\u5728\u200b\u961f\u200b\u5217\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u83b7\u53d6\u200b\u5143\u7d20\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u53d8\u4e3a\u200b\u975e\u7a7a\u200b\u3002\u200b\u5f53\u200b\u961f\u5217\u200b\u6ee1\u65f6\u200b\uff0c\u200b\u5b58\u50a8\u200b\u5143\u7d20\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u53ef\u7528\u200b\u3002\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5e38\u7528\u200b\u4e8e\u200b\u751f\u4ea7\u8005\u200b\u548c\u200b\u6d88\u8d39\u8005\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u751f\u4ea7\u8005\u200b\u662f\u200b\u5f80\u200b\u961f\u5217\u200b\u91cc\u200b\u6dfb\u52a0\u200b\u5143\u7d20\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u662f\u4ece\u200b\u961f\u5217\u200b\u91cc\u200b\u62ff\u200b\u5143\u7d20\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u3002\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u5c31\u662f\u200b\u751f\u4ea7\u8005\u200b\u5b58\u653e\u200b\u5143\u7d20\u200b\u7684\u200b\u5bb9\u5668\u200b\uff0c\u200b\u800c\u200b\u6d88\u8d39\u8005\u200b\u4e5f\u200b\u53ea\u200b\u4ece\u200b\u5bb9\u5668\u200b\u91cc\u200b\u62ff\u200b\u5143\u7d20\u200b\u3002</p> <p>\u200b\u4e0b\u56fe\u200b\u4e2d\u200b\u5c55\u793a\u200b\u4e86\u200b\u7ebf\u7a0b\u200b1\u200b\u5f80\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u5143\u7d20\u200b\uff0c\u200b\u800c\u200b\u7ebf\u7a0b\u200b2\u200b\u4ece\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u79fb\u9664\u200b\u5143\u7d20\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b5 \u200b\u963b\u585e\u200b\u961f\u5217\u200b</p> <p>\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u961f\u5217\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b58\u53d6\u200b\u7b56\u7565\u200b\u3002\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u518d\u200b\u4ecb\u7ecd\u200b\u4e0b\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u7684\u200b\u6210\u5458\u200b\uff1a</p> <p></p> <p>2.3.3 \u200b\u4efb\u52a1\u200b\u7533\u8bf7\u200b</p> <p>\u200b\u7531\u200b\u4e0a\u6587\u200b\u7684\u200b\u4efb\u52a1\u5206\u914d\u200b\u90e8\u5206\u200b\u53ef\u77e5\u200b\uff0c\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\u6709\u200b\u4e24\u79cd\u200b\u53ef\u80fd\u200b\uff1a\u200b\u4e00\u79cd\u200b\u662f\u200b\u4efb\u52a1\u200b\u76f4\u63a5\u200b\u7531\u200b\u65b0\u521b\u5efa\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u3002\u200b\u53e6\u200b\u4e00\u79cd\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u4ece\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u7136\u540e\u200b\u6267\u884c\u200b\uff0c\u200b\u6267\u884c\u200b\u5b8c\u200b\u4efb\u52a1\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u518d\u6b21\u200b\u53bb\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u7533\u8bf7\u200b\u4efb\u52a1\u200b\u518d\u200b\u53bb\u200b\u6267\u884c\u200b\u3002\u200b\u7b2c\u4e00\u79cd\u200b\u60c5\u51b5\u200b\u4ec5\u200b\u51fa\u73b0\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u521d\u59cb\u200b\u521b\u5efa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7b2c\u4e8c\u79cd\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u7edd\u5927\u591a\u6570\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u4ece\u200b\u4efb\u52a1\u200b\u7f13\u5b58\u200b\u6a21\u5757\u200b\u4e2d\u200b\u4e0d\u65ad\u200b\u5730\u53d6\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u7ebf\u7a0b\u200b\u4ece\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u7ba1\u7406\u200b\u6a21\u5757\u200b\u548c\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u200b\u6a21\u5757\u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\u3002\u200b\u8fd9\u90e8\u5206\u200b\u7b56\u7565\u200b\u7531\u200bgetTask\u200b\u65b9\u6cd5\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5176\u200b\u6267\u884c\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b6 \u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u6d41\u7a0b\u56fe\u200b</p> <p>getTask\u200b\u8fd9\u90e8\u5206\u200b\u8fdb\u884c\u200b\u4e86\u200b\u591a\u6b21\u200b\u5224\u65ad\u200b\uff0c\u200b\u4e3a\u7684\u662f\u200b\u63a7\u5236\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u4f7f\u200b\u5176\u200b\u7b26\u5408\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u73b0\u5728\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u6301\u6709\u200b\u90a3\u4e48\u200b\u591a\u7ebf\u7a0b\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u8fd4\u56de\u200bnull\u200b\u503c\u200b\u3002\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200bWorker\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u63a5\u6536\u200b\u65b0\u200b\u4efb\u52a1\u200b\u53bb\u200b\u6267\u884c\u200b\uff0c\u200b\u800c\u200b\u5f53\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200bWorker\u200b\u63a5\u6536\u200b\u4e0d\u5230\u200b\u4efb\u52a1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5f00\u59cb\u200b\u88ab\u200b\u56de\u6536\u200b\u3002</p> <p>2.3.4 \u200b\u4efb\u52a1\u200b\u62d2\u7edd\u200b</p> <p>\u200b\u4efb\u52a1\u200b\u62d2\u7edd\u200b\u6a21\u5757\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u4fdd\u62a4\u200b\u90e8\u5206\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u6709\u200b\u4e00\u4e2a\u200b\u6700\u5927\u200b\u7684\u200b\u5bb9\u91cf\u200b\uff0c\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u4efb\u52a1\u200b\u7f13\u5b58\u200b\u961f\u5217\u200b\u5df2\u6ee1\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u76ee\u200b\u8fbe\u5230\u200bmaximumPoolSize\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u62d2\u7edd\u200b\u6389\u200b\u8be5\u200b\u4efb\u52a1\u200b\uff0c\u200b\u91c7\u53d6\u200b\u4efb\u52a1\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\uff0c\u200b\u4fdd\u62a4\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u3002</p> <p>\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\u662f\u200b\u4e00\u4e2a\u200b\u63a5\u53e3\u200b\uff0c\u200b\u5176\u200b\u8bbe\u8ba1\u200b\u5982\u4e0b\u200b\uff1a</p> Java<pre><code>public interface RejectedExecutionHandler {\n    void rejectedExecution(Runnable r, ThreadPoolExecutor executor);\n}\n</code></pre> <p>\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u53bb\u200b\u5b9a\u5236\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200bJDK\u200b\u63d0\u4f9b\u200b\u7684\u200b\u56db\u79cd\u200b\u5df2\u6709\u200b\u62d2\u7edd\u200b\u7b56\u7565\u200b\uff0c\u200b\u5176\u200b\u7279\u70b9\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>2.4 Worker\u200b\u7ebf\u7a0b\u200b\u7ba1\u7406\u200b</p> <p>2.4.1 Worker\u200b\u7ebf\u7a0b\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e3a\u4e86\u200b\u638c\u63e1\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u72b6\u6001\u200b\u5e76\u200b\u7ef4\u62a4\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6c60\u5185\u200b\u7684\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200bWorker\u3002\u200b\u6211\u4eec\u200b\u6765\u770b\u200b\u4e00\u4e0b\u200b\u5b83\u200b\u7684\u200b\u90e8\u5206\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>private final class Worker extends AbstractQueuedSynchronizer implements Runnable{\n    final Thread thread;//Worker\u200b\u6301\u6709\u200b\u7684\u200b\u7ebf\u7a0b\u200b\n    Runnable firstTask;//\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4e3a\u200bnull\n}\n</code></pre> <p>Worker\u200b\u8fd9\u4e2a\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200bRunnable\u200b\u63a5\u53e3\u200b\uff0c\u200b\u5e76\u200b\u6301\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200bthread\uff0c\u200b\u4e00\u4e2a\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u4efb\u52a1\u200bfirstTask\u3002thread\u200b\u662f\u200b\u5728\u200b\u8c03\u7528\u200b\u6784\u9020\u65b9\u6cd5\u200b\u65f6\u200b\u901a\u8fc7\u200bThreadFactory\u200b\u6765\u200b\u521b\u5efa\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff1bfirstTask\u200b\u7528\u200b\u5b83\u200b\u6765\u200b\u4fdd\u5b58\u200b\u4f20\u5165\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\u53ef\u4ee5\u200b\u6709\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e3a\u200bnull\u3002\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u662f\u975e\u200b\u7a7a\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u4f1a\u200b\u5728\u200b\u542f\u52a8\u200b\u521d\u671f\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u5bf9\u5e94\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u521b\u5efa\u200b\u65f6\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1b\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u662f\u200bnull\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u9700\u8981\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u53bb\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u5217\u8868\u200b\uff08workQueue\uff09\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u975e\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u521b\u5efa\u200b\u3002</p> <p>Worker\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u6a21\u578b\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b7 Worker\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u9700\u8981\u200b\u7ba1\u7406\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u957f\u65f6\u95f4\u200b\u4e0d\u200b\u8fd0\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\u8fdb\u884c\u200b\u56de\u6536\u200b\u3002\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4f7f\u7528\u200b\u4e00\u5f20\u200bHash\u200b\u8868\u53bb\u200b\u6301\u6709\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6dfb\u52a0\u200b\u5f15\u7528\u200b\u3001\u200b\u79fb\u9664\u200b\u5f15\u7528\u200b\u8fd9\u6837\u200b\u7684\u200b\u64cd\u4f5c\u200b\u6765\u200b\u63a7\u5236\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u91cd\u8981\u200b\u7684\u200b\u5c31\u662f\u200b\u5982\u4f55\u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u5728\u200b\u8fd0\u884c\u200b\u3002</p> <p>\u200bWorker\u200b\u662f\u200b\u901a\u8fc7\u200b\u7ee7\u627f\u200bAQS\uff0c\u200b\u4f7f\u7528\u200bAQS\u200b\u6765\u200b\u5b9e\u73b0\u200b\u72ec\u5360\u200b\u9501\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u3002\u200b\u6ca1\u6709\u200b\u4f7f\u7528\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200bReentrantLock\uff0c\u200b\u800c\u662f\u200b\u4f7f\u7528\u200bAQS\uff0c\u200b\u4e3a\u200b\u7684\u200b\u5c31\u662f\u200b\u5b9e\u73b0\u200b\u4e0d\u53ef\u200b\u91cd\u5165\u200b\u7684\u200b\u7279\u6027\u200b\u53bb\u200b\u53cd\u5e94\u200b\u7ebf\u7a0b\u200b\u73b0\u5728\u200b\u7684\u200b\u6267\u884c\u200b\u72b6\u6001\u200b\u3002</p> <p>1.lock\u200b\u65b9\u6cd5\u200b\u4e00\u65e6\u200b\u83b7\u53d6\u200b\u4e86\u200b\u72ec\u5360\u200b\u9501\u200b\uff0c\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u4e2d\u200b\u3002 2.\u200b\u5982\u679c\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u4e2d\u65ad\u200b\u7ebf\u7a0b\u200b\u3002 3.\u200b\u5982\u679c\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u73b0\u5728\u200b\u4e0d\u662f\u200b\u72ec\u5360\u200b\u9501\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u7a7a\u95f2\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5b83\u200b\u6ca1\u6709\u200b\u5728\u200b\u5904\u7406\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u4e2d\u65ad\u200b\u3002 4.\u200b\u7ebf\u7a0b\u200b\u6c60\u5728\u200b\u6267\u884c\u200bshutdown\u200b\u65b9\u6cd5\u200b\u6216\u200btryTerminate\u200b\u65b9\u6cd5\u200b\u65f6\u4f1a\u200b\u8c03\u7528\u200binterruptIdleWorkers\u200b\u65b9\u6cd5\u200b\u6765\u200b\u4e2d\u65ad\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0cinterruptIdleWorkers\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u4f7f\u7528\u200btryLock\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5224\u65ad\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u662f\u200b\u7a7a\u95f2\u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u7a7a\u95f2\u200b\u72b6\u6001\u200b\u5219\u200b\u53ef\u4ee5\u200b\u5b89\u5168\u200b\u56de\u6536\u200b\u3002</p> <p>\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u56de\u6536\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5c31\u200b\u4f7f\u7528\u200b\u5230\u200b\u4e86\u200b\u8fd9\u79cd\u200b\u7279\u6027\u200b\uff0c\u200b\u56de\u6536\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b8 \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u56de\u6536\u200b\u8fc7\u7a0b\u200b</p> <p>2.4.2 Worker\u200b\u7ebf\u7a0b\u200b\u589e\u52a0\u200b</p> <p>\u200b\u589e\u52a0\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u901a\u8fc7\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200baddWorker\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u7684\u200b\u529f\u80fd\u200b\u5c31\u662f\u200b\u589e\u52a0\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e0d\u200b\u8003\u8651\u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b\u5728\u200b\u54ea\u4e2a\u200b\u9636\u6bb5\u200b\u589e\u52a0\u200b\u7684\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5206\u914d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u7b56\u7565\u200b\u662f\u200b\u5728\u200b\u4e0a\u200b\u4e2a\u200b\u6b65\u9aa4\u200b\u5b8c\u6210\u200b\u7684\u200b\uff0c\u200b\u8be5\u200b\u6b65\u9aa4\u200b\u4ec5\u4ec5\u200b\u5b8c\u6210\u200b\u589e\u52a0\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u200b\u5b83\u200b\u8fd0\u884c\u200b\uff0c\u200b\u6700\u540e\u200b\u8fd4\u56de\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u3002addWorker\u200b\u65b9\u6cd5\u200b\u6709\u200b\u4e24\u4e2a\u200b\u53c2\u6570\u200b\uff1afirstTask\u3001core\u3002firstTask\u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u65b0\u589e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8be5\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u4e3a\u7a7a\u200b\uff1bcore\u200b\u53c2\u6570\u200b\u4e3a\u200btrue\u200b\u8868\u793a\u200b\u5728\u200b\u65b0\u589e\u200b\u7ebf\u7a0b\u200b\u65f6\u4f1a\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u6d3b\u52a8\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u662f\u5426\u200b\u5c11\u4e8e\u200bcorePoolSize\uff0cfalse\u200b\u8868\u793a\u200b\u65b0\u589e\u200b\u7ebf\u7a0b\u200b\u524d\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u6d3b\u52a8\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u662f\u5426\u200b\u5c11\u4e8e\u200bmaximumPoolSize\uff0c\u200b\u5176\u200b\u6267\u884c\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b9 \u200b\u7533\u8bf7\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u6d41\u7a0b\u56fe\u200b</p> <p>2.4.3 Worker\u200b\u7ebf\u7a0b\u200b\u56de\u6536\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u9500\u6bc1\u200b\u4f9d\u8d56\u200bJVM\u200b\u81ea\u52a8\u200b\u7684\u200b\u56de\u6536\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u505a\u200b\u7684\u200b\u5de5\u4f5c\u200b\u662f\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u72b6\u6001\u200b\u7ef4\u62a4\u200b\u4e00\u5b9a\u200b\u6570\u91cf\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5f15\u7528\u200b\uff0c\u200b\u9632\u6b62\u200b\u8fd9\u90e8\u5206\u200b\u7ebf\u7a0b\u200b\u88ab\u200bJVM\u200b\u56de\u6536\u200b\uff0c\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u51b3\u5b9a\u200b\u54ea\u4e9b\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u56de\u6536\u200b\u65f6\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5c06\u200b\u5176\u200b\u5f15\u7528\u200b\u6d88\u9664\u200b\u5373\u53ef\u200b\u3002Worker\u200b\u88ab\u200b\u521b\u5efa\u200b\u51fa\u6765\u200b\u540e\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u5730\u200b\u8fdb\u884c\u200b\u8f6e\u8be2\u200b\uff0c\u200b\u7136\u540e\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u53bb\u200b\u6267\u884c\u200b\uff0c\u200b\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u65e0\u9650\u200b\u7b49\u5f85\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u975e\u6838\u5fc3\u200b\u7ebf\u7a0b\u200b\u8981\u200b\u9650\u65f6\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u3002\u200b\u5f53\u200bWorker\u200b\u65e0\u6cd5\u200b\u83b7\u53d6\u200b\u5230\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u83b7\u53d6\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u5faa\u73af\u200b\u4f1a\u200b\u7ed3\u675f\u200b\uff0cWorker\u200b\u4f1a\u200b\u4e3b\u52a8\u200b\u6d88\u9664\u200b\u81ea\u8eab\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u6c60\u5185\u200b\u7684\u200b\u5f15\u7528\u200b\u3002</p> Java<pre><code>try {\n  while (task != null || (task = getTask()) != null) {\n    //\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\n  }\n} finally {\n  processWorkerExit(w, completedAbruptly);//\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u4e3b\u52a8\u200b\u56de\u6536\u200b\u81ea\u5df1\u200b\n}\n</code></pre> <p>\u200b\u7ebf\u7a0b\u200b\u56de\u6536\u200b\u7684\u200b\u5de5\u4f5c\u200b\u662f\u200b\u5728\u200bprocessWorkerExit\u200b\u65b9\u6cd5\u200b\u5b8c\u6210\u200b\u7684\u200b\u3002</p> <p></p> <p>\u200b\u56fe\u200b10 \u200b\u7ebf\u7a0b\u200b\u9500\u6bc1\u200b\u6d41\u7a0b\u200b</p> <p>\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u5c06\u200b\u7ebf\u7a0b\u200b\u5f15\u7528\u200b\u79fb\u51fa\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5c31\u200b\u5df2\u7ecf\u200b\u7ed3\u675f\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u9500\u6bc1\u200b\u7684\u200b\u90e8\u5206\u200b\u3002\u200b\u4f46\u200b\u7531\u4e8e\u200b\u5f15\u8d77\u200b\u7ebf\u7a0b\u200b\u9500\u6bc1\u200b\u7684\u200b\u53ef\u80fd\u6027\u200b\u6709\u200b\u5f88\u591a\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd8\u8981\u200b\u5224\u65ad\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5f15\u53d1\u200b\u4e86\u200b\u8fd9\u6b21\u200b\u9500\u6bc1\u200b\uff0c\u200b\u662f\u5426\u200b\u8981\u200b\u6539\u53d8\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u73b0\u9636\u6bb5\u200b\u72b6\u6001\u200b\uff0c\u200b\u662f\u5426\u200b\u8981\u200b\u6839\u636e\u200b\u65b0\u200b\u72b6\u6001\u200b\uff0c\u200b\u91cd\u65b0\u5206\u914d\u200b\u7ebf\u7a0b\u200b\u3002</p> <p>2.4.4 Worker\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b</p> <p>\u200b\u5728\u200bWorker\u200b\u7c7b\u4e2d\u200b\u7684\u200brun\u200b\u65b9\u6cd5\u200b\u8c03\u7528\u200b\u4e86\u200brunWorker\u200b\u65b9\u6cd5\u200b\u6765\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0crunWorker\u200b\u65b9\u6cd5\u200b\u7684\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <p>1.while\u200b\u5faa\u73af\u4e0d\u65ad\u200b\u5730\u200b\u901a\u8fc7\u200bgetTask()\u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u4efb\u52a1\u200b\u3002 2.getTask()\u200b\u65b9\u6cd5\u200b\u4ece\u200b\u963b\u585e\u200b\u961f\u5217\u200b\u4e2d\u53d6\u200b\u4efb\u52a1\u200b\u3002 3.\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6b63\u5728\u200b\u505c\u6b62\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\uff0c\u200b\u5426\u5219\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u662f\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\u3002 4.\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u3002 5.\u200b\u5982\u679c\u200bgetTask\u200b\u7ed3\u679c\u200b\u4e3a\u200bnull\u200b\u5219\u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\uff0c\u200b\u6267\u884c\u200bprocessWorkerExit()\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u9500\u6bc1\u200b\u7ebf\u7a0b\u200b\u3002</p> <p>\u200b\u6267\u884c\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b11 \u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u6d41\u7a0b\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#_3","title":"\u4e09\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u6c60\u5728\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u8df5","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#31","title":"3.1 \u200b\u4e1a\u52a1\u200b\u80cc\u666f","text":"<p>\u200b\u5728\u200b\u5f53\u4eca\u200b\u7684\u200b\u4e92\u8054\u7f51\u200b\u4e1a\u754c\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6700\u5927\u200b\u7a0b\u5ea6\u200b\u5229\u7528\u200bCPU\u200b\u7684\u200b\u591a\u200b\u6838\u200b\u6027\u80fd\u200b\uff0c\u200b\u5e76\u884c\u200b\u8fd0\u7b97\u200b\u7684\u200b\u80fd\u529b\u200b\u662f\u200b\u4e0d\u53ef\u6216\u7f3a\u200b\u7684\u200b\u3002\u200b\u901a\u8fc7\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7ba1\u7406\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u5e76\u53d1\u200b\u6027\u662f\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u57fa\u7840\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8ba9\u200b\u6211\u4eec\u200b\u6765\u770b\u200b\u4e24\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u83b7\u53d6\u200b\u5e76\u53d1\u200b\u6027\u200b\u7684\u200b\u573a\u666f\u200b\u3002</p> <p>\u200b\u573a\u666f\u200b1\uff1a\u200b\u5feb\u901f\u200b\u54cd\u5e94\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b</p> <p>\u200b\u63cf\u8ff0\u200b\uff1a\u200b\u7528\u6237\u200b\u53d1\u8d77\u200b\u7684\u200b\u5b9e\u65f6\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u670d\u52a1\u200b\u8ffd\u6c42\u200b\u54cd\u5e94\u200b\u65f6\u95f4\u200b\u3002\u200b\u6bd4\u5982\u8bf4\u200b\u7528\u6237\u200b\u8981\u200b\u67e5\u770b\u200b\u4e00\u4e2a\u200b\u5546\u54c1\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5c06\u200b\u5546\u54c1\u200b\u7ef4\u5ea6\u200b\u7684\u200b\u4e00\u7cfb\u5217\u200b\u4fe1\u606f\u200b\u5982\u200b\u5546\u54c1\u200b\u7684\u200b\u4ef7\u683c\u200b\u3001\u200b\u4f18\u60e0\u200b\u3001\u200b\u5e93\u5b58\u200b\u3001\u200b\u56fe\u7247\u200b\u7b49\u7b49\u200b\u805a\u5408\u8d77\u6765\u200b\uff0c\u200b\u5c55\u793a\u200b\u7ed9\u200b\u7528\u6237\u200b\u3002</p> <p>\u200b\u5206\u6790\u200b\uff1a\u200b\u4ece\u200b\u7528\u6237\u200b\u4f53\u9a8c\u200b\u89d2\u5ea6\u770b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u54cd\u5e94\u200b\u7684\u200b\u8d8a\u5feb\u8d8a\u597d\u200b\uff0c\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u9875\u9762\u200b\u534a\u5929\u200b\u90fd\u200b\u5237\u200b\u4e0d\u51fa\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u80fd\u200b\u5c31\u200b\u653e\u5f03\u200b\u67e5\u770b\u200b\u8fd9\u4e2a\u200b\u5546\u54c1\u200b\u4e86\u200b\u3002\u200b\u800c\u200b\u9762\u5411\u7528\u6237\u200b\u7684\u200b\u529f\u80fd\u200b\u805a\u5408\u200b\u901a\u5e38\u200b\u975e\u5e38\u590d\u6742\u200b\uff0c\u200b\u4f34\u968f\u200b\u7740\u200b\u8c03\u7528\u200b\u4e0e\u200b\u8c03\u7528\u200b\u4e4b\u95f4\u200b\u7684\u200b\u7ea7\u8054\u200b\u3001\u200b\u591a\u7ea7\u200b\u7ea7\u8054\u200b\u7b49\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e1a\u52a1\u200b\u5f00\u53d1\u200b\u540c\u5b66\u200b\u5f80\u5f80\u200b\u4f1a\u200b\u9009\u62e9\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8fd9\u79cd\u200b\u7b80\u5355\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5c06\u200b\u8c03\u7528\u200b\u5c01\u88c5\u200b\u6210\u200b\u4efb\u52a1\u200b\u5e76\u884c\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u7f29\u77ed\u200b\u603b\u4f53\u200b\u54cd\u5e94\u200b\u65f6\u95f4\u200b\u3002\u200b\u53e6\u5916\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4e5f\u200b\u662f\u200b\u6709\u200b\u8003\u91cf\u200b\u7684\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u573a\u666f\u200b\u6700\u200b\u91cd\u8981\u200b\u7684\u200b\u5c31\u662f\u200b\u83b7\u53d6\u200b\u6700\u5927\u200b\u7684\u200b\u54cd\u5e94\u901f\u5ea6\u200b\u53bb\u200b\u6ee1\u8db3\u7528\u6237\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5e94\u8be5\u200b\u4e0d\u200b\u8bbe\u7f6e\u200b\u961f\u5217\u200b\u53bb\u200b\u7f13\u51b2\u200b\u5e76\u53d1\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8c03\u200b\u9ad8\u200bcorePoolSize\u200b\u548c\u200bmaxPoolSize\u200b\u53bb\u200b\u5c3d\u53ef\u80fd\u200b\u521b\u9020\u200b\u591a\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5feb\u901f\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u3002</p> <p></p> <p>\u200b\u56fe\u200b12 \u200b\u5e76\u884c\u6267\u884c\u200b\u4efb\u52a1\u200b\u63d0\u5347\u200b\u4efb\u52a1\u200b\u54cd\u5e94\u901f\u5ea6\u200b</p> <p>\u200b\u573a\u666f\u200b2\uff1a\u200b\u5feb\u901f\u200b\u5904\u7406\u200b\u6279\u91cf\u200b\u4efb\u52a1\u200b</p> <p>\u200b\u63cf\u8ff0\u200b\uff1a\u200b\u79bb\u7ebf\u200b\u7684\u200b\u5927\u91cf\u200b\u8ba1\u7b97\u200b\u4efb\u52a1\u200b\uff0c\u200b\u9700\u8981\u200b\u5feb\u901f\u200b\u6267\u884c\u200b\u3002\u200b\u6bd4\u5982\u8bf4\u200b\uff0c\u200b\u7edf\u8ba1\u200b\u67d0\u4e2a\u200b\u62a5\u8868\u200b\uff0c\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5168\u56fd\u200b\u5404\u4e2a\u200b\u95e8\u5e97\u200b\u4e2d\u6709\u200b\u54ea\u4e9b\u200b\u5546\u54c1\u200b\u6709\u200b\u67d0\u79cd\u200b\u5c5e\u6027\u200b\uff0c\u200b\u7528\u4e8e\u200b\u540e\u7eed\u200b\u8425\u9500\u200b\u7b56\u7565\u200b\u7684\u200b\u5206\u6790\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u67e5\u8be2\u200b\u5168\u56fd\u200b\u6240\u6709\u200b\u95e8\u5e97\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u5546\u54c1\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bb0\u5f55\u200b\u5177\u6709\u200b\u67d0\u200b\u5c5e\u6027\u200b\u7684\u200b\u5546\u54c1\u200b\uff0c\u200b\u7136\u540e\u200b\u5feb\u901f\u200b\u751f\u6210\u200b\u62a5\u8868\u200b\u3002</p> <p>\u200b\u5206\u6790\u200b\uff1a\u200b\u8fd9\u79cd\u200b\u573a\u666f\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u5927\u91cf\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e5f\u200b\u4f1a\u200b\u5e0c\u671b\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u8d8a\u5feb\u8d8a\u597d\u200b\u3002\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u5e94\u8be5\u200b\u4f7f\u7528\u200b\u591a\u7ebf\u7a0b\u200b\u7b56\u7565\u200b\uff0c\u200b\u5e76\u884c\u8ba1\u7b97\u200b\u3002\u200b\u4f46\u200b\u4e0e\u200b\u54cd\u5e94\u901f\u5ea6\u200b\u4f18\u5148\u200b\u7684\u200b\u573a\u666f\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0c\u200b\u8fd9\u200b\u7c7b\u200b\u573a\u666f\u200b\u4efb\u52a1\u91cf\u200b\u5de8\u5927\u200b\uff0c\u200b\u5e76\u4e0d\u9700\u8981\u200b\u77ac\u65f6\u200b\u7684\u200b\u5b8c\u6210\u200b\uff0c\u200b\u800c\u662f\u200b\u5173\u6ce8\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u6709\u9650\u200b\u7684\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5c3d\u53ef\u80fd\u200b\u5728\u200b\u5355\u4f4d\u200b\u65f6\u95f4\u200b\u5185\u200b\u5904\u7406\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u541e\u5410\u91cf\u200b\u4f18\u5148\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u6240\u4ee5\u200b\u5e94\u8be5\u200b\u8bbe\u7f6e\u200b\u961f\u5217\u200b\u53bb\u200b\u7f13\u51b2\u200b\u5e76\u53d1\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8c03\u6574\u200b\u5408\u9002\u200b\u7684\u200bcorePoolSize\u200b\u53bb\u200b\u8bbe\u7f6e\u200b\u5904\u7406\u200b\u4efb\u52a1\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u3002\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u8fc7\u200b\u591a\u200b\u53ef\u80fd\u200b\u8fd8\u4f1a\u200b\u5f15\u53d1\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u9891\u7e41\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u964d\u4f4e\u200b\u5904\u7406\u200b\u4efb\u52a1\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u964d\u4f4e\u200b\u541e\u5410\u91cf\u200b\u3002</p> <p></p> <p>\u200b\u56fe\u200b13 \u200b\u5e76\u884c\u6267\u884c\u200b\u4efb\u52a1\u200b\u63d0\u5347\u200b\u6279\u91cf\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u901f\u5ea6\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#32","title":"3.2 \u200b\u5b9e\u9645\u200b\u95ee\u9898\u200b\u53ca\u200b\u65b9\u6848\u200b\u601d\u8003","text":"<p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4f7f\u7528\u200b\u9762\u4e34\u200b\u7684\u200b\u6838\u5fc3\u200b\u7684\u200b\u95ee\u9898\u200b\u5728\u4e8e\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u53c2\u6570\u200b\u5e76\u200b\u4e0d\u597d\u200b\u914d\u7f6e\u200b\u3002\u200b\u4e00\u65b9\u9762\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u673a\u5236\u200b\u4e0d\u662f\u200b\u5f88\u200b\u597d\u200b\u7406\u89e3\u200b\uff0c\u200b\u914d\u7f6e\u200b\u5408\u7406\u200b\u9700\u8981\u200b\u5f3a\u200b\u4f9d\u8d56\u200b\u5f00\u53d1\u4eba\u5458\u200b\u7684\u200b\u4e2a\u4eba\u200b\u7ecf\u9a8c\u200b\u548c\u200b\u77e5\u8bc6\u200b\uff1b\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6267\u884c\u200b\u7684\u200b\u60c5\u51b5\u200b\u548c\u200b\u4efb\u52a1\u200b\u7c7b\u578b\u200b\u76f8\u5173\u6027\u200b\u8f83\u5927\u200b\uff0cIO\u200b\u5bc6\u96c6\u578b\u200b\u548c\u200bCPU\u200b\u5bc6\u96c6\u578b\u200b\u7684\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u8d77\u6765\u200b\u7684\u200b\u60c5\u51b5\u200b\u5dee\u5f02\u200b\u975e\u5e38\u200b\u5927\u200b\uff0c\u200b\u8fd9\u200b\u5bfc\u81f4\u200b\u4e1a\u754c\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4e00\u4e9b\u200b\u6210\u719f\u200b\u7684\u200b\u7ecf\u9a8c\u200b\u7b56\u7565\u200b\u5e2e\u52a9\u200b\u5f00\u53d1\u4eba\u5458\u200b\u53c2\u8003\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u914d\u7f6e\u200b\u4e0d\u5408\u7406\u200b\u5f15\u53d1\u200b\u7684\u200b\u6545\u969c\u200b\uff0c\u200b\u516c\u53f8\u200b\u5185\u90e8\u200b\u6709\u200b\u8f83\u200b\u591a\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4e3e\u200b\u4e00\u4e9b\u200b\u4f8b\u5b50\u200b\uff1a</p> <p>Case1\uff1a2018\u200b\u5e74\u200bXX\u200b\u9875\u9762\u200b\u5c55\u793a\u200b\u63a5\u53e3\u200b\u5927\u91cf\u200b\u8c03\u7528\u200b\u964d\u7ea7\u200b\uff1a</p> <p>\u200b\u4e8b\u6545\u200b\u63cf\u8ff0\u200b\uff1aXX\u200b\u9875\u9762\u200b\u5c55\u793a\u200b\u63a5\u53e3\u200b\u4ea7\u751f\u200b\u5927\u91cf\u200b\u8c03\u7528\u200b\u964d\u7ea7\u200b\uff0c\u200b\u6570\u91cf\u7ea7\u200b\u5728\u200b\u51e0\u5341\u200b\u5230\u200b\u4e0a\u767e\u200b\u3002</p> <p>\u200b\u4e8b\u6545\u200b\u539f\u56e0\u200b\uff1a\u200b\u8be5\u200b\u670d\u52a1\u200b\u5c55\u793a\u200b\u63a5\u53e3\u200b\u5185\u90e8\u200b\u903b\u8f91\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u505a\u200b\u5e76\u884c\u8ba1\u7b97\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6ca1\u6709\u200b\u9884\u4f30\u200b\u597d\u200b\u8c03\u7528\u200b\u7684\u200b\u6d41\u91cf\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6700\u5927\u200b\u6838\u5fc3\u200b\u6570\u200b\u8bbe\u7f6e\u200b\u504f\u5c0f\u200b\uff0c\u200b\u5927\u91cf\u200b\u629b\u51fa\u200bRejectedExecutionException\uff0c\u200b\u89e6\u53d1\u200b\u63a5\u53e3\u200b\u964d\u7ea7\u200b\u6761\u4ef6\u200b\uff0c\u200b\u793a\u610f\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b14 \u200b\u7ebf\u7a0b\u200b\u6570\u200b\u6838\u5fc3\u200b\u8bbe\u7f6e\u200b\u8fc7\u200b\u5c0f\u200b\u5f15\u53d1\u200bRejectExecutionException</p> <p>Case2\uff1a2018\u200b\u5e74\u200bXX\u200b\u4e1a\u52a1\u200b\u670d\u52a1\u200b\u4e0d\u53ef\u200b\u7528\u200bS2\u200b\u7ea7\u200b\u6545\u969c\u200b</p> <p>\u200b\u4e8b\u6545\u200b\u63cf\u8ff0\u200b\uff1aXX\u200b\u4e1a\u52a1\u200b\u63d0\u4f9b\u200b\u7684\u200b\u670d\u52a1\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u8fc7\u957f\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u4e0a\u6e38\u200b\u670d\u52a1\u200b\u6574\u4f53\u200b\u8d85\u65f6\u200b\uff0c\u200b\u5927\u91cf\u200b\u4e0b\u6e38\u200b\u670d\u52a1\u200b\u8c03\u7528\u200b\u5931\u8d25\u200b\u3002</p> <p>\u200b\u4e8b\u6545\u200b\u539f\u56e0\u200b\uff1a\u200b\u8be5\u200b\u670d\u52a1\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u5185\u90e8\u200b\u903b\u8f91\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u505a\u200b\u8d44\u6e90\u200b\u9694\u79bb\u200b\uff0c\u200b\u7531\u4e8e\u200b\u961f\u5217\u200b\u8bbe\u7f6e\u200b\u8fc7\u957f\u200b\uff0c\u200b\u6700\u5927\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u8bbe\u7f6e\u200b\u5931\u6548\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8bf7\u6c42\u200b\u6570\u91cf\u200b\u589e\u52a0\u200b\u65f6\u200b\uff0c\u200b\u5927\u91cf\u200b\u4efb\u52a1\u200b\u5806\u79ef\u200b\u5728\u200b\u961f\u5217\u200b\u4e2d\u200b\uff0c\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u8fc7\u957f\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5bfc\u81f4\u200b\u4e0b\u6e38\u200b\u670d\u52a1\u200b\u7684\u200b\u5927\u91cf\u200b\u8c03\u7528\u200b\u8d85\u65f6\u200b\u5931\u8d25\u200b\u3002\u200b\u793a\u610f\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b15 \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u961f\u5217\u200b\u957f\u5ea6\u200b\u8bbe\u7f6e\u200b\u8fc7\u957f\u200b\u3001corePoolSize\u200b\u8bbe\u7f6e\u200b\u8fc7\u200b\u5c0f\u200b\u5bfc\u81f4\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u901f\u5ea6\u200b\u4f4e\u200b</p> <p>\u200b\u4e1a\u52a1\u200b\u4e2d\u8981\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u800c\u200b\u4f7f\u7528\u4e0d\u5f53\u200b\u53c8\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6545\u969c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u4eec\u200b\u600e\u6837\u624d\u80fd\u200b\u66f4\u597d\u200b\u5730\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5462\u200b\uff1f\u200b\u9488\u5bf9\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0b\u9762\u200b\u5ef6\u5c55\u200b\u51e0\u4e2a\u200b\u65b9\u5411\u200b\uff1a</p> <p>1. \u200b\u80fd\u5426\u200b\u4e0d\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b?</p> <p>\u200b\u56de\u5230\u200b\u6700\u521d\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e1a\u52a1\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u662f\u200b\u4e3a\u4e86\u200b\u83b7\u53d6\u200b\u5e76\u53d1\u200b\u6027\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u83b7\u53d6\u200b\u5e76\u53d1\u200b\u6027\u200b\uff0c\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u6709\u200b\u4ec0\u4e48\u200b\u5176\u4ed6\u200b\u7684\u200b\u65b9\u6848\u200b\u5462\u200b\u66ff\u4ee3\u200b\uff1f\u200b\u6211\u4eec\u200b\u5c1d\u8bd5\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5176\u4ed6\u200b\u65b9\u6848\u200b\u7684\u200b\u8c03\u7814\u200b\uff1a</p> <p></p> <p>\u200b\u7efc\u5408\u200b\u8003\u8651\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u65b0\u200b\u7684\u200b\u65b9\u6848\u200b\u90fd\u200b\u80fd\u200b\u5728\u200b\u67d0\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u63d0\u5347\u200b\u5e76\u884c\u4efb\u52a1\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u7136\u800c\u200b\u672c\u6b21\u200b\u91cd\u70b9\u200b\u89e3\u51b3\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\u5982\u4f55\u200b\u66f4\u200b\u7b80\u6613\u200b\u3001\u200b\u66f4\u200b\u5b89\u5168\u200b\u5730\u200b\u83b7\u5f97\u200b\u7684\u200b\u5e76\u53d1\u200b\u6027\u200b\u3002\u200b\u53e6\u5916\u200b\uff0cActor\u200b\u6a21\u578b\u200b\u7684\u200b\u5e94\u7528\u200b\u5b9e\u9645\u4e0a\u200b\u751a\u200b\u5c11\u200b\uff0c\u200b\u53ea\u200b\u5728\u200bScala\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u5e7f\u6cdb\u200b\uff0c\u200b\u534f\u7a0b\u200b\u6846\u67b6\u200b\u5728\u200bJava\u200b\u4e2d\u200b\u7ef4\u62a4\u200b\u7684\u200b\u4e5f\u200b\u4e0d\u200b\u6210\u719f\u200b\u3002\u200b\u8fd9\u200b\u4e09\u8005\u200b\u73b0\u9636\u6bb5\u200b\u90fd\u200b\u4e0d\u662f\u200b\u8db3\u591f\u200b\u7684\u200b\u6613\u7528\u200b\uff0c\u200b\u4e5f\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u89e3\u51b3\u200b\u4e1a\u52a1\u200b\u4e0a\u200b\u73b0\u9636\u6bb5\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>2. \u200b\u8ffd\u6c42\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u5408\u7406\u6027\u200b\uff1f</p> <p>\u200b\u6709\u6ca1\u6709\u200b\u4e00\u79cd\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\uff0c\u200b\u80fd\u591f\u200b\u8ba9\u200b\u5f00\u53d1\u200b\u540c\u5b66\u200b\u5f88\u200b\u7b80\u6613\u200b\u5730\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u67d0\u79cd\u200b\u573a\u666f\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5e94\u8be5\u200b\u662f\u200b\u4ec0\u4e48\u200b\u53c2\u6570\u200b\u5462\u200b\uff1f</p> <p>\u200b\u5e26\u200b\u7740\u200b\u8fd9\u6837\u200b\u7684\u200b\u7591\u95ee\u200b\uff0c\u200b\u6211\u4eec\u200b\u8c03\u7814\u200b\u4e86\u200b\u4e1a\u754c\u200b\u7684\u200b\u4e00\u4e9b\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u914d\u7f6e\u200b\u65b9\u6848\u200b\uff1a</p> <p></p> <p>\u200b\u8c03\u7814\u200b\u4e86\u200b\u4ee5\u4e0a\u200b\u4e1a\u754c\u200b\u65b9\u6848\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5f97\u51fa\u200b\u901a\u7528\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u3002\u200b\u5e76\u53d1\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\u60c5\u51b5\u200b\u548c\u200b\u4efb\u52a1\u200b\u7c7b\u578b\u200b\u76f8\u5173\u200b\uff0cIO\u200b\u5bc6\u96c6\u578b\u200b\u548c\u200bCPU\u200b\u5bc6\u96c6\u578b\u200b\u7684\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u8d77\u6765\u200b\u7684\u200b\u60c5\u51b5\u200b\u5dee\u5f02\u200b\u975e\u5e38\u200b\u5927\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u79cd\u200b\u5360\u200b\u6bd4\u200b\u662f\u200b\u8f83\u200b\u96be\u200b\u5408\u7406\u200b\u9884\u4f30\u200b\u7684\u200b\uff0c\u200b\u8fd9\u200b\u5bfc\u81f4\u200b\u5f88\u96be\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u6709\u6548\u200b\u7684\u200b\u901a\u7528\u200b\u516c\u5f0f\u200b\u5e2e\u200b\u6211\u4eec\u200b\u76f4\u63a5\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u7ed3\u679c\u200b\u3002</p> <p>3. \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u52a8\u6001\u5316\u200b\uff1f</p> <p>\u200b\u5c3d\u7ba1\u200b\u7ecf\u8fc7\u200b\u8c28\u614e\u200b\u7684\u200b\u8bc4\u4f30\u200b\uff0c\u200b\u4ecd\u7136\u200b\u4e0d\u200b\u80fd\u591f\u200b\u4fdd\u8bc1\u200b\u4e00\u6b21\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u5408\u9002\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u4eec\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4fee\u6539\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u7684\u200b\u6210\u672c\u200b\u964d\u4e0b\u6765\u200b\uff0c\u200b\u8fd9\u6837\u200b\u81f3\u5c11\u200b\u53ef\u4ee5\u200b\u53d1\u751f\u200b\u6545\u969c\u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u8c03\u6574\u200b\u4ece\u800c\u200b\u7f29\u77ed\u200b\u6545\u969c\u200b\u6062\u590d\u200b\u7684\u200b\u65f6\u95f4\u200b\u5462\u200b\uff1f\u200b\u57fa\u4e8e\u200b\u8fd9\u4e2a\u200b\u601d\u8003\u200b\uff0c\u200b\u6211\u4eec\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u53c2\u6570\u200b\u4ece\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u8fc1\u79fb\u200b\u5230\u200b\u5206\u5e03\u5f0f\u200b\u914d\u7f6e\u200b\u4e2d\u5fc3\u200b\u4e0a\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u53ef\u200b\u52a8\u6001\u200b\u914d\u7f6e\u200b\u548c\u200b\u5373\u65f6\u200b\u751f\u6548\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u52a8\u6001\u5316\u200b\u524d\u540e\u200b\u7684\u200b\u53c2\u6570\u200b\u4fee\u6539\u200b\u6d41\u7a0b\u200b\u5bf9\u6bd4\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b16 \u200b\u52a8\u6001\u200b\u4fee\u6539\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u65b0\u65e7\u200b\u6d41\u7a0b\u200b\u5bf9\u6bd4\u200b</p> <p>\u200b\u57fa\u4e8e\u200b\u4ee5\u4e0a\u200b\u4e09\u4e2a\u200b\u65b9\u5411\u200b\u5bf9\u6bd4\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\u53c2\u6570\u200b\u52a8\u6001\u5316\u200b\u65b9\u5411\u200b\u7b80\u5355\u200b\u6709\u6548\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#33","title":"3.3 \u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60","text":"<p>3.3.1 \u200b\u6574\u4f53\u200b\u8bbe\u8ba1\u200b</p> <p>\u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u6838\u5fc3\u200b\u8bbe\u8ba1\u200b\u5305\u62ec\u200b\u4ee5\u4e0b\u200b\u4e09\u4e2a\u200b\u65b9\u9762\u200b\uff1a</p> <ol> <li>\u200b\u7b80\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u914d\u7f6e\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6784\u9020\u200b\u53c2\u6570\u200b\u6709\u200b8\u200b\u4e2a\u200b\uff0c\u200b\u4f46\u662f\u200b\u6700\u200b\u6838\u5fc3\u200b\u7684\u200b\u662f\u200b3\u200b\u4e2a\u200b\uff1acorePoolSize\u3001maximumPoolSize\uff0cworkQueue\uff0c\u200b\u5b83\u4eec\u200b\u6700\u5927\u200b\u7a0b\u5ea6\u200b\u5730\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u4efb\u52a1\u5206\u914d\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u5206\u914d\u200b\u7b56\u7565\u200b\u3002\u200b\u8003\u8651\u200b\u5230\u200b\u5728\u200b\u5b9e\u9645\u200b\u5e94\u7528\u200b\u4e2d\u200b\u6211\u4eec\u200b\u83b7\u53d6\u200b\u5e76\u53d1\u200b\u6027\u200b\u7684\u200b\u573a\u666f\u200b\u4e3b\u8981\u200b\u662f\u200b\u4e24\u79cd\u200b\uff1a\uff081\uff09\u200b\u5e76\u884c\u6267\u884c\u200b\u5b50\u200b\u4efb\u52a1\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u54cd\u5e94\u901f\u5ea6\u200b\u3002\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5e94\u8be5\u200b\u4f7f\u7528\u200b\u540c\u6b65\u200b\u961f\u5217\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u4efb\u52a1\u200b\u5e94\u8be5\u200b\u88ab\u200b\u7f13\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u800c\u662f\u200b\u5e94\u8be5\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\u3002\uff082\uff09\u200b\u5e76\u884c\u6267\u884c\u200b\u5927\u200b\u6279\u6b21\u200b\u4efb\u52a1\u200b\uff0c\u200b\u63d0\u5347\u200b\u541e\u5410\u91cf\u200b\u3002\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5e94\u8be5\u200b\u4f7f\u7528\u200b\u6709\u200b\u754c\u200b\u961f\u5217\u200b\uff0c\u200b\u4f7f\u7528\u200b\u961f\u5217\u200b\u53bb\u200b\u7f13\u51b2\u200b\u5927\u6279\u91cf\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u961f\u5217\u200b\u5bb9\u91cf\u200b\u5fc5\u987b\u200b\u58f0\u660e\u200b\uff0c\u200b\u9632\u6b62\u200b\u4efb\u52a1\u200b\u65e0\u200b\u9650\u5236\u200b\u5806\u79ef\u200b\u3002\u200b\u6240\u4ee5\u200b\u7ebf\u7a0b\u200b\u6c60\u53ea\u200b\u9700\u8981\u200b\u63d0\u4f9b\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u5173\u952e\u200b\u53c2\u6570\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u4e24\u79cd\u200b\u961f\u5217\u200b\u7684\u200b\u9009\u62e9\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6ee1\u8db3\u200b\u7edd\u5927\u591a\u6570\u200b\u7684\u200b\u4e1a\u52a1\u200b\u9700\u6c42\u200b\uff0cLess is More\u3002</li> <li>\u200b\u53c2\u6570\u200b\u53ef\u200b\u52a8\u6001\u200b\u4fee\u6539\u200b\uff1a\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u53c2\u6570\u200b\u4e0d\u597d\u200b\u914d\u200b\uff0c\u200b\u4fee\u6539\u200b\u53c2\u6570\u200b\u6210\u672c\u200b\u9ad8\u7b49\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200bJava\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7559\u6709\u200b\u9ad8\u200b\u6269\u5c55\u6027\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5c01\u88c5\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u76d1\u542c\u200b\u540c\u6b65\u200b\u5916\u90e8\u200b\u7684\u200b\u6d88\u606f\u200b\uff0c\u200b\u6839\u636e\u200b\u6d88\u606f\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\u914d\u7f6e\u200b\u3002\u200b\u5c06\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u914d\u7f6e\u200b\u653e\u7f6e\u200b\u5728\u200b\u5e73\u53f0\u200b\u4fa7\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5f00\u53d1\u200b\u540c\u5b66\u200b\u7b80\u5355\u200b\u7684\u200b\u67e5\u770b\u200b\u3001\u200b\u4fee\u6539\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u914d\u7f6e\u200b\u3002</li> <li>\u200b\u589e\u52a0\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u76d1\u63a7\u200b\uff1a\u200b\u5bf9\u200b\u67d0\u200b\u4e8b\u7269\u200b\u7f3a\u4e4f\u200b\u72b6\u6001\u200b\u7684\u200b\u89c2\u6d4b\u200b\uff0c\u200b\u5c31\u200b\u5bf9\u200b\u5176\u200b\u6539\u8fdb\u200b\u65e0\u4ece\u4e0b\u624b\u200b\u3002\u200b\u5728\u7ebf\u200b\u7a0b\u6c60\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u6dfb\u52a0\u200b\u76d1\u63a7\u200b\u80fd\u529b\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u5f00\u53d1\u200b\u540c\u5b66\u200b\u4e86\u89e3\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u72b6\u6001\u200b\u3002</li> </ol> <p></p> <p>\u200b\u56fe\u200b17 \u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6574\u4f53\u200b\u8bbe\u8ba1\u200b</p> <p>3.3.2 \u200b\u529f\u80fd\u200b\u67b6\u6784\u200b</p> <p>\u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u63d0\u4f9b\u200b\u5982\u4e0b\u200b\u529f\u80fd\u200b\uff1a</p> <p>\u200b\u52a8\u6001\u200b\u8c03\u53c2\u200b\uff1a\u200b\u652f\u6301\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u52a8\u6001\u200b\u8c03\u6574\u200b\u3001\u200b\u754c\u9762\u200b\u5316\u200b\u64cd\u4f5c\u200b\uff1b\u200b\u5305\u62ec\u200b\u4fee\u6539\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6838\u5fc3\u200b\u5927\u5c0f\u200b\u3001\u200b\u6700\u5927\u200b\u6838\u5fc3\u200b\u5927\u5c0f\u200b\u3001\u200b\u961f\u5217\u200b\u957f\u5ea6\u200b\u7b49\u200b\uff1b\u200b\u53c2\u6570\u200b\u4fee\u6539\u200b\u540e\u200b\u53ca\u65f6\u200b\u751f\u6548\u200b\u3002 \u200b\u4efb\u52a1\u200b\u76d1\u63a7\u200b\uff1a\u200b\u652f\u6301\u200b\u5e94\u7528\u200b\u7c92\u5ea6\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7c92\u5ea6\u200b\u3001\u200b\u4efb\u52a1\u200b\u7c92\u5ea6\u200b\u7684\u200bTransaction\u200b\u76d1\u63a7\u200b\uff1b\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u60c5\u51b5\u200b\u3001\u200b\u6700\u5927\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u3001\u200b\u5e73\u5747\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u300195/99\u200b\u7ebf\u200b\u7b49\u200b\u3002 \u200b\u8d1f\u8f7d\u200b\u544a\u8b66\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u961f\u5217\u200b\u4efb\u52a1\u200b\u79ef\u538b\u200b\u5230\u200b\u4e00\u5b9a\u200b\u503c\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u5927\u8c61\u200b\uff08\u200b\u7f8e\u56e2\u200b\u5185\u90e8\u200b\u901a\u8baf\u200b\u5de5\u5177\u200b\uff09\u200b\u544a\u77e5\u200b\u5e94\u7528\u200b\u5f00\u53d1\u200b\u8d1f\u8d23\u4eba\u200b\uff1b\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8d1f\u8f7d\u200b\u6570\u200b\u8fbe\u5230\u200b\u4e00\u5b9a\u200b\u9608\u503c\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u5927\u8c61\u200b\u544a\u77e5\u200b\u5e94\u7528\u200b\u5f00\u53d1\u200b\u8d1f\u8d23\u4eba\u200b\u3002 \u200b\u64cd\u4f5c\u200b\u76d1\u63a7\u200b\uff1a\u200b\u521b\u5efa\u200b/\u200b\u4fee\u6539\u200b\u548c\u200b\u5220\u9664\u200b\u7ebf\u7a0b\u200b\u6c60\u90fd\u4f1a\u200b\u901a\u77e5\u200b\u5230\u200b\u5e94\u7528\u200b\u7684\u200b\u5f00\u53d1\u200b\u8d1f\u8d23\u4eba\u200b\u3002 \u200b\u64cd\u4f5c\u200b\u65e5\u5fd7\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u7684\u200b\u4fee\u6539\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u8c01\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u4fee\u6539\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u3001\u200b\u4fee\u6539\u200b\u524d\u200b\u7684\u200b\u53c2\u6570\u503c\u200b\u662f\u200b\u4ec0\u4e48\u200b\u3002 \u200b\u6743\u9650\u200b\u6821\u9a8c\u200b\uff1a\u200b\u53ea\u6709\u200b\u5e94\u7528\u200b\u5f00\u53d1\u200b\u8d1f\u8d23\u4eba\u200b\u624d\u200b\u80fd\u591f\u200b\u4fee\u6539\u200b\u5e94\u7528\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u3002</p> <p></p> <p>\u200b\u56fe\u200b18 \u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u529f\u80fd\u200b\u67b6\u6784\u200b</p> <p>\u200b\u53c2\u6570\u200b\u52a8\u6001\u5316\u200b</p> <p>JDK\u200b\u539f\u751f\u200b\u7ebf\u7a0b\u200b\u6c60\u200bThreadPoolExecutor\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5982\u4e0b\u200b\u51e0\u4e2a\u200bpublic\u200b\u7684\u200bsetter\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b19 JDK \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u63a5\u53e3\u200b</p> <p>JDK\u200b\u5141\u8bb8\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4f7f\u7528\u200b\u65b9\u200b\u901a\u8fc7\u200bThreadPoolExecutor\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u6765\u200b\u52a8\u6001\u200b\u8bbe\u7f6e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u6838\u5fc3\u200b\u7b56\u7565\u200b\uff0c\u200b\u4ee5\u200bsetCorePoolSize\u200b\u4e3a\u200b\u65b9\u6cd5\u200b\u4f8b\u200b\uff0c\u200b\u5728\u200b\u8fd0\u884c\u200b\u671f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4f7f\u7528\u200b\u65b9\u200b\u8c03\u7528\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u8bbe\u7f6e\u200bcorePoolSize\u200b\u4e4b\u540e\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u4f1a\u200b\u76f4\u63a5\u200b\u8986\u76d6\u200b\u539f\u6765\u200b\u7684\u200bcorePoolSize\u200b\u503c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u57fa\u4e8e\u200b\u5f53\u524d\u200b\u503c\u200b\u548c\u200b\u539f\u59cb\u200b\u503c\u200b\u7684\u200b\u6bd4\u8f83\u200b\u7ed3\u679c\u200b\u91c7\u53d6\u200b\u4e0d\u540c\u200b\u7684\u200b\u5904\u7406\u200b\u7b56\u7565\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5f53\u524d\u200b\u503c\u200b\u5c0f\u4e8e\u200b\u5f53\u524d\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8bf4\u660e\u200b\u6709\u200b\u591a\u4f59\u200b\u7684\u200bworker\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u5411\u200b\u5f53\u524d\u200bidle\u200b\u7684\u200bworker\u200b\u7ebf\u7a0b\u200b\u53d1\u8d77\u200b\u4e2d\u65ad\u8bf7\u6c42\u200b\u4ee5\u200b\u5b9e\u73b0\u200b\u56de\u6536\u200b\uff0c\u200b\u591a\u4f59\u200b\u7684\u200bworker\u200b\u5728\u200b\u4e0b\u6b21\u200bidel\u200b\u7684\u200b\u65f6\u5019\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\uff1b\u200b\u5bf9\u4e8e\u200b\u5f53\u524d\u200b\u503c\u200b\u5927\u4e8e\u200b\u539f\u59cb\u200b\u503c\u4e14\u200b\u5f53\u524d\u200b\u961f\u5217\u200b\u4e2d\u200b\u6709\u5f85\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5219\u200b\u7ebf\u7a0b\u200b\u6c60\u4f1a\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200bworker\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u6267\u884c\u200b\u961f\u5217\u200b\u4efb\u52a1\u200b\uff0csetCorePoolSize\u200b\u5177\u4f53\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b20 setCorePoolSize\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u6d41\u7a0b\u200b</p> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5185\u90e8\u200b\u4f1a\u200b\u5904\u7406\u200b\u597d\u200b\u5f53\u524d\u200b\u72b6\u6001\u200b\u505a\u5230\u200b\u5e73\u6ed1\u200b\u4fee\u6539\u200b\uff0c\u200b\u5176\u4ed6\u200b\u51e0\u4e2a\u200b\u65b9\u6cd5\u200b\u9650\u4e8e\u200b\u7bc7\u5e45\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u4e00\u4e00\u200b\u4ecb\u7ecd\u200b\u3002\u200b\u91cd\u70b9\u200b\u662f\u200b\u57fa\u4e8e\u200b\u8fd9\u200b\u51e0\u4e2a\u200bpublic\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ea\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200bThreadPoolExecutor\u200b\u7684\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u9700\u8981\u200b\u4fee\u6539\u200b\u7684\u200b\u65f6\u5019\u200b\u62ff\u5230\u200b\u5b9e\u4f8b\u200b\u4fee\u6539\u200b\u5176\u200b\u53c2\u6570\u200b\u5373\u53ef\u200b\u3002\u200b\u57fa\u4e8e\u200b\u4ee5\u4e0a\u200b\u7684\u200b\u601d\u8def\u200b\uff0c\u200b\u6211\u4eec\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u7684\u200b\u52a8\u6001\u5316\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u5728\u200b\u7ba1\u7406\u200b\u5e73\u53f0\u200b\u53ef\u200b\u914d\u7f6e\u200b\u53ef\u200b\u4fee\u6539\u200b\uff0c\u200b\u5176\u200b\u6548\u679c\u56fe\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b21 \u200b\u53ef\u200b\u52a8\u6001\u200b\u4fee\u6539\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b</p> <p>\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7ba1\u7406\u200b\u5e73\u53f0\u200b\u4e0a\u200b\u901a\u8fc7\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u540d\u5b57\u200b\u627e\u5230\u200b\u6307\u5b9a\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u7136\u540e\u200b\u5bf9\u200b\u5176\u200b\u53c2\u6570\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u540e\u200b\u4f1a\u200b\u5b9e\u65f6\u200b\u751f\u6548\u200b\u3002\u200b\u76ee\u524d\u200b\u652f\u6301\u200b\u7684\u200b\u52a8\u6001\u200b\u53c2\u6570\u200b\u5305\u62ec\u200b\u6838\u5fc3\u200b\u6570\u200b\u3001\u200b\u6700\u5927\u503c\u200b\u3001\u200b\u961f\u5217\u200b\u957f\u5ea6\u200b\u7b49\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u5728\u200b\u754c\u9762\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u8fd8\u200b\u80fd\u200b\u770b\u5230\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u662f\u5426\u200b\u5f00\u542f\u200b\u544a\u8b66\u200b\u3001\u200b\u961f\u5217\u200b\u7b49\u5f85\u200b\u4efb\u52a1\u200b\u544a\u8b66\u200b\u9608\u503c\u200b\u3001\u200b\u6d3b\u8dc3\u5ea6\u200b\u544a\u8b66\u200b\u7b49\u7b49\u200b\u3002\u200b\u5173\u4e8e\u200b\u76d1\u63a7\u200b\u548c\u200b\u544a\u8b66\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0b\u9762\u200b\u4e00\u8282\u200b\u4f1a\u200b\u5bf9\u9f50\u200b\u8fdb\u884c\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u76d1\u63a7\u200b</p> <p>\u200b\u9664\u4e86\u200b\u53c2\u6570\u200b\u52a8\u6001\u5316\u200b\u4e4b\u5916\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u66f4\u597d\u200b\u5730\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5bf9\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u72b6\u51b5\u200b\u6709\u200b\u611f\u77e5\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u662f\u200b\u600e\u4e48\u6837\u200b\u7684\u200b\uff1f\u200b\u5206\u914d\u200b\u7684\u200b\u8d44\u6e90\u200b\u591f\u4e0d\u591f\u200b\u7528\u200b\uff1f\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\u60c5\u51b5\u200b\u662f\u200b\u600e\u4e48\u6837\u200b\u7684\u200b\uff1f\u200b\u662f\u200b\u957f\u200b\u4efb\u52a1\u200b\u8fd8\u662f\u200b\u77ed\u200b\u4efb\u52a1\u200b\uff1f\u200b\u57fa\u4e8e\u200b\u5bf9\u200b\u8fd9\u4e9b\u200b\u95ee\u9898\u200b\u7684\u200b\u601d\u8003\u200b\uff0c\u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u591a\u4e2a\u200b\u7ef4\u5ea6\u200b\u7684\u200b\u76d1\u63a7\u200b\u548c\u200b\u544a\u8b66\u200b\u80fd\u529b\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6d3b\u8dc3\u5ea6\u200b\u3001\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200bTransaction\uff08\u200b\u9891\u7387\u200b\u3001\u200b\u8017\u65f6\u200b\uff09\u3001Reject\u200b\u5f02\u5e38\u200b\u3001\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5185\u90e8\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u7b49\u7b49\u200b\uff0c\u200b\u65e2\u200b\u80fd\u200b\u5e2e\u52a9\u200b\u7528\u6237\u200b\u4ece\u200b\u591a\u4e2a\u200b\u7ef4\u5ea6\u200b\u5206\u6790\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53c8\u200b\u80fd\u200b\u5728\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u7b2c\u4e00\u200b\u65f6\u95f4\u200b\u901a\u77e5\u200b\u5230\u200b\u7528\u6237\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u6545\u969c\u200b\u6216\u200b\u52a0\u901f\u200b\u6545\u969c\u200b\u6062\u590d\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#1","title":"1. \u200b\u8d1f\u8f7d\u200b\u76d1\u63a7\u200b\u548c\u200b\u544a\u8b66","text":"<p>\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8d1f\u8f7d\u200b\u5173\u6ce8\u200b\u7684\u200b\u6838\u5fc3\u200b\u95ee\u9898\u200b\u662f\u200b\uff1a\u200b\u57fa\u4e8e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u5206\u914d\u200b\u7684\u200b\u8d44\u6e90\u200b\u591f\u4e0d\u591f\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4ece\u4e8b\u200b\u524d\u200b\u548c\u200b\u4e8b\u200b\u4e2d\u200b\u4e24\u4e2a\u200b\u89d2\u5ea6\u200b\u6765\u770b\u200b\u3002\u200b\u4e8b\u524d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u201c\u200b\u6d3b\u8dc3\u5ea6\u200b\u201d\u200b\u8fd9\u4e2a\u200b\u6982\u5ff5\u200b\uff0c\u200b\u6765\u200b\u8ba9\u200b\u7528\u6237\u200b\u5728\u200b\u53d1\u751f\u200bReject\u200b\u5f02\u5e38\u200b\u4e4b\u524d\u200b\u80fd\u591f\u200b\u611f\u77e5\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u8d1f\u8f7d\u200b\u95ee\u9898\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6d3b\u8dc3\u5ea6\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u4e3a\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6d3b\u8dc3\u5ea6\u200b = activeCount/maximumPoolSize\u3002\u200b\u8fd9\u4e2a\u200b\u516c\u5f0f\u200b\u4ee3\u8868\u200b\u5f53\u200b\u6d3b\u8dc3\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u8d8b\u5411\u4e8e\u200bmaximumPoolSize\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4ee3\u8868\u200b\u7ebf\u7a0b\u200b\u8d1f\u8f7d\u200b\u8d8b\u9ad8\u200b\u3002\u200b\u4e8b\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4e24\u200b\u65b9\u9762\u200b\u6765\u770b\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fc7\u8f7d\u200b\u5224\u5b9a\u200b\u6761\u4ef6\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u53d1\u751f\u200b\u4e86\u200bReject\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u961f\u5217\u200b\u4e2d\u6709\u200b\u7b49\u5f85\u200b\u4efb\u52a1\u200b\uff08\u200b\u652f\u6301\u200b\u5b9a\u5236\u200b\u9608\u503c\u200b\uff09\u3002\u200b\u4ee5\u4e0a\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\u53d1\u751f\u200b\u4e86\u200b\u90fd\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u544a\u8b66\u200b\uff0c\u200b\u544a\u8b66\u4fe1\u606f\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u5927\u8c61\u200b\u63a8\u9001\u200b\u7ed9\u200b\u670d\u52a1\u200b\u6240\u200b\u5173\u8054\u200b\u7684\u200b\u8d1f\u8d23\u4eba\u200b\u3002</p> <p></p> <p>\u200b\u56fe\u200b22 \u200b\u5927\u8c61\u200b\u544a\u8b66\u200b\u901a\u77e5\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#2","title":"2. \u200b\u4efb\u52a1\u200b\u7ea7\u200b\u7cbe\u7ec6\u5316\u200b\u76d1\u63a7","text":"<p>\u200b\u5728\u200b\u4f20\u7edf\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\u4e2d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u60c5\u51b5\u200b\u5bf9\u4e8e\u200b\u7528\u6237\u200b\u6765\u8bf4\u200b\u662f\u200b\u900f\u660e\u200b\u7684\u200b\u3002\u200b\u6bd4\u5982\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5177\u4f53\u200b\u7684\u200b\u4e1a\u52a1\u200b\u573a\u666f\u200b\u4e2d\u200b\uff0c\u200b\u4e1a\u52a1\u200b\u5f00\u53d1\u200b\u7533\u8bf7\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u540c\u65f6\u200b\u7528\u4e8e\u200b\u6267\u884c\u200b\u4e24\u79cd\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u53d1\u6d88\u606f\u200b\u4efb\u52a1\u200b\u3001\u200b\u4e00\u4e2a\u200b\u662f\u200b\u53d1\u77ed\u4fe1\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u7c7b\u200b\u4efb\u52a1\u200b\u5b9e\u9645\u200b\u6267\u884c\u200b\u7684\u200b\u9891\u7387\u200b\u548c\u200b\u65f6\u957f\u200b\u5bf9\u4e8e\u200b\u7528\u6237\u200b\u6765\u8bf4\u200b\u6ca1\u6709\u200b\u4e00\u4e2a\u200b\u76f4\u89c2\u200b\u7684\u200b\u611f\u53d7\u200b\uff0c\u200b\u5f88\u200b\u53ef\u80fd\u200b\u8fd9\u200b\u4e24\u7c7b\u200b\u4efb\u52a1\u200b\u4e0d\u200b\u9002\u5408\u200b\u5171\u4eab\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u7528\u6237\u200b\u65e0\u6cd5\u200b\u611f\u77e5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u65e0\u4ece\u200b\u4f18\u5316\u200b\u3002\u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4efb\u52a1\u200b\u7ea7\u522b\u200b\u7684\u200b\u57cb\u70b9\u200b\uff0c\u200b\u4e14\u200b\u5141\u8bb8\u200b\u4e3a\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e1a\u52a1\u200b\u4efb\u52a1\u200b\u6307\u5b9a\u200b\u5177\u6709\u200b\u4e1a\u52a1\u200b\u542b\u4e49\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5185\u90e8\u200b\u57fa\u4e8e\u200b\u8fd9\u4e2a\u200b\u540d\u79f0\u200b\u505a\u200bTransaction\u200b\u6253\u70b9\u200b\uff0c\u200b\u57fa\u4e8e\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5185\u90e8\u200b\u4efb\u52a1\u200b\u7ea7\u522b\u200b\u7684\u200b\u6267\u884c\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e14\u200b\u533a\u5206\u200b\u4e1a\u52a1\u200b\uff0c\u200b\u4efb\u52a1\u200b\u76d1\u63a7\u200b\u793a\u610f\u56fe\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b23 \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u76d1\u63a7\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#3","title":"3. \u200b\u8fd0\u884c\u200b\u65f6\u200b\u72b6\u6001\u200b\u5b9e\u65f6\u200b\u67e5\u770b","text":"<p>\u200b\u7528\u6237\u200b\u57fa\u4e8e\u200bJDK\u200b\u539f\u751f\u200b\u7ebf\u7a0b\u200b\u6c60\u200bThreadPoolExecutor\u200b\u63d0\u4f9b\u200b\u7684\u200b\u51e0\u4e2a\u200bpublic\u200b\u7684\u200bgetter\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b\u5230\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u4ee5\u53ca\u200b\u53c2\u6570\u200b\uff0c\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b24 \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5b9e\u65f6\u200b\u8fd0\u884c\u200b\u60c5\u51b5\u200b</p> <p>\u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u57fa\u4e8e\u200b\u8fd9\u200b\u51e0\u4e2a\u200b\u63a5\u53e3\u200b\u5c01\u88c5\u200b\u4e86\u200b\u8fd0\u884c\u200b\u65f6\u200b\u72b6\u6001\u200b\u5b9e\u65f6\u200b\u67e5\u770b\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u7528\u6237\u200b\u57fa\u4e8e\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u53ef\u4ee5\u200b\u4e86\u89e3\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u5b9e\u65f6\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5f53\u524d\u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6267\u884c\u200b\u4e86\u200b\u591a\u5c11\u200b\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u961f\u5217\u200b\u4e2d\u200b\u7b49\u5f85\u200b\u7684\u200b\u4efb\u52a1\u200b\u6570\u200b\u7b49\u7b49\u200b\u3002\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u56fe\u200b25 \u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u5b9e\u65f6\u200b\u8fd0\u884c\u200b\u60c5\u51b5\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#34","title":"3.4 \u200b\u5b9e\u8df5\u200b\u603b\u7ed3","text":"<p>\u200b\u9762\u5bf9\u200b\u4e1a\u52a1\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u9047\u5230\u200b\u7684\u200b\u5b9e\u9645\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u4eec\u200b\u66fe\u200b\u56de\u5230\u200b\u652f\u6301\u200b\u5e76\u53d1\u200b\u6027\u200b\u95ee\u9898\u200b\u672c\u8eab\u200b\u6765\u200b\u601d\u8003\u200b\u6709\u6ca1\u6709\u200b\u53d6\u4ee3\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u4e5f\u200b\u66fe\u200b\u5c1d\u8bd5\u200b\u7740\u200b\u53bb\u200b\u8ffd\u6c42\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u7684\u200b\u5408\u7406\u6027\u200b\uff0c\u200b\u4f46\u200b\u9762\u5bf9\u200b\u4e1a\u754c\u200b\u65b9\u6848\u200b\u5177\u4f53\u200b\u843d\u5730\u200b\u7684\u200b\u590d\u6742\u6027\u200b\u3001\u200b\u53ef\u7ef4\u62a4\u6027\u200b\u4ee5\u53ca\u200b\u771f\u5b9e\u200b\u8fd0\u884c\u200b\u73af\u5883\u200b\u7684\u200b\u4e0d\u786e\u5b9a\u6027\u200b\uff0c\u200b\u6211\u4eec\u200b\u5728\u200b\u524d\u200b\u4e24\u4e2a\u200b\u65b9\u5411\u200b\u4e0a\u200b\u53ef\u8c13\u200b\u201c\u200b\u4e3e\u6b65\u7ef4\u8270\u200b\u201d\u3002\u200b\u6700\u7ec8\u200b\uff0c\u200b\u6211\u4eec\u200b\u56de\u5230\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u52a8\u6001\u5316\u200b\u65b9\u5411\u200b\u4e0a\u200b\u63a2\u7d22\u200b\uff0c\u200b\u5f97\u51fa\u200b\u4e00\u4e2a\u200b\u4e14\u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200b\u4e1a\u52a1\u200b\u95ee\u9898\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u867d\u7136\u200b\u672c\u8d28\u200b\u4e0a\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u9003\u79bb\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7684\u200b\u8303\u7574\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u6210\u672c\u200b\u548c\u200b\u6536\u76ca\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u7b97\u662f\u200b\u53d6\u5f97\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u5e73\u8861\u200b\u3002\u200b\u6210\u672c\u200b\u5728\u4e8e\u200b\u5b9e\u73b0\u200b\u52a8\u6001\u5316\u200b\u4ee5\u53ca\u200b\u76d1\u63a7\u200b\u6210\u672c\u200b\u4e0d\u9ad8\u200b\uff0c\u200b\u6536\u76ca\u200b\u5728\u4e8e\u200b\uff1a\u200b\u5728\u200b\u4e0d\u200b\u98a0\u8986\u200b\u539f\u6709\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u4f7f\u7528\u200b\u65b9\u5f0f\u200b\u7684\u200b\u57fa\u7840\u200b\u4e4b\u4e0a\u200b\uff0c\u200b\u4ece\u200b\u964d\u4f4e\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u53c2\u6570\u200b\u4fee\u6539\u200b\u7684\u200b\u6210\u672c\u200b\u4ee5\u53ca\u200b\u591a\u7ef4\u5ea6\u200b\u76d1\u63a7\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u65b9\u9762\u200b\u964d\u4f4e\u200b\u4e86\u200b\u6545\u969c\u200b\u53d1\u751f\u200b\u7684\u200b\u6982\u7387\u200b\u3002\u200b\u5e0c\u671b\u200b\u672c\u6587\u200b\u63d0\u4f9b\u200b\u7684\u200b\u52a8\u6001\u5316\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u601d\u8def\u200b\u80fd\u200b\u5bf9\u200b\u5927\u5bb6\u200b\u6709\u200b\u5e2e\u52a9\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/#_4","title":"\u56db\u200b\u3001\u200b\u53c2\u8003\u8d44\u6599","text":"<ul> <li>[1] JDK 1.8\u200b\u6e90\u7801\u200b</li> <li>[2] \u200b\u7ef4\u57fa\u767e\u79d1\u200b-\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> <li>[3] \u200b\u66f4\u597d\u200b\u7684\u200b\u4f7f\u7528\u200bJava\u200b\u7ebf\u7a0b\u200b\u6c60\u200b</li> <li>[4] \u200b\u7ef4\u57fa\u767e\u79d1\u200bPooling(Resource Management)</li> <li>[5] \u200b\u6df1\u5165\u200b\u7406\u89e3\u200bJava\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff1aThreadPoolExecutor</li> <li>[6]\u300aJava\u200b\u5e76\u53d1\u200b\u7f16\u7a0b\u200b\u5b9e\u8df5\u200b\u300b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/","title":"ThreadLocal","text":"<p> \u200b\u7ea6\u200b 1859 \u200b\u4e2a\u200b\u5b57\u200b  163 \u200b\u884c\u200b\u4ee3\u7801\u200b  4 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 8 \u200b\u5206\u949f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#1","title":"1. \u200b\u7b80\u4ecb","text":"<p>ThreadLocal\u200b\u63d0\u4f9b\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u53d8\u91cf\u200b\u4e0e\u200b\u6b63\u5e38\u200b\u7684\u200b\u53d8\u91cf\u200b\u4e0d\u540c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u8bbf\u95ee\u200bThreadLocal\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u65f6\u5019\u200b\uff08\u200b\u901a\u8fc7\u200b\u5176\u200bget\u200b\u6216\u200bset\u200b\u65b9\u6cd5\u200b\uff09\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u3001\u200b\u72ec\u7acb\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u53d8\u91cf\u200b\u526f\u672c\u200b\u3002ThreadLocal\u200b\u5b9e\u4f8b\u200b\u901a\u5e38\u200b\u662f\u200b\u7c7b\u200b\u4e2d\u200b\u7684\u200b\u79c1\u6709\u200b\u9759\u6001\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u5e0c\u671b\u200b\u5c06\u200b\u72b6\u6001\u200b\uff08\u200b\u4f8b\u5982\u200b\uff0c\u200b\u7528\u6237\u200bID\u200b\u6216\u4e8b\u7269\u200bID\uff09\u200b\u4e0e\u200b\u7ebf\u7a0b\u200b\u5173\u8054\u200b\u8d77\u6765\u200b\u3002</p> <p>ThreadLocal\u200b\u5b9e\u73b0\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u4e13\u5c5e\u200b\u7684\u200b\u672c\u5730\u200b\u53d8\u91cf\u200b\u526f\u672c\u200b\uff08\u200b\u81ea\u5df1\u200b\u7528\u200b\u81ea\u5df1\u200b\u7684\u200b\u53d8\u91cf\u200b\u4e0d\u7528\u200b\u9ebb\u70e6\u200b\u522b\u4eba\u200b\uff0c\u200b\u4e0d\u200b\u548c\u200b\u5176\u4ed6\u4eba\u200b\u5171\u4eab\u200b\uff0c\u200b\u4eba\u4eba\u200b\u6709\u200b\u4efd\u200b\uff0c\u200b\u4eba\u200b\u5404\u200b\u4e00\u4efd\u200b\uff09\u3002\u200b\u4e3b\u8981\u200b\u89e3\u51b3\u200b\u4e86\u200b\u8ba9\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u7ed1\u5b9a\u200b\u81ea\u5df1\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200bget()\u200b\u548c\u200bset()\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u83b7\u53d6\u200b\u9ed8\u8ba4\u503c\u200b\u6216\u200b\u5c06\u200b\u5176\u200b\u6539\u4e3a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6240\u5b58\u200b\u7684\u200b\u526f\u672c\u200b\u7684\u200b\u503c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#2-api","title":"2. API","text":"<p>ThreadLocal - Java17\u200b\u4e2d\u6587\u200b\u6587\u6863\u200b - API\u200b\u53c2\u8003\u200b\u6587\u6863\u200b - \u200b\u5168\u6808\u200b\u884c\u52a8\u200b\u6d3e\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#3","title":"3. \u200b\u4f7f\u7528\u200b\u6848\u4f8b","text":"<p>\u200b\u9700\u6c42\u200b\uff1a\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u9500\u552e\u200b\u81ea\u5df1\u200b\u552e\u5356\u200b\u623f\u5b50\u200b\uff0c\u200b\u6700\u540e\u200b\u7edf\u4e00\u200b\u6c47\u603b\u200b</p> Java<pre><code>@Slf4j(topic = \"c.ThreadLocalTest1\")\npublic class ThreadLocalTest1 {\n\n    public static void main(String[] args) throws InterruptedException {\n        threadNew();\n    }\n\n    private static void threadNew() throws InterruptedException {\n        House house = new House();\n        AtomicInteger cnt = new AtomicInteger();\n        for (int i = 0; i &lt; 5; i++) {\n            new Thread(() -&gt; {\n                try {\n                    for (int j = 0; j &lt; 5; j++) {\n                        house.sale();\n                    }\n                    log.debug(\"{}\u200b\u5356\u51fa\u200b{}\u200b\u5957\u200b\u623f\u5b50\u200b\", Thread.currentThread().getName(), house.saleCount.get());\n                    cnt.addAndGet(house.saleCount.get());\n                } finally {\n                    house.saleCount.remove();\n                }\n            }, \"t\" + i).start();\n        }\n\n        TimeUnit.SECONDS.sleep(1);\n        log.debug(\"\u200b\u5171\u8ba1\u200b\u5356\u51fa\u200b{}\u200b\u5957\u200b\u623f\u5b50\u200b\", cnt.get());\n    }\n}\n\nclass House {\n    ThreadLocal&lt;Integer&gt; saleCount = ThreadLocal.withInitial(() -&gt; 0);\n\n    public void sale() {\n        saleCount.set(saleCount.get() + 1);\n    }\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b <code>try-finally</code> \u200b\u5728\u200b <code>finally</code> \u200b\u5757\u200b\u4e2d\u200b\u91ca\u653e\u200b\u6389\u200b\u7ebf\u7a0b\u200b\u53d8\u91cf\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u548c\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</p> <p>\u200b\u4ee3\u7801\u200b\u6f14\u793a\u200b\u5982\u4e0b\u200b:</p> Java<pre><code>@Slf4j(topic = \"c.ThreadLocalTest1\")\npublic class ThreadLocalTest1 {\n\n    public static void main(String[] args) throws InterruptedException {\n        threadPool();\n    }\n\n    private static void threadPool() throws InterruptedException {\n        ExecutorService executor = Executors.newFixedThreadPool(3);\n        House house = new House();\n        AtomicInteger cnt = new AtomicInteger();\n        for (int i = 0; i &lt; 5; i++) {\n            executor.submit(() -&gt; {\n                // \u200b\u6bcf\u4eba\u200b\u5356\u200b 5 \u200b\u5957\u200b\n                for (int j = 0; j &lt; 5; j++) {\n                    house.sale();\n                }\n                log.debug(\"{}\u200b\u5356\u51fa\u200b{}\u200b\u5957\u200b\u623f\u5b50\u200b\", Thread.currentThread().getName(), house.saleCount.get());\n                cnt.addAndGet(house.saleCount.get());\n                // \u200b\u53bb\u6389\u200b try-finally \u200b\u6f14\u793a\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u95ee\u9898\u200b\n            });\n        }\n\n        TimeUnit.SECONDS.sleep(1);\n        log.debug(\"\u200b\u5171\u8ba1\u200b\u5356\u51fa\u200b{}\u200b\u5957\u200b\u623f\u5b50\u200b\", cnt.get());\n        executor.shutdown();\n    }\n}\n\nclass House {\n    ThreadLocal&lt;Integer&gt; saleCount = ThreadLocal.withInitial(() -&gt; 0);\n\n    public void sale() {\n        saleCount.set(saleCount.get() + 1);\n    }\n}\n</code></pre> <p>\u200b\u7ed3\u679c\u200b: \u200b\u53d1\u751f\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</p> Bash<pre><code>14:31:27.723 c.ThreadLocalTest1 [main] - ===============================\n14:31:27.727 c.ThreadLocalTest1 [pool-1-thread-1] - pool-1-thread-1\u200b\u5356\u51fa\u200b5\u200b\u5957\u200b\u623f\u5b50\u200b\n14:31:27.727 c.ThreadLocalTest1 [pool-1-thread-2] - pool-1-thread-2\u200b\u5356\u51fa\u200b5\u200b\u5957\u200b\u623f\u5b50\u200b\n14:31:27.727 c.ThreadLocalTest1 [pool-1-thread-3] - pool-1-thread-3\u200b\u5356\u51fa\u200b5\u200b\u5957\u200b\u623f\u5b50\u200b\n14:31:27.727 c.ThreadLocalTest1 [pool-1-thread-2] - pool-1-thread-2\u200b\u5356\u51fa\u200b10\u200b\u5957\u200b\u623f\u5b50\u200b\n14:31:27.727 c.ThreadLocalTest1 [pool-1-thread-1] - pool-1-thread-1\u200b\u5356\u51fa\u200b10\u200b\u5957\u200b\u623f\u5b50\u200b\n14:31:28.729 c.ThreadLocalTest1 [main] - \u200b\u5171\u8ba1\u200b\u5356\u51fa\u200b35\u200b\u5957\u200b\u623f\u5b50\u200b\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#4","title":"4. \u200b\u6e90\u7801\u200b\u5206\u6790","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#41","title":"4.1 \u200b\u7c7b\u200b\u4e0e\u200b\u7c7b\u200b\u7684\u200b\u5173\u7cfb","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b\uff1a <code>java.lang.Thread</code></p> Java<pre><code>public class Thread implements Runnable {\n    ...\n    /* ThreadLocal values pertaining to this thread. This map is maintained\n     * by the ThreadLocal class. */\n    ThreadLocal.ThreadLocalMap threadLocals = null;\n    ...\n}\n</code></pre> <p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b: <code>java.lang.ThreadLocal.ThreadLocalMap</code></p> Java<pre><code> static class ThreadLocalMap {\n    /**\n     * The entries in this hash map extend WeakReference, using\n     * its main ref field as the key (which is always a\n     * ThreadLocal object).  Note that null keys (i.e. entry.get()\n     * == null) mean that the key is no longer referenced, so the\n     * entry can be expunged from table.  Such entries are referred to\n     * as \"stale entries\" in the code that follows.\n     */\n    static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; {\n        /** The value associated with this ThreadLocal. */\n        Object value;\n\n        Entry(ThreadLocal&lt;?&gt; k, Object v) {\n            super(k);\n            value = v;\n        }\n    }\n    ...\n}\n</code></pre> <p>\u200b\u5173\u7cfb\u200b\u56fe\u200b\u5982\u4e0b\u200b\uff1a </p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#42-get","title":"4.2 get","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b: <code>java.lang.ThreadLocal#get</code></p> Java<pre><code>public T get() {\n    Thread t = Thread.currentThread();  // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n    ThreadLocalMap map = getMap(t);     // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b ThreadLocalMap\n    if (map != null) {\n        ThreadLocalMap.Entry e = map.getEntry(this); // \u200b\u67e5\u627e\u200b\u5f53\u524d\u200b ThreadLocal \u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\n        if (e != null) {\n            @SuppressWarnings(\"unchecked\")\n            T result = (T)e.value;\n            return result;  // \u200b\u5982\u679c\u200b\u627e\u5230\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5b58\u50a8\u200b\u7684\u200b\u503c\u200b\n        }\n    }\n    return setInitialValue();  // \u200b\u5982\u679c\u200b\u672a\u627e\u5230\u200b\uff0c\u200b\u5219\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u9ed8\u8ba4\u503c\u200b\n}\n</code></pre> <ol> <li>\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u56e0\u4e3a\u200b ThreadLocal \u200b\u53d8\u91cf\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u9694\u79bb\u200b\u7684\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u7ef4\u62a4\u200b\u81ea\u5df1\u200b\u7684\u200b ThreadLocalMap\u3002</li> <li>\u200b\u67e5\u627e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b ThreadLocalMap\uff0c\u200b\u8be5\u200b map \u200b\u5b58\u50a8\u200b\u4e86\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6240\u6709\u200b\u7684\u200b ThreadLocal \u200b\u53d8\u91cf\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b map \u200b\u4e3a\u7a7a\u200b\u6216\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u8be5\u200b ThreadLocal \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8c03\u7528\u200b setInitialValue() \u200b\u8fdb\u884c\u200b\u521d\u59cb\u5316\u200b\u3002</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#43-set","title":"4.3 set","text":"<p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b: <code>java.lang.ThreadLocal#set</code></p> Java<pre><code>public void set(T value) {\n    Thread t = Thread.currentThread();  // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\n    ThreadLocalMap map = getMap(t);     // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b ThreadLocalMap\n    if (map != null) {\n        map.set(this, value);  // \u200b\u5982\u679c\u200b ThreadLocalMap \u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u8bbe\u7f6e\u200b\u503c\u200b\n    } else {\n        createMap(t, value);   // \u200b\u5982\u679c\u200b ThreadLocalMap \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b map \u200b\u5e76\u200b\u5b58\u5165\u200b\u503c\u200b\n    }\n}\n</code></pre> <ol> <li>\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u786e\u4fdd\u200b\u6570\u636e\u200b\u4ec5\u200b\u5b58\u50a8\u200b\u5728\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\u3002</li> <li> <p>\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b ThreadLocalMap\uff1a</p> <ul> <li> <p>\u200b\u5982\u679c\u200b map \u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u5c06\u200b value \u200b\u5b58\u5165\u200b\u3002</p> </li> <li> <p>\u200b\u5982\u679c\u200b map \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c1a\u672a\u200b\u5b58\u50a8\u200b\u4efb\u4f55\u200b ThreadLocal \u200b\u53d8\u91cf\u200b\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b createMap() \u200b\u521b\u5efa\u200b\u5e76\u200b\u5b58\u5165\u200b\u503c\u200b\u3002</p> </li> </ul> </li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#44","title":"4.4 \u200b\u603b\u7ed3","text":"<ul> <li>ThreadLocal \u200b\u662f\u200b\u4e00\u4e2a\u200b\u58f3\u5b50\u200b\uff0c\u200b\u771f\u6b63\u200b\u7684\u200b\u5b58\u50a8\u200b\u7ed3\u6784\u200b\u662f\u200b ThreadLocal \u200b\u91cc\u200b\u7684\u200b ThreadLocalMap (\u200b\u9759\u6001\u200b\u5185\u90e8\u200b\u7c7b\u200b\uff0c\u200b\u7528\u200b Entry \u200b\u5b58\u50a8\u200b)\uff0c\u200b\u6bcf\u4e2a\u200b Thread \u200b\u5bf9\u8c61\u200b\u7ef4\u62a4\u200b\u7740\u200b\u4e00\u4e2a\u200b ThreadLocalMap \u200b\u7684\u200b\u5f15\u7528\u200b\u3002</li> <li>\u200b\u5f53\u200b\u8c03\u7528\u200b <code>ThreadLocal.set()</code> \u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u5f80\u200b ThreadLocalMap \u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u503c\u200b\uff0ckey \u200b\u662f\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u503c\u200b Value \u200b\u662f\u200b\u4f20\u9012\u200b\u8fdb\u6765\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002</li> <li>\u200b\u5f53\u200b\u8c03\u7528\u200b <code>ThreadLocal.get()</code> \u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u5f80\u200b ThreadLocalMap \u200b\u4e2d\u200b\u83b7\u53d6\u200b\u503c\u200b\uff0ckey \u200b\u662f\u200b ThreadLocal \u200b\u5bf9\u8c61\u200b</li> <li>ThreadLocal \u200b\u672c\u8eab\u200b\u5e76\u200b\u4e0d\u200b\u5b58\u50a8\u200b\u503c\u200b\uff0c\u200b\u5b83\u200b\u53ea\u662f\u200b\u5c06\u200b\u81ea\u5df1\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b key \u200b\u6765\u200b\u8ba9\u200b\u7ebf\u7a0b\u200b\u4ece\u200b ThreadLocalMap \u200b\u83b7\u53d6\u200b Value</li> </ul> <p>\u200b\u6b63\u662f\u200b\u56e0\u4e3a\u200b\u4e0a\u8ff0\u200b\u539f\u7406\u200b\uff0c\u200b\u6240\u4ee5\u200b ThreadLocal \u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b \u201c\u200b\u6570\u636e\u200b\u9694\u79bb\u200b\u201d \uff0c\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u503c\u200b\uff0c\u200b\u800c\u200b\u4e0d\u53d7\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5f71\u54cd\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#5-threadlocal","title":"5. ThreadLocal \u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u95ee\u9898","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#51","title":"5.1 \u200b\u4ec0\u4e48\u200b\u662f\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\uff1f","text":"<p>\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\uff08Memory Leak\uff09\uff1a\u200b\u662f\u200b\u6307\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u5df2\u200b\u52a8\u6001\u5206\u914d\u200b\u7684\u200b\u5806\u200b\u5185\u5b58\u200b\u7531\u4e8e\u200b\u67d0\u79cd\u539f\u56e0\u200b\u7a0b\u5e8f\u200b\u672a\u200b\u91ca\u653e\u200b\u6216\u200b\u65e0\u6cd5\u200b\u91ca\u653e\u200b\uff0c\u200b\u9020\u6210\u200b\u7cfb\u7edf\u200b\u5185\u5b58\u200b\u7684\u200b\u6d6a\u8d39\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7a0b\u5e8f\u8fd0\u884c\u200b\u901f\u5ea6\u200b\u51cf\u6162\u200b\u751a\u81f3\u200b\u7cfb\u7edf\u200b\u5d29\u6e83\u200b\u7b49\u200b\u4e25\u91cd\u540e\u679c\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#52","title":"5.2 \u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\uff1f","text":"<p>\u200b\u60c5\u51b5\u200b\u4e00\u200b\uff1a\u200b\u4e3b\u7ebf\u200b\u7a0b\u548c\u77ed\u200b\u751f\u547d\u5468\u671f\u200b\u7ebf\u7a0b\u200b\uff1a</p> <ul> <li>\u200b\u5bf9\u4e8e\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u6216\u200b\u4e34\u65f6\u200b\u521b\u5efa\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u7ed3\u675f\u200b\u540e\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6240\u6709\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5305\u62ec\u200b <code>ThreadLocalMap</code>\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u6240\u4ee5\u200b\u901a\u5e38\u200b\u4e0d\u4f1a\u200b\u9020\u6210\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b</li> </ul> <p>\u200b\u60c5\u51b5\u200b\u4e8c\u200b\uff1a\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u957f\u671f\u5b58\u5728\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u56e0\u4e3a\u200b\u4efb\u52a1\u200b\u7ed3\u675f\u200b\u800c\u200b\u88ab\u200b\u56de\u6536\u200b\u3002\u200b\u5982\u679c\u200b\u5728\u200b\u4efb\u52a1\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u4e86\u200b <code>ThreadLocal</code>\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u6e05\u7406\u200b\uff08\u200b\u8c03\u7528\u200b <code>remove()</code>\uff09\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u503c\u4f1a\u200b\u4e00\u76f4\u200b\u4fdd\u7559\u200b\u5728\u200b <code>ThreadLocalMap</code> \u200b\u4e2d\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u3002</li> </ul> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7279\u522b\u200b\u5bb9\u6613\u200b\u51fa\u73b0\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\uff1f</p> <ol> <li> <p>\u200b\u7ebf\u7a0b\u200b\u91cd\u7528\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u968f\u7740\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\u800c\u200b\u9500\u6bc1\u200b\uff0c <code>ThreadLocalMap</code> \u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u81ea\u52a8\u200b\u6e05\u7a7a\u200b\u3002</li> </ul> </li> <li> <p>\u200b\u5f31\u200b\u5f15\u7528\u200b\u7684\u200b\u4f5c\u7528\u200b\u6709\u9650\u200b\uff1a</p> <ul> <li><code>ThreadLocal</code> \u200b\u5728\u200b <code>ThreadLocalMap</code> \u200b\u4e2d\u662f\u200b\u5f31\u200b\u5f15\u7528\u200b\uff0c\u200b\u4f46\u200b\u5176\u503c\u200b\uff08<code>value</code>\uff09\u200b\u662f\u200b\u5f3a\u200b\u5f15\u7528\u200b\u3002\u200b\u5373\u4f7f\u200b <code>ThreadLocal</code> \u200b\u88ab\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c<code>ThreadLocalMap</code> \u200b\u7684\u200b\u6761\u76ee\u200b\u4e0d\u4f1a\u200b\u7acb\u5373\u200b\u6e05\u9664\u200b\uff0c\u200b\u5176\u200b <code>value</code> \u200b\u4ecd\u7136\u200b\u5360\u7528\u200b\u5185\u5b58\u200b\u3002</li> </ul> </li> <li> <p>\u200b\u4efb\u52a1\u200b\u903b\u8f91\u200b\u590d\u6742\u6027\u200b\uff1a</p> <ul> <li>\u200b\u591a\u7ebf\u7a0b\u200b\u4efb\u52a1\u200b\u903b\u8f91\u200b\u590d\u6742\u200b\uff0c\u200b\u5bb9\u6613\u200b\u5fd8\u8bb0\u200b\u6e05\u7406\u200b <code>ThreadLocal</code> \u200b\u503c\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4f7f\u7528\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200bThreadLocal\u200b\u503c\u200b\u3002</li> </ul> </li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#52_1","title":"5.2 \u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u7528\u200b\u5f31\u200b\u5f15\u7528\u200b\uff1f\u200b\u4e0d\u7528\u200b\u5982\u4f55\u200b\uff1f","text":"<p>\u200b\u5f31\u200b\u5f15\u7528\u200b\uff1a\u200b\u5bf9\u4e8e\u200b\u53ea\u6709\u200b\u5f31\u200b\u5f15\u7528\u200b\u7684\u200b\u5bf9\u8c61\u200b\u800c\u8a00\u200b\uff0c\u200b\u53ea\u8981\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u673a\u5236\u200b\u4e00\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4e0d\u7ba1\u200bJVM\u200b\u7684\u200b\u5185\u5b58\u7a7a\u95f4\u200b\u662f\u5426\u200b\u8db3\u591f\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u56de\u6536\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u5360\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u3002</p> <p></p> <ol> <li> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u7528\u200b\u5f31\u200b\u5f15\u7528\u200b\uff1a</p> <ul> <li>\u200b\u5f53\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u540e\u200b\uff0c\u200b\u6808\u5e27\u200b\u9500\u6bc1\u200b\uff0c\u200b\u5f3a\u200b\u5f15\u7528\u200bt1\u200b\u4e5f\u200b\u5c31\u200b\u6ca1\u6709\u200b\u4e86\u200b\uff0c\u200b\u4f46\u200b\u6b64\u65f6\u200b\u7ebf\u7a0b\u200b\u7684\u200bThreadLocalMap\u200b\u91cc\u200b\u67d0\u4e2a\u200bentry\u200b\u7684\u200bKey\u200b\u5f15\u7528\u200b\u8fd8\u200b\u6307\u5411\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u82e5\u200b\u8fd9\u4e2a\u200bKey\u200b\u662f\u200b\u5f3a\u200b\u5f15\u7528\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200bKey\u200b\u6307\u5411\u200b\u7684\u200bThreadLocal\u200b\u5bf9\u8c61\u200b\u4e0d\u80fd\u200b\u88ab\u200bgc\u200b\u56de\u6536\u200b\uff0c\u200b\u9020\u6210\u200b\u5185\u5b58\u200b\u6cc4\u9732\u200b</li> <li>\u200b\u82e5\u200b\u8fd9\u4e2a\u200b\u5f15\u7528\u200b\u65f6\u5f31\u200b\u5f15\u7528\u200b\u5c31\u200b\u5927\u200b\u6982\u7387\u200b\u4f1a\u200b\u51cf\u5c11\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u95ee\u9898\u200b\uff08\u200b\u5f53\u7136\u200b\uff0c\u200b\u8fd8\u200b\u5f97\u200b\u8003\u8651\u200bkey\u200b\u4e3a\u200bnull\u200b\u8fd9\u4e2a\u200b\u5751\u200b\uff09\uff0c\u200b\u4f7f\u7528\u200b\u5f31\u200b\u5f15\u7528\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4f7f\u200bThreadLocal\u200b\u5bf9\u8c61\u200b\u5728\u200b\u65b9\u6cd5\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u540e\u200b\u987a\u5229\u200b\u88ab\u200b\u56de\u6536\u200b\u4e14\u200bentry\u200b\u7684\u200bkey\u200b\u5f15\u7528\u200b\u6307\u5411\u200b\u4e3a\u200bnull</li> </ul> </li> <li> <p>\u200b\u8fd9\u91cc\u200b\u6709\u4e2a\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a</p> <ul> <li>ThreadLocalMap\u200b\u4f7f\u7528\u200bThreadLocal\u200b\u7684\u200b\u5f31\u200b\u5f15\u7528\u200b\u4f5c\u4e3a\u200bKey\uff0c\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200bThreadLocal\u200b\u6ca1\u6709\u200b\u5916\u90e8\u200b\u5f3a\u200b\u5f15\u7528\u200b\u5f15\u7528\u200b\u4ed6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7cfb\u7edf\u200bgc\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u4e2a\u200bThreadLocal\u200b\u52bf\u5fc5\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u8fd9\u6837\u4e00\u6765\u200b\uff0cThreadLocalMap\u200b\u4e2d\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200bKey\u200b\u4e3a\u200bnull\u200b\u7684\u200bEntry\uff0c\u200b\u5c31\u200b\u6ca1\u6709\u200b\u529e\u6cd5\u200b\u8bbf\u95ee\u200b\u8fd9\u4e9b\u200bKey\u200b\u4e3a\u200bnull\u200b\u7684\u200bEntry\u200b\u7684\u200bvalue\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8fdf\u8fdf\u200b\u4e0d\u200b\u7ed3\u675f\u200b\u7684\u8bdd\u200b\uff08\u200b\u597d\u6bd4\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\uff09\uff0c\u200b\u8fd9\u4e9b\u200bkey\u200b\u4e3a\u200bnull\u200b\u7684\u200bEntry\u200b\u7684\u200bvalue\u200b\u5c31\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u5b58\u5728\u200b\u4e00\u6761\u200b\u5f3a\u200b\u5f15\u7528\u200b\u94fe\u200b</li> <li>\u200b\u867d\u7136\u200b\u5f31\u200b\u5f15\u7528\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200bKey\u200b\u6307\u5411\u200b\u7684\u200bThreadLocal\u200b\u5bf9\u8c61\u200b\u80fd\u591f\u200b\u88ab\u200b\u53ca\u65f6\u200b\u56de\u6536\u200b\uff0c\u200b\u4f46\u662f\u200bv\u200b\u6307\u5411\u200b\u7684\u200bvalue\u200b\u5bf9\u8c61\u200b\u662f\u200b\u9700\u8981\u200bThreadLocalMap\u200b\u8c03\u7528\u200bget\u3001set\u200b\u65f6\u200b\u53d1\u73b0\u200bkey\u200b\u4e3a\u200bnull\u200b\u65f6\u624d\u200b\u4f1a\u200b\u53bb\u200b\u56de\u6536\u200b\u6574\u4e2a\u200bentry\u3001value\uff0c\u200b\u56e0\u6b64\u200b\u5f31\u200b\u5f15\u7528\u200b\u4e0d\u80fd\u200b100%\u200b\u4fdd\u8bc1\u200b\u5185\u5b58\u200b\u4e0d\u200b\u6cc4\u9732\u200b\uff0c\u200b\u6211\u4eec\u200b\u8981\u200b\u5728\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u67d0\u4e2a\u200bThreadLocal\u200b\u5bf9\u8c61\u200b\u540e\u200b\uff0c\u200b\u624b\u52a8\u200b\u8c03\u7528\u200bremove\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5220\u9664\u200b\u5b83\u200b\uff0c\u200b\u5c24\u5176\u200b\u662f\u200b\u5728\u7ebf\u200b\u7a0b\u6c60\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u4ec5\u4ec5\u200b\u662f\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u91cd\u590d\u4f7f\u7528\u200b\u7684\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200bThreadLocalMap\u200b\u5bf9\u8c61\u200b\u4e5f\u200b\u662f\u200b\u91cd\u590d\u4f7f\u7528\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u4e0d\u200b\u624b\u52a8\u200b\u8c03\u7528\u200bremove\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u540e\u9762\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u6709\u200b\u53ef\u80fd\u200b\u83b7\u53d6\u200b\u5230\u200b\u4e0a\u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u9057\u7559\u4e0b\u6765\u200b\u7684\u200bvalue\u200b\u503c\u200b\uff0c\u200b\u9020\u6210\u200bbug\u3002</li> </ul> </li> <li> <p>\u200b\u6e05\u9664\u200b\u810f\u200bEntry----key\u200b\u4e3a\u200bnull\u200b\u7684\u200bentry</p> </li> </ol> <p>ThreadLocal \u200b\u7684\u200b get, set, remove \u200b\u65b9\u6cd5\u200b\u6700\u7ec8\u200b\u90fd\u200b\u4f1a\u200b\u8c03\u7528\u200b expungeStaleEntry \u200b\u65b9\u6cd5\u200b\u6e05\u9664\u200b\u810f\u200b Entry</p> <p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b: <code>java.lang.ThreadLocal.ThreadLocalMap#expungeStaleEntry</code></p> <p>\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4e3b\u8981\u200b\u529f\u80fd\u200b\u662f\u200b\u6e05\u9664\u200b ThreadLocalMap \u200b\u4e2d\u200b\u7684\u200b\u5931\u6548\u200b\u6761\u76ee\u200b\uff08stale entry\uff09\uff0c\u200b\u540c\u65f6\u200b\u91cd\u65b0\u200b\u54c8\u5e0c\u200b\u51b2\u7a81\u200b\u7684\u200b\u952e\u503c\u200b\u5bf9\u200b\uff0c\u200b\u907f\u514d\u200b\u54c8\u5e0c\u200b\u8868\u200b\u7ed3\u6784\u200b\u6df7\u4e71\u200b</p> Java<pre><code>private int expungeStaleEntry(int staleSlot) {\n    Entry[] tab = table;\n    int len = tab.length;\n\n    // expunge entry at staleSlot\n    tab[staleSlot].value = null;\n    tab[staleSlot] = null;\n    size--;\n\n    // Rehash until we encounter null\n    Entry e;\n    int i;\n    for (i = nextIndex(staleSlot, len);\n         (e = tab[i]) != null;\n         i = nextIndex(i, len)) {\n        ThreadLocal&lt;?&gt; k = e.get();\n        if (k == null) {\n            e.value = null;\n            tab[i] = null;\n            size--;\n        } else {\n            int h = k.threadLocalHashCode &amp; (len - 1);\n            if (h != i) {\n                tab[i] = null;\n\n                // Unlike Knuth 6.4 Algorithm R, we must scan until\n                // null because multiple entries could have been stale.\n                while (tab[h] != null)\n                    h = nextIndex(h, len);\n                tab[h] = e;\n            }\n        }\n    }\n    return i;\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#6","title":"6. \u200b\u6700\u4f73\u200b\u5b9e\u8df5","text":"<ul> <li>ThreadLocal\u200b\u4e00\u5b9a\u200b\u8981\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u907f\u514d\u200b\u7a7a\u200b\u6307\u9488\u200b\u5f02\u5e38\u200b\u3002</li> <li>\u200b\u5efa\u8bae\u200b\u628a\u200bThreadLocal\u200b\u4fee\u9970\u200b\u4e3a\u200bstatic</li> <li>\u200b\u7528\u200b\u5b8c\u200b\u8bb0\u5f97\u200b\u624b\u52a8\u200bremove</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/#7","title":"7. \u200b\u603b\u7ed3","text":"<ul> <li>ThreadLocal\u200b\u5e76\u200b\u4e0d\u200b\u89e3\u51b3\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>ThreadLocal\u200b\u9002\u7528\u200b\u4e8e\u200b\u53d8\u91cf\u200b\u5728\u7ebf\u200b\u7a0b\u95f4\u200b\u9694\u79bb\u200b\u4e14\u200b\u5728\u200b\u65b9\u6cd5\u200b\u95f4\u200b\u5171\u4eab\u200b\u7684\u200b\u573a\u666f\u200b</li> <li>ThreadLocal\u200b\u901a\u8fc7\u200b\u9690\u5f0f\u200b\u7684\u200b\u5728\u200b\u4e0d\u540c\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u521b\u5efa\u200b\u72ec\u7acb\u200b\u5b9e\u4f8b\u200b\u526f\u672c\u200b\u907f\u514d\u200b\u4e86\u200b\u5b9e\u4f8b\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u4e00\u4e2a\u200b\u53ea\u200b\u5c5e\u4e8e\u200b\u5b83\u200b\u81ea\u5df1\u200b\u7684\u200b\u4e13\u5c5e\u200bmap\u200b\u5e76\u200b\u7ef4\u62a4\u200b\u4e86\u200bThreadLocal\u200b\u5bf9\u8c61\u200b\u4e0e\u200b\u5177\u4f53\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u8be5\u200bMap\u200b\u7531\u4e8e\u200b\u53ea\u200b\u88ab\u200b\u6301\u6709\u200b\u4ed6\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u6545\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u4ee5\u53ca\u200b\u9501\u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>ThreadLocalMap\u200b\u7684\u200bEntry\u200b\u5bf9\u200bThreadLocal\u200b\u7684\u200b\u5f15\u7528\u200b\u4e3a\u5f31\u200b\u5f15\u7528\u200b\u3002\u200b\u907f\u514d\u200b\u4e86\u200bThreadLocal\u200b\u5bf9\u8c61\u200b\u65e0\u6cd5\u200b\u88ab\u200b\u56de\u6536\u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>\u200b\u90fd\u200b\u4f1a\u200b\u901a\u8fc7\u200bexpungeStaleEntry\uff0ccleanSomeSlots\uff0creplaceStaleEntry\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u65b9\u6cd5\u200b\u56de\u6536\u200b\u952e\u4e3a\u200bnull\u200b\u7684\u200bEntry\u200b\u5bf9\u8c61\u200b\u7684\u200b\u503c\u200b\uff08\u200b\u5373\u200b\u4e3a\u200b\u5177\u4f53\u200b\u5b9e\u4f8b\u200b\uff09\u200b\u4ee5\u53ca\u200bentry\u200b\u5bf9\u8c61\u200b\u672c\u8eab\u200b\u4ece\u800c\u200b\u9632\u6b62\u200b\u5185\u5b58\u200b\u6cc4\u6f0f\u200b\uff0c\u200b\u5c5e\u4e8e\u200b\u5b89\u5168\u200b\u52a0\u56fa\u200b\u7684\u200b\u65b9\u6cd5\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/","title":"Volatile\u200b\u4e0e\u200b\u6307\u4ee4\u200b\u91cd\u6392","text":"<p> \u200b\u7ea6\u200b 3652 \u200b\u4e2a\u200b\u5b57\u200b  121 \u200b\u884c\u200b\u4ee3\u7801\u200b  5 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 14 \u200b\u5206\u949f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#1","title":"1. \u200b\u5f15\u5165","text":"Java<pre><code>public class VolatileTest {\n    static boolean flag = false;\n\n    public static void main(String[] args) {\n        new Thread(() -&gt; {\n            while (!flag) {\n            }\n            log.debug(\"\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\");\n        }).start();\n\n        Thread.sleep(1000);\n        log.debug(\"\u200b\u4fee\u6539\u200b flag\");\n        flag = true;\n    }\n}\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u5f88\u200b\u597d\u200b\u7406\u89e3\u200b\uff0c <code>main</code> \u200b\u51fd\u6570\u200b\u91cc\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5176\u200b <code>run</code> \u200b\u65b9\u6cd5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4ee5\u200b flag \u200b\u4e3a\u200b\u6807\u5fd7\u200b\u4f4d\u200b\u7684\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b\u3002\u200b\u5982\u679c\u200b flag \u200b\u4e3a\u200b true \u200b\u5219\u200b\u8df3\u51fa\u200b\u5faa\u73af\u200b\u3002</p> <p>\u200b\u5f53\u200b <code>main</code> \u200b\u6267\u884c\u200b\u5230\u200b\u6700\u540e\u200b\u4e00\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cflag \u200b\u88ab\u200b\u7f6e\u200b\u4e3a\u200b true\uff0c\u200b\u6309\u200b\u903b\u8f91\u200b\u5206\u6790\u200b\u6b64\u65f6\u200b\u7ebf\u7a0b\u200b\u8be5\u200b\u7ed3\u675f\u200b\uff0c\u200b\u5373\u200b\u6574\u4e2a\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u3002</p> <p>\u200b\u6267\u884c\u200b\u4e00\u4e0b\u200b\u770b\u770b\u200b\u662f\u200b\u4ec0\u4e48\u200b\u7ed3\u679c\u200b\uff1f\u200b\u7ed3\u679c\u200b\u662f\u200b\u4ee4\u4eba\u200b\u60ca\u8bb6\u200b\u7684\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u59cb\u7ec8\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u7ed3\u675f\u200b\u3002<code>main</code>\u200b\u662f\u200b\u80af\u5b9a\u200b\u7ed3\u675f\u200b\u4e86\u200b\u7684\u200b\uff0c\u200b\u5176\u200b\u539f\u56e0\u200b\u5c31\u662f\u200b\u7ebf\u7a0b\u200b\u7684\u200brun\u200b\u65b9\u6cd5\u200b\u672a\u200b\u7ed3\u675f\u200b\uff0c\u200b\u5373\u200brun\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200bflag\u200b\u4ecd\u7136\u200b\u4e3a\u200bfalse\u3002</p> <p>\u200b\u628a\u200b\u7b2c\u200b3\u200b\u884c\u200b\u52a0\u4e0a\u200bvolatile\u200b\u4fee\u9970\u7b26\u200b\uff0c\u200b\u5373\u200b</p> Java<pre><code>static volatile boolean flag = false;\n</code></pre> <p>\u200b\u518d\u200b\u6267\u884c\u200b\u4e00\u904d\u200b\u770b\u770b\u200b\uff1f\u200b\u7ed3\u679c\u200b\u662f\u200b\u7a0b\u5e8f\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\uff0cvolatile\u200b\u751f\u6548\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u518d\u200b\u4fee\u6539\u200b\u4e00\u4e0b\u200b\u3002\u200b\u53bb\u6389\u200bvolatile\u200b\u5173\u952e\u5b57\u200b\uff0c\u200b\u6062\u590d\u200b\u5230\u200b\u8d77\u59cb\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b<code>while(!flag){}</code>\u200b\u6539\u4e3a\u200b<code>while(!flag){System.out.println(1);}</code>\uff0c\u200b\u518d\u200b\u6267\u884c\u200b\u4e00\u4e0b\u200b\u770b\u770b\u200b\u3002\u200b\u6309\u200b\u5206\u6790\u200b\uff0c\u200b\u6ca1\u6709\u200bvolatile\u200b\u5173\u952e\u5b57\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u4e0d\u4f1a\u200b\u6267\u884c\u200b\u7ed3\u675f\u200b\uff0c\u200b\u867d\u7136\u200b\u52a0\u4e0a\u200b\u4e86\u200b\u6253\u5370\u200b\u8bed\u53e5\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u505a\u200b\u4efb\u4f55\u200b\u7684\u200b\u5173\u952e\u5b57\u200b/\u200b\u903b\u8f91\u200b\u7684\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e94\u8be5\u200b\u7a0b\u5e8f\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u7ed3\u675f\u200b\u624d\u200b\u5bf9\u200b\uff0c\u200b\u4f46\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u5374\u662f\u200b\uff1a\u200b\u7a0b\u5e8f\u200b\u6b63\u5e38\u200b\u7ed3\u675f\u200b\u3002</p> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u611f\u6027\u8ba4\u8bc6\u200b\uff0c\u200b\u6211\u4eec\u200b\u518d\u200b\u6765\u200b\u5206\u6790\u200bvolatile\u200b\u7684\u200b\u8bed\u4e49\u200b\u4ee5\u53ca\u200b\u5b83\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#2-volatile","title":"2. volatile \u200b\u7279\u6027","text":"<p>volatile \u200b\u662f\u200b Java \u200b\u865a\u62df\u673a\u200b\u63d0\u4f9b\u200b\u7684\u200b\u8f7b\u91cf\u7ea7\u200b\u7684\u200b\u540c\u6b65\u200b\u673a\u5236\u200b\uff08\u200b\u4e09\u5927\u200b\u7279\u6027\u200b\uff09</p> <ul> <li>\u200b\u4fdd\u8bc1\u200b\u53ef\u89c1\u200b\u6027\u200b</li> <li>\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b</li> <li>\u200b\u4fdd\u8bc1\u200b\u6709\u5e8f\u6027\u200b\uff08\u200b\u7981\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\uff09</li> </ul> <p>\u200b\u6027\u80fd\u200b\uff1avolatile \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u4e0e\u200b\u666e\u901a\u200b\u53d8\u91cf\u200b\u51e0\u4e4e\u200b\u6ca1\u4ec0\u4e48\u200b\u5dee\u522b\u200b\uff0c\u200b\u4f46\u662f\u200b\u5199\u200b\u64cd\u4f5c\u200b\u76f8\u5bf9\u200b\u6162\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u9700\u8981\u200b\u5728\u200b\u672c\u5730\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u63d2\u5165\u200b\u5f88\u591a\u200b\u5185\u5b58\u200b\u5c4f\u969c\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u6307\u4ee4\u200b\u4e0d\u4f1a\u200b\u53d1\u751f\u200b\u4e71\u5e8f\u6267\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f00\u9500\u200b\u6bd4\u9501\u200b\u8981\u200b\u5c0f\u200b</p> <p>synchronized \u200b\u65e0\u6cd5\u200b\u7981\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u548c\u200b\u5904\u7406\u5668\u200b\u4f18\u5316\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u6709\u5e8f\u6027\u200b\u53ef\u89c1\u200b\u6027\u200b</p> <ul> <li>\u200b\u52a0\u200b\u4e86\u200b\u9501\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\u5230\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u83b7\u5f97\u200b\u4e0d\u5230\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c31\u8981\u200b\u963b\u585e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540c\u4e00\u65f6\u95f4\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5355\u7ebf\u7a0b\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u4f9d\u8d56\u6027\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u5355\u7ebf\u7a0b\u200b\u7684\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u662f\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\u7684\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u52a0\u9501\u200b\u524d\u200b\uff0c\u200b\u5c06\u200b\u6e05\u7a7a\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u65f6\u200b\u9700\u8981\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u91cd\u65b0\u200b\u8bfb\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u7ebf\u7a0b\u200b\u89e3\u9501\u200b\u524d\u200b\uff0c\u200b\u5fc5\u987b\u200b\u628a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u6700\u65b0\u200b\u503c\u200b\u5237\u65b0\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#21","title":"2.1 \u200b\u53ef\u89c1\u200b\u6027","text":"<p>volatile\u200b\u7684\u200b\u7b2c\u4e00\u6761\u200b\u8bed\u4e49\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u53d8\u91cf\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b\uff0c\u200b\u7b80\u5355\u200b\u5730\u8bf4\u200b\u5c31\u662f\u200b\u5f53\u200b\u7ebf\u7a0b\u200bA\u200b\u5bf9\u200b\u53d8\u91cf\u200bX\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4fee\u6539\u200b\u540e\u200b\uff0c\u200b\u5728\u7ebf\u200b\u7a0b\u200bA\u200b\u540e\u9762\u200b\u6267\u884c\u200b\u7684\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u80fd\u200b\u770b\u5230\u200b\u53d8\u91cf\u200bX\u200b\u7684\u200b\u53d8\u52a8\u200b\uff0c\u200b\u66f4\u200b\u8be6\u7ec6\u200b\u5730\u200b\u8bf4\u200b\u662f\u200b\u8981\u200b\u7b26\u5408\u200b\u4ee5\u4e0b\u200b\u4e24\u4e2a\u200b\u89c4\u5219\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8981\u200b\u7acb\u523b\u200b\u56de\u5199\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u3002</li> <li>\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u8bfb\u53d6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8981\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u8bfb\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7f13\u5b58\u200b\u3002</li> </ul> <p>\u200b\u8981\u200b\u8be6\u7ec6\u200b\u5730\u200b\u89e3\u91ca\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u5f97\u4e0d\u200b\u63d0\u200b\u4e00\u4e0b\u200bJava\u200b\u7684\u200b\u5185\u5b58\u200b\u6a21\u578b\u200b(Java Memory Model,\u200b\u7b80\u79f0\u200bJMM)</p> <p>Java \u200b\u5185\u5b58\u200b\u6a21\u578b\u200b\u662f\u200b Java Memory Model\uff08JMM\uff09\uff0c\u200b\u672c\u8eab\u200b\u662f\u200b\u4e00\u79cd\u200b\u62bd\u8c61\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5e76\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u63cf\u8ff0\u200b\u7684\u200b\u662f\u200b\u4e00\u7ec4\u200b\u89c4\u5219\u200b\u6216\u200b\u89c4\u8303\u200b\uff0c\u200b\u901a\u8fc7\u200b\u8fd9\u7ec4\u200b\u89c4\u8303\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u5404\u4e2a\u200b\u53d8\u91cf\u200b\uff08\u200b\u5305\u62ec\u200b\u5b9e\u4f8b\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u9759\u6001\u200b\u5b57\u6bb5\u200b\u548c\u200b\u6784\u6210\u200b\u6570\u7ec4\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5143\u7d20\u200b\uff09\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65b9\u5f0f\u200b</p> <p>JMM \u200b\u4f5c\u7528\u200b\uff1a</p> <ul> <li>\u200b\u5c4f\u853d\u200b\u5404\u79cd\u200b\u786c\u4ef6\u200b\u548c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u5dee\u5f02\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u8ba9\u200b Java \u200b\u7a0b\u5e8f\u200b\u5728\u200b\u5404\u79cd\u200b\u5e73\u53f0\u200b\u4e0b\u200b\u90fd\u200b\u80fd\u200b\u8fbe\u5230\u200b\u4e00\u81f4\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u6548\u679c\u200b</li> <li>\u200b\u89c4\u5b9a\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u5185\u5b58\u200b\u4e4b\u95f4\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5173\u7cfb\u200b</li> </ul> <p>\u200b\u6839\u636e\u200b JMM \u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b\u4e3b\u200b\u5185\u5b58\u200b\uff08Main Memory\uff09\uff0cJava \u200b\u4e2d\u200b\u6240\u6709\u200b\u53d8\u91cf\u200b\u90fd\u200b\u5b58\u50a8\u200b\u5728\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff1b\u200b\u6bcf\u6761\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff08Working Memory\uff09\uff0c\u200b\u5404\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u95f4\u200b\u5f7c\u6b64\u200b\u72ec\u7acb\u200b\u3001\u200b\u4e92\u4e0d\u200b\u53ef\u89c1\u200b\uff0c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\u67d0\u4e9b\u200b\u53d8\u91cf\u200b\u7684\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u6240\u6709\u200b\u53d8\u91cf\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u662f\u200b\u5148\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u8fdb\u884c\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8fdb\u884c\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u53d8\u91cf\u200b\uff1b\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u65e0\u6cd5\u200b\u76f8\u4e92\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\uff08\u200b\u4f20\u9012\u200b\uff09\u200b\u5fc5\u987b\u200b\u901a\u8fc7\u200b\u4e3b\u200b\u5185\u5b58\u200b\u6765\u200b\u5b8c\u6210\u200b\u3002</p> <p>\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u542f\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u4e00\u5757\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff0c\u200b\u4e0d\u4ec5\u200b\u5305\u542b\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5185\u90e8\u200b\u5b9a\u4e49\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\uff0c\u200b\u4e5f\u200b\u5305\u542b\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u7684\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b(\u200b\u975e\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u6784\u9020\u200b\u7684\u200b\u5bf9\u8c61\u200b)\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u5373\u200b\u4e3a\u4e86\u200b\u63d0\u9ad8\u200b\u6267\u884c\u200b\u6548\u7387\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u526f\u672c\u200b\u6bd4\u200b\u76f4\u63a5\u200b\u8bfb\u53d6\u200b\u4e3b\u200b\u5185\u5b58\u200b\u66f4\u200b\u5feb\u200b(\u200b\u8fd9\u91cc\u200b\u53ef\u4ee5\u200b\u7b80\u5355\u200b\u5730\u200b\u5c06\u200b\u4e3b\u200b\u5185\u5b58\u200b\u7406\u89e3\u200b\u4e3a\u200b\u865a\u62df\u673a\u200b\u4e2d\u200b\u7684\u200b\u5806\u200b\uff0c\u200b\u800c\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u7406\u89e3\u200b\u4e3a\u6808\u200b(\u200b\u6216\u200b\u79f0\u4e3a\u200b\u865a\u62df\u673a\u200b\u6808\u200b)\uff0c\u200b\u6808\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\u5c0f\u200b\u7a7a\u95f4\u200b\u3001\u200b\u987a\u5e8f\u200b\u5165\u6808\u200b\u51fa\u6808\u200b\uff0c\u200b\u800c\u200b\u5806\u200b\u662f\u200b\u4e0d\u200b\u8fde\u7eed\u200b\u7684\u200b\u5927\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b\u6808\u200b\u4e2d\u200b\u5bfb\u5740\u200b\u7684\u200b\u901f\u5ea6\u200b\u6bd4\u5806\u200b\u8981\u200b\u5feb\u200b\u5f88\u591a\u200b)</p> <p></p> <p>\u200b\u5bf9\u4e8e\u200b\u5171\u4eab\u200b\u666e\u901a\u200b\u53d8\u91cf\u200b\u6765\u8bf4\u200b\uff0c\u200b\u7ea6\u5b9a\u200b\u4e86\u200b\u53d8\u91cf\u200b\u5728\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u53d1\u751f\u53d8\u5316\u200b\u4e86\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5fc5\u987b\u200b\u8981\u200b\u56de\u200b\u5199\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b(\u200b\u8fdf\u65e9\u200b\u8981\u200b\u56de\u200b\u5199\u200b\u4f46\u200b\u5e76\u975e\u200b\u9a6c\u4e0a\u200b\u56de\u5199\u200b)\uff0c\u200b\u4f46\u200b\u5bf9\u4e8e\u200bvolatile\u200b\u53d8\u91cf\u200b\u5219\u200b\u8981\u6c42\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u53d1\u751f\u53d8\u5316\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5fc5\u987b\u200b\u9a6c\u4e0a\u200b\u56de\u5199\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u800c\u200b\u7ebf\u7a0b\u200b\u8bfb\u53d6\u200bvolatile\u200b\u53d8\u91cf\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5fc5\u987b\u200b\u9a6c\u4e0a\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u53bb\u53d6\u200b\u6700\u65b0\u200b\u503c\u200b\u800c\u200b\u4e0d\u662f\u200b\u8bfb\u53d6\u200b\u672c\u5730\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u6b64\u200b\u89c4\u5219\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u524d\u9762\u200b\u6240\u8bf4\u200b\u7684\u200b\u201c\u200b\u5f53\u200b\u7ebf\u7a0b\u200bA\u200b\u5bf9\u200b\u53d8\u91cf\u200bX\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4fee\u6539\u200b\u540e\u200b\uff0c\u200b\u5728\u7ebf\u200b\u7a0b\u200bA\u200b\u540e\u9762\u200b\u6267\u884c\u200b\u7684\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u80fd\u200b\u770b\u5230\u200b\u53d8\u91cf\u200bX\u200b\u7684\u200b\u53d8\u52a8\u200b\u201d\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#22","title":"2.2 \u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027","text":"<p>\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200bvolatile\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u95f4\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u53ca\u65f6\u200b\u53ef\u89c1\u200b\u6027\u200b\uff0c\u200b\u4f46\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4fdd\u8bc1\u200b\u540c\u6b65\u200b\uff0c\u200b\u8fd9\u200b\u662f\u200b\u4e0e\u200bvolatile\u200b\u7684\u200b\u4f7f\u547d\u200b\u6709\u5173\u200b\u7684\u200b\uff0c\u200b\u521b\u9020\u200b\u5b83\u200b\u7684\u200b\u80cc\u666f\u200b\u5c31\u662f\u200b\u5728\u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u4ee3\u66ff\u200bsynchronized\u200b\u5b9e\u73b0\u200b\u53ef\u89c1\u200b\u6027\u200b\u7684\u200b\u76ee\u7684\u200b\uff0c\u200b\u89c4\u907f\u200bsynchronized\u200b\u5e26\u6765\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b\u3001\u200b\u8c03\u5ea6\u200b\u7684\u200b\u5f00\u9500\u200b\u3002\u200b\u5982\u679c\u200bvolatile\u200b\u4e5f\u200b\u80fd\u200b\u4fdd\u8bc1\u200b\u540c\u6b65\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u5c31\u662f\u200b\u4e2a\u9501\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b8c\u5168\u200b\u53d6\u4ee3\u200bsynchronized\u200b\u4e86\u200b\u3002\u200b\u4ece\u200b\u8fd9\u70b9\u200b\u770b\u200b\uff0cvolatile\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u4fdd\u8bc1\u200b\u540c\u6b65\u200b\uff0c\u200b\u4e5f\u200b\u6b63\u200b\u57fa\u4e8e\u200b\u4e0a\u9762\u200b\u7684\u200b\u539f\u56e0\u200b\uff0c\u200b\u968f\u7740\u200bsynchronized\u200b\u6027\u80fd\u200b\u9010\u6e10\u200b\u63d0\u9ad8\u200b\uff0cvolatile\u200b\u9010\u6e10\u200b\u9000\u51fa\u200b\u5386\u53f2\u821e\u53f0\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200bvolatile\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\uff1f\u200b\u4ee5\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e3a\u4f8b\u200b\u3002</p> Java<pre><code>volatile i = 0;\nnew Thread(() -&gt; {i++});\nnew Thread(() -&gt; {i--});\n</code></pre> <p>i++\u200b\u867d\u7136\u200b\u4ec5\u4e3a\u200b 1 \u200b\u884c\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f46\u662f\u200b\u5176\u200b\u53cd\u7f16\u8bd1\u200b\u4e3a\u200b\u5b57\u8282\u200b\u7801\u200b\u4e4b\u540e\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b 3 \u200b\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5305\u62ec\u200b\u8bfb\u53d6\u200b\u3001\u200b\u64cd\u4f5c\u200b\u3001\u200b\u8d4b\u503c\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5e76\u200b\u4e0d\u662f\u200b\u4e00\u4e2a\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b</p> Java<pre><code>0: iconst_1         // \u200b\u5f53\u200bint\u200b\u53d6\u503c\u200b -1~5 \u200b\u65f6\u200b\uff0cJVM\u200b\u91c7\u7528\u200biconst\u200b\u6307\u4ee4\u200b\u5c06\u200b\u5e38\u91cf\u200b\u538b\u5165\u200b\u6808\u200b\u4e2d\u200b\n1: istore_1         // \u200b\u5c06\u200b\u64cd\u4f5c\u6570\u200b\u6808\u9876\u200b\u6570\u636e\u200b\u5f39\u200b\u51fa\u200b\uff0c\u200b\u5b58\u5165\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u8868\u200b\u7684\u200b slot 1\n2: iinc     1, 1    \n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u64cd\u4f5c\u200b\u987a\u5e8f\u200b </p> <p></p> <p>\u200b\u5047\u5982\u200b\u8bf4\u200b\u7ebf\u7a0b\u200bA\u200b\u5728\u200b\u505a\u200b\u4e86\u200bi+1\uff0c\u200b\u4f46\u200b\u672a\u200b\u8d4b\u503c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ebf\u7a0b\u200bB\u200b\u5c31\u200b\u5f00\u59cb\u200b\u8bfb\u53d6\u200bi\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u200b\u7ebf\u7a0b\u200bA\u200b\u8d4b\u503c\u200bi=1\uff0c\u200b\u5e76\u200b\u56de\u200b\u5199\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u800c\u200b\u6b64\u65f6\u200b\u7ebf\u7a0b\u200bB\u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u9700\u8981\u200bi\u200b\u7684\u200b\u503c\u200b\u4e86\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u4ea4\u7ed9\u200b\u5904\u7406\u5668\u200b\u53bb\u200b\u505a\u200b-1\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e8e\u662f\u200b\u5f53\u200b\u7ebf\u7a0b\u200bB\u200b\u6267\u884c\u200b\u5b8c\u200b\u5e76\u200b\u56de\u200b\u5199\u200b\u5230\u200b\u4e3b\u200b\u5185\u5b58\u200b\uff0ci\u200b\u7684\u200b\u503c\u200b\u4e3a\u200b-1\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u9884\u671f\u200b\u7684\u200b 0\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0cvolatile\u200b\u7f29\u77ed\u200b\u4e86\u200b\u666e\u901a\u200b\u53d8\u91cf\u200b\u5728\u200b\u4e0d\u540c\u200b\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u5dee\u200b\uff0c\u200b\u4f46\u200b\u4ecd\u7136\u200b\u5b58\u6709\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f9d\u7136\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u5fc5\u987b\u200b\u8981\u200b\u63d0\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4e4b\u524d\u200b\u6240\u8bf4\u200b\u7684\u200b \u201c\u200b\u5404\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\u95f4\u200b\u5f7c\u6b64\u200b\u72ec\u7acb\u200b\u3001\u200b\u4e92\u4e0d\u200b\u53ef\u89c1\u200b\uff0c\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u542f\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u4e00\u5757\u200b\u5de5\u4f5c\u200b\u5185\u5b58\u200b\uff0c\u200b\u4e0d\u4ec5\u200b\u5305\u542b\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5185\u90e8\u200b\u5b9a\u4e49\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\uff0c\u200b\u4e5f\u200b\u5305\u542b\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u7684\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b(\u200b\u975e\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u6784\u9020\u200b\u7684\u200b\u5bf9\u8c61\u200b)\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u5373\u200b\u4e3a\u4e86\u200b\u63d0\u9ad8\u200b\u6267\u884c\u200b\u6548\u7387\u200b\u201d \u200b\u5e76\u200b\u4e0d\u200b\u51c6\u786e\u200b\u3002</p> <p>\u200b\u5982\u4eca\u200b\u7684\u200bvolatile\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5df2\u7ecf\u200b\u662f\u200b\u5f88\u200b\u96be\u200b\u91cd\u73b0\u200b\uff0c\u200b\u5982\u200b\u672c\u6587\u200b\u5f00\u5934\u200b\u65f6\u200b\u53ea\u6709\u200b\u5728\u200bwhile\u200b\u6b7b\u5faa\u73af\u200b\u65f6\u624d\u200b\u4f53\u73b0\u200b\u51fa\u200bvolatile\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u54ea\u6015\u200b\u53ea\u662f\u200b\u52a0\u200b\u4e86\u200b <code>System.out.println(1)</code> \u200b\u8fd9\u4e48\u200b\u4e00\u5c0f\u200b\u6bb5\u200b\uff0c\u200b\u666e\u901a\u200b\u53d8\u91cf\u200b\u4e5f\u200b\u80fd\u200b\u8fbe\u5230\u200bvolatile\u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4ec0\u4e48\u200b\u539f\u56e0\u200b\u5462\u200b\uff1f</p> <p>\u200b\u539f\u6765\u200b\u53ea\u6709\u200b\u5728\u200b\u5bf9\u200b\u53d8\u91cf\u200b\u8bfb\u53d6\u200b\u9891\u7387\u200b\u5f88\u200b\u9ad8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u624d\u200b\u4e0d\u4f1a\u200b\u53ca\u65f6\u200b\u56de\u5199\u200b\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u800c\u200b\u5f53\u200b\u9891\u7387\u200b\u6ca1\u6709\u200b\u8fbe\u5230\u200b\u865a\u62df\u673a\u200b\u8ba4\u4e3a\u200b\u7684\u200b\u9ad8\u9891\u7387\u200b\u65f6\u200b\uff0c\u200b\u666e\u901a\u200b\u53d8\u91cf\u200b\u548c\u200bvolatile\u200b\u662f\u200b\u540c\u6837\u200b\u7684\u200b\u5904\u7406\u200b\u903b\u8f91\u200b\u3002</p> <p>\u200b\u5982\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u5faa\u73af\u200b\u4e2d\u200b\u6267\u884c\u200b <code>System.out.println(1)</code> \u200b\u52a0\u5927\u200b\u4e86\u200b\u8bfb\u53d6\u200b\u53d8\u91cf\u200b\u7684\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b\uff0c\u200b\u4f7f\u200b\u865a\u62df\u673a\u200b\u8ba4\u4e3a\u200b\u8bfb\u53d6\u200b\u9891\u7387\u200b\u5e76\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u9ad8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u548c\u200b volatile \u200b\u76f8\u540c\u200b\u7684\u200b\u6548\u679c\u200b\u3002volatile\u200b\u7684\u200b\u6548\u679c\u200b\u5728\u200bjdk1.2\u200b\u53ca\u200b\u4e4b\u524d\u200b\u5f88\u200b\u5bb9\u6613\u200b\u91cd\u73b0\u200b\uff0c\u200b\u4f46\u200b\u968f\u7740\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u4e0d\u65ad\u200b\u4f18\u5316\u200b\uff0c\u200b\u5982\u4eca\u200b\u7684\u200b\u666e\u901a\u200b\u53d8\u91cf\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b\u5df2\u7ecf\u200b\u4e0d\u662f\u200b\u90a3\u4e48\u200b\u4e25\u91cd\u200b\u7684\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200bvolatile\u200b\u5982\u4eca\u200b\u786e\u5b9e\u200b\u4e0d\u592a\u6709\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u7684\u200b\u539f\u56e0\u200b\u5427\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#23","title":"2.3 \u200b\u6709\u5e8f\u6027\u200b (\u200b\u7981\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b)","text":"<p>volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u53d8\u91cf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7981\u7528\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#_1","title":"\u6307\u4ee4\u200b\u91cd\u6392\u200b\u5b9e\u4f8b","text":"<ul> <li>example 1\uff1a</li> </ul> Java<pre><code>public void mySort() {\n  int x = 11; //\u200b\u8bed\u53e5\u200b1\n  int y = 12; //\u200b\u8bed\u53e5\u200b2  \u200b\u8c01\u200b\u5148\u200b\u6267\u884c\u200b\u6548\u679c\u200b\u4e00\u6837\u200b\n  x = x + 5;  //\u200b\u8bed\u53e5\u200b3\n  y = x * x;  //\u200b\u8bed\u53e5\u200b4\n}\n</code></pre> <p>\u200b\u6267\u884c\u200b\u987a\u5e8f\u200b\u662f\u200b\uff1a1 2 3 4\u30012 1 3 4\u30011 3 2 4</p> <p>\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u4e5f\u200b\u6709\u200b\u9650\u5236\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\uff1a4321\uff0c\u200b\u8bed\u53e5\u200b 4 \u200b\u9700\u8981\u200b\u4f9d\u8d56\u4e8e\u200b y \u200b\u4ee5\u53ca\u200b x \u200b\u7684\u200b\u7533\u660e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b58\u5728\u200b\u6570\u636e\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u9996\u5148\u200b\u6267\u884c\u200b</p> <ul> <li>example 2\uff1a</li> </ul> Java<pre><code>int num = 0;\nboolean ready = false;\n// \u200b\u7ebf\u7a0b\u200b1 \u200b\u6267\u884c\u200b\u6b64\u200b\u65b9\u6cd5\u200b\npublic void actor1(I_Result r) {\n    if(ready) {\n      r.r1 = num + num;\n    } else {\n      r.r1 = 1;\n    }\n}\n// \u200b\u7ebf\u7a0b\u200b2 \u200b\u6267\u884c\u200b\u6b64\u200b\u65b9\u6cd5\u200b\npublic void actor2(I_Result r) {\n  num = 2;\n  ready = true;\n}\n</code></pre> <p>\u200b\u60c5\u51b5\u200b\u4e00\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 1 \u200b\u5148\u200b\u6267\u884c\u200b\uff0cready = false\uff0c\u200b\u7ed3\u679c\u200b\u4e3a\u200b r.r1 = 1</p> <p>\u200b\u60c5\u51b5\u200b\u4e8c\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 2 \u200b\u5148\u200b\u6267\u884c\u200b num = 2\uff0c\u200b\u4f46\u200b\u8fd8\u200b\u6ca1\u200b\u6267\u884c\u200b ready = true\uff0c\u200b\u7ebf\u7a0b\u200b 1 \u200b\u6267\u884c\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4e3a\u200b r.r1 = 1</p> <p>\u200b\u60c5\u51b5\u200b\u4e09\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 2 \u200b\u5148\u200b\u6267\u884c\u200b ready = true\uff0c\u200b\u7ebf\u7a0b\u200b 1 \u200b\u6267\u884c\u200b\uff0c\u200b\u8fdb\u5165\u200b if \u200b\u5206\u652f\u200b\u7ed3\u679c\u200b\u4e3a\u200b r.r1 = 4</p> <p>\u200b\u60c5\u51b5\u200b\u56db\u200b\uff1a\u200b\u7ebf\u7a0b\u200b 2 \u200b\u6267\u884c\u200b ready = true\uff0c\u200b\u5207\u6362\u200b\u5230\u200b\u7ebf\u7a0b\u200b 1\uff0c\u200b\u8fdb\u5165\u200b if \u200b\u5206\u652f\u200b\u4e3a\u200b r.r1 = 0\uff0c\u200b\u518d\u5207\u200b\u56de\u200b\u7ebf\u7a0b\u200b 2 \u200b\u6267\u884c\u200b num = 2\uff0c\u200b\u53d1\u751f\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#_2","title":"\u4ec0\u4e48\u200b\u662f\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b\uff1f","text":"<p>\u200b\u6709\u200b\u4e24\u4e2a\u200b\u5c42\u9762\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u5c42\u9762\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5c3d\u53ef\u80fd\u51cf\u5c11\u200b\u5185\u5b58\u200b\u64cd\u4f5c\u901f\u5ea6\u200b\u8fdc\u6162\u200b\u4e8e\u200bCPU\u200b\u8fd0\u884c\u200b\u901f\u5ea6\u200b\u6240\u200b\u5e26\u6765\u200b\u7684\u200bCPU\u200b\u7a7a\u7f6e\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u865a\u62df\u200b\u673a\u4f1a\u200b\u6309\u7167\u200b\u81ea\u5df1\u200b\u7684\u200b\u4e00\u4e9b\u200b\u89c4\u5219\u200b(\u200b\u8fd9\u200b\u89c4\u5219\u200b\u540e\u9762\u200b\u518d\u200b\u53d9\u8ff0\u200b)\u200b\u5c06\u200b\u7a0b\u5e8f\u200b\u7f16\u5199\u200b\u987a\u5e8f\u200b\u6253\u4e71\u200b\u2014\u2014\u200b\u5373\u200b\u5199\u200b\u5728\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5728\u200b\u65f6\u95f4\u200b\u987a\u5e8f\u200b\u4e0a\u200b\u53ef\u80fd\u200b\u4f1a\u5148\u200b\u6267\u884c\u200b\uff0c\u200b\u800c\u200b\u5199\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u4f1a\u540e\u200b\u6267\u884c\u200b\u2014\u2014\u200b\u4ee5\u200b\u5c3d\u53ef\u80fd\u200b\u5145\u5206\u200b\u5730\u200b\u5229\u7528\u200bCPU\u3002\u200b\u62ff\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u6765\u8bf4\u200b\uff1a\u200b\u5047\u5982\u200b\u4e0d\u662f\u200b <code>num = 2</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u800c\u662f\u200b <code>num = new byte[1024*1024]</code> (\u200b\u5206\u914d\u200b1M\u200b\u7a7a\u95f4\u200b)\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4f1a\u200b\u8fd0\u884c\u200b\u5730\u200b\u5f88\u6162\u200b\uff0c\u200b\u6b64\u65f6\u200bCPU\u200b\u662f\u200b\u7b49\u5f85\u200b\u5176\u200b\u6267\u884c\u200b\u7ed3\u675f\u200b\u5462\u200b\uff0c\u200b\u8fd8\u662f\u200b\u5148\u200b\u6267\u884c\u200b\u4e0b\u9762\u200b\u90a3\u53e5\u200b <code>flag=true</code> \u200b\u5462\u200b\uff1f\u200b\u663e\u7136\u200b\uff0c\u200b\u5148\u200b\u6267\u884c\u200b <code>flag=true</code> \u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u4f7f\u7528\u200bCPU\uff0c\u200b\u52a0\u5feb\u200b\u6574\u4f53\u200b\u6548\u7387\u200b\uff0c\u200b\u5f53\u7136\u200b\u8fd9\u6837\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u4ea7\u751f\u200b\u9519\u8bef\u200b\u3002\u200b\u663e\u7136\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff1a\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5148\u4e8e\u200b\u524d\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\uff1b\u200b\u524d\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5148\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\uff0c\u200b\u4f46\u200b\u5f53\u200b\u6548\u7387\u200b\u8f83\u6162\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u5e76\u200b\u5148\u4e8e\u200b\u524d\u9762\u200b\u7684\u200b\u4ee3\u7801\u6267\u884c\u200b\u7ed3\u675f\u200b\u3002\u200b\u4e0d\u7ba1\u200b\u8c01\u200b\u5148\u200b\u5f00\u59cb\u200b\uff0c\u200b\u603b\u4e4b\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5728\u200b\u4e00\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5b58\u5728\u200b\u5148\u200b\u7ed3\u675f\u200b\u7684\u200b\u53ef\u80fd\u200b\u3002</li> <li>\u200b\u5728\u200b\u786c\u4ef6\u200b\u5c42\u9762\u200b\uff0cCPU\u200b\u4f1a\u200b\u5c06\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u4e00\u6279\u200b\u6307\u4ee4\u200b\u6309\u7167\u200b\u5176\u200b\u89c4\u5219\u200b\u91cd\u200b\u6392\u5e8f\u200b\uff0c\u200b\u540c\u6837\u200b\u662f\u200b\u57fa\u4e8e\u200bCPU\u200b\u901f\u5ea6\u200b\u6bd4\u200b\u7f13\u5b58\u200b\u901f\u5ea6\u200b\u5feb\u200b\u7684\u200b\u539f\u56e0\u200b\uff0c\u200b\u548c\u200b\u4e0a\u200b\u4e00\u70b9\u200b\u7684\u200b\u76ee\u7684\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ea\u662f\u200b\u786c\u4ef6\u200b\u5904\u7406\u200b\u7684\u8bdd\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u53ea\u80fd\u200b\u5728\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u6709\u9650\u200b\u6307\u4ee4\u200b\u8303\u56f4\u200b\u5185\u91cd\u200b\u6392\u5e8f\u200b\uff0c\u200b\u800c\u200b\u865a\u62df\u673a\u200b\u53ef\u4ee5\u200b\u5728\u200b\u66f4\u200b\u5927\u200b\u5c42\u9762\u200b\u3001\u200b\u66f4\u200b\u591a\u6307\u4ee4\u200b\u8303\u56f4\u200b\u5185\u91cd\u200b\u6392\u5e8f\u200b\u3002</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#_3","title":"\u5e95\u5c42\u200b\u539f\u7406","text":"<p>\u200b\u4f7f\u7528\u200b volatile \u200b\u4fee\u9970\u200b\u7684\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\uff0c\u200b\u5e95\u5c42\u200b\u901a\u8fc7\u200b\u6c47\u7f16\u200b <code>lock</code> \u200b\u524d\u7f00\u200b\u6307\u4ee4\u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\u9501\u5b9a\u200b\uff0c\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u4fee\u6539\u200b\u5b8c\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u540e\u5199\u200b\u56de\u200b\u4e3b\u5b58\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b CPU \u200b\u6838\u5fc3\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b CPU \u200b\u603b\u7ebf\u200b\u55c5\u63a2\u200b\u673a\u5236\u200b\u4f1a\u200b\u4fee\u6539\u200b\u5176\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u4e3a\u200b\u5931\u6548\u200b\u72b6\u6001\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u65f6\u4f1a\u200b\u91cd\u65b0\u200b\u4ece\u4e3b\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b\u6570\u636e\u200b</p> <p>lock \u200b\u524d\u7f00\u200b\u6307\u4ee4\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u5185\u5b58\u200b\u5c4f\u969c\u200b\uff0cMemory Barrier\uff08Memory Fence\uff09</p> <ul> <li>\u200b\u5bf9\u200b volatile \u200b\u53d8\u91cf\u200b\u7684\u200b\u5199\u200b\u6307\u4ee4\u200b\u540e\u200b\u4f1a\u200b\u52a0\u5165\u200b\u5199\u200b\u5c4f\u969c\u200b</li> <li>\u200b\u5bf9\u200b volatile \u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u200b\u6307\u4ee4\u200b\u524d\u4f1a\u200b\u52a0\u5165\u200b\u8bfb\u200b\u5c4f\u969c\u200b</li> </ul> <p>\u200b\u5185\u5b58\u200b\u5c4f\u969c\u200b\u6709\u200b\u4e09\u4e2a\u200b\u4f5c\u7528\u200b\uff1a</p> <ul> <li>\u200b\u786e\u4fdd\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u8bfb\u200b-\u200b\u6539\u200b-\u200b\u5199\u200b\u64cd\u4f5c\u200b\u539f\u5b50\u200b\u6267\u884c\u200b</li> <li>\u200b\u963b\u6b62\u200b\u5c4f\u969c\u200b\u4e24\u4fa7\u200b\u7684\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b</li> <li>\u200b\u5f3a\u5236\u200b\u628a\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u810f\u200b\u6570\u636e\u200b\u5199\u200b\u56de\u4e3b\u200b\u5185\u5b58\u200b\uff0c\u200b\u8ba9\u200b\u7f13\u5b58\u200b\u884c\u4e2d\u200b\u76f8\u5e94\u200b\u7684\u200b\u6570\u636e\u200b\u5931\u6548\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#_4","title":"\u5185\u5b58\u200b\u5c4f\u969c","text":"<p>1. \u200b\u4fdd\u8bc1\u200b\u53ef\u89c1\u200b\u6027\u200b</p> <ul> <li>\u200b\u5199\u200b\u5c4f\u969c\u200b\uff08sfence\uff0cStore Barrier\uff09\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u8be5\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b\u7684\u200b\uff0c\u200b\u5bf9\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u6539\u52a8\u200b\uff0c\u200b\u90fd\u200b\u540c\u6b65\u200b\u5230\u200b\u4e3b\u5b58\u200b\u5f53\u4e2d\u200b</li> </ul> Java<pre><code>public void actor2(I_Result r) {\n    num = 2;\n    ready = true; // ready \u200b\u662f\u200b volatile \u200b\u8d4b\u503c\u200b\u5e26\u5199\u200b\u5c4f\u969c\u200b\n    // \u200b\u5199\u200b\u5c4f\u969c\u200b\n}\n</code></pre> <ul> <li>\u200b\u8bfb\u200b\u5c4f\u969c\u200b\uff08lfence\uff0cLoad Barrier\uff09\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u8be5\u200b\u5c4f\u969c\u200b\u4e4b\u540e\u200b\u7684\u200b\uff0c\u200b\u5bf9\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u4ece\u200b\u4e3b\u5b58\u200b\u5237\u65b0\u200b\u53d8\u91cf\u503c\u200b\uff0c\u200b\u52a0\u8f7d\u200b\u7684\u200b\u662f\u200b\u4e3b\u5b58\u200b\u4e2d\u200b\u6700\u65b0\u200b\u6570\u636e\u200b</li> </ul> Java<pre><code>public void actor1(I_Result r) {\n    // \u200b\u8bfb\u200b\u5c4f\u969c\u200b\n    // ready \u200b\u662f\u200b volatile \u200b\u8bfb\u200b\u53d6\u503c\u200b\u5e26\u8bfb\u200b\u5c4f\u969c\u200b\n    if(ready) {\n      r.r1 = num + num;\n    } else {\n      r.r1 = 1;\n    }\n}\n</code></pre> <p></p> <ul> <li>\u200b\u5168\u80fd\u200b\u5c4f\u969c\u200b\uff1amfence\uff08modify/mix Barrier\uff09\uff0c\u200b\u517c\u5177\u200b sfence \u200b\u548c\u200b lfence \u200b\u7684\u200b\u529f\u80fd\u200b</li> </ul> <p>2. \u200b\u4fdd\u8bc1\u200b\u6709\u5e8f\u6027\u200b</p> <ul> <li>\u200b\u5199\u200b\u5c4f\u969c\u200b\u4f1a\u200b\u786e\u4fdd\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5c06\u200b\u5199\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b\u7684\u200b\u4ee3\u7801\u200b\u6392\u5728\u200b\u5199\u200b\u5c4f\u969c\u200b\u4e4b\u540e\u200b</li> <li>\u200b\u8bfb\u200b\u5c4f\u969c\u200b\u4f1a\u200b\u786e\u4fdd\u200b\u6307\u4ee4\u200b\u91cd\u200b\u6392\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5c06\u200b\u8bfb\u200b\u5c4f\u969c\u200b\u4e4b\u540e\u200b\u7684\u200b\u4ee3\u7801\u200b\u6392\u200b\u5728\u8bfb\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b</li> </ul> <p>3. \u200b\u4e0d\u80fd\u200b\u89e3\u51b3\u200b\u6307\u4ee4\u200b\u4ea4\u9519\u200b</p> <ul> <li>\u200b\u5199\u200b\u5c4f\u969c\u200b\u4ec5\u4ec5\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u4e4b\u540e\u200b\u7684\u200b\u8bfb\u200b\u80fd\u591f\u200b\u8bfb\u200b\u5230\u200b\u6700\u65b0\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8bfb\u200b\u8dd1\u200b\u5230\u200b\u5199\u200b\u5c4f\u969c\u200b\u4e4b\u524d\u200b</li> <li>\u200b\u6709\u5e8f\u6027\u200b\u7684\u200b\u4fdd\u8bc1\u200b\u4e5f\u200b\u53ea\u662f\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u672c\u200b\u7ebf\u7a0b\u200b\u5185\u200b\u76f8\u5173\u200b\u4ee3\u7801\u200b\u4e0d\u200b\u88ab\u200b\u91cd\u200b\u6392\u5e8f\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#3-volatile","title":"3. volatile \u200b\u5e94\u7528\u200b\u573a\u666f","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#31","title":"3.1 \u200b\u53cc\u7aef\u200b\u68c0\u9501","text":"<p>Double-Checked Locking\uff1a\u200b\u53cc\u7aef\u200b\u68c0\u9501\u200b\u673a\u5236\u200b</p> <p>DCL\uff08\u200b\u53cc\u7aef\u200b\u68c0\u9501\u200b\uff09\u200b\u673a\u5236\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u539f\u56e0\u200b\u662f\u200b\u6709\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u52a0\u5165\u200b volatile \u200b\u53ef\u4ee5\u200b\u7981\u6b62\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\uff0c\u200b\u8be6\u7ec6\u200b\u539f\u56e0\u200b\u770b\u200b\u4e0b\u6587\u200b\u3002</p> Java<pre><code>public final class Singleton {\n    private Singleton() { }\n    private static Singleton INSTANCE = null;\n\n    public static Singleton getInstance() {\n        if(INSTANCE == null) { // t2\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u5224\u65ad\u200b\u4e0d\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\n            // \u200b\u9996\u6b21\u200b\u8bbf\u95ee\u200b\u4f1a\u200b\u540c\u6b65\u200b\uff0c\u200b\u800c\u200b\u4e4b\u540e\u200b\u7684\u200b\u4f7f\u7528\u200b\u6ca1\u6709\u200b synchronized\n            synchronized(Singleton.class) {\n                // \u200b\u8fd9\u91cc\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u5224\u65ad\u200b\uff0c\u200b\u9632\u6b62\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u9501\u200b\u7684\u200b\u671f\u95f4\u200b\u5b8c\u6210\u200b\u4e86\u200b\u521d\u59cb\u5316\u200b\n                if (INSTANCE == null) { \n                    INSTANCE = new Singleton();\n                }\n            }\n        }\n        return INSTANCE;\n    }\n}\n</code></pre> <p>\u200b\u4e0d\u9501\u200b INSTANCE \u200b\u7684\u200b\u539f\u56e0\u200b\uff1a</p> <ul> <li>INSTANCE \u200b\u8981\u200b\u91cd\u65b0\u200b\u8d4b\u503c\u200b</li> <li>INSTANCE \u200b\u662f\u200b null\uff0c\u200b\u7ebf\u7a0b\u200b\u52a0\u9501\u200b\u4e4b\u524d\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5bf9\u8c61\u200b\u5934\u200b\uff0cnull \u200b\u6ca1\u6709\u200b\u5f15\u7528\u200b</li> </ul> <p>\u200b\u5b9e\u73b0\u200b\u7279\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u61d2\u60f0\u200b\u521d\u59cb\u5316\u200b</li> <li>\u200b\u9996\u6b21\u200b\u4f7f\u7528\u200b getInstance() \u200b\u624d\u200b\u4f7f\u7528\u200b synchronized \u200b\u52a0\u9501\u200b\uff0c\u200b\u540e\u7eed\u200b\u4f7f\u7528\u200b\u65f6\u200b\u65e0\u9700\u200b\u52a0\u9501\u200b</li> <li>\u200b\u7b2c\u4e00\u4e2a\u200b if \u200b\u4f7f\u7528\u200b\u4e86\u200b INSTANCE \u200b\u53d8\u91cf\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u540c\u6b65\u200b\u5757\u200b\u4e4b\u5916\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u73af\u5883\u200b\u4e0b\u4f1a\u200b\u4ea7\u751f\u200b\u95ee\u9898\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#32-dcl","title":"3.2 DCL \u200b\u95ee\u9898","text":"<p>getInstance \u200b\u65b9\u6cd5\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b57\u8282\u200b\u7801\u4e3a\u200b\uff1a</p> Java<pre><code>0:  getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n3:  ifnonnull       37\n6:  ldc             #3      // class test/Singleton\n8:  dup\n9:  astore_0\n10: monitorenter\n11: getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n14: ifnonnull 27\n17: new             #3      // class test/Singleton\n20: dup\n21: invokespecial   #4      // Method \"&lt;init&gt;\":()V\n24: putstatic       #2      // Field INSTANCE:Ltest/Singleton;\n27: aload_0\n28: monitorexit\n29: goto 37\n32: astore_1\n33: aload_0\n34: monitorexit\n35: aload_1\n36: athrow\n37: getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n40: areturn\n</code></pre> <ul> <li>17 \u200b\u8868\u793a\u200b\u521b\u5efa\u5bf9\u8c61\u200b\uff0c\u200b\u5c06\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\u5165\u6808\u200b</li> <li>20 \u200b\u8868\u793a\u200b\u590d\u5236\u200b\u4e00\u4efd\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\uff0c\u200b\u5f15\u7528\u200b\u5730\u5740\u200b</li> <li>21 \u200b\u8868\u793a\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\uff0c\u200b\u8c03\u7528\u200b\u6784\u9020\u65b9\u6cd5\u200b\u521d\u59cb\u5316\u200b\u5bf9\u8c61\u200b</li> <li>24 \u200b\u8868\u793a\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\uff0c\u200b\u8d4b\u503c\u200b\u7ed9\u200b static INSTANCE</li> </ul> <p>\u200b\u6b65\u9aa4\u200b 21 \u200b\u548c\u200b 24 \u200b\u4e4b\u95f4\u200b\u4e0d\u200b\u5b58\u5728\u200b\u6570\u636e\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u800c\u4e14\u200b\u65e0\u8bba\u200b\u91cd\u6392\u200b\u524d\u540e\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u5728\u200b\u5355\u7ebf\u7a0b\u200b\u4e2d\u200b\u5e76\u200b\u6ca1\u6709\u200b\u6539\u53d8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u79cd\u200b\u91cd\u6392\u200b\u4f18\u5316\u200b\u662f\u200b\u5141\u8bb8\u200b\u7684\u200b</p> <ul> <li>\u200b\u5173\u952e\u5728\u4e8e\u200b 0:getstatic \u200b\u8fd9\u200b\u884c\u200b\u4ee3\u7801\u200b\u5728\u200b monitor \u200b\u63a7\u5236\u200b\u4e4b\u5916\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8d8a\u8fc7\u200b monitor \u200b\u8bfb\u53d6\u200b INSTANCE \u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5f53\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b INSTANCE \u200b\u4e0d\u200b\u4e3a\u200b null \u200b\u65f6\u200b\uff0c\u200b\u7531\u4e8e\u200b INSTANCE \u200b\u5b9e\u4f8b\u200b\u672a\u5fc5\u200b\u5df2\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b t2 \u200b\u62ff\u5230\u200b\u7684\u200b\u662f\u200b\u5c06\u200b\u662f\u200b\u4e00\u4e2a\u200b\u672a\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6bd5\u200b\u7684\u200b\u5355\u4f8b\u200b\u8fd4\u56de\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u9020\u6210\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\u95ee\u9898\u200b</li> </ul> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#33","title":"3.3 \u200b\u89e3\u51b3\u529e\u6cd5","text":"<p>\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u53ea\u4f1a\u200b\u4fdd\u8bc1\u200b\u4e32\u884c\u200b\u8bed\u4e49\u200b\u7684\u200b\u6267\u884c\u200b\u4e00\u81f4\u6027\u200b\uff08\u200b\u5355\u7ebf\u7a0b\u200b\uff09\uff0c\u200b\u4f46\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u5173\u7cfb\u200b\u591a\u7ebf\u7a0b\u200b\u95f4\u200b\u7684\u200b\u8bed\u4e49\u200b\u4e00\u81f4\u6027\u200b</p> <p>\u200b\u5f15\u5165\u200b volatile\uff0c\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u7981\u6b62\u200b\u51fa\u73b0\u200b\u6307\u4ee4\u200b\u91cd\u6392\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4ece\u800c\u200b\u4fdd\u8bc1\u200b\u5355\u4f8b\u200b\u6a21\u5f0f\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u6027\u200b\uff1a</p> Java<pre><code>private static volatile SingletonDemo INSTANCE = null;\n</code></pre> <p>\u200b\u5f15\u5165\u200b volatile \u200b\u540e\u200b\uff0c\u200b\u5b57\u8282\u200b\u7801\u200b\u5c42\u9762\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b\uff1a</p> Java<pre><code>// ---------------------------------&gt; \u200b\u52a0\u5165\u200b\u5bf9\u200b INSTANCE \u200b\u53d8\u91cf\u200b\u7684\u200b\u8bfb\u200b\u5c4f\u969c\u200b\n0:  getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n3:  ifnonnull       37\n6:  ldc             #3      // class test/Singleton\n8:  dup\n9:  astore_0\n10: monitorenter // ----------------&gt; \u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\u3001\u200b\u53ef\u89c1\u200b\u6027\u200b\n11: getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n14: ifnonnull 27\n17: new             #3      // class test/Singleton\n20: dup\n21: invokespecial   #4      // Method \"&lt;init&gt;\":()V\n24: putstatic       #2      // Field INSTANCE:Ltest/Singleton;\n// ---------------------------------&gt; \u200b\u52a0\u5165\u200b\u5bf9\u200b INSTANCE \u200b\u53d8\u91cf\u200b\u7684\u200b\u5199\u200b\u5c4f\u969c\u200b\n27: aload_0\n28: monitorexit // ----------------&gt; \u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\u3001\u200b\u53ef\u89c1\u200b\u6027\u200b\n29: goto 37\n32: astore_1\n33: aload_0\n34: monitorexit\n35: aload_1\n36: athrow\n37: getstatic       #2      // Field INSTANCE:Ltest/Singleton;\n40: areturn\n</code></pre> <p>\u200b\u6700\u7ec8\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/","title":"\u4e0d\u53ef\u4e0d\u200b\u8bf4\u200b\u7684\u200bJava\u201c\u200b\u9501\u200b\u201d\u200b\u4e8b","text":"<p> \u200b\u7ea6\u200b 8349 \u200b\u4e2a\u200b\u5b57\u200b  96 \u200b\u884c\u200b\u4ee3\u7801\u200b  17 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 29 \u200b\u5206\u949f\u200b</p> <p>Tip</p> <p>\u200b\u539f\u6587\u200b\u94fe\u63a5\u200b\uff1a\u200b\u4e0d\u53ef\u4e0d\u200b\u8bf4\u200b\u7684\u200bJava\u201c\u200b\u9501\u200b\u201d\u200b\u4e8b\u200b - \u200b\u7f8e\u56e2\u200b\u6280\u672f\u200b\u56e2\u961f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#_1","title":"\u524d\u8a00","text":"<p>Java\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u79cd\u7c7b\u200b\u4e30\u5bcc\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u6bcf\u79cd\u200b\u9501\u200b\u56e0\u200b\u5176\u200b\u7279\u6027\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5728\u200b\u9002\u5f53\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\u80fd\u591f\u200b\u5c55\u73b0\u51fa\u200b\u975e\u5e38\u200b\u9ad8\u200b\u7684\u200b\u6548\u7387\u200b\u3002\u200b\u672c\u6587\u200b\u65e8\u5728\u200b\u5bf9\u9501\u200b\u76f8\u5173\u200b\u6e90\u7801\u200b\uff08\u200b\u672c\u6587\u200b\u4e2d\u200b\u7684\u200b\u6e90\u7801\u200b\u6765\u81ea\u200bJDK 8\u200b\u548c\u200bNetty 3.10.6\uff09\u3001\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u8fdb\u884c\u200b\u4e3e\u4f8b\u200b\uff0c\u200b\u4e3a\u200b\u8bfb\u8005\u200b\u4ecb\u7ecd\u200b\u4e3b\u6d41\u200b\u9501\u200b\u7684\u200b\u77e5\u8bc6\u70b9\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4e0d\u540c\u200b\u7684\u200b\u9501\u200b\u7684\u200b\u9002\u7528\u200b\u573a\u666f\u200b\u3002</p> <p>Java\u200b\u4e2d\u200b\u5f80\u5f80\u200b\u662f\u200b\u6309\u7167\u200b\u662f\u5426\u200b\u542b\u6709\u200b\u67d0\u4e00\u200b\u7279\u6027\u200b\u6765\u200b\u5b9a\u4e49\u200b\u9501\u200b\uff0c\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b\u7279\u6027\u200b\u5c06\u200b\u9501\u200b\u8fdb\u884c\u200b\u5206\u7ec4\u200b\u5f52\u7c7b\u200b\uff0c\u200b\u518d\u200b\u4f7f\u7528\u200b\u5bf9\u6bd4\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fdb\u884c\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u5927\u5bb6\u200b\u66f4\u200b\u5feb\u6377\u200b\u7684\u200b\u7406\u89e3\u200b\u76f8\u5173\u200b\u77e5\u8bc6\u200b\u3002\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u672c\u6587\u200b\u5185\u5bb9\u200b\u7684\u200b\u603b\u4f53\u200b\u5206\u7c7b\u76ee\u5f55\u200b\uff1a</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#1-vs","title":"1. \u200b\u4e50\u89c2\u200b\u9501\u200b VS \u200b\u60b2\u89c2\u200b\u9501","text":"<p>\u200b\u4e50\u89c2\u200b\u9501\u200b\u4e0e\u200b\u60b2\u89c2\u200b\u9501\u200b\u662f\u200b\u4e00\u79cd\u200b\u5e7f\u4e49\u200b\u4e0a\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u4f53\u73b0\u200b\u4e86\u200b\u770b\u5f85\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\u7684\u200b\u4e0d\u540c\u200b\u89d2\u5ea6\u200b\u3002\u200b\u5728\u200bJava\u200b\u548c\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u90fd\u200b\u6709\u200b\u6b64\u200b\u6982\u5ff5\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b9e\u9645\u200b\u5e94\u7528\u200b\u3002</p> <p>\u200b\u5148\u8bf4\u200b\u6982\u5ff5\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b\u6570\u636e\u200b\u7684\u200b\u5e76\u53d1\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u60b2\u89c2\u200b\u9501\u200b\u8ba4\u4e3a\u200b\u81ea\u5df1\u200b\u5728\u200b\u4f7f\u7528\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u4e00\u5b9a\u200b\u6709\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u6765\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u83b7\u53d6\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u5148\u200b\u52a0\u9501\u200b\uff0c\u200b\u786e\u4fdd\u200b\u6570\u636e\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u3002Java\u200b\u4e2d\u200b\uff0csynchronized\u200b\u5173\u952e\u5b57\u200b\u548c\u200bLock\u200b\u7684\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u90fd\u200b\u662f\u200b\u60b2\u89c2\u200b\u9501\u200b\u3002</p> <p>\u200b\u800c\u200b\u4e50\u89c2\u200b\u9501\u200b\u8ba4\u4e3a\u200b\u81ea\u5df1\u200b\u5728\u200b\u4f7f\u7528\u200b\u6570\u636e\u200b\u65f6\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u4f1a\u200b\u6dfb\u52a0\u200b\u9501\u200b\uff0c\u200b\u53ea\u662f\u200b\u5728\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u53bb\u200b\u5224\u65ad\u200b\u4e4b\u524d\u200b\u6709\u6ca1\u6709\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u66f4\u65b0\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u88ab\u200b\u66f4\u65b0\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u81ea\u5df1\u200b\u4fee\u6539\u200b\u7684\u200b\u6570\u636e\u200b\u6210\u529f\u200b\u5199\u5165\u200b\u3002\u200b\u5982\u679c\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u66f4\u65b0\u200b\uff0c\u200b\u5219\u200b\u6839\u636e\u200b\u4e0d\u540c\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u6267\u884c\u200b\u4e0d\u540c\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff08\u200b\u4f8b\u5982\u200b\u62a5\u9519\u200b\u6216\u8005\u200b\u81ea\u52a8\u200b\u91cd\u8bd5\u200b\uff09\u3002</p> <p>\u200b\u4e50\u89c2\u200b\u9501\u200b\u5728\u200bJava\u200b\u4e2d\u662f\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b\u65e0\u9501\u200b\u7f16\u7a0b\u200b\u6765\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6700\u200b\u5e38\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200bCAS\u200b\u7b97\u6cd5\u200b\uff0cJava\u200b\u539f\u5b50\u200b\u7c7b\u4e2d\u200b\u7684\u200b\u9012\u589e\u200b\u64cd\u4f5c\u200b\u5c31\u200b\u901a\u8fc7\u200bCAS\u200b\u81ea\u65cb\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002</p> <p></p> <p>\u200b\u6839\u636e\u200b\u4ece\u200b\u4e0a\u9762\u200b\u7684\u200b\u6982\u5ff5\u200b\u63cf\u8ff0\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff1a</p> <ul> <li>\u200b\u60b2\u89c2\u200b\u9501\u200b\u9002\u5408\u200b\u5199\u200b\u64cd\u4f5c\u200b\u591a\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u5148\u200b\u52a0\u9501\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u5199\u200b\u64cd\u4f5c\u200b\u65f6\u200b\u6570\u636e\u200b\u6b63\u786e\u200b\u3002</li> <li>\u200b\u4e50\u89c2\u200b\u9501\u200b\u9002\u5408\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u591a\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u4e0d\u200b\u52a0\u9501\u200b\u7684\u200b\u7279\u70b9\u200b\u80fd\u591f\u200b\u4f7f\u200b\u5176\u8bfb\u200b\u64cd\u4f5c\u200b\u7684\u200b\u6027\u80fd\u200b\u5927\u5e45\u200b\u63d0\u5347\u200b\u3002</li> </ul> <p>\u200b\u5149\u8bf4\u200b\u6982\u5ff5\u200b\u6709\u4e9b\u200b\u62bd\u8c61\u200b\uff0c\u200b\u6211\u4eec\u200b\u6765\u770b\u200b\u4e0b\u200b\u4e50\u89c2\u200b\u9501\u200b\u548c\u200b\u60b2\u89c2\u200b\u9501\u200b\u7684\u200b\u8c03\u7528\u200b\u65b9\u5f0f\u200b\u793a\u4f8b\u200b\uff1a</p> Java<pre><code>// ------------------------- \u200b\u60b2\u89c2\u200b\u9501\u200b\u7684\u200b\u8c03\u7528\u200b\u65b9\u5f0f\u200b -------------------------\n// synchronized\npublic synchronized void testMethod() {\n    // \u200b\u64cd\u4f5c\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\n}\n// ReentrantLock\nprivate ReentrantLock lock = new ReentrantLock(); // \u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b\u9501\u200b\npublic void modifyPublicResources() {\n    lock.lock();\n    // \u200b\u64cd\u4f5c\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\n    lock.unlock();\n}\n\n// ------------------------- \u200b\u4e50\u89c2\u200b\u9501\u200b\u7684\u200b\u8c03\u7528\u200b\u65b9\u5f0f\u200b -------------------------\nprivate AtomicInteger atomicInteger = new AtomicInteger();  // \u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u540c\u4e00\u4e2a\u200bAtomicInteger\natomicInteger.incrementAndGet(); //\u200b\u6267\u884c\u200b\u81ea\u589e\u200b1\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b\u65b9\u5f0f\u200b\u793a\u4f8b\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u60b2\u89c2\u200b\u9501\u200b\u57fa\u672c\u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u663e\u5f0f\u200b\u7684\u200b\u9501\u5b9a\u200b\u4e4b\u540e\u200b\u518d\u200b\u64cd\u4f5c\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\uff0c\u200b\u800c\u200b\u4e50\u89c2\u200b\u9501\u5219\u200b\u76f4\u63a5\u200b\u53bb\u200b\u64cd\u4f5c\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u4e3a\u4f55\u200b\u4e50\u89c2\u200b\u9501\u200b\u80fd\u591f\u200b\u505a\u5230\u200b\u4e0d\u200b\u9501\u5b9a\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u7684\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\u5462\u200b\uff1f\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b\u4ecb\u7ecd\u200b\u4e50\u89c2\u200b\u9501\u200b\u7684\u200b\u4e3b\u8981\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b \u201cCAS\u201d \u200b\u7684\u200b\u6280\u672f\u200b\u539f\u7406\u200b\u6765\u200b\u4e3a\u200b\u5927\u5bb6\u200b\u89e3\u60d1\u200b\u3002</p> <p>CAS\u200b\u5168\u79f0\u200b Compare And Swap\uff08\u200b\u6bd4\u8f83\u200b\u4e0e\u200b\u4ea4\u6362\u200b\uff09\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u65e0\u9501\u200b\u7b97\u6cd5\u200b\u3002\u200b\u5728\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u9501\u200b\uff08\u200b\u6ca1\u6709\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u963b\u585e\u200b\uff09\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5b9e\u73b0\u200b\u591a\u7ebf\u7a0b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u53d8\u91cf\u200b\u540c\u6b65\u200b\u3002java.util.concurrent\u200b\u5305\u4e2d\u200b\u7684\u200b\u539f\u5b50\u200b\u7c7b\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200bCAS\u200b\u6765\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e50\u89c2\u200b\u9501\u200b\u3002</p> <p>CAS\u200b\u7b97\u6cd5\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\uff1a</p> <ul> <li>\u200b\u9700\u8981\u200b\u8bfb\u5199\u200b\u7684\u200b\u5185\u5b58\u200b\u503c\u200b V\u3002</li> <li>\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\u7684\u200b\u503c\u200b A\u3002</li> <li>\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u65b0\u503c\u200b B\u3002</li> </ul> <p>\u200b\u5f53\u4e14\u200b\u4ec5\u200b\u5f53\u200b V \u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b A \u200b\u65f6\u200b\uff0cCAS\u200b\u901a\u8fc7\u200b\u539f\u5b50\u200b\u65b9\u5f0f\u200b\u7528\u65b0\u503c\u200bB\u200b\u6765\u200b\u66f4\u65b0\u200bV\u200b\u7684\u200b\u503c\u200b\uff08\u201c\u200b\u6bd4\u8f83\u200b+\u200b\u66f4\u65b0\u200b\u201d\u200b\u6574\u4f53\u200b\u662f\u200b\u4e00\u4e2a\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff09\uff0c\u200b\u5426\u5219\u200b\u4e0d\u4f1a\u200b\u6267\u884c\u200b\u4efb\u4f55\u200b\u64cd\u4f5c\u200b\u3002\u200b\u4e00\u822c\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u201c\u200b\u66f4\u65b0\u200b\u201d\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e0d\u65ad\u200b\u91cd\u8bd5\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u4e4b\u524d\u200b\u63d0\u5230\u200bjava.util.concurrent\u200b\u5305\u4e2d\u200b\u7684\u200b\u539f\u5b50\u200b\u7c7b\u200b\uff0c\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200bCAS\u200b\u6765\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e50\u89c2\u200b\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u4eec\u200b\u8fdb\u5165\u200b\u539f\u5b50\u200b\u7c7b\u200bAtomicInteger\u200b\u7684\u200b\u6e90\u7801\u200b\uff0c\u200b\u770b\u200b\u4e00\u4e0b\u200bAtomicInteger\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff1a</p> <p></p> <p>\u200b\u6839\u636e\u200b\u5b9a\u4e49\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\u5404\u200b\u5c5e\u6027\u200b\u7684\u200b\u4f5c\u7528\u200b\uff1a</p> <ul> <li>unsafe\uff1a \u200b\u83b7\u53d6\u200b\u5e76\u200b\u64cd\u4f5c\u200b\u5185\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u3002</li> <li>valueOffset\uff1a \u200b\u5b58\u50a8\u200bvalue\u200b\u5728\u200bAtomicInteger\u200b\u4e2d\u200b\u7684\u200b\u504f\u79fb\u91cf\u200b\u3002</li> <li>value\uff1a \u200b\u5b58\u50a8\u200bAtomicInteger\u200b\u7684\u200bint\u200b\u503c\u200b\uff0c\u200b\u8be5\u200b\u5c5e\u6027\u200b\u9700\u8981\u200b\u501f\u52a9\u200bvolatile\u200b\u5173\u952e\u5b57\u200b\u4fdd\u8bc1\u200b\u5176\u200b\u5728\u7ebf\u200b\u7a0b\u95f4\u200b\u662f\u200b\u53ef\u89c1\u200b\u7684\u200b\u3002</li> </ul> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u6211\u4eec\u200b\u67e5\u770b\u200bAtomicInteger\u200b\u7684\u200b\u81ea\u200b\u589e\u51fd\u6570\u200bincrementAndGet()\u200b\u7684\u200b\u6e90\u7801\u200b\u65f6\u200b\uff0c\u200b\u53d1\u73b0\u200b\u81ea\u200b\u589e\u51fd\u6570\u200b\u5e95\u5c42\u200b\u8c03\u7528\u200b\u7684\u200b\u662f\u200bunsafe.getAndAddInt()\u3002\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200bJDK\u200b\u672c\u8eab\u200b\u53ea\u6709\u200bUnsafe.class\uff0c\u200b\u53ea\u200b\u901a\u8fc7\u200bclass\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u53c2\u6570\u200b\u540d\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u4e86\u89e3\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200bOpenJDK 8 \u200b\u6765\u200b\u67e5\u770b\u200bUnsafe\u200b\u7684\u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>// ------------------------- JDK 8 -------------------------\n// AtomicInteger \u200b\u81ea\u589e\u200b\u65b9\u6cd5\u200b\npublic final int incrementAndGet() {\n  return unsafe.getAndAddInt(this, valueOffset, 1) + 1;\n}\n\n// Unsafe.class\npublic final int getAndAddInt(Object var1, long var2, int var4) {\n  int var5;\n  do {\n      var5 = this.getIntVolatile(var1, var2);\n  } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4));\n  return var5;\n}\n\n// ------------------------- OpenJDK 8 -------------------------\n// Unsafe.java\npublic final int getAndAddInt(Object o, long offset, int delta) {\n   int v;\n   do {\n       v = getIntVolatile(o, offset);\n   } while (!compareAndSwapInt(o, offset, v, v + delta));\n   return v;\n}\n</code></pre> <p>\u200b\u6839\u636e\u200bOpenJDK 8\u200b\u7684\u200b\u6e90\u7801\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0cgetAndAddInt()\u200b\u5faa\u73af\u200b\u83b7\u53d6\u200b\u7ed9\u5b9a\u200b\u5bf9\u8c61\u200bo\u200b\u4e2d\u200b\u7684\u200b\u504f\u79fb\u91cf\u200b\u5904\u200b\u7684\u200b\u503c\u200bv\uff0c\u200b\u7136\u540e\u200b\u5224\u65ad\u200b\u5185\u5b58\u200b\u503c\u200b\u662f\u5426\u200b\u7b49\u4e8e\u200bv\u3002\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\u5219\u200b\u5c06\u200b\u5185\u5b58\u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b v + delta\uff0c\u200b\u5426\u5219\u200b\u8fd4\u56de\u200bfalse\uff0c\u200b\u7ee7\u7eed\u200b\u5faa\u73af\u200b\u8fdb\u884c\u200b\u91cd\u8bd5\u200b\uff0c\u200b\u76f4\u5230\u200b\u8bbe\u7f6e\u200b\u6210\u529f\u200b\u624d\u80fd\u200b\u9000\u51fa\u200b\u5faa\u73af\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5c06\u200b\u65e7\u503c\u200b\u8fd4\u56de\u200b\u3002\u200b\u6574\u4e2a\u200b\u201c\u200b\u6bd4\u8f83\u200b+\u200b\u66f4\u65b0\u200b\u201d\u200b\u64cd\u4f5c\u200b\u5c01\u88c5\u200b\u5728\u200bcompareAndSwapInt()\u200b\u4e2d\u200b\uff0c\u200b\u5728\u200bJNI\u200b\u91cc\u200b\u662f\u200b\u501f\u52a9\u4e8e\u200b\u4e00\u4e2a\u200bCPU\u200b\u6307\u4ee4\u200b\u5b8c\u6210\u200b\u7684\u200b\uff0c\u200b\u5c5e\u4e8e\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u80fd\u591f\u200b\u770b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\u7684\u200b\u4fee\u6539\u200b\u503c\u200b\u3002</p> <p>\u200b\u540e\u7eed\u200bJDK\u200b\u901a\u8fc7\u200bCPU\u200b\u7684\u200bcmpxchg\u200b\u6307\u4ee4\u200b\uff0c\u200b\u53bb\u200b\u6bd4\u8f83\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u7684\u200b A \u200b\u548c\u200b \u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b V\u3002\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u65b0\u503c\u200b B \u200b\u5b58\u5165\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u5c06\u200b\u5185\u5b58\u200b\u503c\u200b V \u200b\u8d4b\u503c\u200b\u7ed9\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b A\u3002\u200b\u7136\u540e\u200b\u901a\u8fc7\u200bJava\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u7684\u200bwhile\u200b\u5faa\u73af\u200b\u518d\u6b21\u200b\u8c03\u7528\u200bcmpxchg\u200b\u6307\u4ee4\u200b\u8fdb\u884c\u200b\u91cd\u8bd5\u200b\uff0c\u200b\u76f4\u5230\u200b\u8bbe\u7f6e\u200b\u6210\u529f\u200b\u4e3a\u6b62\u200b\u3002</p> <p>CAS\u200b\u867d\u7136\u200b\u5f88\u200b\u9ad8\u6548\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u4e5f\u200b\u5b58\u5728\u200b\u4e09\u5927\u200b\u95ee\u9898\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u7b80\u5355\u200b\u8bf4\u200b\u4e00\u4e0b\u200b\uff1a</p> <ol> <li>ABA\u200b\u95ee\u9898\u200b\u3002CAS\u200b\u9700\u8981\u200b\u5728\u200b\u64cd\u4f5c\u200b\u503c\u200b\u7684\u200b\u65f6\u5019\u200b\u68c0\u67e5\u200b\u5185\u5b58\u200b\u503c\u200b\u662f\u5426\u200b\u53d1\u751f\u53d8\u5316\u200b\uff0c\u200b\u6ca1\u6709\u200b\u53d1\u751f\u53d8\u5316\u200b\u624d\u200b\u4f1a\u200b\u66f4\u65b0\u200b\u5185\u5b58\u200b\u503c\u200b\u3002\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u503c\u200b\u539f\u6765\u200b\u662f\u200bA\uff0c\u200b\u540e\u6765\u200b\u53d8\u6210\u200b\u4e86\u200bB\uff0c\u200b\u7136\u540e\u200b\u53c8\u200b\u53d8\u6210\u200b\u4e86\u200bA\uff0c\u200b\u90a3\u4e48\u200bCAS\u200b\u8fdb\u884c\u200b\u68c0\u67e5\u200b\u65f6\u4f1a\u200b\u53d1\u73b0\u200b\u503c\u200b\u6ca1\u6709\u200b\u53d1\u751f\u53d8\u5316\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u6709\u200b\u53d8\u5316\u200b\u7684\u200b\u3002ABA\u200b\u95ee\u9898\u200b\u7684\u200b\u89e3\u51b3\u200b\u601d\u8def\u200b\u5c31\u662f\u200b\u5728\u200b\u53d8\u91cf\u200b\u524d\u9762\u200b\u6dfb\u52a0\u200b\u7248\u672c\u53f7\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u53d8\u91cf\u200b\u66f4\u65b0\u200b\u7684\u200b\u65f6\u5019\u200b\u90fd\u200b\u628a\u200b\u7248\u672c\u53f7\u200b\u52a0\u4e00\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53d8\u5316\u200b\u8fc7\u7a0b\u200b\u5c31\u200b\u4ece\u200b\u201cA\uff0dB\uff0dA\u201d\u200b\u53d8\u6210\u200b\u4e86\u200b\u201c1A\uff0d2B\uff0d3A\u201d\u3002</li> <li>JDK\u200b\u4ece\u200b1.5\u200b\u5f00\u59cb\u200b\u63d0\u4f9b\u200b\u4e86\u200bAtomicStampedReference\u200b\u7c7b\u6765\u200b\u89e3\u51b3\u200bABA\u200b\u95ee\u9898\u200b\uff0c\u200b\u5177\u4f53\u64cd\u4f5c\u200b\u5c01\u88c5\u200b\u5728\u200bcompareAndSet()\u200b\u4e2d\u200b\u3002compareAndSet()\u200b\u9996\u5148\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200b\u5f15\u7528\u200b\u548c\u200b\u5f53\u524d\u200b\u6807\u5fd7\u200b\u4e0e\u200b\u9884\u671f\u200b\u5f15\u7528\u200b\u548c\u200b\u9884\u671f\u200b\u6807\u5fd7\u200b\u662f\u5426\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5982\u679c\u200b\u90fd\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5219\u200b\u4ee5\u200b\u539f\u5b50\u200b\u65b9\u5f0f\u200b\u5c06\u200b\u5f15\u7528\u200b\u503c\u200b\u548c\u200b\u6807\u5fd7\u200b\u7684\u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u66f4\u65b0\u200b\u503c\u200b\u3002</li> <li>\u200b\u5faa\u73af\u200b\u65f6\u95f4\u200b\u957f\u200b\u5f00\u9500\u200b\u5927\u200b\u3002CAS\u200b\u64cd\u4f5c\u200b\u5982\u679c\u200b\u957f\u65f6\u95f4\u200b\u4e0d\u200b\u6210\u529f\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5176\u200b\u4e00\u76f4\u200b\u81ea\u65cb\u200b\uff0c\u200b\u7ed9\u200bCPU\u200b\u5e26\u6765\u200b\u975e\u5e38\u200b\u5927\u200b\u7684\u200b\u5f00\u9500\u200b\u3002</li> <li>\u200b\u53ea\u80fd\u200b\u4fdd\u8bc1\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0cCAS\u200b\u80fd\u591f\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u200b\u591a\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0cCAS\u200b\u662f\u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u64cd\u4f5c\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\u7684\u200b\u3002</li> <li>Java\u200b\u4ece\u200b1.5\u200b\u5f00\u59cb\u200bJDK\u200b\u63d0\u4f9b\u200b\u4e86\u200bAtomicReference\u200b\u7c7b\u6765\u200b\u4fdd\u8bc1\u200b\u5f15\u7528\u200b\u5bf9\u8c61\u200b\u4e4b\u95f4\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u591a\u4e2a\u200b\u53d8\u91cf\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u91cc\u200b\u6765\u200b\u8fdb\u884c\u200bCAS\u200b\u64cd\u4f5c\u200b\u3002</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#2-vs","title":"2. \u200b\u81ea\u65cb\u200b\u9501\u200b VS \u200b\u9002\u5e94\u6027\u200b\u81ea\u65cb\u200b\u9501","text":"<p>\u200b\u5728\u200b\u4ecb\u7ecd\u200b\u81ea\u65cb\u200b\u9501\u524d\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u524d\u63d0\u200b\u77e5\u8bc6\u200b\u6765\u200b\u5e2e\u52a9\u200b\u5927\u5bb6\u200b\u660e\u767d\u200b\u81ea\u65cb\u200b\u9501\u200b\u7684\u200b\u6982\u5ff5\u200b\u3002</p> <p>\u200b\u963b\u585e\u200b\u6216\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200bJava\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5207\u6362\u200bCPU\u200b\u72b6\u6001\u200b\u6765\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u72b6\u6001\u200b\u8f6c\u6362\u200b\u9700\u8981\u200b\u8017\u8d39\u200b\u5904\u7406\u5668\u200b\u65f6\u95f4\u200b\u3002\u200b\u5982\u679c\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\u8fc7\u4e8e\u200b\u7b80\u5355\u200b\uff0c\u200b\u72b6\u6001\u200b\u8f6c\u6362\u200b\u6d88\u8017\u200b\u7684\u200b\u65f6\u95f4\u200b\u6709\u200b\u53ef\u80fd\u200b\u6bd4\u200b\u7528\u6237\u200b\u4ee3\u7801\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\u8fd8\u8981\u200b\u957f\u200b\u3002</p> <p>\u200b\u5728\u200b\u8bb8\u591a\u200b\u573a\u666f\u200b\u4e2d\u200b\uff0c\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u7684\u200b\u9501\u5b9a\u200b\u65f6\u95f4\u200b\u5f88\u200b\u77ed\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8fd9\u200b\u4e00\u5c0f\u200b\u6bb5\u65f6\u95f4\u200b\u53bb\u200b\u5207\u6362\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b\u548c\u200b\u6062\u590d\u200b\u73b0\u573a\u200b\u7684\u200b\u82b1\u8d39\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8ba9\u200b\u7cfb\u7edf\u200b\u5f97\u4e0d\u507f\u5931\u200b\u3002\u200b\u5982\u679c\u200b\u7269\u7406\u200b\u673a\u5668\u200b\u6709\u200b\u591a\u4e2a\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u80fd\u591f\u200b\u8ba9\u200b\u4e24\u4e2a\u200b\u6216\u200b\u4ee5\u4e0a\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\u5e76\u884c\u6267\u884c\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u540e\u9762\u200b\u90a3\u4e2a\u200b\u8bf7\u6c42\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u200b\u653e\u5f03\u200bCPU\u200b\u7684\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\uff0c\u200b\u770b\u770b\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u5f88\u5feb\u200b\u5c31\u200b\u4f1a\u200b\u91ca\u653e\u200b\u9501\u200b\u3002</p> <p>\u200b\u800c\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u201c\u200b\u7a0d\u7b49\u4e00\u4e0b\u200b\u201d\uff0c\u200b\u6211\u4eec\u200b\u9700\u8ba9\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u81ea\u65cb\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u200b\u81ea\u65cb\u200b\u5b8c\u6210\u200b\u540e\u200b\u524d\u9762\u200b\u9501\u5b9a\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u91ca\u653e\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e0d\u5fc5\u200b\u963b\u585e\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u5207\u6362\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f00\u9500\u200b\u3002\u200b\u8fd9\u200b\u5c31\u662f\u200b\u81ea\u65cb\u200b\u9501\u200b\u3002</p> <p></p> <p>\u200b\u81ea\u65cb\u200b\u9501\u200b\u672c\u8eab\u200b\u662f\u200b\u6709\u200b\u7f3a\u70b9\u200b\u7684\u200b\uff0c\u200b\u5b83\u200b\u4e0d\u80fd\u200b\u4ee3\u66ff\u200b\u963b\u585e\u200b\u3002\u200b\u81ea\u65cb\u200b\u7b49\u5f85\u200b\u867d\u7136\u200b\u907f\u514d\u200b\u4e86\u200b\u7ebf\u7a0b\u200b\u5207\u6362\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u8981\u200b\u5360\u7528\u200b\u5904\u7406\u5668\u200b\u65f6\u95f4\u200b\u3002\u200b\u5982\u679c\u200b\u9501\u200b\u88ab\u200b\u5360\u7528\u200b\u7684\u200b\u65f6\u95f4\u200b\u5f88\u200b\u77ed\u200b\uff0c\u200b\u81ea\u65cb\u200b\u7b49\u5f85\u200b\u7684\u200b\u6548\u679c\u200b\u5c31\u200b\u4f1a\u200b\u975e\u5e38\u200b\u597d\u200b\u3002\u200b\u53cd\u4e4b\u200b\uff0c\u200b\u5982\u679c\u200b\u9501\u200b\u88ab\u200b\u5360\u7528\u200b\u7684\u200b\u65f6\u95f4\u200b\u5f88\u957f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u81ea\u65cb\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u53ea\u4f1a\u767d\u200b\u6d6a\u8d39\u200b\u5904\u7406\u5668\u200b\u8d44\u6e90\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u81ea\u65cb\u200b\u7b49\u5f85\u200b\u7684\u200b\u65f6\u95f4\u200b\u5fc5\u987b\u200b\u8981\u200b\u6709\u200b\u4e00\u5b9a\u200b\u7684\u200b\u9650\u5ea6\u200b\uff0c\u200b\u5982\u679c\u200b\u81ea\u65cb\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u9650\u5b9a\u200b\u6b21\u6570\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u662f\u200b10\u200b\u6b21\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b-XX:PreBlockSpin\u200b\u6765\u200b\u66f4\u6539\u200b\uff09\u200b\u6ca1\u6709\u200b\u6210\u529f\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0c\u200b\u5c31\u200b\u5e94\u5f53\u200b\u6302\u200b\u8d77\u200b\u7ebf\u7a0b\u200b\u3002</p> <p>\u200b\u81ea\u65cb\u200b\u9501\u200b\u7684\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u540c\u6837\u200b\u4e5f\u200b\u662f\u200bCAS\uff0cAtomicInteger\u200b\u4e2d\u200b\u8c03\u7528\u200bunsafe\u200b\u8fdb\u884c\u200b\u81ea\u589e\u200b\u64cd\u4f5c\u200b\u7684\u200b\u6e90\u7801\u200b\u4e2d\u200b\u7684\u200bdo-while\u200b\u5faa\u73af\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u81ea\u65cb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u679c\u200b\u4fee\u6539\u200b\u6570\u503c\u200b\u5931\u8d25\u200b\u5219\u200b\u901a\u8fc7\u200b\u5faa\u73af\u200b\u6765\u200b\u6267\u884c\u200b\u81ea\u65cb\u200b\uff0c\u200b\u76f4\u81f3\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\u3002</p> <p></p> <p>\u200b\u81ea\u65cb\u200b\u9501\u200b\u5728\u200bJDK1.4.2\u200b\u4e2d\u200b\u5f15\u5165\u200b\uff0c\u200b\u4f7f\u7528\u200b-XX:+UseSpinning\u200b\u6765\u200b\u5f00\u542f\u200b\u3002JDK 6\u200b\u4e2d\u200b\u53d8\u4e3a\u200b\u9ed8\u8ba4\u200b\u5f00\u542f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f15\u5165\u200b\u4e86\u200b\u81ea\u200b\u9002\u5e94\u200b\u7684\u200b\u81ea\u65cb\u200b\u9501\u200b\uff08\u200b\u9002\u5e94\u6027\u200b\u81ea\u65cb\u200b\u9501\u200b\uff09\u3002</p> <p>\u200b\u81ea\u200b\u9002\u5e94\u200b\u610f\u5473\u7740\u200b\u81ea\u65cb\u200b\u7684\u200b\u65f6\u95f4\u200b\uff08\u200b\u6b21\u6570\u200b\uff09\u200b\u4e0d\u518d\u200b\u56fa\u5b9a\u200b\uff0c\u200b\u800c\u662f\u200b\u7531\u524d\u200b\u4e00\u6b21\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u9501\u4e0a\u200b\u7684\u200b\u81ea\u65cb\u200b\u65f6\u95f4\u200b\u53ca\u9501\u200b\u7684\u200b\u62e5\u6709\u8005\u200b\u7684\u200b\u72b6\u6001\u200b\u6765\u200b\u51b3\u5b9a\u200b\u3002\u200b\u5982\u679c\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u9501\u200b\u5bf9\u8c61\u200b\u4e0a\u200b\uff0c\u200b\u81ea\u65cb\u200b\u7b49\u5f85\u200b\u521a\u521a\u200b\u6210\u529f\u200b\u83b7\u5f97\u200b\u8fc7\u9501\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u4e2d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u865a\u62df\u673a\u200b\u5c31\u200b\u4f1a\u200b\u8ba4\u4e3a\u200b\u8fd9\u6b21\u200b\u81ea\u65cb\u200b\u4e5f\u200b\u662f\u200b\u5f88\u200b\u6709\u200b\u53ef\u80fd\u200b\u518d\u6b21\u200b\u6210\u529f\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5b83\u200b\u5c06\u200b\u5141\u8bb8\u200b\u81ea\u65cb\u200b\u7b49\u5f85\u200b\u6301\u7eed\u200b\u76f8\u5bf9\u200b\u66f4\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u5982\u679c\u200b\u5bf9\u4e8e\u200b\u67d0\u4e2a\u200b\u9501\u200b\uff0c\u200b\u81ea\u65cb\u200b\u5f88\u5c11\u200b\u6210\u529f\u200b\u83b7\u5f97\u200b\u8fc7\u200b\uff0c\u200b\u90a3\u200b\u5728\u200b\u4ee5\u540e\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8fd9\u4e2a\u200b\u9501\u65f6\u200b\u5c06\u200b\u53ef\u80fd\u200b\u7701\u7565\u200b\u6389\u200b\u81ea\u65cb\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u907f\u514d\u6d6a\u8d39\u200b\u5904\u7406\u5668\u200b\u8d44\u6e90\u200b\u3002</p> <p>\u200b\u5728\u200b\u81ea\u65cb\u200b\u9501\u200b\u4e2d\u200b \u200b\u53e6\u6709\u200b\u4e09\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b\u9501\u200b\u5f62\u5f0f\u200b:TicketLock\u3001CLHlock\u200b\u548c\u200bMCSlock\uff0c\u200b\u672c\u6587\u200b\u4e2d\u4ec5\u200b\u505a\u200b\u540d\u8bcd\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u4e0d\u200b\u505a\u200b\u6df1\u5165\u200b\u8bb2\u89e3\u200b\uff0c\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u540c\u5b66\u200b\u53ef\u4ee5\u200b\u81ea\u884c\u200b\u67e5\u9605\u200b\u76f8\u5173\u200b\u8d44\u6599\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#3-vs-vs-vs","title":"3. \u200b\u65e0\u9501\u200b VS \u200b\u504f\u5411\u200b\u9501\u200b VS \u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b VS \u200b\u91cd\u91cf\u7ea7\u200b\u9501","text":"<p>\u200b\u8fd9\u200b\u56db\u79cd\u200b\u9501\u200b\u662f\u200b\u6307\u9501\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e13\u95e8\u200b\u9488\u5bf9\u200bsynchronized\u200b\u7684\u200b\u3002\u200b\u5728\u200b\u4ecb\u7ecd\u200b\u8fd9\u200b\u56db\u79cd\u200b\u9501\u200b\u72b6\u6001\u200b\u4e4b\u524d\u200b\u8fd8\u200b\u9700\u8981\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u77e5\u8bc6\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u4e3a\u4ec0\u4e48\u200bSynchronized\u200b\u80fd\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\uff1f</p> <p>\u200b\u5728\u200b\u56de\u7b54\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u4e4b\u524d\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u4e86\u89e3\u200b\u4e24\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u6982\u5ff5\u200b\uff1a\u201cJava\u200b\u5bf9\u8c61\u200b\u5934\u200b\u201d\u3001\u201cMonitor\u201d\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#java_1","title":"Java\u200b\u5bf9\u8c61\u200b\u5934","text":"<p>synchronized\u200b\u662f\u200b\u60b2\u89c2\u200b\u9501\u200b\uff0c\u200b\u5728\u200b\u64cd\u4f5c\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u4e4b\u524d\u200b\u9700\u8981\u200b\u7ed9\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u5148\u200b\u52a0\u9501\u200b\uff0c\u200b\u8fd9\u200b\u628a\u200b\u9501\u200b\u5c31\u662f\u200b\u5b58\u5728\u200bJava\u200b\u5bf9\u8c61\u200b\u5934\u91cc\u200b\u7684\u200b\uff0c\u200b\u800c\u200bJava\u200b\u5bf9\u8c61\u200b\u5934\u200b\u53c8\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5462\u200b\uff1f</p> <p>\u200b\u6211\u4eec\u200b\u4ee5\u200bHotspot\u200b\u865a\u62df\u673a\u200b\u4e3a\u4f8b\u200b\uff0cHotspot\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5934\u200b\u4e3b\u8981\u200b\u5305\u62ec\u200b\u4e24\u200b\u90e8\u5206\u200b\u6570\u636e\u200b\uff1aMark Word\uff08\u200b\u6807\u8bb0\u200b\u5b57\u200b\u6bb5\u200b\uff09\u3001Klass Pointer\uff08\u200b\u7c7b\u578b\u200b\u6307\u9488\u200b\uff09\u3002</p> <p>Mark Word\uff1a\u200b\u9ed8\u8ba4\u200b\u5b58\u50a8\u200b\u5bf9\u8c61\u200b\u7684\u200bHashCode\uff0c\u200b\u5206\u4ee3\u200b\u5e74\u9f84\u200b\u548c\u200b\u9501\u200b\u6807\u5fd7\u200b\u4f4d\u200b\u4fe1\u606f\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u90fd\u200b\u662f\u200b\u4e0e\u200b\u5bf9\u8c61\u200b\u81ea\u8eab\u200b\u5b9a\u4e49\u200b\u65e0\u5173\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200bMark Word\u200b\u88ab\u200b\u8bbe\u8ba1\u200b\u6210\u200b\u4e00\u4e2a\u200b\u975e\u200b\u56fa\u5b9a\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u6781\u5c0f\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5185\u5b58\u200b\u5b58\u50a8\u200b\u5c3d\u91cf\u200b\u591a\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u5b83\u4f1a\u200b\u6839\u636e\u200b\u5bf9\u8c61\u200b\u7684\u200b\u72b6\u6001\u200b\u590d\u7528\u200b\u81ea\u5df1\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u5728\u200b\u8fd0\u884c\u200b\u671f\u95f4\u200bMark Word\u200b\u91cc\u200b\u5b58\u50a8\u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u968f\u7740\u200b\u9501\u200b\u6807\u5fd7\u200b\u4f4d\u200b\u7684\u200b\u53d8\u5316\u200b\u800c\u200b\u53d8\u5316\u200b\u3002</p> <p>Klass Point\uff1a\u200b\u5bf9\u8c61\u200b\u6307\u5411\u200b\u5b83\u200b\u7684\u200b\u7c7b\u5143\u200b\u6570\u636e\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u901a\u8fc7\u200b\u8fd9\u4e2a\u200b\u6307\u9488\u200b\u6765\u200b\u786e\u5b9a\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u662f\u200b\u54ea\u4e2a\u200b\u7c7b\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#monitor","title":"Monitor","text":"<p>Monitor\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\u6216\u200b\u4e00\u79cd\u200b\u540c\u6b65\u200b\u673a\u5236\u200b\uff0c\u200b\u901a\u5e38\u200b\u88ab\u200b\u63cf\u8ff0\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u3002\u200b\u6bcf\u200b\u4e00\u4e2a\u200bJava\u200b\u5bf9\u8c61\u200b\u5c31\u200b\u6709\u200b\u4e00\u628a\u200b\u770b\u4e0d\u89c1\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u79f0\u4e3a\u200b\u5185\u90e8\u200b\u9501\u200b\u6216\u8005\u200bMonitor\u200b\u9501\u200b\u3002</p> <p>Monitor\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u79c1\u6709\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u53ef\u7528\u200bmonitor record\u200b\u5217\u8868\u200b\uff0c\u200b\u540c\u65f6\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5168\u5c40\u200b\u7684\u200b\u53ef\u7528\u200b\u5217\u8868\u200b\u3002\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u88ab\u200b\u9501\u4f4f\u200b\u7684\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u4f1a\u200b\u548c\u200b\u4e00\u4e2a\u200bmonitor\u200b\u5173\u8054\u200b\uff0c\u200b\u540c\u65f6\u200bmonitor\u200b\u4e2d\u6709\u200b\u4e00\u4e2a\u200bOwner\u200b\u5b57\u200b\u6bb5\u200b\u5b58\u653e\u200b\u62e5\u6709\u200b\u8be5\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u552f\u4e00\u200b\u6807\u8bc6\u200b\uff0c\u200b\u8868\u793a\u200b\u8be5\u9501\u200b\u88ab\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u5360\u7528\u200b\u3002</p> <p>\u200b\u73b0\u5728\u200b\u8bdd\u9898\u200b\u56de\u5230\u200bsynchronized\uff0csynchronized\u200b\u901a\u8fc7\u200bMonitor\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\uff0cMonitor\u200b\u662f\u200b\u4f9d\u8d56\u4e8e\u200b\u5e95\u5c42\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200bMutex Lock\uff08\u200b\u4e92\u65a5\u200b\u9501\u200b\uff09\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u540c\u6b65\u200b\u3002</p> <p>\u200b\u5982\u540c\u200b\u6211\u4eec\u200b\u5728\u200b\u81ea\u65cb\u200b\u9501\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b\u201c\u200b\u963b\u585e\u200b\u6216\u200b\u5524\u9192\u200b\u4e00\u4e2a\u200bJava\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5207\u6362\u200bCPU\u200b\u72b6\u6001\u200b\u6765\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u72b6\u6001\u200b\u8f6c\u6362\u200b\u9700\u8981\u200b\u8017\u8d39\u200b\u5904\u7406\u5668\u200b\u65f6\u95f4\u200b\u3002\u200b\u5982\u679c\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\u8fc7\u4e8e\u200b\u7b80\u5355\u200b\uff0c\u200b\u72b6\u6001\u200b\u8f6c\u6362\u200b\u6d88\u8017\u200b\u7684\u200b\u65f6\u95f4\u200b\u6709\u200b\u53ef\u80fd\u200b\u6bd4\u200b\u7528\u6237\u200b\u4ee3\u7801\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\u8fd8\u8981\u200b\u957f\u200b\u201d\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u5c31\u662f\u200bsynchronized\u200b\u6700\u521d\u200b\u5b9e\u73b0\u200b\u540c\u6b65\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200bJDK 6\u200b\u4e4b\u524d\u200bsynchronized\u200b\u6548\u7387\u200b\u4f4e\u200b\u7684\u200b\u539f\u56e0\u200b\u3002\u200b\u8fd9\u79cd\u200b\u4f9d\u8d56\u4e8e\u200b\u64cd\u4f5c\u7cfb\u7edf\u200bMutex Lock\u200b\u6240\u200b\u5b9e\u73b0\u200b\u7684\u200b\u9501\u200b\u6211\u4eec\u200b\u79f0\u4e4b\u4e3a\u200b\u201c\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u201d\uff0cJDK 6\u200b\u4e2d\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u83b7\u5f97\u200b\u9501\u200b\u548c\u200b\u91ca\u653e\u200b\u9501\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u6d88\u8017\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u201c\u200b\u504f\u5411\u200b\u9501\u200b\u201d\u200b\u548c\u200b\u201c\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u201d\u3002</p> <p>\u200b\u6240\u4ee5\u200b\u76ee\u524d\u200b\u9501\u200b\u4e00\u5171\u200b\u6709\u200b4\u200b\u79cd\u200b\u72b6\u6001\u200b\uff0c\u200b\u7ea7\u522b\u200b\u4ece\u200b\u4f4e\u200b\u5230\u200b\u9ad8\u200b\u4f9d\u6b21\u200b\u662f\u200b\uff1a\u200b\u65e0\u9501\u200b\u3001\u200b\u504f\u5411\u200b\u9501\u200b\u3001\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u548c\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u3002\u200b\u9501\u200b\u72b6\u6001\u200b\u53ea\u80fd\u200b\u5347\u7ea7\u200b\u4e0d\u80fd\u200b\u964d\u7ea7\u200b\u3002</p> <p>\u200b\u901a\u8fc7\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u6211\u4eec\u200b\u5bf9\u200bsynchronized\u200b\u7684\u200b\u52a0\u9501\u200b\u673a\u5236\u200b\u4ee5\u53ca\u200b\u76f8\u5173\u200b\u77e5\u8bc6\u200b\u6709\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4e86\u89e3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u7ed9\u51fa\u200b\u56db\u79cd\u200b\u9501\u200b\u72b6\u6001\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7684\u200bMark Word\u200b\u5185\u5bb9\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u5206\u522b\u200b\u8bb2\u89e3\u200b\u56db\u79cd\u200b\u9501\u200b\u72b6\u6001\u200b\u7684\u200b\u601d\u8def\u200b\u4ee5\u53ca\u200b\u7279\u70b9\u200b\uff1a</p> \u200b\u9501\u200b\u72b6\u6001\u200b \u200b\u5b58\u50a8\u200b\u5185\u5bb9\u200b \u200b\u5b58\u50a8\u200b\u5185\u5bb9\u200b \u200b\u65e0\u9501\u200b \u200b\u5bf9\u8c61\u200b\u7684\u200bhashCode\u3001\u200b\u5bf9\u8c61\u200b\u5206\u4ee3\u200b\u5e74\u9f84\u200b\u3001\u200b\u662f\u5426\u662f\u200b\u504f\u5411\u200b\u9501\u200b\uff080\uff09 01 \u200b\u504f\u5411\u200b\u9501\u200b \u200b\u504f\u5411\u200b\u7ebf\u7a0b\u200bID\u3001\u200b\u504f\u5411\u200b\u65f6\u95f4\u200b\u6233\u200b\u3001\u200b\u5bf9\u8c61\u200b\u5206\u4ee3\u200b\u5e74\u9f84\u200b\u3001\u200b\u662f\u5426\u662f\u200b\u504f\u5411\u200b\u9501\u200b\uff081\uff09 01 \u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b \u200b\u6307\u5411\u200b\u6808\u4e2d\u9501\u200b\u8bb0\u5f55\u200b\u7684\u200b\u6307\u9488\u200b 00 \u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b \u200b\u6307\u5411\u200b\u4e92\u65a5\u200b\u91cf\u200b\uff08\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\uff09\u200b\u7684\u200b\u6307\u9488\u200b 10 <p>\u200b\u65e0\u9501\u200b</p> <p>\u200b\u65e0\u9501\u200b\u6ca1\u6709\u200b\u5bf9\u200b\u8d44\u6e90\u200b\u8fdb\u884c\u200b\u9501\u5b9a\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u80fd\u200b\u8bbf\u95ee\u200b\u5e76\u200b\u4fee\u6539\u200b\u540c\u4e00\u4e2a\u200b\u8d44\u6e90\u200b\uff0c\u200b\u4f46\u200b\u540c\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u80fd\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\u3002</p> <p>\u200b\u65e0\u9501\u200b\u7684\u200b\u7279\u70b9\u200b\u5c31\u662f\u200b\u4fee\u6539\u200b\u64cd\u4f5c\u200b\u5728\u200b\u5faa\u73af\u200b\u5185\u200b\u8fdb\u884c\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u7684\u200b\u5c1d\u8bd5\u200b\u4fee\u6539\u200b\u5171\u4eab\u8d44\u6e90\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u51b2\u7a81\u200b\u5c31\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\u5e76\u200b\u9000\u51fa\u200b\uff0c\u200b\u5426\u5219\u200b\u5c31\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u5faa\u73af\u200b\u5c1d\u8bd5\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u4fee\u6539\u200b\u540c\u4e00\u4e2a\u200b\u503c\u200b\uff0c\u200b\u5fc5\u5b9a\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u80fd\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\uff0c\u200b\u800c\u200b\u5176\u4ed6\u200b\u4fee\u6539\u200b\u5931\u8d25\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u91cd\u8bd5\u200b\u76f4\u5230\u200b\u4fee\u6539\u200b\u6210\u529f\u200b\u3002\u200b\u4e0a\u9762\u200b\u6211\u4eec\u200b\u4ecb\u7ecd\u200b\u7684\u200bCAS\u200b\u539f\u7406\u200b\u53ca\u200b\u5e94\u7528\u200b\u5373\u200b\u662f\u200b\u65e0\u9501\u200b\u7684\u200b\u5b9e\u73b0\u200b\u3002\u200b\u65e0\u9501\u200b\u65e0\u6cd5\u200b\u5168\u9762\u200b\u4ee3\u66ff\u200b\u6709\u9501\u200b\uff0c\u200b\u4f46\u200b\u65e0\u9501\u200b\u5728\u200b\u67d0\u4e9b\u200b\u573a\u5408\u200b\u4e0b\u200b\u7684\u200b\u6027\u80fd\u200b\u662f\u200b\u975e\u5e38\u200b\u9ad8\u200b\u7684\u200b\u3002</p> <p>\u200b\u504f\u5411\u200b\u9501\u200b</p> <p>\u200b\u504f\u5411\u200b\u9501\u200b\u662f\u200b\u6307\u200b\u4e00\u6bb5\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u4e00\u76f4\u200b\u88ab\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u964d\u4f4e\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u4ee3\u4ef7\u200b\u3002</p> <p>\u200b\u5728\u200b\u5927\u591a\u6570\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u9501\u200b\u603b\u662f\u200b\u7531\u200b\u540c\u4e00\u200b\u7ebf\u7a0b\u200b\u591a\u6b21\u200b\u83b7\u5f97\u200b\uff0c\u200b\u4e0d\u200b\u5b58\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u7ade\u4e89\u200b\uff0c\u200b\u6240\u4ee5\u200b\u51fa\u73b0\u200b\u4e86\u200b\u504f\u5411\u200b\u9501\u200b\u3002\u200b\u5176\u200b\u76ee\u6807\u200b\u5c31\u662f\u200b\u5728\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\u65f6\u200b\u80fd\u591f\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\u5757\u200b\u5e76\u200b\u83b7\u53d6\u200b\u9501\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5728\u200bMark Word\u200b\u91cc\u200b\u5b58\u50a8\u200b\u9501\u200b\u504f\u5411\u200b\u7684\u200b\u7ebf\u7a0b\u200bID\u3002\u200b\u5728\u7ebf\u200b\u7a0b\u200b\u8fdb\u5165\u200b\u548c\u200b\u9000\u51fa\u200b\u540c\u6b65\u200b\u5757\u200b\u65f6\u200b\u4e0d\u518d\u200b\u901a\u8fc7\u200bCAS\u200b\u64cd\u4f5c\u200b\u6765\u200b\u52a0\u9501\u200b\u548c\u200b\u89e3\u9501\u200b\uff0c\u200b\u800c\u662f\u200b\u68c0\u6d4b\u200bMark Word\u200b\u91cc\u200b\u662f\u5426\u200b\u5b58\u50a8\u200b\u7740\u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u504f\u5411\u200b\u9501\u200b\u3002\u200b\u5f15\u5165\u200b\u504f\u5411\u200b\u9501\u200b\u662f\u200b\u4e3a\u4e86\u200b\u5728\u200b\u65e0\u200b\u591a\u7ebf\u7a0b\u200b\u7ade\u4e89\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5c3d\u91cf\u51cf\u5c11\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u6267\u884c\u200b\u8def\u5f84\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u7684\u200b\u83b7\u53d6\u200b\u53ca\u200b\u91ca\u653e\u200b\u4f9d\u8d56\u200b\u591a\u6b21\u200bCAS\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u800c\u200b\u504f\u5411\u200b\u9501\u200b\u53ea\u200b\u9700\u8981\u200b\u5728\u200b\u7f6e\u6362\u200bThreadID\u200b\u7684\u200b\u65f6\u5019\u200b\u4f9d\u8d56\u200b\u4e00\u6b21\u200bCAS\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u504f\u5411\u200b\u9501\u200b\u53ea\u6709\u200b\u9047\u5230\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5c1d\u8bd5\u200b\u7ade\u4e89\u200b\u504f\u5411\u200b\u9501\u65f6\u200b\uff0c\u200b\u6301\u6709\u200b\u504f\u5411\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u624d\u200b\u4f1a\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u4e3b\u52a8\u200b\u91ca\u653e\u200b\u504f\u5411\u200b\u9501\u200b\u3002\u200b\u504f\u5411\u200b\u9501\u200b\u7684\u200b\u64a4\u9500\u200b\uff0c\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b\u5168\u5c40\u200b\u5b89\u5168\u200b\u70b9\u200b\uff08\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u65f6\u95f4\u200b\u70b9\u4e0a\u200b\u6ca1\u6709\u200b\u5b57\u8282\u200b\u7801\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\uff09\uff0c\u200b\u5b83\u4f1a\u200b\u9996\u5148\u200b\u6682\u505c\u200b\u62e5\u6709\u200b\u504f\u5411\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5224\u65ad\u200b\u9501\u200b\u5bf9\u8c61\u200b\u662f\u5426\u200b\u5904\u4e8e\u200b\u88ab\u200b\u9501\u5b9a\u200b\u72b6\u6001\u200b\u3002\u200b\u64a4\u9500\u200b\u504f\u5411\u200b\u9501\u540e\u200b\u6062\u590d\u200b\u5230\u200b\u65e0\u9501\u200b\uff08\u200b\u6807\u5fd7\u200b\u4f4d\u4e3a\u200b\u201c01\u201d\uff09\u200b\u6216\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\uff08\u200b\u6807\u5fd7\u200b\u4f4d\u4e3a\u200b\u201c00\u201d\uff09\u200b\u7684\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u504f\u5411\u200b\u9501\u200b\u5728\u200bJDK 6\u200b\u53ca\u200b\u4ee5\u540e\u200b\u7684\u200bJVM\u200b\u91cc\u200b\u662f\u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b\u7684\u200b\u3002\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200bJVM\u200b\u53c2\u6570\u200b\u5173\u95ed\u200b\u504f\u5411\u200b\u9501\u200b\uff1a-XX:-UseBiasedLocking=false\uff0c\u200b\u5173\u95ed\u200b\u4e4b\u540e\u200b\u7a0b\u5e8f\u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b</p> <p>\u200b\u662f\u200b\u6307\u5f53\u9501\u200b\u662f\u200b\u504f\u5411\u200b\u9501\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u88ab\u200b\u53e6\u5916\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u504f\u5411\u200b\u9501\u200b\u5c31\u200b\u4f1a\u200b\u5347\u7ea7\u200b\u4e3a\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u81ea\u65cb\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u5728\u200b\u4ee3\u7801\u200b\u8fdb\u5165\u200b\u540c\u6b65\u200b\u5757\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u540c\u6b65\u200b\u5bf9\u8c61\u200b\u9501\u200b\u72b6\u6001\u200b\u4e3a\u200b\u65e0\u9501\u200b\u72b6\u6001\u200b\uff08\u200b\u9501\u200b\u6807\u5fd7\u200b\u4f4d\u4e3a\u200b\u201c01\u201d\u200b\u72b6\u6001\u200b\uff0c\u200b\u662f\u5426\u200b\u4e3a\u200b\u504f\u5411\u200b\u9501\u4e3a\u200b\u201c0\u201d\uff09\uff0c\u200b\u865a\u62df\u673a\u200b\u9996\u5148\u200b\u5c06\u200b\u5728\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6808\u200b\u5e27\u200b\u4e2d\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b\u9501\u200b\u8bb0\u5f55\u200b\uff08Lock Record\uff09\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b58\u50a8\u200b\u9501\u200b\u5bf9\u8c61\u200b\u76ee\u524d\u200b\u7684\u200bMark Word\u200b\u7684\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u7136\u540e\u200b\u62f7\u8d1d\u200b\u5bf9\u8c61\u200b\u5934\u4e2d\u200b\u7684\u200bMark Word\u200b\u590d\u5236\u5230\u200b\u9501\u200b\u8bb0\u5f55\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u62f7\u8d1d\u200b\u6210\u529f\u200b\u540e\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u5c06\u200b\u4f7f\u7528\u200bCAS\u200b\u64cd\u4f5c\u200b\u5c1d\u8bd5\u200b\u5c06\u200b\u5bf9\u8c61\u200b\u7684\u200bMark Word\u200b\u66f4\u65b0\u200b\u4e3a\u200b\u6307\u5411\u200bLock Record\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200bLock Record\u200b\u91cc\u200b\u7684\u200bowner\u200b\u6307\u9488\u200b\u6307\u5411\u200b\u5bf9\u8c61\u200b\u7684\u200bMark Word\u3002</p> <p>\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u66f4\u65b0\u200b\u52a8\u4f5c\u200b\u6210\u529f\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u62e5\u6709\u200b\u4e86\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bf9\u8c61\u200bMark Word\u200b\u7684\u200b\u9501\u200b\u6807\u5fd7\u200b\u4f4d\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u201c00\u201d\uff0c\u200b\u8868\u793a\u200b\u6b64\u200b\u5bf9\u8c61\u200b\u5904\u4e8e\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u5b9a\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u7684\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\u5931\u8d25\u200b\u4e86\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u9996\u5148\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u5bf9\u8c61\u200b\u7684\u200bMark Word\u200b\u662f\u5426\u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6808\u200b\u5e27\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u5c31\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u62e5\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8fdb\u5165\u200b\u540c\u6b65\u200b\u5757\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff0c\u200b\u5426\u5219\u200b\u8bf4\u660e\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u7ade\u4e89\u200b\u9501\u200b\u3002</p> <p>\u200b\u82e5\u200b\u5f53\u524d\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7b49\u5f85\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5219\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u901a\u8fc7\u200b\u81ea\u65cb\u200b\u8fdb\u884c\u200b\u7b49\u5f85\u200b\u3002\u200b\u4f46\u662f\u200b\u5f53\u200b\u81ea\u65cb\u200b\u8d85\u8fc7\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u6216\u8005\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u6301\u6709\u200b\u9501\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5728\u200b\u81ea\u65cb\u200b\uff0c\u200b\u53c8\u200b\u6709\u200b\u7b2c\u4e09\u4e2a\u200b\u6765\u8bbf\u200b\u65f6\u200b\uff0c\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u5347\u7ea7\u200b\u4e3a\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u3002</p> <p>\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b</p> <p>\u200b\u5347\u7ea7\u200b\u4e3a\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u65f6\u200b\uff0c\u200b\u9501\u200b\u6807\u5fd7\u200b\u7684\u200b\u72b6\u6001\u503c\u200b\u53d8\u4e3a\u200b\u201c10\u201d\uff0c\u200b\u6b64\u65f6\u200bMark Word\u200b\u4e2d\u200b\u5b58\u50a8\u200b\u7684\u200b\u662f\u200b\u6307\u5411\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u6b64\u65f6\u200b\u7b49\u5f85\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u963b\u585e\u72b6\u6001\u200b\u3002</p> <p>\u200b\u6574\u4f53\u200b\u7684\u200b\u9501\u200b\u72b6\u6001\u200b\u5347\u7ea7\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u7efc\u4e0a\u200b\uff0c\u200b\u504f\u5411\u200b\u9501\u200b\u901a\u8fc7\u200b\u5bf9\u6bd4\u200bMark Word\u200b\u89e3\u51b3\u200b\u52a0\u9501\u200b\u95ee\u9898\u200b\uff0c\u200b\u907f\u514d\u200b\u6267\u884c\u200bCAS\u200b\u64cd\u4f5c\u200b\u3002\u200b\u800c\u200b\u8f7b\u91cf\u7ea7\u200b\u9501\u200b\u662f\u200b\u901a\u8fc7\u200b\u7528\u200bCAS\u200b\u64cd\u4f5c\u200b\u548c\u200b\u81ea\u65cb\u200b\u6765\u200b\u89e3\u51b3\u200b\u52a0\u9501\u200b\u95ee\u9898\u200b\uff0c\u200b\u907f\u514d\u200b\u7ebf\u7a0b\u200b\u963b\u585e\u200b\u548c\u200b\u5524\u9192\u200b\u800c\u200b\u5f71\u54cd\u200b\u6027\u80fd\u200b\u3002\u200b\u91cd\u91cf\u7ea7\u200b\u9501\u200b\u662f\u200b\u5c06\u200b\u9664\u4e86\u200b\u62e5\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4ee5\u5916\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u963b\u585e\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#4-vs","title":"4. \u200b\u516c\u5e73\u200b\u9501\u200b VS \u200b\u975e\u200b\u516c\u5e73\u200b\u9501","text":"<p>\u200b\u516c\u5e73\u200b\u9501\u200b\u662f\u200b\u6307\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u6309\u7167\u200b\u7533\u8bf7\u200b\u9501\u200b\u7684\u200b\u987a\u5e8f\u200b\u6765\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u76f4\u63a5\u200b\u8fdb\u5165\u200b\u961f\u5217\u200b\u4e2d\u200b\u6392\u961f\u200b\uff0c\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u624d\u80fd\u200b\u83b7\u5f97\u200b\u9501\u200b\u3002\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u4f18\u70b9\u200b\u662f\u200b\u7b49\u5f85\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u4f1a\u200b\u997f\u6b7b\u200b\u3002\u200b\u7f3a\u70b9\u200b\u662f\u200b\u6574\u4f53\u200b\u541e\u5410\u200b\u6548\u7387\u200b\u76f8\u5bf9\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u8981\u200b\u4f4e\u200b\uff0c\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u9664\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u4ee5\u5916\u200b\u7684\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u4f1a\u200b\u963b\u585e\u200b\uff0cCPU\u200b\u5524\u9192\u200b\u963b\u585e\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f00\u9500\u200b\u6bd4\u975e\u200b\u516c\u5e73\u200b\u9501\u5927\u200b\u3002</p> <p>\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u662f\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u52a0\u9501\u200b\u65f6\u200b\u76f4\u63a5\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u624d\u200b\u4f1a\u200b\u5230\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u7684\u200b\u961f\u5c3e\u200b\u7b49\u5f85\u200b\u3002\u200b\u4f46\u200b\u5982\u679c\u200b\u6b64\u65f6\u200b\u9501\u200b\u521a\u597d\u200b\u53ef\u7528\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u65e0\u9700\u200b\u963b\u585e\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u6709\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u540e\u200b\u7533\u8bf7\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5148\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u573a\u666f\u200b\u3002\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u4f18\u70b9\u200b\u662f\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u5524\u8d77\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u6574\u4f53\u200b\u7684\u200b\u541e\u5410\u200b\u6548\u7387\u9ad8\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7ebf\u7a0b\u200b\u6709\u200b\u51e0\u7387\u200b\u4e0d\u200b\u963b\u585e\u200b\u76f4\u63a5\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0cCPU\u200b\u4e0d\u5fc5\u200b\u5524\u9192\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u3002\u200b\u7f3a\u70b9\u200b\u662f\u200b\u5904\u4e8e\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u997f\u6b7b\u200b\uff0c\u200b\u6216\u8005\u200b\u7b49\u200b\u5f88\u200b\u4e45\u200b\u624d\u200b\u4f1a\u200b\u83b7\u5f97\u200b\u9501\u200b\u3002</p> <p>\u200b\u76f4\u63a5\u200b\u7528\u200b\u8bed\u8a00\u200b\u63cf\u8ff0\u200b\u53ef\u80fd\u200b\u6709\u70b9\u200b\u62bd\u8c61\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4f5c\u8005\u200b\u7528\u200b\u4ece\u200b\u522b\u5904\u200b\u770b\u5230\u200b\u7684\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u6765\u200b\u8bb2\u8ff0\u200b\u4e00\u4e0b\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u3002</p> <p></p> <p>\u200b\u5982\u4e0a\u56fe\u200b\u6240\u793a\u200b\uff0c\u200b\u5047\u8bbe\u200b\u6709\u200b\u4e00\u53e3\u200b\u6c34\u4e95\u200b\uff0c\u200b\u6709\u200b\u7ba1\u7406\u5458\u200b\u770b\u5b88\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b\u6709\u200b\u4e00\u628a\u200b\u9501\u200b\uff0c\u200b\u53ea\u6709\u200b\u62ff\u5230\u200b\u9501\u200b\u7684\u200b\u4eba\u624d\u200b\u80fd\u591f\u200b\u6253\u200b\u6c34\u200b\uff0c\u200b\u6253\u200b\u5b8c\u6c34\u8981\u200b\u628a\u200b\u9501\u200b\u8fd8\u7ed9\u200b\u7ba1\u7406\u5458\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u8fc7\u6765\u200b\u6253\u6c34\u200b\u7684\u200b\u4eba\u200b\u90fd\u200b\u8981\u200b\u7ba1\u7406\u5458\u200b\u7684\u200b\u5141\u8bb8\u200b\u5e76\u200b\u62ff\u5230\u200b\u9501\u200b\u4e4b\u540e\u200b\u624d\u80fd\u200b\u53bb\u200b\u6253\u6c34\u200b\uff0c\u200b\u5982\u679c\u200b\u524d\u9762\u200b\u6709\u4eba\u200b\u6b63\u5728\u200b\u6253\u200b\u6c34\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u60f3\u8981\u200b\u6253\u6c34\u200b\u7684\u200b\u4eba\u200b\u5c31\u200b\u5fc5\u987b\u200b\u6392\u961f\u200b\u3002\u200b\u7ba1\u7406\u5458\u200b\u4f1a\u200b\u67e5\u770b\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8981\u200b\u53bb\u200b\u6253\u6c34\u200b\u7684\u200b\u4eba\u200b\u662f\u4e0d\u662f\u200b\u961f\u4f0d\u200b\u91cc\u6392\u200b\u6700\u200b\u524d\u9762\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u7684\u8bdd\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u7ed9\u200b\u4f60\u200b\u9501\u200b\u8ba9\u200b\u4f60\u200b\u53bb\u200b\u6253\u6c34\u200b\uff1b\u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u662f\u200b\u6392\u200b\u7b2c\u4e00\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u5c31\u200b\u5fc5\u987b\u200b\u53bb\u961f\u200b\u5c3e\u200b\u6392\u961f\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u516c\u5e73\u200b\u9501\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b\u5bf9\u200b\u6253\u6c34\u200b\u7684\u200b\u4eba\u200b\u6ca1\u6709\u200b\u8981\u6c42\u200b\u3002\u200b\u5373\u4f7f\u200b\u7b49\u5f85\u200b\u961f\u4f0d\u200b\u91cc\u200b\u6709\u200b\u6392\u961f\u200b\u7b49\u5f85\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u5728\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u4eba\u521a\u200b\u6253\u200b\u5b8c\u6c34\u200b\u628a\u200b\u9501\u200b\u8fd8\u7ed9\u200b\u7ba1\u7406\u5458\u200b\u800c\u4e14\u200b\u7ba1\u7406\u5458\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5141\u8bb8\u200b\u7b49\u5f85\u200b\u961f\u4f0d\u200b\u91cc\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u4eba\u53bb\u200b\u6253\u6c34\u65f6\u200b\uff0c\u200b\u521a\u597d\u200b\u6765\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u63d2\u961f\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u63d2\u961f\u200b\u7684\u200b\u4eba\u200b\u662f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u7ba1\u7406\u5458\u200b\u90a3\u91cc\u200b\u62ff\u5230\u200b\u9501\u53bb\u200b\u6253\u6c34\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u6392\u961f\u200b\uff0c\u200b\u539f\u672c\u200b\u6392\u961f\u200b\u7b49\u5f85\u200b\u7684\u200b\u4eba\u200b\u53ea\u80fd\u200b\u7ee7\u7eed\u200b\u7b49\u5f85\u200b\u3002\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200bReentrantLock\u200b\u7684\u200b\u6e90\u7801\u200b\u6765\u200b\u8bb2\u89e3\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u3002</p> <p></p> <p>\u200b\u6839\u636e\u200b\u4ee3\u7801\u200b\u53ef\u77e5\u200b\uff0cReentrantLock\u200b\u91cc\u9762\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5185\u90e8\u200b\u7c7b\u200bSync\uff0cSync\u200b\u7ee7\u627f\u200bAQS\uff08AbstractQueuedSynchronizer\uff09\uff0c\u200b\u6dfb\u52a0\u200b\u9501\u200b\u548c\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u64cd\u4f5c\u200b\u5b9e\u9645\u4e0a\u200b\u90fd\u200b\u662f\u200b\u5728\u200bSync\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u5b83\u200b\u6709\u200b\u516c\u5e73\u200b\u9501\u200bFairSync\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200bNonfairSync\u200b\u4e24\u4e2a\u200b\u5b50\u7c7b\u200b\u3002ReentrantLock\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6784\u9020\u200b\u5668\u6765\u200b\u663e\u793a\u200b\u7684\u200b\u6307\u5b9a\u200b\u4f7f\u7528\u200b\u516c\u5e73\u200b\u9501\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u6765\u770b\u200b\u4e00\u4e0b\u200b\u516c\u5e73\u200b\u9501\u200b\u4e0e\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u52a0\u9501\u200b\u65b9\u6cd5\u200b\u7684\u200b\u6e90\u7801\u200b:</p> <p></p> <p>\u200b\u901a\u8fc7\u200b\u4e0a\u56fe\u200b\u4e2d\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u5bf9\u6bd4\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u660e\u663e\u200b\u7684\u200b\u770b\u51fa\u200b\u516c\u5e73\u200b\u9501\u200b\u4e0e\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200block()\u200b\u65b9\u6cd5\u200b\u552f\u4e00\u200b\u7684\u200b\u533a\u522b\u200b\u5c31\u200b\u5728\u4e8e\u200b\u516c\u5e73\u200b\u9501\u200b\u5728\u200b\u83b7\u53d6\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u65f6\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u9650\u5236\u200b\u6761\u4ef6\u200b\uff1ahasQueuedPredecessors()\u3002</p> <p></p> <p>\u200b\u518d\u200b\u8fdb\u5165\u200bhasQueuedPredecessors()\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e3b\u8981\u200b\u505a\u200b\u4e00\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u4e3b\u8981\u200b\u662f\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u4f4d\u4e8e\u200b\u540c\u6b65\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u5219\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u5426\u5219\u200b\u8fd4\u56de\u200bfalse\u3002</p> <p>\u200b\u7efc\u4e0a\u200b\uff0c\u200b\u516c\u5e73\u200b\u9501\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b\u540c\u6b65\u200b\u961f\u5217\u200b\u6765\u200b\u5b9e\u73b0\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u6309\u7167\u200b\u7533\u8bf7\u200b\u9501\u200b\u7684\u200b\u987a\u5e8f\u200b\u6765\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u516c\u5e73\u200b\u7684\u200b\u7279\u6027\u200b\u3002\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u52a0\u9501\u200b\u65f6\u200b\u4e0d\u200b\u8003\u8651\u200b\u6392\u961f\u200b\u7b49\u5f85\u200b\u95ee\u9898\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b58\u5728\u200b\u540e\u200b\u7533\u8bf7\u200b\u5374\u200b\u5148\u200b\u83b7\u5f97\u200b\u9501\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#5-vs","title":"5. \u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b VS \u200b\u975e\u53ef\u200b\u91cd\u5165\u200b\u9501","text":"<p>\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u53c8\u540d\u200b\u9012\u5f52\u200b\u9501\u200b\uff0c\u200b\u662f\u200b\u6307\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u5916\u5c42\u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u518d\u200b\u8fdb\u5165\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5185\u5c42\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u83b7\u53d6\u200b\u9501\u200b\uff08\u200b\u524d\u63d0\u200b\u9501\u200b\u5bf9\u8c61\u200b\u5f97\u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u6216\u8005\u200bclass\uff09\uff0c\u200b\u4e0d\u4f1a\u200b\u56e0\u4e3a\u200b\u4e4b\u524d\u200b\u5df2\u7ecf\u200b\u83b7\u53d6\u200b\u8fc7\u200b\u8fd8\u200b\u6ca1\u200b\u91ca\u653e\u200b\u800c\u200b\u963b\u585e\u200b\u3002Java\u200b\u4e2d\u200bReentrantLock\u200b\u548c\u200bsynchronized\u200b\u90fd\u200b\u662f\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff0c\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u7684\u200b\u4e00\u4e2a\u200b\u4f18\u70b9\u200b\u662f\u200b\u53ef\u200b\u4e00\u5b9a\u200b\u7a0b\u5ea6\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\u3002\u200b\u4e0b\u9762\u200b\u7528\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\uff1a</p> Java<pre><code>public class Widget {\n    public synchronized void doSomething() {\n        System.out.println(\"\u200b\u65b9\u6cd5\u200b1\u200b\u6267\u884c\u200b...\");\n        doOthers();\n    }\n\n    public synchronized void doOthers() {\n        System.out.println(\"\u200b\u65b9\u6cd5\u200b2\u200b\u6267\u884c\u200b...\");\n    }\n}\n</code></pre> <p>\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e2d\u200b\uff0c\u200b\u7c7b\u4e2d\u200b\u7684\u200b\u4e24\u4e2a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b\u88ab\u200b\u5185\u7f6e\u200b\u9501\u200bsynchronized\u200b\u4fee\u9970\u200b\u7684\u200b\uff0cdoSomething()\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u8c03\u7528\u200bdoOthers()\u200b\u65b9\u6cd5\u200b\u3002\u200b\u56e0\u4e3a\u200b\u5185\u7f6e\u200b\u9501\u200b\u662f\u200b\u53ef\u200b\u91cd\u5165\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u8c03\u7528\u200bdoOthers()\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u83b7\u5f97\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200bdoOthers()\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e0d\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u8c03\u7528\u200bdoOthers()\u200b\u4e4b\u524d\u200b\u9700\u8981\u200b\u5c06\u200b\u6267\u884c\u200bdoSomething()\u200b\u65f6\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u9501\u200b\u91ca\u653e\u200b\u6389\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u9501\u200b\u5df2\u200b\u88ab\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u6301\u6709\u200b\uff0c\u200b\u4e14\u200b\u65e0\u6cd5\u200b\u91ca\u653e\u200b\u3002\u200b\u6240\u4ee5\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002</p> <p>\u200b\u800c\u200b\u4e3a\u4ec0\u4e48\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5d4c\u5957\u200b\u8c03\u7528\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u81ea\u52a8\u200b\u83b7\u5f97\u200b\u9501\u200b\u5462\u200b\uff1f\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b\u56fe\u793a\u200b\u548c\u200b\u6e90\u7801\u200b\u6765\u200b\u5206\u522b\u200b\u89e3\u6790\u200b\u4e00\u4e0b\u200b\u3002</p> <p>\u200b\u8fd8\u662f\u200b\u6253\u6c34\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u6709\u200b\u591a\u200b\u4e2a\u4eba\u200b\u5728\u200b\u6392\u961f\u200b\u6253\u200b\u6c34\u200b\uff0c\u200b\u6b64\u65f6\u200b\u7ba1\u7406\u5458\u200b\u5141\u8bb8\u200b\u9501\u200b\u548c\u200b\u540c\u4e00\u4e2a\u200b\u4eba\u200b\u7684\u200b\u591a\u4e2a\u200b\u6c34\u6876\u200b\u7ed1\u5b9a\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u4eba\u7528\u200b\u591a\u4e2a\u200b\u6c34\u6876\u200b\u6253\u6c34\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u6c34\u6876\u200b\u548c\u200b\u9501\u200b\u7ed1\u5b9a\u200b\u5e76\u200b\u6253\u200b\u5b8c\u6c34\u200b\u4e4b\u540e\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u6c34\u6876\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u548c\u200b\u9501\u200b\u7ed1\u5b9a\u200b\u5e76\u200b\u5f00\u59cb\u200b\u6253\u200b\u6c34\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u6c34\u6876\u200b\u90fd\u200b\u6253\u200b\u5b8c\u6c34\u200b\u4e4b\u540e\u200b\u6253\u200b\u6c34\u200b\u4eba\u624d\u200b\u4f1a\u200b\u5c06\u200b\u9501\u200b\u8fd8\u7ed9\u200b\u7ba1\u7406\u5458\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u4eba\u200b\u7684\u200b\u6240\u6709\u200b\u6253\u200b\u6c34\u200b\u6d41\u7a0b\u200b\u90fd\u200b\u80fd\u591f\u200b\u6210\u529f\u200b\u6267\u884c\u200b\uff0c\u200b\u540e\u7eed\u200b\u7b49\u5f85\u200b\u7684\u200b\u4eba\u200b\u4e5f\u200b\u80fd\u591f\u200b\u6253\u5230\u200b\u6c34\u200b\u3002\u200b\u8fd9\u200b\u5c31\u662f\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u3002</p> <p></p> <p>\u200b\u4f46\u200b\u5982\u679c\u200b\u662f\u975e\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u7684\u8bdd\u200b\uff0c\u200b\u6b64\u65f6\u200b\u7ba1\u7406\u5458\u200b\u53ea\u200b\u5141\u8bb8\u200b\u9501\u200b\u548c\u200b\u540c\u4e00\u4e2a\u200b\u4eba\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6c34\u6876\u200b\u7ed1\u5b9a\u200b\u3002\u200b\u7b2c\u4e00\u4e2a\u200b\u6c34\u6876\u200b\u548c\u200b\u9501\u200b\u7ed1\u5b9a\u200b\u6253\u200b\u5b8c\u6c34\u200b\u4e4b\u540e\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7b2c\u4e8c\u4e2a\u200b\u6c34\u6876\u200b\u4e0d\u80fd\u200b\u548c\u200b\u9501\u200b\u7ed1\u5b9a\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u6253\u200b\u6c34\u200b\u3002\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u6574\u4e2a\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u88ab\u200b\u5524\u9192\u200b\u3002</p> <p></p> <p>\u200b\u4e4b\u524d\u200b\u6211\u4eec\u200b\u8bf4\u200b\u8fc7\u200bReentrantLock\u200b\u548c\u200bsynchronized\u200b\u90fd\u200b\u662f\u200b\u91cd\u5165\u200b\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b\u91cd\u5165\u200b\u9501\u200bReentrantLock\u200b\u4ee5\u53ca\u200b\u975e\u53ef\u200b\u91cd\u5165\u200b\u9501\u200bNonReentrantLock\u200b\u7684\u200b\u6e90\u7801\u200b\u6765\u200b\u5bf9\u6bd4\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u4e3a\u4ec0\u4e48\u200b\u975e\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u5728\u200b\u91cd\u590d\u200b\u8c03\u7528\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u65f6\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002</p> <p>\u200b\u9996\u5148\u200bReentrantLock\u200b\u548c\u200bNonReentrantLock\u200b\u90fd\u200b\u7ee7\u627f\u200b\u7236\u7c7b\u200bAQS\uff0c\u200b\u5176\u7236\u200b\u7c7b\u200bAQS\u200b\u4e2d\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540c\u6b65\u200b\u72b6\u6001\u200bstatus\u200b\u6765\u200b\u8ba1\u6570\u200b\u91cd\u200b\u5165\u200b\u6b21\u6570\u200b\uff0cstatus\u200b\u521d\u59cb\u503c\u200b\u4e3a\u200b0\u3002</p> <p>\u200b\u5f53\u200b\u7ebf\u7a0b\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u65f6\u200b\uff0c\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u5148\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u5e76\u200b\u66f4\u65b0\u200bstatus\u200b\u503c\u200b\uff0c\u200b\u5982\u679c\u200bstatus == 0\u200b\u8868\u793a\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u6267\u884c\u200b\u540c\u6b65\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5219\u200b\u628a\u200bstatus\u200b\u7f6e\u200b\u4e3a\u200b1\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u3002\u200b\u5982\u679c\u200bstatus != 0\uff0c\u200b\u5219\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u662f\u200b\u83b7\u53d6\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u7684\u8bdd\u200b\u6267\u884c\u200bstatus+1\uff0c\u200b\u4e14\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u518d\u6b21\u200b\u83b7\u53d6\u200b\u9501\u200b\u3002\u200b\u800c\u200b\u975e\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u662f\u200b\u76f4\u63a5\u200b\u53bb\u200b\u83b7\u53d6\u200b\u5e76\u200b\u5c1d\u8bd5\u200b\u66f4\u65b0\u200b\u5f53\u524d\u200bstatus\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5982\u679c\u200bstatus != 0\u200b\u7684\u8bdd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5176\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u963b\u585e\u200b\u3002</p> <p>\u200b\u91ca\u653e\u200b\u9501\u65f6\u200b\uff0c\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u540c\u6837\u200b\u5148\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200bstatus\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5728\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\u3002\u200b\u5982\u679c\u200bstatus-1 == 0\uff0c\u200b\u5219\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6240\u6709\u200b\u91cd\u590d\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u7136\u540e\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u624d\u200b\u4f1a\u200b\u771f\u6b63\u200b\u91ca\u653e\u200b\u9501\u200b\u3002\u200b\u800c\u200b\u975e\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u5219\u200b\u662f\u200b\u5728\u200b\u786e\u5b9a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e4b\u540e\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5c06\u200bstatus\u200b\u7f6e\u200b\u4e3a\u200b0\uff0c\u200b\u5c06\u200b\u9501\u200b\u91ca\u653e\u200b\u3002</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#6-vs","title":"6. \u200b\u72ec\u4eab\u200b\u9501\u200b VS \u200b\u5171\u4eab\u200b\u9501","text":"<p>\u200b\u72ec\u4eab\u200b\u9501\u200b\u548c\u200b\u5171\u4eab\u200b\u9501\u200b\u540c\u6837\u200b\u662f\u200b\u4e00\u79cd\u200b\u6982\u5ff5\u200b\u3002\u200b\u6211\u4eec\u200b\u5148\u200b\u4ecb\u7ecd\u200b\u4e00\u4e0b\u200b\u5177\u4f53\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u7136\u540e\u200b\u901a\u8fc7\u200bReentrantLock\u200b\u548c\u200bReentrantReadWriteLock\u200b\u7684\u200b\u6e90\u7801\u200b\u6765\u200b\u4ecb\u7ecd\u200b\u72ec\u4eab\u200b\u9501\u200b\u548c\u200b\u5171\u4eab\u200b\u9501\u200b\u3002</p> <p>\u200b\u72ec\u4eab\u200b\u9501\u200b\u4e5f\u200b\u53eb\u200b\u6392\u200b\u4ed6\u200b\u9501\u200b\uff0c\u200b\u662f\u200b\u6307\u8be5\u200b\u9501\u200b\u4e00\u6b21\u200b\u53ea\u80fd\u200b\u88ab\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u6301\u6709\u200b\u3002\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200bT\u200b\u5bf9\u200b\u6570\u636e\u200bA\u200b\u52a0\u4e0a\u200b\u6392\u5b83\u200b\u9501\u200b\u540e\u200b\uff0c\u200b\u5219\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u4e0d\u80fd\u200b\u518d\u200b\u5bf9\u200bA\u200b\u52a0\u200b\u4efb\u4f55\u200b\u7c7b\u578b\u200b\u7684\u200b\u9501\u200b\u3002\u200b\u83b7\u5f97\u200b\u6392\u5b83\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5373\u80fd\u200b\u8bfb\u6570\u636e\u200b\u53c8\u200b\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\u3002JDK\u200b\u4e2d\u200b\u7684\u200bsynchronized\u200b\u548c\u200bJUC\u200b\u4e2d\u200bLock\u200b\u7684\u200b\u5b9e\u73b0\u200b\u7c7b\u200b\u5c31\u662f\u200b\u4e92\u65a5\u200b\u9501\u200b\u3002</p> <p>\u200b\u5171\u4eab\u200b\u9501\u200b\u662f\u200b\u6307\u8be5\u200b\u9501\u200b\u53ef\u200b\u88ab\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u6240\u200b\u6301\u6709\u200b\u3002\u200b\u5982\u679c\u200b\u7ebf\u7a0b\u200bT\u200b\u5bf9\u200b\u6570\u636e\u200bA\u200b\u52a0\u4e0a\u200b\u5171\u4eab\u200b\u9501\u540e\u200b\uff0c\u200b\u5219\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u53ea\u80fd\u200b\u5bf9\u200bA\u200b\u518d\u200b\u52a0\u200b\u5171\u4eab\u200b\u9501\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u52a0\u6392\u200b\u5b83\u9501\u200b\u3002\u200b\u83b7\u5f97\u200b\u5171\u4eab\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u53ea\u80fd\u200b\u8bfb\u6570\u636e\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u72ec\u4eab\u200b\u9501\u200b\u4e0e\u200b\u5171\u4eab\u200b\u9501\u200b\u4e5f\u200b\u662f\u200b\u901a\u8fc7\u200bAQS\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5b9e\u73b0\u200b\u4e0d\u540c\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6765\u200b\u5b9e\u73b0\u200b\u72ec\u4eab\u200b\u6216\u8005\u200b\u5171\u4eab\u200b\u3002</p> <p>\u200b\u4e0b\u56fe\u200b\u4e3a\u200bReentrantReadWriteLock\u200b\u7684\u200b\u90e8\u5206\u200b\u6e90\u7801\u200b\uff1a</p> <p></p> <p>\u200b\u6211\u4eec\u200b\u770b\u5230\u200bReentrantReadWriteLock\u200b\u6709\u200b\u4e24\u628a\u200b\u9501\u200b\uff1aReadLock\u200b\u548c\u200bWriteLock\uff0c\u200b\u7531\u8bcd\u200b\u77e5\u610f\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u8bfb\u9501\u200b\u4e00\u4e2a\u200b\u5199\u9501\u200b\uff0c\u200b\u5408\u79f0\u200b\u201c\u200b\u8bfb\u5199\u200b\u9501\u200b\u201d\u3002\u200b\u518d\u8fdb\u4e00\u6b65\u200b\u89c2\u5bdf\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200bReadLock\u200b\u548c\u200bWriteLock\u200b\u662f\u200b\u9760\u200b\u5185\u90e8\u200b\u7c7b\u200bSync\u200b\u5b9e\u73b0\u200b\u7684\u200b\u9501\u200b\u3002Sync\u200b\u662f\u200bAQS\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u7c7b\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u7ed3\u6784\u200b\u5728\u200bCountDownLatch\u3001ReentrantLock\u3001Semaphore\u200b\u91cc\u9762\u200b\u4e5f\u200b\u90fd\u200b\u5b58\u5728\u200b\u3002</p> <p>\u200b\u5728\u200bReentrantReadWriteLock\u200b\u91cc\u9762\u200b\uff0c\u200b\u8bfb\u9501\u200b\u548c\u200b\u5199\u200b\u9501\u200b\u7684\u200b\u9501\u200b\u4e3b\u4f53\u200b\u90fd\u200b\u662f\u200bSync\uff0c\u200b\u4f46\u200b\u8bfb\u9501\u200b\u548c\u200b\u5199\u200b\u9501\u200b\u7684\u200b\u52a0\u9501\u200b\u65b9\u5f0f\u200b\u4e0d\u200b\u4e00\u6837\u200b\u3002\u200b\u8bfb\u9501\u200b\u662f\u200b\u5171\u4eab\u200b\u9501\u200b\uff0c\u200b\u5199\u9501\u200b\u662f\u200b\u72ec\u4eab\u200b\u9501\u200b\u3002\u200b\u8bfb\u9501\u200b\u7684\u200b\u5171\u4eab\u200b\u9501\u200b\u53ef\u200b\u4fdd\u8bc1\u200b\u5e76\u53d1\u200b\u8bfb\u200b\u975e\u5e38\u200b\u9ad8\u6548\u200b\uff0c\u200b\u800c\u200b\u8bfb\u5199\u200b\u3001\u200b\u5199\u8bfb\u200b\u3001\u200b\u5199\u5199\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e92\u65a5\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8bfb\u9501\u200b\u548c\u200b\u5199\u200b\u9501\u200b\u662f\u200b\u5206\u79bb\u200b\u7684\u200b\u3002\u200b\u6240\u4ee5\u200bReentrantReadWriteLock\u200b\u7684\u200b\u5e76\u53d1\u200b\u6027\u200b\u76f8\u6bd4\u200b\u4e00\u822c\u200b\u7684\u200b\u4e92\u65a5\u200b\u9501\u200b\u6709\u200b\u4e86\u200b\u5f88\u5927\u200b\u63d0\u5347\u200b\u3002</p> <p>\u200b\u90a3\u8bfb\u200b\u9501\u200b\u548c\u200b\u5199\u200b\u9501\u200b\u7684\u200b\u5177\u4f53\u200b\u52a0\u9501\u200b\u65b9\u5f0f\u200b\u6709\u200b\u4ec0\u4e48\u200b\u533a\u522b\u200b\u5462\u200b\uff1f\u200b\u5728\u200b\u4e86\u89e3\u200b\u6e90\u7801\u200b\u4e4b\u524d\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\u5176\u4ed6\u200b\u77e5\u8bc6\u200b\u3002 \u200b\u5728\u200b\u6700\u200b\u5f00\u59cb\u200b\u63d0\u53ca\u200bAQS\u200b\u7684\u200b\u65f6\u5019\u200b\u6211\u4eec\u200b\u4e5f\u200b\u63d0\u5230\u200b\u4e86\u200bstate\u200b\u5b57\u200b\u6bb5\u200b\uff08int\u200b\u7c7b\u578b\u200b\uff0c32\u200b\u4f4d\u200b\uff09\uff0c\u200b\u8be5\u5b57\u6bb5\u200b\u7528\u6765\u200b\u63cf\u8ff0\u200b\u6709\u200b\u591a\u5c11\u200b\u7ebf\u7a0b\u200b\u83b7\u200b\u6301\u6709\u200b\u9501\u200b\u3002</p> <p>\u200b\u5728\u200b\u72ec\u4eab\u200b\u9501\u200b\u4e2d\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u901a\u5e38\u200b\u662f\u200b0\u200b\u6216\u8005\u200b1\uff08\u200b\u5982\u679c\u200b\u662f\u200b\u91cd\u5165\u200b\u9501\u200b\u7684\u8bdd\u200bstate\u200b\u503c\u200b\u5c31\u662f\u200b\u91cd\u5165\u200b\u7684\u200b\u6b21\u6570\u200b\uff09\uff0c\u200b\u5728\u200b\u5171\u4eab\u200b\u9501\u200b\u4e2d\u200bstate\u200b\u5c31\u662f\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u6570\u91cf\u200b\u3002\u200b\u4f46\u662f\u200b\u5728\u200bReentrantReadWriteLock\u200b\u4e2d\u6709\u200b\u8bfb\u200b\u3001\u200b\u5199\u200b\u4e24\u628a\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u5728\u200b\u4e00\u4e2a\u200b\u6574\u578b\u200b\u53d8\u91cf\u200bstate\u200b\u4e0a\u200b\u5206\u522b\u200b\u63cf\u8ff0\u200b\u8bfb\u9501\u200b\u548c\u200b\u5199\u200b\u9501\u200b\u7684\u200b\u6570\u91cf\u200b\uff08\u200b\u6216\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u53eb\u200b\u72b6\u6001\u200b\uff09\u3002\u200b\u4e8e\u662f\u200b\u5c06\u200bstate\u200b\u53d8\u91cf\u200b\u201c\u200b\u6309\u4f4d\u200b\u5207\u5272\u200b\u201d\u200b\u5207\u200b\u5206\u6210\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u90e8\u5206\u200b\uff0c\u200b\u9ad8\u200b16\u200b\u4f4d\u200b\u8868\u793a\u200b\u8bfb\u9501\u200b\u72b6\u6001\u200b\uff08\u200b\u8bfb\u9501\u200b\u4e2a\u6570\u200b\uff09\uff0c\u200b\u4f4e\u200b16\u200b\u4f4d\u200b\u8868\u793a\u200b\u5199\u9501\u200b\u72b6\u6001\u200b\uff08\u200b\u5199\u9501\u200b\u4e2a\u6570\u200b\uff09\u3002\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u4e86\u89e3\u200b\u4e86\u200b\u6982\u5ff5\u200b\u4e4b\u540e\u200b\u6211\u4eec\u200b\u518d\u200b\u6765\u770b\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5148\u770b\u200b\u5199\u200b\u9501\u200b\u7684\u200b\u52a0\u9501\u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>protected final boolean tryAcquire(int acquires) {\n    Thread current = Thread.currentThread();\n    int c = getState(); // \u200b\u53d6\u200b\u5230\u200b\u5f53\u524d\u200b\u9501\u200b\u7684\u200b\u4e2a\u6570\u200b\n    int w = exclusiveCount(c); // \u200b\u53d6\u5199\u200b\u9501\u200b\u7684\u200b\u4e2a\u6570\u200bw\n    if (c != 0) { // \u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u4e86\u200b\u9501\u200b(c!=0)\n    // (Note: if c != 0 and w == 0 then shared count != 0)\n        if (w == 0 || current != getExclusiveOwnerThread()) // \u200b\u5982\u679c\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u6570\u200b\uff08w\uff09\u200b\u4e3a\u200b0\uff08\u200b\u6362\u8a00\u4e4b\u200b\u5b58\u5728\u200b\u8bfb\u9501\u200b\uff09 \u200b\u6216\u8005\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u8fd4\u56de\u200b\u5931\u8d25\u200b\n            return false;\n        if (w + exclusiveCount(acquires) &gt; MAX_COUNT)    // \u200b\u5982\u679c\u200b\u5199\u5165\u200b\u9501\u200b\u7684\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b\u6700\u5927\u6570\u200b\uff0865535\uff0c2\u200b\u7684\u200b16\u200b\u6b21\u65b9\u200b-1\uff09\u200b\u5c31\u200b\u629b\u51fa\u200b\u4e00\u4e2a\u200bError\u3002\n      throw new Error(\"Maximum lock count exceeded\");\n        // Reentrant acquire\n    setState(c + acquires);\n    return true;\n  }\n  if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) // \u200b\u5982\u679c\u200b\u5f53\u4e14\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u6570\u4e3a\u200b0\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u963b\u585e\u200b\u90a3\u4e48\u200b\u5c31\u200b\u8fd4\u56de\u200b\u5931\u8d25\u200b\uff1b\u200b\u6216\u8005\u200b\u5982\u679c\u200b\u901a\u8fc7\u200bCAS\u200b\u589e\u52a0\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u5931\u8d25\u200b\u4e5f\u200b\u8fd4\u56de\u200b\u5931\u8d25\u200b\u3002\n        return false;\n    setExclusiveOwnerThread(current); // \u200b\u5982\u679c\u200bc=0\uff0cw=0\u200b\u6216\u8005\u200bc&gt;0\uff0cw&gt;0\uff08\u200b\u91cd\u200b\u5165\u200b\uff09\uff0c\u200b\u5219\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6216\u9501\u200b\u7684\u200b\u62e5\u6709\u8005\u200b\n    return true;\n}\n</code></pre> <ul> <li>\u200b\u8fd9\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u9996\u5148\u200b\u53d6\u200b\u5230\u200b\u5f53\u524d\u200b\u9501\u200b\u7684\u200b\u4e2a\u6570\u200bc\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u901a\u8fc7\u200bc\u200b\u6765\u200b\u83b7\u53d6\u200b\u5199\u9501\u200b\u7684\u200b\u4e2a\u6570\u200bw\u3002\u200b\u56e0\u4e3a\u200b\u5199\u9501\u200b\u662f\u200b\u4f4e\u200b16\u200b\u4f4d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53d6\u4f4e\u200b16\u200b\u4f4d\u200b\u7684\u200b\u6700\u5927\u503c\u200b\u4e0e\u200b\u5f53\u524d\u200b\u7684\u200bc\u200b\u505a\u200b\u4e0e\u200b\u8fd0\u7b97\u200b\uff08 int w = exclusiveCount\u00a9; \uff09\uff0c\u200b\u9ad8\u200b16\u200b\u4f4d\u200b\u548c\u200b0\u200b\u4e0e\u200b\u8fd0\u7b97\u200b\u540e\u200b\u662f\u200b0\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u5c31\u662f\u200b\u4f4e\u4f4d\u200b\u8fd0\u7b97\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b\u6301\u6709\u200b\u5199\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6570\u76ee\u200b\u3002</li> <li>\u200b\u5728\u200b\u53d6\u5230\u200b\u5199\u200b\u9501\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u6570\u76ee\u200b\u540e\u200b\uff0c\u200b\u9996\u5148\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u4e86\u200b\u9501\u200b\u3002\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u4e86\u200b\u9501\u200b(c!=0)\uff0c\u200b\u5219\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u5199\u200b\u9501\u7ebf\u200b\u7a0b\u200b\u7684\u200b\u6570\u76ee\u200b\uff0c\u200b\u5982\u679c\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u6570\u4e3a\u200b0\uff08\u200b\u5373\u200b\u6b64\u65f6\u200b\u5b58\u5728\u200b\u8bfb\u9501\u200b\uff09\u200b\u6216\u8005\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u8fd4\u56de\u200b\u5931\u8d25\u200b\uff08\u200b\u6d89\u53ca\u200b\u5230\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff09\u3002</li> <li>\u200b\u5982\u679c\u200b\u5199\u5165\u200b\u9501\u200b\u7684\u200b\u6570\u91cf\u200b\u5927\u4e8e\u200b\u6700\u5927\u6570\u200b\uff0865535\uff0c2\u200b\u7684\u200b16\u200b\u6b21\u65b9\u200b-1\uff09\u200b\u5c31\u200b\u629b\u51fa\u200b\u4e00\u4e2a\u200bError\u3002</li> <li>\u200b\u5982\u679c\u200b\u5f53\u4e14\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u6570\u4e3a\u200b0\uff08\u200b\u90a3\u4e48\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\u4e5f\u200b\u5e94\u8be5\u200b\u4e3a\u200b0\uff0c\u200b\u56e0\u4e3a\u200b\u4e0a\u9762\u200b\u5df2\u7ecf\u200b\u5904\u7406\u200bc!=0\u200b\u7684\u200b\u60c5\u51b5\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u963b\u585e\u200b\u90a3\u4e48\u200b\u5c31\u200b\u8fd4\u56de\u200b\u5931\u8d25\u200b\uff1b\u200b\u5982\u679c\u200b\u901a\u8fc7\u200bCAS\u200b\u589e\u52a0\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u6570\u200b\u5931\u8d25\u200b\u4e5f\u200b\u8fd4\u56de\u200b\u5931\u8d25\u200b\u3002</li> <li>\u200b\u5982\u679c\u200bc=0,w=0\u200b\u6216\u8005\u200bc&gt;0,w&gt;0\uff08\u200b\u91cd\u200b\u5165\u200b\uff09\uff0c\u200b\u5219\u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6216\u9501\u200b\u7684\u200b\u62e5\u6709\u8005\u200b\uff0c\u200b\u8fd4\u56de\u200b\u6210\u529f\u200b\uff01</li> </ul> <p>tryAcquire()\u200b\u9664\u4e86\u200b\u91cd\u200b\u5165\u200b\u6761\u4ef6\u200b\uff08\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e3a\u200b\u83b7\u53d6\u200b\u4e86\u200b\u5199\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff09\u200b\u4e4b\u5916\u200b\uff0c\u200b\u589e\u52a0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8bfb\u9501\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u7684\u200b\u5224\u65ad\u200b\u3002\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u8bfb\u9501\u200b\uff0c\u200b\u5219\u200b\u5199\u200b\u9501\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u83b7\u53d6\u200b\uff0c\u200b\u539f\u56e0\u200b\u5728\u4e8e\u200b\uff1a\u200b\u5fc5\u987b\u200b\u786e\u4fdd\u200b\u5199\u9501\u200b\u7684\u200b\u64cd\u4f5c\u200b\u5bf9\u200b\u8bfb\u9501\u200b\u53ef\u89c1\u200b\uff0c\u200b\u5982\u679c\u200b\u5141\u8bb8\u200b\u8bfb\u9501\u200b\u5728\u200b\u5df2\u200b\u88ab\u200b\u83b7\u53d6\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5bf9\u200b\u5199\u200b\u9501\u200b\u7684\u200b\u83b7\u53d6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u5176\u4ed6\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u611f\u77e5\u200b\u5230\u200b\u5f53\u524d\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ea\u6709\u200b\u7b49\u5f85\u200b\u5176\u4ed6\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u91ca\u653e\u200b\u4e86\u200b\u8bfb\u9501\u200b\uff0c\u200b\u5199\u9501\u200b\u624d\u80fd\u200b\u88ab\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\uff0c\u200b\u800c\u200b\u5199\u200b\u9501\u200b\u4e00\u65e6\u200b\u88ab\u200b\u83b7\u53d6\u200b\uff0c\u200b\u5219\u200b\u5176\u4ed6\u200b\u8bfb\u5199\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u540e\u7eed\u200b\u8bbf\u95ee\u200b\u5747\u200b\u88ab\u200b\u963b\u585e\u200b\u3002\u200b\u5199\u9501\u200b\u7684\u200b\u91ca\u653e\u200b\u4e0e\u200bReentrantLock\u200b\u7684\u200b\u91ca\u653e\u200b\u8fc7\u7a0b\u200b\u57fa\u672c\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u91ca\u653e\u200b\u5747\u200b\u51cf\u5c11\u200b\u5199\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f53\u5199\u200b\u72b6\u6001\u200b\u4e3a\u200b0\u200b\u65f6\u200b\u8868\u793a\u200b\u5199\u9501\u200b\u5df2\u200b\u88ab\u200b\u91ca\u653e\u200b\uff0c\u200b\u7136\u540e\u200b\u7b49\u5f85\u200b\u7684\u200b\u8bfb\u5199\u200b\u7ebf\u7a0b\u200b\u624d\u200b\u80fd\u591f\u200b\u7ee7\u7eed\u200b\u8bbf\u95ee\u200b\u8bfb\u5199\u200b\u9501\u200b\uff0c\u200b\u540c\u65f6\u200b\u524d\u6b21\u200b\u5199\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4fee\u6539\u200b\u5bf9\u200b\u540e\u7eed\u200b\u7684\u200b\u8bfb\u5199\u200b\u7ebf\u7a0b\u200b\u53ef\u89c1\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\u662f\u200b\u8bfb\u9501\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>protected final int tryAcquireShared(int unused) {\n    Thread current = Thread.currentThread();\n    int c = getState();\n    if (exclusiveCount(c) != 0 &amp;&amp;\n        getExclusiveOwnerThread() != current)\n        return -1;                                   // \u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u83b7\u53d6\u200b\u4e86\u200b\u5199\u200b\u9501\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fdb\u5165\u200b\u7b49\u5f85\u200b\u72b6\u6001\u200b\n    int r = sharedCount(c);\n    if (!readerShouldBlock() &amp;&amp;\n        r &lt; MAX_COUNT &amp;&amp;\n        compareAndSetState(c, c + SHARED_UNIT)) {\n        if (r == 0) {\n            firstReader = current;\n            firstReaderHoldCount = 1;\n        } else if (firstReader == current) {\n            firstReaderHoldCount++;\n        } else {\n            HoldCounter rh = cachedHoldCounter;\n            if (rh == null || rh.tid != getThreadId(current))\n                cachedHoldCounter = rh = readHolds.get();\n            else if (rh.count == 0)\n                readHolds.set(rh);\n            rh.count++;\n        }\n        return 1;\n    }\n    return fullTryAcquireShared(current);\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5728\u200btryAcquireShared(int unused)\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u83b7\u53d6\u200b\u4e86\u200b\u5199\u200b\u9501\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fdb\u5165\u200b\u7b49\u5f85\u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u4e86\u200b\u5199\u200b\u9501\u200b\u6216\u8005\u200b\u5199\u9501\u200b\u672a\u200b\u88ab\u200b\u83b7\u53d6\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff08\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u4f9d\u9760\u200bCAS\u200b\u4fdd\u8bc1\u200b\uff09\u200b\u589e\u52a0\u200b\u8bfb\u72b6\u6001\u200b\uff0c\u200b\u6210\u529f\u200b\u83b7\u53d6\u200b\u8bfb\u9501\u200b\u3002\u200b\u8bfb\u9501\u200b\u7684\u200b\u6bcf\u6b21\u200b\u91ca\u653e\u200b\uff08\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u591a\u4e2a\u200b\u8bfb\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\u91ca\u653e\u200b\u8bfb\u9501\u200b\uff09\u200b\u5747\u200b\u51cf\u5c11\u200b\u8bfb\u72b6\u6001\u200b\uff0c\u200b\u51cf\u5c11\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u201c1&lt;&lt;16\u201d\u3002\u200b\u6240\u4ee5\u200b\u8bfb\u5199\u200b\u9501\u200b\u624d\u80fd\u200b\u5b9e\u73b0\u200b\u8bfb\u8bfb\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5171\u4eab\u200b\uff0c\u200b\u800c\u200b\u8bfb\u5199\u200b\u3001\u200b\u5199\u8bfb\u200b\u3001\u200b\u5199\u5199\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e92\u65a5\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u518d\u200b\u56de\u5934\u200b\u770b\u200b\u4e00\u4e0b\u200b\u4e92\u65a5\u200b\u9501\u200bReentrantLock\u200b\u4e2d\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u52a0\u9501\u200b\u6e90\u7801\u200b\uff1a</p> <p></p> <p>\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b\u5728\u200bReentrantLock\u200b\u867d\u7136\u200b\u6709\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u4e24\u79cd\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u4eec\u200b\u6dfb\u52a0\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u72ec\u4eab\u200b\u9501\u200b\u3002\u200b\u6839\u636e\u200b\u6e90\u7801\u200b\u6240\u793a\u200b\uff0c\u200b\u5f53\u67d0\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200block\u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u9501\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u540c\u6b65\u200b\u8d44\u6e90\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u9501\u4f4f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u4f7f\u7528\u200bCAS\u200b\u66f4\u65b0\u200bstate\u200b\u6210\u529f\u200b\u540e\u200b\u5c31\u200b\u4f1a\u200b\u6210\u529f\u200b\u62a2\u5360\u200b\u8be5\u200b\u8d44\u6e90\u200b\u3002\u200b\u800c\u200b\u5982\u679c\u200b\u516c\u5171\u8d44\u6e90\u200b\u88ab\u200b\u5360\u7528\u200b\u4e14\u200b\u4e0d\u662f\u200b\u88ab\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5360\u7528\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u52a0\u9501\u200b\u5931\u8d25\u200b\u3002\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u786e\u5b9a\u200bReentrantLock\u200b\u65e0\u8bba\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u8fd8\u662f\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u7684\u200b\u9501\u200b\u90fd\u200b\u662f\u200b\u90fd\u200b\u662f\u200b\u72ec\u4eab\u200b\u9501\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#_2","title":"\u7ed3\u8bed","text":"<p>\u200b\u672c\u6587\u200bJava\u200b\u4e2d\u200b\u5e38\u7528\u200b\u7684\u200b\u9501\u200b\u4ee5\u53ca\u200b\u5e38\u89c1\u200b\u7684\u200b\u9501\u200b\u7684\u200b\u6982\u5ff5\u200b\u8fdb\u884c\u200b\u4e86\u200b\u57fa\u672c\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u5e76\u200b\u4ece\u200b\u6e90\u7801\u200b\u4ee5\u53ca\u200b\u5b9e\u9645\u200b\u5e94\u7528\u200b\u7684\u200b\u89d2\u5ea6\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5bf9\u6bd4\u200b\u5206\u6790\u200b\u3002\u200b\u9650\u4e8e\u200b\u7bc7\u5e45\u200b\u4ee5\u53ca\u200b\u4e2a\u4eba\u200b\u6c34\u5e73\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5728\u200b\u672c\u7bc7\u200b\u6587\u7ae0\u200b\u4e2d\u200b\u5bf9\u200b\u6240\u6709\u200b\u5185\u5bb9\u200b\u8fdb\u884c\u200b\u6df1\u5c42\u6b21\u200b\u7684\u200b\u8bb2\u89e3\u200b\u3002</p> <p>\u200b\u5176\u5b9e\u200bJava\u200b\u672c\u8eab\u200b\u5df2\u7ecf\u200b\u5bf9\u9501\u200b\u672c\u8eab\u200b\u8fdb\u884c\u200b\u4e86\u200b\u826f\u597d\u200b\u7684\u200b\u5c01\u88c5\u200b\uff0c\u200b\u964d\u4f4e\u200b\u4e86\u200b\u7814\u53d1\u200b\u540c\u5b66\u200b\u5728\u200b\u5e73\u65f6\u200b\u5de5\u4f5c\u200b\u4e2d\u200b\u7684\u200b\u4f7f\u7528\u200b\u96be\u5ea6\u200b\u3002\u200b\u4f46\u662f\u200b\u7814\u53d1\u200b\u540c\u5b66\u200b\u4e5f\u200b\u9700\u8981\u200b\u719f\u6089\u200b\u9501\u200b\u7684\u200b\u5e95\u5c42\u200b\u539f\u7406\u200b\uff0c\u200b\u4e0d\u540c\u200b\u573a\u666f\u200b\u4e0b\u200b\u9009\u62e9\u200b\u6700\u200b\u9002\u5408\u200b\u7684\u200b\u9501\u200b\u3002\u200b\u800c\u4e14\u200b\u6e90\u7801\u200b\u4e2d\u200b\u7684\u200b\u601d\u8def\u200b\u90fd\u200b\u662f\u200b\u975e\u5e38\u200b\u597d\u200b\u7684\u200b\u601d\u8def\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u503c\u5f97\u200b\u5927\u5bb6\u200b\u53bb\u200b\u5b66\u4e60\u200b\u548c\u200b\u501f\u9274\u200b\u7684\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<ol> <li>\u300aJava\u200b\u5e76\u53d1\u200b\u7f16\u7a0b\u200b\u827a\u672f\u200b\u300b</li> <li>Java\u200b\u4e2d\u200b\u7684\u200b\u9501\u200b</li> <li>Java CAS \u200b\u539f\u7406\u200b\u5256\u6790\u200b</li> <li>Java\u200b\u5e76\u53d1\u200b\u2014\u2014\u200b\u5173\u952e\u5b57\u200bsynchronized\u200b\u89e3\u6790\u200b</li> <li>Java synchronized\u200b\u539f\u7406\u200b\u603b\u7ed3\u200b</li> <li>\u200b\u804a\u804a\u200b\u5e76\u53d1\u200b\uff08\u200b\u4e8c\u200b\uff09\u2014\u2014Java SE1.6\u200b\u4e2d\u200b\u7684\u200bSynchronized</li> <li>\u200b\u6df1\u5165\u200b\u7406\u89e3\u200b\u8bfb\u5199\u200b\u9501\u200b\u2014ReadWriteLock\u200b\u6e90\u7801\u200b\u5206\u6790\u200b</li> <li>\u3010JUC\u3011JDK1.8\u200b\u6e90\u7801\u200b\u5206\u6790\u200b\u4e4b\u200bReentrantReadWriteLock</li> <li>Java\u200b\u591a\u7ebf\u7a0b\u200b\uff08\u200b\u5341\u200b\uff09\u200b\u4e4b\u200bReentrantReadWriteLock\u200b\u6df1\u5165\u5206\u6790\u200b</li> <li>Java\u2013\u200b\u8bfb\u5199\u200b\u9501\u200b\u7684\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/","title":"\u4ece\u200bReentrantLock\u200b\u7684\u200b\u5b9e\u73b0\u200b\u770b\u200bAQS\u200b\u7684\u200b\u539f\u7406\u200b\u53ca\u200b\u5e94\u7528","text":"<p> \u200b\u7ea6\u200b 6031 \u200b\u4e2a\u200b\u5b57\u200b  491 \u200b\u884c\u200b\u4ee3\u7801\u200b  17 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 26 \u200b\u5206\u949f\u200b</p> <p>Tip</p> <p>\u200b\u539f\u6587\u200b\u94fe\u63a5\u200b\uff1a\u200b\u4ece\u200bReentrantLock\u200b\u7684\u200b\u5b9e\u73b0\u200b\u770b\u200bAQS\u200b\u7684\u200b\u539f\u7406\u200b\u53ca\u200b\u5e94\u7528\u200b - \u200b\u7f8e\u56e2\u200b\u6280\u672f\u200b\u56e2\u961f\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#_1","title":"\u524d\u8a00","text":"<p>Java\u200b\u4e2d\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u540c\u6b65\u200b\u7c7b\u200b\uff08Lock\u3001Semaphore\u3001ReentrantLock\u200b\u7b49\u200b\uff09\u200b\u90fd\u200b\u662f\u200b\u57fa\u4e8e\u200bAbstractQueuedSynchronizer\uff08\u200b\u7b80\u79f0\u200b\u4e3a\u200bAQS\uff09\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002AQS\u200b\u662f\u200b\u4e00\u79cd\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u539f\u5b50\u200b\u5f0f\u200b\u7ba1\u7406\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u3001\u200b\u963b\u585e\u200b\u548c\u200b\u5524\u9192\u200b\u7ebf\u7a0b\u200b\u529f\u80fd\u200b\u4ee5\u53ca\u200b\u961f\u5217\u200b\u6a21\u578b\u200b\u7684\u200b\u7b80\u5355\u200b\u6846\u67b6\u200b\u3002\u200b\u672c\u6587\u200b\u4f1a\u200b\u4ece\u200b\u5e94\u7528\u5c42\u200b\u9010\u6e10\u200b\u6df1\u5165\u200b\u5230\u200b\u539f\u7406\u200b\u5c42\u200b\uff0c\u200b\u5e76\u200b\u901a\u8fc7\u200bReentrantLock\u200b\u7684\u200b\u57fa\u672c\u200b\u7279\u6027\u200b\u548c\u200bReentrantLock\u200b\u4e0e\u200bAQS\u200b\u7684\u200b\u5173\u8054\u200b\uff0c\u200b\u6765\u200b\u6df1\u5165\u200b\u89e3\u8bfb\u200bAQS\u200b\u76f8\u5173\u200b\u72ec\u5360\u200b\u9501\u200b\u7684\u200b\u77e5\u8bc6\u70b9\u200b\uff0c\u200b\u540c\u65f6\u200b\u91c7\u53d6\u200b\u95ee\u7b54\u200b\u7684\u200b\u6a21\u5f0f\u200b\u6765\u200b\u5e2e\u52a9\u200b\u5927\u5bb6\u200b\u7406\u89e3\u200bAQS\u3002\u200b\u7531\u4e8e\u200b\u7bc7\u5e45\u200b\u539f\u56e0\u200b\uff0c\u200b\u672c\u7bc7\u200b\u6587\u7ae0\u200b\u4e3b\u8981\u200b\u9610\u8ff0\u200bAQS\u200b\u4e2d\u200b\u72ec\u5360\u200b\u9501\u200b\u7684\u200b\u903b\u8f91\u200b\u548c\u200bSync Queue\uff0c\u200b\u4e0d\u200b\u8bb2\u8ff0\u200b\u5305\u542b\u200b\u5171\u4eab\u200b\u9501\u200b\u548c\u200bCondition Queue\u200b\u7684\u200b\u90e8\u5206\u200b\uff08\u200b\u672c\u7bc7\u200b\u6587\u7ae0\u200b\u6838\u5fc3\u200b\u4e3a\u200bAQS\u200b\u539f\u7406\u200b\u5256\u6790\u200b\uff0c\u200b\u53ea\u662f\u200b\u7b80\u5355\u200b\u4ecb\u7ecd\u200b\u4e86\u200bReentrantLock\uff0c\u200b\u611f\u5174\u8da3\u200b\u540c\u5b66\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b\u4e00\u4e0b\u200bReentrantLock\u200b\u7684\u200b\u6e90\u7801\u200b\uff09\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u672c\u7bc7\u200b\u6587\u7ae0\u200b\u7684\u200b\u5927\u7eb2\u200b\u548c\u200b\u601d\u8def\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u4e8e\u200b\u5927\u5bb6\u200b\u66f4\u597d\u200b\u5730\u200b\u7406\u89e3\u200b\uff1a</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#1-reentrantlock","title":"1 ReentrantLock","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#11-reentrantlock","title":"1.1 ReentrantLock\u200b\u7279\u6027\u200b\u6982\u89c8","text":"<p>ReentrantLock\u200b\u610f\u601d\u200b\u4e3a\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff0c\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u80fd\u591f\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u4e34\u754c\u200b\u8d44\u6e90\u91cd\u590d\u200b\u52a0\u9501\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5e2e\u52a9\u200b\u5927\u5bb6\u200b\u66f4\u597d\u200b\u5730\u200b\u7406\u89e3\u200bReentrantLock\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u6211\u4eec\u200b\u5148\u200b\u5c06\u200bReentrantLock\u200b\u8ddf\u200b\u5e38\u7528\u200b\u7684\u200bSynchronized\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5176\u200b\u7279\u6027\u200b\u5982\u4e0b\u200b\uff08\u200b\u84dd\u8272\u200b\u90e8\u5206\u200b\u4e3a\u200b\u672c\u7bc7\u200b\u6587\u7ae0\u200b\u4e3b\u8981\u200b\u5256\u6790\u200b\u7684\u200b\u70b9\u200b\uff09\uff1a</p> <p></p> <p>\u200b\u4e0b\u9762\u200b\u901a\u8fc7\u200b\u4f2a\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8fdb\u884c\u200b\u66f4\u52a0\u200b\u76f4\u89c2\u200b\u7684\u200b\u6bd4\u8f83\u200b\uff1a</p> C#<pre><code>// **************************Synchronized\u200b\u7684\u200b\u4f7f\u7528\u200b\u65b9\u5f0f\u200b**************************\n// 1.\u200b\u7528\u4e8e\u200b\u4ee3\u7801\u200b\u5757\u200b\nsynchronized (this) {}\n// 2.\u200b\u7528\u4e8e\u200b\u5bf9\u8c61\u200b\nsynchronized (object) {}\n// 3.\u200b\u7528\u4e8e\u200b\u65b9\u6cd5\u200b\npublic synchronized void test () {}\n// 4.\u200b\u53ef\u200b\u91cd\u5165\u200b\nfor (int i = 0; i &lt; 100; i++) {\n    synchronized (this) {}\n}\n// **************************ReentrantLock\u200b\u7684\u200b\u4f7f\u7528\u200b\u65b9\u5f0f\u200b**************************\npublic void test () throw Exception {\n    // 1.\u200b\u521d\u59cb\u5316\u200b\u9009\u62e9\u200b\u516c\u5e73\u200b\u9501\u200b\u3001\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\n    ReentrantLock lock = new ReentrantLock(true);\n    // 2.\u200b\u53ef\u200b\u7528\u4e8e\u200b\u4ee3\u7801\u200b\u5757\u200b\n    lock.lock();\n    try {\n        try {\n            // 3.\u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u52a0\u9501\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u7075\u6d3b\u200b; \u200b\u5177\u6709\u200b\u53ef\u200b\u91cd\u5165\u200b\u7279\u6027\u200b\n            if(lock.tryLock(100, TimeUnit.MILLISECONDS)){ }\n        } finally {\n            // 4.\u200b\u624b\u52a8\u200b\u91ca\u653e\u200b\u9501\u200b\n            lock.unlock()\n        }\n    } finally {\n        lock.unlock();\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#12-reentrantlockaqs","title":"1.2 ReentrantLock\u200b\u4e0e\u200bAQS\u200b\u7684\u200b\u5173\u8054","text":"<p>\u200b\u901a\u8fc7\u200b\u4e0a\u6587\u200b\u6211\u4eec\u200b\u5df2\u7ecf\u200b\u4e86\u89e3\u200b\uff0cReentrantLock\u200b\u652f\u6301\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff08\u200b\u5173\u4e8e\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u539f\u7406\u200b\u5206\u6790\u200b\uff0c\u200b\u53ef\u200b\u53c2\u8003\u200b\u300a\u200b\u4e0d\u53ef\u4e0d\u200b\u8bf4\u200b\u7684\u200bJava\u201c\u200b\u9501\u200b\u201d\u200b\u4e8b\u200b\u300b\uff09\uff0c\u200b\u5e76\u4e14\u200bReentrantLock\u200b\u7684\u200b\u5e95\u5c42\u200b\u5c31\u662f\u200b\u7531\u200bAQS\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u90a3\u4e48\u200bReentrantLock\u200b\u662f\u200b\u5982\u4f55\u200b\u901a\u8fc7\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u4e0e\u200bAQS\u200b\u5173\u8054\u200b\u8d77\u6765\u200b\u5462\u200b\uff1f \u200b\u6211\u4eec\u200b\u7740\u91cd\u200b\u4ece\u200b\u8fd9\u200b\u4e24\u8005\u200b\u7684\u200b\u52a0\u9501\u200b\u8fc7\u7a0b\u200b\u6765\u200b\u7406\u89e3\u200b\u4e00\u4e0b\u200b\u5b83\u4eec\u200b\u4e0e\u200bAQS\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5173\u7cfb\u200b\uff08\u200b\u52a0\u9501\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4e0e\u200bAQS\u200b\u7684\u200b\u5173\u8054\u200b\u6bd4\u8f83\u200b\u660e\u663e\u200b\uff0c\u200b\u89e3\u9501\u200b\u6d41\u7a0b\u200b\u540e\u7eed\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\uff09\u3002</p> <p>\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u6e90\u7801\u200b\u4e2d\u200b\u7684\u200b\u52a0\u9501\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> Scala<pre><code>// java.util.concurrent.locks.ReentrantLock#NonfairSync\n\n// \u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\nstatic final class NonfairSync extends Sync {\n    ...\n    final void lock() {\n        if (compareAndSetState(0, 1))\n            setExclusiveOwnerThread(Thread.currentThread());\n        else\n            acquire(1);\n        }\n  ...\n}\n</code></pre> <p>\u200b\u8fd9\u5757\u200b\u4ee3\u7801\u200b\u7684\u200b\u542b\u4e49\u200b\u4e3a\u200b\uff1a</p> <ul> <li>\u200b\u82e5\u200b\u901a\u8fc7\u200bCAS\u200b\u8bbe\u7f6e\u200b\u53d8\u91cf\u200bState\uff08\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff09\u200b\u6210\u529f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u72ec\u5360\u200b\u7ebf\u7a0b\u200b\u3002</li> <li>\u200b\u82e5\u200b\u901a\u8fc7\u200bCAS\u200b\u8bbe\u7f6e\u200b\u53d8\u91cf\u200bState\uff08\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff09\u200b\u5931\u8d25\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200bAcquire\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u5904\u7406\u200b\u3002</li> </ul> <p>\u200b\u7b2c\u4e00\u6b65\u200b\u5f88\u200b\u597d\u200b\u7406\u89e3\u200b\uff0c\u200b\u4f46\u200b\u7b2c\u4e8c\u6b65\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u540e\u200b\uff0c\u200b\u540e\u7eed\u200b\u7684\u200b\u5904\u7406\u200b\u7b56\u7565\u200b\u662f\u200b\u600e\u4e48\u6837\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u8fd9\u5757\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u601d\u8003\u200b\uff1a</p> <ul> <li>\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u7684\u200b\u540e\u7eed\u200b\u6d41\u7a0b\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5462\u200b\uff1f\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u4e24\u79cd\u200b\u53ef\u80fd\u200b\uff1a</li> </ul> <p>(1) \u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u9501\u200b\u7ed3\u679c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5931\u8d25\u200b\uff0c\u200b\u83b7\u53d6\u200b\u9501\u200b\u6d41\u7a0b\u200b\u7ed3\u675f\u200b\u3002\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u4f1a\u200b\u6781\u5927\u200b\u964d\u4f4e\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5e76\u53d1\u200b\u5ea6\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u6211\u4eec\u200b\u5b9e\u9645\u200b\u7684\u200b\u9700\u6c42\u200b\u3002\u200b\u6240\u4ee5\u200b\u5c31\u200b\u9700\u8981\u200b\u4e0b\u9762\u200b\u8fd9\u79cd\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200bAQS\u200b\u6846\u67b6\u200b\u7684\u200b\u5904\u7406\u200b\u6d41\u7a0b\u200b\u3002</p> <p>(2) \u200b\u5b58\u5728\u200b\u67d0\u79cd\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u7ee7\u7eed\u200b\u7b49\u5f85\u200b\uff0c\u200b\u4ecd\u7136\u200b\u4fdd\u7559\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u53ef\u80fd\u200b\uff0c\u200b\u83b7\u53d6\u200b\u9501\u200b\u6d41\u7a0b\u200b\u4ecd\u200b\u5728\u200b\u7ee7\u7eed\u200b\u3002</p> <ul> <li>\u200b\u5bf9\u4e8e\u200b\u95ee\u9898\u200b1\u200b\u7684\u200b\u7b2c\u4e8c\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u65e2\u7136\u200b\u8bf4\u200b\u5230\u200b\u4e86\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u6709\u200b\u67d0\u79cd\u200b\u961f\u5217\u200b\u5f62\u6210\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u961f\u5217\u200b\u662f\u200b\u4ec0\u4e48\u200b\u6570\u636e\u7ed3\u6784\u200b\u5462\u200b\uff1f</li> <li>\u200b\u5904\u4e8e\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u6709\u200b\u673a\u4f1a\u200b\u83b7\u53d6\u200b\u9501\u200b\u5462\u200b\uff1f</li> <li>\u200b\u5982\u679c\u200b\u5904\u4e8e\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e00\u76f4\u200b\u65e0\u6cd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u4e00\u76f4\u200b\u7b49\u5f85\u200b\u5417\u200b\uff0c\u200b\u8fd8\u662f\u200b\u6709\u200b\u522b\u7684\u200b\u7b56\u7565\u200b\u6765\u200b\u89e3\u51b3\u200b\u8fd9\u4e00\u200b\u95ee\u9898\u200b\uff1f</li> </ul> <p>\u200b\u5e26\u200b\u7740\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u8fd9\u4e9b\u200b\u95ee\u9898\u200b\uff0c\u200b\u518d\u200b\u770b\u200b\u4e0b\u200b\u516c\u5e73\u200b\u9501\u200b\u6e90\u7801\u200b\u4e2d\u200b\u83b7\u9501\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff1a</p> Scala<pre><code>// java.util.concurrent.locks.ReentrantLock#FairSync\n\nstatic final class FairSync extends Sync {\n  ...  \n    final void lock() {\n        acquire(1);\n    }\n  ...\n}\n</code></pre> <p>\u200b\u770b\u5230\u200b\u8fd9\u5757\u200b\u4ee3\u7801\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5b58\u5728\u200b\u8fd9\u79cd\u200b\u7591\u95ee\u200b\uff1aLock\u200b\u51fd\u6570\u200b\u901a\u8fc7\u200bAcquire\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u52a0\u9501\u200b\uff0c\u200b\u4f46\u662f\u200b\u5177\u4f53\u200b\u662f\u200b\u5982\u4f55\u200b\u52a0\u9501\u200b\u7684\u200b\u5462\u200b\uff1f</p> <p>\u200b\u7ed3\u5408\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u52a0\u9501\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u867d\u7136\u200b\u6d41\u7a0b\u200b\u4e0a\u200b\u6709\u200b\u4e00\u5b9a\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b\u90fd\u200b\u8c03\u7528\u200b\u4e86\u200bAcquire\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u800c\u200bAcquire\u200b\u65b9\u6cd5\u200b\u662f\u200bFairSync\u200b\u548c\u200bUnfairSync\u200b\u7684\u200b\u7236\u7c7b\u200bAQS\u200b\u4e2d\u200b\u7684\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u4e0a\u8fb9\u200b\u63d0\u5230\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5728\u200bReentrantLock\u200b\u7c7b\u200b\u6e90\u7801\u200b\u4e2d\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u89e3\u7b54\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e9b\u200b\u95ee\u9898\u200b\u7684\u200b\u7b54\u6848\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u4f4d\u4e8e\u200bAcquire\u200b\u65b9\u6cd5\u200b\u6240\u5728\u200b\u7684\u200b\u7c7b\u200bAbstractQueuedSynchronizer\u200b\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u672c\u6587\u200b\u7684\u200b\u6838\u5fc3\u200b\u2014\u2014AQS\u3002\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u4f1a\u200b\u5bf9\u200bAQS\u200b\u4ee5\u53ca\u200bReentrantLock\u200b\u548c\u200bAQS\u200b\u7684\u200b\u5173\u8054\u200b\u505a\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\uff08\u200b\u76f8\u5173\u200b\u95ee\u9898\u200b\u7b54\u6848\u200b\u4f1a\u200b\u5728\u200b2.3.5\u200b\u5c0f\u8282\u200b\u4e2d\u200b\u89e3\u7b54\u200b\uff09\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#2-aqs","title":"2 AQS","text":"<p>\u200b\u9996\u5148\u200b\uff0c\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b\u4e0b\u9762\u200b\u7684\u200b\u67b6\u6784\u56fe\u200b\u6765\u200b\u6574\u4f53\u200b\u4e86\u89e3\u200b\u4e00\u4e0b\u200bAQS\u200b\u6846\u67b6\u200b\uff1a</p> <p></p> <ul> <li>\u200b\u4e0a\u56fe\u200b\u4e2d\u200b\u6709\u200b\u989c\u8272\u200b\u7684\u200b\u4e3a\u200bMethod\uff0c\u200b\u65e0\u200b\u989c\u8272\u200b\u7684\u200b\u4e3a\u200bAttribution\u3002</li> <li>\u200b\u603b\u7684\u6765\u8bf4\u200b\uff0cAQS\u200b\u6846\u67b6\u200b\u5171\u200b\u5206\u4e3a\u200b\u4e94\u5c42\u200b\uff0c\u200b\u81ea\u4e0a\u800c\u4e0b\u200b\u7531\u6d45\u5165\u6df1\u200b\uff0c\u200b\u4ece\u200bAQS\u200b\u5bf9\u5916\u200b\u66b4\u9732\u200b\u7684\u200bAPI\u200b\u5230\u200b\u5e95\u5c42\u200b\u57fa\u7840\u200b\u6570\u636e\u200b\u3002</li> <li>\u200b\u5f53\u6709\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u63a5\u5165\u200b\u65f6\u200b\uff0c\u200b\u53ea\u200b\u9700\u200b\u91cd\u5199\u200b\u7b2c\u4e00\u5c42\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u90e8\u5206\u200b\u65b9\u6cd5\u200b\u5373\u53ef\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5173\u6ce8\u200b\u5e95\u5c42\u200b\u5177\u4f53\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6d41\u7a0b\u200b\u3002\u200b\u5f53\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u8fdb\u884c\u200b\u52a0\u9501\u200b\u6216\u8005\u200b\u89e3\u9501\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u5148\u200b\u7ecf\u8fc7\u200b\u7b2c\u4e00\u5c42\u200b\u7684\u200bAPI\u200b\u8fdb\u5165\u200bAQS\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7136\u540e\u200b\u7ecf\u8fc7\u200b\u7b2c\u4e8c\u5c42\u200b\u8fdb\u884c\u200b\u9501\u200b\u7684\u200b\u83b7\u53d6\u200b\uff0c\u200b\u63a5\u7740\u200b\u5bf9\u4e8e\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u8fdb\u5165\u200b\u7b2c\u4e09\u5c42\u200b\u548c\u200b\u7b2c\u56db\u5c42\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u5904\u7406\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e9b\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\u5747\u200b\u4f9d\u8d56\u4e8e\u200b\u7b2c\u4e94\u5c42\u200b\u7684\u200b\u57fa\u7840\u200b\u6570\u636e\u200b\u63d0\u4f9b\u200b\u5c42\u200b\u3002</li> </ul> <p>\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u4f1a\u200b\u4ece\u200b\u6574\u4f53\u200b\u5230\u200b\u7ec6\u8282\u200b\uff0c\u200b\u4ece\u200b\u6d41\u7a0b\u200b\u5230\u200b\u65b9\u6cd5\u200b\u9010\u4e00\u200b\u5256\u6790\u200bAQS\u200b\u6846\u67b6\u200b\uff0c\u200b\u4e3b\u8981\u200b\u5206\u6790\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#21","title":"2.1 \u200b\u539f\u7406\u200b\u6982\u89c8","text":"<p>AQS\u200b\u6838\u5fc3\u601d\u60f3\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5171\u4eab\u8d44\u6e90\u200b\u7a7a\u95f2\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u5c06\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u8d44\u6e90\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u6709\u6548\u200b\u7684\u200b\u5de5\u4f5c\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5c06\u200b\u5171\u4eab\u8d44\u6e90\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u9501\u5b9a\u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u5171\u4eab\u8d44\u6e90\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u4e00\u5b9a\u200b\u7684\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u5524\u9192\u200b\u673a\u5236\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u9501\u200b\u5206\u914d\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u673a\u5236\u200b\u4e3b\u8981\u200b\u7528\u200b\u7684\u200b\u662f\u200bCLH\u200b\u961f\u5217\u200b\u7684\u200b\u53d8\u4f53\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u5c06\u200b\u6682\u65f6\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u52a0\u5165\u200b\u5230\u200b\u961f\u5217\u200b\u4e2d\u200b\u3002</p> <p>CLH\uff1aCraig\u3001Landin and Hagersten\u200b\u961f\u5217\u200b\uff0c\u200b\u662f\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0cAQS\u200b\u4e2d\u200b\u7684\u200b\u961f\u5217\u200b\u662f\u200bCLH\u200b\u53d8\u4f53\u200b\u7684\u200b\u865a\u62df\u200b\u53cc\u5411\u200b\u961f\u5217\u200b\uff08FIFO\uff09\uff0cAQS\u200b\u662f\u200b\u901a\u8fc7\u200b\u5c06\u200b\u6bcf\u6761\u200b\u8bf7\u6c42\u200b\u5171\u4eab\u8d44\u6e90\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c01\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u6765\u200b\u5b9e\u73b0\u200b\u9501\u200b\u7684\u200b\u5206\u914d\u200b\u3002</p> <p>\u200b\u4e3b\u8981\u200b\u539f\u7406\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>AQS\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200bVolatile\u200b\u7684\u200bint\u200b\u7c7b\u578b\u200b\u7684\u200b\u6210\u5458\u200b\u53d8\u91cf\u200b\u6765\u200b\u8868\u793a\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5185\u7f6e\u200b\u7684\u200bFIFO\u200b\u961f\u5217\u200b\u6765\u200b\u5b8c\u6210\u200b\u8d44\u6e90\u200b\u83b7\u53d6\u200b\u7684\u200b\u6392\u961f\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u901a\u8fc7\u200bCAS\u200b\u5b8c\u6210\u200b\u5bf9\u200bState\u200b\u503c\u200b\u7684\u200b\u4fee\u6539\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#211-aqs","title":"2.1.1 AQS\u200b\u6570\u636e\u7ed3\u6784","text":"<p>\u200b\u5148\u200b\u6765\u770b\u200b\u4e0b\u200bAQS\u200b\u4e2d\u200b\u6700\u200b\u57fa\u672c\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u2014\u2014Node\uff0cNode\u200b\u5373\u200b\u4e3a\u200b\u4e0a\u9762\u200bCLH\u200b\u53d8\u4f53\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u8282\u70b9\u200b\u3002</p> <p></p> <p>\u200b\u89e3\u91ca\u4e00\u4e0b\u200b\u51e0\u4e2a\u200b\u65b9\u6cd5\u200b\u548c\u200b\u5c5e\u6027\u200b\u503c\u200b\u7684\u200b\u542b\u4e49\u200b\uff1a</p> \u200b\u65b9\u6cd5\u200b\u548c\u200b\u5c5e\u6027\u200b\u503c\u200b \u200b\u542b\u4e49\u200b waitStatus \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5728\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u72b6\u6001\u200b thread \u200b\u8868\u793a\u200b\u5904\u4e8e\u200b\u8be5\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b prev \u200b\u524d\u9a71\u200b\u6307\u9488\u200b predecessor \u200b\u8fd4\u56de\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\uff0c\u200b\u6ca1\u6709\u200b\u7684\u8bdd\u200b\u629b\u51fa\u200bnpe nextWaiter \u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5904\u4e8e\u200bCONDITION\u200b\u72b6\u6001\u200b\u7684\u200b\u8282\u70b9\u200b\uff08\u200b\u7531\u4e8e\u200b\u672c\u7bc7\u200b\u6587\u7ae0\u200b\u4e0d\u200b\u8bb2\u8ff0\u200bCondition Queue\u200b\u961f\u5217\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u6307\u9488\u200b\u4e0d\u200b\u591a\u200b\u4ecb\u7ecd\u200b\uff09 next \u200b\u540e\u7ee7\u200b\u6307\u9488\u200b <p>\u200b\u7ebf\u7a0b\u200b\u4e24\u79cd\u200b\u9501\u200b\u7684\u200b\u6a21\u5f0f\u200b\uff1a</p> \u200b\u6a21\u5f0f\u200b \u200b\u542b\u4e49\u200b SHARED \u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u4ee5\u200b\u5171\u4eab\u200b\u7684\u200b\u6a21\u5f0f\u200b\u7b49\u5f85\u200b\u9501\u200b EXCLUSIVE \u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u6b63\u5728\u200b\u4ee5\u200b\u72ec\u5360\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7b49\u5f85\u200b\u9501\u200b <p>waitStatus\u200b\u6709\u200b\u4e0b\u9762\u200b\u51e0\u4e2a\u200b\u679a\u4e3e\u200b\u503c\u200b\uff1a</p> \u200b\u679a\u4e3e\u200b \u200b\u542b\u4e49\u200b 0 \u200b\u5f53\u200b\u4e00\u4e2a\u200bNode\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b CANCELLED \u200b\u4e3a\u200b1\uff0c\u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u8bf7\u6c42\u200b\u5df2\u7ecf\u200b\u53d6\u6d88\u200b\u4e86\u200b CONDITION \u200b\u4e3a\u200b-2\uff0c\u200b\u8868\u793a\u200b\u8282\u70b9\u200b\u5728\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\uff0c\u200b\u8282\u70b9\u200b\u7ebf\u7a0b\u200b\u7b49\u5f85\u200b\u5524\u9192\u200b PROPAGATE \u200b\u4e3a\u200b-3\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5904\u5728\u200bSHARED\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8be5\u5b57\u200b\u6bb5\u200b\u624d\u200b\u4f1a\u200b\u4f7f\u7528\u200b SIGNAL \u200b\u4e3a\u200b-1\uff0c\u200b\u8868\u793a\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u51c6\u5907\u200b\u597d\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u7b49\u200b\u8d44\u6e90\u200b\u91ca\u653e\u200b\u4e86","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#212-state","title":"2.1.2 \u200b\u540c\u6b65\u200b\u72b6\u6001\u200bState","text":"<p>\u200b\u5728\u200b\u4e86\u89e3\u200b\u6570\u636e\u7ed3\u6784\u200b\u540e\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u4e86\u89e3\u200b\u4e00\u4e0b\u200bAQS\u200b\u7684\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u2014\u2014State\u3002AQS\u200b\u4e2d\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200bstate\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u610f\u200b\u4e3a\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff0c\u200b\u662f\u200b\u7531\u200bVolatile\u200b\u4fee\u9970\u200b\u7684\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5c55\u793a\u200b\u5f53\u524d\u200b\u4e34\u754c\u200b\u8d44\u6e90\u200b\u7684\u200b\u83b7\u9501\u200b\u60c5\u51b5\u200b\u3002</p> Groovy<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate volatile int state;\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u51e0\u4e2a\u200b\u8bbf\u95ee\u200b\u8fd9\u4e2a\u200b\u5b57\u6bb5\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> \u200b\u65b9\u6cd5\u200b\u540d\u200b \u200b\u63cf\u8ff0\u200b protected final int getState() \u200b\u83b7\u53d6\u200bState\u200b\u7684\u200b\u503c\u200b protected final void setState(int newState) \u200b\u8bbe\u7f6e\u200bState\u200b\u7684\u200b\u503c\u200b protected final boolean compareAndSetState(int expect, int update) \u200b\u4f7f\u7528\u200bCAS\u200b\u65b9\u5f0f\u200b\u66f4\u65b0\u200bState <p>\u200b\u8fd9\u200b\u51e0\u4e2a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200bFinal\u200b\u4fee\u9970\u200b\u7684\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5b50\u7c7b\u200b\u4e2d\u200b\u65e0\u6cd5\u200b\u91cd\u5199\u200b\u5b83\u4eec\u200b\u3002\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200bState\u200b\u5b57\u200b\u6bb5\u200b\u8868\u793a\u200b\u7684\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u6765\u200b\u5b9e\u73b0\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\u548c\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\uff08\u200b\u52a0\u9501\u200b\u8fc7\u7a0b\u200b\uff09\u3002</p> <p> </p> <p>\u200b\u5bf9\u4e8e\u200b\u6211\u4eec\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\uff0c\u200b\u9700\u8981\u200b\u81ea\u5b9a\u4e49\u200b\u83b7\u53d6\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u548c\u200b\u91ca\u653e\u200b\u72b6\u6001\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200bAQS\u200b\u67b6\u6784\u56fe\u200b\u4e2d\u200b\u7684\u200b\u7b2c\u4e00\u5c42\u200b\uff1aAPI\u200b\u5c42\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#22-aqsreentrantlock","title":"2.2 AQS\u200b\u91cd\u8981\u200b\u65b9\u6cd5\u200b\u4e0e\u200bReentrantLock\u200b\u7684\u200b\u5173\u8054","text":"<p>\u200b\u4ece\u200b\u67b6\u6784\u56fe\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u5f97\u77e5\u200b\uff0cAQS\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5927\u91cf\u200b\u7528\u4e8e\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u5b9e\u73b0\u200b\u7684\u200bProtected\u200b\u65b9\u6cd5\u200b\u3002\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u5b9e\u73b0\u200b\u7684\u200b\u76f8\u5173\u200b\u65b9\u6cd5\u200b\u4e5f\u200b\u53ea\u662f\u200b\u4e3a\u4e86\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200bState\u200b\u5b57\u6bb5\u200b\u6765\u200b\u5b9e\u73b0\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u72ec\u5360\u200b\u6a21\u5f0f\u200b\u6216\u8005\u200b\u5171\u4eab\u200b\u6a21\u5f0f\u200b\u3002\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u9700\u8981\u200b\u5b9e\u73b0\u200b\u4ee5\u4e0b\u200b\u65b9\u6cd5\u200b\uff08ReentrantLock\u200b\u9700\u8981\u200b\u5b9e\u73b0\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5982\u4e0b\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u5168\u90e8\u200b\uff09\uff1a</p> \u200b\u65b9\u6cd5\u200b\u540d\u200b \u200b\u63cf\u8ff0\u200b protected boolean isHeldExclusively() \u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u6b63\u5728\u200b\u72ec\u5360\u200b\u8d44\u6e90\u200b\u3002\u200b\u53ea\u6709\u200b\u7528\u5230\u200bCondition\u200b\u624d\u200b\u9700\u8981\u200b\u53bb\u200b\u5b9e\u73b0\u200b\u5b83\u200b\u3002 protected boolean tryAcquire(int arg) \u200b\u72ec\u5360\u200b\u65b9\u5f0f\u200b\u3002arg\u200b\u4e3a\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8d44\u6e90\u200b\uff0c\u200b\u6210\u529f\u200b\u5219\u200b\u8fd4\u56de\u200bTrue\uff0c\u200b\u5931\u8d25\u200b\u5219\u200b\u8fd4\u56de\u200bFalse\u3002 protected boolean tryRelease(int arg) \u200b\u72ec\u5360\u200b\u65b9\u5f0f\u200b\u3002arg\u200b\u4e3a\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u8d44\u6e90\u200b\uff0c\u200b\u6210\u529f\u200b\u5219\u200b\u8fd4\u56de\u200bTrue\uff0c\u200b\u5931\u8d25\u200b\u5219\u200b\u8fd4\u56de\u200bFalse\u3002 protected int tryAcquireShared(int arg) \u200b\u5171\u4eab\u200b\u65b9\u5f0f\u200b\u3002arg\u200b\u4e3a\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u8d44\u6e90\u200b\u3002\u200b\u8d1f\u6570\u200b\u8868\u793a\u200b\u5931\u8d25\u200b\uff1b0\u200b\u8868\u793a\u200b\u6210\u529f\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u5269\u4f59\u200b\u53ef\u7528\u200b\u8d44\u6e90\u200b\uff1b\u200b\u6b63\u6570\u200b\u8868\u793a\u200b\u6210\u529f\u200b\uff0c\u200b\u4e14\u200b\u6709\u200b\u5269\u4f59\u200b\u8d44\u6e90\u200b\u3002 protected boolean tryReleaseShared(int arg) \u200b\u5171\u4eab\u200b\u65b9\u5f0f\u200b\u3002arg\u200b\u4e3a\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u540e\u200b\u5141\u8bb8\u200b\u5524\u9192\u200b\u540e\u7eed\u200b\u7b49\u5f85\u200b\u7ed3\u70b9\u200b\u8fd4\u56de\u200bTrue\uff0c\u200b\u5426\u5219\u200b\u8fd4\u56de\u200bFalse\u3002 <p>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u8981\u4e48\u200b\u662f\u200b\u72ec\u5360\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u8981\u4e48\u200b\u662f\u200b\u5171\u4eab\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5b83\u4eec\u200b\u4e5f\u200b\u53ea\u200b\u9700\u200b\u5b9e\u73b0\u200btryAcquire-tryRelease\u3001tryAcquireShared-tryReleaseShared\u200b\u4e2d\u200b\u7684\u200b\u4e00\u79cd\u200b\u5373\u53ef\u200b\u3002AQS\u200b\u4e5f\u200b\u652f\u6301\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u540c\u65f6\u200b\u5b9e\u73b0\u200b\u72ec\u5360\u200b\u548c\u200b\u5171\u4eab\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5982\u200bReentrantReadWriteLock\u3002ReentrantLock\u200b\u662f\u200b\u72ec\u5360\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u73b0\u200b\u4e86\u200btryAcquire-tryRelease\u3002</p> <p>\u200b\u4ee5\u975e\u200b\u516c\u5e73\u200b\u9501\u4e3a\u4f8b\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e3b\u8981\u200b\u9610\u8ff0\u200b\u4e00\u4e0b\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u4e0e\u200bAQS\u200b\u4e4b\u95f4\u200b\u65b9\u6cd5\u200b\u7684\u200b\u5173\u8054\u200b\u4e4b\u200b\u5904\u200b\uff0c\u200b\u5177\u4f53\u200b\u6bcf\u4e00\u5904\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4f5c\u7528\u200b\u4f1a\u200b\u5728\u200b\u6587\u7ae0\u200b\u540e\u9762\u200b\u8be6\u7ec6\u200b\u8fdb\u884c\u200b\u9610\u8ff0\u200b\u3002</p> <p></p> <p>\u200b\u4e3a\u4e86\u200b\u5e2e\u52a9\u200b\u5927\u5bb6\u200b\u7406\u89e3\u200bReentrantLock\u200b\u548c\u200bAQS\u200b\u4e4b\u95f4\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4ea4\u4e92\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u4ee5\u975e\u200b\u516c\u5e73\u200b\u9501\u4e3a\u4f8b\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c06\u200b\u52a0\u9501\u200b\u548c\u200b\u89e3\u9501\u200b\u7684\u200b\u4ea4\u4e92\u200b\u6d41\u7a0b\u200b\u5355\u72ec\u200b\u62ce\u200b\u51fa\u6765\u200b\u5f3a\u8c03\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u4e8e\u200b\u5bf9\u200b\u540e\u7eed\u200b\u5185\u5bb9\u200b\u7684\u200b\u7406\u89e3\u200b\u3002</p> <p></p> <p>\u200b\u52a0\u9501\u200b\uff1a</p> <ul> <li>\u200b\u901a\u8fc7\u200bReentrantLock\u200b\u7684\u200b\u52a0\u9501\u200b\u65b9\u6cd5\u200bLock\u200b\u8fdb\u884c\u200b\u52a0\u9501\u200b\u64cd\u4f5c\u200b\u3002</li> <li>\u200b\u4f1a\u200b\u8c03\u7528\u200b\u5230\u200b\u5185\u90e8\u200b\u7c7b\u200bSync\u200b\u7684\u200bLock\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7531\u4e8e\u200bSync#lock\u200b\u662f\u200b\u62bd\u8c61\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6839\u636e\u200bReentrantLock\u200b\u521d\u59cb\u5316\u200b\u9009\u62e9\u200b\u7684\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff0c\u200b\u6267\u884c\u200b\u76f8\u5173\u200b\u5185\u90e8\u200b\u7c7b\u200b\u7684\u200bLock\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u672c\u8d28\u200b\u4e0a\u200b\u90fd\u200b\u4f1a\u200b\u6267\u884c\u200bAQS\u200b\u7684\u200bAcquire\u200b\u65b9\u6cd5\u200b\u3002</li> <li>AQS\u200b\u7684\u200bAcquire\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u6267\u884c\u200btryAcquire\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200btryAcquire\u200b\u9700\u8981\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6267\u884c\u200b\u4e86\u200bReentrantLock\u200b\u4e2d\u200b\u7684\u200btryAcquire\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7531\u4e8e\u200bReentrantLock\u200b\u662f\u200b\u901a\u8fc7\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u5185\u90e8\u200b\u7c7b\u200b\u5b9e\u73b0\u200b\u7684\u200btryAcquire\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f1a\u200b\u6839\u636e\u200b\u9501\u200b\u7c7b\u578b\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6267\u884c\u200b\u4e0d\u540c\u200b\u7684\u200btryAcquire\u3002</li> <li>tryAcquire\u200b\u662f\u200b\u83b7\u53d6\u200b\u9501\u200b\u903b\u8f91\u200b\uff0c\u200b\u83b7\u53d6\u200b\u5931\u8d25\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u6267\u884c\u200b\u6846\u67b6\u200bAQS\u200b\u7684\u200b\u540e\u7eed\u200b\u903b\u8f91\u200b\uff0c\u200b\u8ddf\u200bReentrantLock\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u65e0\u5173\u200b\u3002</li> </ul> <p>\u200b\u89e3\u9501\u200b\uff1a</p> <ul> <li>\u200b\u901a\u8fc7\u200bReentrantLock\u200b\u7684\u200b\u89e3\u9501\u200b\u65b9\u6cd5\u200bUnlock\u200b\u8fdb\u884c\u200b\u89e3\u9501\u200b\u3002</li> <li>Unlock\u200b\u4f1a\u200b\u8c03\u7528\u200b\u5185\u90e8\u200b\u7c7b\u200bSync\u200b\u7684\u200bRelease\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u7ee7\u627f\u200b\u4e8e\u200bAQS\u3002</li> <li>Release\u200b\u4e2d\u200b\u4f1a\u200b\u8c03\u7528\u200btryRelease\u200b\u65b9\u6cd5\u200b\uff0ctryRelease\u200b\u9700\u8981\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u5b9e\u73b0\u200b\uff0ctryRelease\u200b\u53ea\u200b\u5728\u200bReentrantLock\u200b\u4e2d\u200b\u7684\u200bSync\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0c\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u533a\u5206\u200b\u662f\u5426\u200b\u4e3a\u200b\u516c\u5e73\u200b\u9501\u200b\u3002</li> <li>\u200b\u91ca\u653e\u200b\u6210\u529f\u200b\u540e\u200b\uff0c\u200b\u6240\u6709\u200b\u5904\u7406\u200b\u7531\u200bAQS\u200b\u6846\u67b6\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e0e\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u65e0\u5173\u200b\u3002</li> </ul> <p>\u200b\u901a\u8fc7\u200b\u4e0a\u9762\u200b\u7684\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u5927\u6982\u200b\u53ef\u4ee5\u200b\u603b\u7ed3\u200b\u51fa\u200bReentrantLock\u200b\u52a0\u9501\u200b\u89e3\u9501\u200b\u65f6\u200bAPI\u200b\u5c42\u200b\u6838\u5fc3\u200b\u65b9\u6cd5\u200b\u7684\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u3002</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#23-reentrantlockaqs","title":"2.3 \u200b\u901a\u8fc7\u200bReentrantLock\u200b\u7406\u89e3\u200bAQS","text":"<p>ReentrantLock\u200b\u4e2d\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u5728\u200b\u5e95\u5c42\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4ee5\u975e\u200b\u516c\u5e73\u200b\u9501\u4e3a\u4f8b\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\u3002</p> <p>\u200b\u5728\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u4e00\u6bb5\u200b\u8fd9\u6837\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> Scala<pre><code>// java.util.concurrent.locks.ReentrantLock\n\nstatic final class NonfairSync extends Sync {\n    ...\n    final void lock() {\n        if (compareAndSetState(0, 1))\n            setExclusiveOwnerThread(Thread.currentThread());\n        else\n            acquire(1);\n    }\n  ...\n}\n</code></pre> <p>\u200b\u770b\u200b\u4e00\u4e0b\u200b\u8fd9\u4e2a\u200bAcquire\u200b\u662f\u200b\u600e\u4e48\u200b\u5199\u200b\u7684\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n</code></pre> <p>\u200b\u518d\u200b\u770b\u200b\u4e00\u4e0b\u200btryAcquire\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprotected boolean tryAcquire(int arg) {\n    throw new UnsupportedOperationException();\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u53ea\u662f\u200bAQS\u200b\u7684\u200b\u7b80\u5355\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5177\u4f53\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u662f\u200b\u7531\u200b\u5404\u81ea\u200b\u7684\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u5355\u72ec\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff08\u200b\u4ee5\u200bReentrantLock\u200b\u4e3a\u4f8b\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u4e86\u200bTrue\uff0c\u200b\u5219\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u7528\u200b\u5f80\u540e\u200b\u6267\u884c\u200b\u4e86\u200b\uff1b\u200b\u5982\u679c\u200b\u83b7\u53d6\u200b\u5931\u8d25\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u52a0\u5165\u200b\u5230\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u3002\u200b\u4e0b\u9762\u200b\u4f1a\u200b\u8be6\u7ec6\u200b\u89e3\u91ca\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u4f55\u65f6\u200b\u4ee5\u53ca\u200b\u600e\u6837\u200b\u88ab\u200b\u52a0\u5165\u200b\u8fdb\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#231","title":"2.3.1 \u200b\u7ebf\u7a0b\u200b\u52a0\u5165\u200b\u7b49\u5f85\u200b\u961f\u5217","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#2311","title":"2.3.1.1 \u200b\u52a0\u5165\u200b\u961f\u5217\u200b\u7684\u200b\u65f6\u673a","text":"<p>\u200b\u5f53\u200b\u6267\u884c\u200bAcquire(1)\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u901a\u8fc7\u200btryAcquire\u200b\u83b7\u53d6\u200b\u9501\u200b\u3002\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200baddWaiter\u200b\u52a0\u5165\u200b\u5230\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u53bb\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#2312","title":"2.3.1.2 \u200b\u5982\u4f55\u200b\u52a0\u5165\u200b\u961f\u5217","text":"<p>\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u6267\u884c\u200baddWaiter(Node.EXCLUSIVE)\u200b\u52a0\u5165\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> Kotlin<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate Node addWaiter(Node mode) {\n    Node node = new Node(Thread.currentThread(), mode);\n    // Try the fast path of enq; backup to full enq on failure\n    Node pred = tail;\n    if (pred != null) {\n        node.prev = pred;\n        if (compareAndSetTail(pred, node)) {\n            pred.next = node;\n            return node;\n        }\n    }\n    enq(node);\n    return node;\n}\nprivate final boolean compareAndSetTail(Node expect, Node update) {\n    return unsafe.compareAndSwapObject(this, tailOffset, expect, update);\n}\n</code></pre> <p>\u200b\u4e3b\u8981\u200b\u7684\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>\u200b\u901a\u8fc7\u200b\u5f53\u524d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u548c\u200b\u9501\u200b\u6a21\u5f0f\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u3002</li> <li>Pred\u200b\u6307\u9488\u200b\u6307\u5411\u200b\u5c3e\u200b\u8282\u70b9\u200bTail\u3002</li> <li>\u200b\u5c06\u200bNew\u200b\u4e2d\u200bNode\u200b\u7684\u200bPrev\u200b\u6307\u9488\u200b\u6307\u5411\u200bPred\u3002</li> <li>\u200b\u901a\u8fc7\u200bcompareAndSetTail\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5b8c\u6210\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u4e3b\u8981\u200b\u662f\u200b\u5bf9\u200btailOffset\u200b\u548c\u200bExpect\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200btailOffset\u200b\u7684\u200bNode\u200b\u548c\u200bExpect\u200b\u7684\u200bNode\u200b\u5730\u5740\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8bbe\u7f6e\u200bTail\u200b\u7684\u200b\u503c\u200b\u4e3a\u200bUpdate\u200b\u7684\u200b\u503c\u200b\u3002</li> </ul> Groovy<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nstatic {\n    try {\n        stateOffset = unsafe.objectFieldOffset(AbstractQueuedSynchronizer.class.getDeclaredField(\"state\"));\n        headOffset = unsafe.objectFieldOffset(AbstractQueuedSynchronizer.class.getDeclaredField(\"head\"));\n        tailOffset = unsafe.objectFieldOffset(AbstractQueuedSynchronizer.class.getDeclaredField(\"tail\"));\n        waitStatusOffset = unsafe.objectFieldOffset(Node.class.getDeclaredField(\"waitStatus\"));\n        nextOffset = unsafe.objectFieldOffset(Node.class.getDeclaredField(\"next\"));\n    } catch (Exception ex) { \n    throw new Error(ex); \n  }\n}\n</code></pre> <p>\u200b\u4ece\u200bAQS\u200b\u7684\u200b\u9759\u6001\u200b\u4ee3\u7801\u200b\u5757\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5c5e\u6027\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u5728\u200b\u5185\u5b58\u200b\u5f53\u4e2d\u200b\u7684\u200b\u504f\u79fb\u91cf\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6211\u4eec\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b\u504f\u79fb\u91cf\u200b\u5728\u200b\u5bf9\u8c61\u200b\u5185\u5b58\u200b\u5f53\u4e2d\u200b\u627e\u5230\u200b\u8fd9\u4e2a\u200b\u5c5e\u6027\u200b\u3002tailOffset\u200b\u6307\u200b\u7684\u200b\u662f\u200btail\u200b\u5bf9\u5e94\u200b\u7684\u200b\u504f\u79fb\u91cf\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u4f1a\u200b\u5c06\u200bnew\u200b\u51fa\u6765\u200b\u7684\u200bNode\u200b\u7f6e\u200b\u4e3a\u200b\u5f53\u524d\u200b\u961f\u5217\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u7531\u4e8e\u200b\u662f\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u5c06\u200b\u524d\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u6307\u5411\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3002</p> <ul> <li>\u200b\u5982\u679c\u200bPred\u200b\u6307\u9488\u200b\u662f\u200bNull\uff08\u200b\u8bf4\u660e\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u5143\u7d20\u200b\uff09\uff0c\u200b\u6216\u8005\u200b\u5f53\u524d\u200bPred\u200b\u6307\u9488\u200b\u548c\u200bTail\u200b\u6307\u5411\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0d\u540c\u200b\uff08\u200b\u8bf4\u660e\u200b\u88ab\u200b\u522b\u7684\u200b\u7ebf\u7a0b\u200b\u5df2\u7ecf\u200b\u4fee\u6539\u200b\uff09\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u770b\u200b\u4e00\u4e0b\u200bEnq\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</li> </ul> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate Node enq(final Node node) {\n    for (;;) {\n        Node t = tail;\n        if (t == null) { // Must initialize\n            if (compareAndSetHead(new Node()))\n                tail = head;\n        } else {\n            node.prev = t;\n            if (compareAndSetTail(t, node)) {\n                t.next = node;\n                return t;\n            }\n        }\n    }\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u5934\u200b\u7ed3\u70b9\u200b\u51fa\u6765\u200b\u3002\u200b\u4f46\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b\u5e76\u200b\u4e0d\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u8282\u70b9\u200b\uff0c\u200b\u800c\u662f\u200b\u8c03\u7528\u200b\u4e86\u200b\u65e0\u53c2\u200b\u6784\u9020\u51fd\u6570\u200b\u7684\u200b\u8282\u70b9\u200b\u3002\u200b\u5982\u679c\u200b\u7ecf\u5386\u200b\u4e86\u200b\u521d\u59cb\u5316\u200b\u6216\u8005\u200b\u5e76\u53d1\u200b\u5bfc\u81f4\u200b\u961f\u5217\u200b\u4e2d\u6709\u200b\u5143\u7d20\u200b\uff0c\u200b\u5219\u200b\u4e0e\u200b\u4e4b\u524d\u200b\u7684\u200b\u65b9\u6cd5\u200b\u76f8\u540c\u200b\u3002\u200b\u5176\u5b9e\u200b\uff0caddWaiter\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5728\u200b\u53cc\u7aef\u200b\u94fe\u8868\u200b\u6dfb\u52a0\u200b\u5c3e\u200b\u8282\u70b9\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u53cc\u7aef\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b\u662f\u200b\u4e00\u4e2a\u200b\u65e0\u53c2\u200b\u6784\u9020\u51fd\u6570\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fc7\u7a0b\u200b\u5927\u4f53\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u5f53\u200b\u6ca1\u6709\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\u65f6\u200b\uff0c\u200b\u7ebf\u7a0b\u200b1\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\u3002</li> <li>\u200b\u7ebf\u7a0b\u200b2\u200b\u7533\u8bf7\u200b\u9501\u200b\uff0c\u200b\u4f46\u662f\u200b\u9501\u200b\u88ab\u200b\u7ebf\u7a0b\u200b1\u200b\u5360\u6709\u200b\u3002</li> </ol> <p></p> <ol> <li>\u200b\u5982\u679c\u200b\u518d\u6709\u200b\u7ebf\u7a0b\u200b\u8981\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u4f9d\u6b21\u200b\u5728\u200b\u961f\u5217\u200b\u4e2d\u200b\u5f80\u540e\u200b\u6392\u961f\u200b\u5373\u53ef\u200b\u3002</li> </ol> <p>\u200b\u56de\u5230\u200b\u4e0a\u8fb9\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0chasQueuedPredecessors\u200b\u662f\u200b\u516c\u5e73\u200b\u9501\u200b\u52a0\u9501\u200b\u65f6\u200b\u5224\u65ad\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u6709\u6548\u200b\u8282\u70b9\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5982\u679c\u200b\u8fd4\u56de\u200bFalse\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u4e89\u53d6\u200b\u5171\u4eab\u8d44\u6e90\u200b\uff1b\u200b\u5982\u679c\u200b\u8fd4\u56de\u200bTrue\uff0c\u200b\u8bf4\u660e\u200b\u961f\u5217\u200b\u4e2d\u200b\u5b58\u5728\u200b\u6709\u6548\u200b\u8282\u70b9\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5fc5\u987b\u200b\u52a0\u5165\u200b\u5230\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u3002</p> Java<pre><code>// java.util.concurrent.locks.ReentrantLock\n\npublic final boolean hasQueuedPredecessors() {\n    // The correctness of this depends on head being initialized\n    // before tail and on head.next being accurate if the current\n    // thread is first in queue.\n    Node t = tail; // Read fields in reverse initialization order\n    Node h = head;\n    Node s;\n    return h != t &amp;&amp; ((s = h.next) == null || s.thread != Thread.currentThread());\n}\n</code></pre> <p>\u200b\u770b\u5230\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u6211\u4eec\u200b\u7406\u89e3\u200b\u4e00\u4e0b\u200bh != t &amp;&amp; ((s = h.next) == null || s.thread != Thread.currentThread());\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u5224\u65ad\u200b\u7684\u200b\u5934\u200b\u7ed3\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff1f\u200b\u7b2c\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u50a8\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f</p> <p>\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u4e3a\u200b\u865a\u200b\u8282\u70b9\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5e76\u200b\u4e0d\u200b\u5b58\u50a8\u200b\u4efb\u4f55\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ea\u662f\u200b\u5360\u4f4d\u200b\u3002\u200b\u771f\u6b63\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u8282\u70b9\u200b\u5f00\u59cb\u200b\u7684\u200b\u3002\u200b\u5f53\u200bh != t\u200b\u65f6\u200b\uff1a \u200b\u5982\u679c\u200b(s = h.next) == null\uff0c\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u6b63\u5728\u200b\u6709\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u4f46\u200b\u53ea\u662f\u200b\u8fdb\u884c\u200b\u5230\u200b\u4e86\u200bTail\u200b\u6307\u5411\u200bHead\uff0c\u200b\u6ca1\u6709\u200b\u5c06\u200bHead\u200b\u6307\u5411\u200bTail\uff0c\u200b\u6b64\u65f6\u200b\u961f\u5217\u200b\u4e2d\u6709\u200b\u5143\u7d20\u200b\uff0c\u200b\u9700\u8981\u200b\u8fd4\u56de\u200bTrue\uff08\u200b\u8fd9\u5757\u200b\u5177\u4f53\u200b\u89c1\u200b\u4e0b\u8fb9\u200b\u4ee3\u7801\u200b\u5206\u6790\u200b\uff09\u3002 \u200b\u5982\u679c\u200b(s = h.next) != null\uff0c\u200b\u8bf4\u660e\u200b\u6b64\u65f6\u200b\u961f\u5217\u200b\u4e2d\u200b\u81f3\u5c11\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6709\u6548\u200b\u8282\u70b9\u200b\u3002\u200b\u5982\u679c\u200b\u6b64\u65f6\u200bs.thread == Thread.currentThread()\uff0c\u200b\u8bf4\u660e\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u6709\u6548\u200b\u8282\u70b9\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u76f8\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u8d44\u6e90\u200b\u7684\u200b\uff1b\u200b\u5982\u679c\u200bs.thread != Thread.currentThread()\uff0c\u200b\u8bf4\u660e\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u6709\u6548\u200b\u8282\u70b9\u200b\u7ebf\u7a0b\u200b\u4e0e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5fc5\u987b\u200b\u52a0\u5165\u200b\u8fdb\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u3002</p> TypeScript<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer#enq\n\nif (t == null) { // Must initialize\n    if (compareAndSetHead(new Node()))\n        tail = head;\n} else {\n    node.prev = t;\n    if (compareAndSetTail(t, node)) {\n        t.next = node;\n        return t;\n    }\n}\n</code></pre> <p>\u200b\u8282\u70b9\u200b\u5165\u961f\u200b\u4e0d\u662f\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u77ed\u6682\u200b\u7684\u200bhead != tail\uff0c\u200b\u6b64\u65f6\u200bTail\u200b\u6307\u5411\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u800c\u4e14\u200bTail\u200b\u6307\u5411\u200bHead\u3002\u200b\u5982\u679c\u200bHead\u200b\u6ca1\u6709\u200b\u6307\u5411\u200bTail\uff08\u200b\u53ef\u89c1\u200b5\u30016\u30017\u200b\u884c\u200b\uff09\uff0c\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4e5f\u200b\u9700\u8981\u200b\u5c06\u200b\u76f8\u5173\u200b\u7ebf\u7a0b\u200b\u52a0\u5165\u200b\u961f\u5217\u200b\u4e2d\u200b\u3002\u200b\u6240\u4ee5\u200b\u8fd9\u5757\u200b\u4ee3\u7801\u200b\u662f\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u6781\u7aef\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b\u5e76\u53d1\u200b\u95ee\u9898\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#2313","title":"2.3.1.3 \u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u7ebf\u200b\u7a0b\u51fa\u200b\u961f\u5217\u200b\u65f6\u673a","text":"<p>\u200b\u56de\u5230\u200b\u6700\u521d\u200b\u7684\u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n</code></pre> <p>\u200b\u4e0a\u6587\u200b\u89e3\u91ca\u200b\u4e86\u200baddWaiter\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u628a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4ee5\u200bNode\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u5f62\u5f0f\u200b\u52a0\u5165\u200b\u5230\u200b\u53cc\u7aef\u200b\u961f\u5217\u200b\u91cc\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5305\u542b\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u7684\u200bNode\u3002\u200b\u800c\u200b\u8fd9\u4e2a\u200bNode\u200b\u4f1a\u200b\u4f5c\u4e3a\u200b\u53c2\u6570\u200b\uff0c\u200b\u8fdb\u5165\u200b\u5230\u200bacquireQueued\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u3002acquireQueued\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u6392\u961f\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u201c\u200b\u83b7\u9501\u200b\u201d\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u603b\u7684\u6765\u8bf4\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u4e86\u200b\uff0c\u200b\u88ab\u200b\u653e\u5165\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0cacquireQueued\u200b\u4f1a\u200b\u628a\u200b\u653e\u5165\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e0d\u65ad\u200b\u53bb\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u76f4\u5230\u200b\u83b7\u53d6\u200b\u6210\u529f\u200b\u6216\u8005\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\uff08\u200b\u4e2d\u65ad\u200b\uff09\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u4ece\u200b\u201c\u200b\u4f55\u65f6\u200b\u51fa\u200b\u961f\u5217\u200b\uff1f\u201d\u200b\u548c\u200b\u201c\u200b\u5982\u4f55\u200b\u51fa\u200b\u961f\u5217\u200b\uff1f\u201d\u200b\u4e24\u4e2a\u200b\u65b9\u5411\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200bacquireQueued\u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nfinal boolean acquireQueued(final Node node, int arg) {\n    // \u200b\u6807\u8bb0\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u62ff\u5230\u200b\u8d44\u6e90\u200b\n    boolean failed = true;\n    try {\n        // \u200b\u6807\u8bb0\u200b\u7b49\u5f85\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u662f\u5426\u200b\u4e2d\u65ad\u200b\u8fc7\u200b\n        boolean interrupted = false;\n        // \u200b\u5f00\u59cb\u200b\u81ea\u65cb\u200b\uff0c\u200b\u8981\u4e48\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u8981\u4e48\u200b\u4e2d\u65ad\u200b\n        for (;;) {\n            // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\n            final Node p = node.predecessor();\n            // \u200b\u5982\u679c\u200bp\u200b\u662f\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u5728\u200b\u771f\u5b9e\u200b\u6570\u636e\u200b\u961f\u5217\u200b\u7684\u200b\u9996\u90e8\u200b\uff0c\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff08\u200b\u522b\u5fd8\u4e86\u200b\u5934\u200b\u7ed3\u70b9\u200b\u662f\u200b\u865a\u200b\u8282\u70b9\u200b\uff09\n            if (p == head &amp;&amp; tryAcquire(arg)) {\n                // \u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u5934\u200b\u6307\u9488\u200b\u79fb\u52a8\u200b\u5230\u200b\u5f53\u524d\u200bnode\n                setHead(node);\n                p.next = null; // help GC\n                failed = false;\n                return interrupted;\n            }\n            // \u200b\u8bf4\u660e\u200bp\u200b\u4e3a\u5934\u200b\u8282\u70b9\u200b\u4e14\u200b\u5f53\u524d\u200b\u6ca1\u6709\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\uff08\u200b\u53ef\u80fd\u200b\u662f\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u88ab\u200b\u62a2\u5360\u200b\u4e86\u200b\uff09\u200b\u6216\u8005\u200b\u662f\u200bp\u200b\u4e0d\u4e3a\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u5c31\u8981\u200b\u5224\u65ad\u200b\u5f53\u524d\u200bnode\u200b\u662f\u5426\u200b\u8981\u200b\u88ab\u200b\u963b\u585e\u200b\uff08\u200b\u88ab\u200b\u963b\u585e\u200b\u6761\u4ef6\u200b\uff1a\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200bwaitStatus\u200b\u4e3a\u200b-1\uff09\uff0c\u200b\u9632\u6b62\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b\u6d6a\u8d39\u8d44\u6e90\u200b\u3002\u200b\u5177\u4f53\u200b\u4e24\u4e2a\u200b\u65b9\u6cd5\u200b\u4e0b\u9762\u200b\u7ec6\u7ec6\u200b\u5206\u6790\u200b\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt())\n                interrupted = true;\n        }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n</code></pre> <p>\u200b\u6ce8\u200b\uff1asetHead\u200b\u65b9\u6cd5\u200b\u662f\u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7f6e\u200b\u4e3a\u200b\u865a\u200b\u8282\u70b9\u200b\uff0c\u200b\u4f46\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200bwaitStatus\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u662f\u200b\u4e00\u76f4\u200b\u9700\u8981\u200b\u7528\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate void setHead(Node node) {\n    head = node;\n    node.thread = null;\n    node.prev = null;\n}\n\n// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\n// \u200b\u9760\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u5e94\u8be5\u200b\u88ab\u200b\u963b\u585e\u200b\nprivate static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {\n    // \u200b\u83b7\u53d6\u200b\u5934\u200b\u7ed3\u70b9\u200b\u7684\u200b\u8282\u70b9\u200b\u72b6\u6001\u200b\n    int ws = pred.waitStatus;\n    // \u200b\u8bf4\u660e\u200b\u5934\u200b\u7ed3\u70b9\u200b\u5904\u4e8e\u200b\u5524\u9192\u200b\u72b6\u6001\u200b\n    if (ws == Node.SIGNAL)\n        return true; \n    // \u200b\u901a\u8fc7\u200b\u679a\u4e3e\u200b\u503c\u200b\u6211\u4eec\u200b\u77e5\u9053\u200bwaitStatus&gt;0\u200b\u662f\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\n    if (ws &gt; 0) {\n        do {\n            // \u200b\u5faa\u73af\u200b\u5411\u524d\u200b\u67e5\u627e\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\uff0c\u200b\u628a\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u5254\u9664\u200b\n            node.prev = pred = pred.prev;\n        } while (pred.waitStatus &gt; 0);\n        pred.next = node;\n    } else {\n        // \u200b\u8bbe\u7f6e\u200b\u524d\u4efb\u200b\u8282\u70b9\u200b\u7b49\u5f85\u200b\u72b6\u6001\u200b\u4e3a\u200bSIGNAL\n        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);\n    }\n    return false;\n}\n</code></pre> <p>parkAndCheckInterrupt\u200b\u4e3b\u8981\u200b\u7528\u4e8e\u200b\u6302\u200b\u8d77\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u963b\u585e\u200b\u8c03\u7528\u200b\u6808\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\u3002</p> Kotlin<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate final boolean parkAndCheckInterrupt() {\n    LockSupport.park(this);\n    return Thread.interrupted();\n}\n</code></pre> <p>\u200b\u4e0a\u8ff0\u200b\u65b9\u6cd5\u200b\u7684\u200b\u6d41\u7a0b\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u4ece\u200b\u4e0a\u200b\u56fe\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0c\u200b\u8df3\u51fa\u200b\u5f53\u524d\u200b\u5faa\u73af\u200b\u7684\u200b\u6761\u4ef6\u200b\u662f\u200b\u5f53\u200b\u201c\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u662f\u200b\u5934\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u4e14\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\u201d\u3002\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u56e0\u200b\u6b7b\u5faa\u73af\u200b\u5bfc\u81f4\u200bCPU\u200b\u8d44\u6e90\u200b\u88ab\u200b\u6d6a\u8d39\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u5224\u65ad\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u6765\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u8981\u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b\uff0c\u200b\u5177\u4f53\u200b\u6302\u200b\u8d77\u200b\u6d41\u7a0b\u200b\u7528\u200b\u6d41\u7a0b\u56fe\u200b\u8868\u793a\u200b\u5982\u4e0b\u200b\uff08shouldParkAfterFailedAcquire\u200b\u6d41\u7a0b\u200b\uff09\uff1a</p> <p></p> <p>\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u91ca\u653e\u200b\u8282\u70b9\u200b\u7684\u200b\u7591\u8651\u200b\u6253\u6d88\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53c8\u200b\u6709\u200b\u65b0\u200b\u95ee\u9898\u200b\u4e86\u200b\uff1a</p> <ul> <li>shouldParkAfterFailedAcquire\u200b\u4e2d\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u662f\u200b\u600e\u4e48\u200b\u751f\u6210\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u4f1a\u200b\u628a\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u7684\u200bwaitStatus\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b-1\uff1f</li> <li>\u200b\u662f\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u95f4\u200b\u91ca\u653e\u200b\u8282\u70b9\u200b\u901a\u77e5\u200b\u5230\u200b\u88ab\u200b\u6302\u200b\u8d77\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5462\u200b\uff1f</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#232-cancelled","title":"2.3.2 CANCELLED\u200b\u72b6\u6001\u200b\u8282\u70b9\u200b\u751f\u6210","text":"<p>acquireQueued\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u7684\u200bFinally\u200b\u4ee3\u7801\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nfinal boolean acquireQueued(final Node node, int arg) {\n    boolean failed = true;\n    try {\n    ...\n        for (;;) {\n            final Node p = node.predecessor();\n            if (p == head &amp;&amp; tryAcquire(arg)) {\n                ...\n                failed = false;\n        ...\n            }\n            ...\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n        }\n}\n</code></pre> <p>\u200b\u901a\u8fc7\u200bcancelAcquire\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5c06\u200bNode\u200b\u7684\u200b\u72b6\u6001\u200b\u6807\u8bb0\u200b\u4e3a\u200bCANCELLED\u3002\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u6211\u4eec\u200b\u9010\u884c\u200b\u6765\u200b\u5206\u6790\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u7684\u200b\u539f\u7406\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate void cancelAcquire(Node node) {\n  // \u200b\u5c06\u200b\u65e0\u6548\u200b\u8282\u70b9\u200b\u8fc7\u6ee4\u200b\n    if (node == null)\n        return;\n  // \u200b\u8bbe\u7f6e\u200b\u8be5\u200b\u8282\u70b9\u200b\u4e0d\u200b\u5173\u8054\u200b\u4efb\u4f55\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u865a\u200b\u8282\u70b9\u200b\n    node.thread = null;\n    Node pred = node.prev;\n  // \u200b\u901a\u8fc7\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\uff0c\u200b\u8df3\u8fc7\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u7684\u200bnode\n    while (pred.waitStatus &gt; 0)\n        node.prev = pred = pred.prev;\n  // \u200b\u83b7\u53d6\u200b\u8fc7\u6ee4\u200b\u540e\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n    Node predNext = pred.next;\n  // \u200b\u628a\u200b\u5f53\u524d\u200bnode\u200b\u7684\u200b\u72b6\u6001\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bCANCELLED\n    node.waitStatus = Node.CANCELLED;\n  // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\uff0c\u200b\u5c06\u200b\u4ece\u200b\u540e\u200b\u5f80\u524d\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u975e\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u7684\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5c3e\u200b\u8282\u70b9\u200b\n  // \u200b\u66f4\u65b0\u200b\u5931\u8d25\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200belse\uff0c\u200b\u5982\u679c\u200b\u66f4\u65b0\u200b\u6210\u529f\u200b\uff0c\u200b\u5c06\u200btail\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bnull\n    if (node == tail &amp;&amp; compareAndSetTail(node, pred)) {\n        compareAndSetNext(pred, predNext, null);\n    } else {\n        int ws;\n    // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e0d\u662f\u200bhead\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c1:\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u662f\u5426\u200b\u4e3a\u200bSIGNAL\uff0c2:\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bSINGAL\u200b\u770b\u200b\u662f\u5426\u200b\u6210\u529f\u200b\n    // \u200b\u5982\u679c\u200b1\u200b\u548c\u200b2\u200b\u4e2d\u6709\u200b\u4e00\u4e2a\u200b\u4e3a\u200btrue\uff0c\u200b\u518d\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u4e3a\u200bnull\n    // \u200b\u5982\u679c\u200b\u4e0a\u8ff0\u200b\u6761\u4ef6\u200b\u90fd\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u6307\u9488\u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n        if (pred != head &amp;&amp; ((ws = pred.waitStatus) == Node.SIGNAL || (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp; pred.thread != null) {\n            Node next = node.next;\n            if (next != null &amp;&amp; next.waitStatus &lt;= 0)\n                compareAndSetNext(pred, predNext, next);\n        } else {\n      // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200bhead\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u200b\u6216\u8005\u200b\u4e0a\u8ff0\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5524\u9192\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\n            unparkSuccessor(node);\n        }\n        node.next = node; // help GC\n    }\n}\n</code></pre> <p>\u200b\u5f53\u524d\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li>\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\uff0c\u200b\u5982\u679c\u200b\u524d\u9a71\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u662f\u200bCANCELLED\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4e00\u76f4\u200b\u5f80\u524d\u200b\u904d\u5386\u200b\uff0c\u200b\u627e\u5230\u200b\u7b2c\u4e00\u4e2a\u200bwaitStatus &lt;= 0\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u5c06\u200b\u627e\u5230\u200b\u7684\u200bPred\u200b\u8282\u70b9\u200b\u548c\u200b\u5f53\u524d\u200bNode\u200b\u5173\u8054\u200b\uff0c\u200b\u5c06\u200b\u5f53\u524d\u200bNode\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bCANCELLED\u3002</li> <li>\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u8003\u8651\u200b\u4ee5\u4e0b\u200b\u4e09\u79cd\u200b\u60c5\u51b5\u200b\uff1a</li> </ul> <p>(1) \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3002</p> <p>(2) \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200bHead\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u3002</p> <p>(3) \u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e0d\u662f\u200bHead\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3002</p> <p>\u200b\u6839\u636e\u4e0a\u8ff0\u200b\u7b2c\u4e8c\u6761\u200b\uff0c\u200b\u6211\u4eec\u200b\u6765\u200b\u5206\u6790\u200b\u6bcf\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\u7684\u200b\u6d41\u7a0b\u200b\u3002</p> <p>\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3002</p> <p></p> <p>\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u662f\u200bHead\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u3002</p> <p></p> <p>\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e0d\u662f\u200bHead\u200b\u7684\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u5c3e\u200b\u8282\u70b9\u200b\u3002</p> <p></p> <p>\u200b\u901a\u8fc7\u200b\u4e0a\u9762\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u5bf9\u4e8e\u200bCANCELLED\u200b\u8282\u70b9\u200b\u72b6\u6001\u200b\u7684\u200b\u4ea7\u751f\u200b\u548c\u200b\u53d8\u5316\u200b\u5df2\u7ecf\u200b\u6709\u200b\u4e86\u200b\u5927\u81f4\u200b\u7684\u200b\u4e86\u89e3\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u6240\u6709\u200b\u7684\u200b\u53d8\u5316\u200b\u90fd\u200b\u662f\u200b\u5bf9\u200bNext\u200b\u6307\u9488\u200b\u8fdb\u884c\u200b\u4e86\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u800c\u200b\u6ca1\u6709\u200b\u5bf9\u200bPrev\u200b\u6307\u9488\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u5462\u200b\uff1f\u200b\u4ec0\u4e48\u200b\u60c5\u51b5\u200b\u4e0b\u4f1a\u200b\u5bf9\u200bPrev\u200b\u6307\u9488\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff1f</p> <p>\u200b\u6267\u884c\u200bcancelAcquire\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u524d\u7f6e\u200b\u8282\u70b9\u200b\u53ef\u80fd\u200b\u5df2\u7ecf\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u51fa\u53bb\u200b\u4e86\u200b\uff08\u200b\u5df2\u7ecf\u200b\u6267\u884c\u200b\u8fc7\u200bTry\u200b\u4ee3\u7801\u200b\u5757\u200b\u4e2d\u200b\u7684\u200bshouldParkAfterFailedAcquire\u200b\u65b9\u6cd5\u200b\u4e86\u200b\uff09\uff0c\u200b\u5982\u679c\u200b\u6b64\u65f6\u200b\u4fee\u6539\u200bPrev\u200b\u6307\u9488\u200b\uff0c\u200b\u6709\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200bPrev\u200b\u6307\u5411\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5df2\u7ecf\u200b\u79fb\u9664\u200b\u961f\u5217\u200b\u7684\u200bNode\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u5757\u200b\u53d8\u5316\u200bPrev\u200b\u6307\u9488\u200b\u4e0d\u200b\u5b89\u5168\u200b\u3002 shouldParkAfterFailedAcquire\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u4f1a\u200b\u6267\u884c\u200b\u4e0b\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u5728\u200b\u5904\u7406\u200bPrev\u200b\u6307\u9488\u200b\u3002shouldParkAfterFailedAcquire\u200b\u662f\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u624d\u200b\u4f1a\u200b\u6267\u884c\u200b\uff0c\u200b\u8fdb\u5165\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u540e\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5171\u4eab\u8d44\u6e90\u200b\u5df2\u200b\u88ab\u200b\u83b7\u53d6\u200b\uff0c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u4e4b\u524d\u200b\u7684\u200b\u8282\u70b9\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u53d8\u5316\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u53d8\u66f4\u200bPrev\u200b\u6307\u9488\u200b\u6bd4\u8f83\u200b\u5b89\u5168\u200b\u3002</p> CoffeeScript<pre><code>do {\n  node.prev = pred = pred.prev;\n} while (pred.waitStatus &gt; 0);\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#233","title":"2.3.3 \u200b\u5982\u4f55\u200b\u89e3\u9501","text":"<p>\u200b\u6211\u4eec\u200b\u5df2\u7ecf\u200b\u5256\u6790\u200b\u4e86\u200b\u52a0\u9501\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u57fa\u672c\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u518d\u200b\u5bf9\u200b\u89e3\u9501\u200b\u7684\u200b\u57fa\u672c\u200b\u6d41\u7a0b\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\u3002\u200b\u7531\u4e8e\u200bReentrantLock\u200b\u5728\u200b\u89e3\u9501\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u533a\u5206\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u4eec\u200b\u76f4\u63a5\u200b\u770b\u200b\u89e3\u9501\u200b\u7684\u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.ReentrantLock\n\npublic void unlock() {\n    sync.release(1);\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u672c\u8d28\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u662f\u200b\u901a\u8fc7\u200b\u6846\u67b6\u200b\u6765\u200b\u5b8c\u6210\u200b\u7684\u200b\u3002</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) {\n        Node h = head;\n        if (h != null &amp;&amp; h.waitStatus != 0)\n            unparkSuccessor(h);\n        return true;\n    }\n    return false;\n}\n</code></pre> <p>\u200b\u5728\u200bReentrantLock\u200b\u91cc\u9762\u200b\u7684\u200b\u516c\u5e73\u200b\u9501\u200b\u548c\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\u7684\u200b\u7236\u7c7b\u200bSync\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u7684\u200b\u91ca\u653e\u200b\u9501\u200b\u673a\u5236\u200b\u3002</p> Java<pre><code>// java.util.concurrent.locks.ReentrantLock.Sync\n\n// \u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u9501\u200b\u662f\u4e0d\u662f\u200b\u6ca1\u6709\u200b\u88ab\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\nprotected final boolean tryRelease(int releases) {\n    // \u200b\u51cf\u5c11\u200b\u53ef\u200b\u91cd\u5165\u200b\u6b21\u6570\u200b\n    int c = getState() - releases;\n    // \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e0d\u662f\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\n    if (Thread.currentThread() != getExclusiveOwnerThread())\n        throw new IllegalMonitorStateException();\n    boolean free = false;\n    // \u200b\u5982\u679c\u200b\u6301\u6709\u200b\u7ebf\u7a0b\u200b\u5168\u90e8\u200b\u91ca\u653e\u200b\uff0c\u200b\u5c06\u200b\u5f53\u524d\u200b\u72ec\u5360\u200b\u9501\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bnull\uff0c\u200b\u5e76\u200b\u66f4\u65b0\u200bstate\n    if (c == 0) {\n        free = true;\n        setExclusiveOwnerThread(null);\n    }\n    setState(c);\n    return free;\n}\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u6765\u200b\u89e3\u91ca\u200b\u4e0b\u8ff0\u200b\u6e90\u7801\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\npublic final boolean release(int arg) {\n    // \u200b\u4e0a\u8fb9\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200btryRelease\u200b\u5982\u679c\u200b\u8fd4\u56de\u200btrue\uff0c\u200b\u8bf4\u660e\u200b\u8be5\u9501\u200b\u6ca1\u6709\u200b\u88ab\u200b\u4efb\u4f55\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\n    if (tryRelease(arg)) {\n        // \u200b\u83b7\u53d6\u200b\u5934\u200b\u7ed3\u70b9\u200b\n        Node h = head;\n        // \u200b\u5934\u200b\u7ed3\u70b9\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\u5e76\u4e14\u200b\u5934\u200b\u7ed3\u70b9\u200b\u7684\u200bwaitStatus\u200b\u4e0d\u662f\u200b\u521d\u59cb\u5316\u200b\u8282\u70b9\u200b\u60c5\u51b5\u200b\uff0c\u200b\u89e3\u9664\u200b\u7ebf\u7a0b\u200b\u6302\u200b\u8d77\u200b\u72b6\u6001\u200b\n        if (h != null &amp;&amp; h.waitStatus != 0)\n            unparkSuccessor(h);\n        return true;\n    }\n    return false;\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u5224\u65ad\u200b\u6761\u4ef6\u200b\u4e3a\u4ec0\u4e48\u200b\u662f\u200bh != null &amp;&amp; h.waitStatus != 0\uff1f</p> <p>h == null Head\u200b\u8fd8\u200b\u6ca1\u200b\u521d\u59cb\u5316\u200b\u3002\u200b\u521d\u59cb\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0chead == null\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u5165\u961f\u200b\uff0cHead\u200b\u4f1a\u200b\u88ab\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u865a\u62df\u200b\u8282\u70b9\u200b\u3002\u200b\u6240\u4ee5\u200b\u8bf4\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5982\u679c\u200b\u8fd8\u200b\u6ca1\u200b\u6765\u5f97\u53ca\u200b\u5165\u961f\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200bhead == null \u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>h != null &amp;&amp; waitStatus == 0 \u200b\u8868\u660e\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4ecd\u200b\u5728\u200b\u8fd0\u884c\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5524\u9192\u200b\u3002</p> <p>h != null &amp;&amp; waitStatus &lt; 0 \u200b\u8868\u660e\u200b\u540e\u7ee7\u200b\u8282\u70b9\u200b\u53ef\u80fd\u200b\u88ab\u200b\u963b\u585e\u200b\u4e86\u200b\uff0c\u200b\u9700\u8981\u200b\u5524\u9192\u200b\u3002</p> <p>\u200b\u518d\u200b\u770b\u200b\u4e00\u4e0b\u200bunparkSuccessor\u200b\u65b9\u6cd5\u200b\uff1a</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate void unparkSuccessor(Node node) {\n    // \u200b\u83b7\u53d6\u200b\u5934\u200b\u7ed3\u70b9\u200bwaitStatus\n    int ws = node.waitStatus;\n    if (ws &lt; 0)\n        compareAndSetWaitStatus(node, ws, 0);\n    // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\n    Node s = node.next;\n    // \u200b\u5982\u679c\u200b\u4e0b\u4e2a\u200b\u8282\u70b9\u200b\u662f\u200bnull\u200b\u6216\u8005\u200b\u4e0b\u4e2a\u200b\u8282\u70b9\u200b\u88ab\u200bcancelled\uff0c\u200b\u5c31\u200b\u627e\u5230\u200b\u961f\u5217\u200b\u6700\u200b\u5f00\u59cb\u200b\u7684\u200b\u975e\u200bcancelled\u200b\u7684\u200b\u8282\u70b9\u200b\n    if (s == null || s.waitStatus &gt; 0) {\n        s = null;\n        // \u200b\u5c31\u200b\u4ece\u200b\u5c3e\u90e8\u200b\u8282\u70b9\u200b\u5f00\u59cb\u200b\u627e\u200b\uff0c\u200b\u5230\u200b\u961f\u9996\u200b\uff0c\u200b\u627e\u5230\u200b\u961f\u5217\u200b\u7b2c\u4e00\u4e2a\u200bwaitStatus&lt;0\u200b\u7684\u200b\u8282\u70b9\u200b\u3002\n        for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)\n            if (t.waitStatus &lt;= 0)\n                s = t;\n    }\n    // \u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u4e0b\u4e2a\u200b\u8282\u70b9\u200b\u4e0d\u4e3a\u200b\u7a7a\u200b\uff0c\u200b\u800c\u4e14\u200b\u72b6\u6001\u200b&lt;=0\uff0c\u200b\u5c31\u200b\u628a\u200b\u5f53\u524d\u200b\u8282\u70b9\u200bunpark\n    if (s != null)\n        LockSupport.unpark(s.thread);\n}\n</code></pre> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u4ece\u200b\u540e\u200b\u5f80\u524d\u200b\u627e\u200b\u7b2c\u4e00\u4e2a\u200b\u975e\u200bCancelled\u200b\u7684\u200b\u8282\u70b9\u200b\u5462\u200b\uff1f\u200b\u539f\u56e0\u200b\u5982\u4e0b\u200b\u3002</p> <p>\u200b\u4e4b\u524d\u200b\u7684\u200baddWaiter\u200b\u65b9\u6cd5\u200b\uff1a</p> Kotlin<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate Node addWaiter(Node mode) {\n    Node node = new Node(Thread.currentThread(), mode);\n    // Try the fast path of enq; backup to full enq on failure\n    Node pred = tail;\n    if (pred != null) {\n        node.prev = pred;\n        if (compareAndSetTail(pred, node)) {\n            pred.next = node;\n            return node;\n        }\n    }\n    enq(node);\n    return node;\n}\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u4ece\u200b\u8fd9\u91cc\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8282\u70b9\u200b\u5165\u961f\u200b\u5e76\u200b\u4e0d\u662f\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0cnode.prev = pred; compareAndSetTail(pred, node) \u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5730\u65b9\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200bTail\u200b\u5165\u961f\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f46\u662f\u200b\u6b64\u65f6\u200bpred.next = node;\u200b\u8fd8\u200b\u6ca1\u200b\u6267\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u6267\u884c\u200b\u4e86\u200bunparkSuccessor\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5c31\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u4ece\u524d\u200b\u5f80\u540e\u200b\u627e\u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u4ece\u540e\u200b\u5f80\u524d\u200b\u627e\u200b\u3002\u200b\u8fd8\u6709\u200b\u4e00\u70b9\u200b\u539f\u56e0\u200b\uff0c\u200b\u5728\u200b\u4ea7\u751f\u200bCANCELLED\u200b\u72b6\u6001\u200b\u8282\u70b9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5148\u200b\u65ad\u5f00\u200b\u7684\u200b\u662f\u200bNext\u200b\u6307\u9488\u200b\uff0cPrev\u200b\u6307\u9488\u200b\u5e76\u672a\u200b\u65ad\u5f00\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u662f\u200b\u5fc5\u987b\u200b\u8981\u200b\u4ece\u200b\u540e\u200b\u5f80\u524d\u200b\u904d\u5386\u200b\u624d\u200b\u80fd\u591f\u200b\u904d\u5386\u200b\u5b8c\u5168\u200b\u90e8\u200b\u7684\u200bNode\u3002</p> <p>\u200b\u7efc\u4e0a\u6240\u8ff0\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u4ece\u200b\u524d\u5f80\u200b\u540e\u200b\u627e\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6781\u7aef\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5165\u961f\u200b\u7684\u200b\u975e\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u548c\u200bCANCELLED\u200b\u8282\u70b9\u200b\u4ea7\u751f\u200b\u8fc7\u7a0b\u200b\u4e2d\u65ad\u200b\u5f00\u200bNext\u200b\u6307\u9488\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u65e0\u6cd5\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u7684\u200b\u8282\u70b9\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u5524\u9192\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u540e\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u5f80\u200b\u4e0b\u200b\u6267\u884c\u200b\u3002\u200b\u7ee7\u7eed\u6267\u884c\u200bacquireQueued\u200b\u65b9\u6cd5\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4e2d\u65ad\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\uff1f</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#234","title":"2.3.4 \u200b\u4e2d\u65ad\u200b\u6062\u590d\u200b\u540e\u200b\u7684\u200b\u6267\u884c\u200b\u6d41\u7a0b","text":"<p>\u200b\u5524\u9192\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u6267\u884c\u200breturn Thread.interrupted();\uff0c\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b\u5f53\u524d\u200b\u6267\u884c\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u200b\u6e05\u9664\u200b\u3002</p> Kotlin<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate final boolean parkAndCheckInterrupt() {\n    LockSupport.park(this);\n    return Thread.interrupted();\n}\n</code></pre> <p>\u200b\u518d\u200b\u56de\u5230\u200bacquireQueued\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5f53\u200bparkAndCheckInterrupt\u200b\u8fd4\u56de\u200bTrue\u200b\u6216\u8005\u200bFalse\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cinterrupted\u200b\u7684\u200b\u503c\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u200b\u90fd\u200b\u4f1a\u200b\u6267\u884c\u200b\u4e0b\u6b21\u200b\u5faa\u73af\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u83b7\u53d6\u200b\u9501\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b\u5f53\u524d\u200binterrupted\u200b\u8fd4\u56de\u200b\u3002</p> Java<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nfinal boolean acquireQueued(final Node node, int arg) {\n    boolean failed = true;\n    try {\n        boolean interrupted = false;\n        for (;;) {\n            final Node p = node.predecessor();\n            if (p == head &amp;&amp; tryAcquire(arg)) {\n                setHead(node);\n                p.next = null; // help GC\n                failed = false;\n                return interrupted;\n            }\n            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt())\n                interrupted = true;\n            }\n    } finally {\n        if (failed)\n            cancelAcquire(node);\n    }\n}\n</code></pre> <p>\u200b\u5982\u679c\u200bacquireQueued\u200b\u4e3a\u200bTrue\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u6267\u884c\u200bselfInterrupt\u200b\u65b9\u6cd5\u200b\u3002</p> C#<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nstatic void selfInterrupt() {\n    Thread.currentThread().interrupt();\n}\n</code></pre> <p>\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u5176\u5b9e\u200b\u662f\u200b\u4e3a\u4e86\u200b\u4e2d\u65ad\u200b\u7ebf\u7a0b\u200b\u3002\u200b\u4f46\u200b\u4e3a\u4ec0\u4e48\u200b\u83b7\u53d6\u200b\u4e86\u200b\u9501\u200b\u4ee5\u540e\u200b\u8fd8\u8981\u200b\u4e2d\u65ad\u200b\u7ebf\u7a0b\u200b\u5462\u200b\uff1f\u200b\u8fd9\u90e8\u5206\u200b\u5c5e\u4e8e\u200bJava\u200b\u63d0\u4f9b\u200b\u7684\u200b\u534f\u4f5c\u200b\u5f0f\u200b\u4e2d\u65ad\u200b\u77e5\u8bc6\u200b\u5185\u5bb9\u200b\uff0c\u200b\u611f\u5174\u8da3\u200b\u540c\u5b66\u200b\u53ef\u4ee5\u200b\u67e5\u9605\u200b\u4e00\u4e0b\u200b\u3002\u200b\u8fd9\u91cc\u200b\u7b80\u5355\u200b\u4ecb\u7ecd\u200b\u4e00\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u5f53\u4e2d\u200b\u65ad\u7ebf\u200b\u7a0b\u200b\u88ab\u200b\u5524\u9192\u200b\u65f6\u200b\uff0c\u200b\u5e76\u4e0d\u77e5\u9053\u200b\u88ab\u200b\u5524\u9192\u200b\u7684\u200b\u539f\u56e0\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u7b49\u5f85\u200b\u4e2d\u200b\u88ab\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u91ca\u653e\u200b\u4e86\u200b\u9501\u200b\u4ee5\u540e\u200b\u88ab\u200b\u5524\u9192\u200b\u3002\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200bThread.interrupted()\u200b\u65b9\u6cd5\u200b\u68c0\u67e5\u200b\u4e2d\u65ad\u200b\u6807\u8bb0\u200b\uff08\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u4e86\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e2d\u65ad\u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u4e2d\u65ad\u200b\u6807\u8bc6\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bFalse\uff09\uff0c\u200b\u5e76\u200b\u8bb0\u5f55\u4e0b\u6765\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u8fc7\u200b\uff0c\u200b\u5c31\u200b\u518d\u200b\u4e2d\u65ad\u200b\u4e00\u6b21\u200b\u3002</li> <li>\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u7b49\u5f85\u200b\u8d44\u6e90\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u5524\u9192\u200b\u540e\u200b\u8fd8\u662f\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u5730\u53bb\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u76f4\u5230\u200b\u62a2\u5230\u200b\u9501\u200b\u4e3a\u6b62\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5728\u200b\u6574\u4e2a\u200b\u6d41\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u54cd\u5e94\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u53ea\u662f\u200b\u8bb0\u5f55\u200b\u4e2d\u65ad\u200b\u8bb0\u5f55\u200b\u3002\u200b\u6700\u540e\u200b\u62a2\u5230\u200b\u9501\u200b\u8fd4\u56de\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u8fc7\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u8865\u5145\u200b\u4e00\u6b21\u200b\u4e2d\u65ad\u200b\u3002</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\u4e3b\u8981\u200b\u662f\u200b\u8fd0\u7528\u200b\u7ebf\u7a0b\u200b\u6c60\u4e2d\u200b\u57fa\u672c\u200b\u8fd0\u4f5c\u200b\u5355\u5143\u200bWorder\u200b\u4e2d\u200b\u7684\u200brunWorker\uff0c\u200b\u901a\u8fc7\u200bThread.interrupted()\u200b\u8fdb\u884c\u200b\u989d\u5916\u200b\u7684\u200b\u5224\u65ad\u200b\u5904\u7406\u200b\uff0c\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u540c\u5b66\u200b\u53ef\u4ee5\u200b\u770b\u200b\u4e0b\u200bThreadPoolExecutor\u200b\u6e90\u7801\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#235","title":"2.3.5 \u200b\u5c0f\u7ed3","text":"<p>\u200b\u6211\u4eec\u200b\u5728\u200b1.3\u200b\u5c0f\u8282\u200b\u4e2d\u200b\u63d0\u51fa\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u95ee\u9898\u200b\uff0c\u200b\u73b0\u5728\u200b\u6765\u200b\u56de\u7b54\u200b\u4e00\u4e0b\u200b\u3002</p> <p>Q\uff1a\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\u7684\u200b\u540e\u7eed\u200b\u6d41\u7a0b\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5462\u200b\uff1f</p> <p>A\uff1a\u200b\u5b58\u5728\u200b\u67d0\u79cd\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u7ee7\u7eed\u200b\u7b49\u5f85\u200b\uff0c\u200b\u4ecd\u7136\u200b\u4fdd\u7559\u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u53ef\u80fd\u200b\uff0c\u200b\u83b7\u53d6\u200b\u9501\u200b\u6d41\u7a0b\u200b\u4ecd\u200b\u5728\u200b\u7ee7\u7eed\u200b\u3002</p> <p>Q\uff1a\u200b\u65e2\u7136\u200b\u8bf4\u200b\u5230\u200b\u4e86\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u6709\u200b\u67d0\u79cd\u200b\u961f\u5217\u200b\u5f62\u6210\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u961f\u5217\u200b\u662f\u200b\u4ec0\u4e48\u200b\u6570\u636e\u7ed3\u6784\u200b\u5462\u200b\uff1f</p> <p>A\uff1a\u200b\u662f\u200bCLH\u200b\u53d8\u4f53\u200b\u7684\u200bFIFO\u200b\u53cc\u7aef\u200b\u961f\u5217\u200b\u3002</p> <p>Q\uff1a\u200b\u5904\u4e8e\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u6709\u200b\u673a\u4f1a\u200b\u83b7\u53d6\u200b\u9501\u200b\u5462\u200b\uff1f</p> <p>A\uff1a\u200b\u53ef\u4ee5\u200b\u8be6\u7ec6\u200b\u770b\u200b\u4e0b\u200b2.3.1.3\u200b\u5c0f\u8282\u200b\u3002</p> <p>Q\uff1a\u200b\u5982\u679c\u200b\u5904\u4e8e\u200b\u6392\u961f\u200b\u7b49\u5019\u200b\u673a\u5236\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e00\u76f4\u200b\u65e0\u6cd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u9700\u8981\u200b\u4e00\u76f4\u200b\u7b49\u5f85\u200b\u4e48\u200b\uff1f\u200b\u8fd8\u662f\u200b\u6709\u200b\u522b\u7684\u200b\u7b56\u7565\u200b\u6765\u200b\u89e3\u51b3\u200b\u8fd9\u4e00\u200b\u95ee\u9898\u200b\uff1f</p> <p>A\uff1a\u200b\u7ebf\u7a0b\u200b\u6240\u5728\u200b\u8282\u70b9\u200b\u7684\u200b\u72b6\u6001\u200b\u4f1a\u200b\u53d8\u6210\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\uff0c\u200b\u53d6\u6d88\u200b\u72b6\u6001\u200b\u7684\u200b\u8282\u70b9\u200b\u4f1a\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u91ca\u653e\u200b\uff0c\u200b\u5177\u4f53\u200b\u53ef\u89c1\u200b2.3.2\u200b\u5c0f\u8282\u200b\u3002</p> <p>Q\uff1aLock\u200b\u51fd\u6570\u200b\u901a\u8fc7\u200bAcquire\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u52a0\u9501\u200b\uff0c\u200b\u4f46\u662f\u200b\u5177\u4f53\u200b\u662f\u200b\u5982\u4f55\u200b\u52a0\u9501\u200b\u7684\u200b\u5462\u200b\uff1f</p> <p>A\uff1aAQS\u200b\u7684\u200bAcquire\u200b\u4f1a\u200b\u8c03\u7528\u200btryAcquire\u200b\u65b9\u6cd5\u200b\uff0ctryAcquire\u200b\u7531\u200b\u5404\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u5668\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u901a\u8fc7\u200btryAcquire\u200b\u5b8c\u6210\u200b\u52a0\u9501\u200b\u8fc7\u7a0b\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#3-aqs","title":"3 AQS\u200b\u5e94\u7528","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#31-reentrantlock","title":"3.1 ReentrantLock\u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u200b\u5e94\u7528","text":"<p>ReentrantLock\u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u200b\u6027\u200b\u662f\u200bAQS\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u5e94\u7528\u200b\u4e4b\u4e00\u200b\uff0c\u200b\u5728\u200b\u4e86\u89e3\u200b\u5b8c\u200b\u4e0a\u8ff0\u200b\u77e5\u8bc6\u70b9\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u5f88\u200b\u5bb9\u6613\u200b\u5f97\u77e5\u200bReentrantLock\u200b\u5b9e\u73b0\u200b\u53ef\u200b\u91cd\u5165\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5728\u200bReentrantLock\u200b\u91cc\u9762\u200b\uff0c\u200b\u4e0d\u7ba1\u200b\u662f\u200b\u516c\u5e73\u200b\u9501\u200b\u8fd8\u200b\u662f\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff0c\u200b\u90fd\u200b\u6709\u200b\u4e00\u6bb5\u200b\u903b\u8f91\u200b\u3002</p> <p>\u200b\u516c\u5e73\u200b\u9501\u200b\uff1a</p> TypeScript<pre><code>// java.util.concurrent.locks.ReentrantLock.FairSync#tryAcquire\n\nif (c == 0) {\n    if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) {\n        setExclusiveOwnerThread(current);\n        return true;\n    }\n}\nelse if (current == getExclusiveOwnerThread()) {\n    int nextc = c + acquires;\n    if (nextc &lt; 0)\n        throw new Error(\"Maximum lock count exceeded\");\n    setState(nextc);\n    return true;\n}\n</code></pre> <p>\u200b\u975e\u200b\u516c\u5e73\u200b\u9501\u200b\uff1a</p> TypeScript<pre><code>// java.util.concurrent.locks.ReentrantLock.Sync#nonfairTryAcquire\n\nif (c == 0) {\n    if (compareAndSetState(0, acquires)){\n        setExclusiveOwnerThread(current);\n        return true;\n    }\n}\nelse if (current == getExclusiveOwnerThread()) {\n    int nextc = c + acquires;\n    if (nextc &lt; 0) // overflow\n        throw new Error(\"Maximum lock count exceeded\");\n    setState(nextc);\n    return true;\n}\n</code></pre> <p>\u200b\u4ece\u200b\u4e0a\u9762\u200b\u8fd9\u200b\u4e24\u6bb5\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u540c\u6b65\u200b\u72b6\u6001\u200bState\u200b\u6765\u200b\u63a7\u5236\u200b\u6574\u4f53\u200b\u53ef\u200b\u91cd\u5165\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002State\u200b\u662f\u200bVolatile\u200b\u4fee\u9970\u200b\u7684\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4fdd\u8bc1\u200b\u4e00\u5b9a\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b\u548c\u200b\u6709\u5e8f\u6027\u200b\u3002</p> Groovy<pre><code>// java.util.concurrent.locks.AbstractQueuedSynchronizer\n\nprivate volatile int state;\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200bState\u200b\u8fd9\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\u4e3b\u8981\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ol> <li>State\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\u4e3a\u200b0\uff0c\u200b\u8868\u793a\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u9501\u200b\u3002</li> <li>\u200b\u5f53\u6709\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u8be5\u9501\u200b\u65f6\u200b\uff0c\u200b\u503c\u200b\u5c31\u200b\u4f1a\u200b\u5728\u200b\u539f\u6765\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b+1\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u591a\u6b21\u200b\u83b7\u5f97\u200b\u9501\u200b\u662f\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u591a\u6b21\u200b+1\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u662f\u200b\u53ef\u200b\u91cd\u5165\u200b\u7684\u200b\u6982\u5ff5\u200b\u3002</li> <li>\u200b\u89e3\u9501\u200b\u4e5f\u200b\u662f\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u5b57\u200b\u6bb5\u200b-1\uff0c\u200b\u4e00\u76f4\u200b\u5230\u200b0\uff0c\u200b\u6b64\u200b\u7ebf\u7a0b\u200b\u5bf9\u9501\u200b\u91ca\u653e\u200b\u3002</li> </ol>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#32-juc","title":"3.2 JUC\u200b\u4e2d\u200b\u7684\u200b\u5e94\u7528\u200b\u573a\u666f","text":"<p>\u200b\u9664\u4e86\u200b\u4e0a\u8fb9\u200bReentrantLock\u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u200b\u6027\u200b\u7684\u200b\u5e94\u7528\u200b\uff0cAQS\u200b\u4f5c\u4e3a\u200b\u5e76\u53d1\u200b\u7f16\u7a0b\u200b\u7684\u200b\u6846\u67b6\u200b\uff0c\u200b\u4e3a\u200b\u5f88\u591a\u200b\u5176\u4ed6\u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u826f\u597d\u200b\u7684\u200b\u89e3\u51b3\u65b9\u6848\u200b\u3002\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u4e86\u200bJUC\u200b\u4e2d\u200b\u7684\u200b\u51e0\u79cd\u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\uff0c\u200b\u5927\u4f53\u200b\u4ecb\u7ecd\u200b\u4e00\u4e0b\u200bAQS\u200b\u7684\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a</p> \u200b\u540c\u6b65\u200b\u5de5\u5177\u200b \u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\u4e0e\u200bAQS\u200b\u7684\u200b\u5173\u8054\u200b ReentrantLock \u200b\u4f7f\u7528\u200bAQS\u200b\u4fdd\u5b58\u200b\u9501\u200b\u91cd\u590d\u200b\u6301\u6709\u200b\u7684\u200b\u6b21\u6570\u200b\u3002\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u9501\u65f6\u200b\uff0cReentrantLock\u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u83b7\u5f97\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6807\u8bc6\u200b\uff0c\u200b\u7528\u4e8e\u200b\u68c0\u6d4b\u200b\u662f\u5426\u200b\u91cd\u590d\u200b\u83b7\u53d6\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u9519\u8bef\u200b\u7ebf\u7a0b\u200b\u8bd5\u56fe\u200b\u89e3\u9501\u200b\u64cd\u4f5c\u200b\u65f6\u200b\u5f02\u5e38\u60c5\u51b5\u200b\u7684\u200b\u5904\u7406\u200b\u3002 Semaphore \u200b\u4f7f\u7528\u200bAQS\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u6765\u200b\u4fdd\u5b58\u200b\u4fe1\u53f7\u91cf\u200b\u7684\u200b\u5f53\u524d\u200b\u8ba1\u6570\u200b\u3002tryRelease\u200b\u4f1a\u200b\u589e\u52a0\u200b\u8ba1\u6570\u200b\uff0cacquireShared\u200b\u4f1a\u200b\u51cf\u5c11\u200b\u8ba1\u6570\u200b\u3002 CountDownLatch \u200b\u4f7f\u7528\u200bAQS\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u6765\u200b\u8868\u793a\u200b\u8ba1\u6570\u200b\u3002\u200b\u8ba1\u6570\u200b\u4e3a\u200b0\u200b\u65f6\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200bAcquire\u200b\u64cd\u4f5c\u200b\uff08CountDownLatch\u200b\u7684\u200bawait\u200b\u65b9\u6cd5\u200b\uff09\u200b\u624d\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u3002 ReentrantReadWriteLock \u200b\u4f7f\u7528\u200bAQS\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u4e2d\u200b\u7684\u200b16\u200b\u4f4d\u200b\u4fdd\u5b58\u200b\u5199\u9501\u200b\u6301\u6709\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b16\u200b\u4f4d\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u8bfb\u9501\u200b\u7684\u200b\u6301\u6709\u200b\u6b21\u6570\u200b\u3002 ThreadPoolExecutor Worker\u200b\u5229\u7528\u200bAQS\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u5b9e\u73b0\u200b\u5bf9\u200b\u72ec\u5360\u200b\u7ebf\u7a0b\u200b\u53d8\u91cf\u200b\u7684\u200b\u8bbe\u7f6e\u200b\uff08tryAcquire\u200b\u548c\u200btryRelease\uff09\u3002","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#33","title":"3.3 \u200b\u81ea\u5b9a\u4e49\u200b\u540c\u6b65\u200b\u5de5\u5177","text":"<p>\u200b\u4e86\u89e3\u200bAQS\u200b\u57fa\u672c\u539f\u7406\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6309\u7167\u200b\u4e0a\u9762\u200b\u6240\u8bf4\u200b\u7684\u200bAQS\u200b\u77e5\u8bc6\u70b9\u200b\uff0c\u200b\u81ea\u5df1\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\u3002</p> Java<pre><code>public class LeeLock  {\n\n    private static class Sync extends AbstractQueuedSynchronizer {\n        @Override\n        protected boolean tryAcquire (int arg) {\n            return compareAndSetState(0, 1);\n        }\n\n        @Override\n        protected boolean tryRelease (int arg) {\n            setState(0);\n            return true;\n        }\n\n        @Override\n        protected boolean isHeldExclusively () {\n            return getState() == 1;\n        }\n    }\n\n    private Sync sync = new Sync();\n\n    public void lock () {\n        sync.acquire(1);\n    }\n\n    public void unlock () {\n        sync.release(1);\n    }\n}\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u6211\u4eec\u200b\u81ea\u5df1\u200b\u5b9a\u4e49\u200b\u7684\u200bLock\u200b\u5b8c\u6210\u200b\u4e00\u5b9a\u200b\u7684\u200b\u540c\u6b65\u200b\u529f\u80fd\u200b\u3002</p> C#<pre><code>public class LeeMain {\n\n    static int count = 0;\n    static LeeLock leeLock = new LeeLock();\n\n    public static void main (String[] args) throws InterruptedException {\n\n        Runnable runnable = new Runnable() {\n            @Override\n            public void run () {\n                try {\n                    leeLock.lock();\n                    for (int i = 0; i &lt; 10000; i++) {\n                        count++;\n                    }\n                } catch (Exception e) {\n                    e.printStackTrace();\n                } finally {\n                    leeLock.unlock();\n                }\n\n            }\n        };\n        Thread thread1 = new Thread(runnable);\n        Thread thread2 = new Thread(runnable);\n        thread1.start();\n        thread2.start();\n        thread1.join();\n        thread2.join();\n        System.out.println(count);\n    }\n}\n</code></pre> <p>\u200b\u4e0a\u8ff0\u200b\u4ee3\u7801\u200b\u6bcf\u6b21\u200b\u8fd0\u884c\u200b\u7ed3\u679c\u200b\u90fd\u200b\u4f1a\u200b\u662f\u200b20000\u3002\u200b\u901a\u8fc7\u200b\u7b80\u5355\u200b\u7684\u200b\u51e0\u884c\u200b\u4ee3\u7801\u200b\u5c31\u200b\u80fd\u200b\u5b9e\u73b0\u200b\u540c\u6b65\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200bAQS\u200b\u7684\u200b\u5f3a\u5927\u200b\u4e4b\u200b\u5904\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#_2","title":"\u603b\u7ed3","text":"<p>\u200b\u6211\u4eec\u200b\u65e5\u5e38\u200b\u5f00\u53d1\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u5e76\u53d1\u200b\u7684\u200b\u573a\u666f\u200b\u592a\u200b\u591a\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u200b\u5e76\u53d1\u200b\u5185\u90e8\u200b\u7684\u200b\u57fa\u672c\u200b\u6846\u67b6\u200b\u539f\u7406\u200b\u4e86\u89e3\u200b\u7684\u200b\u4eba\u200b\u5374\u200b\u4e0d\u200b\u591a\u200b\u3002\u200b\u7531\u4e8e\u200b\u7bc7\u5e45\u200b\u539f\u56e0\u200b\uff0c\u200b\u672c\u6587\u200b\u4ec5\u200b\u4ecb\u7ecd\u200b\u4e86\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200bReentrantLock\u200b\u7684\u200b\u539f\u7406\u200b\u548c\u200bAQS\u200b\u539f\u7406\u200b\uff0c\u200b\u5e0c\u671b\u200b\u80fd\u591f\u200b\u6210\u4e3a\u200b\u5927\u5bb6\u200b\u4e86\u89e3\u200bAQS\u200b\u548c\u200bReentrantLock\u200b\u7b49\u200b\u540c\u6b65\u5668\u200b\u7684\u200b\u201c\u200b\u6572\u95e8\u7816\u200b\u201d\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Lea D. The java. util. concurrent synchronizer framework[J]. Science of Computer Programming, 2005, 58(3): 293-309.</li> <li>\u300aJava\u200b\u5e76\u53d1\u200b\u7f16\u7a0b\u200b\u5b9e\u6218\u200b\u300b</li> <li>\u200b\u4e0d\u53ef\u4e0d\u200b\u8bf4\u200b\u7684\u200bJava\u201c\u200b\u9501\u200b\u201d\u200b\u4e8b\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/","title":"\u5206\u5e03\u5f0f\u200b\u9501","text":"<p> \u200b\u7ea6\u200b 3366 \u200b\u4e2a\u200b\u5b57\u200b  405 \u200b\u884c\u200b\u4ee3\u7801\u200b  8 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 16 \u200b\u5206\u949f\u200b</p> <p>Tip</p> <p>\u200b\u57fa\u4e8e\u200b\u9ed1\u9a6c\u200b\u70b9\u8bc4\u200b \u200b\u9ed1\u9a6c\u200b\u70b9\u8bc4\u200b\u9879\u76ee\u200b\u5b66\u4e60\u200b\u7b14\u8bb0\u200b\uff0815w\u200b\u5b57\u200b\u8be6\u89e3\u200b\uff0c\u200b\u582a\u79f0\u200b\u53f2\u4e0a\u200b\u6700\u200b\u8be6\u7ec6\u200b\uff0c\u200b\u6b22\u8fce\u200b\u6536\u85cf\u200b\uff09-CSDN\u200b\u535a\u5ba2\u200b </p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#_2","title":"\u5206\u5e03\u5f0f\u200b\u9501\u200b\u57fa\u672c\u200b\u4ecb\u7ecd","text":"<p>\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\uff1a\u200b\u6ee1\u8db3\u200b\u5206\u5e03\u5f0f\u7cfb\u7edf\u200b\u6216\u200b\u96c6\u7fa4\u200b\u6a21\u5f0f\u200b\u4e0b\u591a\u200b\u8fdb\u7a0b\u200b\u53ef\u89c1\u200b\u5e76\u4e14\u200b\u4e92\u65a5\u200b\u7684\u200b\u9501\u200b</p> <p>\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5355\u4f53\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u4f7f\u7528\u200b Synchronized \u200b\u6216\u8005\u200b ReentrantLock \u200b\u7b49\u200b\u672c\u5730\u200b\u9501\u200b\u5c31\u200b\u80fd\u200b\u4fdd\u8bc1\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u5206\u5e03\u5f0f\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u56e0\u4e3a\u200bsynchronized\u200b\u662f\u200b\u672c\u5730\u200b\u9501\u200b\uff0c\u200b\u53ea\u80fd\u200b\u63d0\u4f9b\u200b\u7ebf\u7a0b\u200b\u7ea7\u522b\u200b\u7684\u200b\u540c\u6b65\u200b\uff0c\u200b\u6bcf\u4e2a\u200bJVM\u200b\u4e2d\u200b\u90fd\u200b\u6709\u200b\u4e00\u628a\u200bsynchronized\u200b\u9501\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u8de8\u200b JVM \u200b\u8fdb\u884c\u200b\u4e0a\u9501\u200b\uff0c\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8fdb\u5165\u200b\u88ab\u200b synchronized \u200b\u5173\u952e\u5b57\u200b\u4fee\u9970\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6216\u200b\u4ee3\u7801\u200b\u5757\u200b\u65f6\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5185\u7f6e\u200b\u9501\u200b\uff08\u200b\u4e5f\u200b\u79f0\u4e3a\u200b\u76d1\u89c6\u5668\u200b\u9501\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u8be5\u9501\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5360\u7528\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u6267\u884c\u200b\u4ee3\u7801\u200b\uff1b\u200b\u5426\u5219\u200b\uff0c\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5c06\u200b\u8fdb\u5165\u200b\u963b\u585e\u72b6\u6001\u200b\uff0c\u200b\u76f4\u5230\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\u4e3a\u6b62\u200b\u3002\u200b\u800c\u200b\u5982\u679c\u200b\u73b0\u5728\u200b\u5b58\u5728\u200b\u4e24\u4e2a\u200b\u8282\u70b9\u200b\uff0c\u200b\u5373\u200b\u4e24\u53f0\u200b JVM\uff0c\u200b\u90a3\u4e48\u200bsynchronized \u200b\u9501\u4f1a\u200b\u5931\u6548\u200b</p> <p></p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#1","title":"1. \u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u7279\u70b9","text":"<ul> <li>\u200b\u591a\u7ebf\u7a0b\u200b\u53ef\u89c1\u200b\u3002</li> <li>\u200b\u4e92\u65a5\u200b\u3002 \u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u5fc5\u987b\u200b\u80fd\u591f\u200b\u786e\u4fdd\u200b\u5728\u200b\u4efb\u4f55\u65f6\u523b\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u80fd\u591f\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0c\u200b\u5176\u4ed6\u200b\u8282\u70b9\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b\u3002</li> <li>\u200b\u9ad8\u200b\u53ef\u7528\u200b\u3002 \u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u5e94\u8be5\u200b\u5177\u5907\u200b\u9ad8\u53ef\u7528\u6027\u200b\uff0c\u200b\u5373\u4f7f\u200b\u5728\u200b\u7f51\u7edc\u200b\u5206\u533a\u200b\u6216\u200b\u8282\u70b9\u200b\u6545\u969c\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4ecd\u7136\u200b\u80fd\u591f\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002\uff08\u200b\u5bb9\u9519\u6027\u200b\uff09\u200b\u5f53\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u8282\u70b9\u200b\u53d1\u751f\u200b\u6545\u969c\u200b\u6216\u200b\u5b95\u673a\u200b\u65f6\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u81ea\u52a8\u200b\u91ca\u653e\u200b\u8be5\u9501\u200b\uff0c\u200b\u4ee5\u200b\u786e\u4fdd\u200b\u5176\u4ed6\u200b\u8282\u70b9\u200b\u80fd\u591f\u200b\u7ee7\u7eed\u200b\u83b7\u53d6\u200b\u9501\u200b\u3002</li> <li>\u200b\u9ad8\u6027\u80fd\u200b\u3002 \u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u9700\u8981\u200b\u5177\u5907\u200b\u826f\u597d\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u5c3d\u53ef\u80fd\u51cf\u5c11\u200b\u5bf9\u200b\u5171\u4eab\u8d44\u6e90\u200b\u7684\u200b\u8bbf\u95ee\u200b\u7b49\u5f85\u65f6\u95f4\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u51cf\u5c11\u200b\u9501\u200b\u7ade\u4e89\u200b\u5e26\u6765\u200b\u7684\u200b\u5f00\u9500\u200b\u3002</li> <li>\u200b\u5b89\u5168\u6027\u200b\u3002\uff08\u200b\u53ef\u91cd\u200b\u5165\u6027\u200b\uff09 \u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u8282\u70b9\u200b\u5df2\u7ecf\u200b\u83b7\u5f97\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u8bf7\u6c42\u200b\u83b7\u53d6\u200b\u8be5\u9501\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u9020\u6210\u200b\u6b7b\u9501\u200b\u3002\uff08\u200b\u9501\u200b\u8d85\u65f6\u200b\u673a\u5236\u200b\uff09\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u67d0\u4e2a\u200b\u8282\u70b9\u200b\u56e0\u200b\u6545\u969c\u200b\u6216\u200b\u5176\u4ed6\u200b\u539f\u56e0\u200b\u65e0\u9650\u671f\u200b\u6301\u6709\u200b\u9501\u200b\u800c\u200b\u5f71\u54cd\u200b\u7cfb\u7edf\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u901a\u5e38\u200b\u5e94\u8be5\u200b\u8bbe\u7f6e\u200b\u8d85\u65f6\u200b\u673a\u5236\u200b\uff0c\u200b\u786e\u4fdd\u200b\u9501\u200b\u7684\u200b\u81ea\u52a8\u200b\u91ca\u653e\u200b\u3002</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#2-redis","title":"2. \u200b\u57fa\u4e8e\u200bRedis\u200b\u5b9e\u73b0\u200b\u5206\u5e03\u5f0f\u200b\u9501","text":"<p>\u200b\u4f7f\u7528\u200b setnx \u200b\u6307\u4ee4\u200b</p> <p>setnx\u200b\u6307\u4ee4\u200b\u7684\u200b\u7279\u70b9\u200b\uff1asetnx\u200b\u53ea\u80fd\u200b\u8bbe\u7f6e\u200bkey\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u503c\u200b\u4e0d\u200b\u5b58\u5728\u200b\u8bbe\u7f6e\u200b\u6210\u529f\u200b\uff0c\u200b\u8fd4\u56de\u200b 1 \uff1b\u200b\u503c\u200b\u5b58\u5728\u200b\u8bbe\u7f6e\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fd4\u56de\u200b 0</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#_3","title":"\u83b7\u53d6\u200b\u9501","text":"<ul> <li>\u200b\u65b9\u5f0f\u200b\u4e00\u200b:</li> </ul> Bash<pre><code># \u200b\u6dfb\u52a0\u200b\u9501\u200b\nsetnx [key] [value]\n# \u200b\u4e3a\u9501\u200b\u8bbe\u7f6e\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\uff0c\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\uff0c\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\nexpire [key] [time]\n</code></pre> <ul> <li>\u200b\u65b9\u5f0f\u200b\u4e8c\u200b: (\u200b\u4e24\u4e2a\u200b\u6307\u4ee4\u200b\u53d8\u6210\u200b\u4e00\u4e2a\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ece\u800c\u200b\u4fdd\u969c\u200b\u6307\u4ee4\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b)</li> </ul> Bash<pre><code># \u200b\u6dfb\u52a0\u200b\u9501\u200b\nset [key] [value] ex [time] nx\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#_4","title":"\u91ca\u653e\u200b\u9501","text":"Bash<pre><code># \u200b\u91ca\u653e\u200b\u9501\u200b\uff08\u200b\u9664\u4e86\u200b\u4f7f\u7528\u200bdel\u200b\u624b\u52a8\u200b\u91ca\u653e\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\uff09\ndel [key]\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#java","title":"Java \u200b\u4ee3\u7801","text":"Java<pre><code>public class SimpleRedisLock implements Lock {\n\n    /**\n     * RedisTemplate\n     */\n    private StringRedisTemplate stringRedisTemplate;\n\n    /**\n     * \u200b\u9501\u200b\u7684\u200b\u540d\u79f0\u200b\n     */\n    private String name;\n\n    public SimpleRedisLock(StringRedisTemplate stringRedisTemplate, String name) {\n        this.stringRedisTemplate = stringRedisTemplate;\n        this.name = name;\n    }\n\n\n    /**\n     * \u200b\u83b7\u53d6\u200b\u9501\u200b\n     *\n     * @param timeoutSec \u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n     * @return\n     */\n    @Override\n    public boolean tryLock(long timeoutSec) {\n        String id = Thread.currentThread().getId() + \"\";\n        // SET lock:name id EX timeoutSec NX\n        Boolean result = stringRedisTemplate.opsForValue()\n                .setIfAbsent(\"lock:\" + name, id, timeoutSec, TimeUnit.SECONDS);\n        return Boolean.TRUE.equals(result);\n    }\n\n    /**\n     * \u200b\u91ca\u653e\u200b\u9501\u200b\n     */\n    @Override\n    public void unlock() {\n        stringRedisTemplate.delete(\"lock:\" + name);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#3","title":"3. \u200b\u8d85\u5356\u200b\u95ee\u9898\u200b\u4f18\u5316","text":"","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#1_1","title":"\u4f18\u5316\u200b 1","text":"<p>\u200b\u95ee\u9898\u200b\u80cc\u666f\u200b\uff1a\u200b\u5f53\u200b\u7ebf\u7a0b\u200b1\u200b\u83b7\u53d6\u200b\u9501\u540e\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4e1a\u52a1\u200b\u963b\u585e\u200b\uff0c\u200b\u7ebf\u7a0b\u200b1\u200b\u7684\u200b\u9501\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u7ebf\u7a0b\u200b2\u200b\u8d81\u865a\u800c\u5165\u200b\u62ff\u5230\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u7136\u540e\u200b\u6b64\u65f6\u200b\u7ebf\u7a0b\u200b1\u200b\u4e1a\u52a1\u200b\u5b8c\u6210\u200b\u4e86\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u7ebf\u7a0b\u200b2\u200b\u521a\u521a\u200b\u83b7\u53d6\u200b\u7684\u200b\u9501\u200b\u7ed9\u200b\u91ca\u653e\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u7ebf\u7a0b\u200b3\u200b\u53c8\u200b\u8d81\u865a\u800c\u5165\u200b\u62ff\u5230\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u5bfc\u81f4\u200b\u53c8\u200b\u51fa\u73b0\u200b\u4e86\u200b\u8d85\u5356\u200b\u95ee\u9898\u200b\uff01</p> <p></p> <p>\u200b\u89e3\u51b3\u529e\u6cd5\u200b\uff1a\u200b\u6211\u4eec\u200b\u4e3a\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6807\u8bc6\u200b\uff0c\u200b\u5728\u200b\u91ca\u653e\u200b\u9501\u65f6\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u9501\u200b\u662f\u5426\u662f\u200b\u81ea\u5df1\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u662f\u200b\u81ea\u5df1\u200b\u7684\u200b\u5c31\u200b\u76f4\u63a5\u200b\u91ca\u653e\u200b\uff0c\u200b\u4e0d\u662f\u200b\u81ea\u5df1\u200b\u7684\u200b\u5c31\u200b\u4e0d\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u4ece\u800c\u200b\u89e3\u51b3\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u540c\u65f6\u200b\u83b7\u5f97\u200b\u9501\u200b\u7684\u200b\u60c5\u51b5\u200b\u5bfc\u81f4\u200b\u51fa\u73b0\u200b\u8d85\u5356\u200b</p> <p></p> <p>\u200b\u5b9e\u73b0\u200b\u7ec6\u8282\u200b:</p> Java<pre><code>public class SimpleRedisLock implements Lock {\n\n    /**\n     * RedisTemplate\n     */\n    private StringRedisTemplate stringRedisTemplate;\n\n    /**\n     * \u200b\u9501\u200b\u7684\u200b\u540d\u79f0\u200b\n     */\n    private String name;\n    /**\n     * key\u200b\u524d\u7f00\u200b\n     */\n    public static final String KEY_PREFIX = \"lock:\";\n    /**\n     * ID\u200b\u524d\u7f00\u200b\n     */\n    public static final String ID_PREFIX = UUID.randomUUID().toString(true) + \"-\";\n\n    public SimpleRedisLock(StringRedisTemplate stringRedisTemplate, String name) {\n        this.stringRedisTemplate = stringRedisTemplate;\n        this.name = name;\n    }\n\n\n    /**\n     * \u200b\u83b7\u53d6\u200b\u9501\u200b\n     *\n     * @param timeoutSec \u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n     * @return\n     */\n    @Override\n    public boolean tryLock(long timeoutSec) {\n        String threadId = ID_PREFIX + Thread.currentThread().getId() + \"\";\n        // SET lock:name id EX timeoutSec NX\n        Boolean result = stringRedisTemplate.opsForValue()\n                .setIfAbsent(KEY_PREFIX + name, threadId, timeoutSec, TimeUnit.SECONDS);\n        return Boolean.TRUE.equals(result);\n    }\n\n    /**\n     * \u200b\u91ca\u653e\u200b\u9501\u200b\n     */\n    @Override\n    public void unlock() {\n        // \u200b\u5224\u65ad\u200b \u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6807\u8bc6\u200b \u200b\u662f\u5426\u200b\u4e0e\u200b \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u4e00\u81f4\u200b\n        String currentThreadFlag = ID_PREFIX + Thread.currentThread().getId();\n        String redisThreadFlag = stringRedisTemplate.opsForValue().get(KEY_PREFIX + name);\n        if (currentThreadFlag != null || currentThreadFlag.equals(redisThreadFlag)) {\n            // \u200b\u4e00\u81f4\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5f53\u524d\u200b\u7684\u200b\u9501\u200b\u5c31\u662f\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u91ca\u653e\u200b\n            stringRedisTemplate.delete(KEY_PREFIX + name);\n        }\n        // \u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u91ca\u653e\u200b\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#2","title":"\u4f18\u5316\u200b 2","text":"<p>\u200b\u95ee\u9898\u200b\u80cc\u666f\u200b\uff1a\u200b\u5f53\u200b\u7ebf\u7a0b\u200b1\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u6267\u884c\u200b\u5b8c\u200b\u4e1a\u52a1\u200b\u7136\u540e\u200b\u5e76\u4e14\u200b\u5224\u65ad\u200b\u5b8c\u200b\u5f53\u524d\u200b\u9501\u200b\u662f\u200b\u81ea\u5df1\u200b\u7684\u200b\u9501\u200b\u65f6\u200b\uff0c\u200b\u4f46\u200b\u5c31\u200b\u5728\u200b\u6b64\u65f6\u200b\u53d1\u751f\u200b\u4e86\u200b\u963b\u585e\u200b(\u200b\u53d1\u751f\u200b\u4e86\u200b JVM \u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u673a\u5236\u200b)\uff0c\u200b\u7ed3\u679c\u200b\u9501\u200b\u88ab\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\u4e86\u200b\uff0c\u200b\u7ebf\u7a0b\u200b2\u200b\u7acb\u9a6c\u200b\u5c31\u200b\u8d81\u865a\u800c\u5165\u200b\u4e86\u200b\uff0c\u200b\u83b7\u5f97\u200b\u9501\u200b\u6267\u884c\u200b\u4e1a\u52a1\u200b\uff0c\u200b\u4f46\u200b\u5c31\u200b\u5728\u200b\u6b64\u65f6\u200b\u7ebf\u7a0b\u200b1\u200b\u963b\u585e\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5df2\u7ecf\u200b\u5224\u65ad\u200b\u8fc7\u9501\u200b\uff0c\u200b\u5df2\u7ecf\u200b\u786e\u5b9a\u200b\u9501\u200b\u662f\u200b\u81ea\u5df1\u200b\u7684\u200b\u9501\u200b\u4e86\u200b\uff0c\u200b\u4e8e\u662f\u200b\u76f4\u63a5\u200b\u5c31\u200b\u5220\u9664\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u7ed3\u679c\u200b\u5220\u200b\u7684\u200b\u662f\u200b\u7ebf\u7a0b\u200b2\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u53c8\u200b\u5bfc\u81f4\u200b\u7ebf\u7a0b\u200b3\u200b\u8d81\u865a\u800c\u5165\u200b\u4e86\u200b\uff0c\u200b\u4ece\u800c\u200b\u7ee7\u7eed\u200b\u53d1\u751f\u200b\u8d85\u5356\u200b\u95ee\u9898\u200b</p> <p></p> <p>\u200b\u89e3\u51b3\u529e\u6cd5\u200b\uff1a\u200b\u4f7f\u7528\u200bLua\u200b\u811a\u672c\u200b\u4fdd\u969c\u200b\u00a0\u200b\u5224\u65ad\u200b\u9501\u200b\u00a0\u200b\u548c\u200b\u00a0\u200b\u91ca\u653e\u200b\u9501\u200b\u00a0\u200b\u8fd9\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b</p> <p>Lua \u200b\u811a\u672c\u200b\u5982\u4f55\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b</p> <p>\u200b\u5728\u200bRedis\u200b\u4e2d\u200b\uff0cLua\u200b\u811a\u672c\u200b\u80fd\u591f\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\u7684\u200b\u4e3b\u8981\u200b\u539f\u56e0\u200b\u8fd8\u662f\u200bRedis\u200b\u91c7\u7528\u200b\u4e86\u200b\u5355\u7ebf\u7a0b\u200b\u6267\u884c\u200b\u6a21\u578b\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5f53\u200bRedis\u200b\u6267\u884c\u200bLua\u200b\u811a\u672c\u200b\u65f6\u200b\uff0cRedis\u200b\u4f1a\u200b\u628a\u200bLua\u200b\u811a\u672c\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u6574\u4f53\u200b\u5e76\u200b\u628a\u200b\u5b83\u200b\u5f53\u4f5c\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u52a0\u5165\u200b\u5230\u200b\u4e00\u4e2a\u200b\u961f\u5217\u200b\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u5355\u7ebf\u7a0b\u200b\u6309\u7167\u200b\u961f\u5217\u200b\u7684\u200b\u987a\u5e8f\u200b\u4f9d\u6b21\u200b\u6267\u884c\u200b\u8fd9\u4e9b\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5728\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200bLua\u200b\u811a\u672c\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5176\u4ed6\u200b\u547d\u4ee4\u200b\u6216\u200b\u8bf7\u6c42\u200b\u6253\u65ad\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\u90fd\u200b\u662f\u200b\u539f\u5b50\u200b\u6027\u200b\u7684\u200b\u3002</p> <p>\u200b\u6ce8\u610f\u200b\uff1a\u200b\u867d\u7136\u200bRedis\u200b\u5728\u200b\u5355\u4e2a\u200bLua\u200b\u811a\u672c\u200b\u7684\u200b\u6267\u884c\u200b\u671f\u95f4\u200b\u4f1a\u200b\u6682\u505c\u200b\u5176\u4ed6\u200b\u811a\u672c\u200b\u548c\u200bRedis\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4ee5\u200b\u786e\u4fdd\u200b\u811a\u672c\u200b\u7684\u200b\u6267\u884c\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200bLua\u200b\u811a\u672c\u200b\u672c\u8eab\u200b\u51fa\u9519\u200b\uff0c\u200b\u90a3\u4e48\u200b\u65e0\u6cd5\u200b\u5b8c\u5168\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200bLua\u200b\u811a\u672c\u200b\u4e2d\u200b\u7684\u200bRedis\u200b\u6307\u4ee4\u200b\u51fa\u9519\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u751f\u200b\u56de\u6eda\u200b\u4ee5\u200b\u786e\u4fdd\u200b\u539f\u5b50\u200b\u6027\u200b\uff0c\u200b\u4f46\u200bLua\u200b\u811a\u672c\u200b\u672c\u8eab\u200b\u51fa\u9519\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u4fdd\u969c\u200b\u539f\u5b50\u200b\u6027\u200b</p> <p>\u200b\u6df1\u5165\u200b\u9605\u8bfb\u200b\uff1a\u200b\u963f\u91cc\u200b P7\u200b\u4e8c\u9762\u200b\uff1aRedis \u200b\u6267\u884c\u200b Lua\uff0c\u200b\u80fd\u200b\u4fdd\u8bc1\u200b\u539f\u5b50\u200b\u6027\u200b\u5417\u200b\uff1f-\u200b\u817e\u8baf\u200b\u4e91\u200b\u5f00\u53d1\u8005\u200b\u793e\u533a\u200b-\u200b\u817e\u8baf\u200b\u4e91\u200b</p> <p>Lua \u200b\u4ee3\u7801\u200b:</p> Lua<pre><code>-- \u200b\u6bd4\u8f83\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u6807\u8bc6\u200b\u4e0e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6807\u8bc6\u200b\u662f\u5426\u200b\u4e00\u81f4\u200b\nif (redis.call('get', KEYS[1]) == ARGV[1]) then\n    -- \u200b\u4e00\u81f4\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5220\u9664\u200b\n    return redis.call('del', KEYS[1])\nend\n-- \u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8fd4\u56de\u200b0\nreturn 0\n</code></pre> <p>Java \u200b\u4ee3\u7801\u200b:</p> Java<pre><code>public class SimpleRedisLock implements Lock {\n\n    /**\n     * RedisTemplate\n     */\n    private StringRedisTemplate stringRedisTemplate;\n\n    /**\n     * \u200b\u9501\u200b\u7684\u200b\u540d\u79f0\u200b\n     */\n    private String name;\n    /**\n     * key\u200b\u524d\u7f00\u200b\n     */\n    private static final String KEY_PREFIX = \"lock:\";\n    /**\n     * ID\u200b\u524d\u7f00\u200b\n     */\n    private static final String ID_PREFIX = UUID.randomUUID().toString(true) + \"-\";\n\n    public SimpleRedisLock(StringRedisTemplate stringRedisTemplate, String name) {\n        this.stringRedisTemplate = stringRedisTemplate;\n        this.name = name;\n    }\n\n\n    /**\n     * \u200b\u83b7\u53d6\u200b\u9501\u200b\n     *\n     * @param timeoutSec \u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\n     * @return\n     */\n    @Override\n    public boolean tryLock(long timeoutSec) {\n        String threadId = ID_PREFIX + Thread.currentThread().getId() + \"\";\n        // SET lock:name id EX timeoutSec NX\n        Boolean result = stringRedisTemplate.opsForValue()\n                .setIfAbsent(KEY_PREFIX + name, threadId, timeoutSec, TimeUnit.SECONDS);\n        return Boolean.TRUE.equals(result);\n    }\n\n    /**\n     * \u200b\u52a0\u8f7d\u200bLua\u200b\u811a\u672c\u200b\n     */\n    private static final DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;\n\n    static {\n        UNLOCK_SCRIPT = new DefaultRedisScript&lt;&gt;();\n        UNLOCK_SCRIPT.setLocation(new ClassPathResource(\"lua/unlock.lua\"));\n        UNLOCK_SCRIPT.setResultType(Long.class);\n    }\n\n    /**\n     * \u200b\u91ca\u653e\u200b\u9501\u200b\n     */\n    @Override\n    public void unlock() {\n        // \u200b\u6267\u884c\u200blua\u200b\u811a\u672c\u200b\n        stringRedisTemplate.execute(\n                UNLOCK_SCRIPT,\n                Collections.singletonList(KEY_PREFIX + name),\n                ID_PREFIX + Thread.currentThread().getId()\n        );\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#redisson","title":"Redisson","text":"<p>\u200b\u7ecf\u8fc7\u200b\u4f18\u5316\u200b1\u200b\u548c\u200b\u4f18\u5316\u200b2\uff0c\u200b\u6211\u4eec\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u5df2\u7ecf\u200b\u8fbe\u5230\u200b\u751f\u4ea7\u200b\u53ef\u7528\u200b\u7ea7\u522b\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd8\u200b\u4e0d\u591f\u200b\u5b8c\u5584\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a</p> <ol> <li>\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u4e0d\u53ef\u200b\u91cd\u200b\u5165\u200b\uff1a\u200b\u4e0d\u53ef\u200b\u91cd\u5165\u200b\u662f\u200b\u6307\u200b\u540c\u4e00\u200b\u7ebf\u7a0b\u200b\u4e0d\u80fd\u200b\u91cd\u590d\u200b\u83b7\u53d6\u200b\u540c\u4e00\u200b\u628a\u200b\u9501\u200b\u3002\u200b\u6bd4\u5982\u200b\uff0c\u200b\u65b9\u6cd5\u200bA\u200b\u4e2d\u200b\u8c03\u7528\u200b\u65b9\u6cd5\u200bB\uff0c\u200b\u65b9\u6cd5\u200bA\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\uff0c\u200b\u65b9\u6cd5\u200bB\u200b\u540c\u6837\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\uff0c\u200b\u7ebf\u7a0b\u200b1\u200b\u8fdb\u5165\u200b\u65b9\u6cd5\u200bA\u200b\u83b7\u53d6\u200b\u4e86\u200b\u4e00\u6b21\u200b\u9501\u200b\uff0c\u200b\u8fdb\u5165\u200b\u65b9\u6cd5\u200bB\u200b\u53c8\u200b\u83b7\u53d6\u200b\u4e00\u6b21\u200b\u9501\u200b\uff0c\u200b\u7531\u4e8e\u200b\u9501\u200b\u4e0d\u53ef\u200b\u91cd\u200b\u5165\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6b7b\u9501\u200b</li> <li>\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u4e0d\u53ef\u200b\u91cd\u8bd5\u200b\uff1a\u200b\u83b7\u53d6\u200b\u9501\u200b\u53ea\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\u5c31\u200b\u8fd4\u56de\u200bfalse\uff0c\u200b\u6ca1\u6709\u200b\u91cd\u8bd5\u200b\u673a\u5236\u200b\uff0c\u200b\u8fd9\u4f1a\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7ebf\u7a0b\u200b1\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u7136\u540e\u200b\u8981\u200b\u5c06\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u6570\u636e\u5e93\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f53\u524d\u200b\u7684\u200b\u9501\u200b\u88ab\u200b\u7ebf\u7a0b\u200b2\u200b\u5360\u7528\u200b\u4e86\u200b\uff0c\u200b\u7ebf\u7a0b\u200b1\u200b\u76f4\u63a5\u200b\u5c31\u200b\u7ed3\u675f\u200b\u4e86\u200b\u800c\u200b\u4e0d\u200b\u53bb\u200b\u91cd\u8bd5\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u53d1\u751f\u200b\u4e86\u200b\u4e22\u5931\u200b</li> <li> <p>\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\uff1a\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\u673a\u200b\u673a\u5236\u200b\u867d\u7136\u200b\u4e00\u5b9a\u200b\u7a0b\u5ea6\u200b\u907f\u514d\u200b\u4e86\u200b\u6b7b\u9501\u200b\u53d1\u751f\u200b\u7684\u200b\u6982\u7387\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u4e1a\u52a1\u200b\u6267\u884c\u200b\u8017\u65f6\u200b\u8fc7\u957f\u200b\uff0c\u200b\u671f\u95f4\u200b\u9501\u200b\u5c31\u200b\u91ca\u653e\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5b58\u5728\u200b\u5b89\u5168\u9690\u60a3\u200b\u3002\u200b\u9501\u200b\u7684\u200b\u6709\u6548\u671f\u200b\u8fc7\u200b\u77ed\u200b\uff0c\u200b\u5bb9\u6613\u200b\u51fa\u73b0\u200b\u4e1a\u52a1\u200b\u6ca1\u200b\u6267\u884c\u200b\u5b8c\u200b\u5c31\u200b\u88ab\u200b\u91ca\u653e\u200b\uff0c\u200b\u9501\u200b\u7684\u200b\u6709\u6548\u671f\u200b\u8fc7\u957f\u200b\uff0c\u200b\u5bb9\u6613\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5927\u200b\u96be\u9898\u200b\uff01</p> <p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u8f83\u200b\u77ed\u200b\u7684\u200b\u6709\u6548\u671f\u200b\uff0c\u200b\u4f46\u662f\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u5fc3\u8df3\u200b\u673a\u5236\u200b\u548c\u200b\u81ea\u52a8\u200b\u7eed\u671f\u200b\uff1a\u200b\u5728\u200b\u9501\u200b\u88ab\u200b\u83b7\u53d6\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5fc3\u8df3\u200b\u673a\u5236\u200b\u5e76\u200b\u81ea\u52a8\u200b\u7eed\u671f\u200b\u9501\u200b\u7684\u200b\u6301\u6709\u200b\u65f6\u95f4\u200b\u3002\u200b\u901a\u8fc7\u200b\u5b9a\u671f\u200b\u53d1\u9001\u200b\u5fc3\u8df3\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u663e\u793a\u200b\u5730\u200b\u544a\u77e5\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u6216\u200b\u7cfb\u7edf\u200b\u9501\u200b\u8fd8\u200b\u5728\u200b\u4f7f\u7528\u200b\u4e2d\u200b\uff0c\u200b\u540c\u65f6\u200b\u66f4\u65b0\u200b\u9501\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u3002\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u9884\u8bbe\u200b\u7684\u200b\u6709\u6548\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u9501\u200b\u3002</p> </li> <li> <p>\u200b\u4e3b\u4ece\u200b\u4e00\u81f4\u6027\u200b\u95ee\u9898\u200b\uff1a\u200b\u5982\u679c\u200bRedis\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e3b\u4ece\u200b\u96c6\u7fa4\u200b\uff0c\u200b\u4e3b\u4ece\u200b\u540c\u6b65\u200b\u5b58\u5728\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u7ebf\u7a0b\u200b1\u200b\u83b7\u53d6\u200b\u4e86\u200b\u9501\u200b</p> </li> </ol> <p>\u200b\u800c\u200b\u4e0a\u8ff0\u200b\u8fd9\u4e9b\u200b\u95ee\u9898\u200b\uff0cRedisson \u200b\u90fd\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5bf9\u200b Redisson \u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u548c\u200b\u9501\u200b\u91cd\u8bd5\u200b\u505a\u200b\u539f\u7406\u200b\u8bb2\u89e3\u200b</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#redisson_1","title":"Redisson\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501","text":"<p>Redisson\u200b\u901a\u8fc7\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u8ba1\u6570\u5668\u200b(\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b hash \u200b\u7ed3\u6784\u200b) \u200b\u6765\u200b\u5b9e\u73b0\u200b\u9501\u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u200b\u7279\u6027\u200b\u3002</p> <ul> <li>\u200b\u5f53\u200b\u540c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u7b2c\u4e00\u6b21\u200b\u83b7\u53d6\u200b\u9501\u65f6\u200b\uff0cRedis\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b <code>threadId</code> \uff0c\u200b\u5e76\u200b\u5c06\u200b\u9501\u200b\u7684\u200b\u6301\u6709\u200b\u6b21\u6570\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b1\u3002</li> <li>\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u518d\u6b21\u200b\u8bf7\u6c42\u200b\u9501\u200b\uff08\u200b\u5373\u53ef\u200b\u91cd\u200b\u5165\u200b\u64cd\u4f5c\u200b\uff09\uff0cRedisson\u200b\u4f1a\u200b\u68c0\u6d4b\u200b\u5230\u200b\u5f53\u524d\u200b\u6301\u6709\u200b\u9501\u200b\u7684\u200b <code>threadId</code> \u200b\u4e0e\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u76f8\u540c\u200b\uff0c\u200b\u5219\u200b\u4e0d\u4f1a\u200b\u91cd\u65b0\u200b\u8bbe\u7f6e\u200b\u9501\u200b\uff0c\u200b\u800c\u662f\u200b\u7b80\u5355\u200b\u5730\u200b\u589e\u52a0\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u518d\u6b21\u200b\u6301\u6709\u200b\u4e86\u200b\u9501\u200b\u3002</li> <li>\u200b\u6bcf\u6b21\u200b\u91ca\u653e\u200b\u9501\u65f6\u200b\uff0cRedisson\u200b\u4f1a\u200b\u51cf\u5c11\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b\u8ba1\u6570\u5668\u200b\u51cf\u200b\u4e3a\u200b0\u200b\u65f6\u200b\uff0c\u200b\u9501\u200b\u624d\u200b\u4f1a\u200b\u771f\u6b63\u200b\u91ca\u653e\u200b\u3002</li> </ul> <p></p> <p>Redisson\u200b\u5185\u90e8\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u6267\u884c\u200b <code>del</code> \u200b\u547d\u4ee4\u200b\u5c06\u200b\u9501\u200b\u7ed9\u200b\u5220\u9664\u200b\uff0c\u200b\u800c\u662f\u200b\u5c06\u200b\u9501\u200b\u4ee5\u200b <code>hash</code> \u200b\u6570\u636e\u7ed3\u6784\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5b58\u50a8\u200b\u5728\u200bRedis\u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u90fd\u200b\u5c06\u200b <code>value</code> \u200b\u7684\u200b\u503c\u200b+1\uff0c\u200b\u6bcf\u6b21\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u90fd\u200b\u5c06\u200bvalue\u200b\u7684\u200b\u503c\u200b-1\uff0c\u200b\u53ea\u6709\u200b\u9501\u200b\u7684\u200bvalue\u200b\u503c\u5f52\u200b0\u200b\u65f6\u624d\u200b\u4f1a\u200b\u771f\u6b63\u200b\u7684\u200b\u91ca\u653e\u200b\u9501\u200b\uff0c\u200b\u4ece\u800c\u200b\u786e\u4fdd\u200b\u9501\u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u6027\u200b</p> <p>\u200b\u83b7\u53d6\u200b\u9501\u200b\u5bf9\u5e94\u200b\u7684\u200b Lua \u200b\u811a\u672c\u200b\u5982\u4e0b\u200b\uff1a</p> <p>\u200b\u6e90\u7801\u200b\u4f4d\u7f6e\u200b\uff1a <code>org.redisson.RedissonLock#tryLockInnerAsync</code></p> Lua<pre><code> -- \u200b\u5927\u200b key \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u7ebf\u7a0b\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b\nif ((redis.call('exists', KEYS[1]) == 0)\n-- \u200b\u5927\u200b key \u200b\u5b58\u5728\u200b\uff0c\u200b\u4f46\u662f\u200bhash \u200b\u7684\u200b key(\u200b\u7ebf\u7a0b\u200b id)\u200b\u76f8\u540c\u200b\uff0c\u200b\u4ee3\u8868\u200b\u9501\u200b\u91cd\u5165\u200b\n        or (redis.call('hexists', KEYS[1], ARGV[2]) == 1)) then \n    -- value + 1\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\n    redis.call('hincrby', KEYS[1], ARGV[2], 1); \n    -- p \u200b\u5f00\u5934\u200b\u8868\u793a\u200b\u4ee5\u200b\u6beb\u79d2\u200b\u4e3a\u200b\u5355\u4f4d\u200b\n    redis.call('pexpire', KEYS[1], ARGV[1]);\n    return nil;\nend; \n-- \u200b\u83b7\u53d6\u200b\u5931\u8d25\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5360\u6709\u200b\u9501\u200b\uff0c\u200b\u8fd4\u56de\u200b\u9501\u200b\u7684\u200b\u5269\u4f59\u200b\u6709\u6548\u671f\u200b(\u200b\u6beb\u79d2\u200b)\nreturn redis.call('pttl', KEYS[1]);\n</code></pre> <p>\u200b\u91ca\u653e\u200b\u9501\u200b\u5bf9\u5e94\u200b\u7684\u200b Lua \u200b\u811a\u672c\u200b\u5982\u4e0b\u200b\uff1a</p> <p>\u200b\u6e90\u7801\u200b\u4f4d\u7f6e\u200b:</p> <p><code>org.redisson.RedissonLock#unlockInnerAsync</code></p> Java<pre><code>protected RFuture&lt;Boolean&gt; unlockInnerAsync(long threadId, String requestId, int timeout) {\n    return evalWriteSyncedNoRetryAsync(getRawName(), LongCodec.INSTANCE, RedisCommands.EVAL_BOOLEAN,\n                          \"local val = redis.call('get', KEYS[3]); \" +\n                                \"if val ~= false then \" +\n                                    \"return tonumber(val);\" +\n                                \"end; \" +\n\n                                \"if (redis.call('hexists', KEYS[1], ARGV[3]) == 0) then \" +\n                                    \"return nil;\" +\n                                \"end; \" +\n                                \"local counter = redis.call('hincrby', KEYS[1], ARGV[3], -1); \" +\n                                \"if (counter &gt; 0) then \" +\n                                    \"redis.call('pexpire', KEYS[1], ARGV[2]); \" +\n                                    \"redis.call('set', KEYS[3], 0, 'px', ARGV[5]); \" +\n                                    \"return 0; \" +\n                                \"else \" +\n                                    \"redis.call('del', KEYS[1]); \" +\n                                    \"redis.call(ARGV[4], KEYS[2], ARGV[1]); \" +\n                                    \"redis.call('set', KEYS[3], 1, 'px', ARGV[5]); \" +\n                                    \"return 1; \" +\n                                \"end; \",\n                            Arrays.asList(getRawName(), getChannelName(), getUnlockLatchName(requestId)),\n                            LockPubSub.UNLOCK_MESSAGE, internalLockLeaseTime,\n                            getLockName(threadId), getSubscribeService().getPublishCommand(), timeout);\n}\n</code></pre> Lua<pre><code>-- \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u6807\u8bb0\u200b key\uff08KEYS[3]\uff09\uff0c\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u5b58\u5728\u200b\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u8be5\u503c\u200b\uff0c\u200b\u9632\u6b62\u200b\u91cd\u590d\u200b\u91ca\u653e\u200b\u9501\u200b\nlocal val = redis.call('get', KEYS[3])  \nif val ~= false then\n    return tonumber(val)  -- \u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u6807\u8bb0\u200b\u5df2\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u6807\u8bb0\u200b\u503c\u200b\uff080 \u200b\u6216\u200b 1\uff09\nend\n\n-- \u200b\u68c0\u67e5\u200b\u9501\u200b\u7684\u200b\u54c8\u5e0c\u200b\u8868\u200b (KEYS[1]) \u200b\u662f\u5426\u200b\u5305\u542b\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b ID\uff08ARGV[3]\uff09\nif redis.call('hexists', KEYS[1], ARGV[3]) == 0 then  \n    return nil  -- \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6ca1\u6709\u200b\u6301\u6709\u200b\u8be5\u9501\u200b\uff0c\u200b\u8fd4\u56de\u200b nil\uff0c\u200b\u8868\u793a\u200b\u65e0\u6cd5\u200b\u91ca\u653e\u200b\u9501\u200b\nend\n\n-- \u200b\u51cf\u5c11\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u7684\u200b\u9501\u200b\u6b21\u6570\u200b\uff08\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u8c03\u7528\u200b -1\uff09\nlocal counter = redis.call('hincrby', KEYS[1], ARGV[3], -1)  \nif counter &gt; 0 then  \n    -- \u200b\u8bf4\u660e\u200b\u9501\u200b\u8fd8\u6709\u200b\u5269\u4f59\u6b21\u6570\u200b\uff08\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u4ecd\u200b\u672a\u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\uff09\n\n    -- \u200b\u91cd\u65b0\u200b\u8bbe\u7f6e\u200b\u9501\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\uff0c\u200b\u786e\u4fdd\u200b\u9501\u200b\u4e0d\u4f1a\u200b\u56e0\u200b\u8d85\u65f6\u200b\u88ab\u200b\u5220\u9664\u200b\n    redis.call('pexpire', KEYS[1], ARGV[2])  \n\n    -- \u200b\u91ca\u653e\u200b\u6807\u8bb0\u200b key \u200b\u8bbe\u200b\u4e3a\u200b 0\uff0c\u200b\u8868\u793a\u200b\u9501\u200b\u4ecd\u7136\u200b\u6709\u6548\u200b\n    redis.call('set', KEYS[3], 0, 'px', ARGV[5])  \n\n    return 0  -- \u200b\u8fd4\u56de\u200b 0\uff0c\u200b\u8868\u793a\u200b\u9501\u200b\u672a\u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\nelse  \n    -- \u200b\u8bf4\u660e\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\u5df2\u200b\u5168\u90e8\u200b\u91ca\u653e\u200b\uff0c\u200b\u9700\u8981\u200b\u5f7b\u5e95\u200b\u5220\u9664\u200b\u9501\u200b\n\n    -- \u200b\u5220\u9664\u200b\u9501\u200b\u7684\u200b\u54c8\u5e0c\u200b\u8868\u200b (KEYS[1])\n    redis.call('del', KEYS[1])  \n\n    -- \u200b\u4f7f\u7528\u200b `ARGV[4]` \u200b\u8fd9\u4e2a\u200b Redis \u200b\u547d\u4ee4\u200b\uff08\u200b\u901a\u5e38\u200b\u662f\u200b `publish`\uff09\uff0c\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u9501\u200b\u5df2\u200b\u91ca\u653e\u200b\n    redis.call(ARGV[4], KEYS[2], ARGV[1])  \n\n    -- \u200b\u91ca\u653e\u200b\u6807\u8bb0\u200b key \u200b\u8bbe\u200b\u4e3a\u200b 1\uff0c\u200b\u8868\u793a\u200b\u9501\u200b\u5df2\u200b\u5b8c\u5168\u200b\u91ca\u653e\u200b\n    redis.call('set', KEYS[3], 1, 'px', ARGV[5])  \n\n    return 1  -- \u200b\u8fd4\u56de\u200b 1\uff0c\u200b\u8868\u793a\u200b\u9501\u200b\u5df2\u200b\u91ca\u653e\u200b\nend\n</code></pre> \u200b\u53d8\u91cf\u200b/\u200b\u53c2\u6570\u200b \u200b\u4f5c\u7528\u200b KEYS[1] \u200b\u5b58\u50a8\u200b\u9501\u200b\u7684\u200b Redis \u200b\u54c8\u5e0c\u200b\u8868\u200b\uff0c\u200b\u7528\u4e8e\u200b\u652f\u6301\u200b\u53ef\u200b\u91cd\u5165\u200b\u9501\u200b\uff0cHSET key threadId count \u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u6301\u6709\u200b\u7684\u200b\u9501\u200b\u6b21\u6570\u200b KEYS[2] \u200b\u53d1\u5e03\u200b\u8ba2\u9605\u200b\u6d88\u606f\u200b\u7684\u200b\u9891\u9053\u200b\uff0c\u200b\u7528\u4e8e\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7b49\u5f85\u200b\u7684\u200b\u7ebf\u7a0b\u200b\uff08\u200b\u4e00\u822c\u200b\u662f\u200b redisson_lock__channel:{\u200b\u9501\u200b\u540d\u79f0\u200b}\uff09 KEYS[3] \u200b\u91ca\u653e\u200b\u9501\u200b\u6807\u8bb0\u200b key\uff0c\u200b\u7528\u4e8e\u200b\u9632\u6b62\u200b\u9501\u200b\u88ab\u200b\u91cd\u590d\u200b\u91ca\u653e\u200b\uff080 \u200b\u4ee3\u8868\u200b\u9501\u200b\u672a\u200b\u91ca\u653e\u200b\uff0c1 \u200b\u4ee3\u8868\u200b\u9501\u200b\u5df2\u200b\u91ca\u653e\u200b\uff09 ARGV[1] \u200b\u9501\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u7528\u4e8e\u200b\u552f\u4e00\u200b\u6807\u8bc6\u200b\u9501\u200b ARGV[2] \u200b\u9501\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\uff08\u200b\u6beb\u79d2\u200b\uff09\uff0c\u200b\u7528\u4e8e\u200b\u91cd\u65b0\u200b\u8bbe\u7f6e\u200b\u9501\u200b\u7684\u200b TTL ARGV[3] \u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b ID\uff0c\u200b\u7528\u4e8e\u200b\u68c0\u67e5\u200b\u8be5\u200b\u7ebf\u7a0b\u200b\u662f\u5426\u200b\u6301\u6709\u200b\u9501\u200b ARGV[4] Redis \u200b\u547d\u4ee4\u200b\uff08\u200b\u5982\u200b publish\uff09\uff0c\u200b\u7528\u4e8e\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u9501\u200b\u5df2\u200b\u91ca\u653e\u200b ARGV[5] \u200b\u91ca\u653e\u200b\u9501\u200b\u6807\u8bb0\u200b key \u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\uff08\u200b\u6beb\u79d2\u200b\uff09\uff0c\u200b\u7528\u4e8e\u200b\u907f\u514d\u200b KEYS[3] \u200b\u5360\u7528\u200b Redis \u200b\u8d44\u6e90\u200b <p>\u200b\u9ed1\u9a6c\u200b\u7684\u200b\u6d41\u7a0b\u56fe\u200b\u4e2d\u200b\u5176\u5b9e\u200b\u5c11\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u53c2\u6570\u200b\u5224\u65ad\u200b\uff0c\u200b\u5373\u200b KEYS[3]\uff0c\u200b\u8fd9\u91cc\u200b\u5bf9\u200b KEYS[3] \u200b\u505a\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b</p> \u200b\u95ee\u9898\u200b \u200b\u5982\u679c\u200b\u6ca1\u6709\u200b KEYS[3] \u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u7684\u200b\u95ee\u9898\u200b KEYS[3] \u200b\u5982\u4f55\u200b\u89e3\u51b3\u200b \u200b\u9501\u200b\u7684\u200b\u91cd\u590d\u200b\u91ca\u653e\u200b \u200b\u7ebf\u7a0b\u200b A \u200b\u91ca\u653e\u200b\u9501\u540e\u200b\uff0c\u200b\u7ebf\u7a0b\u200b B \u200b\u53ef\u80fd\u200b\u4ecd\u7136\u200b\u5c1d\u8bd5\u200b\u91ca\u653e\u200b\u5b83\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8bef\u5220\u200b KEYS[3] \u200b\u8bb0\u5f55\u200b\u9501\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u91ca\u653e\u200b\uff0c\u200b\u9632\u6b62\u200b\u8bef\u5220\u200b \u200b\u6027\u80fd\u200b\u95ee\u9898\u200b \u200b\u6bcf\u6b21\u200b\u91ca\u653e\u200b\u9501\u200b\u90fd\u200b\u9700\u8981\u200b\u6267\u884c\u200b Redis \u200b\u547d\u4ee4\u200b \u200b\u901a\u8fc7\u200b KEYS[3] \u200b\u5feb\u901f\u200b\u8fd4\u56de\u200b\u9501\u200b\u72b6\u6001\u200b\uff0c\u200b\u51cf\u5c11\u200b Redis \u200b\u64cd\u4f5c\u200b \u200b\u9501\u200b\u72b6\u6001\u200b\u4e0d\u200b\u53ef\u77e5\u200b \u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u65e0\u6cd5\u200b\u5224\u65ad\u200b\u9501\u200b\u662f\u5426\u200b\u771f\u7684\u200b\u91ca\u653e\u200b KEYS[3] 0 \u200b\u8868\u793a\u200b\u672a\u200b\u91ca\u653e\u200b\uff0c1 \u200b\u8868\u793a\u200b\u5df2\u200b\u91ca\u653e","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#redisson_2","title":"Redisson\u200b\u9501\u200b\u91cd\u8bd5","text":"<p>Redisson \u200b\u83b7\u53d6\u200b\u9501\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6709\u200b\u4e24\u4e2a\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b <code>lock()</code> \u200b\u548c\u200b <code>tryLock()</code></p> <p>\u200b\u533a\u522b\u200b\u5982\u4e0b\u200b\uff1a</p> \u200b\u65b9\u6cd5\u200b \u200b\u9002\u7528\u200b\u573a\u666f\u200b \u200b\u8ba2\u9605\u200b\u673a\u5236\u200b \u200b\u8d85\u65f6\u200b\u5904\u7406\u200b lock() \u200b\u5fc5\u987b\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u5426\u5219\u200b\u963b\u585e\u200b \u200b\u8ba2\u9605\u200b Redis \u200b\u9891\u9053\u200b\uff0c\u200b\u7b49\u5f85\u200b\u9501\u200b\u91ca\u653e\u200b \u200b\u65e0\u200b\u8d85\u65f6\u200b tryLock() \u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u8d85\u65f6\u200b\u540e\u200b\u653e\u5f03\u200b \u200b\u8ba2\u9605\u200b Redis \u200b\u9891\u9053\u200b\uff08\u200b\u7b49\u5f85\u65f6\u95f4\u200b\u5185\u200b\uff09 \u200b\u8d85\u65f6\u200b\u540e\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b false <p>\u200b\u6d41\u7a0b\u200b\u89e3\u6790\u200b\u56fe\u200b</p> <p></p> <p>\u200b\u8fd9\u91cc\u200b\u4ee5\u200b <code>tryLock()</code> \u200b\u65b9\u6cd5\u200b\u4e3a\u4f8b\u200b</p> <p>\u200b\u4ee3\u7801\u200b\u4f4d\u7f6e\u200b: <code>org.redisson.RedissonLock#tryLock(long, long, java.util.concurrent.TimeUnit)</code></p> Java<pre><code>@Override\npublic boolean tryLock(long waitTime, long leaseTime, TimeUnit unit) throws InterruptedException {\n    long time = unit.toMillis(waitTime); // \u200b\u5c06\u200b\u7b49\u5f85\u65f6\u95f4\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u6beb\u79d2\u200b\n    long current = System.currentTimeMillis(); // \u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\n    long threadId = Thread.currentThread().getId(); // \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b ID\n\n    // \u2460 **\u200b\u5c1d\u8bd5\u200b\u76f4\u63a5\u200b\u83b7\u53d6\u200b\u9501\u200b**\n    Long ttl = tryAcquire(waitTime, leaseTime, unit, threadId);\n\n    // \u2461 **\u200b\u6210\u529f\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b true**\n    if (ttl == null) {\n        return true;\n    }\n\n    // \u2462 **\u200b\u8ba1\u7b97\u200b\u5269\u4f59\u200b\u7b49\u5f85\u65f6\u95f4\u200b**\n    time -= System.currentTimeMillis() - current;\n    if (time &lt;= 0) {\n        acquireFailed(waitTime, unit, threadId); // \u200b\u8bb0\u5f55\u200b\u83b7\u53d6\u200b\u9501\u200b\u5931\u8d25\u200b\n        return false;\n    }\n\n    // \u2463 **\u200b\u8ba2\u9605\u200b\u9501\u200b\u91ca\u653e\u200b\u4e8b\u4ef6\u200b**\n    current = System.currentTimeMillis();\n    CompletableFuture&lt;RedissonLockEntry&gt; subscribeFuture = subscribe(threadId);\n\n    try {\n        // \u2464 **\u200b\u7b49\u5f85\u200b\u8ba2\u9605\u200b\u7ed3\u679c\u200b**\n        subscribeFuture.get(time, TimeUnit.MILLISECONDS);\n    } catch (TimeoutException e) {\n        // **\u200b\u8d85\u65f6\u200b\u5904\u7406\u200b**\n        if (!subscribeFuture.completeExceptionally(new RedisTimeoutException(\n                \"Unable to acquire subscription lock after \" + time + \"ms. \" +\n                        \"Try to increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters.\"))) {\n            subscribeFuture.whenComplete((res, ex) -&gt; {\n                if (ex == null) {\n                    unsubscribe(res, threadId);\n                }\n            });\n        }\n        acquireFailed(waitTime, unit, threadId);\n        return false;\n    } catch (ExecutionException e) {\n        // **\u200b\u6267\u884c\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b**\n        LOGGER.error(e.getMessage(), e);\n        acquireFailed(waitTime, unit, threadId);\n        return false;\n    }\n\n    try {\n        // \u2465 **\u200b\u66f4\u65b0\u200b\u5269\u4f59\u200b\u7b49\u5f85\u65f6\u95f4\u200b**\n        time -= System.currentTimeMillis() - current;\n        if (time &lt;= 0) {\n            acquireFailed(waitTime, unit, threadId);\n            return false;\n        }\n\n        while (true) {\n            long currentTime = System.currentTimeMillis();\n            ttl = tryAcquire(waitTime, leaseTime, unit, threadId); // **\u200b\u518d\u6b21\u200b\u5c1d\u8bd5\u200b\u83b7\u53d6\u200b\u9501\u200b**\n\n            // **\u200b\u6210\u529f\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u8fd4\u56de\u200b true**\n            if (ttl == null) {\n                return true;\n            }\n\n            // \u2466 **\u200b\u68c0\u67e5\u200b\u5269\u4f59\u200b\u7b49\u5f85\u65f6\u95f4\u200b**\n            time -= System.currentTimeMillis() - currentTime;\n            if (time &lt;= 0) {\n                acquireFailed(waitTime, unit, threadId);\n                return false;\n            }\n\n            // \u2467 **\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u9501\u200b\u91ca\u653e\u200b**\n            currentTime = System.currentTimeMillis();\n            if (ttl &gt;= 0 &amp;&amp; ttl &lt; time) {\n                // **\u200b\u7b49\u5f85\u200b\u9501\u200b\u7684\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b**\n                commandExecutor.getNow(subscribeFuture).getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);\n            } else {\n                // **\u200b\u7b49\u5f85\u200b\u5269\u4f59\u200b\u7684\u200b\u65f6\u95f4\u200b**\n                commandExecutor.getNow(subscribeFuture).getLatch().tryAcquire(time, TimeUnit.MILLISECONDS);\n            }\n\n            // **\u200b\u66f4\u65b0\u200b\u5269\u4f59\u65f6\u95f4\u200b**\n            time -= System.currentTimeMillis() - currentTime;\n            if (time &lt;= 0) {\n                acquireFailed(waitTime, unit, threadId);\n                return false;\n            }\n        }\n    } finally {\n        // \u2468 **\u200b\u53d6\u6d88\u200b\u8ba2\u9605\u200b**\n        unsubscribe(commandExecutor.getNow(subscribeFuture), threadId);\n    }\n}\n</code></pre>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#watchdog","title":"WatchDog \u200b\u5b9e\u73b0\u200b\u8d85\u65f6\u200b\u7eed\u7ea6","text":"<p>\u200b\u4f46\u200b\u4e0d\u7ba1\u200b\u8c03\u7528\u200b\u7684\u200b\u662f\u200b <code>lock()</code> \u200b\u8fd8\u662f\u200b <code>tryLock()</code> \uff0c\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u8c03\u7528\u200b\u5230\u200b <code>tryAcquireAsync</code></p> <p>\u200b\u5176\u4e2d\u200b\u6709\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u5224\u65ad\u200b\u903b\u8f91\u200b</p> Java<pre><code>if (leaseTime &gt; 0) {\n    ttlRemainingFuture = tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);\n} else {\n    ttlRemainingFuture = tryLockInnerAsync(waitTime, internalLockLeaseTime,\n            TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b leaseTime &gt; 0\uff0c\u200b\u90a3\u4e48\u200b Redisson \u200b\u4f1a\u200b\u6309\u7167\u200b\u6307\u5b9a\u200b\u7684\u200b leaseTime \u200b\u8fdb\u884c\u200b\u9501\u200b\u7684\u200b\u8fc7\u671f\u200b\u63a7\u5236\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u542f\u52a8\u200b \u200b\u770b\u95e8\u72d7\u200b\u673a\u5236\u200b\uff08\u200b\u81ea\u52a8\u200b\u7eed\u671f\u200b\uff09\u3002</p> <p>\u200b\u800c\u200b\u5982\u679c\u200b leaseTime &lt;= 0 (\u200b\u9ed8\u8ba4\u200b-1)\uff0c\u200b\u90a3\u4e48\u200b Redisson \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u5185\u90e8\u200b\u7684\u200binternalLockLeaseTime\uff0c\u200b\u5e76\u200b\u542f\u52a8\u200b\u770b\u95e8\u72d7\u200b\u673a\u5236\u200b</p> <p><code>internalLockLeaseTime</code> \u200b\u5728\u200b\u6784\u9020\u51fd\u6570\u200b\u5904\u200b\u521d\u59cb\u5316\u200b</p> Java<pre><code>public RedissonLock(CommandAsyncExecutor commandExecutor, String name) {\n    super(commandExecutor, name);\n    this.commandExecutor = commandExecutor;\n    this.internalLockLeaseTime = getServiceManager().getCfg().getLockWatchdogTimeout();\n    this.pubSub = commandExecutor.getConnectionManager().getSubscribeService().getLockPubSub();\n}\n</code></pre> <p>\u200b\u9ed8\u8ba4\u503c\u200b\u4e3a\u200b 30 * 1000ms\uff0c\u200b\u5373\u200b 30 \u200b\u79d2\u200b</p> <p></p> <p>\u200b\u5982\u679c\u200b\u62ff\u5230\u200b\u5206\u5e03\u5f0f\u200b\u9501\u200b\u7684\u200b\u8282\u70b9\u200b\u5b95\u673a\u200b\uff0c\u200b\u4e14\u200b\u8fd9\u4e2a\u200b\u9501\u200b\u6b63\u597d\u200b\u5904\u4e8e\u200b\u9501\u4f4f\u200b\u7684\u200b\u72b6\u6001\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u9501\u6b7b\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u7684\u200b\u53d1\u751f\u200b\uff0c\u200b\u9501\u200b\u90fd\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u3002\u200b\u8fd9\u6837\u200b\u4e5f\u200b\u5b58\u5728\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u52a0\u5165\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u62ff\u5230\u200b\u4e86\u200b\u9501\u200b\u8bbe\u7f6e\u200b\u4e86\u200b30s\u200b\u8d85\u65f6\u200b\uff0c\u200b\u5728\u200b30s\u200b\u540e\u200b\u8fd9\u4e2a\u200b\u7ebf\u7a0b\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u9501\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u95ee\u9898\u200b\uff0cRedisson\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b\u7b54\u6848\u200b\uff0c\u200b\u5c31\u662f\u200b watch dog \u200b\u81ea\u52a8\u200b\u5ef6\u671f\u200b\u673a\u5236\u200b\u3002  </p> <p>Redisson\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u76d1\u63a7\u200b\u9501\u200b\u7684\u200b\u770b\u95e8\u72d7\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u4f5c\u7528\u200b\u662f\u200b\u5728\u200bRedisson\u200b\u5b9e\u4f8b\u200b\u88ab\u200b\u5173\u95ed\u200b\u524d\u200b\uff0c\u200b\u4e0d\u65ad\u200b\u7684\u200b\u5ef6\u957f\u200b\u9501\u200b\u7684\u200b\u6709\u6548\u671f\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u62ff\u5230\u200b\u9501\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u4e00\u76f4\u200b\u6ca1\u6709\u200b\u5b8c\u6210\u200b\u903b\u8f91\u200b\uff0c\u200b\u90a3\u4e48\u200b\u770b\u95e8\u72d7\u200b\u4f1a\u200b\u5e2e\u52a9\u200b\u7ebf\u7a0b\u200b\u4e0d\u65ad\u200b\u7684\u200b\u5ef6\u957f\u200b\u9501\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff0c\u200b\u9501\u200b\u4e0d\u4f1a\u200b\u56e0\u4e3a\u200b\u8d85\u65f6\u200b\u800c\u200b\u88ab\u200b\u91ca\u653e\u200b\u3002 \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u770b\u95e8\u72d7\u200b\u7684\u200b\u7eed\u671f\u200b\u65f6\u95f4\u200b\u662f\u200b30s\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200b <code>Config.lockWatchdogTimeout</code> \u200b\u6765\u200b\u53e6\u884c\u200b\u6307\u5b9a\u200b\u3002\u200b\u53e6\u5916\u200bRedisson \u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200bleaseTime\u200b\u53c2\u6570\u200b\u7684\u200b\u52a0\u9501\u200b\u65b9\u6cd5\u200b\u6765\u200b\u6307\u5b9a\u200b\u52a0\u9501\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u8d85\u8fc7\u200b\u8fd9\u4e2a\u200b\u65f6\u95f4\u200b\u540e\u9501\u200b\u4fbf\u200b\u81ea\u52a8\u200b\u89e3\u5f00\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5ef6\u957f\u200b\u9501\u200b\u7684\u200b\u6709\u6548\u671f\u200b\u3002</p> <p>\u200b\u7ee7\u7eed\u200b\u8ddf\u8e2a\u200b\u6e90\u7801\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u662f\u200b <code>tryAcquireAsync</code> \u200b\u7684\u200b\u65b9\u6cd5\u200b\u5168\u8c8c\u200b</p> <p>\u200b\u6e90\u7801\u200b\u4f4d\u7f6e\u200b\uff1a <code>org.redisson.RedissonLock#tryAcquireAsync</code></p> Java<pre><code>private RFuture&lt;Long&gt; tryAcquireAsync(long waitTime, long leaseTime, TimeUnit unit, long threadId) {\n    RFuture&lt;Long&gt; ttlRemainingFuture;\n    if (leaseTime &gt; 0) {\n        ttlRemainingFuture = tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);\n    } else {\n        ttlRemainingFuture = tryLockInnerAsync(waitTime, internalLockLeaseTime,\n                TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);\n    }\n    CompletionStage&lt;Long&gt; s = handleNoSync(threadId, ttlRemainingFuture);\n    ttlRemainingFuture = new CompletableFutureWrapper&lt;&gt;(s);\n\n    CompletionStage&lt;Long&gt; f = ttlRemainingFuture.thenApply(ttlRemaining -&gt; {\n        // lock acquired\n        if (ttlRemaining == null) {\n            if (leaseTime &gt; 0) {\n                internalLockLeaseTime = unit.toMillis(leaseTime);\n            } else {\n                //\u200b\u8fd9\u91cc\u200b\u662f\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b \u200b\u5f53\u524d\u200b\u9501\u200b\u81ea\u52a8\u200b\u5ef6\u671f\u200b\u7684\u200b\u52a8\u4f5c\u200b,leaseTime\u200b\u4e3a\u200b-1\u200b\u65f6\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5ef6\u671f\u200b\n                scheduleExpirationRenewal(threadId);\n            }\n        }\n        return ttlRemaining;\n    });\n    return new CompletableFutureWrapper&lt;&gt;(f);\n}\n</code></pre> <p>\u200b\u91cd\u70b9\u200b\u5728\u4e8e\u200b <code>scheduleExpirationRenewal</code> \u200b\u8fd9\u4e2a\u200b\u81ea\u52a8\u200b\u5ef6\u671f\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6700\u7ec8\u200b\u8c03\u7528\u200b <code>org.redisson.renewal.RenewalTask#add</code> </p> Java<pre><code>final void add(String rawName, String lockName, long threadId, LockEntry entry) {\n    addSlotName(rawName);\n\n    LockEntry oldEntry = name2entry.putIfAbsent(rawName, entry);\n    if (oldEntry != null) {\n        oldEntry.addThreadId(threadId, lockName);\n    } else {\n        if (tryRun()) {\n            schedule();\n        }\n    }\n}\n</code></pre> <p><code>tryRun()</code> \u200b\u65b9\u6cd5\u200b\u662f\u200b\u4e00\u4e2a\u200b CAS \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u540c\u4e00\u200b\u65f6\u523b\u200b\u53ea\u6709\u200b 1 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u8fdb\u884c\u200b\u7eed\u7ea6\u200b\u64cd\u4f5c\u200b</p> Java<pre><code>boolean tryRun() {\n    return running.compareAndSet(false, true);\n}\n</code></pre> <p><code>schedule()</code> \u200b\u65b9\u6cd5\u200b\u6700\u7ec8\u200b\u5411\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u6c60\u200b(\u200b\u5176\u5b9e\u200b\u6ca1\u770b\u200b\u61c2\u200b\uff0c\u200b\u5e94\u8be5\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u7c7b\u4f3c\u7269\u200b)\u200b\u4e2d\u200b\u4f20\u5165\u200b\u4e00\u4e2a\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b\u4e3a\u200b internalLockLeaseTime / 3\uff0c\u200b\u5373\u200b 10s \u200b\u6267\u884c\u200b\u4e00\u6b21\u200b\u7eed\u7ea6\u200b</p> Java<pre><code>public void schedule() {\n    if (!running.get()) {\n        return;\n    }\n\n    long internalLockLeaseTime = executor.getServiceManager().getCfg().getLockWatchdogTimeout();\n    executor.getServiceManager().newTimeout(this, internalLockLeaseTime / 3, TimeUnit.MILLISECONDS);\n}\n</code></pre> <p>\u200b\u7591\u95ee\u200b\uff1a\u200b\u65e2\u7136\u200b\u6709\u200b\u4e86\u200b\u5f00\u95e8\u200b\u72d7\u200b\u673a\u5236\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u8fd8\u8981\u200b\u8bbe\u7f6e\u200b\u9ed8\u8ba4\u200b\u8fc7\u671f\u200b\u91ca\u653e\u200b\u65f6\u95f4\u200b\u4e3a\u200b 30s\uff1f\u200b\u65e2\u7136\u200b\u76ee\u7684\u200b\u662f\u200b\u9632\u6b62\u200b\u9501\u200b\u8d85\u65f6\u200b\u91ca\u653e\u200b\u5bfc\u81f4\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76f4\u63a5\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b-1 \u200b\u6c38\u4e0d\u200b\u8fc7\u671f\u200b\u4e0d\u200b\u5c31\u200b\u597d\u200b\u4e86\u200b\uff1f</p> <p>\u200b\u5176\u5b9e\u200b\u4e0a\u200b\u6587\u4e2d\u200b\u6709\u200b\u63d0\u5230\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u8282\u70b9\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u5d29\u6e83\u200b\u4e86\u200b\uff0c\u200b\u8fc7\u671f\u200b\u65f6\u95f4\u200b\u5374\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u6c38\u4e0d\u200b\u8fc7\u671f\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6b7b\u9501\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u4ed6\u200b\u8282\u70b9\u200b\u65e0\u6cd5\u200b\u83b7\u5f97\u200b\u9501\u200b\uff0c\u200b\u4ece\u800c\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\u3002\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u5373\u4f7f\u200b\u770b\u95e8\u72d7\u200b\u673a\u5236\u200b\u5931\u6548\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u4e00\u76f4\u200b\u6301\u6709\u200b\u9501\u200b\u3002</p>","tags":["java","JUC"]},{"location":"blog/backend/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/#_5","title":"\u4e3b\u4ece\u200b\u4e00\u81f4","text":"<p>\u200b\u4e3b\u4ece\u200b\u4e00\u81f4\u6027\u200b\uff1a\u200b\u96c6\u7fa4\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u4e3b\u4ece\u200b\u540c\u6b65\u200b\u5b58\u5728\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u5f53\u200b\u52a0\u9501\u200b\u540e\u4e3b\u200b\u670d\u52a1\u5668\u200b\u5b95\u673a\u200b\u65f6\u200b\uff0c\u200b\u4ece\u200b\u670d\u52a1\u5668\u200b\u8fd8\u200b\u6ca1\u200b\u540c\u6b65\u200b\u4e3b\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\u7684\u200b\u9501\u200b\u6570\u636e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4ece\u200b\u670d\u52a1\u5668\u200b\u5347\u7ea7\u200b\u4e3a\u4e3b\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u53c8\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u9501\u200b</p> <p>\u200b\u5c06\u200b\u670d\u52a1\u5668\u200b\u5347\u7ea7\u200b\u4e3a\u200b\u591a\u4e3b\u591a\u200b\u4ece\u200b\uff1a</p> <ul> <li>\u200b\u83b7\u53d6\u200b\u9501\u200b\u9700\u8981\u200b\u4ece\u200b\u6240\u6709\u4e3b\u200b\u670d\u52a1\u5668\u200b SET \u200b\u6210\u529f\u200b\u624d\u200b\u7b97\u200b\u83b7\u53d6\u200b\u6210\u529f\u200b</li> <li>\u200b\u67d0\u4e2a\u200b master \u200b\u5b95\u673a\u200b\uff0cslave \u200b\u8fd8\u200b\u6ca1\u6709\u200b\u540c\u6b65\u200b\u9501\u200b\u6570\u636e\u200b\u5c31\u200b\u5347\u7ea7\u200b\u4e3a\u200b master\uff0c\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5c1d\u8bd5\u200b\u52a0\u9501\u200b\u4f1a\u200b\u52a0\u9501\u200b\u5931\u8d25\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5176\u4ed6\u200b master \u200b\u4e0a\u200b\u5df2\u7ecf\u200b\u5b58\u5728\u200b\u8be5\u9501\u200b</li> </ul>","tags":["java","JUC"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E4%BB%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%90%86%E8%A7%A3Pull%E4%B8%8EPush%E6%A8%A1%E5%9E%8B%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/","title":"\u4ece\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u7406\u89e3\u200bPull\u200b\u4e0e\u200bPush\u200b\u6a21\u578b\u200b\u5e95\u5c42\u200b\u903b\u8f91","text":"<p> \u200b\u7ea6\u200b 1460 \u200b\u4e2a\u200b\u5b57\u200b  2 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 5 \u200b\u5206\u949f\u200b</p> <p>\u200b\u5728\u200b\u6784\u5efa\u200b\u5206\u5e03\u5f0f\u200b\u6d88\u606f\u200b\u7cfb\u7edf\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u9762\u4e34\u200b\u7684\u200b\u4e00\u4e2a\u200b\u57fa\u672c\u200b\u51b3\u7b56\u200b\u662f\u200b\u786e\u5b9a\u200b\u6570\u636e\u200b\u6d41\u52a8\u200b\u7684\u200b\u65b9\u5411\u200b\uff1a\u200b\u6d88\u8d39\u8005\u200b\u662f\u4ece\u200b\u4ee3\u7406\u200b (Broker) \u200b\u62c9\u53d6\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd8\u662f\u200b\u7531\u200b\u4ee3\u7406\u200b\u4e3b\u52a8\u200b\u5c06\u200b\u6570\u636e\u200b\u63a8\u9001\u200b\u7ed9\u200b\u6d88\u8d39\u8005\u200b\u3002\u200b\u8fd9\u4e00\u200b\u51b3\u7b56\u200b\u4e0d\u4ec5\u200b\u5f71\u54cd\u200b\u7cfb\u7edf\u200b\u7684\u200b\u6027\u80fd\u200b\u548c\u200b\u6548\u7387\u200b\uff0c\u200b\u8fd8\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u7684\u200b\u67b6\u6784\u200b\u548c\u200b\u53ef\u6269\u5c55\u6027\u200b\u3002</p>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E4%BB%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%90%86%E8%A7%A3Pull%E4%B8%8EPush%E6%A8%A1%E5%9E%8B%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/#push","title":"\u63a8\u9001\u200b (Push) \u200b\u6a21\u578b\u200b\u7684\u200b\u4f18\u52bf\u200b\u4e0e\u200b\u5c40\u9650","text":"<p>\u200b\u5728\u200b \u200b\u63a8\u9001\u200b\u6a21\u578b\u200b \u200b\u4e2d\u200b\uff0c\u200b\u6570\u636e\u6d41\u200b\u662f\u200b\u7531\u200b\u751f\u4ea7\u8005\u200b\u4e3b\u52a8\u200b\u5411\u200b\u4ee3\u7406\u200b\u53d1\u9001\u6570\u636e\u200b\uff0c\u200b\u968f\u540e\u200b\u4ee3\u7406\u200b\u6839\u636e\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u7684\u200b\u89c4\u5219\u200b\u6216\u200b\u7b56\u7565\u200b\uff0c\u200b\u5c06\u200b\u6570\u636e\u200b\u63a8\u9001\u200b\u7ed9\u200b\u6ce8\u518c\u200b\u7684\u200b\u6d88\u8d39\u8005\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u7684\u200b\u4f18\u70b9\u200b\u5305\u62ec\u200b\u8f83\u200b\u4f4e\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u548c\u200b\u5b9e\u65f6\u6027\u200b\u66f4\u5f3a\u200b\u7684\u200b\u6570\u636e\u200b\u4f20\u9012\u200b\u3002</p> <p>\u200b\u7136\u800c\u200b\uff0c\u200b\u63a8\u9001\u200b\u6a21\u578b\u200b\u4e5f\u200b\u6709\u200b\u660e\u663e\u200b\u7684\u200b\u5c40\u9650\u6027\u200b\u3002</p> <ul> <li>\u200b\u9996\u5148\u200b\uff0c\u200b\u5b83\u200b\u5bf9\u200b\u7f51\u7edc\u5e26\u5bbd\u200b\u7684\u200b\u8981\u6c42\u200b\u8f83\u200b\u9ad8\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u9ad8\u200b\u5e76\u53d1\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u5927\u91cf\u200b\u7684\u200b\u5c0f\u200b\u6570\u636e\u5305\u200b\u9891\u7e41\u200b\u4f20\u8f93\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u7f51\u7edc\u200b\u62e5\u585e\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u7684\u200b\u6d88\u8d39\u200b\u80fd\u529b\u200b\u4e3a\u200b 10 \u200b\u6761\u200b/s\uff0c\u200b\u800c\u200b\u751f\u4ea7\u8005\u200b\u751f\u4ea7\u80fd\u529b\u200b\u4e3a\u200b 100 \u200b\u6761\u200b/s\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5927\u91cf\u200b\u8bf7\u6c42\u200b\u5411\u4e0b\u200b\u79ef\u538b\u200b\uff0c\u200b\u5f53\u7136\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>mq (Broker)</code> \u200b\u5904\u200b\u8fdb\u884c\u200b\u6d88\u606f\u200b\u5806\u79ef\u200b\uff0c\u200b\u6216\u200b\u5229\u7528\u200b\u6b7b\u4fe1\u200b\u961f\u5217\u200b\u7b49\u200b\u673a\u5236\u200b\u8fdb\u884c\u200b\u9000\u56de\u200b\uff0c\u200b\u4f46\u662f\u200b\u76f8\u5e94\u200b\u7684\u200b\uff0c\u200b\u5bf9\u4e8e\u200b Broker \u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u538b\u529b\u200b\u4e5f\u200b\u4f1a\u200b\u663e\u8457\u200b\u589e\u5927\u200b\u3002</li> <li>\u200b\u5176\u6b21\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u4f20\u8f93\u901f\u7387\u200b\u7531\u200b\u4ee3\u7406\u200b\u63a7\u5236\u200b\uff0c\u200b\u4e0d\u540c\u200b\u6d88\u8d39\u8005\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5904\u7406\u200b\u80fd\u529b\u5dee\u5f02\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u90e8\u5206\u200b\u6d88\u8d39\u8005\u200b\u65e0\u6cd5\u200b\u53ca\u65f6\u5904\u7406\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4ece\u800c\u200b\u9020\u6210\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\u6d6a\u8d39\u200b\u6216\u200b\u7cfb\u7edf\u200b\u8fc7\u8f7d\u200b\u3002</li> </ul> <p>\u200b\u7279\u522b\u200b\u662f\u200b\u5f53\u200b\u6d88\u8d39\u8005\u200b\u7684\u200b\u5904\u7406\u901f\u5ea6\u200b\u4f4e\u4e8e\u200b\u751f\u4ea7\u8005\u200b\u7684\u200b\u751f\u6210\u200b\u901f\u5ea6\u200b\u65f6\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u906d\u53d7\u200b\u7c7b\u4f3c\u200b\u62d2\u7edd\u670d\u52a1\u200b\u653b\u51fb\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5373\u8fc7\u200b\u591a\u200b\u7684\u200b\u6570\u636e\u200b\u6df9\u6ca1\u200b\u800c\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002</p> <p>\u200b\u5728\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u7684\u200b\u63a8\u9001\u200b\u6a21\u5f0f\u200b\u4e2d\u200b\uff0c\u200b\u4ee3\u7406\u200b\uff08Broker\uff09\u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u548c\u200b\u7ef4\u62a4\u200b\u6bcf\u4e2a\u200b\u6d88\u8d39\u8005\u200b\u7684\u200b\u6d88\u8d39\u200b\u8fdb\u5ea6\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u51c6\u786e\u200b\u5730\u200b\u5c06\u200b\u672a\u200b\u6d88\u8d39\u200b\u7684\u200b\u6d88\u606f\u200b\u63a8\u9001\u200b\u7ed9\u200b\u76f8\u5e94\u200b\u7684\u200b\u6d88\u8d39\u8005\u200b\u3002\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u63a8\u9001\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u4ee3\u7406\u200b\u8d1f\u8d23\u200b\u63a7\u5236\u200b\u6d88\u606f\u200b\u7684\u200b\u53d1\u9001\u200b\u65f6\u95f4\u200b\u548c\u200b\u6570\u91cf\u200b\uff0c\u200b\u786e\u4fdd\u200b\u6bcf\u4e2a\u200b\u6d88\u8d39\u8005\u200b\u90fd\u200b\u80fd\u200b\u63a5\u6536\u200b\u5230\u200b\u5b83\u4eec\u200b\u5c1a\u672a\u200b\u5904\u7406\u200b\u7684\u200b\u6d88\u606f\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u5bf9\u200b\u4ee3\u7406\u200b\u7684\u200b\u7ba1\u7406\u200b\u548c\u200b\u534f\u8c03\u200b\u80fd\u529b\u200b\u8981\u6c42\u200b\u8f83\u200b\u9ad8\u200b\uff0c\u200b\u5c24\u5176\u200b\u662f\u200b\u5728\u200b\u6d88\u8d39\u8005\u200b\u6570\u91cf\u200b\u4e2d\u591a\u4e14\u200b\u5904\u7406\u200b\u80fd\u529b\u200b\u4e0d\u4e00\u5730\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5bb9\u6613\u200b\u5bfc\u81f4\u7cfb\u7edf\u200b\u590d\u6742\u5ea6\u200b\u589e\u52a0\u200b\u548c\u200b\u6027\u80fd\u200b\u74f6\u9888\u200b\u3002</p>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E4%BB%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%90%86%E8%A7%A3Pull%E4%B8%8EPush%E6%A8%A1%E5%9E%8B%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/#pull","title":"\u62c9\u53d6\u200b (Pull) \u200b\u6a21\u578b\u200b\u7684\u200b\u4f18\u52bf\u200b\u4e0e\u200b\u6311\u6218","text":"<p>\u200b\u76f8\u6bd4\u4e4b\u4e0b\u200b\uff0c\u200b\u62c9\u53d6\u200b\u6a21\u578b\u200b\u5219\u200b\u91c7\u53d6\u200b\u4e86\u200b\u4e00\u79cd\u200b\u66f4\u4e3a\u200b\u4fdd\u5b88\u200b\u548c\u200b\u7075\u6d3b\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u4e2d\u200b\uff0c\u200b\u6570\u636e\u200b\u7531\u200b\u751f\u4ea7\u8005\u200b\u53d1\u9001\u5230\u200b\u4ee3\u7406\u200b\uff0c\u200b\u4f46\u200b\u6d88\u8d39\u8005\u200b\u9700\u8981\u200b\u4e3b\u52a8\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\u4ee5\u200b\u83b7\u53d6\u6570\u636e\u200b\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u81ea\u8eab\u200b\u7684\u200b\u5904\u7406\u200b\u80fd\u529b\u200b\u548c\u200b\u5f53\u524d\u200b\u7684\u200b\u5de5\u4f5c\u200b\u8d1f\u8f7d\u200b\u60c5\u51b5\u200b\uff0c\u200b\u81ea\u4e3b\u200b\u51b3\u5b9a\u200b\u4f55\u65f6\u200b\u4ee5\u53ca\u200b\u591a\u5c11\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u62c9\u53d6\u200b\u3002\u200b\u5373\u4f7f\u200b\u5728\u200b\u6d88\u8d39\u200b\u901f\u5ea6\u200b\u4e0b\u964d\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u4e5f\u200b\u53ea\u4f1a\u200b\u6682\u65f6\u200b\u843d\u540e\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u50cf\u200b\u5728\u200b\u63a8\u9001\u200b\u6a21\u578b\u200b\u4e2d\u200b\u88ab\u200b\u538b\u57ae\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u62c9\u53d6\u200b\u6a21\u578b\u200b\u8fd8\u200b\u652f\u6301\u200b\u66f4\u200b\u6709\u6548\u200b\u7684\u200b\u6570\u636e\u200b\u6279\u5904\u7406\u200b\u3002\u200b\u6d88\u8d39\u8005\u200b\u53ef\u4ee5\u200b\u4e00\u6b21\u6027\u200b\u62c9\u53d6\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u5c11\u200b\u7f51\u7edc\u200b\u4ea4\u4e92\u200b\u6b21\u6570\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u4f20\u8f93\u200b\u6548\u7387\u200b\uff0c\u200b\u540c\u65f6\u200b\u4fdd\u6301\u200b\u8f83\u200b\u4f4e\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002</p> <p></p> <p>\u200b\u62c9\u53d6\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u81ea\u5df1\u200b\u51b3\u5b9a\u200b\u4f55\u65f6\u200b\u4ee5\u53ca\u200b\u591a\u5c11\u200b\u6d88\u606f\u200b\u8fdb\u884c\u200b\u6d88\u8d39\u200b\u3002\u200b\u6d88\u8d39\u8005\u200b\u4f1a\u200b\u4e3b\u52a8\u200b\u5411\u200b\u4ee3\u7406\u200b\u8bf7\u6c42\u200b\u6d88\u606f\u200b\uff0c\u200b\u4ee3\u7406\u200b\u53ea\u200b\u9700\u200b\u63d0\u4f9b\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u548c\u200b\u67e5\u8be2\u200b\u7684\u200b\u529f\u80fd\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u51cf\u5c11\u200b\u4e86\u200b\u4ee3\u7406\u200b\u7684\u200b\u8d1f\u62c5\u200b\uff0c\u200b\u4f7f\u200b\u5176\u200b\u4e0d\u5fc5\u200b\u8ffd\u8e2a\u200b\u6bcf\u4e2a\u200b\u6d88\u8d39\u8005\u200b\u7684\u200b\u6d88\u8d39\u200b\u8fdb\u5ea6\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u8d4b\u4e88\u200b\u4e86\u200b\u6d88\u8d39\u8005\u200b\u66f4\u5927\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u81ea\u8eab\u200b\u5904\u7406\u200b\u80fd\u529b\u200b\u548c\u200b\u5f53\u524d\u200b\u8d1f\u8f7d\u200b\u60c5\u51b5\u200b\u81ea\u4e3b\u200b\u8c03\u6574\u200b\u6d88\u8d39\u200b\u901f\u7387\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u7b80\u5316\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u7684\u200b\u53ef\u6269\u5c55\u6027\u200b\u548c\u200b\u9c81\u68d2\u6027\u200b\u3002</p> <p>\u200b\u7136\u800c\u200b\uff0c\u200b\u62c9\u53d6\u200b\u6a21\u578b\u200b\u5e76\u975e\u200b\u6ca1\u6709\u200b\u6311\u6218\u200b\u3002\u200b\u6700\u200b\u660e\u663e\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u4ee3\u7406\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u53ef\u4f9b\u200b\u62c9\u53d6\u200b\uff0c\u200b\u6d88\u8d39\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9891\u7e41\u200b\u5730\u200b\u53d1\u8d77\u200b\u7a7a\u200b\u67e5\u8be2\u200b\uff0c\u200b\u5bfc\u81f4\u200b CPU \u200b\u5229\u7528\u7387\u200b\u5347\u9ad8\u200b\uff0c\u200b\u5f62\u6210\u200b\u6240\u8c13\u200b\u7684\u200b \u201c\u200b\u5fd9\u200b\u7b49\u200b (Busy-Waiting)\u201d \u200b\u72b6\u6001\u200b\u3002\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e00\u200b\u95ee\u9898\u200b\uff0cKafka \u200b\u5f15\u5165\u200b\u4e86\u200b \"\u200b\u957f\u200b\u8f6e\u8be2\u200b\" \u200b\u673a\u5236\u200b\uff0c\u200b\u5141\u8bb8\u200b\u6d88\u8d39\u8005\u200b\u53d1\u51fa\u200b\u62c9\u53d6\u200b\u8bf7\u6c42\u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u53ef\u4f9b\u200b\u62c9\u53d6\u200b\uff0c\u200b\u8be5\u200b\u8bf7\u6c42\u200b\u4f1a\u200b\u5728\u200b\u4ee3\u7406\u200b\u7aef\u200b\u7b49\u5f85\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\uff0c\u200b\u76f4\u5230\u200b\u6709\u200b\u65b0\u200b\u6570\u636e\u200b\u4ea7\u751f\u200b\u6216\u200b\u8fbe\u5230\u200b\u9884\u8bbe\u200b\u7684\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\u3002\u200b\u8fd9\u6837\u200b\u65e2\u200b\u907f\u514d\u200b\u4e86\u200b\u9891\u7e41\u200b\u5730\u7a7a\u200b\u67e5\u8be2\u200b\uff0c\u200b\u6709\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6570\u636e\u200b\u7684\u200b\u53ca\u65f6\u200b\u4f20\u9012\u200b\u3002</p>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E4%BB%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%90%86%E8%A7%A3Pull%E4%B8%8EPush%E6%A8%A1%E5%9E%8B%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/#kafka","title":"Kafka \u200b\u7684\u200b\u9009\u62e9\u200b\u548c\u200b\u5b9e\u8df5","text":"<p>\u200b\u57fa\u4e8e\u200b\u4e0a\u8ff0\u200b\u5206\u6790\u200b\uff0cKafka \u200b\u9009\u62e9\u200b\u4e86\u200b\u62c9\u53d6\u200b\u6a21\u578b\u200b \u200b\u4f5c\u4e3a\u200b\u5176\u200b\u6838\u5fc3\u200b\u6570\u636e\u4f20\u8f93\u200b\u673a\u5236\u200b\u3002\u200b\u8fd9\u4e00\u200b\u9009\u62e9\u200b\u4e0d\u4ec5\u200b\u7b26\u5408\u200b\u5927\u591a\u6570\u200b\u6d88\u606f\u200b\u7cfb\u7edf\u200b\u7684\u200b\u4f20\u7edf\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u8fd8\u200b\u7279\u522b\u200b\u9002\u5408\u200b\u4e8e\u200b\u9700\u8981\u200b\u5904\u7406\u200b\u5927\u91cf\u200b\u5f02\u6784\u200b\u6d88\u8d39\u8005\u200b\u7684\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\u3002\u200b\u901a\u8fc7\u200b\u5b9e\u73b0\u200b\u957f\u200b\u8f6e\u8be2\u200b\u529f\u80fd\u200b\uff0cKafka \u200b\u6709\u6548\u200b\u5730\u200b\u5e73\u8861\u200b\u4e86\u200b\u6570\u636e\u4f20\u8f93\u200b\u7684\u200b\u5373\u65f6\u6027\u200b\u548c\u200b\u7cfb\u7edf\u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5373\u4f7f\u200b\u5728\u200b\u7f51\u7edc\u200b\u6761\u4ef6\u200b\u4e0d\u200b\u7a33\u5b9a\u200b\u6216\u200b\u6d88\u8d39\u8005\u200b\u5904\u7406\u200b\u80fd\u529b\u200b\u6709\u9650\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u80fd\u200b\u4fdd\u6301\u200b\u9ad8\u6548\u200b\u7684\u200b\u6570\u636e\u4ea4\u6362\u200b\u3002\u200b\u6b64\u5916\u200b\uff0cKafka \u200b\u8fd8\u200b\u901a\u8fc7\u200b\u6570\u636e\u200b\u6279\u5904\u7406\u200b\u548c\u200b\u8c03\u6574\u200b\u62c9\u53d6\u200b\u8bf7\u6c42\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u8fdb\u4e00\u6b65\u63d0\u9ad8\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u7684\u200b\u6574\u4f53\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u63a8\u9001\u200b\u6a21\u578b\u200b\u548c\u62c9\u53d6\u200b\u6a21\u578b\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u7528\u4e8e\u200b\u5e94\u5bf9\u200b\u4e0d\u540c\u200b\u7684\u200b\u6280\u672f\u200b\u573a\u666f\u200b\u7684\u200b\u3002</p> <ul> <li>Kafka \u200b\u7684\u200b\u62c9\u53d6\u200b\u6a21\u578b\u200b\u66f4\u200b\u9002\u5408\u200b\u6570\u636e\u5904\u7406\u200b\u573a\u666f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u5141\u8bb8\u200b\u6d88\u8d39\u8005\u200b\u6839\u636e\u200b\u81ea\u8eab\u200b\u5904\u7406\u200b\u80fd\u529b\u200b\u81ea\u4e3b\u200b\u63a7\u5236\u6570\u636e\u200b\u62c9\u53d6\u200b\u7684\u200b\u9891\u7387\u200b\u548c\u200b\u6570\u91cf\u200b\uff0c\u200b\u6709\u6548\u200b\u907f\u514d\u200b\u4e86\u200b\u6d88\u8d39\u8005\u200b\u8fc7\u8f7d\u200b\u548c\u200b\u8d44\u6e90\u200b\u6d6a\u8d39\u200b\u3002</li> <li>\u200b\u800c\u200b\u5728\u200b\u4e1a\u52a1\u200b\u573a\u666f\u200b\u4e2d\u200b\uff0c\u200b\u5b9e\u65f6\u6027\u200b\u548c\u200b\u4f4e\u200b\u5ef6\u8fdf\u200b\u8981\u6c42\u200b\u66f4\u9ad8\u200b\uff0cRocketMq \u200b\u548c\u200b RabbitMQ \u200b\u7684\u200b\u63a8\u9001\u200b\u6a21\u578b\u200b\u80fd\u200b\u66f4\u597d\u200b\u5730\u200b\u6ee1\u8db3\u200b\u8fd9\u4e9b\u200b\u9700\u6c42\u200b</li> </ul> <p>\u200b\u7ed3\u8bba\u200b</p> <ul> <li>\u200b\u63a8\u9001\u200b(Push)\u200b\u6a21\u578b\u200b\uff0c\u200b\u8981\u6c42\u200b\u7684\u200b\u662f\u200b\u5b9e\u65f6\u6027\u200b  </li> <li>\u200b\u62c9\u53d6\u200b(Pull)\u200b\u6a21\u578b\u200b\uff0c\u200b\u8981\u6c42\u200b\u7684\u200b\u662f\u200b\u541e\u5410\u91cf\u200b (\u200b\u6279\u5904\u7406\u200b\uff0c\u200b\u538b\u7f29\u200b)</li> </ul>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/","title":"\u6d88\u606f\u200b\u7aef\u5230\u200b\u7aef\u7684\u200b\u4e00\u81f4\u6027\u200b\u4e0e\u200b\u53ef\u9760\u6027","text":"<p> \u200b\u7ea6\u200b 4688 \u200b\u4e2a\u200b\u5b57\u200b  3 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 16 \u200b\u5206\u949f\u200b</p>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#_2","title":"\u80cc\u666f\u200b\u4ecb\u7ecd","text":"<ul> <li> <p>\u200b\u53ef\u9760\u6027\u200b: \u200b\u6d88\u606f\u200b\u4e00\u65e6\u200b\u663e\u793a\u200b\u53d1\u9001\u200b\u6210\u529f\u200b\u5c31\u200b\u5fc5\u5b9a\u200b\u9001\u200b\u8fbe\u5230\u200b\u5bf9\u7aef\u200b</p> </li> <li> <p>\u200b\u4e00\u81f4\u6027\u200b:\u200b\u4efb\u610f\u200b\u65f6\u523b\u200b\u6d88\u606f\u200b\u4fdd\u8bc1\u200b\u4e0e\u200b\u53d1\u9001\u200b\u7aef\u200b\u987a\u5e8f\u200b\u4e00\u81f4\u200b\u3002</p> </li> </ul> <p>\u200b\u6d88\u606f\u200b\u53ef\u9760\u200b\u4e0e\u200b\u4e00\u81f4\u200b\u5bf9\u4e8e\u200bIM\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5c31\u662f\u6307\u200b: \u200b\u53ef\u200b\u8fbe\u200b\u6709\u5e8f\u200b,\u200b\u4e0d\u91cd\u200b\u4e0d\u6f0f\u200b\u3002</p> <p>\u200b\u8bbe\u8ba1\u200bIM\u200b\u5fc5\u987b\u200b\u5177\u6709\u200b\u7aef\u200b\u5bf9\u200b\u7aef\u7684\u200b\u8bbe\u8ba1\u200b\u601d\u7ef4\u200b\uff0c\u200b\u5e95\u5c42\u200b\u5bf9\u200b\u53ef\u9760\u6027\u200b\u7684\u200b\u4fdd\u8bc1\u200b\u4ec5\u80fd\u200b\u4fdd\u8bc1\u200b\u5e95\u5c42\u200b\u7684\u200b\u53ef\u9760\u200b\uff0c\u200b\u800c\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u4e0a\u5c42\u200b\u7684\u200b\u53ef\u9760\u200b, \u200b\u5e95\u5c42\u200b\u7684\u200b\u53ef\u9760\u200b\u4ec5\u200b\u662f\u200b\u51cf\u5c0f\u200b\u4e86\u200b\u53d1\u751f\u200b\u6545\u969c\u200b\u7684\u200b\u6982\u7387\u200b: \u200b\u5e95\u5c42\u200b\u53ef\u9760\u200b\u4e0d\u200b\u7b49\u4e8e\u200b\u4e0a\u5c42\u200b\u53ef\u9760\u200b\uff0c\u200b\u540c\u7406\u200b: \u200b\u5e95\u5c42\u200b\u4e00\u81f4\u200b\u4e0d\u200b\u7b49\u4e8e\u200b\u4e0a\u5c42\u200b\u4e00\u81f4\u200b</p> <p>\u200b\u6d88\u606f\u200b\u7684\u200b\u7aef\u200b\u5230\u200b\u7aef\u200b\u53ef\u9760\u6027\u200b = \u200b\u4e0a\u884c\u200b\u6d88\u606f\u200b\u53ef\u9760\u200b + \u200b\u670d\u52a1\u7aef\u200b\u4e1a\u52a1\u200b\u53ef\u9760\u200b + \u200b\u4e0b\u884c\u200b\u6d88\u606f\u200b\u53ef\u9760\u200b</p> <p>\u200b\u6d88\u606f\u200b\u7684\u200b\u7aef\u200b\u5230\u200b\u7aef\u200b\u4e00\u81f4\u6027\u200b = \u200b\u4e0a\u884c\u200b\u6d88\u606f\u200b\u4e00\u81f4\u200b + \u200b\u670d\u52a1\u7aef\u200b\u4e1a\u52a1\u200b\u4e00\u81f4\u200b + \u200b\u4e0b\u884c\u200b\u6d88\u606f\u200b\u4e00\u81f4\u200b</p> <p>\u200b\u4e3a\u200b\u8bba\u8ff0\u200b\u65b9\u4fbf\u200b\uff0c\u200b\u4e0b\u6587\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b_\u200b\u6d88\u606f\u200b\u53ef\u7528\u200b\u6307\u200b\u7684\u200b\u662f\u200bIM\u200b\u6d88\u606f\u200b\u53ef\u7528\u6027\u200b_, \u200b\u5305\u542b\u200b\u6d88\u606f\u200b\u53ef\u9760\u6027\u200b\u548c\u200b\u4e00\u81f4\u6027\u200b\u4e24\u4e2a\u200b\u65b9\u9762\u200b</p> <p>TCP\u200b\u5176\u5b9e\u200b\u81ea\u5e26\u200b\u8d85\u65f6\u200b\u91cd\u4f20\u200b\u673a\u5236\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6d88\u606f\u200b\u53ef\u9760\u6027\u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e3a\u4ec0\u4e48\u200b\u6211\u4eec\u200b\u8fd8\u8981\u200b\u518d\u200b\u53bb\u200b\u8ba8\u8bba\u200b\u548c\u200b\u5b9e\u73b0\u200b \u200b\u6d88\u606f\u200b\u53ef\u7528\u200b \u200b\u5462\u200b\uff1f</p> <p>TCP\u200b\u7a76\u7adf\u200b\u5e2e\u52a9\u200b\u6211\u4eec\u200b\u505a\u5230\u200b\u54ea\u200b\u4e00\u6b65\u200b?</p> <ol> <li> <p>\u200b\u5ba2\u6237\u7aef\u200bA \u200b\u53d1\u9001\u200b msg1\u200b\u548c\u200bmsg2\u200b\u4e24\u4e2a\u200b\u6d88\u606f\u200b\u7ed9\u200b\u5230\u200b\u670d\u52a1\u7aef\u200b\u3002</p> </li> <li> <p>msg1\u200b\u548c\u200bmsg2\u200b\u5728\u200b\u4e00\u4e2a\u200btcp\u200b\u94fe\u63a5\u200b\u4e0a\u200b\u5230\u8fbe\u200b\u670d\u52a1\u7aef\u200b\u3002</p> </li> </ol> <p></p> <p>\u200b\u7406\u8bba\u200b\u4e0a\u200b\u6765\u8bf4\u200b\uff0cmsg1 \u200b\u548c\u200b msg2 \u200b\u662f\u200b\u9075\u5faa\u200b\u987a\u5e8f\u200b\u4ece\u200b\u5ba2\u6237\u7aef\u200b A \u200b\u53d1\u9001\u5230\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\uff0c\u200b\u4f3c\u4e4e\u200b\u6d88\u606f\u200b\u662f\u200b\u4e00\u5b9a\u200b\u6536\u5230\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u200b\u5176\u5b9e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7aef\u5230\u200b\u7aef\u200b\u53ef\u9760\u6027\u200b\u7684\u200b\u95ee\u9898\u200b\uff0cTCP \u200b\u4f5c\u4e3a\u200b\u4f20\u8f93\u5c42\u200b\u534f\u8bae\u200b\uff0c\u200b\u53ea\u80fd\u200b\u8bf4\u200b\u6d88\u606f\u200b\u53ef\u9760\u200b\u5230\u8fbe\u200b\u4e86\u200b\u4f20\u8f93\u5c42\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u8bf4\u200b\u6d88\u606f\u200b\u53ef\u9760\u200b\u5230\u8fbe\u200b\u4e86\u200b\u4e1a\u52a1\u200b\u5c42\u200b\u3002</p> <p>\u200b\u95ee\u9898\u200b</p> <ol> <li> <p>\u200b\u5728\u200b\u4f20\u9012\u200b\u7ed9\u200b\u4e1a\u52a1\u200b\u5c42\u65f6\u200b\u670d\u52a1\u7aef\u200b\u8fdb\u7a0b\u200b\u5d29\u6e83\u200b\uff0c\u200b\u4f46\u200b\u5ba2\u6237\u7aef\u200bA\u200b\u8ba4\u4e3a\u200b\u5df2\u7ecf\u200b\u9001\u8fbe\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u4e1a\u52a1\u200b\u5c42\u200b\u65e0\u200b\u611f\u77e5\u200b, \u200b\u81ea\u7136\u200b\u65e0\u6cd5\u200b\u53d1\u9001\u5230\u200b\u5ba2\u6237\u7aef\u200b B\uff0c\u200b\u56e0\u6b64\u200b\u6d88\u606f\u200b\u4e22\u5931\u200b\u3002</p> </li> <li> <p>msg1\u200b\u548c\u200bmsg2\u200b\u5230\u8fbe\u200b\u5e94\u7528\u5c42\u200b, \u200b\u89e3\u6790\u200b\u540e\u200b\u4ea4\u7531\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\u5904\u7406\u200b, \u200b\u53ef\u80fd\u200bmsg2 \u200b\u6d88\u606f\u200b\u4f53\u5c0f\u200b\u4e00\u4e9b\u200b\uff0cmsg1 \u200b\u6d88\u606f\u200b\u4f53\u5927\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e86\u200bm2 \u200b\u5148\u200b\u89e3\u6790\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u843d\u8868\u540e\u200b\u5148\u200b\u53d1\u9001\u7ed9\u200b\u5ba2\u6237\u7aef\u200b B, \u200b\u9020\u6210\u200b\u6d88\u606f\u200b\u4e71\u5e8f\u200b\u3002</p> </li> <li> <p>msg1\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u5931\u8d25\u200b\uff0cmsg2\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u6210\u529f\u200b\u5148\u200b\u53d1\u9001\u7ed9\u200b\u4e86\u200b\u5ba2\u6237\u7aef\u200bB\uff0c\u200b\u9020\u6210\u200b\u4e22\u5931\u200b\u4e14\u200b\u4e71\u5e8f\u200b\u3002</p> </li> </ol> <p>Tips</p> <p>\u200b\u6d1e\u89c1\u200b: TCP/UDP\u200b\u662f\u200b\u53cc\u65b9\u200b\u901a\u4fe1\u200b (\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b C/S \u200b\u6a21\u5f0f\u200b)\uff0c\u200b\u800c\u200bIM\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u4e09\u65b9\u200b\u901a\u4fe1\u200b\u3002</p> <p>\u200b\u6280\u672f\u200b\u6311\u6218\u200b\u5728\u200b\u54ea\u91cc\u200b?</p> <ol> <li> <p>\u200b\u4e09\u65b9\u200b\u901a\u4fe1\u200b\uff0c\u200b\u7f51\u7edc\u200b\u5c42\u9762\u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u5fc5\u8fbe\u200b\u3002</p> </li> <li> <p>\u200b\u6ca1\u6709\u200b\u5168\u5c40\u200b\u65f6\u949f\u200b\uff0c\u200b\u786e\u5b9a\u200b\u552f\u4e00\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4e14\u200b\u662f\u200b\u7b26\u5408\u200b\u56e0\u679c\u200b\u987a\u5e8f\u200b\u7684\u200b\u3002</p> </li> <li> <p>\u200b\u591a\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b/\u200b\u591a\u200b\u670d\u52a1\u7aef\u200b\u63a5\u6536\u200b\u6d88\u606f\u200b/\u200b\u591a\u7ebf\u7a0b\u200b\u591a\u534f\u7a0b\u200b\u5904\u7406\u200b\u6d88\u606f\u200b\uff0c\u200b\u987a\u5e8f\u200b\u96be\u4ee5\u786e\u5b9a\u200b\u3002</p> </li> </ol>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#_3","title":"\u65b9\u6848\u200b\u9009\u578b","text":"<p>\u200b\u53ca\u65f6\u6027\u200b,\u200b\u53ef\u8fbe\u6027\u200b,\u200b\u5e42\u200b\u7b49\u200b\u6027\u200b,\u200b\u65f6\u5e8f\u200b\u6027\u200b</p>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#1","title":"1. \u200b\u6d88\u606f\u200b\u53ca\u65f6\u200b: \u200b\u670d\u52a1\u7aef\u200b\u5b9e\u65f6\u200b\u63a5\u6536\u200b\u6d88\u606f\u200b\u5e76\u200b\u5b9e\u65f6\u200b\u5728\u7ebf\u200b\u53d1\u9001\u200b\u3002","text":"<p>\u200b\u53ca\u65f6\u6027\u200b\u5f3a\u8c03\u200b\u5ba2\u6237\u7aef\u200b\u53cc\u65b9\u200b\u8fdb\u884c\u200b\u7aef\u5230\u200b\u7aef\u200b\u901a\u4fe1\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u80fd\u591f\u200b\u5728\u200b 200ms \u200b\u4ee5\u5185\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4e00\u65e6\u200b\u4e00\u4e2a\u200b\u529f\u80fd\u200b\u8d85\u8fc7\u200b 200ms\uff0c\u200b\u7528\u6237\u200b\u5c31\u200b\u4f1a\u200b\u611f\u77e5\u200b\u5230\u200b\u5ef6\u8fdf\u200b\u73b0\u8c61\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u4e00\u4e9b\u200b\u5927\u89c4\u6a21\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6bd4\u5982\u8bf4\u200b_\u200b\u7f51\u7edc\u200b\u7684\u200b\u9ad8\u5cf0\u671f\u200b\uff0c\u200b\u6216\u8005\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u6bd4\u8f83\u200b\u9ad8\u200b_\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5141\u8bb8\u200b p99 \u200b\u8fbe\u5230\u200b 1 \u200b\u79d2\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b 1 \u200b\u79d2\u200b\uff0c\u200b\u7528\u6237\u200b\u5c31\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u6536\u53d1\u200b\u6d88\u606f\u200b\u975e\u5e38\u200b\u5361\u987f\u200b\u3002</p>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#2-ack","title":"2. \u200b\u6d88\u606f\u200b\u53ef\u200b\u8fbe\u200b: \u200b\u8d85\u65f6\u200b\u91cd\u8bd5\u200b\uff0cACK\u200b\u786e\u8ba4\u200b\u3002","text":"<p>\u200b\u7c7b\u4f3c\u200b TCP \u200b\u534f\u8bae\u200b\u901a\u8fc7\u200b \u200b\u8d85\u65f6\u200b\u91cd\u8bd5\u200b \u200b\u548c\u200b ACK \u200b\u786e\u8ba4\u200b \u200b\u673a\u5236\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u7684\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\uff0c\u200b\u540c\u6837\u200b\u53ef\u4ee5\u200b\u91c7\u53d6\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u673a\u5236\u200b\u6765\u200b\u4fdd\u8bc1\u200b \u200b\u6d88\u606f\u200b\u53ef\u8fbe\u6027\u200b\u3002</p> <p></p> <p>\u200b\u6d88\u606f\u4f20\u9012\u200b\u6d41\u7a0b\u200b</p> <ol> <li> <p>\u200b\u5ba2\u6237\u7aef\u200b A \u200b\u5230\u200b\u670d\u52a1\u7aef\u200b\uff1a</p> <ul> <li> <p>\u200b\u5ba2\u6237\u7aef\u200b A \u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u5230\u200b\u670d\u52a1\u7aef\u200b\u3002</p> </li> <li> <p>\u200b\u670d\u52a1\u7aef\u200b\u5c06\u200b\u6d88\u606f\u200b \u200b\u5148\u843d\u5e93\u200b\uff08\u200b\u5b58\u5165\u200b\u6570\u636e\u5e93\u200b\uff09\u3002\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5373\u4fbf\u200b\u670d\u52a1\u7aef\u200b\u5d29\u6e83\u200b\uff0c\u200b\u6d88\u606f\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u4e22\u5931\u200b\u3002</p> </li> <li> <p>\u200b\u4e00\u65e6\u200b\u6d88\u606f\u200b\u6210\u529f\u200b\u5199\u5165\u200b\u6570\u636e\u5e93\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u4f1a\u200b\u8fd4\u56de\u200b ACK \u200b\u786e\u8ba4\u200b \u200b\u7ed9\u200b\u5ba2\u6237\u7aef\u200b A\uff0c\u200b\u8868\u793a\u200b\u6d88\u606f\u200b\u5df2\u200b\u6210\u529f\u200b\u63a5\u6536\u200b\uff0c\u200b\u65e0\u9700\u200b\u91cd\u200b\u53d1\u200b\u3002</p> </li> </ul> </li> <li> <p>\u200b\u6d88\u606f\u200b\u4f20\u8f93\u200b\u5931\u8d25\u200b\u7684\u200b\u91cd\u8bd5\u200b\u673a\u5236\u200b\uff1a</p> <ul> <li> <p>\u200b\u5982\u679c\u200b\u5ba2\u6237\u7aef\u200b A \u200b\u6ca1\u6709\u200b\u6536\u5230\u200b ACK \u200b\u786e\u8ba4\u200b\uff0c\u200b\u5373\u200b\u8bf4\u660e\u200b\u6d88\u606f\u200b\u672a\u200b\u6210\u529f\u200b\u4f20\u8f93\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b A \u200b\u4f1a\u200b\u542f\u52a8\u200b \u200b\u5b9a\u65f6\u5668\u200b\uff0c\u200b\u5b9a\u671f\u68c0\u67e5\u200b\u662f\u5426\u200b\u8d85\u65f6\u200b\u3002</p> </li> <li> <p>\u200b\u5982\u679c\u200b\u8d85\u65f6\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b A \u200b\u4f1a\u200b\u91cd\u65b0\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u3002</p> </li> <li> <p>\u200b\u6d88\u606f\u200b\u518d\u6b21\u200b\u5230\u8fbe\u200b\u670d\u52a1\u7aef\u200b\u540e\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u4f1a\u200b\u518d\u6b21\u200b\u5199\u5165\u200b\u6570\u636e\u5e93\u200b\u5e76\u200b\u8fd4\u56de\u200b ACK\u3002</p> </li> </ul> </li> <li> <p>\u200b\u6d88\u606f\u200b\u5230\u8fbe\u200b\u5ba2\u6237\u7aef\u200b B \u200b\u7684\u200b\u6d41\u7a0b\u200b\uff1a</p> <ul> <li> <p>\u200b\u670d\u52a1\u7aef\u200b\u5728\u200b\u6210\u529f\u200b\u5b58\u50a8\u200b\u6d88\u606f\u200b\u540e\u200b\uff0c\u200b\u5f00\u59cb\u200b\u5c06\u200b\u6d88\u606f\u200b\u53d1\u9001\u7ed9\u200b\u5ba2\u6237\u7aef\u200b B\u3002</p> </li> <li> <p>\u200b\u5ba2\u6237\u7aef\u200b B \u200b\u5728\u200b\u63a5\u6536\u200b\u6d88\u606f\u200b\u65f6\u200b\u4e5f\u200b\u4f1a\u200b\u6267\u884c\u200b ACK \u200b\u786e\u8ba4\u200b\u3002</p> </li> <li> <p>\u200b\u5982\u679c\u200b\u5ba2\u6237\u7aef\u200b B \u200b\u53d1\u9001\u200b\u7684\u200b ACK \u200b\u4e22\u5931\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b \u200b\u91cd\u200b\u53d1\u200b\u673a\u5236\u200b\uff0c\u200b\u91cd\u65b0\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\uff0c\u200b\u76f4\u5230\u200b\u63a5\u6536\u200b\u5230\u200b ACK \u200b\u786e\u8ba4\u200b\u3002</p> </li> </ul> </li> <li> <p>\u200b\u4e22\u5931\u200b ACK \u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <ul> <li> <p>\u200b\u5982\u679c\u200b\u5ba2\u6237\u7aef\u200b B \u200b\u6536\u5230\u200b\u6d88\u606f\u200b\u540e\u200b\uff0cACK \u200b\u786e\u8ba4\u200b\u4e22\u5931\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b B \u200b\u4f1a\u200b\u91cd\u65b0\u200b\u53d1\u9001\u200b ACK\u3002</p> </li> <li> <p>\u200b\u670d\u52a1\u7aef\u200b\u6536\u5230\u200b\u65b0\u200b\u7684\u200b ACK \u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b \u200b\u53d6\u6d88\u200b\u5b9a\u65f6\u5668\u200b\uff0c\u200b\u505c\u6b62\u200b\u91cd\u200b\u53d1\u6d88\u606f\u200b\u3002</p> </li> </ul> </li> </ol>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#5-seqidseqid","title":"5. \u200b\u6d88\u606f\u200b\u5e42\u200b\u7b49\u200b: \u200b\u5206\u914d\u200bseqID\uff0c\u200b\u670d\u52a1\u7aef\u200b\u5b58\u50a8\u200bseqID\u3002","text":"","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#6-seqid","title":"6. \u200b\u6d88\u606f\u200b\u6709\u5e8f\u200b: seqID\u200b\u53ef\u200b\u6bd4\u8f83\u200b,\u200b\u63a5\u6536\u7aef\u200b\u80fd\u200b\u6309\u200b\u53d1\u9001\u200b\u7aef\u7684\u200b\u987a\u5e8f\u200b\u5bf9\u200b\u6d88\u606f\u200b\u6392\u5e8f\u200b\u3002","text":"<p>\u200b\u6d88\u606f\u200b\u5e42\u200b\u7b49\u200b\u4e0e\u200b\u6d88\u606f\u200b\u6709\u5e8f\u200b\u7684\u200b\u89e3\u51b3\u200b\u601d\u8def\u200b\u5373\u200b\u4e3a\u200b\u6d88\u606f\u200b\u5206\u914d\u200b ID\uff0c\u200b\u5c06\u200b\u5728\u4e0b\u6587\u200b\u4e2d\u200b\u8be6\u7ec6\u200b\u8ba8\u8bba\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u7b80\u8981\u200b\u9610\u8ff0\u200b \u200b\u6d88\u606f\u200bID \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u903b\u8f91\u200b</p> Text Only<pre><code>connID/clientID/seqID/sessionID/msgID\n</code></pre> <p>\u200b\u5982\u679c\u8bf4\u200b\u4ec5\u4ec5\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b <code>messageID</code> \u200b\u53bb\u200b\u5b9e\u73b0\u200b\u5404\u79cd\u200b\u529f\u80fd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b\u975e\u5e38\u200b\u9ad8\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u964d\u4f4e\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u590d\u6742\u5ea6\u200b\uff0c<code>\u200b\u6d88\u606f\u200bID</code> \u200b\u53ef\u4ee5\u200b\u6309\u7167\u200b\u6d88\u606f\u200b\u7684\u200b\u4e0d\u540c\u200b\u7528\u9014\u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u79cd\u200b ID\uff0c\u200b\u867d\u7136\u200b\u5728\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u4e0a\u200b\u6709\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6d6a\u8d39\u200b\uff0c\u200b\u4f46\u662f\u200bID \u200b\u8bbe\u8ba1\u65b9\u6848\u200b\u7684\u200b\u590d\u6742\u5ea6\u200b\u53ef\u4ee5\u200b\u964d\u4f4e\u200b\u5f88\u591a\u200b\u3002</p> <ol> <li> <p><code>clientID</code>: <code>clientID</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u94fe\u63a5\u200b\u7ea7\u522b\u200b\u7684\u200b ID\uff0c\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u4e0e\u200b\u670d\u52a1\u7aef\u200b\u5efa\u7acb\u200b\u94fe\u63a5\u200b\u540e\u200b <code>clientId</code> \u200b\u88ab\u200b\u6b63\u5f0f\u200b\u521d\u59cb\u5316\u200b\u4e3a\u200b 0\uff0c\u200b\u5f3a\u8c03\u200b\u7684\u200b\u662f\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u65b9\u200b\u6d88\u606f\u200b\u7684\u200b\u903b\u8f91\u200b\u987a\u5e8f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u987a\u5e8f\u200b\u7531\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u89e6\u53d1\u200b\u548c\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u5b8c\u5168\u7b26\u5408\u200b\u4e8e\u200b\u7528\u6237\u200b\uff0c\u200b\u540c\u65f6\u200b id \u200b\u5927\u5c0f\u200b\u4e0e\u200b\u7528\u6237\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u7684\u200b\u5148\u540e\u200b\u6709\u5173\u200b\u3002\u200b\u4f46\u662f\u200b\u5728\u200b\u7fa4\u804a\u200b\u573a\u666f\u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7528\u6237\u200b\u7684\u200b <code>clientID</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u504f\u5e8f\u200b\uff0c\u200b\u53ea\u80fd\u200b\u4fdd\u8bc1\u200b\u81ea\u8eab\u200b\u7684\u200b\u6709\u5e8f\u6027\u200b(\u200b\u5c40\u90e8\u200b\u6709\u5e8f\u200b)\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5168\u5c40\u200b\u6709\u5e8f\u200b\u3002\u200b\u6240\u4ee5\u200b\u5728\u200b\u670d\u52a1\u7aef\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u7528\u200b <code>clientID</code> \u200b\u505a\u200b\u6d88\u606f\u200b\u6c47\u603b\u200b\u548c\u200b\u6d88\u606f\u200b\u8f6c\u53d1\u200b\u3002\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u5168\u5c40\u200b\u6709\u5e8f\u200b\u7684\u200b ID\uff0c\u200b\u5373\u200b <code>seqID</code>\u3002( \u200b\u9700\u8981\u200b\u8865\u5145\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u53ef\u4ee5\u200b\u8fd9\u6837\u200b\u8bbe\u8ba1\u200b\uff1f\u200b\u539f\u56e0\u200b\u5728\u4e8e\u200b TCP \u200b\u5728\u200b 4 \u200b\u6b21\u200b\u6325\u624b\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b 2MSL \u200b\u7684\u200b TIME_WAIT\uff0c\u200b\u4fdd\u8bc1\u200b\u4e0a\u200b\u4e00\u4e2a\u200b TCP \u200b\u94fe\u63a5\u200b\u7684\u200b\u6d88\u606f\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b TCP \u200b\u94fe\u63a5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u8fd9\u4e48\u200b\u8bf4\u200b\uff0c<code>clientID</code> \u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u662f\u4ece\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u7ed9\u200b\u670d\u52a1\u7aef\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u63a5\u6536\u200b\u4e3a\u6b62\u200b\uff0c\u200b\u8fd9\u4e2a\u200b clientID \u200b\u5c31\u200b\u6ca1\u6709\u200b\u610f\u4e49\u200b\u4e86\u200b )</p> </li> <li> <p><code>sessionID</code>\uff1a<code>sessionID</code> \u200b\u5373\u200b\u4e3a\u200b\u4f1a\u200b\u8bdd\u200b ID\uff0c\u200b\u7528\u4e8e\u200b\u6807\u8bc6\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u4f1a\u200b\u8bdd\u200b\u3002\u200b\u539f\u56e0\u200b\u662f\u200b\u5728\u200b\u7528\u6237\u200b\u7684\u200b\u804a\u5929\u200b\u754c\u9762\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u591a\u4e2a\u200b\u4f1a\u8bdd\u200b\uff0c\u200b\u800c\u200b\u6d88\u606f\u200b\u7684\u200b\u65f6\u95f4\u200b\u7ebf\u200b\u6392\u5e8f\u200b\uff0c\u200b\u662f\u200b\u5bf9\u4e8e\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u4f1a\u8bdd\u200b\u6765\u8bf4\u200b\u7684\u200b\uff0c\u200b\u540c\u65f6\u200b <code>sessionID</code> \u200b\u4e5f\u200b\u8d77\u5230\u200b\u5e2e\u52a9\u200b\u670d\u52a1\u7aef\u200b\u627e\u5230\u200b\u6d88\u606f\u200b\u6240\u5728\u200b\u7684\u200b\u4f1a\u200b\u8bdd\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u5411\u200b\u670d\u52a1\u7aef\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u65f6\u8981\u200b\u4f20\u9012\u200b <code>clientID</code> \u200b\u548c\u200b <code>sessionID</code>\u3002</p> </li> <li> <p><code>seqID</code> : <code>seqID</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f1a\u8bdd\u200b\u7ea7\u522b\u200b\u7684\u200b ID\uff0c\u200b\u672c\u8d28\u200b\u4e0a\u200b\u8d77\u5230\u200b\u4e24\u4e2a\u200b\u4f5c\u7528\u200b\uff0c\u200b\u4e00\u662f\u200b\u4fdd\u8bc1\u200b\u552f\u4e00\u6027\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u5e42\u200b\u7b49\u200b\uff0c\u200b\u4e8c\u662f\u200b\u4fdd\u8bc1\u200b\u6709\u5e8f\u6027\u200b (\u200b\u5c06\u200b\u5ba2\u6237\u7aef\u200b\u6d88\u606f\u200b\u7684\u200b\u987a\u5e8f\u200b\u6027\u200b\u4f20\u9012\u200b\u5230\u200b\u670d\u52a1\u7aef\u200b)\u3002 <code>seqID</code> \u200b\u7531\u200b\u670d\u52a1\u7aef\u200b\u7ef4\u62a4\u200b\u5e76\u200b\u5206\u53d1\u200b\uff0c\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u4f1a\u8bdd\u200b\u6240\u200b\u7279\u6709\u200b\u7684\u200b\uff0c\u200b\u5177\u4f53\u8868\u73b0\u200b\u4e3a\u200b\uff0c\u200b\u5728\u200b Redis \u200b\u4e2d\u4ee5\u200b <code>msg:{sessionID}:seqID - int64</code> \u200b\u683c\u5f0f\u200b\u5b58\u50a8\u200b\uff0c\u200b\u5176\u4e2d\u200b <code>sessionID</code> \u200b\u4e3a\u200b\u53ef\u200b\u53d8\u91cf\u200b\uff0c <code>value</code> \u200b\u901a\u8fc7\u200b <code>lua</code> \u200b\u811a\u672c\u200b <code>incrby</code> \u3002\u200b\u5982\u679c\u200b <code>seqID</code> \u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u5168\u5c40\u53d8\u91cf\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5b58\u5728\u200b\u5355\u70b9\u200b\u95ee\u9898\u200b\uff0cRedis \u200b\u7684\u200b\u4e0a\u9650\u200b\u4e3a\u200b\u5341\u4e07\u200b QPS\uff0c\u200b\u800c\u200b\u6d88\u606f\u200b\u8f6c\u53d1\u200b\u53ef\u80fd\u200b\u8fdc\u5927\u4e8e\u200b 10 \u200b\u4e07\u200b QPS \u200b\u7684\u200b\u91cf\u7ea7\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f15\u5165\u200b <code>sessionID</code> \u200b\u5219\u200b\u53ef\u4ee5\u200b\u663e\u8457\u200b\u964d\u4f4e\u200b\u95ee\u9898\u200b\u53d1\u751f\u200b\u7684\u200b\u53ef\u80fd\u6027\u200b\uff0c\u200b\u4e00\u79cd\u200b\u65b9\u6848\u200b\u662f\u200b\u6839\u636e\u200b <code>sessionID</code> \u200b\u505a\u200b Redis \u200b\u96c6\u7fa4\u200b\u5206\u7247\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u6c34\u5e73\u200b\u6269\u5c55\u200b\u3002</p> </li> <li> <p><code>msgID</code> : <code>msgID</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u5e94\u7528\u200b\u7ea7\u522b\u200b\u7684\u200b ID\uff0c\u200b\u4f5c\u7528\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u7684\u200b\u5168\u5c40\u200b\u552f\u4e00\u6027\u200b\u3002\u200b\u751f\u6210\u200b\u65b9\u6848\u200b\u53ef\u4ee5\u200b\u662f\u200b\u96ea\u82b1\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>seqID + sessionID</code> \u200b\u901a\u8fc7\u200b\u67d0\u79cd\u200b\u7b97\u6cd5\u200b\u53d8\u6362\u200b\u5f97\u5230\u200b\u3002</p> </li> </ol> <p>\u200b\u5bf9\u200b <code>seqID</code> \u200b\u505a\u200b\u4e00\u4e9b\u200b\u8865\u5145\u200b\u3002</p> <p><code>seqID</code> \u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\u4e07\u6709\u200b\u4e00\u5931\u200b\u7684\u200b\u4e25\u683c\u200b\u9012\u589e\u200b\uff0c\u200b\u5904\u4e8e\u200b\u4e25\u683c\u200b\u9012\u589e\u200b\u548c\u200b\u8d8b\u52bf\u200b\u9012\u589e\u200b\u7684\u200b\u4e2d\u95f4\u200b\u6001\u200b\u3002\u200b\u5728\u200b\u4e00\u4e2a\u200b\u8f83\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u5185\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e25\u683c\u200b\u9012\u589e\u200b\u662f\u200b\u975e\u5e38\u200b\u56f0\u96be\u200b\u7684\u200b\u3002\u200b\u901a\u8fc7\u200b redis \u200b\u4e3e\u4f8b\u200b\u9610\u8ff0\u200b\uff0credis \u200b\u5b58\u5728\u200b\u4e3b\u4ece\u200b\u8282\u70b9\u200b\uff0c\u200b\u5e76\u200b\u901a\u8fc7\u200b pull \u200b\u6a21\u5f0f\u200b\u8fdb\u884c\u200b\u4e3b\u4ece\u200b\u540c\u6b65\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4ece\u200b\u8282\u70b9\u200b\u5bf9\u4e3b\u200b\u8282\u70b9\u200b\u53d1\u8d77\u200b pull\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b <code>seqID</code> \u200b\u4e3a\u200b <code>1000</code>\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u77ac\u95f4\u200b master \u200b\u8282\u70b9\u200b\u5f02\u6b65\u200b\u5730\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b <code>seqID</code> \u200b\u5e76\u200b\u81ea\u200b\u589e\u5230\u200b <code>1001</code> \u200b\u5e76\u4e14\u200b\u53d1\u751f\u200b\u4e86\u200b\u5355\u70b9\u6545\u969c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u751f\u200b\u4e3b\u4ece\u200b\u5207\u6362\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u51fa\u73b0\u200b\u4e86\u200b 2 \u200b\u6b21\u503c\u200b\u4e3a\u200b <code>1000</code> \u200b\u7684\u200b <code>seqID</code> \u200b\u5206\u914d\u200b\u5230\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u6d88\u606f\u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u73b0\u8c61\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u56de\u9000\u200b\u3002</p> <p>\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b lua \u200b\u811a\u672c\u200b\u64cd\u63a7\u200b redis\uff0c\u200b\u5e76\u200b\u901a\u8fc7\u200b <code>runid</code> \u200b\u5224\u65ad\u200b\u4e3b\u4ece\u200b\u8282\u70b9\u200b</p> <ol> <li> <p>\u200b\u7b2c\u4e00\u6b21\u200b\u67e5\u8be2\u200b\u65f6\u200b\uff0c\u200b\u9996\u5148\u200b <code>\uff0c\u200b\u5982\u679c\u200b\u83b7\u53d6\u200b\u5230\u200b\u7684\u200b \uff0c\u200b\u5982\u679c\u200b\u83b7\u53d6\u200b\u5230\u200b\u7684\u200b \u200b\u5230\u200b\u7684\u200b</code>runid<code>\u200b\u548c\u200b\u4e4b\u524d\u200b\u7684\u200b</code>runid<code>\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b</code>incrby<code>\u200b\u5e76\u200b\u8fd4\u56de\u200b</code>seqID`</p> </li> <li> <p>\u200b\u5982\u679c\u200b\u53d1\u751f\u200b\u4e86\u200b\u4e3b\u4ece\u200b\u5207\u6362\u200b\uff0c\u200b\u90a3\u4e48\u200b\u83b7\u53d6\u200b\u5230\u200b\u7684\u200b <code>runid</code> \u200b\u662f\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u56de\u9000\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ed9\u200b\u5f53\u524d\u200b\u7684\u200b <code>seqID</code> \u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u504f\u79fb\u200b\u503c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\u6233\u200b\u7b49\u200b\u5e45\u5ea6\u200b\u8f83\u5927\u200b\u7684\u200b\u6570\u503c\u200b\uff0c\u200b\u7528\u200b\u8fd9\u6bb5\u200b\u8df3\u53d8\u200b\u9632\u6b62\u200b\u53d1\u751f\u200b\u56de\u9000\u200b\uff0c\u200b\u4e14\u200b\u80fd\u200b\u4fdd\u8bc1\u200b\u552f\u4e00\u6027\u200b\uff0c\u200b\u800c\u200b\u56e0\u4e3a\u200b redis \u200b\u7684\u200b\u4e3b\u4ece\u200b\u5207\u6362\u200b\u7684\u200b\u9891\u7387\u200b\u5e76\u200b\u4e0d\u200b\u9ad8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b 99% \u200b\u7684\u200b\u65f6\u95f4\u200b\u5185\u200b\u90fd\u200b\u662f\u200b\u4e25\u683c\u200b\u9012\u589e\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u79f0\u5176\u4e3a\u200b\u4e07\u6709\u200b\u4e00\u5931\u200b\u7684\u200b\u4e25\u683c\u200b\u9012\u589e\u200b</p> </li> </ol> <p>\u200b\u4f46\u662f\u200b\u4e0a\u8ff0\u200b\u89e3\u51b3\u65b9\u6848\u200b\u53c8\u200b\u5f15\u51fa\u200b\u4e86\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u4e07\u6709\u200b\u4e00\u5931\u200b\u7684\u200b\u4e25\u683c\u200b\u9012\u589e\u200b\u80fd\u591f\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u56de\u9000\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u8df3\u53d8\u200b(\u200b\u79f0\u5176\u4e3a\u200b\u6d88\u606f\u200b\u6f0f\u6d1e\u200b)\uff0c\u200b\u90a3\u4e48\u200b\u5ba2\u6237\u7aef\u200b\u5e94\u8be5\u200b\u5982\u4f55\u200b\u8bc6\u522b\u200b\u8fd9\u4e2a\u200b\u8df3\u53d8\u200b\u662f\u200b\u4e3b\u4ece\u200b\u5207\u6362\u200b\u5f15\u8d77\u200b\u7684\u200b\u8fd8\u662f\u200b\u6d88\u606f\u200b\u4e22\u5931\u200b\u5f15\u8d77\u200b\u7684\u200b\uff1f</p> <p>\u200b\u89e3\u51b3\u65b9\u6848\u200b\u4e5f\u200b\u8f83\u4e3a\u7b80\u5355\u200b\uff0c\u200b\u5f53\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u73b0\u200b\u51fa\u73b0\u200b\u4e86\u200b\u6d88\u606f\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u5373\u200b\u6d88\u606f\u200b ID \u200b\u4e0d\u200b\u8fde\u7eed\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u5411\u200b\u670d\u52a1\u7aef\u200b\u4e3b\u52a8\u200b\u62c9\u53d6\u200b\u4e00\u4e2a\u200b\u5206\u9875\u200b\u7684\u200b\u5386\u53f2\u200b\u6d88\u606f\u200b\u8bf7\u6c42\u200b(\u200b\u79f0\u5176\u4e3a\u200b\u6d88\u606f\u200b\u8865\u6d1e\u200b)\uff0c\u200b\u901a\u8fc7\u200b\u8fd9\u79cd\u200b\u63a8\u62c9\u200b\u7ed3\u5408\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u8fdb\u884c\u200b\u5bf9\u6bd4\u200b\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5224\u65ad\u200b\u662f\u200b\u53d1\u751f\u200b\u4e86\u200b\u4e3b\u4ece\u200b\u5207\u6362\u200b\u8fd8\u662f\u200b\u6d88\u606f\u200b\u4e22\u5931\u200b\u4e86\u200b\u3002</p>","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#_4","title":"\u4e0a\u884c\u200b\u6d88\u606f","text":"<p>\u200b\u5ba2\u6237\u7aef\u200bA\u200b\u5c06\u200b\u6d88\u606f\u200b\u53d1\u9001\u7ed9\u200b\u670d\u52a1\u7aef\u200b\uff0c\u200b\u8fd9\u4e00\u200b\u9636\u6bb5\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u4ece\u200b\u5ba2\u6237\u7aef\u200b\u5230\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u53ef\u7528\u6027\u200b\u3002</p> \u200b\u65b9\u6848\u200b \u200b\u6536\u76ca\u200b \u200b\u4ee3\u4ef7\u200b clientID \u200b\u4e25\u683c\u200b\u9012\u589e\u200b1. \u200b\u5ba2\u6237\u7aef\u200bA\u200b\u521b\u5efa\u200b\u4f1a\u8bdd\u200b\u4e0e\u200b\u670d\u52a1\u7aef\u200b\u5efa\u7acb\u200b\u957f\u200b\u8fde\u63a5\u200b 2. \u200b\u5728\u200b\u53d1\u9001\u200b\u6d88\u606f\u200bmsg1\u200b\u65f6\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200bclientID \u200b\u6b64\u503c\u200b\u5728\u200b\u4f1a\u200b\u8bdd\u200b\u5185\u200b\u4e25\u683c\u200b\u9012\u589e\u200b 3. \u200b\u8fde\u63a5\u200b\u5efa\u7acb\u200b\u65f6\u200b clientID \u200b\u521d\u59cb\u200b\u4e3a\u200b0\u3002 4. \u200b\u670d\u52a1\u7aef\u200b\u5c06\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u6536\u5230\u200b\u6d88\u606f\u200b\u7684\u200bclientID\u200b\u7f13\u5b58\u200b\u4e3a\u200bpreClientID\uff0c\u200b\u5f53\u4e14\u200b\u4ec5\u200b\u5f53\u200b<code>clientID == preClientID + 1</code>\u200b\u65f6\u200b\u63a5\u6536\u200b\u6b64\u200b\u6d88\u606f\u200b(\u200b\u4fdd\u8bc1\u200b\u5e42\u200b\u7b49\u200b) 5. \u200b\u4ec5\u5f53\u200b\u670d\u52a1\u7aef\u200b\u63a5\u6536\u200b\u5230\u200b\u6d88\u606f\u200b\u540e\u200b\u624d\u200b\u56de\u590d\u200b\u5ba2\u6237\u7aef\u200bA\uff0cACK\u200b\u6d88\u606f\u200b 6. \u200b\u4ec5\u5f53\u200b\u5ba2\u6237\u7aef\u200bA\u200b\u6536\u5230\u200b\u670d\u52a1\u7aef\u200b\u5bf9\u200b\u6d88\u606f\u200bACK\u200b\u7684\u200b\u56de\u590d\u200b\uff0c\u200b\u624d\u200b\u7981\u6b62\u200b\u91cd\u200b\u53d1\u200b(\u200b\u53ef\u200b\u8bbe\u7f6e\u200b\u6700\u200b\u591a\u200b\u4e09\u6b21\u200b) 1. \u200b\u4efb\u610f\u200b\u65f6\u523b\u200b\u4ec5\u200b\u5b58\u50a8\u200b\u4e00\u4e2a\u200b\u6d88\u606f\u200bID 2. \u200b\u4fdd\u8bc1\u200b\u4e25\u683c\u200b\u7684\u200b\u6709\u5e8f\u6027\u200b 3. \u200b\u5b9e\u73b0\u200b\u7b80\u5355\u200b\uff0c\u200b\u53ef\u7528\u200b 4. \u200b\u957f\u200b\u8fde\u63a5\u200b\u901a\u4fe1\u200b\u5ef6\u8fdf\u200b\u4f4e\u200b 5. \u200b\u4ee5\u200b\u53d1\u9001\u200b\u65b9\u200b\u987a\u5e8f\u200b\u4e3a\u200b\u6807\u51c6\u200b(\u200b\u6743\u8861\u200b) 1. \u200b\u5f31\u7f51\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6d88\u606f\u200b\u4e22\u5305\u200b\u4e25\u91cd\u200b\u65f6\u200b\u5c06\u200b\u9020\u6210\u200b\u5927\u89c4\u6a21\u200b\u6d88\u606f\u200b\u91cd\u200b\u53d1\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7f51\u7edc\u200b\u762b\u75ea\u200b\u5f71\u54cd\u200b\u6d88\u606f\u200b\u53ca\u65f6\u6027\u200b\u3002 2. \u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u7fa4\u804a\u200b\u4e2d\u200b\u7684\u200b\u6d88\u606f\u200b\u56e0\u679c\u200b\u987a\u5e8f\u200b \u200b\u5f31\u7f51\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4f18\u5316\u200b\u4f20\u8f93\u5c42\u200b\u534f\u8bae\u200b(\u200b\u6bd4\u5982\u200b\u534f\u8bae\u200b\u5347\u7ea7\u200b\u4e3a\u200bQuic)\u200b\u6765\u200b\u4f18\u5316\u200b\uff0c\u200b\u957f\u200b\u8fde\u63a5\u200b\u4e0d\u200b\u9002\u5408\u200b\u5728\u200b\u5f31\u200b\u7f51\u200b\u73af\u5883\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4e22\u5305\u200b\u548c\u200b\u65ad\u7ebf\u200b \u200b\u5c5e\u4e8e\u200b\u4f20\u8f93\u5c42\u200b\u95ee\u9898\u200b\u3002 clientID \u200b\u94fe\u8868\u200b1. \u200b\u5ba2\u6237\u7aef\u200bA\u200b\u4f7f\u7528\u200b\u672c\u5730\u200b\u65f6\u95f4\u200b\u6233\u200b\u4f5c\u4e3a\u200bclientID\uff0c\u200b\u5e76\u200b\u5728\u200b\u6bcf\u6b21\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u7684\u200b\u65f6\u5019\u200b\u643a\u5e26\u200b\u4e0a\u200b\u4e2a\u200b\u6d88\u606f\u200b\u7684\u200bclientID\u3002 2. \u200b\u670d\u52a1\u7aef\u200b\u5b58\u50a8\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u6d88\u606f\u200b\u7684\u200bclientID\u200b\u8bb0\u200b\u4f5c\u4e3a\u200bpreClientID\uff0c\u200b\u53ea\u6709\u200bpreClientID \u200b\u548c\u200b \u200b\u5f53\u524d\u200b\u6d88\u606f\u200b\u7684\u200bpreClientID\u200b\u5bf9\u6bd4\u200b\uff0c\u200b\u5339\u914d\u200b\u4e0a\u200b\u5219\u200b\u8bf4\u660e\u200b\u6d88\u606f\u200b\u672a\u200b\u4e22\u5931\u200b\uff0c\u200b\u5426\u5219\u200b\u62d2\u7edd\u200b\u3002 1. \u200b\u534f\u8bae\u200b\u7684\u200b\u6d88\u606f\u200b\u5e26\u5bbd\u200b clientID list1. \u200b\u670d\u52a1\u7aef\u200b\u9488\u5bf9\u200b\u6bcf\u4e2a\u200b\u8fde\u63a5\u200b\u5b58\u50a8\u200b\u591a\u4e2a\u200bclientID\uff0c\u200b\u5f62\u6210\u200bclientID list 2. \u200b\u4f7f\u7528\u200b\u6b64\u200b client List\u200b\u4f5c\u4e3a\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\uff0c\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u5e42\u200b\u7b49\u200b 1. \u200b\u51cf\u5c11\u200b\u5f31\u7f51\u200b\u91cd\u4f20\u200b\u65f6\u200b\u7684\u200b\u6d88\u606f\u200b\u98ce\u66b4\u200b\u95ee\u9898\u200b 1. \u200b\u5b9e\u73b0\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b 2. \u200b\u7f51\u5173\u200b\u5c42\u200b\u9700\u8981\u200b\u66f4\u200b\u591a\u200b\u5185\u5b58\u200b\u7ef4\u62a4\u200b\u8fde\u63a5\u200b\u72b6\u6001\u200b 3. \u200b\u7531\u4e8e\u200b\u4f20\u8f93\u5c42\u200b\u4f7f\u7528\u200btcp\uff0c\u200b\u5df2\u7ecf\u200b\u5bf9\u5f31\u200b\u7f51\u6709\u200b\u4e00\u5b9a\u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u5e94\u7528\u5c42\u200b\u4e5f\u200b\u7ef4\u62a4\u200b\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u6536\u76ca\u200b\u4e0d\u200b\u5927","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#_5","title":"\u6d88\u606f\u200b\u8f6c\u53d1","text":"<p>\u200b\u5206\u914d\u200bseqID\uff0c\u200b\u5f02\u6b65\u200b\u5b58\u50a8\u200b\u6d88\u606f\u200b\uff0c\u200b\u5904\u7406\u200b\u4e1a\u52a1\u200b\u903b\u8f91\u200b\uff0c\u200b\u5c06\u200b\u6d88\u606f\u200b\u8f6c\u53d1\u7ed9\u200b\u5ba2\u6237\u7aef\u200bB\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u5206\u914d\u200bseqID?</p> <p>IM\u200b\u573a\u666f\u200b\u4e2d\u200b\u804a\u5929\u200b\u4f1a\u8bdd\u200b\u81f3\u5c11\u200b\u6709\u200b\u4e24\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u53c2\u4e0e\u200b(\u200b\u5355\u804a\u200b/\u200b\u7fa4\u804a\u200b),\u200b\u56e0\u6b64\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u5206\u914d\u200b\u7684\u200bclientID\u200b\u90fd\u200b\u4e0d\u80fd\u200b\u4f5c\u4e3a\u200b\u6574\u4e2a\u200b\u4f1a\u8bdd\u200b\u5185\u200b\u7684\u200b\u6d88\u606f\u200bID\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u4ea7\u751f\u200b\u987a\u5e8f\u200b\u51b2\u7a81\u200b\uff0c\u200b\u56e0\u6b64\u200bclientID\u200b\u4ec5\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u6309\u200b\u5ba2\u6237\u7aef\u200bA\u200b\u53d1\u9001\u200b\u7684\u200b\u987a\u5e8f\u200b\u5230\u8fbe\u200b\u670d\u52a1\u7aef\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u9700\u8981\u200b\u5728\u200b\u6574\u4e2a\u200b\u4f1a\u8bdd\u200b\u8303\u56f4\u200b\u5185\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u5168\u5c40\u200b\u9012\u589e\u200b\u7684\u200bID\u3002</p> <p>Tips</p> <p>\u200b\u6d1e\u89c1\u200b: \u200b\u4e8b\u5b9e\u4e0a\u200b\u4ec5\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u540c\u4e00\u4e2a\u200b\u5ba2\u6237\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u7684\u200b\u5148\u540e\u987a\u5e8f\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u6d88\u606f\u200b\u8f6c\u53d1\u200b\u7684\u200b\u53ef\u7528\u6027\u200b\u5982\u4f55\u200b\u4fdd\u8bc1\u200b?</p> \u200b\u65b9\u6848\u200b \u200b\u6536\u76ca\u200b \u200b\u4ee3\u4ef7\u200b \u200b\u5982\u679c\u200b\u670d\u52a1\u7aef\u200b\u5728\u200b\u5206\u914d\u200bseqID\u200b\u524d\u200b\u6b64\u200b\u8bf7\u6c42\u200b\u5931\u8d25\u200b\u6216\u200b\u8fdb\u7a0b\u200b\u5d29\u6e83\u200b\u600e\u4e48\u529e\u200b?\u200b\u670d\u52a1\u7aef\u200b\u5728\u200b\u5206\u914d\u200bseqID\u200b\u4e4b\u540e\u200b\u518d\u200b\u56de\u590d\u200bACK\u200b\u6d88\u606f\u200b\u3002 \u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5206\u914d\u200bseqID\u200b\u6d88\u606f\u200b\u7684\u200b\u53ef\u7528\u6027\u200b 1. ack\u200b\u56de\u590d\u200b\u53d8\u6162\u200b,\u200b\u6536\u53d1\u200b\u6d88\u606f\u200b\u53d8\u6162\u200b 2. \u200b\u5982\u679c\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u5931\u8d25\u200b\u6d88\u606f\u200b\u5c06\u200b\u4e22\u5931\u200b 3. seqID \u200b\u5206\u914d\u200b\u6210\u4e3a\u200b\u6027\u80fd\u200b\u74f6\u9888\u200b \u200b\u5982\u679c\u200b\u670d\u52a1\u7aef\u200b\u5728\u200b\u5b58\u50a8\u200b\u6d88\u606f\u200b\uff0c\u200b\u4e1a\u52a1\u200b\u5904\u7406\u200b\uff0c\u200b\u63a5\u5165\u200b\u5c42\u200b\u8def\u7531\u200b\u65f6\u200b\u5931\u8d25\u200b\u600e\u4e48\u529e\u200b?1. \u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u540e\u200b\u518d\u200b\u56de\u590d\u200bACK\uff0c\u200b\u5982\u679c\u200bACK\u200b\u5931\u8d25\u200b\u5219\u200b\u5ba2\u6237\u7aef\u200b\u91cd\u8bd5\u200b\u65f6\u200b\u518d\u6b21\u200b\u5e42\u200b\u7b49\u200b\u5730\u200b\u56de\u590d\u200bACK\u3002 2. \u200b\u4e00\u65e6\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\uff0c\u200b\u5982\u679c\u200b\u670d\u52a1\u200b\u5d29\u6e83\u200b\u5bfc\u81f4\u200b\u957f\u200b\u8fde\u63a5\u200b\u65ad\u5f00\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u91cd\u65b0\u200b\u5efa\u7acb\u200b\u8fde\u63a5\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200bpull\u200b\u4fe1\u4ee4\u200b\uff0c\u200b\u62c9\u53d6\u200b\u5386\u53f2\u200b\u6d88\u606f\u200b\u8fdb\u884c\u200b\u6d88\u606f\u200b\u8865\u6d1e\u200b\uff0c\u200b\u4ee5\u6b64\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u53ef\u7528\u6027\u200b\u3002 3. \u200b\u5982\u679c\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u540e\u200b\uff0c\u200b\u4ec5\u200b\u662f\u200b\u4e1a\u52a1\u200b\u5c42\u200b\u5931\u8d25\u200b\uff0c\u200b\u63a5\u5165\u200b\u5c42\u957f\u200b\u8fde\u63a5\u200b\u65e0\u200b\u611f\u77e5\u200b\uff0c\u200b\u4e1a\u52a1\u200b\u5c42\u200b\u9700\u8981\u200b\u505a\u200b\u5f02\u5e38\u200b\u6355\u83b7\u200b\uff0c\u200b\u5e76\u200b\u8ffd\u52a0\u200bpull\u200b\u4fe1\u4ee4\u200b\u8bf7\u6c42\u200b\u7ed9\u200b\u5230\u200b\u5ba2\u6237\u7aef\u200bB\uff0c\u200b\u4e3b\u52a8\u200b\u89e6\u53d1\u200b\u5176\u62c9\u53d6\u200b\u5386\u53f2\u200b\u6d88\u606f\u200b\u3002 1. \u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4e1a\u52a1\u200b\u5904\u7406\u200b\u5168\u200b\u6d41\u7a0b\u200b\u7684\u200b\u53ef\u7528\u6027\u200b 2. \u200b\u5728\u200b\u51fa\u73b0\u5f02\u5e38\u200b\u60c5\u51b5\u200b\u65f6\u200b\uff0c\u200b\u53ef\u200b\u6beb\u79d2\u200b\u7ea7\u200b\u89e6\u53d1\u200b\u63a5\u6536\u7aef\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u53ca\u65f6\u6027\u200b 1. \u200b\u4e0a\u884c\u200b\u6d88\u606f\u200b\u7684\u200bp95\u200b\u5ef6\u8fdf\u200b\u5c06\u200b\u589e\u52a0\u200b 2. \u200b\u6574\u4f53\u200b\u901a\u4fe1\u200b\u590d\u6742\u5ea6\u200b\u589e\u9ad8\u200b 3. \u200b\u5e94\u5bf9\u200b\u5f31\u7f51\u200b\u73af\u5883\u200b\u9700\u8981\u200b\u534f\u8bae\u200b\u5347\u964d\u7ea7\u200b\u673a\u5236\u200b \u200b\u53ef\u4ee5\u200b\u5c06\u200b\u6d88\u606f\u200b\u4ea4\u7ed9\u200bMQ\u200b\u5f02\u6b65\u200b\u5b58\u50a8\u200b\uff0cMQ\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u4e0d\u200b\u4e22\u5931\u200b\u3002 \u200b\u5f02\u6b65\u200b\u5199\u5165\u200b\uff0c\u200b\u4f18\u5316\u200b\u4e86\u200bp95\u200b\u5ef6\u8fdf\u200b seqID\u200b\u65e0\u9700\u200b\u5168\u5c40\u200b\u6709\u5e8f\u200b\uff0c\u200b\u4ec5\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u4f1a\u200b\u8bdd\u200b\u5185\u200b\u6709\u5e8f\u200b\u5373\u53ef\u200b \u200b\u89e3\u51b3\u200b\u4e86\u200bseqID\u200b\u5206\u914d\u200b\u7684\u200b\u5355\u70b9\u200b\u74f6\u9888","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#_6","title":"\u4e0b\u884c\u200b\u6d88\u606f","text":"<p>\u200b\u670d\u52a1\u7aef\u200b\u5c06\u200b\u6d88\u606f\u200b\u53d1\u9001\u7ed9\u200b\u5ba2\u6237\u7aef\u200bB\uff0c\u200b\u5176\u200b\u534f\u8bae\u200b\u8bbe\u8ba1\u200b\u4f9d\u8d56\u4e8e\u200bseqID\u200b\u7684\u200b\u751f\u6210\u200b\u65b9\u5f0f\u200b\u3002</p> \u200b\u65b9\u6848\u200b \u200b\u6536\u76ca\u200b \u200b\u4ee3\u4ef7\u200b \u200b\u5ba2\u6237\u7aef\u200b\u5b9a\u671f\u200b\u8f6e\u8be2\u200b\u53d1\u8d77\u200bpull\u200b\u8bf7\u6c42\u200b\u62ff\u5230\u200b\u65b0\u200b\u6d88\u606f\u200b \u200b\u5b9e\u73b0\u200b\u7b80\u5355\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u53ef\u7528\u6027\u200b 1. \u200b\u5ba2\u6237\u7aef\u200b\u8017\u7535\u200b\u9ad8\u200b(\u200b\u7528\u6237\u200b\u4f53\u9a8c\u200b\u5dee\u200b) 2. \u200b\u6d88\u606f\u200b\u65f6\u5ef6\u200b\u9ad8\u200b\uff0c\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u53ca\u65f6\u6027\u200b \u200b\u4f9d\u8d56\u200bseqID\u200b\u7684\u200b\u4e25\u683c\u200b\u9012\u589e\u200b1. \u200b\u7528\u200bredis incrby \u200b\u751f\u6210\u200bseqID\uff0c key\u200b\u662f\u200bsessionID/connID\u3002 2. \u200b\u6309\u200b\u6d88\u606f\u200b\u5230\u8fbe\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u987a\u5e8f\u200b\u5206\u914d\u200bseqID\uff0c\u200b\u4f7f\u200b\u5176\u200b\u5177\u6709\u200b\u4f1a\u8bdd\u200b\u8303\u56f4\u200b\u5185\u200b\u7684\u200b\u5168\u5c40\u200b\u5e8f\u200b\u3002 3. \u200b\u670d\u52a1\u7aef\u200b\u4fdd\u8bc1\u200bseqID\u200b\u4e25\u683c\u200b\u9012\u589e\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\u5c06\u200b\u6d88\u606f\u200b\u53d1\u9001\u7ed9\u200b\u5ba2\u6237\u7aef\u200bB\uff0c\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u4e5f\u200b\u662f\u200b\u6309\u200b<code>preSeqID == seqID+1</code>\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u505a\u5230\u200b\u5e42\u200b\u7b49\u200b 4. \u200b\u670d\u52a1\u7aef\u200b\u9700\u200b\u7b49\u5f85\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u7684\u200bACK\u200b\u6d88\u606f\u200b\uff0c\u200b\u5426\u5219\u200b\u8d85\u65f6\u200b\u540e\u200b\u9700\u8981\u200b\u91cd\u4f20\u200b 1. \u200b\u5b9e\u73b0\u200b\u7b80\u5355\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u4e0a\u7ebf\u200b 2. \u200b\u6700\u5927\u200b\u7a0b\u5ea6\u200b\u7684\u200b\u4fdd\u8bc1\u200b\u4e25\u683c\u200b\u9012\u589e\u200b 1. \u200b\u5f31\u7f51\u200b\u91cd\u4f20\u200b\u95ee\u9898\u200b 2. Redis \u200b\u5b58\u5728\u200b\u5355\u70b9\u200b\u95ee\u9898\u200b\uff0c\u200b\u96be\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e25\u683c\u200b\u9012\u589e\u200b 3. \u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u8d85\u65f6\u200b\u91cd\u4f20\u200b\u6d88\u606f\u200b\u961f\u5217\u200b\u4ee5\u53ca\u200b\u5b9a\u65f6\u5668\u200b 4. \u200b\u4e0d\u80fd\u200b\u89e3\u51b3\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u4e0d\u200b\u5728\u7ebf\u200b\u65f6\u200b\u6d88\u606f\u200b\u7684\u200b\u4f20\u9012\u200b \u200b\u5e94\u5bf9\u200bredis\u200b\u7684\u200b\u5355\u70b9\u6545\u969c\u200b\uff0cseqID\u200b\u7684\u200b\u8d8b\u52bf\u200b\u9012\u589e\u200b1. \u200b\u4f7f\u7528\u200blua\u200b\u811a\u672c\u200b\uff0c\u200b\u5b58\u50a8\u200bmaxSeqID\u200b\u4ee5\u53ca\u200b\u5f53\u524d\u200b\u7684\u200bnode\u200b\u7684\u200brunID\u3002 2. lua\u200b\u811a\u672c\u200b\u6bcf\u6b21\u200b\u83b7\u53d6\u200bID\u200b\u65f6\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200bnode\u200b\u7684\u200brunID\u200b\u548c\u200b\u5b58\u50a8\u200b\u7684\u200brunID\u200b\u662f\u5426\u200b\u4e00\u81f4\u200b 3. \u200b\u53d1\u73b0\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u65f6\u200b\uff0c\u200b\u8bf4\u660e\u200b\u53d1\u751f\u200b\u4e86\u200b\u4e3b\u4ece\u200b\u5207\u6362\u200b\uff0c\u200b\u7136\u540e\u200b\u5bf9\u200bmaxSeqID\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8df3\u53d8\u200b\u4fdd\u8bc1\u200b\u9012\u589e\u200b\uff0c\u200b\u907f\u514d\u200b\u4ece\u200b\u8282\u70b9\u200b\u7531\u4e8e\u200b\u540c\u6b65\u200b\u6570\u636e\u200b\u4e0d\u200b\u53ca\u65f6\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u66fe\u7ecf\u200b\u5206\u914d\u200b\u8fc7\u200b\u7684\u200bID\u200b\u51fa\u53bb\u200b 4. \u200b\u5ba2\u6237\u7aef\u200bB\u200b\u5728\u200b\u53d1\u73b0\u200b\u6d88\u606f\u200b\u4e0d\u200b\u8fde\u7eed\u200b\u65f6\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u62d2\u7edd\u200b\uff0c\u200b\u800c\u662f\u200b\u53d1\u9001\u200bpull\u200b\u4fe1\u4ee4\u200b\u8fdb\u884c\u200b\u589e\u8865\u200b 5. \u200b\u5982\u679c\u200b\u62c9\u53d6\u200b\u4e0d\u5230\u200b\u65b0\u200b\u6d88\u606f\u200b\uff0c\u200b\u5219\u200b\u8bf4\u660e\u200b\u662f\u200bseqID\u200b\u7684\u200b\u8df3\u53d8\u200b\u5bfc\u81f4\u200b\uff0c\u200b\u4e0d\u518d\u200b\u8fdb\u4e00\u6b65\u200b\u5904\u7406\u200b 6. \u200b\u5982\u679c\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u4e0d\u200b\u5728\u7ebf\u200b\uff0c\u200b\u67e5\u8be2\u200b\u7528\u6237\u200b\u72b6\u6001\u200b\u540e\u4ec5\u200b\u5b58\u50a8\u200b\u4e0d\u200b\u63a8\u9001\u200b\u5373\u53ef\u200b 1. \u200b\u5c3d\u200b\u6700\u5927\u200b\u53ef\u80fd\u200b\u4fdd\u8bc1\u200b\u8fde\u7eed\u6027\u200b 2. \u200b\u4efb\u610f\u200b\u65f6\u523b\u200b\u4fdd\u8bc1\u200b\u5355\u8c03\u200b\u548c\u200b\u9012\u589e\u200b\u6027\u200b 3. \u200b\u7531\u4e8e\u200b\u4f7f\u7528\u200b\u4f1a\u8bdd\u200b\u7ea7\u522b\u200b\u7684\u200bseqID\uff0c\u200b\u5219\u200b\u4e0d\u200b\u9700\u8981\u200b\u5168\u5c40\u200b\u5206\u5e03\u5f0f\u200bID\u200b\u751f\u6210\u200b\uff0credis\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bcluster\u200b\u6a21\u5f0f\u200b\u8fdb\u884c\u200b\u6c34\u5e73\u200b\u6269\u5c55\u200b\u3002 4. \u200b\u8bc6\u522b\u200b\u4e86\u200b\u7528\u6237\u200b\u662f\u5426\u200b\u5728\u7ebf\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u7f51\u7edc\u5e26\u5bbd\u200b\u6d88\u8017\u200b 1. \u200b\u534f\u8bae\u200b\u4ea4\u4e92\u200b\u53d8\u5f97\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u96be\u5ea6\u200b\u4e0a\u5347\u200b\u3002 2. \u200b\u53ef\u200b\u8bc4\u4f30\u200b\u7528\u6237\u200b\u89c4\u6a21\u200b\u8fdb\u884c\u200b\u51b3\u7b56\u200b\u662f\u5426\u200b\u652f\u6301\u200b\u5982\u6b64\u200b\u7ea7\u522b\u200b\u7684\u200b\u53ef\u7528\u6027\u200b 3. \u200b\u7fa4\u804a\u200b\u573a\u666f\u200b\uff0c\u200b\u5c06\u200b\u9020\u6210\u200b\u6d88\u606f\u200b\u98ce\u66b4\u200b \u200b\u63a8\u62c9\u200b\u7ed3\u5408\u200b+\u200b\u670d\u52a1\u7aef\u200b\u6253\u5305\u200b\u6574\u6d41\u200b \u200b\u89e3\u51b3\u200b\u6d88\u606f\u200b\u98ce\u66b4\u200b\u95ee\u9898\u200b \u200b\u5b9e\u73b0\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b SeqID \u200b\u94fe\u8868\u200b1. \u200b\u5ba2\u6237\u7aef\u200bB\u200b\u5728\u200b\u672c\u5730\u200b\u5b58\u50a8\u200b\u6700\u540e\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200bseqID\u200b\u7684\u200b\u503c\u200b\u8bb0\u4f5c\u200bmaxSeqID 2. \u200b\u670d\u52a1\u7aef\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u65f6\u200b\uff0c\u200b\u643a\u5e26\u200b\u4e0a\u200b\u4e00\u6761\u200b\u6d88\u606f\u200b\u7684\u200bseqID\u200b\u8bb0\u200b\u4f5c\u200bpreSeqID\u200b\u548c\u200b\u5f53\u524d\u200bseqID 3. \u200b\u5ba2\u6237\u7aef\u200bB\u200b\u63a5\u6536\u200b\u6d88\u606f\u200b\u65f6\u200b\u901a\u8fc7\u200b\u5bf9\u6bd4\u200bmaxSeqID == preSeqID \u200b\u5219\u200b\u63a5\u6536\u200b\u5426\u5219\u200b\u62d2\u7edd\u200b 4. \u200b\u670d\u52a1\u7aef\u200b\u5728\u200b\u8bbe\u8ba1\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u65f6\u200b\uff0c\u200b\u8981\u200b\u5b58\u50a8\u200b\u4e0a\u200b\u4e00\u6761\u200b\u6d88\u606f\u200b\u7684\u200bseqID\uff0c\u200b\u5f62\u6210\u200b\u903b\u8f91\u200b\u94fe\u8868\u200b 5. \u200b\u5ba2\u6237\u7aef\u200b\u53d1\u73b0\u200bpreSeqID\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5219\u200b\u9000\u5316\u200b\u4e3a\u200bpull\u200b\u8bf7\u6c42\u200b\u53bb\u200b\u62c9\u200b\u7f3a\u5931\u200b\u7684\u200b\u6d88\u606f\u200b 1. \u200b\u5c4f\u853d\u200b\u4e86\u200b\u5bf9\u200bseqID \u200b\u8d8b\u52bf\u200b\u9012\u589e\u200b\u7684\u200b\u4f9d\u8d56\u200b 1. \u200b\u6536\u76ca\u200b\u4e0d\u200b\u5927\u200b\uff0c\u200b\u4e14\u200b\u5728\u200b\u6d88\u606f\u200b\u5b58\u50a8\u200b\u65f6\u8981\u200b\u591a\u200b\u4e00\u4e2a\u200bpreSeqID","tags":["Architecture & Design"]},{"location":"blog/backend/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/#_7","title":"\u6700\u7ec8\u200b\u65b9\u6848","text":"<ol> <li> <p>\u200b\u5ba2\u6237\u7aef\u200bA\u200b\u521b\u5efa\u200b\u8fde\u63a5\u200b\u540e\u200b\uff0c\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200bclientID\uff0c\u200b\u4ece\u200b0\u200b\u5f00\u59cb\u200b\u5373\u53ef\u200b\uff0c\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b\u6d88\u606f\u200b\u65f6\u200b\u83b7\u5f97\u200bclientID\u200b\u5e76\u200b\u81ea\u589e\u200b\u3002</p> </li> <li> <p>\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u6d88\u606f\u200b\u8ba1\u65f6\u5668\u200b\uff0c\u200b\u7b49\u5f85\u200back\u200b\u6d88\u606f\u200b\u7684\u200b\u56de\u590d\u200b\uff0c\u200b\u6216\u8005\u200b\u8d85\u65f6\u200b\u540e\u200b\u89e6\u53d1\u200b\u91cd\u4f20\u200b\u3002</p> </li> <li> <p>\u200b\u57fa\u4e8e\u200btcp\u200b\u8fde\u63a5\u200b\u5c06\u200bmsg1\u200b\u53d1\u9001\u7ed9\u200b\u670d\u52a1\u7aef\u200b\u3002</p> </li> <li> <p>\u200b\u670d\u52a1\u7aef\u200b\u8bf7\u6c42\u200bredis\u200b\u4f7f\u7528\u200bsessionID\u200b\u8fdb\u884c\u200b\u5206\u7247\u200b\uff0cincryBy\u200b\u83b7\u5f97\u200bseqID\u3002</p> </li> <li> <p>\u200b\u5f02\u6b65\u200b\u5199\u5165\u200bMQ\uff0c\u200b\u4fdd\u8bc1\u200b\u6d88\u606f\u200b\u53ef\u9760\u200b\u5b58\u50a8\u200b\u3002</p> </li> <li> <p>\u200b\u7acb\u5373\u200b\u56de\u590d\u200b\u5ba2\u6237\u7aef\u200bA ack\u200b\u6d88\u606f\u200b\uff0c\u200b\u544a\u8bc9\u200b\u4ed6\u200b\u6d88\u606f\u200b\u5df2\u7ecf\u200b\u53ef\u9760\u200b\u9001\u8fbe\u200b\u3002</p> </li> <li> <p>\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u4e0b\u884c\u200b\u6d88\u606f\u200b\u5b9a\u65f6\u5668\u200b\uff0c\u200b\u7b49\u7b49\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u7684\u200back\u200b\u6d88\u606f\u200b\uff0c\u200b\u6216\u8005\u200b\u8d85\u65f6\u200b\u540e\u200b\u89e6\u53d1\u200b\u91cd\u4f20\u200b\u3002</p> </li> <li> <p>\u200b\u5ba2\u6237\u7aef\u200bA\u200b\u6536\u5230\u200back\u200b\u6d88\u606f\u200b\u540e\u200b\uff0c\u200b\u53d6\u6d88\u200b\u5b9a\u65f6\u5668\u200b\u3002</p> </li> <li> <p>\u200b\u670d\u52a1\u7aef\u200b\u53d1\u8d77\u200b\u4e0b\u884c\u200b\u6d88\u606f\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5c06\u200bmsg1\u200b\u53d1\u9001\u7ed9\u200b\u5ba2\u6237\u7aef\u200bB\u3002</p> </li> <li> <p>\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u6839\u636e\u200b\u5f53\u524d\u200bsession\u200b\u7684\u200bmaxSeqID+1 \u200b\u662f\u5426\u200b\u7b49\u4e8e\u200b\u5f53\u524d\u200b\u6d88\u606f\u200b\u7684\u200bseqID\u200b\u6765\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u63a5\u6536\u200b\u3002</p> </li> <li> <p>\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u56de\u590d\u200b\u670d\u52a1\u7aef\u200b\u6d88\u606f\u200b\u5df2\u7ecf\u200b\u786e\u8ba4\u200b\u6216\u8005\u200b\u62d2\u7edd\u200b\u3002</p> </li> <li> <p>\u200b\u670d\u52a1\u7aef\u200b\u6839\u636e\u200b\u5ba2\u6237\u7aef\u200bB\u200b\u56de\u590d\u200b\u51b3\u5b9a\u200b\u662f\u200b\u8fdb\u884c\u200b\u6d88\u606f\u200b\u8865\u6d1e\u200b\u8fd8\u662f\u200b\u5173\u95ed\u200b\u5b9a\u65f6\u5668\u200b\u3002</p> </li> </ol>","tags":["Architecture & Design"]},{"location":"blog/frontend/JavaScript/testJs/","title":"JavaScript Code Runner","text":"<p> \u200b\u7ea6\u200b 27 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u6211\u200b\u7684\u200b JavaScript Code Runner\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd9\u91cc\u200b\u8fd0\u884c\u200bjs\u200b\u4ee3\u7801\u200b\u3002</p> <p>Input:</p>  console.log(\"Hello, World\");  <p>Run</p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/","title":"\u57fa\u672c\u200b\u8bed\u6cd5","text":"<p> \u200b\u7ea6\u200b 671 \u200b\u4e2a\u200b\u5b57\u200b  94 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 3 \u200b\u5206\u949f\u200b</p> <p>JavaScript\u200b\u7684\u200b\u8bed\u6cd5\u200b\u548c\u200bJava\u200b\u8bed\u8a00\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8bed\u53e5\u200b\u4ee5\u200b<code>;</code>\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8bed\u53e5\u200b\u5757\u200b\u7528\u200b<code>{...}</code>\u3002\u200b\u4f46\u662f\u200b\uff0cJavaScript\u200b\u5e76\u200b\u4e0d\u200b\u5f3a\u5236\u200b\u8981\u6c42\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u8bed\u53e5\u200b\u7684\u200b\u7ed3\u5c3e\u200b\u52a0\u200b<code>;</code>\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u4e2d\u200b\u8d1f\u8d23\u200b\u6267\u884c\u200bJavaScript\u200b\u4ee3\u7801\u200b\u7684\u200b\u5f15\u64ce\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u8bed\u53e5\u200b\u7684\u200b\u7ed3\u5c3e\u200b\u8865\u200b\u4e0a\u200b<code>;</code>\u3002</p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#1","title":"1. \u200b\u58f0\u660e","text":"JavaScript<pre><code>var x = 1;\nconst y = 1;\nlet z = 1;\n</code></pre> <ol> <li> <p>var \u200b\u58f0\u660e\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u503c\u200b\u3002</p> </li> <li> <p>const \u200b\u58f0\u660e\u200b\u4e00\u4e2a\u200b\u5757\u200b\u4f5c\u7528\u57df\u200b\u7684\u200b\u53ea\u8bfb\u200b\u5e38\u91cf\u200b\u3002</p> </li> <li> <p>let \u200b\u58f0\u660e\u200b\u4e00\u4e2a\u200b\u5757\u200b\u4f5c\u7528\u57df\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u503c\u200b\u3002</p> </li> </ol> <p>\u200b\u6ce8\u610f\u200b</p> <p>\u200b\u5efa\u8bae\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u5c3d\u53ef\u80fd\u200b\u591a\u5730\u200b\u4f7f\u7528\u200b <code>let</code>\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b <code>var</code></p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#2","title":"2. \u200b\u5206\u652f","text":"","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#_2","title":"\u9519\u8bef\u5224\u65ad","text":"<p>\u200b\u4e0b\u9762\u200b\u8fd9\u4e9b\u200b\u503c\u200b\u5c06\u200b\u88ab\u200b\u8ba1\u7b97\u200b\u51fa\u200b false (also known as Falsy values): * false * undefined * null * 0 * NaN * \u200b\u7a7a\u200b\u5b57\u7b26\u4e32\u200b\uff08\"\"\uff09</p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#ifelse","title":"if...else","text":"JavaScript<pre><code>if (condition_1) {\n  statement_1;\n} else if (condition_2) {\n  statement_2;\n} else if (condition_n_1) {\n  statement_n;\n} else {\n  statement_last;\n}\n</code></pre>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#switch","title":"switch","text":"JavaScript<pre><code>switch (expression) {\n   case label_1:\n      statements_1\n      [break;]\n   case label_2:\n      statements_2\n      [break;]\n   ...\n   default:\n      statements_def\n      [break;]\n}\n</code></pre>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#3","title":"3. \u200b\u9519\u8bef","text":"","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#_3","title":"\u5f02\u5e38\u200b\u5904\u7406\u200b\u8bed\u53e5","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u7528\u200b throw \u200b\u8bed\u53e5\u200b\u629b\u51fa\u200b\u4e00\u4e2a\u200b\u5f02\u5e38\u200b\u5e76\u4e14\u200b\u7528\u200b try...catch \u200b\u8bed\u53e5\u200b\u6355\u83b7\u200b\u5904\u7406\u200b\u5b83\u200b\u3002</p> <ul> <li>throw\u200b\u8bed\u53e5\u200b</li> <li>try...catch\u200b\u8bed\u53e5\u200b</li> </ul>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#_4","title":"\u5f02\u5e38\u200b\u7c7b\u578b","text":"<p>JavaScript \u200b\u53ef\u4ee5\u200b\u629b\u51fa\u200b\u4efb\u610f\u200b\u5bf9\u8c61\u200b\u3002\u200b\u7136\u800c\u200b\uff0c\u200b\u4e0d\u662f\u200b\u6240\u6709\u200b\u5bf9\u8c61\u200b\u80fd\u200b\u4ea7\u751f\u200b\u76f8\u540c\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u629b\u51fa\u200b\u6570\u503c\u200b\u6216\u8005\u200b\u5b57\u6bcd\u200b\u4e32\u200b\u4f5c\u4e3a\u200b\u9519\u8bef\u4fe1\u606f\u200b\u5341\u5206\u200b\u5e38\u89c1\u200b\uff0c\u200b\u4f46\u662f\u200b\u901a\u5e38\u200b\u7528\u200b\u4e0b\u5217\u200b\u5176\u4e2d\u200b\u4e00\u79cd\u200b\u5f02\u5e38\u200b\u7c7b\u578b\u200b\u6765\u200b\u521b\u5efa\u200b\u76ee\u6807\u200b\u66f4\u4e3a\u200b\u9ad8\u6548\u200b\uff1a</p> <ul> <li>ECMAScript exceptions</li> <li>DOMException and DOMError</li> </ul>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#throw","title":"throw","text":"<p>\u200b\u4f7f\u7528\u200bthrow\u200b\u8bed\u53e5\u200b\u629b\u51fa\u200b\u4e00\u4e2a\u200b\u5f02\u5e38\u200b\u3002\u200b\u5f53\u200b\u4f60\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4f60\u200b\u89c4\u5b9a\u200b\u4e00\u4e2a\u200b\u542b\u6709\u200b\u503c\u200b\u7684\u200b\u8868\u8fbe\u5f0f\u200b\u8981\u200b\u88ab\u200b\u629b\u51fa\u200b\u3002</p> JavaScript<pre><code>throw expression;\n</code></pre>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#trycatchfinally","title":"try...catch...finally","text":"JavaScript<pre><code>openMyFile();\ntry {\n  writeMyFile(theData); //This may throw a error\n} catch (e) {\n  handleError(e); // If we got a error we handle it\n} finally {\n  closeMyFile(); // always close the resource\n}\n</code></pre>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#4","title":"4. \u200b\u5faa\u73af\u200b\u4e0e\u200b\u8fed\u4ee3","text":"","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#for","title":"for","text":"JavaScript<pre><code>for ([initialExpression]; [condition]; [incrementExpression])\n  statement\n</code></pre> <p>\u200b\u793a\u4f8b\u200b\uff1a JavaScript<pre><code>var step;\nfor (step = 0; step &lt; 5; step++) {\n  // Runs 5 times, with values of step 0 through 4.\n  console.log(\"Walking east one step\");\n}\n</code></pre></p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#dowhile","title":"do...while","text":"JavaScript<pre><code>do\n  statement\nwhile (condition);\n</code></pre> <p>\u200b\u793a\u4f8b\u200b\uff1a \u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b <code>do</code> \u200b\u5faa\u73af\u200b\u5c06\u200b\u81f3\u5c11\u200b\u91cd\u590d\u200b\u4e00\u6b21\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e00\u76f4\u200b\u91cd\u590d\u200b\u76f4\u5230\u200b <code>i</code> \u200b\u4e0d\u518d\u200b\u5c0f\u4e8e\u200b 5\u3002 JavaScript<pre><code>var i = 0;\ndo {\n  i += 1;\n  console.log(i);\n} while (i &lt; 5);\n</code></pre></p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#while","title":"while","text":"JavaScript<pre><code>while (condition)\n  statement\n</code></pre> <p>\u200b\u793a\u4f8b\u200b\uff1a JavaScript<pre><code>var n = 0;\nvar x = 0;\nwhile (n &lt; 3) {\n  n++;\n  x += n;\n}\n</code></pre></p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#label","title":"label","text":"<p>\u200b\u7c7b\u4f3c\u200b\u4e8e\u200bjava\uff0c\u200b\u4e00\u4e2a\u200b <code>label</code> \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8ba9\u4f60\u5728\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u5176\u4ed6\u200b\u4f4d\u7f6e\u200b\u5f15\u7528\u200b\u5b83\u200b\u7684\u200b\u6807\u8bc6\u7b26\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>label</code> \u200b\u6807\u8bc6\u200b\u4e00\u4e2a\u200b\u5faa\u73af\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b <code>break</code> \u200b\u6216\u8005\u200b <code>continue</code> \u200b\u6765\u200b\u6307\u51fa\u200b\u7a0b\u5e8f\u200b\u662f\u5426\u200b\u8be5\u200b\u505c\u6b62\u200b\u5faa\u73af\u200b\u8fd8\u662f\u200b\u7ee7\u7eed\u200b\u5faa\u73af\u200b\u3002</p> JavaScript<pre><code>var num = 0;\noutPoint: for (var i = 0; i &lt; 10; i++) {\n  for (var j = 0; j &lt; 10; j++) {\n    if (i == 5 &amp;&amp; j == 5) {\n      break outPoint; // \u200b\u5728\u200b i = 5\uff0cj = 5 \u200b\u65f6\u200b\uff0c\u200b\u8df3\u51fa\u200b\u6240\u6709\u200b\u5faa\u73af\u200b\uff0c\n      // \u200b\u8fd4\u56de\u200b\u5230\u200b\u6574\u4e2a\u200b outPoint \u200b\u4e0b\u65b9\u200b\uff0c\u200b\u7ee7\u7eed\u6267\u884c\u200b\n    }\n    num++;\n  }\n}\n\nalert(num); // \u200b\u8f93\u51fa\u200b 55\n</code></pre>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#forin","title":"for...in","text":"<p>for...in \u200b\u8bed\u53e5\u200b\u5faa\u73af\u200b\u4e00\u4e2a\u200b\u6307\u5b9a\u200b\u7684\u200b\u53d8\u91cf\u200b\u6765\u200b\u5faa\u73af\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u6240\u6709\u200b\u53ef\u200b\u679a\u4e3e\u200b\u7684\u200b\u5c5e\u6027\u200b\u3002JavaScript \u200b\u4f1a\u4e3a\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u5c5e\u6027\u200b\u6267\u884c\u200b\u6307\u5b9a\u200b\u7684\u200b\u8bed\u53e5\u200b\u3002</p> JavaScript<pre><code>for (variable in object) {\n  statements\n}\n</code></pre> <p>\u200b\u793a\u4f8b\u200b\uff1a \u200b\u4e0b\u9762\u200b\u7684\u200b\u51fd\u6570\u200b\u901a\u8fc7\u200b\u5b83\u200b\u7684\u200b\u53c2\u6570\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u548c\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u540d\u5b57\u200b\u3002\u200b\u7136\u540e\u200b\u5faa\u73af\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6240\u6709\u200b\u5c5e\u6027\u200b\u5e76\u4e14\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5217\u51fa\u200b\u5c5e\u6027\u200b\u540d\u200b\u548c\u200b\u8be5\u200b\u5c5e\u6027\u200b\u503c\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u3002 JavaScript<pre><code>function dump_props(obj, obj_name) {\n  var result = \"\";\n  for (var i in obj) {\n    result += obj_name + \".\" + i + \" = \" + obj[i] + \"&lt;br&gt;\";\n  }\n  result += \"&lt;hr&gt;\";\n  return result;\n}\n</code></pre> \u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u62e5\u6709\u200b <code>make</code> \u200b\u548c\u200b <code>model</code> \u200b\u5c5e\u6027\u200b\u7684\u200b <code>car</code> \u200b\u5bf9\u8c61\u200b\u6765\u8bf4\u200b\uff0c\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b <code>result</code> \u200b\u662f\u200b\uff1a Text Only<pre><code>car.make = Ford\ncar.model = Mustang\n</code></pre></p>","tags":["javascript"]},{"location":"blog/frontend/JavaScript/QuickDive/BasicGrammar/#forof","title":"for...of","text":"<p>for...of \u200b\u8bed\u53e5\u200b\u5728\u200b\u53ef\u200b\u8fed\u4ee3\u200b\u5bf9\u8c61\u200b\uff08\u200b\u5305\u62ec\u200bArray\u3001Map\u3001Set\u3001arguments \u200b\u7b49\u7b49\u200b\uff09\u200b\u4e0a\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5faa\u73af\u200b\uff0c\u200b\u5bf9\u503c\u200b\u7684\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u72ec\u7279\u200b\u5c5e\u6027\u200b\u8c03\u7528\u200b\u4e00\u6b21\u200b\u8fed\u4ee3\u200b\u3002</p> JavaScript<pre><code>for (variable of object) {\n  statement\n}\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u5c55\u793a\u200b\u4e86\u200b for...of \u200b\u548c\u200b for...in \u200b\u4e24\u79cd\u200b\u5faa\u73af\u200b\u8bed\u53e5\u200b\u4e4b\u95f4\u200b\u7684\u200b\u533a\u522b\u200b\u3002 for...in \u200b\u5faa\u73af\u200b\u904d\u5386\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u6570\u7ec4\u200b\u5143\u7d20\u200b\u7684\u200b\u4e0b\u6807\u200b\uff0c\u200b\u800c\u200b for...of \u200b\u904d\u5386\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\uff1a JavaScript<pre><code>let arr = [3, 5, 7];\narr.foo = \"hello\";\n\nfor (let i in arr) {\n  console.log(i); // \u200b\u8f93\u51fa\u200b \"0\", \"1\", \"2\", \"foo\"\n}\n\nfor (let i of arr) {\n  console.log(i); // \u200b\u8f93\u51fa\u200b \"3\", \"5\", \"7\"\n}\n\n// \u200b\u6ce8\u610f\u200b for...of \u200b\u7684\u200b\u8f93\u51fa\u200b\u6ca1\u6709\u200b\u51fa\u73b0\u200b \"hello\"\n</code></pre></p>","tags":["javascript"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/","title":"IO\u200b\u591a\u8def\u590d\u7528\u200b\u5e95\u5c42\u200b\u539f\u7406","text":"<p> \u200b\u7ea6\u200b 5547 \u200b\u4e2a\u200b\u5b57\u200b  88 \u200b\u884c\u200b\u4ee3\u7801\u200b  8 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 20 \u200b\u5206\u949f\u200b</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_1","title":"\u7528\u6237\u200b\u7a7a\u95f4\u200b\u548c\u200b\u5185\u6838\u200b\u7a7a\u95f4","text":"<p>\u200b\u73b0\u5728\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u90fd\u200b\u662f\u200b\u91c7\u7528\u200b\u865a\u62df\u5b58\u50a8\u5668\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u200b32\u200b\u4f4d\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u800c\u8a00\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5bfb\u5740\u200b\u7a7a\u95f4\u200b\uff08\u200b\u865a\u62df\u5b58\u50a8\u200b\u7a7a\u95f4\u200b\uff09\u200b\u4e3a\u200b4G\uff082\u200b\u7684\u200b32\u200b\u6b21\u65b9\u200b\uff09\u3002</p> <p>\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b\u5185\u6838\u200b\uff0c\u200b\u72ec\u7acb\u200b\u4e8e\u200b\u666e\u901a\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u53d7\u200b\u4fdd\u62a4\u200b\u7684\u200b\u5185\u5b58\u7a7a\u95f4\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u8bbf\u95ee\u200b\u5e95\u5c42\u200b\u786c\u4ef6\u200b\u8bbe\u5907\u200b\u7684\u200b\u6240\u6709\u200b\u6743\u9650\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u5185\u6838\u200b\uff08kernel\uff09\uff0c\u200b\u4fdd\u8bc1\u200b\u5185\u6838\u200b\u7684\u200b\u5b89\u5168\u200b\uff0c\u200b\u64cd\u5fc3\u200b\u7cfb\u7edf\u200b\u5c06\u200b\u865a\u62df\u7a7a\u95f4\u200b\u5212\u5206\u200b\u4e3a\u200b\u4e24\u200b\u90e8\u5206\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u4e3a\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u4e3a\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u3002\u200b\u9488\u5bf9\u200blinux\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u800c\u8a00\u200b\uff0c\u200b\u5c06\u200b\u6700\u9ad8\u200b\u7684\u200b1G\u200b\u5b57\u8282\u200b\uff08\u200b\u4ece\u200b\u865a\u62df\u5730\u5740\u200b0xC0000000\u200b\u5230\u200b0xFFFFFFFF\uff09\uff0c\u200b\u4f9b\u200b\u5185\u6838\u200b\u4f7f\u7528\u200b\uff0c\u200b\u79f0\u4e3a\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u800c\u200b\u5c06\u200b\u8f83\u200b\u4f4e\u200b\u7684\u200b3G\u200b\u5b57\u8282\u200b\uff08\u200b\u4ece\u200b\u865a\u62df\u5730\u5740\u200b0x00000000\u200b\u5230\u200b0xBFFFFFFF\uff09\uff0c\u200b\u4f9b\u200b\u5404\u4e2a\u200b\u8fdb\u7a0b\u200b\u4f7f\u7528\u200b\uff0c\u200b\u79f0\u4e3a\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\uff1a\u200b\u7528\u6237\u200b\u4ee3\u7801\u200b\u3001\u200b\u7528\u6237\u200b\u5806\u6808\u200b\u3002\u200b\u7528\u6237\u200b\u7a0b\u5e8f\u8fd0\u884c\u200b\u5728\u200b \u200b\u975e\u200b\u7279\u6743\u200b\u6a21\u5f0f\u200b\uff08Ring 3\uff09\uff0c\u200b\u65e0\u6cd5\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u786c\u4ef6\u200b\u548c\u200b\u5185\u6838\u200b\u6570\u636e\u7ed3\u6784\u200b\u3002</p> <p>\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\uff1a\u200b\u5185\u6838\u200b\u4ee3\u7801\u200b\u3001\u200b\u5185\u6838\u200b\u8c03\u5ea6\u200b\u7a0b\u5e8f\u200b\u3001\u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b\uff08\u200b\u5185\u6838\u200b\u5806\u6808\u200b\u3001thread_info \u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b\uff09\u3002\u200b\u5185\u6838\u200b\u4ee3\u7801\u200b\u5728\u200b\u7279\u6743\u200b\u6a21\u5f0f\u200b\uff08Ring 0\uff09\u200b\u8fd0\u884c\u200b\uff0c\u200b\u80fd\u591f\u200b\u8bbf\u95ee\u200b\u6240\u6709\u200b\u786c\u4ef6\u8d44\u6e90\u200b\uff0c\u200b\u5982\u200b CPU \u200b\u5bc4\u5b58\u5668\u200b\u3001I/O \u200b\u7aef\u53e3\u200b\u3001\u200b\u8bbe\u5907\u200b\u5bc4\u5b58\u5668\u200b \u200b\u7b49\u200b</p> <ul> <li>\u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b\u548c\u200b\u7528\u6237\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u662f\u200b\u4e00\u4e00\u5bf9\u5e94\u200b\u7684\u200b</li> <li>SYS_API \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff1a\u200b\u5982\u200b read\u3001write\uff0c\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u5c31\u662f\u200b 0X80 \u200b\u4e2d\u65ad\u200b</li> <li>\u200b\u8fdb\u7a0b\u200b\u63cf\u8ff0\u7b26\u200b pd\uff1a\u200b\u8fdb\u7a0b\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u7528\u6237\u200b\u6001\u65f6\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u4fe1\u606f\u200b\u5728\u200b PCB \u200b\u4e2d\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e0a\u4e0b\u6587\u200b\uff1a\u200b\u7528\u6237\u7a0b\u5e8f\u200b\u57fa\u200b\u5730\u5740\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u8ba1\u6570\u5668\u200b\u3001cpu cache\u3001\u200b\u5bc4\u5b58\u5668\u200b\u7b49\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u7a0b\u5e8f\u200b\u5207\u56de\u200b\u7528\u6237\u200b\u6001\u65f6\u200b\u6062\u590d\u200b\u73b0\u573a\u200b</li> <li>\u200b\u5185\u6838\u200b\u5806\u6808\u200b\uff1a\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u51fd\u6570\u200b\u4e5f\u200b\u662f\u200b\u8981\u200b\u521b\u5efa\u200b\u53d8\u91cf\u200b\u7684\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u53d8\u91cf\u200b\u5728\u200b\u5185\u6838\u200b\u5806\u6808\u200b\u4e0a\u200b\u5206\u914d\u200b</li> </ul> <p></p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_2","title":"\u8fdb\u7a0b\u200b\u5207\u6362","text":"<p>\u200b\u4e3a\u4e86\u200b\u63a7\u5236\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u5185\u6838\u200b\u5fc5\u987b\u200b\u6709\u200b\u80fd\u529b\u200b\u6302\u200b\u8d77\u200b\u6b63\u5728\u200bCPU\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5e76\u200b\u6062\u590d\u200b\u4ee5\u524d\u200b\u6302\u200b\u8d77\u200b\u7684\u200b\u67d0\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\u3002\u200b\u8fd9\u79cd\u200b\u884c\u4e3a\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u8fdb\u7a0b\u200b\u5207\u6362\u200b\u3002\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u8bf4\u200b\uff0c\u200b\u4efb\u4f55\u200b\u8fdb\u7a0b\u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u7684\u200b\u652f\u6301\u200b\u4e0b\u200b\u8fd0\u884c\u200b\u7684\u200b\uff0c\u200b\u662f\u200b\u4e0e\u200b\u5185\u6838\u200b\u7d27\u5bc6\u200b\u76f8\u5173\u200b\u7684\u200b\u3002</p> <p>\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u8fd0\u884c\u200b\u8f6c\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u4e0a\u200b\u8fd0\u884c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7ecf\u8fc7\u200b\u4e0b\u9762\u200b\u8fd9\u4e9b\u200b\u53d8\u5316\u200b\uff1a  </p> <ol> <li>\u200b\u4fdd\u5b58\u200b\u5904\u7406\u673a\u200b\u4e0a\u4e0b\u6587\u200b\uff0c\u200b\u5305\u62ec\u200b\u7a0b\u5e8f\u200b\u8ba1\u6570\u5668\u200b\u548c\u200b\u5176\u4ed6\u200b\u5bc4\u5b58\u5668\u200b\u3002  </li> <li>\u200b\u66f4\u65b0\u200bPCB\u200b\u4fe1\u606f\u200b\u3002  </li> <li>\u200b\u628a\u200b\u8fdb\u7a0b\u200b\u7684\u200bPCB\u200b\u79fb\u5165\u200b\u76f8\u5e94\u200b\u7684\u200b\u961f\u5217\u200b\uff0c\u200b\u5982\u200b\u5c31\u7eea\u200b\u3001\u200b\u5728\u200b\u67d0\u200b\u4e8b\u4ef6\u200b\u963b\u585e\u200b\u7b49\u200b\u961f\u5217\u200b\u3002  </li> <li>\u200b\u9009\u62e9\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u6267\u884c\u200b\uff0c\u200b\u5e76\u200b\u66f4\u65b0\u200b\u5176\u200bPCB\u3002  </li> <li>\u200b\u66f4\u65b0\u200b\u5185\u5b58\u200b\u7ba1\u7406\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u3002  </li> <li>\u200b\u6062\u590d\u200b\u5904\u7406\u673a\u200b\u4e0a\u4e0b\u6587\u200b\u3002</li> </ol>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_3","title":"\u8fdb\u7a0b\u200b\u963b\u585e","text":"<p>\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u7531\u4e8e\u200b\u671f\u5f85\u200b\u7684\u200b\u67d0\u4e9b\u200b\u4e8b\u4ef6\u200b\u672a\u200b\u53d1\u751f\u200b\uff0c\u200b\u5982\u200b\u8bf7\u6c42\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\u5931\u8d25\u200b\u3001\u200b\u7b49\u5f85\u200b\u67d0\u79cd\u200b\u64cd\u4f5c\u200b\u7684\u200b\u5b8c\u6210\u200b\u3001\u200b\u65b0\u200b\u6570\u636e\u200b\u5c1a\u672a\u200b\u5230\u8fbe\u200b\u6216\u200b\u65e0\u200b\u65b0\u200b\u5de5\u4f5c\u200b\u505a\u200b\u7b49\u200b\uff0c\u200b\u5219\u200b\u7531\u200b\u7cfb\u7edf\u200b\u81ea\u52a8\u200b\u6267\u884c\u200b\u963b\u585e\u200b\u539f\u8bed\u200b(Block)\uff0c\u200b\u4f7f\u200b\u81ea\u5df1\u200b\u7531\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\u53d8\u4e3a\u200b\u963b\u585e\u72b6\u6001\u200b\u3002\u200b\u53ef\u89c1\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u963b\u585e\u200b\u662f\u200b\u8fdb\u7a0b\u200b\u81ea\u8eab\u200b\u7684\u200b\u4e00\u79cd\u200b\u4e3b\u52a8\u200b\u884c\u4e3a\u200b\uff0c\u200b\u4e5f\u200b\u56e0\u6b64\u200b\u53ea\u6709\u200b\u5904\u4e8e\u200b\u8fd0\u884c\u200b\u6001\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff08\u200b\u83b7\u5f97\u200bCPU\uff09\uff0c\u200b\u624d\u200b\u53ef\u80fd\u200b\u5c06\u200b\u5176\u200b\u8f6c\u4e3a\u200b\u963b\u585e\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b\u8fdb\u7a0b\u200b\u8fdb\u5165\u200b\u963b\u585e\u72b6\u6001\u200b\uff0c\u200b\u662f\u200b\u4e0d\u200b\u5360\u7528\u200bCPU\u200b\u8d44\u6e90\u200b\u7684\u200b\u3002</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#fd","title":"\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b fd","text":"<p>\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff08File descriptor\uff09 \u200b\u662f\u200b\u8ba1\u7b97\u673a\u79d1\u5b66\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u672f\u8bed\u200b\uff0c\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u8868\u8ff0\u200b\u6307\u5411\u200b\u6587\u4ef6\u200b\u7684\u200b\u5f15\u7528\u200b\u7684\u200b\u62bd\u8c61\u5316\u200b\u6982\u5ff5\u200b\u3002</p> <p>\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u5728\u200b\u5f62\u5f0f\u200b\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u8d1f\u200b\u6574\u6570\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7d22\u5f15\u200b\u503c\u200b\uff0c\u200b\u6307\u5411\u200b\u5185\u6838\u200b\u4e3a\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u6240\u200b\u7ef4\u62a4\u200b\u7684\u200b\u8be5\u200b\u8fdb\u7a0b\u200b\u6253\u5f00\u200b\u6587\u4ef6\u200b\u7684\u200b\u8bb0\u5f55\u8868\u200b\u3002\u200b\u5f53\u200b\u7a0b\u5e8f\u200b\u6253\u5f00\u200b\u4e00\u4e2a\u200b\u73b0\u6709\u200b\u6587\u4ef6\u200b\u6216\u8005\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u6587\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u5185\u6838\u200b\u5411\u200b\u8fdb\u7a0b\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u3002\u200b\u5728\u200b\u7a0b\u5e8f\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6d89\u53ca\u200b\u5e95\u5c42\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u7f16\u5199\u200b\u5f80\u5f80\u200b\u4f1a\u200b\u56f4\u7ed5\u200b\u7740\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u5c55\u5f00\u200b\u3002\u200b\u4f46\u662f\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u8fd9\u4e00\u200b\u6982\u5ff5\u200b\u5f80\u5f80\u200b\u53ea\u200b\u9002\u7528\u200b\u4e8e\u200bUNIX\u3001Linux\u200b\u8fd9\u6837\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u3002</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#io_1","title":"IO \u200b\u6a21\u578b","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u5957\u200b\u63a5\u5b57\u200b\u4e0a\u200b\u7684\u200b\u8f93\u5165\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\u4ece\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u5230\u8fbe\u200b\uff0c\u200b\u5f53\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u65f6\u200b\u88ab\u200b\u590d\u5236\u5230\u200b\u5185\u6838\u200b\u4e2d\u200b\u7684\u200b\u67d0\u4e2a\u200b\u7f13\u51b2\u533a\u200b\u3002\u200b\u7b2c\u4e8c\u6b65\u200b\u5c31\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b</p> <p>Linux \u200b\u6709\u200b\u4e94\u79cd\u200b I/O \u200b\u6a21\u578b\u200b\uff1a</p> <ul> <li>\u200b\u963b\u585e\u200b\u5f0f\u200b I/O</li> <li>\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O</li> <li>I/O \u200b\u590d\u7528\u200b\uff08select \u200b\u548c\u200b poll\uff09</li> <li>\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b\u5f0f\u200b I/O\uff08SIGIO\uff09</li> <li>\u200b\u5f02\u6b65\u200b I/O\uff08AIO\uff09</li> </ul> <p>\u200b\u4e94\u79cd\u200b\u6a21\u578b\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>\u200b\u540c\u6b65\u200b I/O \u200b\u5305\u62ec\u200b\u963b\u585e\u200b\u5f0f\u200b I/O\u3001\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O\u3001I/O \u200b\u590d\u7528\u200b\u548c\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b\u4e3b\u8981\u200b\u533a\u522b\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b\u9636\u6bb5\u200b\uff0c\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O \u3001\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \u200b\u548c\u200b\u5f02\u6b65\u200b I/O \u200b\u5728\u200b\u7b2c\u4e00\u9636\u6bb5\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b</li> <li>\u200b\u540c\u6b65\u200b I/O\uff1a\u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u7684\u200b\u9636\u6bb5\u200b\uff08\u200b\u7b2c\u4e8c\u9636\u6bb5\u200b\uff09\uff0c\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4f1a\u200b\u963b\u585e\u200b</li> <li>\u200b\u5f02\u6b65\u200b I/O\uff1a\u200b\u7b2c\u4e8c\u9636\u6bb5\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b</li> </ul>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#io-bio","title":"\u963b\u585e\u200b IO (BIO)","text":"<p>\u200b\u5728\u200blinux\u200b\u4e2d\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6240\u6709\u200b\u7684\u200bsocket\u200b\u90fd\u200b\u662f\u200bblocking\uff0c\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u6d41\u7a0b\u200b\u5927\u6982\u200b\u662f\u200b\u8fd9\u6837\u200b\uff1a</p> <p></p> <p>\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u901a\u8fc7\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b recvfrom \u200b\u63a5\u6536\u6570\u636e\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u76f4\u5230\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u624d\u200b\u8fd4\u56de\u200b\u3002\u200b\u963b\u585e\u200b\u4e0d\u200b\u610f\u5473\u7740\u200b\u6574\u4e2a\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u90fd\u200b\u88ab\u200b\u963b\u585e\u200b\uff0c\u200b\u5176\u5b83\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\uff0c\u200b\u53ea\u662f\u200b\u5f53\u524d\u200b\u963b\u585e\u200b\u8fdb\u7a0b\u200b\u4e0d\u200b\u6d88\u8017\u200b CPU \u200b\u65f6\u95f4\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u7684\u200b CPU \u200b\u5229\u7528\u7387\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u9ad8\u200b</p> <p>recvfrom() \u200b\u7528\u4e8e\u200b\u63a5\u6536\u200b Socket \u200b\u4f20\u6765\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b buf \u200b\u4e2d\u200b\uff0c\u200b\u628a\u200b recvfrom() \u200b\u5f53\u6210\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b</p> <p>Blocking IO\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\u5728\u200bIO\u200b\u6267\u884c\u200b\u7684\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\u90fd\u200b\u88ab\u200bblock\u200b\u4e86\u200b</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#io-nio","title":"\u975e\u200b\u963b\u585e\u200b IO (NIO)","text":"<p>linux\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8bbe\u7f6e\u200bsocket\u200b\u4f7f\u200b\u5176\u200b\u53d8\u4e3a\u200bnon-blocking\u3002\u200b\u5f53\u5bf9\u200b\u4e00\u4e2a\u200bnon-blocking socket\u200b\u6267\u884c\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u6d41\u7a0b\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u6837\u5b50\u200b\uff1a</p> <p></p> <p>\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u901a\u8fc7\u200b recvfrom \u200b\u8c03\u7528\u200b\u4e0d\u505c\u200b\u7684\u200b\u53bb\u200b\u548c\u200b\u5185\u6838\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u76f4\u5230\u200b\u5185\u6838\u200b\u51c6\u5907\u200b\u597d\u200b\u6570\u636e\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u51c6\u5907\u200b\u597d\u200b\u6570\u636e\u200b\uff0c\u200b\u5185\u6838\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u9519\u8bef\u7801\u200b\uff0c\u200b\u8fc7\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u518d\u200b\u6267\u884c\u200b recvfrom \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5728\u200b\u4e24\u6b21\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u95f4\u6bb5\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u79f0\u4e3a\u200b\u8f6e\u8be2\u200b\uff08polling\uff09</p> <p>\u200b\u7531\u4e8e\u200b CPU \u200b\u8981\u200b\u5904\u7406\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u7684\u200b CPU \u200b\u5229\u7528\u7387\u200b\u6bd4\u8f83\u200b\u4f4e\u200b</p> <p>Nonblocking IO\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u9700\u8981\u200b\u4e0d\u65ad\u200b\u7684\u200b\u4e3b\u52a8\u200b\u8be2\u95ee\u200bkernel\u200b\u6570\u636e\u200b\u597d\u200b\u4e86\u200b\u6ca1\u6709\u200b</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#io-signal-driven-io","title":"\u4fe1\u53f7\u200b\u9a71\u52a8\u200b IO (signal driven IO)","text":"<p>\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4f7f\u7528\u200b sigaction \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5185\u6838\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\u9636\u6bb5\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u662f\u975e\u200b\u963b\u585e\u200b\u7684\u200b\u3002\u200b\u5f53\u200b\u5185\u6838\u200b\u6570\u636e\u200b\u51c6\u5907\u5c31\u7eea\u200b\u65f6\u5411\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u53d1\u9001\u200b SIGIO \u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u6536\u5230\u200b\u4e4b\u540e\u200b\u5728\u200b\u4fe1\u53f7\u5904\u7406\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u8c03\u7528\u200b recvfrom \u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200b\u5185\u6838\u200b\u590d\u5236\u5230\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u4e2d\u200b</p> <p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u975e\u200b\u963b\u585e\u200b\u5f0f\u200b I/O \u200b\u7684\u200b\u8f6e\u8be2\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4fe1\u53f7\u200b\u9a71\u52a8\u200b I/O \u200b\u7684\u200b CPU \u200b\u5229\u7528\u7387\u200b\u66f4\u9ad8\u200b</p> <p></p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#io-io-multiplexing","title":"I/O \u200b\u591a\u8def\u590d\u7528\u200b (IO multiplexing)","text":"<p>IO multiplexing\u200b\u5c31\u662f\u200b\u6211\u4eec\u200b\u8bf4\u200b\u7684\u200bselect\uff0cpoll\uff0cepoll\uff0c\u200b\u6709\u4e9b\u200b\u5730\u65b9\u200b\u4e5f\u200b\u79f0\u200b\u8fd9\u79cd\u200bIO\u200b\u65b9\u5f0f\u200b\u4e3a\u200bevent driven IO\u3002select/epoll\u200b\u7684\u200b\u597d\u5904\u200b\u5c31\u200b\u5728\u4e8e\u200b\u5355\u4e2a\u200bprocess\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u5904\u7406\u200b\u591a\u4e2a\u200b\u7f51\u7edc\u8fde\u63a5\u200b\u7684\u200bIO\u3002\u200b\u5b83\u200b\u7684\u200b\u57fa\u672c\u539f\u7406\u200b\u5c31\u662f\u200bselect\uff0cpoll\uff0cepoll\u200b\u8fd9\u4e2a\u200bfunction\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u7684\u200b\u8f6e\u8be2\u200b\u6240\u200b\u8d1f\u8d23\u200b\u7684\u200b\u6240\u6709\u200bsocket\uff0c\u200b\u5f53\u200b\u67d0\u4e2a\u200bsocket\u200b\u6709\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u901a\u77e5\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u3002</p> <p></p> <p>\u200b\u5f53\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u8c03\u7528\u200b\u4e86\u200bselect\uff0c\u200b\u90a3\u4e48\u200b\u6574\u4e2a\u200b\u8fdb\u7a0b\u200b\u4f1a\u200b\u88ab\u200bblock\uff0c\u200b\u800c\u200b\u540c\u65f6\u200b\uff0ckernel\u200b\u4f1a\u200b\u201c\u200b\u76d1\u89c6\u200b\u201d\u200b\u6240\u6709\u200bselect\u200b\u8d1f\u8d23\u200b\u7684\u200bsocket\uff0c\u200b\u5f53\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200bsocket\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u51c6\u5907\u200b\u597d\u200b\u4e86\u200b\uff0cselect\u200b\u5c31\u200b\u4f1a\u200b\u8fd4\u56de\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u518d\u200b\u8c03\u7528\u200bread\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200bkernel\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u3002</p> <p>\u200b\u6240\u4ee5\u200b\uff0cI/O \u200b\u591a\u8def\u590d\u7528\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\u901a\u8fc7\u200b\u4e00\u79cd\u200b\u673a\u5236\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u80fd\u200b\u540c\u65f6\u200b\u7b49\u5f85\u200b\u591a\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e9b\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff08\u200b\u5957\u200b\u63a5\u5b57\u200b\u63cf\u8ff0\u7b26\u200b\uff09\u200b\u5176\u4e2d\u200b\u7684\u200b\u4efb\u610f\u200b\u4e00\u4e2a\u200b\u8fdb\u5165\u200b\u8bfb\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b\uff0cselect()\u200b\u51fd\u6570\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fd4\u56de\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u56fe\u200b\u548c\u200bblocking IO\u200b\u7684\u200b\u56fe\u200b\u5176\u5b9e\u200b\u5e76\u200b\u6ca1\u6709\u200b\u592a\u5927\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0c\u200b\u8fd8\u200b\u66f4\u200b\u5dee\u200b\u4e00\u4e9b\u200b\u3002\u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u4e24\u4e2a\u200bsystem call (select \u200b\u548c\u200b recvfrom)\uff0c\u200b\u800c\u200bblocking IO\u200b\u53ea\u200b\u8c03\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200bsystem call (recvfrom)\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u7528\u200bselect\u200b\u7684\u200b\u4f18\u52bf\u200b\u5728\u4e8e\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u5904\u7406\u200b\u591a\u4e2a\u200bconnection\u3002</p> <p>\u200b\u6240\u4ee5\u200b\uff0c\u200b\u5982\u679c\u200b\u5904\u7406\u200b\u7684\u200b\u8fde\u63a5\u6570\u200b\u4e0d\u662f\u200b\u5f88\u200b\u9ad8\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4f7f\u7528\u200bselect/epoll\u200b\u7684\u200bweb server\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u6bd4\u200b\u4f7f\u7528\u200bmulti-threading + blocking IO\u200b\u7684\u200bweb server\u200b\u6027\u80fd\u200b\u66f4\u597d\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5ef6\u8fdf\u200b\u8fd8\u200b\u66f4\u200b\u5927\u200b\u3002select/epoll\u200b\u7684\u200b\u4f18\u52bf\u200b\u5e76\u200b\u4e0d\u662f\u200b\u5bf9\u4e8e\u200b\u5355\u4e2a\u200b\u8fde\u63a5\u200b\u80fd\u200b\u5904\u7406\u200b\u5f97\u200b\u66f4\u200b\u5feb\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u4e8e\u200b\u80fd\u200b\u5904\u7406\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u8fde\u63a5\u200b\u3002\uff09</p> <p>\u200b\u5728\u200bIO multiplexing Model\u200b\u4e2d\u200b\uff0c\u200b\u5b9e\u9645\u200b\u4e2d\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6bcf\u200b\u4e00\u4e2a\u200bsocket\uff0c\u200b\u4e00\u822c\u200b\u90fd\u200b\u8bbe\u7f6e\u200b\u6210\u4e3a\u200bnon-blocking\uff0c\u200b\u4f46\u662f\u200b\uff0c\u200b\u5982\u4e0a\u56fe\u200b\u6240\u793a\u200b\uff0c\u200b\u6574\u4e2a\u200b\u7528\u6237\u200b\u7684\u200bprocess\u200b\u5176\u5b9e\u200b\u662f\u200b\u4e00\u76f4\u200b\u88ab\u200bblock\u200b\u7684\u200b\u3002\u200b\u53ea\u4e0d\u8fc7\u200bprocess\u200b\u662f\u200b\u88ab\u200bselect\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200bblock\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u88ab\u200bsocket IO\u200b\u7ed9\u200bblock\u3002</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#io-aio","title":"\u5f02\u6b65\u200b IO (AIO)","text":"<p>\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u53d1\u8d77\u200bread\u200b\u64cd\u4f5c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u7acb\u523b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f00\u59cb\u200b\u53bb\u200b\u505a\u200b\u5176\u5b83\u200b\u7684\u200b\u4e8b\u200b\u3002\u200b\u800c\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u4ece\u200bkernel\u200b\u7684\u200b\u89d2\u5ea6\u200b\uff0c\u200b\u5f53\u200b\u5b83\u200b\u53d7\u5230\u200b\u4e00\u4e2a\u200basynchronous read\u200b\u4e4b\u540e\u200b\uff0c\u200b\u9996\u5148\u200b\u5b83\u4f1a\u200b\u7acb\u523b\u200b\u8fd4\u56de\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u4f1a\u200b\u5bf9\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u4ea7\u751f\u200b\u4efb\u4f55\u200bblock\u3002\u200b\u7136\u540e\u200b\uff0ckernel\u200b\u4f1a\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\u51c6\u5907\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7136\u540e\u200b\u5c06\u200b\u6570\u636e\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u5185\u5b58\u200b\uff0c\u200b\u5f53\u200b\u8fd9\u200b\u4e00\u5207\u200b\u90fd\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\uff0ckernel\u200b\u4f1a\u200b\u7ed9\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200bsignal\uff0c\u200b\u544a\u8bc9\u200b\u5b83\u200bread\u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u4e86\u200b\u3002</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_4","title":"\u603b\u7ed3","text":"<p>blocking\u200b\u548c\u200bnon-blocking\u200b\u7684\u200b\u533a\u522b\u200b</p> <p>\u200b\u8c03\u7528\u200bblocking IO\u200b\u4f1a\u200b\u4e00\u76f4\u200bblock\u200b\u4f4f\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u76f4\u5230\u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u800c\u200bnon-blocking IO\u200b\u5728\u200bkernel\u200b\u8fd8\u200b\u51c6\u5907\u200b\u6570\u636e\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u4f1a\u200b\u7acb\u523b\u200b\u8fd4\u56de\u200b\u3002</p> <p></p> <p>synchronous IO\u200b\u548c\u200basynchronous IO\u200b\u7684\u200b\u533a\u522b\u200b</p> <p>\u200b\u5728\u200b\u8bf4\u660e\u200bsynchronous IO\u200b\u548c\u200basynchronous IO\u200b\u7684\u200b\u533a\u522b\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u7ed9\u51fa\u200b\u4e24\u8005\u200b\u7684\u200b\u5b9a\u4e49\u200b\u3002POSIX\u200b\u7684\u200b\u5b9a\u4e49\u200b\u662f\u200b\u8fd9\u200b\u6837\u5b50\u200b\u7684\u200b\uff1a  </p> <ul> <li>A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;  </li> <li>An asynchronous I/O operation does not cause the requesting process to be blocked;</li> </ul> <p>\u200b\u4e24\u8005\u200b\u7684\u200b\u533a\u522b\u200b\u5c31\u200b\u5728\u4e8e\u200bsynchronous IO\u200b\u505a\u200b\u201dIO operation\u201d\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u5c06\u200bprocess\u200b\u963b\u585e\u200b\u3002\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u4e4b\u524d\u200b\u6240\u8ff0\u200b\u7684\u200bblocking IO\uff0cnon-blocking IO\uff0cIO multiplexing\u200b\u90fd\u200b\u5c5e\u4e8e\u200bsynchronous IO\u3002</p> <p>\u200b\u6709\u4eba\u200b\u4f1a\u200b\u8bf4\u200b\uff0cnon-blocking IO\u200b\u5e76\u200b\u6ca1\u6709\u200b\u88ab\u200bblock\u200b\u554a\u200b\u3002\u200b\u8fd9\u91cc\u200b\u6709\u4e2a\u200b\u975e\u5e38\u200b\u201c\u200b\u72e1\u733e\u200b\u201d\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u4e2d\u200b\u6240\u6307\u200b\u7684\u200b\u201dIO operation\u201d\u200b\u662f\u200b\u6307\u200b\u771f\u5b9e\u200b\u7684\u200bIO\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5c31\u662f\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\u7684\u200brecvfrom\u200b\u8fd9\u4e2a\u200bsystem call\u3002non-blocking IO\u200b\u5728\u200b\u6267\u884c\u200brecvfrom\u200b\u8fd9\u4e2a\u200bsystem call\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200bkernel\u200b\u7684\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u51c6\u5907\u200b\u597d\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u4e0d\u4f1a\u200bblock\u200b\u8fdb\u7a0b\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5f53\u200bkernel\u200b\u4e2d\u200b\u6570\u636e\u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0crecvfrom\u200b\u4f1a\u200b\u5c06\u200b\u6570\u636e\u200b\u4ece\u200bkernel\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u5185\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u8fdb\u7a0b\u200b\u662f\u200b\u88ab\u200bblock\u200b\u4e86\u200b\uff0c\u200b\u5728\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u662f\u200b\u88ab\u200bblock\u200b\u7684\u200b\u3002</p> <p>\u200b\u800c\u200basynchronous IO\u200b\u5219\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u5f53\u200b\u8fdb\u7a0b\u200b\u53d1\u8d77\u200bIO \u200b\u64cd\u4f5c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u518d\u4e5f\u200b\u4e0d\u200b\u7406\u776c\u200b\u4e86\u200b\uff0c\u200b\u76f4\u5230\u200bkernel\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u544a\u8bc9\u200b\u8fdb\u7a0b\u200b\u8bf4\u200bIO\u200b\u5b8c\u6210\u200b\u3002\u200b\u5728\u200b\u8fd9\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u5b8c\u5168\u200b\u6ca1\u6709\u200b\u88ab\u200bblock\u3002</p> <p>\u200b\u5404\u4e2a\u200bIO Model\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5982\u56fe\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u901a\u8fc7\u200b\u4e0a\u9762\u200b\u7684\u200b\u56fe\u7247\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200bnon-blocking IO\u200b\u548c\u200basynchronous IO\u200b\u7684\u200b\u533a\u522b\u200b\u8fd8\u662f\u200b\u5f88\u200b\u660e\u663e\u200b\u7684\u200b\u3002\u200b\u5728\u200bnon-blocking IO\u200b\u4e2d\u200b\uff0c\u200b\u867d\u7136\u200b\u8fdb\u7a0b\u200b\u5927\u90e8\u5206\u200b\u65f6\u95f4\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u88ab\u200bblock\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u4ecd\u7136\u200b\u8981\u6c42\u200b\u8fdb\u7a0b\u200b\u53bb\u200b\u4e3b\u52a8\u200b\u7684\u200bcheck\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u200b\u6570\u636e\u200b\u51c6\u5907\u200b\u5b8c\u6210\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u8fdb\u7a0b\u200b\u4e3b\u52a8\u200b\u7684\u200b\u518d\u6b21\u200b\u8c03\u7528\u200brecvfrom\u200b\u6765\u200b\u5c06\u200b\u6570\u636e\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u5185\u5b58\u200b\u3002\u200b\u800c\u200basynchronous IO\u200b\u5219\u200b\u5b8c\u5168\u200b\u4e0d\u540c\u200b\u3002\u200b\u5b83\u200b\u5c31\u200b\u50cf\u662f\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u5c06\u200b\u6574\u4e2a\u200bIO\u200b\u64cd\u4f5c\u200b\u4ea4\u7ed9\u200b\u4e86\u200b\u4ed6\u4eba\u200b\uff08kernel\uff09\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7136\u540e\u200b\u4ed6\u4eba\u200b\u505a\u200b\u5b8c\u540e\u200b\u53d1\u4fe1\u53f7\u200b\u901a\u77e5\u200b\u3002\u200b\u5728\u6b64\u671f\u95f4\u200b\uff0c\u200b\u7528\u6237\u200b\u8fdb\u7a0b\u200b\u4e0d\u200b\u9700\u8981\u200b\u53bb\u200b\u68c0\u67e5\u200bIO\u200b\u64cd\u4f5c\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e3b\u52a8\u200b\u7684\u200b\u53bb\u200b\u62f7\u8d1d\u200b\u6570\u636e\u200b\u3002</p>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_5","title":"\u591a\u8def\u590d\u7528","text":"","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#select","title":"select","text":"","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_6","title":"\u51fd\u6570","text":"<p>Socket \u200b\u4e0d\u662f\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b\u6807\u8bc6\u7b26\u200b\uff0c\u200b\u4f46\u662f\u200b Unix \u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u628a\u200b\u6240\u6709\u200b\u4e1c\u897f\u200b\u90fd\u200b\u770b\u4f5c\u200b\u662f\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6240\u4ee5\u200b Socket \u200b\u8bf4\u6210\u200b file descriptor\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b fd</p> <p>select \u200b\u5141\u8bb8\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u76d1\u89c6\u200b\u4e00\u7ec4\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u7b49\u5f85\u200b\u4e00\u4e2a\u200b\u6216\u8005\u200b\u591a\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\u6210\u4e3a\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b8c\u6210\u200b I/O \u200b\u64cd\u4f5c\u200b\u3002</p> C<pre><code>int select(int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);\n</code></pre> <ul> <li>fd_set \u200b\u4f7f\u7528\u200b bitmap \u200b\u6570\u7ec4\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6570\u7ec4\u200b\u5927\u5c0f\u200b\u7528\u200b FD_SETSIZE \u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5355\u200b\u8fdb\u7a0b\u200b\u53ea\u80fd\u200b\u76d1\u542c\u200b\u5c11\u4e8e\u200b FD_SETSIZE \u200b\u6570\u91cf\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\uff0c32 \u200b\u4f4d\u673a\u200b\u9ed8\u8ba4\u200b\u662f\u200b 1024 \u200b\u4e2a\u200b\uff0c64 \u200b\u4f4d\u673a\u200b\u9ed8\u8ba4\u200b\u662f\u200b 2048\uff0c\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff0c\u200b\u7136\u540e\u200b\u91cd\u65b0\u200b\u7f16\u8bd1\u200b\u5185\u6838\u200b</li> <li>fd_set \u200b\u6709\u200b\u4e09\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\uff1areadset\u3001writeset\u3001exceptset\uff0c\u200b\u5bf9\u5e94\u200b\u8bfb\u200b\u3001\u200b\u5199\u200b\u3001\u200b\u5f02\u5e38\u200b\u6761\u4ef6\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u96c6\u5408\u200b</li> <li>n \u200b\u662f\u200b\u76d1\u6d4b\u200b\u7684\u200b socket \u200b\u7684\u200b\u6700\u5927\u200b\u6570\u91cf\u200b</li> <li>timeout \u200b\u4e3a\u200b\u8d85\u65f6\u200b\u53c2\u6570\u200b\uff0c\u200b\u8c03\u7528\u200b select \u200b\u4f1a\u200b\u4e00\u76f4\u200b\u963b\u585e\u200b\u76f4\u5230\u200b\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5230\u8fbe\u200b\u6216\u8005\u200b\u7b49\u5f85\u200b\u7684\u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b timeout</li> </ul> C<pre><code>struct timeval{\n    long tv_sec;  //\u200b\u79d2\u200b\n    long tv_usec; //\u200b\u5fae\u79d2\u200b\n}\n</code></pre> <ul> <li>timeout == null\uff1a\u200b\u7b49\u5f85\u200b\u65e0\u9650\u200b\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>tv_sec == 0 &amp;&amp; tv_usec == 0\uff1a\u200b\u83b7\u53d6\u200b\u540e\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\uff0c\u200b\u4e0d\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b</li> <li>tv_sec != 0 || tv_usec != 0\uff1a\u200b\u7b49\u5f85\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u65b9\u6cd5\u200b\u6210\u529f\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e3a\u200b\u5c31\u7eea\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u4e2a\u6570\u200b\uff0c\u200b\u51fa\u9519\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e3a\u200b -1\uff0c\u200b\u8d85\u65f6\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e3a\u200b 0</li> </ul> <p>Linux \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u7ec4\u200b\u5b8f\u4e3a\u200b fd_set \u200b\u8fdb\u884c\u200b\u8d4b\u503c\u200b\u64cd\u4f5c\u200b\uff1a</p> C<pre><code>int FD_ZERO(fd_set *fdset);         // \u200b\u5c06\u200b\u4e00\u4e2a\u200b fd_set \u200b\u7c7b\u578b\u200b\u53d8\u91cf\u200b\u7684\u200b\u6240\u6709\u200b\u503c\u200b\u90fd\u200b\u7f6e\u200b\u4e3a\u200b 0\nint FD_CLR(int fd, fd_set *fdset);  // \u200b\u5c06\u200b\u4e00\u4e2a\u200b fd_set \u200b\u7c7b\u578b\u200b\u53d8\u91cf\u200b\u7684\u200b fd \u200b\u4f4d\u7f6e\u200b\u4e3a\u200b 0\nint FD_SET(int fd, fd_set *fdset);  // \u200b\u5c06\u200b\u4e00\u4e2a\u200b fd_set \u200b\u7c7b\u578b\u200b\u53d8\u91cf\u200b\u7684\u200b fd \u200b\u4f4d\u7f6e\u200b\u4e3a\u200b 1\nint FD_ISSET(int fd, fd_set *fdset);// \u200b\u5224\u65ad\u200b fd \u200b\u4f4d\u200b\u662f\u5426\u200b\u88ab\u200b\u7f6e\u200b\u4e3a\u200b 1\n</code></pre> <p>\u200b\u793a\u4f8b\u200b\uff1a</p> C<pre><code>sockfd = socket(AF_INET, SOCK_STREAM, 0);\nmemset(&amp;addr, 0, sizeof(addr)));\naddr.sin_family = AF_INET;\naddr.sin_port = htons(2000);\naddr.sin_addr.s_addr = INADDR_ANY;\nbind(sockfd, (struct sockaddr*)&amp;addr, sizeof(addr));//\u200b\u7ed1\u5b9a\u200b\u8fde\u63a5\u200b\nlisten(sockfd, 5);//\u200b\u76d1\u542c\u200b5\u200b\u4e2a\u200b\u7aef\u53e3\u200b\nfor(i = 0; i &lt; 5; i++) {\n    memset(&amp;client, e, sizeof(client));\n    addrlen = sizeof(client);\n    fds[i] = accept(sockfd, (struct sockaddr*)&amp;client, &amp;addrlen);\n    //\u200b\u5c06\u200b\u76d1\u542c\u200b\u7684\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200bfd\u200b\u5b58\u5165\u200bfds\uff1a[3,4,5,6,7]\n    if(fds[i] &gt; max)\n        max = fds[i];\n}\nwhile(1) {\n    FD_ZERO(&amp;rset);//\u200b\u7f6e\u200b\u4e3a\u200b0\n    for(i = 0; i &lt; 5; i++) {\n        FD_SET(fds[i], &amp;rset);//\u200b\u5bf9\u5e94\u200b\u4f4d\u7f6e\u200b1 [0001 1111 00.....]\n    }\n    print(\"round again\");\n    select(max + 1, &amp;rset, NULL, NULL, NULL);//\u200b\u76d1\u542c\u200b\n\n    for(i = 0; i &lt;5; i++) {\n        if(FD_ISSET(fds[i], &amp;rset)) {//\u200b\u5224\u65ad\u200b\u76d1\u542c\u200b\u54ea\u200b\u4e00\u4e2a\u200b\u7aef\u53e3\u200b\n            memset(buffer, 0, MAXBUF);\n            read(fds[i], buffer, MAXBUF);//\u200b\u8fdb\u5165\u200b\u5185\u6838\u200b\u6001\u200b\u8bfb\u6570\u636e\u200b\n            print(buffer);\n        }\n    }\n}\n</code></pre>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_7","title":"\u6d41\u7a0b","text":"<p>select \u200b\u8c03\u7528\u200b\u6d41\u7a0b\u56fe\u200b\uff1a</p> <p></p> <ol> <li>\u200b\u4f7f\u7528\u200b copy_from_user \u200b\u4ece\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u62f7\u8d1d\u200b fd_set \u200b\u5230\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u963b\u585e\u200b</li> <li>\u200b\u6ce8\u518c\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b _pollwait</li> <li>\u200b\u904d\u5386\u200b\u6240\u6709\u200b fd\uff0c\u200b\u8c03\u7528\u200b\u5176\u200b\u5bf9\u5e94\u200b\u7684\u200b poll \u200b\u65b9\u6cd5\u200b\u5224\u65ad\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u662f\u5426\u200b\u51c6\u5907\u5c31\u7eea\u200b\uff0c\u200b\u5bf9\u4e8e\u200b socket\uff0c\u200b\u8fd9\u4e2a\u200b poll \u200b\u65b9\u6cd5\u200b\u662f\u200b sock_poll\uff0csock_poll \u200b\u6839\u636e\u200b\u60c5\u51b5\u200b\u4f1a\u200b\u8c03\u7528\u200b\u5230\u200b tcp_poll\u3001udp_poll \u200b\u6216\u8005\u200b datagram_poll\uff0c\u200b\u4ee5\u200b tcp_poll \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5176\u200b\u6838\u5fc3\u200b\u5b9e\u73b0\u200b\u5c31\u662f\u200b _pollwait</li> <li>_pollwait \u200b\u628a\u200b current\uff08\u200b\u8c03\u7528\u200b select \u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff09\u200b\u6302\u5230\u200b\u8bbe\u5907\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u4e0d\u540c\u200b\u8bbe\u5907\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u5bf9\u4e8e\u200b tcp_poll \uff0c\u200b\u5176\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u662f\u200b sk \u2192 sk_sleep\uff08\u200b\u628a\u200b\u8fdb\u7a0b\u200b\u6302\u5230\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u200b\u5e76\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u8fdb\u7a0b\u200b\u5df2\u7ecf\u200b\u7761\u7720\u200b\uff09\uff0c\u200b\u5728\u200b\u8bbe\u5907\u200b\u6536\u5230\u200b\u6d88\u606f\u200b\uff08\u200b\u7f51\u7edc\u8bbe\u5907\u200b\uff09\u200b\u6216\u200b\u586b\u5199\u200b\u5b8c\u200b\u6587\u4ef6\u200b\u6570\u636e\u200b\uff08\u200b\u78c1\u76d8\u200b\u8bbe\u5907\u200b\uff09\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u5524\u9192\u200b\u8bbe\u5907\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0a\u200b\u7761\u7720\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u8fd9\u65f6\u200b current \u200b\u4fbf\u200b\u88ab\u200b\u5524\u9192\u200b\uff0c\u200b\u8fdb\u5165\u200b\u5c31\u7eea\u200b\u961f\u5217\u200b</li> <li>poll \u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u65f6\u4f1a\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u63cf\u8ff0\u200b\u8bfb\u5199\u64cd\u4f5c\u200b\u662f\u5426\u200b\u5c31\u7eea\u200b\u7684\u200b mask \u200b\u63a9\u7801\u200b\uff0c\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b mask \u200b\u63a9\u7801\u200b\u7ed9\u200b fd_set \u200b\u8d4b\u503c\u200b</li> <li>\u200b\u5982\u679c\u200b\u904d\u5386\u200b\u5b8c\u200b\u6240\u6709\u200b\u7684\u200b fd\uff0c\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u53ef\u200b\u8bfb\u5199\u200b\u7684\u200b mask \u200b\u63a9\u7801\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u8c03\u7528\u200b schedule_timeout \u200b\u8ba9\u200b current \u200b\u8fdb\u7a0b\u200b\u8fdb\u5165\u200b\u7761\u7720\u200b\u3002\u200b\u5f53\u200b\u8bbe\u5907\u200b\u9a71\u52a8\u200b\u53d1\u751f\u200b\u81ea\u8eab\u200b\u8d44\u6e90\u200b\u53ef\u200b\u8bfb\u5199\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u5524\u9192\u200b\u5176\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0a\u200b\u7761\u7720\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u4e00\u5b9a\u200b\u7684\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff08schedule_timeout\uff09\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5524\u9192\u200b\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b select \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u4f1a\u200b\u91cd\u65b0\u200b\u88ab\u200b\u5524\u9192\u200b\u83b7\u5f97\u200b CPU\uff0c\u200b\u8fdb\u800c\u200b\u91cd\u65b0\u200b\u904d\u5386\u200b fd\uff0c\u200b\u5224\u65ad\u200b\u6709\u6ca1\u6709\u200b\u5c31\u7eea\u200b\u7684\u200b fd</li> <li>\u200b\u628a\u200b fd_set \u200b\u4ece\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u62f7\u8d1d\u5230\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u963b\u585e\u200b\u8fdb\u7a0b\u200b\u7ee7\u7eed\u6267\u884c\u200b</li> </ol>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#poll","title":"poll","text":"<p>poll \u200b\u7684\u200b\u529f\u80fd\u200b\u4e0e\u200b select \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7b49\u5f85\u200b\u4e00\u7ec4\u200b\u63cf\u8ff0\u7b26\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6210\u4e3a\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b</p> C<pre><code>int poll(struct pollfd *fds, unsigned int nfds, int timeout);\n</code></pre> <p>poll \u200b\u4e2d\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u662f\u200b pollfd \u200b\u7c7b\u578b\u200b\u7684\u200b\u6570\u7ec4\u200b\uff0cpollfd \u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> C<pre><code>struct pollfd {\n    int   fd;         /* file descriptor */\n    short events;     /* requested events */\n    short revents;    /* returned events */\n};\n</code></pre> <p>select \u200b\u548c\u200b poll \u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>select \u200b\u4f1a\u200b\u4fee\u6539\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u800c\u200b poll \u200b\u4e0d\u4f1a\u200b</li> <li>select \u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u7c7b\u578b\u200b\u4f7f\u7528\u200b\u6570\u7ec4\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u9650\u5236\u200b\uff1b\u200b\u800c\u200b poll \u200b\u4f7f\u7528\u200b\u94fe\u8868\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6ca1\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u91cf\u200b\u7684\u200b\u9650\u5236\u200b</li> <li>poll \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bf9\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u91cd\u590d\u200b\u5229\u7528\u200b\u4e0a\u200b\u6bd4\u200b select \u200b\u9ad8\u200b</li> <li>select \u200b\u548c\u200b poll \u200b\u901f\u5ea6\u200b\u90fd\u200b\u6bd4\u8f83\u6162\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u8c03\u7528\u200b\u90fd\u200b\u9700\u8981\u200b\u5c06\u200b\u5168\u90e8\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u7ec4\u200b fd \u200b\u4ece\u200b\u5e94\u7528\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u590d\u5236\u5230\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u540c\u65f6\u200b\u6bcf\u6b21\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b\u5185\u6838\u200b\u904d\u5386\u200b\u4f20\u9012\u200b\u8fdb\u6765\u200b\u7684\u200b\u6240\u6709\u200b fd \uff0c\u200b\u8fd9\u4e2a\u200b\u5f00\u9500\u200b\u5728\u200b fd \u200b\u5f88\u591a\u200b\u65f6\u4f1a\u200b\u5f88\u5927\u200b</li> <li>\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b\u7684\u200b\u7cfb\u7edf\u200b\u90fd\u200b\u652f\u6301\u200b select\uff0c\u200b\u4f46\u662f\u200b\u53ea\u6709\u200b\u6bd4\u8f83\u200b\u65b0\u200b\u7684\u200b\u7cfb\u7edf\u200b\u652f\u6301\u200b poll</li> <li>select \u200b\u548c\u200b poll \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b O(n)\uff0c\u200b\u5bf9\u200b socket \u200b\u8fdb\u884c\u200b\u626b\u63cf\u200b\u65f6\u200b\u662f\u200b\u7ebf\u6027\u200b\u626b\u63cf\u200b\uff0c\u200b\u5373\u200b\u91c7\u7528\u200b\u8f6e\u8be2\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6548\u7387\u200b\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5e76\u4e0d\u77e5\u9053\u200b\u5177\u4f53\u200b\u662f\u200b\u54ea\u4e2a\u200b socket \u200b\u5177\u6709\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u6240\u4ee5\u200b\u968f\u7740\u200b fd \u200b\u6570\u91cf\u200b\u7684\u200b\u589e\u52a0\u200b\u4f1a\u200b\u9020\u6210\u200b\u904d\u5386\u200b\u901f\u5ea6\u6162\u200b\u7684\u200b\u7ebf\u6027\u200b\u4e0b\u964d\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b</li> <li>poll \u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u7279\u70b9\u200b\u662f\u200b\u6c34\u5e73\u200b\u89e6\u53d1\u200b\uff0c\u200b\u5982\u679c\u200b\u62a5\u544a\u200b\u4e86\u200b fd \u200b\u540e\u200b\uff0c\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5904\u7406\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e0b\u6b21\u200b poll \u200b\u65f6\u4f1a\u200b\u518d\u6b21\u200b\u62a5\u544a\u200b\u8be5\u200b fd</li> <li>\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u200b\u67d0\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\u8c03\u7528\u200b\u4e86\u200b select \u200b\u6216\u8005\u200b poll\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5173\u95ed\u200b\u4e86\u200b\u8be5\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u8c03\u7528\u200b\u7ed3\u679c\u200b\u4e0d\u200b\u786e\u5b9a\u200b</li> </ul>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#epoll","title":"epoll","text":"","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_8","title":"\u51fd\u6570","text":"<p>epoll \u200b\u4f7f\u7528\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u5c31\u7eea\u200b\u901a\u77e5\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u901a\u8fc7\u200b epoll_ctl() \u200b\u5411\u200b\u5185\u6838\u200b\u6ce8\u518c\u200b\u65b0\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u6216\u8005\u200b\u662f\u200b\u6539\u53d8\u200b\u67d0\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u5df2\u200b\u6ce8\u518c\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u5728\u200b\u5185\u6838\u200b\u4e2d\u4f1a\u200b\u88ab\u200b\u7ef4\u62a4\u200b\u5728\u200b\u4e00\u68f5\u200b\u7ea2\u9ed1\u200b\u6811\u4e0a\u200b\uff0c\u200b\u4e00\u65e6\u200b\u8be5\u200b fd \u200b\u5c31\u7eea\u200b\uff0c\u200b\u5185\u6838\u200b\u901a\u8fc7\u200b callback \u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u5c06\u200b I/O \u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u52a0\u5165\u200b\u5230\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u4e2d\u200b\u7ba1\u7406\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u8c03\u7528\u200b epoll_wait() \u200b\u4fbf\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4e8b\u4ef6\u200b\u5c31\u7eea\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b</p> C<pre><code>int epoll_create(int size);\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)\uff1b\nint epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);\n</code></pre> <ul> <li>epall_create\uff1a\u200b\u4e00\u4e2a\u200b\u7cfb\u7edf\u200b\u51fd\u6570\u200b\uff0c\u200b\u51fd\u6570\u200b\u5c06\u200b\u5728\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u5185\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b epoll \u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b epoll \u200b\u7ed3\u6784\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8fd4\u56de\u503c\u200b\u4e3a\u200b epoll \u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7f16\u53f7\u200b\uff0c\u200b\u4ee5\u540e\u200b\u6709\u200b client \u200b\u8fde\u63a5\u200b\u65f6\u200b\uff0c\u200b\u5411\u200b\u8be5\u200b epoll \u200b\u7ed3\u6784\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u76d1\u542c\u200b\uff0c\u200b\u6240\u4ee5\u200b epoll \u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b</li> <li>epall_ctl\uff1aepoll \u200b\u7684\u200b\u4e8b\u4ef6\u200b\u6ce8\u518c\u200b\u51fd\u6570\u200b\uff0cselect \u200b\u51fd\u6570\u200b\u662f\u200b\u8c03\u7528\u200b\u65f6\u200b\u6307\u5b9a\u200b\u9700\u8981\u200b\u76d1\u542c\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u548c\u200b\u4e8b\u4ef6\u200b\uff0cepoll \u200b\u5148\u200b\u5c06\u200b\u7528\u6237\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u4e8b\u4ef6\u200b\u6ce8\u518c\u200b\u5230\u200b epoll \u200b\u7a7a\u95f4\u200b\u3002\u200b\u6b64\u200b\u51fd\u6570\u200b\u662f\u975e\u200b\u963b\u585e\u200b\u51fd\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u589e\u5220\u200b\u6539\u200b epoll \u200b\u7a7a\u95f4\u200b\u5185\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u53c2\u6570\u200b\u89e3\u91ca\u200b\uff1a</li> <li>epfd\uff1aepoll \u200b\u7ed3\u6784\u200b\u7684\u200b\u8fdb\u7a0b\u200b fd \u200b\u7f16\u53f7\u200b\uff0c\u200b\u51fd\u6570\u200b\u5c06\u200b\u4f9d\u9760\u200b\u8be5\u200b\u7f16\u53f7\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b epoll \u200b\u7ed3\u6784\u200b</li> <li>op\uff1a\u200b\u8868\u793a\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\uff0c\u200b\u6709\u200b\u4e09\u4e2a\u200b\u5b8f\u200b\u5b9a\u4e49\u200b\uff1a<ul> <li>EPOLL_CTL_ADD\uff1a\u200b\u6ce8\u518c\u200b\u65b0\u200b\u7684\u200b fd \u200b\u5230\u200b epfd \u200b\u4e2d\u200b</li> <li>EPOLL_CTL_MOD\uff1a\u200b\u4fee\u6539\u200b\u5df2\u7ecf\u200b\u6ce8\u518c\u200b\u7684\u200b fd \u200b\u7684\u200b\u76d1\u542c\u200b\u4e8b\u4ef6\u200b</li> <li>EPOLL_CTI_DEL\uff1a\u200b\u4ece\u200b epfd \u200b\u4e2d\u200b\u5220\u9664\u200b\u4e00\u4e2a\u200b fd</li> </ul> </li> <li>fd\uff1a\u200b\u9700\u8981\u200b\u76d1\u542c\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4e00\u822c\u200b\u6307\u200b socket_fd</li> <li> <p>event\uff1a\u200b\u544a\u8bc9\u200b\u5185\u6838\u200b\u5bf9\u200b\u8be5\u200b fd \u200b\u8d44\u6e90\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u4e8b\u4ef6\u200b\uff0cepoll_event \u200b\u7684\u200b\u7ed3\u6784\u200b\uff1a</p> C<pre><code>struct epoll_event {\n    _uint32_t events;   /*epoll events*/\n    epoll_data_t data;  /*user data variable*/\n}\n</code></pre> <p>events \u200b\u53ef\u4ee5\u200b\u662f\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u5b8f\u200b\u96c6\u5408\u200b\uff1aEPOLLIN\u3001EPOLOUT\u3001EPOLLPRI\u3001EPOLLERR\u3001EPOLLHUP\uff08\u200b\u6302\u65ad\u200b\uff09\u3001EPOLET\uff08\u200b\u8fb9\u7f18\u200b\u89e6\u53d1\u200b\uff09\u3001EPOLLONESHOT\uff08\u200b\u53ea\u200b\u76d1\u542c\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e8b\u4ef6\u200b\u89e6\u53d1\u200b\u540e\u200b\u81ea\u52a8\u200b\u6e05\u9664\u200b\u8be5\u200b fd\uff0c\u200b\u4ece\u200b epoll \u200b\u5217\u8868\u200b\uff09</p> </li> <li> <p>epoll_wait\uff1a\u200b\u7b49\u5f85\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u4ea7\u751f\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b select() \u200b\u8c03\u7528\u200b\uff0c\u200b\u8fd4\u56de\u503c\u200b\u4e3a\u200b\u672c\u6b21\u200b\u5c31\u7eea\u200b\u7684\u200b fd \u200b\u4e2a\u6570\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4ece\u200b\u5c31\u7eea\u200b\u94fe\u8868\u200b\u83b7\u53d6\u200b\uff0c\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b O(1)</p> </li> <li>epfd\uff1a\u200b\u6307\u5b9a\u200b\u611f\u5174\u8da3\u200b\u7684\u200b epoll \u200b\u4e8b\u4ef6\u200b\u5217\u8868\u200b</li> <li>events\uff1a\u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b epoll_event \u200b\u7ed3\u6784\u200b\u6570\u7ec4\u200b\uff0c\u200b\u5f53\u200b\u51fd\u6570\u200b\u8fd4\u56de\u200b\u65f6\u200b\uff0c\u200b\u5185\u6838\u200b\u4f1a\u200b\u628a\u200b\u5c31\u7eea\u200b\u72b6\u6001\u200b\u7684\u200b\u6570\u636e\u200b\u62f7\u8d1d\u5230\u200b\u8be5\u200b\u6570\u7ec4\u200b</li> <li>maxevents\uff1a\u200b\u6807\u660e\u200b epoll_event \u200b\u6570\u7ec4\u200b\u6700\u591a\u80fd\u200b\u63a5\u6536\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\uff0c\u200b\u5373\u200b\u672c\u6b21\u200b\u64cd\u4f5c\u200b\u6700\u591a\u80fd\u200b\u83b7\u53d6\u200b\u591a\u5c11\u200b\u5c31\u7eea\u200b\u6570\u636e\u200b</li> <li>timeout\uff1a\u200b\u5355\u4f4d\u200b\u4e3a\u200b\u6beb\u79d2\u200b<ul> <li>0\uff1a\u200b\u8868\u793a\u200b\u7acb\u5373\u200b\u8fd4\u56de\u200b\uff0c\u200b\u975e\u200b\u963b\u585e\u200b\u8c03\u7528\u200b</li> <li>-1\uff1a\u200b\u963b\u585e\u200b\u8c03\u7528\u200b\uff0c\u200b\u76f4\u5230\u200b\u6709\u200b\u7528\u6237\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5c31\u7eea\u200b\u4e3a\u6b62\u200b</li> <li>\u200b\u5927\u4e8e\u200b 0\uff1a\u200b\u963b\u585e\u200b\u8c03\u7528\u200b\uff0c\u200b\u963b\u585e\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b\u5185\u200b\u5982\u679c\u200b\u6709\u200b\u4e8b\u4ef6\u200b\u5c31\u7eea\u200b\u5219\u200b\u63d0\u524d\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5426\u5219\u200b\u7b49\u5f85\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b\u540e\u200b\u8fd4\u56de\u200b</li> </ul> </li> </ul> <p>epoll \u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u4e8b\u4ef6\u200b\u6709\u200b\u4e24\u79cd\u200b\u89e6\u53d1\u200b\u6a21\u5f0f\u200b\uff1aLT\uff08level trigger\uff09\u200b\u548c\u200b ET\uff08edge trigger\uff09\uff1a</p> <ul> <li>LT \u200b\u6a21\u5f0f\u200b\uff1a\u200b\u5f53\u200b epoll_wait() \u200b\u68c0\u6d4b\u200b\u5230\u200b\u63cf\u8ff0\u7b26\u200b\u4e8b\u4ef6\u200b\u5230\u8fbe\u200b\u65f6\u200b\uff0c\u200b\u5c06\u200b\u6b64\u200b\u4e8b\u4ef6\u200b\u901a\u77e5\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u7acb\u5373\u200b\u5904\u7406\u200b\u8be5\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u8c03\u7528\u200b epoll_wait() \u200b\u4f1a\u200b\u518d\u6b21\u200b\u901a\u77e5\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u662f\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u4e00\u79cd\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u540c\u65f6\u200b\u652f\u6301\u200b Blocking \u200b\u548c\u200b No-Blocking</li> <li>ET \u200b\u6a21\u5f0f\u200b\uff1a\u200b\u901a\u77e5\u200b\u4e4b\u540e\u200b\u8fdb\u7a0b\u200b\u5fc5\u987b\u200b\u7acb\u5373\u200b\u5904\u7406\u4e8b\u4ef6\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u518d\u200b\u8c03\u7528\u200b epoll_wait() \u200b\u65f6\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u5f97\u5230\u200b\u4e8b\u4ef6\u200b\u5230\u8fbe\u200b\u7684\u200b\u901a\u77e5\u200b\u3002\u200b\u51cf\u5c11\u200b\u4e86\u200b epoll \u200b\u4e8b\u4ef6\u200b\u88ab\u200b\u91cd\u590d\u200b\u89e6\u53d1\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6548\u7387\u200b\u8981\u200b\u6bd4\u200b LT \u200b\u6a21\u5f0f\u200b\u9ad8\u200b\uff1b\u200b\u53ea\u200b\u652f\u6301\u200b No-Blocking\uff0c\u200b\u4ee5\u200b\u907f\u514d\u200b\u7531\u4e8e\u200b\u4e00\u4e2a\u200b fd \u200b\u7684\u200b\u963b\u585e\u200b\u8bfb\u200b/\u200b\u963b\u585e\u200b\u5199\u200b\u64cd\u4f5c\u200b\u628a\u200b\u5904\u7406\u200b\u591a\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u4efb\u52a1\u200b\u9965\u997f\u200b</li> </ul> C<pre><code>// \u200b\u521b\u5efa\u200b epoll \u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u7528\u4e8e\u200b\u76d1\u63a7\u200b\u6240\u6709\u200b\u5957\u200b\u63a5\u5b57\u200b\nint pollingfd = epoll_create(0xCAFE);\nif ( pollingfd &lt; 0 )// report error\n// \u200b\u521d\u59cb\u5316\u200b epoll \u200b\u7ed3\u6784\u200b\nstruct epoll_event ev = { 0 };\n\n// \u200b\u5c06\u200b\u8fde\u63a5\u200b\u7c7b\u200b\u5b9e\u4f8b\u200b\u4e0e\u200b\u4e8b\u4ef6\u200b\u76f8\u5173\u8054\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5173\u8054\u200b\u4efb\u4f55\u200b\u60f3\u8981\u200b\u7684\u200b\u4e1c\u897f\u200b\nev.data.ptr = pConnection1;\n\n// \u200b\u76d1\u89c6\u200b\u8f93\u5165\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u4e8b\u4ef6\u200b\u53d1\u751f\u200b\u540e\u200b\u4e0d\u200b\u81ea\u52a8\u200b\u91cd\u65b0\u200b\u51c6\u5907\u200b\u63cf\u8ff0\u7b26\u200b\nev.events = EPOLLIN | EPOLLONESHOT;\n// \u200b\u5c06\u200b\u63cf\u8ff0\u7b26\u200b\u6dfb\u52a0\u200b\u5230\u200b\u76d1\u63a7\u200b\u5217\u8868\u200b\u4e2d\u200b\uff0c\u200b\u5373\u4f7f\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5728\u200bepoll_wait\u200b\u4e2d\u200b\u7b49\u5f85\u200b\uff0c\u200b\u63cf\u8ff0\u7b26\u200b\u5c06\u200b\u88ab\u200b\u6b63\u786e\u200b\u6dfb\u52a0\u200b\nif ( epoll_ctl( epollfd, EPOLL_CTL_ADD, pConnection1-&gt;getSocket(), &amp;ev) != 0 )\n    // report error\n\n// \u200b\u6700\u200b\u591a\u200b\u7b49\u5f85\u200b 20 \u200b\u4e2a\u200b\u4e8b\u4ef6\u200b\nstruct epoll_event pevents[20];\n\n// \u200b\u7b49\u5f85\u200b10\u200b\u79d2\u200b\uff0c\u200b\u68c0\u7d22\u200b20\u200b\u4e2a\u200b\u5e76\u200b\u5b58\u5165\u200bepoll_event\u200b\u6570\u7ec4\u200b\nint ready = epoll_wait(pollingfd, pevents, 20, 10000);\n// \u200b\u68c0\u67e5\u200bepoll\u200b\u662f\u5426\u200b\u6210\u529f\u200b\nif ( ret == -1)// report error and abort\nelse if ( ret == 0)// timeout; no event detected\nelse\n{\n    for (int i = 0; i &lt; ready; i+ )\n    {\n        if ( pevents[i].events &amp; EPOLLIN )\n        {\n            // \u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\u6307\u9488\u200b\n            Connection * c = (Connection*) pevents[i].data.ptr;\n            c-&gt;handleReadEvent();\n         }\n    }\n}\n</code></pre>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_9","title":"\u7279\u70b9","text":"<p>epoll \u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ul> <li>epoll \u200b\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b Linux \u200b\u7cfb\u7edf\u200b</li> <li>epoll \u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u5c06\u200b\u7528\u6237\u200b\u5173\u5fc3\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u5b58\u653e\u200b\u5230\u200b\u5185\u6838\u200b\u7684\u200b\u4e00\u4e2a\u200b\u4e8b\u4ef6\u200b\u8868\u200b\uff08\u200b\u4e2a\u4eba\u200b\u7406\u89e3\u200b\u6210\u54d1\u200b\u5143\u200b\u8282\u70b9\u200b\uff09</li> <li>\u200b\u6ca1\u6709\u200b\u6700\u5927\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u91cf\u200b\uff08\u200b\u5e76\u53d1\u200b\u8fde\u63a5\u200b\uff09\u200b\u7684\u200b\u9650\u5236\u200b\uff0c\u200b\u6253\u5f00\u200b fd \u200b\u7684\u200b\u4e0a\u9650\u200b\u8fdc\u5927\u4e8e\u200b1024\uff081G \u200b\u5185\u5b58\u200b\u80fd\u200b\u76d1\u542c\u200b\u7ea6\u200b 10 \u200b\u4e07\u4e2a\u200b\u7aef\u53e3\u200b\uff09</li> <li>epoll \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b O(1)\uff0cepoll \u200b\u7406\u89e3\u200b\u4e3a\u200b event poll\uff0c\u200b\u4e0d\u540c\u4e8e\u200b\u5fd9\u200b\u8f6e\u8be2\u200b\u548c\u200b\u65e0\u5dee\u522b\u200b\u8f6e\u8be2\u200b\uff0c\u200b\u8c03\u7528\u200b epoll_wait \u200b\u53ea\u662f\u200b\u8f6e\u8be2\u200b\u5c31\u7eea\u200b\u94fe\u8868\u200b\u3002\u200b\u5f53\u200b\u76d1\u542c\u200b\u5217\u8868\u200b\u6709\u200b\u8bbe\u5907\u200b\u5c31\u7eea\u200b\u65f6\u200b\u8c03\u7528\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\uff0c\u200b\u628a\u200b\u5c31\u7eea\u200b fd \u200b\u653e\u5165\u200b\u5c31\u7eea\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u5524\u9192\u200b\u5728\u200b epoll_wait \u200b\u4e2d\u200b\u963b\u585e\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u6240\u4ee5\u200b epoll \u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u4e8b\u4ef6\u9a71\u52a8\u200b\uff08\u200b\u6bcf\u4e2a\u200b\u4e8b\u4ef6\u200b\u5173\u8054\u200b\u4e0a\u200bfd\uff09\u200b\u7684\u200b\uff0c\u200b\u964d\u4f4e\u200b\u4e86\u200b system call \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b</li> <li>epoll \u200b\u5185\u6838\u200b\u4e2d\u200b\u6839\u636e\u200b\u6bcf\u4e2a\u200b fd \u200b\u4e0a\u200b\u7684\u200b callback \u200b\u51fd\u6570\u200b\u6765\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ea\u6709\u200b\u6d3b\u8dc3\u200b\u7684\u200b socket \u200b\u624d\u200b\u4f1a\u200b\u4e3b\u52a8\u200b\u8c03\u7528\u200b callback\uff0c\u200b\u6240\u4ee5\u200b\u4f7f\u7528\u200b epoll \u200b\u6ca1\u6709\u200b\u524d\u9762\u200b\u4e24\u8005\u200b\u7684\u200b\u7ebf\u6027\u200b\u4e0b\u964d\u200b\u7684\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b\uff0c\u200b\u6548\u7387\u200b\u63d0\u9ad8\u200b</li> <li>epoll \u200b\u6ce8\u518c\u200b\u65b0\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u662f\u200b\u6ce8\u518c\u200b\u5230\u200b\u5230\u200b\u5185\u6838\u200b\u4e2d\u200b epoll \u200b\u53e5\u67c4\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u6bcf\u6b21\u200b\u8c03\u7528\u200b epoll_wait \u200b\u65f6\u200b\u91cd\u590d\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5bf9\u6bd4\u200b\u524d\u9762\u200b\u4e24\u79cd\u200b\u53ea\u200b\u9700\u8981\u200b\u5c06\u200b\u63cf\u8ff0\u7b26\u200b\u4ece\u200b\u8fdb\u7a0b\u200b\u7f13\u51b2\u533a\u200b\u5411\u200b\u5185\u6838\u200b\u7f13\u51b2\u533a\u200b\u62f7\u8d1d\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b mmap() \u200b\u6587\u4ef6\u200b\u6620\u5c04\u200b\u5185\u5b58\u200b\u52a0\u901f\u200b\u4e0e\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7684\u200b\u6d88\u606f\u4f20\u9012\u200b\uff08\u200b\u53ea\u662f\u200b\u53ef\u4ee5\u200b\u7528\u200b\uff0c\u200b\u5e76\u200b\u6ca1\u6709\u200b\u7528\u200b\uff09</li> <li>\u200b\u524d\u9762\u200b\u4e24\u8005\u200b\u8981\u200b\u628a\u200b current \u200b\u5f80\u200b\u8bbe\u5907\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e2d\u6302\u200b\u4e00\u6b21\u200b\uff0cepoll \u200b\u4e5f\u200b\u53ea\u200b\u628a\u200b current \u200b\u5f80\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u4e0a\u200b\u6302\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\u5e76\u200b\u4e0d\u662f\u200b\u8bbe\u5907\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b epoll \u200b\u5185\u90e8\u200b\u5b9a\u4e49\u200b\u7684\u200b\u7b49\u5f85\u200b\u961f\u5217\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u8282\u7701\u200b\u5f00\u9500\u200b</li> <li>epoll \u200b\u5bf9\u200b\u591a\u7ebf\u7a0b\u200b\u7f16\u7a0b\u200b\u66f4\u200b\u6709\u200b\u53cb\u597d\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8c03\u7528\u200b\u4e86\u200b epoll_wait() \u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u5173\u95ed\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u4ea7\u751f\u200b\u50cf\u200b select \u200b\u548c\u200b poll \u200b\u7684\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u60c5\u51b5\u200b</li> </ul>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_10","title":"\u5e94\u7528","text":"<p>\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a </p> <ul> <li>select \u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a</li> <li>select \u200b\u7684\u200b timeout \u200b\u53c2\u6570\u200b\u7cbe\u5ea6\u200b\u4e3a\u200b\u5fae\u79d2\u200b\uff0cpoll \u200b\u548c\u200b epoll \u200b\u4e3a\u200b\u6beb\u79d2\u200b\uff0c\u200b\u56e0\u6b64\u200b select \u200b\u9002\u7528\u200b\u5b9e\u65f6\u6027\u200b\u8981\u6c42\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6838\u53cd\u5e94\u5806\u200b\u7684\u200b\u63a7\u5236\u200b</li> <li>select \u200b\u53ef\u79fb\u690d\u6027\u200b\u66f4\u597d\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u88ab\u200b\u6240\u6709\u200b\u4e3b\u6d41\u200b\u5e73\u53f0\u200b\u6240\u200b\u652f\u6301\u200b</li> <li>poll \u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1apoll \u200b\u6ca1\u6709\u200b\u6700\u5927\u200b\u63cf\u8ff0\u7b26\u200b\u6570\u91cf\u200b\u7684\u200b\u9650\u5236\u200b\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u5e73\u53f0\u200b\u652f\u6301\u200b\u5e76\u4e14\u200b\u5bf9\u200b\u5b9e\u65f6\u6027\u200b\u8981\u6c42\u200b\u4e0d\u9ad8\u200b\u7684\u200b\u60c5\u51b5\u200b</li> <li>epoll \u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff1a</li> <li>\u200b\u8fd0\u884c\u200b\u5728\u200b Linux \u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0c\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u8f6e\u8be2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e9b\u200b\u8fde\u63a5\u200b\u6700\u597d\u200b\u662f\u200b\u957f\u200b\u8fde\u63a5\u200b</li> <li>\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u76d1\u63a7\u200b\u5c0f\u4e8e\u200b 1000 \u200b\u4e2a\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u6ca1\u200b\u5fc5\u8981\u200b\u4f7f\u7528\u200b epoll\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u4e2a\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\u4e0b\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u4f53\u73b0\u200b epoll \u200b\u7684\u200b\u4f18\u52bf\u200b</li> <li>\u200b\u9700\u8981\u200b\u76d1\u63a7\u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u72b6\u6001\u200b\u53d8\u5316\u200b\u591a\u200b\uff0c\u200b\u800c\u4e14\u200b\u662f\u200b\u975e\u5e38\u200b\u77ed\u6682\u200b\u7684\u200b\uff0c\u200b\u5c31\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u4f7f\u7528\u200b epoll\u3002\u200b\u56e0\u4e3a\u200b epoll \u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u63cf\u8ff0\u7b26\u200b\u90fd\u200b\u5b58\u50a8\u200b\u5728\u200b\u5185\u6838\u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u5bf9\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u72b6\u6001\u200b\u6539\u53d8\u200b\u90fd\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b epoll_ctl() \u200b\u8fdb\u884c\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u9891\u7e41\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u964d\u4f4e\u200b\u6548\u7387\u200b\uff0c\u200b\u5e76\u4e14\u200b epoll \u200b\u7684\u200b\u63cf\u8ff0\u7b26\u200b\u5b58\u50a8\u200b\u5728\u200b\u5185\u6838\u200b\uff0c\u200b\u4e0d\u200b\u5bb9\u6613\u200b\u8c03\u8bd5\u200b</li> </ul>","tags":["os"]},{"location":"blog/os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/#_11","title":"\u53c2\u8003\u8d44\u6599","text":"<p>Linux IO\u200b\u6a21\u5f0f\u200b\u53ca\u200b select\u3001poll\u3001epoll\u200b\u8be6\u89e3\u200b - \u200b\u4eba\u4e91\u601d\u4e91\u200b - SegmentFault \u200b\u601d\u5426\u200b</p>","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/","title":"\u5206\u9875\u200b\u5b58\u50a8\u7ba1\u7406","text":"<p> \u200b\u7ea6\u200b 1253 \u200b\u4e2a\u200b\u5b57\u200b  5 \u200b\u884c\u200b\u4ee3\u7801\u200b  6 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 4 \u200b\u5206\u949f\u200b</p>","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#_2","title":"\u903b\u8f91\u200b\u5730\u5740\u200b\u4e0e\u200b\u7269\u7406\u5730\u5740","text":"<ul> <li>\u200b\u903b\u8f91\u200b\u5730\u5740\u200b\uff08Logical Address\uff09\uff0c\u200b\u4e5f\u200b\u79f0\u200b\u865a\u62df\u5730\u5740\u200b\uff0c\u200b\u662f\u200b\u7a0b\u5e8f\u200b\u5728\u200b\u7f16\u8bd1\u200b\u540e\u200b\u751f\u6210\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u7a0b\u5e8f\u200b\u5f00\u59cb\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u504f\u79fb\u200b\u5730\u5740\u200b\u3002</li> <li>\u200b\u6bcf\u4e2a\u200b\u7f16\u8bd1\u200b\u751f\u6210\u200b\u7684\u200b\u76ee\u6807\u200b\u6a21\u5757\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u548c\u6570\u636e\u200b\uff0c\u200b\u90fd\u200b\u662f\u4ece\u200b 0 \u200b\u5355\u5143\u200b\u5f00\u59cb\u200b\u7f16\u53f7\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u5f62\u6210\u200b\u4e86\u200b\u6240\u8c13\u200b\u7684\u200b\u903b\u8f91\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u3002</li> </ul> <ul> <li>\u200b\u7269\u7406\u5730\u5740\u200b\uff08Physical Address\uff09\u200b\u662f\u200b\u7a0b\u5e8f\u200b\u6700\u7ec8\u200b\u88ab\u200b\u52a0\u8f7d\u200b\u5230\u200b\u5185\u5b58\u200b\u540e\u200b\uff0c\u200b\u5728\u200b\u771f\u5b9e\u200b\u5185\u5b58\u7a7a\u95f4\u200b\u4e2d\u200b\u7684\u200b\u5730\u5740\u200b\u4f4d\u7f6e\u200b\u3002</li> <li>\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4f1a\u200b\u51b3\u5b9a\u200b\u7a0b\u5e8f\u200b\u88ab\u200b\u88c5\u5165\u200b\u5185\u5b58\u200b\u7684\u200b\u5b9e\u9645\u200b\u8d77\u59cb\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7269\u7406\u5730\u5740\u200b\u5e76\u200b\u4e0d\u200b\u603b\u662f\u200b\u4ece\u200b 0 \u200b\u5f00\u59cb\u200b\u3002</li> </ul> <p>\u200b\u903b\u8f91\u200b\u5730\u5740\u200b \u2192 \u200b\u901a\u8fc7\u200b\u88c5\u5165\u200b\u65f6\u200b\u7684\u200b\u57fa\u5740\u200b \u2192 \u200b\u8f6c\u6362\u200b\u4e3a\u200b\u7269\u7406\u5730\u5740\u200b\u3002</p> Text Only<pre><code>\u200b\u7269\u7406\u5730\u5740\u200b = \u200b\u903b\u8f91\u200b\u5730\u5740\u200b + \u200b\u88c5\u5165\u200b\u57fa\u5740\u200b\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b</p> <ul> <li> <p>\u200b\u4e00\u4e2a\u200b\u7a0b\u5e8f\u200b\u88ab\u200b\u7f16\u8bd1\u6210\u200b\u76ee\u6807\u200b\u6a21\u5757\u200b\u540e\u200b\uff0c\u200b\u5176\u4e2d\u200b\u67d0\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u903b\u8f91\u200b\u5730\u5740\u200b\u662f\u200b 95\u3002</p> </li> <li> <p>\u200b\u94fe\u63a5\u200b\u540e\u200b\u5f62\u6210\u200b\u5b8c\u6574\u200b\u7684\u200b\u88c5\u5165\u200b\u6a21\u5757\u200b\uff0c\u200b\u88ab\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u52a0\u8f7d\u200b\u5230\u200b\u5185\u5b58\u5730\u5740\u200b 100\u3002</p> </li> <li> <p>\u200b\u5219\u200b\u8be5\u200b\u6307\u4ee4\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u4e3a\u200b\uff1a</p> </li> </ul> Text Only<pre><code>\u200b\u7269\u7406\u5730\u5740\u200b = 95\uff08\u200b\u903b\u8f91\u200b\u5730\u5740\u200b\uff09+ 100\uff08\u200b\u88c5\u5165\u200b\u57fa\u5740\u200b\uff09 = 195\n</code></pre>","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#_3","title":"\u57fa\u672c\u200b\u5206\u9875\u200b\u5b58\u50a8\u200b\u539f\u7406","text":"","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#_4","title":"\u8fde\u7eed\u200b\u5206\u914d\u200b\u7684\u200b\u5c40\u9650\u6027","text":"<ol> <li>\u200b\u5355\u4e00\u200b\u8fde\u7eed\u200b\u5206\u914d\u200b</li> <li>\u200b\u56fa\u5b9a\u200b\u5206\u533a\u200b\u5206\u914d\u200b</li> <li>\u200b\u52a8\u6001\u200b\u5206\u533a\u200b\u5206\u914d\u200b</li> </ol> <p>\u200b\u5b58\u5728\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a</p> <ul> <li>\u200b\u5916\u90e8\u200b\u788e\u7247\u200b\uff1a\u200b\u5185\u5b58\u200b\u4e2d\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4f46\u200b\u56e0\u200b\u4e0d\u200b\u8fde\u7eed\u200b\u800c\u200b\u65e0\u6cd5\u200b\u6ee1\u8db3\u200b\u5927\u5757\u200b\u7533\u8bf7\u200b\u3002</li> <li>\u200b\u5185\u90e8\u200b\u788e\u7247\u200b\uff1a\u200b\u4e3a\u200b\u8fdb\u7a0b\u200b\u5206\u914d\u200b\u7684\u200b\u5185\u5b58\u200b\u6bd4\u5176\u200b\u5b9e\u9645\u200b\u9700\u6c42\u200b\u591a\u200b\uff0c\u200b\u9020\u6210\u200b\u6d6a\u8d39\u200b\u3002</li> </ul>","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#_5","title":"\u5206\u9875\u200b\u5b58\u50a8\u7ba1\u7406","text":"<p>\u200b\u6838\u5fc3\u601d\u60f3\u200b\uff1a</p> <p>\u200b\u5c06\u200b\u5185\u5b58\u200b\u548c\u200b\u8fdb\u7a0b\u200b\u90fd\u200b\u5212\u5206\u200b\u4e3a\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u4f7f\u200b\u4e8c\u8005\u200b\u53ef\u4ee5\u200b\u4e00\u4e00\u5bf9\u5e94\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u975e\u200b\u8fde\u7eed\u200b\u5206\u914d\u200b\uff0c\u200b\u6d88\u9664\u200b\u5916\u90e8\u200b\u788e\u7247\u200b\u3002</p> <p>\u200b\u5206\u5757\u200b\u65b9\u5f0f\u200b\uff1a</p> \u200b\u5bf9\u8c61\u200b \u00a0 \u00a0 \u200b\u5757\u200b\u540d\u200b \u00a0 \u00a0 \u00a0 \u00a0 \u200b\u82f1\u6587\u200b\u672f\u8bed\u200b \u00a0 \u00a0 \u200b\u7279\u70b9\u200b \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u200b\u8fdb\u7a0b\u200b \u00a0 \u00a0 \u200b\u9875\u200b\uff08Page\uff09 \u00a0 Page \u00a0 \u00a0 \u00a0 \u00a0 \u200b\u5927\u5c0f\u200b\u56fa\u5b9a\u200b\uff0c\u200b\u901a\u5e38\u200b\u4e3a\u200b 2 \u200b\u7684\u200b\u6574\u6570\u200b\u6b21\u200b\u5e42\u200b \u00a0 \u00a0 \u200b\u5185\u5b58\u200b \u00a0 \u00a0 \u200b\u9875\u200b\u6846\u200b \u00a0 \u00a0 \u00a0 \u00a0 Page Frame \u00a0 \u200b\u53c8\u79f0\u200b\u9875\u200b\u5e27\u200b / \u200b\u7269\u7406\u200b\u5757\u200b\uff0c\u200b\u5927\u5c0f\u200b\u7b49\u4e8e\u200b\u9875\u200b\u5927\u5c0f\u200b \u200b\u5916\u5b58\u200b \u00a0 \u00a0 \u200b\u76d8\u5757\u200b \u00a0 \u00a0 \u00a0 \u00a0 Block\u00a0 \u00a0 \u00a0 \u00a0 \u200b\u5728\u200b\u5206\u9875\u200b\u7ba1\u7406\u200b\u4e2d\u200b\u901a\u5e38\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u76f4\u63a5\u200b\u6620\u5c04\u200b \u00a0 <p></p> <p>\u200b\u5206\u9875\u200b\u7ba1\u7406\u200b\u7684\u200b\u4f18\u70b9\u200b</p> <ol> <li>\u200b\u907f\u514d\u200b\u5916\u90e8\u200b\u788e\u7247\u200b<ul> <li>\u200b\u5404\u9875\u200b\u53ef\u4ee5\u200b\u5206\u6563\u200b\u5728\u200b\u4e0d\u540c\u200b\u5185\u5b58\u200b\u5757\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u8981\u6c42\u200b\u8fde\u7eed\u200b\uff0c\u200b\u5929\u7136\u200b\u89e3\u51b3\u200b\u5916\u90e8\u200b\u788e\u7247\u200b\u95ee\u9898\u200b\u3002</li> </ul> </li> <li>\u200b\u5185\u90e8\u200b\u788e\u7247\u200b\u6781\u5c0f\u200b<ul> <li>\u200b\u6700\u200b\u591a\u200b\u53ea\u6709\u200b\u6700\u540e\u200b\u4e00\u9875\u200b\u672a\u6ee1\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6d6a\u8d39\u200b\u4e00\u70b9\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u79f0\u4e3a\u200b\u9875\u200b\u5185\u200b\u788e\u7247\u200b\uff08\u200b\u4e1a\u5185\u200b\u788e\u7247\u200b\uff09\u3002</li> </ul> </li> <li>\u200b\u652f\u6301\u200b\u52a8\u6001\u5185\u5b58\u200b\u5206\u914d\u200b<ul> <li>\u200b\u9875\u200b\u4e0e\u200b\u9875\u200b\u6846\u200b\u4e00\u4e00\u200b\u6620\u5c04\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u8c03\u5165\u200b\u65f6\u200b\u65e0\u9700\u200b\u5168\u90e8\u200b\u5c31\u7eea\u200b\uff08\u200b\u652f\u6301\u200b\u8bf7\u6c42\u5206\u9875\u200b\uff09\u3002</li> </ul> </li> </ol>","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#_6","title":"\u903b\u8f91\u200b\u5730\u5740\u200b\u7ed3\u6784","text":"<p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u8bbf\u95ee\u200b\u903b\u8f91\u200b\u5730\u5740\u200b x = 58</p> <ol> <li>\u200b\u786e\u5b9a\u200b\u5b83\u200b\u6765\u81ea\u200b\u54ea\u4e2a\u200b\u9875\u9762\u200b (\u200b\u9875\u200b\u53f7\u200b)</li> <li>\u200b\u786e\u5b9a\u200b\u5b83\u200b\u5728\u200b\u8be5\u200b\u9875\u9762\u200b\u4e2d\u200b\u7684\u200b\u5730\u5740\u200b (\u200b\u9875\u200b\u5185\u200b\u504f\u79fb\u91cf\u200b)</li> <li>\u200b\u786e\u5b9a\u200b\u6240\u5728\u200b\u9875\u9762\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b</li> </ol> <p>x \u200b\u5bf9\u5e94\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b = \u200b\u6240\u5728\u200b\u9875\u9762\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b + \u200b\u9875\u200b\u5185\u200b\u504f\u79fb\u91cf\u200b</p> <p></p> <p>\u200b\u5047\u8bbe\u200b\u5728\u200b 32 \u200b\u4f4d\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u865a\u62df\u5730\u5740\u200b\u7a7a\u95f4\u200b\u5171\u6709\u200b 4GB(2^32)\uff0c\u200b\u5047\u8bbe\u200b\u4e00\u4e2a\u200b\u9875\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b 4KB (2^12)\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u9700\u8981\u200b\u5927\u7ea6\u200b 100 \u200b\u4e07\u200b (2^20) \u200b\u4e2a\u9875\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u300c\u200b\u9875\u8868\u200b\u9879\u200b\u300d\u200b\u9700\u8981\u200b 4 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5927\u5c0f\u200b\u6765\u200b\u5b58\u50a8\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6574\u4e2a\u200b 4GB \u200b\u7a7a\u95f4\u200b\u7684\u200b\u6620\u5c04\u200b\u5c31\u200b\u9700\u8981\u200b 4MB \u200b\u7684\u200b\u5185\u5b58\u200b\u6765\u200b\u5b58\u50a8\u200b\u9875\u8868\u200b\u3002</p> <p></p>","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#_7","title":"\u9875\u8868","text":"<p>\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u627e\u5230\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u9875\u9762\u200b\u5bf9\u5e94\u200b\u7684\u200b\u9875\u200b\u6846\u200b\uff0cOS \u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u8fdb\u7a0b\u200b\u5efa\u7acb\u200b\u4e00\u5f20\u200b\u9875\u8868\u200b\uff0c\u200b\u653e\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u9875\u200b\u53f7\u200b &lt;=&gt; \u200b\u9875\u200b\u6846\u53f7\u200b</p> <p></p> <ol> <li>\u200b\u9875\u8868\u200b\uff1a\u200b\u7cfb\u7edf\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u8fdb\u7a0b\u200b\u5efa\u7acb\u200b\u7684\u200b\u9875\u9762\u200b\u6620\u50cf\u200b\u8868\u200b\uff0c\u200b\u5373\u200b\u4e0a\u200b\u56fe\u200b\u4e2d\u200b\u4e00\u6574\u5757\u200b\u90e8\u5206\u200b\u3002</li> <li>\u200b\u9875\u8868\u200b\u9879\u200b\uff1a\u200b\u9875\u8868\u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u9879\u200b\uff0c\u200b\u5373\u200b\u4e0a\u200b\u56fe\u200b\u4e2d\u200b\u4e00\u6574\u5757\u200b\u90e8\u5206\u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u884c\u200b\uff08\u200b\u5982\u200b\uff1a\u200b\u9875\u200b\u53f7\u200b\u4e3a\u200b 0\u200b\u4e14\u200b\u7269\u7406\u200b\u5757\u200b\u53f7\u200b\u4e3a\u200b 2\u200b\u7684\u200b\u6574\u4f53\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u9875\u8868\u200b\u9879\u200b\uff09\u3002</li> <li>\u200b\u9875\u8868\u200b\u9879\u200b\u5927\u5c0f\u200b\uff1a\u200b\u4e0a\u56fe\u200b\u4e2d\u200b\u4e00\u6574\u5757\u200b\u90e8\u5206\u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u884c\u200b\u6240\u200b\u5360\u200b\u5927\u5c0f\u200b\u3002</li> <li>\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b\uff1a\u200b\u6307\u200b\u9875\u8868\u200b\u9879\u200b\u7684\u200b\u4e2a\u6570\u200b\uff0c\u200b\u5373\u200b\u4e0a\u200b\u56fe\u200b\u4e2d\u200b\u4e00\u5171\u200b\u6709\u200b\u51e0\u884c\u200b\uff0c\u200b\u6709\u200b\u51e0\u884c\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b\u5c31\u200b\u4e3a\u200b\u591a\u5c11\u200b\u3002</li> </ol>","tags":["os"]},{"location":"blog/os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/#_8","title":"\u57fa\u672c\u200b\u5730\u5740\u53d8\u6362\u200b\u673a\u6784","text":"<p>\u200b\u5728\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u901a\u5e38\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u9875\u8868\u200b\u5bc4\u5b58\u5668\u200b (PTR)\uff0c\u200b\u5b58\u653e\u200b\u9875\u8868\u200b\u5728\u200b\u5185\u5b58\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b F \u200b\u548c\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b M\u3002\u200b\u8fdb\u7a0b\u200b\u672a\u200b\u6267\u884c\u200b\u65f6\u200b\uff0c\u200b\u9875\u8868\u200b\u7684\u200b\u59cb\u5740\u200b\u548c\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b\u5b58\u653e\u200b\u5728\u200b\u672c\u200b\u8fdb\u7a0b\u200b\u7684\u200b PCB \u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u8fdb\u7a0b\u200b\u88ab\u200b\u8c03\u5ea6\u200b\u6267\u884c\u200b\u65f6\u200b\uff0c\u200b\u624d\u200b\u5c06\u200b\u9875\u8868\u200b\u59cb\u5740\u200b\u548c\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b\u88c5\u5165\u200b\u9875\u8868\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u8bbe\u200b\u9875\u9762\u200b\u5927\u5c0f\u200b\u4e3a\u200b L\uff0c\u200b\u903b\u8f91\u200b\u5730\u5740\u200b A \u200b\u5230\u200b\u7269\u7406\u5730\u5740\u200b E \u200b\u7684\u200b\u53d8\u6362\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b\u9875\u200b\u53f7\u200b P (P = A / L) \u200b\u548c\u200b\u9875\u200b\u5185\u200b\u504f\u79fb\u91cf\u200b W (W = A % L)</li> <li>\u200b\u6bd4\u8f83\u200b\u9875\u200b\u53f7\u200b P \u200b\u548c\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b M\uff0c\u200b\u82e5\u200b P &gt;= M (\u200b\u9875\u200b\u53f7\u200b\u4ece\u200b 0 \u200b\u5f00\u59cb\u200b)\uff0c\u200b\u5219\u200b\u4ea7\u751f\u200b\u8d8a\u754c\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u5426\u5219\u200b\u7ee7\u7eed\u6267\u884c\u200b</li> <li>\u200b\u9875\u8868\u200b\u4e2d\u9875\u200b\u53f7\u200b P \u200b\u5bf9\u5e94\u200b\u7684\u200b\u9875\u8868\u200b\u5730\u5740\u200b = \u200b\u9875\u8868\u200b\u59cb\u5740\u200b F + \u200b\u9875\u200b\u53f7\u200b P * \u200b\u9875\u8868\u200b\u9879\u200b\u957f\u5ea6\u200b\uff0c\u200b\u53d6\u51fa\u200b\u8be5\u200b\u9875\u8868\u200b\u9879\u200b\u5185\u5bb9\u200b b\uff0c\u200b\u5373\u200b\u4e3a\u200b\u7269\u7406\u200b\u5757\u200b\u53f7\u200b\u3002\u200b\u6ce8\u610f\u200b\u533a\u5206\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b\u548c\u200b\u9875\u8868\u200b\u9879\u200b\u957f\u5ea6\u200b\u3002\u200b\u9875\u8868\u200b\u957f\u5ea6\u200b\u662f\u200b\u6307\u200b\u4e00\u5171\u200b\u6709\u200b\u591a\u5c11\u200b\u9875\u200b\uff0c\u200b\u9875\u8868\u200b\u9879\u200b\u957f\u5ea6\u200b\u662f\u200b\u6307\u9875\u200b\u5730\u5740\u200b\u5360\u591a\u5927\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u3002</li> <li>\u200b\u8ba1\u7b97\u200b E = b * L + W\uff0c\u200b\u7528\u200b\u5f97\u5230\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b E \u200b\u53bb\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\u3002</li> </ol> <p>\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u5757\u200b\u53f7\u200b\uff0c\u200b\u9875\u9762\u200b\u504f\u79fb\u91cf\u200b\u662f\u200b\u4e8c\u8fdb\u5236\u200b\u8868\u793a\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c06\u200b\u5b83\u4eec\u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7269\u7406\u5730\u5740\u200b\u3002</p> <p>\u200b\u4f8b\u9898\u200b\uff1a\u200b\u82e5\u200b\u9875\u9762\u200b\u5927\u5c0f\u200b L \u200b\u4e3a\u200b 1k \u200b\u5b57\u8282\u200b\uff0c\u200b\u9875\u200b\u53f7\u200b 2 \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5185\u5b58\u200b\u5757\u200b\u53f7\u200b b=8\uff0c\u200b\u5c06\u200b\u903b\u8f91\u200b\u5730\u5740\u200b A=2500 \u200b\u8f6c\u6362\u200b\u4e3a\u200b\u7269\u7406\u5730\u5740\u200b E</p> <p>\u200b\u7b54\u200b\uff1a Text Only<pre><code>P = A / L = 2500 / 1024 = 2\nW = A % L = 2500 % 1024 = 452\nE = 8 * 1024 + 452 = 8644\n</code></pre></p>","tags":["os"]},{"location":"blog/2024/11/11/%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E6%B5%8B%E8%AF%95/","title":"\u535a\u5ba2\u200b\u6587\u7ae0\u200b\u6d4b\u8bd5","text":"<p> \u200b\u7ea6\u200b 0 \u200b\u4e2a\u200b\u5b57\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p> <p></p>","tags":["HelloWorld"]},{"location":"blog/2024/12/14/editors-vim/","title":"Editors (Vim)","text":"<p> \u200b\u7ea6\u200b 1214 \u200b\u4e2a\u200b\u5b57\u200b  110 \u200b\u884c\u200b\u4ee3\u7801\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 5 \u200b\u5206\u949f\u200b</p> <p>Attachment</p> <p>course link: Editors (Vim)</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#modal-editing","title":"Modal editing","text":"<p>Vim has multiple operating modes.</p> <ul> <li>Normal: for moving around a file and making edits</li> <li>Insert: for inserting text</li> <li>Replace: for replacing text</li> <li>Visual (plain, line, or block): for selecting blocks of text</li> <li>Command-line: for running a command</li> </ul> <p></p>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#basics","title":"Basics","text":"","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#inserting-text","title":"Inserting text","text":"<p>From Normal mode, press <code>i</code> to enter Insert mode. </p> <p>Now, Vim behaves like any other text editor, until you press<code>&lt;ESC&gt;</code> to return to Normal mode. </p>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#buffers-tabs-and-windows","title":"Buffers, tabs, and windows","text":"<p>Vim maintains a set of open files, called \u201cbuffers\u201d. </p> <p>A Vim session has a number of tabs, each of which has a number of windows (split panes). </p> <p>Each window shows a single buffer. Unlike other programs you are familiar with, like web browsers, there is not a 1-to-1 correspondence between buffers and windows; windows are merely views. </p> <p>A given buffer may be open in multiple windows, even within the same tab.</p> <p>This can be quite handy, for example, to view two different parts of a file at the same time.</p> <p>By default, Vim opens with a single tab, which contains a single window.</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#command-line","title":"Command-line","text":"<p>Command mode can be entered by typing <code>:</code> in Normal mode. </p> <p>Your cursor will jump to the command line at the bottom of the screen upon pressing <code>:</code>. </p> <p>This mode has many functionalities, including opening, saving, and closing files, and quitting Vim.</p> <ul> <li><code>:q</code> quit (close window)</li> <li><code>:w</code> save (\u201cwrite\u201d)</li> <li><code>:wq</code> save and quit</li> <li><code>:e {name of file}</code> open file for editing</li> <li><code>:ls</code> show open buffers</li> <li><code>:help {topic}</code> open help<ul> <li><code>:help :w</code> opens help for the <code>:w</code> command</li> <li><code>:help w</code> opens help for the <code>w</code> movement</li> </ul> </li> </ul>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#vims-interface-is-a-programming-language","title":"Vim\u2019s interface is a programming language","text":"","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#movement","title":"Movement","text":"<p>Movements in Vim are also called \u201cnouns\u201d, because they refer to chunks of text.</p> <ul> <li>Basic movement: <code>hjkl</code> (left, down, up, right)</li> <li>Words: <code>w</code> (next word), <code>b</code> (beginning of word), <code>e</code> (end of word)</li> <li>Lines: <code>0</code> (beginning of line), <code>^</code> (first non-blank character), <code>$</code> (end of line)</li> <li>Screen: <code>H</code> (top of screen), <code>M</code> (middle of screen), <code>L</code> (bottom of screen)</li> <li>Scroll: <code>Ctrl-u</code> (up), <code>Ctrl-d</code> (down)</li> <li>File: <code>gg</code> (beginning of file), <code>G</code> (end of file)</li> <li>Line numbers: :<code>{number}&lt;CR&gt;</code> or <code>{number}G</code> (line {number})</li> <li>Misc: <code>%</code> (corresponding item)</li> <li>Find: <code>f{character}</code>, <code>t{character}</code>, <code>F{character}</code>, <code>T{character}</code><ul> <li>find/to forward/backward {character} on the current line</li> <li><code>,</code> / <code>;</code> for navigating matches</li> </ul> </li> <li>Search: <code>/{regex}</code>, <code>n</code> / <code>N</code> for navigating matches    </li> </ul>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#selection","title":"Selection","text":"<p>Visual modes:</p> <ul> <li>Visual: v</li> <li>Visual Line: V</li> <li>Visual Block: Ctrl-v</li> </ul> <p>Can use movement keys to make selection.</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#edits","title":"Edits","text":"<p>Vim\u2019s editing commands are also called \u201cverbs\u201d, because verbs act on nouns.</p> <ul> <li><code>i</code> enter Insert mode<ul> <li>but for manipulating/deleting text, want to use something more than backspace</li> </ul> </li> <li><code>o</code> / <code>O</code> insert line below / above</li> <li><code>d{motion}</code> delete <code>{motion}</code><ul> <li>e.g. <code>dw</code> is delete word, <code>d$</code> is delete to end of line, <code>d0</code> is delete to beginning of line</li> </ul> </li> <li><code>c{motion}</code> change <code>{motion}</code><ul> <li>e.g. <code>cw</code> is change word</li> <li>like <code>d{motion}</code> followed by <code>i</code></li> </ul> </li> <li><code>x</code> delete character (equal do <code>dl</code>)</li> <li><code>s</code> substitute character (equal to <code>cl</code>)</li> <li>Visual mode + manipulation<ul> <li>select text, <code>d</code> to delete it or <code>c</code> to change it</li> </ul> </li> <li><code>u</code> to undo, <code>&lt;C-r&gt;</code> to redo</li> <li><code>y</code> to copy / \u201cyank\u201d (some other commands like <code>d</code> also copy)</li> <li><code>p</code> to paste</li> <li>Lots more to learn: e.g. <code>~</code> flips the case of a character</li> </ul>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#counts","title":"Counts","text":"<p>You can combine nouns and verbs with a count, which will perform a given action a number of times.</p> <ul> <li><code>3w</code> move 3 words forward</li> <li><code>5j</code> move 5 lines down</li> <li><code>7dw</code> delete 7 words</li> </ul>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#modifiers","title":"Modifiers","text":"<p>You can use modifiers to change the meaning of a noun. </p> <p>Some modifiers are <code>i</code>, which means \u201cinner\u201d or \u201cinside\u201d, and <code>a</code>, which means \u201caround\u201d.</p> <ul> <li><code>ci(</code> change the contents inside the current pair of parentheses</li> <li><code>ci[</code> change the contents inside the current pair of square brackets</li> <li><code>da'</code> delete a single-quoted string, including the surrounding single quotes</li> </ul>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#customizing-vim","title":"Customizing Vim","text":"<p>Vim is customized through a plain-text configuration file in <code>~/.vimrc</code> (containing Vimscript commands).</p> <p>Here is the basic configuration file that provided by this course.</p> VimL<pre><code>\" Comments in Vimscript start with a `\"`.\n\n\" If you open this file in Vim, it'll be syntax highlighted for you.\n\n\" Vim is based on Vi. Setting `nocompatible` switches from the default\n\" Vi-compatibility mode and enables useful Vim functionality. This\n\" configuration option turns out not to be necessary for the file named\n\" '~/.vimrc', because Vim automatically enters nocompatible mode if that file\n\" is present. But we're including it here just in case this config file is\n\" loaded some other way (e.g. saved as `foo`, and then Vim started with\n\" `vim -u foo`).\nset nocompatible\n\n\" Turn on syntax highlighting.\nsyntax on\n\n\" Disable the default Vim startup message.\nset shortmess+=I\n\n\" Show line numbers.\nset number\n\n\" This enables relative line numbering mode. With both number and\n\" relativenumber enabled, the current line shows the true line number, while\n\" all other lines (above and below) are numbered relative to the current line.\n\" This is useful because you can tell, at a glance, what count is needed to\n\" jump up or down to a particular line, by {count}k to go up or {count}j to go\n\" down.\nset relativenumber\n\n\" Always show the status line at the bottom, even if you only have one window open.\nset laststatus=2\n\n\" The backspace key has slightly unintuitive behavior by default. For example,\n\" by default, you can't backspace before the insertion point set with 'i'.\n\" This configuration makes backspace behave more reasonably, in that you can\n\" backspace over anything.\nset backspace=indent,eol,start\n\n\" By default, Vim doesn't let you hide a buffer (i.e. have a buffer that isn't\n\" shown in any window) that has unsaved changes. This is to prevent you from \"\n\" forgetting about unsaved changes and then quitting e.g. via `:qa!`. We find\n\" hidden buffers helpful enough to disable this protection. See `:help hidden`\n\" for more information on this.\nset hidden\n\n\" This setting makes search case-insensitive when all characters in the string\n\" being searched are lowercase. However, the search becomes case-sensitive if\n\" it contains any capital letters. This makes searching more convenient.\nset ignorecase\nset smartcase\n\n\" Enable searching as you type, rather than waiting till you press enter.\nset incsearch\n\n\" Unbind some useless/annoying default key bindings.\nnmap Q &lt;Nop&gt; \" 'Q' in normal mode enters Ex mode. You almost never want this.\n\n\" Disable audible bell because it's annoying.\nset noerrorbells visualbell t_vb=\n\n\" Enable mouse support. You should avoid relying on this too much, but it can\n\" sometimes be convenient.\nset mouse+=a\n\n\" Try to prevent bad habits like using the arrow keys for movement. This is\n\" not the only possible bad habit. For example, holding down the h/j/k/l keys\n\" for movement, rather than using more efficient movement commands, is also a\n\" bad habit. The former is enforceable through a .vimrc, while we don't know\n\" how to prevent the latter.\n\" Do this in normal mode...\nnnoremap &lt;Left&gt;  :echoe \"Use h\"&lt;CR&gt;\nnnoremap &lt;Right&gt; :echoe \"Use l\"&lt;CR&gt;\nnnoremap &lt;Up&gt;    :echoe \"Use k\"&lt;CR&gt;\nnnoremap &lt;Down&gt;  :echoe \"Use j\"&lt;CR&gt;\n\" ...and in insert mode\ninoremap &lt;Left&gt;  &lt;ESC&gt;:echoe \"Use h\"&lt;CR&gt;\ninoremap &lt;Right&gt; &lt;ESC&gt;:echoe \"Use l\"&lt;CR&gt;\ninoremap &lt;Up&gt;    &lt;ESC&gt;:echoe \"Use k\"&lt;CR&gt;\ninoremap &lt;Down&gt;  &lt;ESC&gt;:echoe \"Use j\"&lt;CR&gt;\n</code></pre> <p>For macos, There might not have the default <code>.vimrc</code> file in <code>~</code>.</p> <p>But never mind, just type <code>vim ~/.vimrc</code> and paste the code into it, then type <code>:wq</code>.</p> <p>You will find that everything is done!</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#extending-vim","title":"Extending Vim","text":"<p>copy lecture notes...need review</p> <p>There are tons of plugins for extending Vim. Contrary to outdated advice that you might find on the internet, you do not need to use a plugin manager for Vim (since Vim 8.0). Instead, you can use the built-in package management system. Simply create the directory <code>~/.vim/pack/vendor/start/</code>, and put plugins in there (e.g. via <code>git clone</code>).</p> <p>Here are some of our favorite plugins:</p> <ul> <li>ctrlp.vim: fuzzy file finder</li> <li>ack.vim: code search</li> <li>nerdtree: file explorer</li> <li>vim-easymotion: magic motions</li> </ul> <p>We\u2019re trying to avoid giving an overwhelmingly long list of plugins here. You can check out the instructors\u2019 dotfiles (Anish, Jon, Jose) to see what other plugins we use. Check out Vim Awesome for more awesome Vim plugins. There are also tons of blog posts on this topic: just search for \u201cbest Vim plugins\u201d.</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#resources","title":"Resources","text":"<ul> <li>vimtutor is a tutorial that comes installed with Vim - if Vim is installed, you should be able to run <code>vimtutor</code> from your shell</li> <li>Vim Adventures is a game to learn Vim</li> <li>Vim Tips Wiki</li> <li>Vim Advent Calendar has various Vim tips</li> <li>Vim Golf is code golf, but where the programming language is Vim\u2019s UI</li> <li>Vi/Vim Stack Exchange</li> <li>Vim Screencasts</li> <li>Practical Vim (book)</li> </ul>","tags":["CS","Missing"]},{"location":"blog/2024/12/14/editors-vim/#exercises","title":"Exercises","text":"<p>Warning</p> <p>I will write my own solution to the problem, If you want to solve those by yourself, please stop.</p> <p>Problem1</p> <p>Complete <code>vimtutor</code>. Note: it looks best in a <code>80x24</code> (80 columns by 24 lines) terminal window.</p> <p></p> <p>Solution</p> Bash<pre><code>vimtutor\n</code></pre> <p>Problem2</p> <ul> <li> <p>Install and configure a plugin: ctrlp.vim.</p> <ol> <li>Create the plugins directory with <code>mkdir -p ~/.vim/pack/vendor/start</code></li> <li>Download the plugin: <code>cd ~/.vim/pack/vendor/start; git clone https://github.com/ctrlpvim/ctrlp.vim</code></li> <li>Read the documentation for the plugin. Try using CtrlP to locate a file by navigating to a project directory, opening Vim, and using the Vim command-line to start <code>:CtrlP</code>.</li> <li>Customize CtrlP by adding configuration to your <code>~/.vimrc</code> to open CtrlP by pressing Ctrl-P.</li> </ol> </li> </ul> <p></p> <p>Solution</p> <p>...TO DO</p> <p>Problem3</p> <p>To practice using Vim, re-do the Demo from lecture on your own machine.</p> <p>Here is a broken fizz buzz implementation:</p> Python<pre><code>def fizz_buzz(limit):\n    for i in range(limit):\n        if i % 3 == 0:\n            print('fizz')\n        if i % 5 == 0:\n            print('fizz')\n        if i % 3 and i % 5:\n            print(i)\n\ndef main():\n    fizz_buzz(10)\n</code></pre> <p>fix the following issues:</p> <ul> <li>Main is never called</li> <li>Starts at 0 instead of 1</li> <li>Prints \u201cfizz\u201d and \u201cbuzz\u201d on separate lines for multiples of 15</li> <li>Prints \u201cfizz\u201d for multiples of 5</li> <li>Uses a hard-coded argument of 10 instead of taking a command-line argument</li> </ul> <p></p> <p>Solution</p> <ol> <li><code>G</code> move to the bottom of the file</li> <li><code>o</code> create a new line</li> <li>insert code:</li> </ol> Python<pre><code>if __name__ == '__main__':\n    main()\n</code></pre> <ol> <li><code>/limit</code> search for <code>limit</code>, then press <code>n</code> to move to the next match</li> <li><code>i</code> enter <code>insert</code> mode, and change <code>limit</code> to <code>1, limit + 1</code></li> <li><code>/fizz</code> search for <code>fizz</code>, then press <code>n</code> to move to the next match.</li> <li><code>ci'</code> change the inner text of <code>'</code>, insert <code>buzz</code></li> <li>move the cursor to the <code>print('fizz')</code> line, press <code>$</code>, then <code>i</code> enter insert mode and insert <code>, end=''</code></li> <li><code>jj.</code> move the cursor to line 6 and make the same change as previous did</li> <li><code>gg</code> move the cursor to the top of the file, <code>O</code> create the new line above\uff0cand insert <code>import sys</code></li> <li><code>/10</code> find <code>10</code>, then <code>ci(</code> change the text in <code>(</code>, type <code>int(sys.argv[1])</code></li> </ol> <p>The final result:</p> Python<pre><code>import sys\n\ndef fizz_buzz(limit):\n    for i in range(1, limit + 1):\n        if i % 3 == 0:\n            print('fizz', end='')\n        if i % 5 == 0:\n            print('buzz', end='')\n        if i % 3 and i % 5:\n            print(i)\n\ndef main():\n    fizz_buzz(int(sys.argv[1]))\n\nif __name__ == '__main__':\n    main()\n</code></pre> <p>Problem4</p> <p>(Advanced) Convert XML to JSON (example file) using Vim macros. Try to do this on your own, but you can look at the macros section above if you get stuck.</p> <p></p> <p>Solution</p> <p>...TO DO</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/","title":"Shell Tools and Scripting","text":"<p> \u200b\u7ea6\u200b 2038 \u200b\u4e2a\u200b\u5b57\u200b  149 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 9 \u200b\u5206\u949f\u200b</p> <p>Attachment</p> <p>course link: Shell Tools and Scripting</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#shell-scripting","title":"Shell Scripting","text":"","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#1-assign-variables","title":"1. Assign Variables","text":"<p>To assign variables in bash, use the syntax <code>foo=bar</code> and access the value of the variable with <code>$foo</code>. Note that <code>foo = bar</code> will not work since it is interpreted as calling the <code>foo</code> program with arguments <code>=</code> and <code>bar</code>. In general, in shell scripts the space character will perform argument splitting. This behavior can be confusing to use at first, so always check for that.</p> <p>Strings in bash can be defined with <code>'</code> and <code>\"</code> delimiters.</p> <p>Strings delimited with <code>'</code> are literal strings and will not substitute variable values.</p> <p>Strings delimited with <code>\"</code> will substitute variable values.</p> Bash<pre><code>foo=bar\necho \"$foo\"\n# prints bar\necho '$foo'\n# prints $foo\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#2-functions","title":"2. Functions","text":"<p>As with most programming languages, bash supports control flow techniques including <code>if</code>, <code>case</code>, <code>while</code> and <code>for</code>. Similarly, bash has functions that take arguments and can operate with them. </p> <p>Here is an example of a function that creates a directory and cds into it.</p> Bash<pre><code>mcd () {\n    mkdir -p \"$1\"\n    cd \"$1\"\n}\n</code></pre> <p>Here is how to test <code>mcd</code> function</p> Bash<pre><code>vim mcd.sh\n# paste the code into it...\nsource mcd.sh\nmcd test\n# And you will find that you are in the test directory, which is a \n# child dir in which you run the mcd program\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#3-function-arguments","title":"3. Function arguments","text":"<p>Unlike other scripting languages, bash uses a variety of special variables to refer to arguments, error codes, and other relevant variables. Below is a list of some of them. A more comprehensive list can be found here.</p> <ul> <li><code>$0</code> - Name of the script</li> <li><code>$1</code> to <code>$9</code> - Arguments to the script. <code>$1</code> is the first argument and so on.</li> <li><code>$@</code> - All the arguments</li> <li><code>$#</code> - Number of arguments</li> <li><code>$?</code> - Return code of the previous command</li> <li><code>$$</code> - Process identification number (PID) for the current script</li> <li><code>!!</code> - Entire last command, including arguments. A common pattern is to execute a command only for it to fail due to missing permissions; you can quickly re-execute the command with sudo by doing <code>sudo !!</code></li> <li><code>$_</code> - Last argument from the last command. If you are in an interactive shell, you can also quickly get this value by typing <code>Esc</code> followed by <code>.</code> or <code>Alt+</code>.</li> </ul> <p>Commands will often return output using <code>STDOUT</code>, errors through <code>STDERR</code>, and a Return Code to report errors in a more script-friendly manner. </p> <p>The return code or exit status is the way scripts/commands have to communicate how execution went. </p> <ul> <li>A value of <code>0</code> usually means everything went OK</li> <li>anything different from <code>0</code> means an error occurred.</li> </ul> <p>Exit codes can be used to conditionally execute commands using <code>&amp;&amp;</code> (and operator) and <code>||</code> (or operator), both of which are short-circuiting operators. </p> <p>Commands can also be separated within the same line using a semicolon <code>;</code>. </p> <ul> <li>The <code>true</code> program will always have a <code>0</code> return code</li> <li>the <code>false</code> command will always have a <code>1</code> return code. </li> </ul> <p>Let\u2019s see some examples</p> Bash<pre><code>false || echo \"Oops, fail\"\n# Oops, fail\n\ntrue || echo \"Will not be printed\"\n#\n\ntrue &amp;&amp; echo \"Things went well\"\n# Things went well\n\nfalse &amp;&amp; echo \"Will not be printed\"\n#\n\ntrue ; echo \"This will always run\"\n# This will always run\n\nfalse ; echo \"This will always run\"\n# This will always run\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#4-substitution","title":"4. Substitution","text":"<p>Another common pattern is wanting to get the output of a command as a variable. </p> <p>This can be done with <code>command substitution</code>. Whenever you place <code>$( CMD )</code> it will execute <code>CMD</code>, get the output of the command and substitute it in place. </p> <p>For example, if you do <code>for file in $(ls)</code>, the shell will first call ls and then iterate over those values. </p> <p>A lesser known similar feature is <code>process substitution</code>, <code>&lt;( CMD )</code> will execute <code>CMD</code> and place the output in a temporary file and substitute the <code>&lt;()</code> with that file\u2019s name.</p> <p>This is useful when commands expect values to be passed by file instead of by <code>STDIN</code>. For example, <code>diff &lt;(ls foo) &lt;(ls bar)</code> will show differences between files in dirs <code>foo</code> and <code>bar</code>.</p> <p></p> <p>let\u2019s see an example that showcases some of these features. </p> <p>It will iterate through the arguments we provide, grep for the string foobar, and append it to the file as a comment if it\u2019s not found.</p> Bash<pre><code>#!/bin/bash\n\necho \"Starting program at $(date)\" # Date will be substituted\n\necho \"Running program $0 with $# arguments with pid $$\"\n\nfor file in \"$@\"; do\n    grep foobar \"$file\" &gt; /dev/null 2&gt; /dev/null\n    # When pattern is not found, grep has exit status 1\n    # We redirect STDOUT and STDERR to a null register since we do not care about them\n    if [[ $? -ne 0 ]]; then\n        echo \"File $file does not have any foobar, adding one\"\n        echo \"# foobar\" &gt;&gt; \"$file\"\n    fi\ndone\n</code></pre> <p>In the comparison we tested whether <code>$?</code> was not equal to <code>0</code>. Bash implements many comparisons of this sort - you can find a detailed list in the manpage for test. </p> <p>When performing comparisons in bash, try to use double brackets <code>[[ ]]</code> in favor of simple brackets <code>[ ]</code>. Chances of making mistakes are lower although it won\u2019t be portable to <code>sh</code>. A more detailed explanation can be found here.</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#5-globbing","title":"5. Globbing","text":"<p>When launching scripts, you will often want to provide arguments that are similar. Bash has ways of making this easier, expanding expressions by carrying out filename expansion. These techniques are often referred to as shell globbing.</p> <ul> <li>Wildcards<ul> <li><code>?</code> match one character.</li> <li><code>*</code> match any amount of characters. </li> <li>For instance, given files <code>foo, foo1, foo2, foo10 and bar</code>, the command <code>rm foo?</code> will delete foo1 and foo2 whereas <code>rm foo*</code> will delete all but bar.</li> </ul> </li> <li>Curly braces <code>{}</code> - Whenever you have a common substring in a series of commands, you can use curly braces for bash to expand this automatically. This comes in very handy when moving or converting files.</li> </ul> Bash<pre><code>convert image.{png,jpg}\n# Will expand to\nconvert image.png image.jpg\n\ncp /path/to/project/{foo,bar,baz}.sh /newpath\n# Will expand to\ncp /path/to/project/foo.sh /path/to/project/bar.sh /path/to/project/baz.sh /newpath\n\n# Globbing techniques can also be combined\nmv *{.py,.sh} folder\n# Will move all *.py and *.sh files\n\n\nmkdir foo bar\n# This creates files foo/a, foo/b, ... foo/h, bar/a, bar/b, ... bar/h\ntouch {foo,bar}/{a..h}\ntouch foo/x bar/y\n# Show differences between files in foo and bar\ndiff &lt;(ls foo) &lt;(ls bar)\n# Outputs\n# &lt; x\n# ---\n# &gt; y\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#6-shebang","title":"6. shebang","text":"<p>Note that scripts need not necessarily be written in bash to be called from the terminal. For instance, here\u2019s a simple Python script that outputs its arguments in reversed order:</p> Python<pre><code>#!/usr/local/bin/python\nimport sys\nfor arg in reversed(sys.argv[1:]):\n    print(arg)\n</code></pre> <p>The kernel knows to execute this script with a python interpreter instead of a shell command because we included a shebang line at the top of the script. </p> <p>It is good practice to write shebang lines using the <code>env</code> command that will resolve to wherever the command lives in the system, increasing the portability of your scripts.</p> <p>btw, if you really want to figure out where your program is, type this: <code>which python</code>, namely <code>which ***</code>, and add the output to the shebang line </p> <p>To resolve the location, <code>env</code> will make use of the <code>PATH</code> environment variable we introduced in the first lecture. For this example the shebang line would look like <code>#!/usr/bin/env python</code>.</p> <p>Some differences between shell functions and scripts that you should keep in mind are:</p> <ul> <li>Functions have to be in the same language as the shell, while scripts can be written in any language. This is why including a shebang for scripts is important.</li> <li>Functions are loaded once when their definition is read. Scripts are loaded every time they are executed. This makes functions slightly faster to load, but whenever you change them you will have to reload their definition.</li> <li>Functions are executed in the current shell environment whereas scripts execute in their own process. Thus, functions can modify environment variables, e.g. change your current directory, whereas scripts can\u2019t. Scripts will be passed by value environment variables that have been exported using export</li> <li>As with any programming language, functions are a powerful construct to achieve modularity, code reuse, and clarity of shell code. Often shell scripts will include their own function definitions.</li> </ul>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#shell-tools","title":"Shell Tools","text":"","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#1-finding-how-to-use-commands","title":"1. Finding how to use commands","text":"<ul> <li>the first-order approach is to call said command with the <code>-h</code> or <code>--help</code> flags. </li> <li>A more detailed approach is to use the <code>man</code> command. Short for manual, man provides a manual page (called manpage) for a command you specify.</li> <li>For interactive tools such as the ones based on ncurses, help for the commands can often be accessed within the program using the <code>:help</code> command or typing <code>?</code>.</li> </ul> <p>Sometimes manpages can provide overly detailed descriptions of the commands, making it hard to decipher what flags/syntax to use for common use cases. </p> <p>TLDR pages are a nifty complementary solution that focuses on giving example use cases of a command so you can quickly figure out which options to use. </p> <p>To use <code>tldr</code>, just type: <code>tldr ***</code> (just remind, you need to install it first)</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#2-finding-files","title":"2. Finding files","text":"<p><code>find</code> will recursively search for files matching some criteria. </p> <p>Some examples:</p> Bash<pre><code># Find all directories named src\nfind . -name src -type d\n# Find all python files that have a folder named test in their path\nfind . -path '*/test/*.py' -type f\n# Find all files modified in the last day\nfind . -mtime -1\n# Find all zip files with size in range 500k to 10M\nfind . -size +500k -size -10M -name '*.tar.gz'\n</code></pre> <p>Beyond listing files, find can also perform actions over files that match your query. This property can be incredibly helpful to simplify what could be fairly monotonous tasks.</p> Bash<pre><code># Delete all files with .tmp extension\nfind . -name '*.tmp' -exec rm {} \\;\n# Find all PNG files and convert them to JPG\nfind . -name '*.png' -exec convert {} {}.jpg \\;\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#3-finding-code","title":"3. Finding code","text":"<p><code>grep</code>, a generic tool for matching patterns from the input text. </p> <p>For now, know that <code>grep</code> has many flags that make it a very versatile tool. Some I frequently use are <code>-C</code> for getting Context around the matching line and <code>-v</code> for inverting the match, i.e. print all lines that do not match the pattern. </p> <p>For example, <code>grep -C 5</code> will print 5 lines before and after the match. When it comes to quickly searching through many files, you want to use <code>-R</code> since it will Recursively go into directories and look for files for the matching string.</p> <p>But <code>grep -R</code> can be improved in many ways, such as ignoring <code>.git</code> folders, using multi CPU support, &amp;c. </p> <p>Many grep alternatives have been developed, including ack, ag and rg. All of them are fantastic and pretty much provide the same functionality. For now I am sticking with ripgrep (rg), given how fast and intuitive it is. Some examples:</p> Bash<pre><code># Find all python files where I used the requests library\nrg -t py 'import requests'\n# Find all files (including hidden files) without a shebang line\nrg -u --files-without-match \"^#\\!\"\n# Find all matches of foo and print the following 5 lines\nrg foo -A 5\n# Print statistics of matches (# of matched lines and files )\nrg --stats PATTERN\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#4-finding-shell-commands","title":"4. Finding shell commands","text":"<p>The <code>history</code> command will let you access your shell history programmatically. </p> <p>It will print your shell history to the standard output. If we want to search there we can pipe that output to grep and search for patterns. <code>history | grep find</code> will print commands that contain the substring <code>\u201cfind\u201d</code>.</p> <p>In most shells, you can make use of <code>Ctrl+R</code> to perform backwards search through your history. After pressing <code>Ctrl+R</code>, you can type a substring you want to match for commands in your history. As you keep pressing it, you will cycle through the matches in your history. </p>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#5-directory-navigation","title":"5. Directory Navigation","text":"<p>uh...just look up the lecture notes</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#exercises","title":"Exercises","text":"<p>Warning</p> <p>I will write my own solution to the problem, If you want to solve those by yourself, please stop.</p> <p>Problem1</p> <p>Read <code>man ls</code> and write an <code>ls</code> command that lists files in the following manner</p> <ul> <li>Includes all files, including hidden files</li> <li>Sizes are listed in human readable format (e.g. 454M instead of 454279954)</li> <li>Files are ordered by recency</li> <li>Output is colorized</li> </ul> <p>A sample output would look like this</p> Bash<pre><code> -rw-r--r--   1 user group 1.1M Jan 14 09:53 baz\n drwxr-xr-x   5 user group  160 Jan 14 09:53 .\n -rw-r--r--   1 user group  514 Jan 14 06:42 bar\n -rw-r--r--   1 user group 106M Jan 13 12:12 foo\n drwx------+ 47 user group 1.5K Jan 12 18:08 ..\n</code></pre> <p></p> <p>Solution</p> Bash<pre><code>[root@iZbp12idmwavjjcx2k19kjZ course2]# ls -a -l -h -t --color=auto\ntotal 88K\n-rw-r--r--  1 root root  54K Dec  3 21:46 install_lts.sh\ndrwxr-xr-x  5 root root 4.0K Dec  3 21:46 .\n-rwxrwxrwx  1 root root   83 Dec  3 20:04 script.py\ndrwxr-xr-x 11 root root 4.0K Dec  3 20:02 bar\ndrwxr-xr-x 11 root root 4.0K Dec  3 20:02 foo\n-rwxrwxrwx  1 root root   50 Dec  3 19:21 mcd.sh\n-rwxrwxrwx  1 root root  485 Dec  3 19:21 f.sh\ndrwxr-xr-x  2 root root 4.0K Dec  3 19:17 test\ndrwxr-xr-x 14 root root 4.0K Dec  3 19:12 ..\n</code></pre> <ul> <li><code>-a</code> : includes all files</li> <li><code>-l</code> : use a long listing format</li> <li><code>-h</code> : print sizes like 1K 234M 2G etc.</li> <li><code>-t</code> : sort by recency</li> <li><code>--color=auto</code> : colorize output</li> </ul> <p>Problem2</p> <p>Write bash functions <code>marco</code> and <code>polo</code> that do the following. Whenever you execute <code>marco</code> the current working directory should be saved in some manner, then when you execute <code>polo</code>, no matter what directory you are in, <code>polo</code> should <code>cd</code> you back to the directory where you executed <code>marco</code>. For ease of debugging you can write the code in a file <code>marco.sh</code> and (re)load the definitions to your shell by executing <code>source marco.sh</code>.</p> <p></p> <p>Solution</p> Bash<pre><code>#!/bin/bash\nmarco() {\n        echo \"$(pwd)\" &gt; $HOME/marco_history.log\n        echo \"save pwd - $(pwd)\"\n}\npolo() {\n        cd \"$(cat \"$HOME/marco_history.log\")\"\n}\n</code></pre> <p>Problem3</p> <p>Say you have a command that fails rarely. In order to debug it you need to capture its output but it can be time consuming to get a failure run. Write a bash script that runs the following script until it fails and captures its standard output and error streams to files and prints everything at the end. Bonus points if you can also report how many runs it took for the script to fail.</p> Bash<pre><code> #!/usr/bin/env bash\n\n n=$(( RANDOM % 100 ))\n\n if [[ n -eq 42 ]]; then\n    echo \"Something went wrong\"\n    &gt;&amp;2 echo \"The error was using magic numbers\"\n    exit 1\n fi\n\n echo \"Everything went according to plan\"\n</code></pre> <p></p> <p>Solution</p> Bash<pre><code>#!/usr/bin/env bash\ncount=0\necho &gt; out.log\n\nwhile true\ndo\n        ./task3.sh &amp;&gt;&gt; out.log\n        if [[ $? -ne 0 ]]; then\n                cat out.log\n                echo \"failed after $count times\"\n                break\n        fi\n        ((count++))\ndone\n</code></pre> <p>Problem4</p> <p>As we covered in the lecture <code>find</code>\u2019s <code>-exec</code> can be very powerful for performing operations over the files we are searching for. However, what if we want to do something with all the files, like creating a zip file? As you have seen so far commands will take input from both arguments and STDIN. When piping commands, we are connecting STDOUT to STDIN, but some commands like <code>tar</code> take inputs from arguments. To bridge this disconnect there\u2019s the xargs command which will execute a command using STDIN as arguments. For example <code>ls | xargs rm</code> will delete the files in the current directory.</p> <p>Your task is to write a command that recursively finds all HTML files in the folder and makes a zip with them. Note that your command should work even if the files have spaces (hint: check <code>-d</code> flag for <code>xargs</code>).</p> <p></p> <p>Solution</p> <p>prerequisite</p> Bash<pre><code>mkdir html_root\ncd html_root\nmkdir html_{a..h}\ntouch html_{a..h}/{a..h}.html\n</code></pre> <p>code</p> Bash<pre><code>find . -type f -name '*.html' | xargs -d '\\n' tar -cvzf html.zip\n</code></pre> <ol> <li> <p><code>find . -type f -name \"*.html\"</code></p> <ul> <li><code>find</code> searches for files and directories.</li> <li><code>.</code> specifies the current directory as the starting point.</li> <li><code>-type f</code> filters the results to include only files (not directories or other types).</li> <li><code>-name \"*.html\"</code> matches files with the .html extension.</li> <li>Output: A list of <code>.html</code> file paths.</li> </ul> </li> <li> <p><code>|</code> (Pipe symbol)</p> <ul> <li>Passes the output of find (list of .html files) as input to the next command, xargs.</li> </ul> </li> <li> <p><code>xargs -d '\\n'</code></p> <ul> <li><code>xargs</code> converts the input (list of file paths) into arguments for the tar command.</li> <li><code>-d '\\n'</code> specifies that each line of input is treated as a separate file. This ensures paths with spaces or special characters are handled correctly.</li> </ul> </li> <li> <p><code>tar -cvzf html.zip</code></p> <ul> <li><code>tar</code> creates compressed archives.</li> <li><code>-c</code> : Creates a new archive.</li> <li><code>-v</code> : Displays a list of files being added to the archive (verbose mode).</li> <li><code>-z</code> : Compresses the archive using gzip.</li> <li><code>-f</code> html.zip: Names the output file <code>html.zip</code>.</li> </ul> </li> </ol> <p>Problem5</p> <p>(Advanced) Write a command or script to recursively find the most recently modified file in a directory. More generally, can you list all files by recency?</p> <p></p> <p>Solution</p> Bash<pre><code>find . -type f -print0 | xargs -0 ls -lt | head -1\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/04/shell-tools-and-scripting/#summary","title":"Summary","text":"<p>uh... I find that I'm still quite uncomfortable with the grammar of bash script. The next step I think, before next lecture, maybe is to pursue a deeper and better understanding of bash script.</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/","title":"The Shell","text":"<p> \u200b\u7ea6\u200b 1290 \u200b\u4e2a\u200b\u5b57\u200b  103 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 6 \u200b\u5206\u949f\u200b</p> <p>\u200b\u524d\u8a00\u200b</p> <p>\u200b\u4e34\u8fd1\u200b\u671f\u672b\u200b\uff0c\u200b\u524d\u65b9\u200b\u6709\u200b\u4e00\u5927\u5806\u200b\u7684\u200b\u80cc\u8bf5\u200b+\u200b\u8003\u8bd5\u200b\u7b49\u200b\u7740\u200b\u6211\u200b\uff0c\u200b\u4f46\u200b\u6211\u200b\u597d\u50cf\u200b\u4e0d\u662f\u200b\u5f88\u200b\u614c\u200b(\u200b\u8fd9\u662f\u200b\u4ec0\u4e48\u200b\u539f\u56e0\u200b...), \u200b\u611f\u89c9\u200b\u6211\u200b\u662f\u200b\u90a3\u79cd\u200b\u4e0d\u6b7b\u200b\u5230\u200b\u4e34\u5934\u200b\u4e0d\u4f1a\u200b\u52a8\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u95f2\u200b\u7684\u200b\u65e0\u804a\u200b\u51b3\u5b9a\u200b\u5237\u200b\u4e00\u4e0b\u200b\u8fd9\u95e8\u200b\u5e7f\u53d7\u200b\u597d\u8bc4\u200b\u7684\u200b\u516c\u5f00\u8bfe\u200b\uff0c\u200b\u5c31\u200b\u5f53\u505a\u200b\u5a31\u4e50\u200b\u653e\u677e\u200b\u7f62\u200b(\u200b\u8ba1\u5212\u200b\u4f7f\u7528\u200b\u82f1\u6587\u200b\u7b14\u8bb0\u200b\uff0c\u200b\u953b\u70bc\u200b\u4e00\u4e0b\u200b\u5199\u4f5c\u80fd\u529b\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5927\u91cf\u200b\u9519\u8bef\u200b\u8bf7\u200b\u89c1\u8c05\u200b ----\u200b\u8bfe\u7a0b\u200b\u94fe\u63a5\u200b: 2020 Lectures \u00b7 Missing Semester </p> <p>\u200b\u672c\u200b\u7ae0\u8282\u200b\u94fe\u63a5\u200b: Missing Semester Overview</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/#1-what-is-the-shell","title":"1. What is the shell","text":"<p>All kinds of shell share one common core: they allow you to run programs, give them input, and inspect their output in a semi-structured way</p> <p>As I use macos, my shell is terminal or namely zsh. (uh... btw, to be honest, I don't quiet know the differences between zsh and terminal and shell, hope I'm right..</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/#2-using-the-shell","title":"2. Using the shell","text":"<p>When you launch your terminal, you will see a prompt that often looks a little like this:</p> Bash<pre><code>missing:~$ \n</code></pre> <p>Down below is what my shell looks like:</p> Bash<pre><code>chuchengzhi@chenjinyangdeMacBook-Air ~ % \n</code></pre> <p>This is the main textual interface to the shell. It tells you that you are on the machine <code>missing</code> and that your \u201ccurrent working directory\u201d, or where you currently are, is <code>~</code> (short for \u201chome\u201d). The <code>$</code> tells you that you are not the root user (more on that later). At this prompt you can type a command, which will then be interpreted by the shell. </p>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/#some-basic-command","title":"Some basic command","text":"<ol> <li>date</li> </ol> <p><code>date</code> prints the current date and time</p> Bash<pre><code>missing:~$ date\nFri 10 Jan 2020 11:49:31 AM EST\nmissing:~$ \n</code></pre> <ol> <li>echo</li> </ol> <p><code>echo</code> simply prints out its arguments.</p> Bash<pre><code>missing:~$ echo hello\nhello\n</code></pre> <p>If you want to provide an argument that contains spaces or other special characters (e.g., a directory named <code>\u201cMy Photos\u201d</code>), you can either quote the argument with <code>'</code> or <code>\"</code> (<code>\"My Photos\"</code>), or escape just the relevant characters with <code>\\</code> (<code>My\\ Photos</code>).</p> <p>But... it seems that my macos doesn't need those quote or back slash, it will also print out the correct arguments</p> <p>just like \u2b07\ufe0f</p> Bash<pre><code>chuchengzhi@chenjinyangdeMacBook-Air ~ % echo My Photos\nMy Photos\n</code></pre> <p>If the shell is asked to execute a command that doesn\u2019t match one of its programming keywords, it consults an environment variable called <code>$PATH</code> that lists which directories the shell should search for programs when it is given a command:</p> Bash<pre><code>missing:~$ echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nmissing:~$ which echo\n/bin/echo\nmissing:~$ /bin/echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/#3-navigating-in-the-shell","title":"3. Navigating in the shell","text":"<p>1. pwd</p> <p><code>pwd</code> prints the absolute path of current working directory</p> Bash<pre><code>missing:~$ pwd\n/home/missing\n</code></pre> <p>2. cd</p> <p><code>cd</code> change your working directory to another</p> Bash<pre><code>missing:~$ cd /home\nmissing:/home$ pwd\n/home\nmissing:/home$ cd ..\nmissing:/$ pwd\n/\nmissing:/$ cd ./home\nmissing:/home$ pwd\n/home\nmissing:/home$ cd missing\nmissing:~$ pwd\n/home/missing\n</code></pre> <p>3. ls</p> <p>To see what lives in a given directory, we use the <code>ls</code> command:</p> Bash<pre><code>missing:~$ ls\nmissing:~$ cd ..\nmissing:/home$ ls\nmissing\nmissing:/home$ cd ..\nmissing:/$ ls\nbin\nboot\ndev\netc\nhome\n...\n</code></pre> <p>4. ls -l</p> <p><code>ls -l</code> use a long listing format:</p> Bash<pre><code>missing:~$ ls -l /home\ndrwxr-xr-x 1 missing  users  4096 Jun 15  2019 missing\n</code></pre> <ul> <li>First, the <code>d</code> at the beginning of the line tells us that missing is a directory. </li> <li>Then follow three groups of three characters (rwx). These indicate what permissions the owner of the file (missing), the owning group (users), and everyone else respectively have on the relevant item. </li> <li>A <code>-</code> indicates that the given principal does not have the given permission. </li> <li>Above, only the owner is allowed to modify (w) the missing directory (i.e., add/remove files in it). </li> <li>To enter a directory, a user must have \u201csearch\u201d (represented by \u201cexecute\u201d: x) permissions on that directory (and its parents). </li> <li>To list its contents, a user must have read \u00ae permissions on that directory. For files, the permissions are as you would expect. </li> <li>Quick summary: <code>rwx</code> represents the permissions, <code>r</code> for read, <code>w</code> for modify, <code>x</code> for execute, <code>-</code> for don't have the given permission.</li> <li>Notice that nearly all the files in <code>/bin</code> have the <code>x</code> permission set for the last group, \u201ceveryone else\u201d, so that anyone can execute those programs.</li> </ul> <p>5. other else</p> <ul> <li><code>mv</code> (to rename/move a file)</li> <li><code>cp</code> (to copy a file)</li> <li><code>mkdir</code> (to make a new directory).</li> <li><code>man</code> ( It takes as an argument the name of a program, and shows you its manual page. Press <code>q</code> to exit.)</li> </ul> Bash<pre><code>missing:~$ man ls\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/#4-connecting-programs","title":"4. Connecting programs","text":"<p><code>&lt; file</code> and <code>&gt; file</code>. These let you rewire the input and output streams of a program to a file respectively:</p> Bash<pre><code>missing:~$ echo hello &gt; hello.txt\nmissing:~$ cat hello.txt\nhello\nmissing:~$ cat &lt; hello.txt\nhello\nmissing:~$ cat &lt; hello.txt &gt; hello2.txt\nmissing:~$ cat hello2.txt\nhello\n</code></pre> <p><code>cat</code> is a program that concatenates files. When given file names as arguments, it prints the contents of each of the files in sequence to its output stream. But when cat is not given any arguments, it prints contents from its input stream to its output stream (like in the third example above).</p> <p>You can also use <code>&gt;&gt;</code> to append to a file</p> <p>The <code>|</code> operator lets you \u201cchain\u201d programs such that the output of one is the input of another:</p> Bash<pre><code>missing:~$ ls -l / | tail -n1\ndrwxr-xr-x 1 root  root  4096 Jun 20  2019 var\nmissing:~$ curl --head --silent google.com | grep --ignore-case content-length | cut --delimiter=' ' -f2\n219\n</code></pre> <p>The command <code>tail</code> means print the tail lines of a file, <code>-n</code> means the index of the line(starting from 1 in the end), <code>-n1</code> means to print the exactly last one line of the file.</p>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/#5-a-versatile-and-powerful-tool","title":"5. A versatile and powerful tool","text":"<p>On most Unix-like systems, one user is special: the \u201croot\u201d user.</p> <p>The root user is above (almost) all access restrictions, and can create, read, update, and delete any file in the system.</p> <p>using the <code>sudo</code> command. As its name implies, it lets you \u201cdo\u201d something \u201cas su\u201d (short for \u201csuper user\u201d, or \u201croot\u201d)</p> <p>One thing you need to be root in order to do is writing to the sysfs file system mounted under <code>/sys</code>. sysfs exposes a number of kernel parameters as files, so that you can easily reconfigure the kernel on the fly without specialized tools. Note that sysfs does not exist on Windows or macOS.</p> <p>For example, the brightness of your laptop\u2019s screen is exposed through a file called brightness under</p> Bash<pre><code>/sys/class/backlight\n</code></pre> <p>By writing a value into that file, we can change the screen brightness. Your first instinct might be to do something like:</p> Bash<pre><code>$ sudo find -L /sys/class/backlight -maxdepth 2 -name '*brightness*'\n/sys/class/backlight/thinkpad_screen/brightness\n$ cd /sys/class/backlight/thinkpad_screen\n$ sudo echo 3 &gt; brightness\nAn error occurred while redirecting file 'brightness'\nopen: Permission denied\n</code></pre> <p>Simply speaking, the error occurs because the shell (which is authenticated just as your user) tries to open the brightness file for writing, before setting that as sudo echo\u2019s output, but is prevented from doing so since the shell does not run as root. </p> Bash<pre><code>$ echo 3 | sudo tee brightness\n</code></pre> <p>Since the <code>tee</code> program is the one to open the <code>/sys</code> file for writing, and it is running as root, the permissions all work out. </p>","tags":["CS","Missing"]},{"location":"blog/2024/12/01/the-shell/#6-exercises","title":"6. exercises","text":"<p>Warning</p> <p>I will write my own solution to the problem, If you want to solve those by yourself, please stop.</p> <p>1. Create a new directory called <code>missing</code> under <code>/tmp</code>. </p> Bash<pre><code>cd /tmp\nmkdir missing\n</code></pre> <p>2. Use <code>touch</code> to create a new file called <code>semester</code> in <code>missing</code>.</p> Bash<pre><code>cd missing\ntouch semster\n</code></pre> <p>5. Write the following into that file, one line at a time:</p> Bash<pre><code>#!/bin/sh\ncurl --head --silent https://missing.csail.mit.edu\n</code></pre> <p>The first line might be tricky to get working. It\u2019s helpful to know that <code>#</code> starts a comment in Bash, and <code>!</code> has a special meaning even within double-quoted (\") strings. Bash treats single-quoted strings (') differently: they will do the trick in this case. See the Bash Quoting (Bash Reference Manual) manual page for more information.</p> Bash<pre><code>echo '#!/bin/sh' &gt; semster\necho 'curl --head --silent https://missing.csail.mit.edu' &gt;&gt; semster\n</code></pre> <p>6. execute the file</p> <p>result:</p> Bash<pre><code>chuchengzhi@chenjinyangdeMacBook-Air missing % ./semster\nzsh: permission denied: ./semester\n</code></pre> <p>doesn't work...</p> <p>using <code>ls -l</code> to check the permissions:</p> Bash<pre><code>chuchengzhi@chenjinyangdeMacBook-Air missing % ls -l \ntotal 8\n-rw-r--r--  1 chuchengzhi  wheel  61 Dec  1 10:44 semster\n</code></pre> <p>7. Use <code>chmod</code> to make it possible to run the command <code>./semester</code></p> <p>First, quick dive to <code>chmod</code></p> <p><code>chmod</code> : change file modes or Access Control Lists</p> <p>Usage: <code>chmod [\u200b\u9009\u9879\u200b]... \u200b\u6a21\u5f0f\u200b[,\u200b\u6a21\u5f0f\u200b]... \u200b\u6587\u4ef6\u200b...</code></p> <p><code>mode</code> define the permissions of the file or directory, usually 3 number. Each number represents the permissions of user, group and other respectively.</p> <p>Each write, read, and execute permissions have the following number value:</p> <ul> <li>r (read) = 4</li> <li>w (write) = 2</li> <li>x (execute) = 1</li> <li>no permissions = 0</li> </ul> <p>To find out the file\u2019s permissions in numeric mode simply calculate the totals for all users classes. For example, to give read, write and execute permission to the file\u2019s owner, read and execute permissions to the file\u2019s group and only read permissions to all other users you would do the following:</p> <ul> <li>Owner: rwx=4+2+1=7</li> <li>Group: r-x=4+0+1=5</li> <li>Others: r-x=4+0+0=4</li> </ul> <p>Using the above knowledge, the solution:</p> Bash<pre><code>chmod 777 semester\n./semster\n</code></pre> <p>result</p> Bash<pre><code>HTTP/2 200 \nserver: GitHub.com\ncontent-type: text/html; charset=utf-8\nlast-modified: Thu, 24 Oct 2024 16:34:06 GMT\naccess-control-allow-origin: *\netag: \"671a76fe-205d\"\nexpires: Sat, 30 Nov 2024 08:50:54 GMT\ncache-control: max-age=600\nx-proxy-cache: MISS\nx-github-request-id: FFD8:1DA486:102D65D:10CDF1E:674ACF96\naccept-ranges: bytes\nage: 0\ndate: Sun, 01 Dec 2024 03:08:59 GMT\nvia: 1.1 varnish\nx-served-by: cache-itm1220038-ITM\nx-cache: HIT\nx-cache-hits: 0\nx-timer: S1733022540.782095,VS0,VE181\nvary: Accept-Encoding\nx-fastly-request-id: f004543c54e1f7139ecb9f84682d652aa24b9a04\ncontent-length: 8285\n</code></pre> <p>8. Use <code>|</code> and <code>&gt;</code> to write the <code>\u201clast modified\u201d</code> date output by <code>semester</code> into a file called <code>last-modified.txt</code> in your home directory.</p> Bash<pre><code>./semster | grep last-modified &gt; ~/last-modified.txt\n</code></pre> <p>result</p> Bash<pre><code>chuchengzhi@chenjinyangdeMacBook-Air missing % cat ~/last-modified.txt \nlast-modified: Thu, 24 Oct 2024 16:34:06 GMT\n</code></pre>","tags":["CS","Missing"]},{"location":"blog/2024/11/12/dijkstra%E7%AE%97%E6%B3%95/","title":"Dijkstra\u200b\u7b97\u6cd5","text":"<p> \u200b\u7ea6\u200b 94 \u200b\u4e2a\u200b\u5b57\u200b  64 \u200b\u884c\u200b\u4ee3\u7801\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> <p></p> <p>\u200b\u6280\u5de7\u200b\uff1a \u200b\u5982\u679c\u200b\u56fe\u4e3a\u200b\u65e0\u200b\u5411\u200b\u56fe\u200b\uff08\u200b\u6709\u5411\u56fe\u200b\u53cd\u8f6c\u200b\uff09\u200b\u4e14\u200b\u4e0d\u200b\u5b58\u5728\u200b\u8d1f\u8fb9\u200b\uff0c\u200b\u8981\u6c42\u200b\u6c42\u200b\u5404\u4e2a\u200b\u70b9\u200b i \u200b\u5230\u200b\u540c\u4e00\u200b\u7ec8\u70b9\u200b n \u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200bDijkstra\u200b\u7684\u200b\u8d77\u70b9\u200b\u548c\u200b\u7ec8\u70b9\u200b \u200b\u5747\u200b\u4e3a\u200b n\uff0c\u200b\u6c42\u89e3\u200b\u5f97\u5230\u200b\u7684\u200b distance \u200b\u6570\u7ec4\u200b\u5373\u200b \u200b\u5404\u4e2a\u200b\u70b9\u200b i \u200b\u5230\u200b\u7ec8\u70b9\u200b n \u200b\u7684\u200b\u6700\u200b\u77ed\u8ddd\u79bb\u200b\u3002</p> <p>\u200b\u4ee5\u200b743. \u200b\u7f51\u7edc\u200b\u5ef6\u8fdf\u65f6\u95f4\u200b\u4e3a\u4f8b\u200b</p> <p>Dijkstra\u200b\u7b97\u6cd5\u200b\u6a21\u7248\u200b</p> <p>Java \u200b\u9898\u89e3\u200b\uff1a</p> Java<pre><code>class Solution {\n    public int networkDelayTime(int[][] times, int n, int s) {\n        ArrayList&lt;ArrayList&lt;int[]&gt;&gt; graph = new ArrayList&lt;&gt;();\n        // \u200b\u8282\u70b9\u200b\u4e0b\u6807\u200b\u4e3a\u200b 1 - n\n        for (int i = 0; i &lt;= n; i++) {\n            graph.add(new ArrayList&lt;&gt;());\n        }\n        for (int[] edge : times) {\n            graph.get(edge[0]).add(new int[]{edge[1], edge[2]});\n        }\n        int[] distance = new int[n + 1];\n        Arrays.fill(distance, Integer.MAX_VALUE);\n        distance[s] = 0;\n        boolean[] visted = new boolean[n + 1];\n        PriorityQueue&lt;int[]&gt; heap = new PriorityQueue&lt;&gt;((a, b) -&gt; a[1] - b[1]);\n        heap.add(new int[]{s, 0});\n        while (!heap.isEmpty()) {\n            int u = heap.poll()[0];\n            if (visted[u]) {\n                continue;\n            }\n            visted[u] = true;\n            for (int[] edge : graph.get(u)) {\n                int v = edge[0];\n                int w = edge[1];\n                if (!visted[v] &amp;&amp; distance[u] + w &lt; distance[v]) {\n                    distance[v] = distance[u] + w;\n                    heap.add(new int[] {v, distance[u] + w});\n                }\n            }\n        }\n        int ans = Integer.MIN_VALUE;\n        for (int i = 1; i &lt;= n; i++) {\n            if (distance[i] == Integer.MAX_VALUE) {\n                return -1;\n            }\n            ans = Math.max(ans, distance[i]);\n        }\n        return ans;\n    }\n}\n</code></pre> <p>Python \u200b\u9898\u89e3\u200b\uff1a</p> Python<pre><code>class Solution:\n    def networkDelayTime(self, times: List[List[int]], n: int, s: int) -&gt; int:\n        graph = [[] for _ in range(n + 1)]\n        for u, v, w in times:\n            graph[u].append((v, w))\n\n        distance = [inf for _ in range(n + 1)]\n        distance[s] = 0\n        visited = [False for _ in range(n + 1)]\n\n        heap = [(0, s)]\n        while heap:\n            _, u = heappop(heap)\n            if visited[u]:\n                continue\n            visited[u] = True\n            for v, w in graph[u]:\n                if not visited[v] and distance[u] + w &lt; distance[v]:\n                    distance[v] = distance[u] + w\n                    heappush(heap, (distance[v], v))\n        ans = max(distance[1:])\n        return ans if ans &lt; inf else -1\n</code></pre>","tags":["Algorithm"]},{"location":"blog/2025/03/16/k-%E4%B8%AA%E4%B8%80%E7%BB%84%E7%BF%BB%E8%BD%AC%E9%93%BE%E8%A1%A8/","title":"K \u200b\u4e2a\u200b\u4e00\u7ec4\u200b\u7ffb\u8f6c\u200b\u94fe\u8868","text":"<p> \u200b\u7ea6\u200b 138 \u200b\u4e2a\u200b\u5b57\u200b  36 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> <p>\u200b\u9898\u76ee\u200b\u94fe\u63a5\u200b: 25. K \u200b\u4e2a\u200b\u4e00\u7ec4\u200b\u7ffb\u8f6c\u200b\u94fe\u8868\u200b</p> Python<pre><code># Definition for singly-linked list.\n# class ListNode:\n#     def __init__(self, val=0, next=None):\n#         self.val = val\n#         self.next = next\nclass Solution:\n    def reverseKGroup(self, head: Optional[ListNode], k: int) -&gt; Optional[ListNode]:\n        '''\n        pre \u200b\u662f\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u540e\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\n        p0 \u200b\u662f\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\n        nxt = p0.next \u200b\u662f\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u524d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b/\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u540e\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\n        cur \u200b\u662f\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u524d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\n        \u200b\u5728\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\n        nxt.next = cur \u200b\u8fd9\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\u5e94\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\n        p0.next = pre \u200b\u4e0a\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\u5e94\u200b\u6307\u5411\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b\n        p0 \u200b\u53d8\u4e3a\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u540e\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\n        '''\n        n = 0\n        cur = head\n        while cur:\n            cur = cur.next\n            n += 1\n        p0 = sentinel = ListNode(next=head)\n        pre, cur = None, head\n        while n &gt;= k:\n            n -= k\n            for _ in range(k):  \n                nxt = cur.next\n                cur.next = pre\n                pre = cur\n                cur = nxt\n            nxt = p0.next\n            nxt.next = cur\n            p0.next = pre\n            p0 = nxt\n        return sentinel.next\n</code></pre> <p>pre \u200b\u662f\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u540e\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b</p> <p>p0 \u200b\u662f\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b</p> <p>nxt = p0.next \u200b\u662f\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u524d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b/\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u540e\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b</p> <p>cur \u200b\u662f\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u524d\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b</p> <p>\u200b\u5728\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b</p> <p>nxt.next = cur \u200b\u8fd9\u200b\u4e00\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\u5e94\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b</p> <p>p0.next = pre \u200b\u4e0a\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b\u5e94\u200b\u6307\u5411\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u7684\u200b\u5934\u200b\u8282\u70b9\u200b</p> <p>p0 \u200b\u53d8\u4e3a\u200b\u8fd9\u6b21\u200b\u7ffb\u8f6c\u200b\u540e\u200b\u7684\u200b\u5c3e\u200b\u8282\u70b9\u200b</p>","tags":["Algorithm"]},{"location":"blog/2024/11/12/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%A8%A1%E7%89%88/","title":"\u6ed1\u52a8\u200b\u7a97\u53e3\u200b\u6a21\u7248","text":"<p> \u200b\u7ea6\u200b 21 \u200b\u4e2a\u200b\u5b57\u200b  36 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> <p>\u200b\u7edf\u4e00\u200b\u6a21\u7248\u200b Java<pre><code>//\u200b\u5916\u5c42\u200b\u5faa\u73af\u200b\u6269\u5c55\u200b\u53f3\u200b\u8fb9\u754c\u200b\uff0c\u200b\u5185\u5c42\u200b\u5faa\u73af\u200b\u6269\u5c55\u200b\u5de6\u200b\u8fb9\u754c\u200b\nfor (int l = 0, r = 0 ; r &lt; n ; r++) {\n        //\u200b\u5f53\u524d\u200b\u8003\u8651\u200b\u7684\u200b\u5143\u7d20\u200b\n        while (l &lt;= r &amp;&amp; check()) {//\u200b\u533a\u95f4\u200b[left,right]\u200b\u4e0d\u200b\u7b26\u5408\u200b\u9898\u610f\u200b\n        //\u200b\u6269\u5c55\u200b\u5de6\u200b\u8fb9\u754c\u200b\n    }\n    //\u200b\u533a\u95f4\u200b[left,right]\u200b\u7b26\u5408\u200b\u9898\u610f\u200b\uff0c\u200b\u7edf\u8ba1\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\n}\n</code></pre></p> <p> </p> <p>\u200b\u6a21\u7248\u200b\u9898\u200b\uff1a3. \u200b\u65e0\u200b\u91cd\u590d\u200b\u5b57\u7b26\u200b\u7684\u200b\u5b50\u4e32\u200b</p> <p>Java\u200b\u9898\u89e3\u200b Java<pre><code>class Solution {\n    public int lengthOfLongestSubstring(String s) {\n        char[] ss = s.toCharArray();\n        Set&lt;Character&gt; set = new HashSet&lt;&gt;();\n        int res = 0;\n        for (int left = 0, right = 0; right &lt; s.length(); right++) {\n            char ch = ss[right];\n            while (set.contains(ch)) {\n                set.remove(ss[left]);\n                left++;\n            }\n            set.add(ss[right]);\n            res = Math.max(res, right - left + 1);\n        }\n        return res;\n    }\n}\n</code></pre></p> <p>python\u200b\u9898\u89e3\u200b Python<pre><code>class Solution:\n    def lengthOfLongestSubstring(self, s: str) -&gt; int:\n        x = set()\n        res, left = 0, 0\n        for right in range(len(s)):\n            while s[right] in x:\n                x.remove(s[left])\n                left += 1\n            x.add(s[right])\n            res = max(res, right - left + 1)\n        return res\n</code></pre></p>","tags":["Algorithm"]},{"location":"blog/2025/03/17/%E6%89%8B%E6%92%95%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/","title":"\u624b\u200b\u6495\u200b\u5feb\u901f\u200b\u6392\u5e8f","text":"<p> \u200b\u7ea6\u200b 267 \u200b\u4e2a\u200b\u5b57\u200b  35 \u200b\u884c\u200b\u4ee3\u7801\u200b  2 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> <p>\u200b\u9898\u76ee\u200b\u8fde\u63a5\u200b\uff1a 912. \u200b\u6392\u5e8f\u200b\u6570\u7ec4\u200b</p>","tags":["Algorithm"]},{"location":"blog/2025/03/17/%E6%89%8B%E6%92%95%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/#_2","title":"\u4ee3\u7801\u200b (\u200b\u4e09\u8def\u200b\u5feb\u6392\u200b)","text":"Python<pre><code>class Solution:\n    def sortArray(self, nums: List[int]) -&gt; List[int]:\n        self.quick_sort(nums, 0, len(nums) - 1)\n        return nums\n\n    def quick_sort(self, nums: List[int], left: int, right: int) -&gt; None:\n        if left &gt;= right:\n            return\n        le, gt = self.partition(nums, left, right)\n        self.quick_sort(nums, left, le - 1)\n        self.quick_sort(nums, gt, right)\n\n    def partition(self, nums: List[int], left: int, right: int):\n        random_index = random.randint(left, right)\n        nums[random_index], nums[left] = nums[left], nums[random_index]\n        pivot = nums[left]\n\n        # \u200b\u5faa\u73af\u200b\u4e0d\u200b\u53d8\u91cf\u200b\uff1a\n        # [left, le - 1] &lt; pivot\n        # [le, i] = pivot\n        # [gt, right] &gt; pivot\n        le = left\n        gt = right + 1\n        i = left + 1\n        while i &lt; gt:\n            if nums[i] &lt; pivot:\n                nums[i], nums[le] = nums[le], nums[i]\n                le += 1\n                i += 1\n            elif nums[i] == pivot:\n                i += 1\n            else:\n                gt -= 1\n                nums[i], nums[gt] = nums[gt], nums[i]\n        return le, gt\n</code></pre>","tags":["Algorithm"]},{"location":"blog/2025/03/17/%E6%89%8B%E6%92%95%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/#_3","title":"\u4e09\u8def\u200b\u5feb\u6392","text":"<p>\u200b\u601d\u60f3\u200b\uff1a\u200b\u628a\u200b\u6574\u4e2a\u200b\u6570\u7ec4\u200b\u5206\u6210\u200b\u4e09\u4e2a\u200b\u90e8\u5206\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff0cle (less equal) \u200b\u548c\u200b gt (great than)</p> <p></p> <p>\u200b\u6b64\u65f6\u200b\u6709\u200b:</p> <ol> <li>nums[left, le - 1] \u200b\u5747\u200b\u5c0f\u4e8e\u200b V</li> <li>nums[gt, right] \u200b\u5747\u200b\u5927\u4e8e\u200b V</li> </ol> <p>\u200b\u521d\u59cb\u503c\u200b:</p> <ul> <li>le = left</li> <li>gt = right + 1</li> </ul> <p>\u200b\u904d\u5386\u200b\u6307\u9488\u200b i \u200b\u4ece\u200b left + 1 \u200b\u5f00\u59cb\u200b</p> <ol> <li>\u200b\u9047\u5230\u200b\u6bd4\u200b V \u200b\u5c0f\u200b\u7684\u200b\uff0c\u200b\u4ea4\u6362\u200b (le, i)\uff0cle\u3001i \u200b\u5747\u200b\u540e\u79fb\u200b\u4e00\u4f4d\u200b</li> <li>\u200b\u9047\u5230\u200b\u7b49\u4e8e\u200b V \u200b\u7684\u200b\uff0c\u200b\u4e0d\u7528\u200b\u4ea4\u6362\u200b\uff0ci \u200b\u540e\u79fb\u200b\u4e00\u4f4d\u200b</li> <li>\u200b\u9047\u5230\u200b\u6bd4\u200b V \u200b\u5927\u200b\u7684\u200b\uff0cgt \u200b\u524d\u79fb\u200b\u4e00\u4f4d\u200b\uff0c\u200b\u4ea4\u6362\u200b (gt, i)<ul> <li>\u200b\u6ce8\u610f\u200b\uff1a\u200b\u6b64\u65f6\u200b i \u200b\u4e0d\u80fd\u200b\u540e\u79fb\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4ea4\u6362\u200b\u8fc7\u6765\u200b\u7684\u200b nums[gt] \u200b\u4e4b\u524d\u200b\u672a\u200b\u770b\u8fc7\u200b</li> </ul> </li> </ol> <p>\u200b\u73b0\u5728\u200b\u8003\u8651\u200b\u9000\u51fa\u200b\u5faa\u574f\u200b\u7684\u200b\u6761\u4ef6\u200b\uff0ci \u200b\u78b0\u5230\u200b gt \u200b\u5373\u53ef\u200b</p> <p>\u200b\u4e0d\u8981\u200b\u53d6\u200b \"=\"\uff0c\u200b\u56e0\u4e3a\u200b i \u200b\u6ca1\u200b\u770b\u8fc7\u200b\uff0c\u200b\u8868\u793a\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8981\u200b\u770b\u200b\uff0cgt \u200b\u7684\u200b\u503c\u200b\u90fd\u200b\u770b\u8fc7\u200b\u4e86\u200b\uff0c\u200b\u6545\u200b while i &lt; gt</p> <p>\u200b\u5faa\u73af\u200b\u505c\u6b62\u200b\u65f6\u200b</p> <p></p> <p>\u200b\u6b64\u65f6\u200b\u6709\u200b:</p> <ol> <li>nums[left, le - 1] \u200b\u5747\u200b\u5c0f\u4e8e\u200b V</li> <li>nums[gt, right] \u200b\u5747\u200b\u5927\u4e8e\u200b V</li> <li>nums[le, gt - 1] \u200b\u5747\u200b\u7b49\u4e8e\u200b V</li> </ol> <p>\u200b\u8fd4\u56de\u200b le, gt, \u200b\u5e76\u200b\u56de\u5230\u200b quick_sort \u200b\u51fd\u6570\u200b</p> <ul> <li>\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b\u5de6\u200b\u533a\u95f4\u200b [left, le - 1]</li> <li>\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b\u53f3\u200b\u533a\u95f4\u200b [gt, right]</li> <li>\u200b\u76f4\u5230\u200b\u6392\u5e8f\u200b\u5b8c\u6210\u200b</li> </ul>","tags":["Algorithm"]},{"location":"blog/2025/03/23/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/","title":"\u6700\u957f\u200b\u56de\u6587\u200b\u5b50\u4e32","text":"<p> \u200b\u7ea6\u200b 623 \u200b\u4e2a\u200b\u5b57\u200b  38 \u200b\u884c\u200b\u4ee3\u7801\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 3 \u200b\u5206\u949f\u200b</p> <p>\u200b\u9898\u76ee\u200b\u94fe\u63a5\u200b\uff1a 5. \u200b\u6700\u957f\u200b\u56de\u6587\u200b\u5b50\u4e32\u200b </p> <p>\u200b\u9898\u89e3\u200b\u94fe\u63a5\u200b\uff1a5. \u200b\u6700\u957f\u200b\u56de\u6587\u200b\u5b50\u4e32\u200b - \u200b\u529b\u6263\u200b\uff08LeetCode\uff09</p>","tags":["Algorithm"]},{"location":"blog/2025/03/23/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/#_2","title":"\u4e2d\u5fc3\u200b\u6269\u6563\u200b\u6cd5","text":"<p>\u200b\u4ece\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u4f4d\u7f6e\u200b\u51fa\u53d1\u200b\uff0c\u200b\u5411\u200b\u4e24\u8fb9\u200b\u6269\u6563\u200b\u5373\u53ef\u200b\u3002\u200b\u9047\u5230\u200b\u4e0d\u662f\u200b\u56de\u6587\u200b\u7684\u200b\u65f6\u5019\u200b\u7ed3\u675f\u200b\u3002\u200b\u4e3e\u4e2a\u200b\u4f8b\u5b50\u200b\uff0cstr=acdbbdaa \u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5bfb\u627e\u200b\u4ece\u200b\u7b2c\u4e00\u4e2a\u200b b\uff08\u200b\u4f4d\u7f6e\u200b\u4e3a\u200b 3\uff09\u200b\u51fa\u53d1\u200b\u6700\u957f\u200b\u56de\u6587\u200b\u4e32\u4e3a\u200b\u591a\u5c11\u200b\u3002\u200b\u600e\u4e48\u200b\u5bfb\u627e\u200b\uff1f  </p> <ol> <li>\u200b\u9996\u5148\u200b\u5f80\u200b\u5de6\u200b\u5bfb\u627e\u200b\u4e0e\u200b\u5f53\u671f\u200b\u4f4d\u7f6e\u200b\u76f8\u540c\u200b\u7684\u200b\u5b57\u7b26\u200b\uff0c\u200b\u76f4\u5230\u200b\u9047\u5230\u200b\u4e0d\u200b\u76f8\u7b49\u200b\u4e3a\u6b62\u200b\u3002  </li> <li>\u200b\u7136\u540e\u200b\u5f80\u53f3\u200b\u5bfb\u627e\u200b\u4e0e\u200b\u5f53\u671f\u200b\u4f4d\u7f6e\u200b\u76f8\u540c\u200b\u7684\u200b\u5b57\u7b26\u200b\uff0c\u200b\u76f4\u5230\u200b\u9047\u5230\u200b\u4e0d\u200b\u76f8\u7b49\u200b\u4e3a\u6b62\u200b\u3002  </li> <li>\u200b\u6700\u540e\u200b\u5de6\u53f3\u200b\u53cc\u5411\u200b\u6269\u6563\u200b\uff0c\u200b\u76f4\u5230\u200b\u5de6\u548c\u53f3\u200b\u4e0d\u200b\u76f8\u7b49\u200b\u3002\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff1a</li> </ol> <p></p> <p>\u200b\u6bcf\u4e2a\u200b\u4f4d\u7f6e\u200b\u5411\u200b\u4e24\u8fb9\u200b\u6269\u6563\u200b\u90fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\uff08cur_len\uff09\u3002\u200b\u5982\u679c\u200b cur_len &gt; length(\u200b\u7528\u6765\u200b\u8868\u793a\u200b\u6700\u957f\u200b\u56de\u6587\u200b\u4e32\u200b\u7684\u200b\u957f\u5ea6\u200b\uff09\u3002\u200b\u5219\u200b\u66f4\u65b0\u200b length \u200b\u7684\u200b\u503c\u200b\u3002  </p> <p>\u200b\u56e0\u4e3a\u200b\u6211\u4eec\u200b\u6700\u540e\u200b\u8981\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b\u5177\u4f53\u200b\u5b50\u4e32\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u957f\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u4e00\u4e0b\u200b length \u200b\u65f6\u200b\u7684\u200b\u8d77\u59cb\u200b\u4f4d\u7f6e\u200b\uff08start\uff09\uff0c\u200b\u5373\u200b\u6b64\u65f6\u200b\u8fd8\u8981\u200b start = left\u3002  </p> Python<pre><code>class Solution:\n    def longestPalindrome(self, s: str) -&gt; str:\n        if s is None or len(s) == 0:\n            return ''\n        n = len(s)\n        start = length = 0\n        for i in range(n):\n            left, right, cur_len = i - 1, i + 1, 1\n            while left &gt;= 0 and s[left] == s[i]:\n                left -= 1\n                cur_len += 1\n            while right &lt; n and s[right] == s[i]:\n                right += 1\n                cur_len += 1\n            while left &gt;= 0 and right &lt; n and s[left] == s[right]:\n                left -= 1\n                right += 1\n                cur_len += 2\n            if cur_len &gt; length:\n                length = cur_len\n                start = left + 1\n        return s[start:start+length]\n</code></pre>","tags":["Algorithm"]},{"location":"blog/2025/03/23/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/#_3","title":"\u52a8\u6001\u200b\u89c4\u5212","text":"<p>\u200b\u4e2d\u5fc3\u200b\u6269\u6563\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5176\u5b9e\u200b\u505a\u200b\u4e86\u200b\u5f88\u591a\u200b\u91cd\u590d\u200b\u8ba1\u7b97\u200b\u3002\u200b\u52a8\u6001\u200b\u89c4\u5212\u200b\u5c31\u662f\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u91cd\u590d\u200b\u8ba1\u7b97\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u52a8\u6001\u200b\u89c4\u5212\u200b\u542c\u200b\u8d77\u6765\u200b\u5f88\u200b\u9ad8\u5927\u200b\u4e0a\u200b\u3002\u200b\u5176\u5b9e\u200b\u8bf4\u767d\u4e86\u200b\u5c31\u662f\u200b\u7a7a\u95f4\u200b\u6362\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5c06\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u6682\u5b58\u200b\u8d77\u6765\u200b\uff0c\u200b\u907f\u514d\u200b\u91cd\u590d\u200b\u8ba1\u7b97\u200b\u3002\u200b\u4f5c\u7528\u200b\u548c\u200b\u5de5\u7a0b\u200b\u4e2d\u200b\u7528\u200b redis \u200b\u505a\u200b\u7f13\u5b58\u200b\u6709\u200b\u5f02\u66f2\u540c\u5de5\u200b\u4e4b\u5999\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u7528\u200b\u4e00\u4e2a\u200b boolean dp[l][r] \u200b\u8868\u793a\u200b\u5b57\u7b26\u4e32\u200b\u4ece\u200b i \u200b\u5230\u200b j \u200b\u8fd9\u200b\u6bb5\u200b\u662f\u5426\u200b\u4e3a\u200b\u56de\u6587\u200b\u3002</p> <p>\u200b\u8bd5\u60f3\u200b\u5982\u679c\u200b dp[l][r]=true\uff0c\u200b\u6211\u4eec\u200b\u8981\u200b\u5224\u65ad\u200b dp[l-1][r+1] \u200b\u662f\u5426\u200b\u4e3a\u200b\u56de\u6587\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u5b57\u7b26\u4e32\u200b\u5728\u200b (l-1) \u200b\u548c\u200b\uff08r+1) \u200b\u4e24\u4e2a\u200b\u4f4d\u7f6e\u200b\u662f\u5426\u200b\u4e3a\u200b\u76f8\u540c\u200b\u7684\u200b\u5b57\u7b26\u200b\u3002</p> <p>\u200b\u8fdb\u5165\u200b\u6b63\u9898\u200b\uff0c\u200b\u52a8\u6001\u200b\u89c4\u5212\u200b\u5173\u952e\u200b\u662f\u200b\u627e\u5230\u200b\u521d\u59cb\u72b6\u6001\u200b\u548c\u200b\u72b6\u6001\u200b\u8f6c\u79fb\u200b\u65b9\u7a0b\u200b\u3002</p> <p>\u200b\u521d\u59cb\u72b6\u6001\u200b\uff0cl=r \u200b\u65f6\u200b\uff0c\u200b\u6b64\u65f6\u200b dp[l][r]=true\u3002</p> <p>\u200b\u72b6\u6001\u200b\u8f6c\u79fb\u200b\u65b9\u7a0b\u200b\uff0cdp[l][r]=true \u200b\u5e76\u4e14\u200b (l-1) \u200b\u548c\u200b\uff08r+1) \u200b\u4e24\u4e2a\u200b\u4f4d\u7f6e\u200b\u4e3a\u200b\u76f8\u540c\u200b\u7684\u200b\u5b57\u7b26\u200b\uff0c\u200b\u6b64\u65f6\u200b dp[l-1][r+1]=true\u3002</p> Python<pre><code>class Solution:\n    def longestPalindrome(self, s: str) -&gt; str:\n        if s is None or len(s) == 0:\n            return ''\n        n = len(s)\n        start = end = 0\n        length = 1\n        dp = [[False] * n for _ in range(n)]\n        for r in range(n):\n            for l in range(r):\n                if s[l] == s[r] and (r - l &lt;= 2 or dp[l + 1][r - 1]):\n                    dp[l][r] = True\n                    if r - l + 1 &gt; length:\n                        length = r - l + 1\n                        start, end = l, r\n        return s[start:end+1]\n</code></pre> <p><code>if s[l] == s[r] and (r - l &lt;= 2 or dp[l + 1][r - 1]):</code> \u200b\u8fd9\u4e2a\u200b\u5224\u65ad\u200b\u6761\u4ef6\u200b\u7684\u200b\u542b\u4e49\u200b\u662f\u200b</p> <p>1. <code>s.charAt(l) == s.charAt(r)</code></p> <p>\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u8868\u793a\u200b\uff1a\u200b\u5f53\u524d\u200b\u5b57\u7b26\u4e32\u200b\u5de6\u53f3\u4e24\u7aef\u200b\u7684\u200b\u5b57\u7b26\u200b\u662f\u5426\u200b\u76f8\u7b49\u200b\u3002</p> <ul> <li> <p>\u200b\u5982\u679c\u200b s[l] \u200b\u548c\u200b s[r] \u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4ece\u200b l \u200b\u5230\u200b r \u200b\u4e4b\u95f4\u200b\u7684\u200b\u5b50\u4e32\u200b\u663e\u7136\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u662f\u200b\u56de\u6587\u200b\u4e32\u200b\uff0c\u200b\u56e0\u6b64\u200b\u76f4\u63a5\u200b\u8df3\u8fc7\u200b\u540e\u7eed\u200b\u5224\u65ad\u200b\u3002</p> </li> <li> <p>\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u8fdb\u4e00\u6b65\u200b\u5224\u65ad\u200b\u8be5\u200b\u5b50\u4e32\u200b\u4e2d\u95f4\u200b\u90e8\u5206\u200b\u662f\u5426\u662f\u200b\u56de\u6587\u200b\uff0c\u200b\u4ece\u800c\u200b\u786e\u5b9a\u200b\u6574\u4e2a\u200b\u5b50\u4e32\u200b\u662f\u5426\u662f\u200b\u56de\u6587\u200b\u4e32\u200b\u3002</p> </li> </ul> <p>2. <code>(r - l &lt;= 2 || dp[l + 1][r - 1])</code></p> <p>\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u8868\u793a\u200b\uff1a\u200b\u5728\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4ece\u200b\u4f4d\u7f6e\u200b l \u200b\u5230\u200b r \u200b\u7684\u200b\u5b50\u4e32\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u786e\u8ba4\u200b\u662f\u200b\u56de\u6587\u200b\u4e32\u200b\u3002</p> <p>\uff081\uff09 <code>r - l &lt;= 2</code></p> <p>\u200b\u5982\u679c\u200b r - l &lt;= 2\uff0c\u200b\u8bf4\u660e\u200b l \u200b\u548c\u200b r \u200b\u4e4b\u95f4\u200b\u6700\u200b\u591a\u200b\u53ea\u6709\u200b 0 \u200b\u4e2a\u200b\u6216\u200b 1 \u200b\u4e2a\u5b57\u7b26\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff1a</p> <ul> <li> <p>s[l] == s[r] \u200b\u5c31\u200b\u8db3\u4ee5\u200b\u5224\u65ad\u200b\u8be5\u200b\u5b50\u4e32\u200b\u662f\u200b\u56de\u6587\u200b\u4e32\u200b\u4e86\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e2d\u95f4\u200b\u7684\u200b\u90e8\u5206\u200b\u8981\u4e48\u200b\u4e3a\u7a7a\u200b\uff08r - l = 1\uff09\uff0c\u200b\u8981\u4e48\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u5b57\u7b26\u200b\uff08r - l = 2\uff09\u3002</p> </li> <li> <p>\u200b\u793a\u4f8b\u200b\uff1a\u200b\u5bf9\u4e8e\u200b aba\u3001aa\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4e24\u7aef\u200b\u76f8\u7b49\u200b\u5373\u53ef\u200b\u786e\u8ba4\u200b\u5b83\u4eec\u200b\u662f\u200b\u56de\u6587\u200b\u3002</p> </li> </ul> <p>\uff082\uff09 <code>dp[l + 1][r - 1]</code></p> <p>\u200b\u5982\u679c\u200b r - l &gt; 2\uff0c\u200b\u8bf4\u660e\u200b l \u200b\u548c\u200b r \u200b\u4e4b\u95f4\u200b\u81f3\u5c11\u200b\u9694\u200b\u7740\u200b\u4e24\u4e2a\u200b\u5b57\u7b26\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b50\u4e32\u200b [l+1, r-1] \u200b\u662f\u5426\u662f\u200b\u56de\u6587\u200b\u5c31\u200b\u53d8\u5f97\u200b\u91cd\u8981\u200b\u3002</p> <ul> <li> <p>dp[l + 1][r - 1] \u200b\u662f\u200b\u4e00\u4e2a\u200b\u52a8\u6001\u200b\u89c4\u5212\u200b\u6570\u7ec4\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u4ece\u200b\u4f4d\u7f6e\u200b l+1 \u200b\u5230\u200b r-1 \u200b\u7684\u200b\u5b50\u4e32\u200b\u662f\u5426\u662f\u200b\u56de\u6587\u200b\u3002</p> </li> <li> <p>\u200b\u5982\u679c\u200b dp[l + 1][r - 1] == true\uff0c\u200b\u8bf4\u660e\u200b\u8be5\u200b\u5b50\u4e32\u200b\u662f\u200b\u56de\u6587\u200b\u4e32\u200b\uff0c\u200b\u518d\u200b\u52a0\u4e0a\u200b s[l] == s[r]\uff0c\u200b\u53ef\u4ee5\u200b\u786e\u8ba4\u200b [l, r] \u200b\u4e5f\u200b\u662f\u200b\u56de\u6587\u200b\u4e32\u200b\u3002</p> </li> <li> <p>\u200b\u5982\u679c\u200b dp[l + 1][r - 1] == false\uff0c\u200b\u90a3\u4e48\u200b\u4e2d\u95f4\u200b\u90e8\u5206\u200b\u4e0d\u662f\u200b\u56de\u6587\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4e24\u7aef\u200b\u5b57\u7b26\u200b\u76f8\u7b49\u200b\uff0c\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u5f62\u6210\u200b\u56de\u6587\u200b\u4e32\u200b\u3002</p> </li> </ul>","tags":["Algorithm"]},{"location":"blog/2024/11/12/minio-%E9%83%A8%E7%BD%B2/","title":"Minio \u200b\u90e8\u7f72","text":"<p> \u200b\u7ea6\u200b 113 \u200b\u4e2a\u200b\u5b57\u200b  27 \u200b\u884c\u200b\u4ee3\u7801\u200b  5 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["docker"]},{"location":"blog/2024/11/12/minio-%E9%83%A8%E7%BD%B2/#_1","title":"\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55","text":"Bash<pre><code>#\u200b\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55\u200b\nmkdir -p /data/minio\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/minio-%E9%83%A8%E7%BD%B2/#yml","title":"\u521b\u5efa\u200byml\u200b\u6587\u4ef6","text":"Bash<pre><code>vim /data/minio/docker-compose.yml\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/minio-%E9%83%A8%E7%BD%B2/#_2","title":"\u586b\u5165\u200b\u914d\u7f6e","text":"Bash<pre><code>version: '3.9'\nservices:\n  minio:\n    image: \"quay.io/minio/minio:RELEASE.2022-08-02T23-59-16Z\"\n    container_name: minio\n    ports:\n      - \"9000:9000\" # api \u200b\u7aef\u53e3\u200b\n      - \"9001:9001\" # \u200b\u63a7\u5236\u53f0\u200b\u7aef\u53e3\u200b\n    environment:\n      TZ: Asia/Shanghai # \u200b\u65f6\u200b\u533a\u200b\u4e0a\u6d77\u200b\n      MINIO_ROOT_USER: admin # \u200b\u7ba1\u7406\u200b\u540e\u53f0\u200b\u7528\u6237\u540d\u200b\n      MINIO_ROOT_PASSWORD: 12345678 # \u200b\u7ba1\u7406\u200b\u540e\u53f0\u200b\u5bc6\u7801\u200b\uff0c\u200b\u6700\u5c0f\u200b8\u200b\u4e2a\u5b57\u7b26\u200b\n      MINIO_COMPRESS: \"off\" # \u200b\u5f00\u542f\u200b\u538b\u7f29\u200b on \u200b\u5f00\u542f\u200b off \u200b\u5173\u95ed\u200b\n      MINIO_COMPRESS_EXTENSIONS: \"\" # \u200b\u6269\u5c55\u540d\u200b .pdf,.doc \u200b\u4e3a\u7a7a\u200b \u200b\u6240\u6709\u200b\u7c7b\u578b\u200b\u5747\u200b\u538b\u7f29\u200b\n      MINIO_COMPRESS_MIME_TYPES: \"\" # mime \u200b\u7c7b\u578b\u200b application/pdf \u200b\u4e3a\u7a7a\u200b \u200b\u6240\u6709\u200b\u7c7b\u578b\u200b\u5747\u200b\u538b\u7f29\u200b\n    volumes:\n      - /data/minio/data:/data/ # \u200b\u6620\u5c04\u200b\u5f53\u524d\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200bdata\u200b\u76ee\u5f55\u200b\u81f3\u200b\u5bb9\u5668\u200b\u5185\u200b/data\u200b\u76ee\u5f55\u200b      \n      - /data/minio/config:/root/.minio/ # \u200b\u6620\u5c04\u200b\u914d\u7f6e\u200b\u76ee\u5f55\u200b\n    command: server --address ':9000' --console-address ':9001' /data  # \u200b\u6307\u5b9a\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u7684\u200b\u76ee\u5f55\u200b /data\n    privileged: true\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/minio-%E9%83%A8%E7%BD%B2/#_3","title":"\u542f\u52a8\u200b\u5bb9\u5668","text":"Bash<pre><code>cd /data/minio\ndocker-compose up -d\n#\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5f3a\u5236\u200b\u91cd\u65b0\u200b\u6784\u5efa\u200b\ndocker-compose up --force-recreate -d\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/minio-%E9%83%A8%E7%BD%B2/#90009001","title":"\uff01\uff01\u200b\u5b89\u5168\u200b\u7ec4\u200b\u6dfb\u52a0\u200b\u7aef\u53e3\u200b 9000\uff0c9001 \uff01\uff01","text":"","tags":["docker"]},{"location":"blog/2024/11/12/minio-%E9%83%A8%E7%BD%B2/#_4","title":"\u914d\u7f6e\u200b\u6876","text":"<p>\u200b\u521b\u5efa\u200b\u6876\u200b  \u200b\u8bbe\u7f6e\u200b\u6876\u200b\u4e3a\u200b\u516c\u5f00\u200b </p> <p></p> <p>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u6743\u9650\u200b\u7528\u6237\u200b\uff0c\u200b\u83b7\u53d6\u200b\u5bc6\u94a5\u200b</p> <p></p> <p></p> <p>\u200b\u70b9\u51fb\u200bcreate\u200b\u6309\u94ae\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u968f\u673a\u200b\u751f\u6210\u200baccessKey secretKey\u3002 \u200b\u4f1a\u200b\u5c06\u200b\u8fd9\u200b\u4e24\u4e2a\u200bkey\u200b\u8fdb\u884c\u200b\u5c55\u793a\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u590d\u5236\u7c98\u8d34\u200b\u5230\u200b\u4e00\u4e2a\u200b\u6587\u672c\u6587\u4ef6\u200b\u4e0a\u200b\uff0c\u200b\u540e\u7eed\u200b\u4f7f\u7528\u200b\u4ee3\u7801\u200b\u4e0a\u4f20\u200b\u6587\u4ef6\u200b\u65f6\u200b\u9700\u8981\u200b\u7528\u5230\u200b\u8fd9\u200b\u4e24\u4e2a\u200bkey</p>","tags":["docker"]},{"location":"blog/2024/11/12/mysql-%E9%83%A8%E7%BD%B2/","title":"Mysql \u200b\u90e8\u7f72","text":"<p> \u200b\u7ea6\u200b 34 \u200b\u4e2a\u200b\u5b57\u200b  59 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["docker"]},{"location":"blog/2024/11/12/mysql-%E9%83%A8%E7%BD%B2/#_1","title":"\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55","text":"Bash<pre><code>#\u200b\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55\u200b\nmkdir -p /docker/data/mysql/data\nmkdir -p /docker/data/mysql/conf\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/mysql-%E9%83%A8%E7%BD%B2/#yml","title":"\u521b\u5efa\u200byml\u200b\u6587\u4ef6","text":"Bash<pre><code>vim /docker/data/mysql/docker-compose.yml\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/mysql-%E9%83%A8%E7%BD%B2/#_2","title":"\u586b\u5165\u200b\u914d\u7f6e","text":"Bash<pre><code>version: '3.8' # \u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7248\u672c\u200b\nservices:\n  mysql:\n    image: mysql:8.0.30 #mysql\u200b\u7248\u672c\u200b\n    container_name: mysql\n    volumes:\n      - /docker/data/mysql/data:/var/lib/mysql\n      - /docker/data/mysql/conf/my.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf\n    restart: always\n    ports:\n      - 3306:3306\n    environment:\n      MYSQL_ROOT_PASSWORD: 123456 #root\u200b\u7528\u6237\u200b\u5bc6\u7801\u200b\n      TZ: Asia/Shanghai\n    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/mysql-%E9%83%A8%E7%BD%B2/#_3","title":"\u521b\u5efa\u200b\u914d\u7f6e\u6587\u4ef6","text":"Bash<pre><code>vim /docker/data/mysql/conf/my.cnf\n</code></pre> Bash<pre><code>[mysqld]\ndefault-storage-engine=INNODB  # \u200b\u521b\u5efa\u200b\u65b0\u8868\u65f6\u200b\u5c06\u200b\u4f7f\u7528\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u5b58\u50a8\u200b\u5f15\u64ce\u200b\ncharacter-set-server=utf8mb4      # \u200b\u8bbe\u7f6e\u200bmysql\u200b\u670d\u52a1\u7aef\u200b\u9ed8\u8ba4\u200b\u5b57\u7b26\u96c6\u200b\npid-file        = /var/run/mysqld/mysqld.pid  # pid\u200b\u6587\u4ef6\u200b\u6240\u5728\u200b\u76ee\u5f55\u200b\nsocket          = /var/run/mysqld/mysqld.sock # \u200b\u7528\u4e8e\u200b\u672c\u5730\u8fde\u63a5\u200b\u7684\u200bsocket\u200b\u5957\u200b\u63a5\u5b57\u200b\ndatadir         = /var/lib/mysql              # \u200b\u6570\u636e\u6587\u4ef6\u200b\u5b58\u653e\u200b\u7684\u200b\u76ee\u5f55\u200b\nsymbolic-links=0\nsql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION # \u200b\u5b9a\u4e49\u200bmysql\u200b\u5e94\u8be5\u200b\u652f\u6301\u200b\u7684\u200bsql\u200b\u8bed\u6cd5\u200b\uff0c\u200b\u6570\u636e\u200b\u6821\u9a8c\u200b\u7b49\u200b!\n\n# \u200b\u5141\u8bb8\u200b\u6700\u5927\u200b\u8fde\u63a5\u6570\u200b\nmax_connections=200\n\n\n# \u200b\u540c\u4e00\u200b\u5c40\u57df\u7f51\u200b\u5185\u200b\u6ce8\u610f\u200b\u8981\u200b\u552f\u4e00\u200b\nserver-id=3306\n# \u200b\u5f00\u542f\u200b\u4e8c\u8fdb\u5236\u200b\u65e5\u5fd7\u200b\u529f\u80fd\u200b &amp; \u200b\u65e5\u5fd7\u200b\u4f4d\u7f6e\u200b\u5b58\u653e\u200b\u4f4d\u7f6e\u200b`/var/lib/mysql`\n#log-bin=mysql-bin\nlog-bin=/var/lib/mysql/mysql-bin\n# binlog\u200b\u683c\u5f0f\u200b\n# 1. STATEMENT\uff1a\u200b\u57fa\u4e8e\u200bSQL\u200b\u8bed\u53e5\u200b\u7684\u200b\u6a21\u5f0f\u200b\uff0cbinlog \u200b\u6570\u636e\u91cf\u200b\u5c0f\u200b\uff0c\u200b\u4f46\u662f\u200b\u67d0\u4e9b\u200b\u8bed\u53e5\u200b\u548c\u200b\u51fd\u6570\u200b\u5728\u200b\u590d\u5236\u200b\u8fc7\u7a0b\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u751a\u81f3\u200b\u51fa\u9519\u200b\uff1b\n# 2. MIXED\uff1a\u200b\u6df7\u5408\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u6839\u636e\u200b\u8bed\u53e5\u200b\u6765\u200b\u9009\u7528\u200b\u662f\u200b STATEMENT \u200b\u8fd8\u662f\u200b ROW \u200b\u6a21\u5f0f\u200b\uff1b\n# 3. ROW\uff1a\u200b\u57fa\u4e8e\u200b\u884c\u200b\u7684\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u7684\u200b\u662f\u200b\u884c\u200b\u7684\u200b\u5b8c\u6574\u200b\u53d8\u5316\u200b\u3002\u200b\u5b89\u5168\u200b\uff0c\u200b\u4f46\u200b binlog \u200b\u4f1a\u200b\u6bd4\u200b\u5176\u4ed6\u200b\u4e24\u79cd\u200b\u6a21\u5f0f\u200b\u5927\u200b\u5f88\u591a\u200b\uff1b\nbinlog_format=ROW\n# FULL\uff1abinlog\u200b\u8bb0\u5f55\u200b\u6bcf\u200b\u4e00\u884c\u200b\u7684\u200b\u5b8c\u6574\u200b\u53d8\u66f4\u200b MINIMAL\uff1a\u200b\u53ea\u200b\u8bb0\u5f55\u200b\u5f71\u54cd\u200b\u540e\u200b\u7684\u200b\u884c\u200b\nbinlog_row_image=FULL\n# \u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u5927\u5c0f\u200b\nmax_binlog_size=100M\n# \u200b\u5b9a\u4e49\u200b\u6e05\u9664\u200b\u8fc7\u671f\u200b\u65e5\u5fd7\u200b\u7684\u200b\u65f6\u95f4\u200b(\u200b\u8fd9\u91cc\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b7\u200b\u5929\u200b)\nexpire_logs_days=7\n\n# ================= \u2191\u2191\u2191 mysql\u200b\u4e3b\u4ece\u200b\u540c\u6b65\u200b\u914d\u7f6e\u200bend \u2191\u2191\u2191 =================\n\n[mysql]\ndefault-character-set=utf8mb4\n\n[client]\ndefault-character-set=utf8mb4  # \u200b\u8bbe\u7f6e\u200bmysql\u200b\u5ba2\u6237\u7aef\u200b\u9ed8\u8ba4\u200b\u5b57\u7b26\u96c6\u200b\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/mysql-%E9%83%A8%E7%BD%B2/#_4","title":"\u542f\u52a8\u200b\u5bb9\u5668","text":"Bash<pre><code>cd /docker/data/mysql\ndocker-compose up -d\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/mysql-%E9%83%A8%E7%BD%B2/#3306","title":"!!! \u200b\u5b89\u5168\u200b\u7ec4\u200b\u6dfb\u52a0\u200b 3306 !!!","text":"","tags":["docker"]},{"location":"blog/2024/11/12/postgresql-%E9%83%A8%E7%BD%B2/","title":"PostgreSQL \u200b\u90e8\u7f72","text":"<p> \u200b\u7ea6\u200b 28 \u200b\u4e2a\u200b\u5b57\u200b  26 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["docker"]},{"location":"blog/2024/11/12/postgresql-%E9%83%A8%E7%BD%B2/#_1","title":"\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55","text":"Bash<pre><code>mkdir -p /data/postgresql/data\nmkdir -p /data/postgresql/log\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/postgresql-%E9%83%A8%E7%BD%B2/#yml","title":"\u521b\u5efa\u200byml\u200b\u6587\u4ef6","text":"Bash<pre><code>vim /data/postgresql/docker-compose.yml\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/postgresql-%E9%83%A8%E7%BD%B2/#_2","title":"\u586b\u5165\u200b\u914d\u7f6e","text":"Bash<pre><code>services:\n  postgres_db: # \u200b\u670d\u52a1\u200b\u540d\u79f0\u200b\n    image: postgres:15.7 # \u200b\u6307\u5b9a\u200b\u955c\u50cf\u200b\u53ca\u5176\u200b\u7248\u672c\u200b\n    container_name: docker_postgres # \u200b\u6307\u5b9a\u200b\u5bb9\u5668\u200b\u7684\u200b\u540d\u79f0\u200b\n    environment:\n      POSTGRES_PASSWORD: 123456\n    ports: # \u200b\u7aef\u53e3\u6620\u5c04\u200b\n      - \"5432:5432\"\n    volumes: # \u200b\u6570\u636e\u200b\u6301\u4e45\u200b\u5316\u200b\u7684\u200b\u914d\u7f6e\u200b\n      - /data/postgresql/data:/var/lib/postgresql/data\n      - /data/postgresql/log:/var/log/postgresql\n    logging:\n      options:\n        max-size: \"10m\"\n        max-file: \"3\"\n    networks:  # \u200b\u7f51\u7edc\u200b\u914d\u7f6e\u200b\n      - pub-network  # \u200b\u52a0\u5165\u200b\u5230\u200b pub-network \u200b\u7f51\u7edc\u200b\n\nnetworks:  # \u200b\u7f51\u7edc\u200b\n  pub-network:\n      driver: bridge\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/postgresql-%E9%83%A8%E7%BD%B2/#_3","title":"\u542f\u52a8\u200b\u5bb9\u5668","text":"Bash<pre><code>cd /data/postgresql\ndocker-compose up -d\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/postgresql-%E9%83%A8%E7%BD%B2/#5432","title":"!!! \u200b\u5b89\u5168\u200b\u7ec4\u200b\u6dfb\u52a0\u200b 5432 !!!","text":"","tags":["docker"]},{"location":"blog/2024/11/12/redis-%E9%83%A8%E7%BD%B2/","title":"Redis \u200b\u90e8\u7f72","text":"<p> \u200b\u7ea6\u200b 36 \u200b\u4e2a\u200b\u5b57\u200b  35 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["docker"]},{"location":"blog/2024/11/12/redis-%E9%83%A8%E7%BD%B2/#_1","title":"\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55","text":"Bash<pre><code>#\u200b\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55\u200b\nmkdir -p /docker/data/redis\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/redis-%E9%83%A8%E7%BD%B2/#yml","title":"\u521b\u5efa\u200byml\u200b\u6587\u4ef6","text":"Bash<pre><code>vim /docker/data/redis/docker-compose.yml\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/redis-%E9%83%A8%E7%BD%B2/#_2","title":"\u586b\u5165\u200b\u914d\u7f6e","text":"Bash<pre><code>version: '3.8'\nservices:\n  redis:\n    image: redis:7.0.11\n    container_name: redis\n    restart: always\n    ports:\n      - 6379:6379\n    volumes:\n      - /docker/data/redis/redis.conf:/etc/redis/redis.conf\n      - /docker/data/redis/data:/data\n      - /docker/data/redis/logs:/logs\n    command: [\"redis-server\",\"/etc/redis/redis.conf\"]\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/redis-%E9%83%A8%E7%BD%B2/#_3","title":"\u521b\u5efa\u200b\u6302\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6","text":"Bash<pre><code>vim /docker/data/redis/redis.conf\n</code></pre> Bash<pre><code>protected-mode no\nport 6379\ntimeout 0\n#rdb\u200b\u914d\u7f6e\u200b\nsave 900 1\nsave 300 10\nsave 60 10000\nrdbcompression yes\ndbfilename dump.rdb\ndir /data\nappendonly yes\nappendfsync everysec\n#\u200b\u8bbe\u7f6e\u200b\u4f60\u200b\u7684\u200bredis\u200b\u5bc6\u7801\u200b\nrequirepass 123456\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/redis-%E9%83%A8%E7%BD%B2/#_4","title":"\u542f\u52a8\u200b\u5bb9\u5668","text":"Bash<pre><code>cd /docker/data/redis\ndocker-compose up -d\n#\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5f3a\u5236\u200b\u91cd\u65b0\u200b\u6784\u5efa\u200b\ndocker-compose up --force-recreate -d\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/redis-%E9%83%A8%E7%BD%B2/#6379","title":"!!! \u200b\u5b89\u5168\u200b\u7ec4\u200b\u6dfb\u52a0\u200b 6379 !!!","text":"","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/","title":"RocketMQ \u200b\u90e8\u7f72","text":"<p> \u200b\u7ea6\u200b 236 \u200b\u4e2a\u200b\u5b57\u200b  225 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 4 \u200b\u5206\u949f\u200b</p>","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/#_1","title":"\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55","text":"Bash<pre><code>#\u200b\u521b\u5efa\u200b\u6302\u8f7d\u200b\u76ee\u5f55\u200b\nmkdir -p /data/rocketmq/namesrv;\nmkdir -p /data/rocketmq/broker/conf;\nmkdir -p /data/rocketmq/broker/lib;\nmkdir -p /data/rocketmq/console/data;\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/#_2","title":"\u521b\u5efa\u200b\u6302\u8f7d\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6","text":"Bash<pre><code>vi /data/rocketmq/broker/conf/broker.conf\n</code></pre> Bash<pre><code>#\u200b\u6240\u5c5e\u200b\u96c6\u7fa4\u200b\u540d\u5b57\u200b\nbrokerClusterName=DefaultCluster\n\n#broker\u200b\u540d\u5b57\u200b\uff0c\u200b\u6ce8\u610f\u200b\u6b64\u5904\u200b\u4e0d\u540c\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u586b\u5199\u200b\u7684\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u200bbroker-a.properties\u200b\u4f7f\u7528\u200b:broker-a,\n#\u200b\u5728\u200bbroker-b.properties\u200b\u4f7f\u7528\u200b:broker-b\nbrokerName=broker-a\n\n#0 \u200b\u8868\u793a\u200bMaster\uff0c&gt;0 \u200b\u8868\u793a\u200bSlave\nbrokerId=0\n\n#nameServer\u200b\u5730\u5740\u200b\uff0c\u200b\u5206\u200b\u53f7\u200b\u5206\u5272\u200b\n#namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876\nnamesrvAddr=rocketmq-namesrv:9876\n\n#\u200b\u542f\u52a8\u200bIP,\u200b\u5982\u679c\u200b docker \u200b\u62a5\u200b com.alibaba.rocketmq.remoting.exception.RemotingConnectException: connect to &lt;192.168.0.120:10909&gt; failed\n# \u200b\u89e3\u51b3\u200b\u65b9\u5f0f\u200b1 \u200b\u52a0\u4e0a\u200b\u4e00\u53e5\u200bproducer.setVipChannelEnabled(false);\uff0c\u200b\u89e3\u51b3\u200b\u65b9\u5f0f\u200b2 brokerIP1 \u200b\u8bbe\u7f6e\u200b\u5bbf\u4e3b\u673a\u200bIP\uff0c\u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200bdocker \u200b\u5185\u90e8\u200bIP\nbrokerIP1=120.26.2.151\n\n#\u200b\u5728\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u65f6\u200b\uff0c\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u670d\u52a1\u5668\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u200btopic\uff0c\u200b\u9ed8\u8ba4\u200b\u521b\u5efa\u200b\u7684\u200b\u961f\u5217\u200b\u6570\u200b\ndefaultTopicQueueNums=4\n\n#\u200b\u662f\u5426\u200b\u5141\u8bb8\u200b Broker \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200bTopic\uff0c\u200b\u5efa\u8bae\u200b\u7ebf\u4e0b\u200b\u5f00\u542f\u200b\uff0c\u200b\u7ebf\u4e0a\u200b\u5173\u95ed\u200b \uff01\uff01\uff01\u200b\u8fd9\u91cc\u200b\u4ed4\u7ec6\u200b\u770b\u200b\u662f\u200bfalse\uff0cfalse\uff0cfalse\nautoCreateTopicEnable=true\n\n#\u200b\u662f\u5426\u200b\u5141\u8bb8\u200b Broker \u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u8ba2\u9605\u200b\u7ec4\u200b\uff0c\u200b\u5efa\u8bae\u200b\u7ebf\u4e0b\u200b\u5f00\u542f\u200b\uff0c\u200b\u7ebf\u4e0a\u200b\u5173\u95ed\u200b\nautoCreateSubscriptionGroup=true\n\n#Broker \u200b\u5bf9\u5916\u200b\u670d\u52a1\u200b\u7684\u200b\u76d1\u542c\u200b\u7aef\u53e3\u200b\nlistenPort=10911\n\n#\u200b\u6b64\u53c2\u6570\u200b\u63a7\u5236\u200b\u662f\u5426\u200b\u5f00\u542f\u200b\u5bc6\u7801\u200b,\u200b\u4e0d\u200b\u5f00\u542f\u200b\u53ef\u200b\u8bbe\u7f6e\u200bfalse\naclEnable=true\n\n#\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\u65f6\u95f4\u200b\u70b9\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u51cc\u6668\u200b4\u200b\u70b9\u200b\ndeleteWhen=04\n\n#\u200b\u6587\u4ef6\u200b\u4fdd\u7559\u200b\u65f6\u95f4\u200b\uff0c\u200b\u9ed8\u8ba4\u200b48\u200b\u5c0f\u65f6\u200b\nfileReservedTime=120\n\n#commitLog\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u5927\u5c0f\u200b\u9ed8\u8ba4\u200b1G\nmapedFileSizeCommitLog=1073741824\n\n#ConsumeQueue\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u200b\u9ed8\u8ba4\u200b\u5b58\u200b30W\u200b\u6761\u200b\uff0c\u200b\u6839\u636e\u200b\u4e1a\u52a1\u200b\u60c5\u51b5\u200b\u8c03\u6574\u200b\nmapedFileSizeConsumeQueue=300000\n\n#destroyMapedFileIntervalForcibly=120000\n#redeleteHangedFileInterval=120000\n#\u200b\u68c0\u6d4b\u200b\u7269\u7406\u200b\u6587\u4ef6\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\ndiskMaxUsedSpaceRatio=88\n#\u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b\n#storePathRootDir=/home/ztztdata/rocketmq-all-4.1.0-incubating/store\n#commitLog \u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b\n#storePathCommitLog=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/commitlog\n#\u200b\u6d88\u8d39\u200b\u961f\u5217\u200b\u5b58\u50a8\u200b\n#storePathConsumeQueue=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/consumequeue\n#\u200b\u6d88\u606f\u200b\u7d22\u5f15\u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b\n#storePathIndex=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/index\n#checkpoint \u200b\u6587\u4ef6\u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b\n#storeCheckpoint=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/checkpoint\n#abort \u200b\u6587\u4ef6\u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b\n#abortFile=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/abort\n#\u200b\u9650\u5236\u200b\u7684\u200b\u6d88\u606f\u200b\u5927\u5c0f\u200b\nmaxMessageSize=65536\n\n#flushCommitLogLeastPages=4\n#flushConsumeQueueLeastPages=2\n#flushCommitLogThoroughInterval=10000\n#flushConsumeQueueThoroughInterval=60000\n\n#Broker \u200b\u7684\u200b\u89d2\u8272\u200b\n#- ASYNC_MASTER \u200b\u5f02\u6b65\u200b\u590d\u5236\u200bMaster\n#- SYNC_MASTER \u200b\u540c\u6b65\u200b\u53cc\u5199\u200bMaster\n#- SLAVE\nbrokerRole=ASYNC_MASTER\n\n#\u200b\u5237\u76d8\u200b\u65b9\u5f0f\u200b\n#- ASYNC_FLUSH \u200b\u5f02\u6b65\u200b\u5237\u76d8\u200b\n#- SYNC_FLUSH \u200b\u540c\u6b65\u200b\u5237\u76d8\u200b\nflushDiskType=ASYNC_FLUSH\n\n#\u200b\u53d1\u6d88\u606f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6570\u91cf\u200b\n#sendMessageThreadPoolNums=128\n#\u200b\u62c9\u200b\u6d88\u606f\u200b\u7ebf\u7a0b\u200b\u6c60\u200b\u6570\u91cf\u200b\n#pullMessageThreadPoolNums=128\n</code></pre> <p><code>brokerIP1=47.99.73.85</code>\u200b\u586b\u200b\u4e0a\u200b\u81ea\u5df1\u200b\u670d\u52a1\u5668\u200b\u516c\u7f51\u200bip\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u8981\u8054\u200b\u8fd9\u4e2a\u200b</p> <p>\u200b\u5982\u679c\u200b\u6709\u200b\u8bbe\u7f6e\u200b\u5bc6\u7801\u200b\u7684\u200b\u9700\u6c42\u200b\uff0cbroker.conf\u200b\u5f00\u542f\u200bacl\u200b\u5bc6\u7801\u200b\u914d\u7f6e\u200b true</p>","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/#acl","title":"\u521b\u5efa\u200bacl\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5f00\u542f\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801","text":"Bash<pre><code>vi /data/rocketmq/broker/conf/plain_acl.yml\n</code></pre> Bash<pre><code># Licensed to the Apache Software Foundation (ASF) under one or more\n# contributor license agreements.  See the NOTICE file distributed with\n# this work for additional information regarding copyright ownership.\n# The ASF licenses this file to You under the Apache License, Version 2.0\n# (the \"License\"); you may not use this file except in compliance with\n# the License.  You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS,\n#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#  See the License for the specific language governing permissions and\n#  limitations under the License.\nglobalWhiteRemoteAddresses:\n#  - 47.100.93.*\n#  - 156.254.120.*\n\naccounts:\n    # \u200b\u975e\u200b\u7ba1\u7406\u5458\u200b\n  - accessKey: RocketMQ\n    secretKey: Cjy050119\n    whiteRemoteAddress:\n    admin: false\n    defaultTopicPerm: DENY\n    defaultGroupPerm: SUB\n    topicPerms:\n      - topicA=DENY\n      - topicB=PUB|SUB\n      - topicC=SUB\n    groupPerms:\n      # the group should convert to retry topic\n      - groupA=DENY\n      - groupB=PUB|SUB\n      - groupC=SUB\n\n    # \u200b\u7ba1\u7406\u5458\u200b\n  - accessKey: admin123456\n    secretKey: Cjy123456\n    whiteRemoteAddress: \n    # if it is admin, it could access all resources\n    admin: true\n</code></pre> <p>\u200b\u5bc6\u7801\u200b\u4e0d\u80fd\u200b\u5c0f\u4e8e\u200b6\u200b\u4f4d\u6570\u200b \u200b\u540d\u79f0\u200b\u4e5f\u200b\u4e0d\u80fd\u200b\u5c0f\u4e8e\u200b6\u200b\u4f4d\u200b \u200b\u6743\u9650\u200b\u7684\u200b\u63cf\u8ff0\u200b\u53ef\u200b\u53c2\u8003\u200b\u94fe\u63a5\u200b</p>","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/#console","title":"\u8bbe\u7f6e\u200bconsole\u200b\u7684\u200b\u8d26\u53f7\u5bc6\u7801","text":"Bash<pre><code>vi  /data/rocketmq/console/data/users.properties\n</code></pre> Bash<pre><code># This file supports hot change, any change will be auto-reloaded without Console restarting.\n# Format: a user per line, username=password[,N] #N is optional, 0 (Normal User); 1 (Admin)\n\n# Define Admin\n# =============\u200b\u7528\u6237\u540d\u200b\u548c\u200b\u5bc6\u7801\u200b\u89c4\u5219\u200b\u300c\u200b\u7528\u6237\u540d\u200b=\u200b\u5bc6\u7801\u200b,\u200b\u6743\u9650\u200b\u300d\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u6743\u9650\u200b\u4e3a\u200b1\u200b\u8868\u793a\u200b\u7ba1\u7406\u5458\u200b&gt;\uff0c\u200b\u4e3a\u200b0\u200b\u8868\u793a\u200b\u666e\u901a\u7528\u6237\u200b=============\n# \u200b\u4f8b\u5982\u200b\uff1aadmin=admin123,1\nadmin=123456,1\n\n\n# Define Users\n# =============\u200b\u5c4f\u853d\u200b\u4e0b\u8fb9\u200b\u4e24\u4e2a\u200b\u8d26\u6237\u200b=============\n#user1=user1\n#user2=user2\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/#yml","title":"\u521b\u5efa\u200byml\u200b\u6587\u4ef6","text":"Bash<pre><code>vi /data/rocketmq/docker-compose.yml\n</code></pre> Bash<pre><code>version: '3.8'\nservices:\n  rocketmq-namesrv:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: rocketmq-namesrv\n    restart: always\n    ports:\n      - 9876:9876\n    volumes:\n      - ./namesrv/logs:/home/rocketmq/logs\n      - ./namesrv/store:/home/rocketmq/store\n    environment:\n      JAVA_OPT_EXT: \"-Duser.home=/home/rocketmq -Xms128M -Xmx128M -Xmn128m\"\n    command: [\"sh\",\"mqnamesrv\"]\n    networks:\n      rocketmq_net:\n        aliases:\n          - rocketmq-namesrv\n\n\n  rocketmq-broker:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: rocketmq-broker\n    restart: always\n    ports:\n      - 10909:10909\n      - 10911:10911\n    volumes:\n      - ./broker/logs:/home/rocketmq/logs\n      - ./broker/store:/home/rocketmq/store\n      - ./broker/conf/plain_acl.yml:/home/rocketmq/rocketmq-4.8.0/conf/plain_acl.yml\n      - ./broker/conf/broker.conf:/etc/rocketmq/broker.conf\n    environment:\n      JAVA_OPT_EXT: \"-Duser.home=/home/rocketmq -Xms128m -Xmx128m -Xmn128m\"\n    command: [\"sh\",\"mqbroker\",\"-c\",\"/etc/rocketmq/broker.conf\"]\n    depends_on:\n      - rocketmq-namesrv\n    networks:\n      rocketmq_net:\n        aliases:\n          - rocketmq-broker\n\n\n  rocketmq-console:\n    image: iamverygood/rocketmq-console:4.7.1\n    container_name: rocketmq-console\n    restart: always\n    ports:\n      - 8180:8080\n    volumes:\n      - ./console/data:/tmp/rocketmq-console/data\n    environment:\n      JAVA_OPTS: \"-Drocketmq.namesrv.addr=rocketmq-namesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false -Drocketmq.config.loginRequired=true -Drocketmq.config.aclEnabled=true -Drocketmq.config.accessKey=admin123456 -Drocketmq.config.secretKey=Cjy123456\"\n    depends_on:\n      - rocketmq-namesrv\n    networks:\n      rocketmq_net:\n        aliases:\n          - rocketmq-console\n\nnetworks:\n  rocketmq_net:\n    name: rocketmq_net\n    driver: bridge\n</code></pre> <p>\u200b\u5982\u679c\u200bacl\u200b\u5bc6\u7801\u200b\u6539\u4e86\u200b\uff0c\u200b\u8bb0\u5f97\u200b\u628a\u200byml\u200b\u7684\u200bconsole\u200b\u5e10\u53f7\u5bc6\u7801\u200b\u4e5f\u200b\u4e00\u540c\u200b\u66f4\u6539\u200b <code>-Drocketmq.config.accessKey=admin123456</code> <code>-Drocketmq.config.secretKey=Cjy123456</code> \u200b\u6388\u4e88\u200b\u76ee\u5f55\u200b\u6743\u9650\u200b</p> Bash<pre><code>#\u200b\u76ee\u5f55\u200b\u6743\u9650\u200b\uff1a\nchmod -R 777 /data/rocketmq/namesrv/;\nchmod -R 777 /data/rocketmq/broker/;\nchmod -R 777 /data/rocketmq/console/;\n</code></pre>","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/#9876109118180","title":"\uff01\uff01\u200b\u5b89\u5168\u200b\u7ec4\u200b\u6dfb\u52a0\u200b\u7aef\u53e3\u200b 9876\uff0c10911\uff0c8180 \uff01\uff01","text":"Bash<pre><code>cd /data/rocketmq\ndocker-compose up -d\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\uff0c\u200b\u7b2c\u4e00\u6b21\u200b\u4f1a\u200b\u542f\u52a8\u200b\u4e0d\u200b\u6210\u529f\u200b\uff0c\u200b\u56e0\u4e3a\u200bbroker\u200b\u9700\u8981\u200b\u521b\u5efa\u200b\u4e00\u5806\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6743\u9650\u200b\u3002\u200b\u518d\u200b\u6267\u884c\u200b\u4e00\u904d\u200b\u6743\u9650\u200b\u547d\u4ee4\u200b</p> Bash<pre><code>#\u200b\u76ee\u5f55\u200b\u6743\u9650\u200b\uff1a\nchmod -R 777 /data/rocketmq/namesrv/;\nchmod -R 777 /data/rocketmq/broker/;\nchmod -R 777 /data/rocketmq/console/;\n</code></pre> <p>\u200b\u628a\u200b\u542f\u52a8\u200b\u7684\u200bmq\u200b\u76f8\u5173\u200b\u955c\u50cf\u200bstop\u200b\u540e\u200b\uff0crm \u200b\u518d\u200b\u91cd\u65b0\u542f\u52a8\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e86\u200b</p>","tags":["docker"]},{"location":"blog/2024/11/12/rocketmq-%E9%83%A8%E7%BD%B2/#_3","title":"\u542f\u52a8\u200b\u63a7\u5236\u53f0","text":"<p>\u200b\u542f\u52a8\u200b\u540e\u200b\u53ef\u4ee5\u200b\u767b\u5f55\u200b\u63a7\u5236\u53f0\u200b <code>http://ip:8180/</code> \u200b\u8f93\u5165\u200b\u8d26\u53f7\u5bc6\u7801\u200b <code>admin</code> <code>123456</code></p>","tags":["docker"]},{"location":"blog/2024/11/12/docker/","title":"Docker","text":"<p> \u200b\u7ea6\u200b 219 \u200b\u4e2a\u200b\u5b57\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> <p></p>","tags":["docker"]},{"location":"blog/2024/11/12/docker/#docker_1","title":"docker \u200b\u5e38\u7528\u547d\u4ee4","text":"<ol> <li>\u200b\u62c9\u53d6\u200bdocker\u200b\u955c\u50cf\u200b <code>docker pull image_name</code></li> <li>\u200b\u67e5\u770b\u200b\u5bbf\u4e3b\u673a\u200b\u4e0a\u200b\u7684\u200b\u955c\u50cf\u200b\uff0cDocker\u200b\u955c\u50cf\u200b\u4fdd\u5b58\u200b\u5728\u200b/var/lib/docker\u200b\u76ee\u5f55\u200b\u4e0b\u200b: <code>docker images</code></li> <li>\u200b\u5220\u9664\u200b\u955c\u50cf\u200b <code>docker rmi docker.io/tomcat:7.0.77-jre7 \u200b\u6216\u8005\u200b docker rmi b39c68b7af30</code></li> <li>\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u6709\u200b\u54ea\u4e9b\u200b\u5bb9\u5668\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b <code>docker ps</code></li> <li>\u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u5bb9\u5668\u200b <code>docker ps -a</code></li> <li>\u200b\u542f\u52a8\u200b\u3001\u200b\u505c\u6b62\u200b\u3001\u200b\u91cd\u542f\u200b\u5bb9\u5668\u200b\u547d\u4ee4\u200b\uff1a <code>docker start container_name/container_id</code> <code>docker stop container_name/container_id</code> <code>docker restart container_name/container_id</code></li> <li>\u200b\u540e\u53f0\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u5bb9\u5668\u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u200b\u8fdb\u5165\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u5bb9\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200battach\u200b\u547d\u4ee4\u200b\uff1a <code>docker attach container_name/container_id</code></li> <li>\u200b\u5220\u9664\u200b\u5bb9\u5668\u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a <code>docker rm container_name/container_id</code></li> <li>\u200b\u5220\u9664\u200b\u6240\u6709\u200b\u505c\u6b62\u200b\u7684\u200b\u5bb9\u5668\u200b\uff1a <code>docker rm $(docker ps -a -q)</code></li> <li>\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u7cfb\u7edf\u200bDocker\u200b\u4fe1\u606f\u200b <code>docker info</code></li> <li>\u200b\u4ece\u200bDocker hub\u200b\u4e0a\u200b\u4e0b\u8f7d\u200b\u67d0\u4e2a\u200b\u955c\u50cf\u200b: <code>docker pull centos:latest docker pull centos:latest</code></li> <li>\u200b\u67e5\u627e\u200bDocker Hub\u200b\u4e0a\u200b\u7684\u200bnginx\u200b\u955c\u50cf\u200b <code>docker search nginx</code></li> <li>\u200b\u6267\u884c\u200b<code>docker pull centos</code>\u200b\u4f1a\u200b\u5c06\u200bCentos\u200b\u8fd9\u4e2a\u200b\u4ed3\u5e93\u200b\u4e0b\u9762\u200b\u7684\u200b\u6240\u6709\u200b\u955c\u50cf\u200b\u4e0b\u8f7d\u200b\u5230\u200b\u672c\u5730\u200brepository\u3002</li> </ol>","tags":["docker"]},{"location":"blog/2025/01/27/archlinux%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/","title":"ArchLinux\u200b\u5b89\u88c5\u200b\u4e0e\u200b\u914d\u7f6e","text":"<p> \u200b\u7ea6\u200b 477 \u200b\u4e2a\u200b\u5b57\u200b  33 \u200b\u884c\u200b\u4ee3\u7801\u200b  5 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 2 \u200b\u5206\u949f\u200b</p>","tags":["linux"]},{"location":"blog/2025/01/27/archlinux%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/#_1","title":"\u5b89\u88c5","text":"<p>\u200b\u6211\u200b\u662f\u200b\u8ddf\u7740\u200b\u4e0b\u8ff0\u200b\u6559\u7a0b\u200b\u5b89\u88c5\u200b\u7684\u200b\uff0c\u200b\u4f53\u9a8c\u200b\u4e0b\u6765\u200b\u5e76\u200b\u4e0d\u96be\u200b archlinux \u200b\u57fa\u7840\u200b\u5b89\u88c5\u200b | archlinux \u200b\u7b80\u660e\u200b\u6307\u5357\u200b</p> <p>\u200b\u6211\u200b\u4e2a\u4eba\u200b\u4e0d\u662f\u200b\u5f88\u200b\u63a8\u8350\u200b\u7b2c\u4e00\u6b21\u200b\u5b89\u88c5\u200b\u7528\u200b<code>archinstall</code>\uff0c\u200b\u7528\u200b\u8d77\u6765\u200b\u4e0d\u662f\u200b\u5f88\u200b\u8212\u670d\u200b...(\u200b\u770b\u200b\u4e2a\u4eba\u200b\u5427\u200b)</p> <p>\u200b\u5b89\u88c5\u200b\u6210\u529f\u200b\uff01\u200b\u7cfb\u7edf\u200b\u4fe1\u606f\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p>","tags":["linux"]},{"location":"blog/2025/01/27/archlinux%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/#grub-windows","title":"[\u200b\u89e3\u51b3\u200b] grub \u200b\u627e\u200b\u4e0d\u5230\u200b Windows \u200b\u5f15\u5bfc","text":"<p>\u200b\u80cc\u666f\u200b\u5982\u4e0b\u200b\uff1a</p> <p>\u200b\u6211\u200b\u7684\u200b <code>ArchLinux</code> \u200b\u5b89\u88c5\u200b\u5728\u200b\u4e00\u5757\u200b\u65b0\u4e70\u200b\u7684\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u4e0a\u200b\uff0c\u200b\u6211\u200b\u4e2a\u4eba\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u539f\u56e0\u200b\u5bfc\u81f4\u200b\u5176\u200b\u65e0\u6cd5\u200b\u627e\u5230\u200b <code>Windows Boot</code>\uff0c\u200b\u5373\u200b \u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b <code>grub-mkconfig -o /boot/grub/grub.cfg</code> \u200b\u540e\u200b\uff0c\u200b\u5728\u200b <code>grub</code> \u200b\u754c\u9762\u200b\u53ea\u80fd\u200b\u627e\u5230\u200b <code>ArchLinux</code> \u200b\u5f15\u5bfc\u200b\u4f46\u200b\u6ca1\u6709\u200b <code>Windows</code></p> <p>\u200b\u6392\u67e5\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <p>\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b <code>fdisk -l</code> \u200b\u67e5\u627e\u200b <code>Windows</code> \u200b\u7684\u200b <code>EFI</code> \u200b\u5206\u533a\u200b</p> <p></p> <p>\u200b\u89c2\u5bdf\u200b\u5230\u200b <code>Windows</code> \u200b\u7684\u200b <code>EFI</code>\u200b\u5206\u533a\u200b\u4f4d\u4e8e\u200b <code>/dev/nvme0n1p1</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b</p> <p>\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b <code>mount /dev/nvme0n1p1 /mnt</code> \u200b\u5c06\u200b <code>Windows EFI</code> \u200b\u6302\u8f7d\u200b\u5230\u200b <code>/mnt</code> \u200b\u4e0a\u200b</p> <p>\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b <code>lsblk</code> \u200b\u67e5\u770b\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\u6302\u8f7d\u200b</p> <p></p> <p>\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b <code>os-prober</code> \u200b\u53d1\u73b0\u200b <code>Windows</code> \u200b\u5f15\u5bfc\u200b</p> <p>\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b <code>grub-mkconfig -o /boot/grub/grub.cfg</code> \u200b\u751f\u6210\u200b <code>grub</code> \u200b\u914d\u7f6e\u6587\u4ef6\u200b</p> <p></p> <p>\u200b\u6700\u540e\u200b<code>grub</code> \u200b\u6210\u529f\u200b\u53d1\u73b0\u200b <code>Windows</code> \u200b\u5f15\u5bfc\u200b\uff0c\u200b\u95ee\u9898\u200b\u6210\u529f\u200b\u89e3\u51b3\u200b\uff01\uff01\uff01</p>","tags":["linux"]},{"location":"blog/2025/01/27/archlinux%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/#nvidia","title":"\u5b89\u88c5\u200bNVIDIA\u200b\u663e\u5361\u200b\u9a71\u52a8","text":"<p>\u200b\u67e5\u770b\u200b\u663e\u5361\u200b</p> Bash<pre><code>lspci -k | grep -A 2 -E \"(VGA|3D)\"\n</code></pre> <p>\u200b\u5b89\u88c5\u200b\u9a71\u52a8\u200b</p> Bash<pre><code>sudo pacman -S nvidia nvidia-utils nvidia-settings\n</code></pre> Bash<pre><code>sudo nvim /etc/default/grub\n</code></pre> <p>\u200b\u5728\u200b<code>GRUB_CMDLINE_LINUX</code>\u200b\u4e2d\u200b\u6dfb\u52a0\u200b<code>nvidia_drm.modeset=1</code></p> Bash<pre><code>sudo grub-mkconfig -o /boot/grub/grub.cfg\n</code></pre> Bash<pre><code>sudo nvim /etc/mkinitcpio.conf\n</code></pre> <p>\u200b\u5728\u200b<code>MODULES</code>\u200b\u4e2d\u200b\u52a0\u5165\u200b<code>nvidia nvidia_modeset nvidia_uvm nvidia_drm</code></p> <p>\u200b\u5c06\u200b<code>kms</code>\u200b\u4ece\u200b<code>HOOKS</code>\u200b\u4e2d\u200b\u53bb\u6389\u200b</p> Bash<pre><code>sudo mkinitcpio -P\n</code></pre> <p><code>reboot</code> \u200b\u91cd\u542f\u200b</p> <p><code>nvidia-smi</code> \u200b\u9a8c\u8bc1\u200b\u662f\u5426\u200b\u5b89\u88c5\u200b\u6210\u529f\u200b</p>","tags":["linux"]},{"location":"blog/2025/01/27/archlinux%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/#hyprland","title":"\u5b89\u88c5\u200bHyprland","text":"Bash<pre><code>sudo pacman -S hyprland kitty waybar\nsudo pacman -S sddm\nsudo pacman -S ttf-jetbrains-mono-nerd adobe-source-han-sans-cn-fonts adobe-source-code-pro-fonts\nsudo systemctl enable sddm\n</code></pre> Bash<pre><code>vim ~/.config/hypr/hyprland.conf\n#\u200b\u6dfb\u52a0\u200bNVIDIA\u200b\u73af\u5883\u53d8\u91cf\u200b\nenv = LIBVA_DRIVER_NAME,nvidia\nenv = XDG_SESSION_TYPE,wayland\nenv = GBM_BACKEND,nvidia-drm\nenv = __GLX_VENDOR_LIBRARY_NAME,nvidia\nenv = WLR_NO_HARDWARE_CURSORS,1\n</code></pre> <p>\u200b\u6267\u884c\u200b\u5b8c\u200b\u4e0a\u8ff0\u200b\u547d\u4ee4\u200b\u4e14\u200b\u65e0\u200b\u62a5\u9519\u200b\u540e\u200b\uff0c<code>reboot</code> \u200b\u91cd\u542f\u200b</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b <code>Hyprland</code> \u200b\u7684\u200b\u57fa\u672c\u64cd\u4f5c\u200b</p> <ul> <li>Win+Q \u200b\u5f00\u542f\u200b\u7ec8\u7aef\u200b</li> <li>Win+C \u200b\u5173\u95ed\u200b\u7a97\u53e3\u200b</li> <li>Win+R \u200b\u547c\u200b\u51fa\u200b\u83dc\u5355\u200b</li> <li>Win+\u200b\u6570\u5b57\u200b \u200b\u5207\u6362\u200b\u684c\u9762\u200b</li> <li>Win+Shift+\u200b\u6570\u5b57\u200b \u200b\u5c06\u200b\u5f53\u524d\u200b\u7a97\u53e3\u200b\u79fb\u52a8\u200b\u5230\u200b\u5bf9\u5e94\u200b\u5de5\u4f5c\u200b\u533a\u200b</li> <li>Win+\u200b\u9f20\u6807\u200b\u5de6\u952e\u200b \u200b\u62d6\u52a8\u200b\u7a97\u53e3\u200b</li> <li>Win+\u200b\u9f20\u6807\u200b\u53f3\u952e\u200b \u200b\u8c03\u6574\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b</li> <li>Win+V \u200b\u8ba9\u200b\u7a97\u53e3\u200b\u6d6e\u52a8\u200b\u51fa\u6765\u200b</li> </ul>","tags":["linux"]},{"location":"blog/2025/01/27/archlinux%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/#_2","title":"\u5b89\u88c5\u200b\u57fa\u7840\u200b\u7ec4\u4ef6","text":"<ol> <li>\u200b\u5b89\u88c5\u200b\u8f93\u5165\u6cd5\u200b</li> </ol> Bash<pre><code>sudo pacman -S fcitx5-im # \u200b\u8f93\u5165\u6cd5\u200b\u57fa\u7840\u200b\u5305\u7ec4\u200b\nsudo pacman -S fcitx5-chinese-addons # \u200b\u5b98\u65b9\u200b\u4e2d\u6587\u200b\u8f93\u5165\u200b\u5f15\u64ce\u200b\nsudo pacman -S fcitx5-anthy # \u200b\u65e5\u6587\u200b\u8f93\u5165\u200b\u5f15\u64ce\u200b\nsudo pacman -S fcitx5-pinyin-moegirl # \u200b\u840c\u5a18\u200b\u767e\u79d1\u200b\u8bcd\u5e93\u200b\u3002\u200b\u4e8c\u523a\u200b\u733f\u200b\u5fc5\u5907\u200b\uff08archlinuxcn\uff09\nsudo pacman -S fcitx5-material-color # \u200b\u8f93\u5165\u6cd5\u200b\u4e3b\u9898\u200b\n</code></pre> <p>\u200b\u901a\u8fc7\u200b vim \u200b\u521b\u5efa\u200b\u5e76\u200b\u7f16\u8f91\u200b\u6587\u4ef6\u200b <code>~/.config/environment.d/im.conf</code>\uff1a</p> Bash<pre><code>vim ~/.config/environment.d/im.conf\n</code></pre> <p>\u200b\u5728\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u52a0\u5165\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u5e76\u200b\u4fdd\u5b58\u200b\u9000\u51fa\u200b</p> Text Only<pre><code># fix fcitx problem\nGTK_IM_MODULE=fcitx\nQT_IM_MODULE=fcitx\nXMODIFIERS=@im=fcitx\nSDL_IM_MODULE=fcitx\nGLFW_IM_MODULE=ibus\n</code></pre> <ol> <li>\u200b\u914d\u7f6e\u200b\u8f93\u5165\u6cd5\u200b</li> </ol> Bash<pre><code>fcitx5-configtool\n</code></pre> <ol> <li>\u200b\u5b89\u88c5\u200bparu</li> </ol> Bash<pre><code>git clone https://aur.archlinux.org/paru.git\ncd paru\nmakepkg -si\n</code></pre> <ol> <li>\u200b\u5b89\u88c5\u200b\u4ee3\u7406\u200b</li> </ol> Bash<pre><code>paru -S clash-verge-rev\n</code></pre> <ol> <li>\u200b\u5b89\u88c5\u200brofi</li> </ol> Bash<pre><code>sudo pacman -S rofi\n</code></pre> <ol> <li>\u200b\u5b89\u88c5\u200bgoogle\u200b\u548c\u200bvscode</li> </ol> Bash<pre><code>paru -S google-chrome\nsudo pacman -S code\n</code></pre> <ol> <li>\u200b\u914d\u7f6e\u200b\u58f0\u97f3\u200b</li> </ol> Bash<pre><code>sudo pacman -S pavucontrol-qt\npavucontrol-qt\n</code></pre>","tags":["linux"]},{"location":"blog/2025/01/27/archlinux%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/#_3","title":"\u6700\u7ec8\u200b\u6548\u679c","text":"<p>\u200b\u5e05\u200b\uff01</p> <p></p>","tags":["linux"]},{"location":"blog/2024/12/07/learn-linux/","title":"Learn-Linux","text":"<p> \u200b\u7ea6\u200b 21 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["linux"]},{"location":"blog/2024/12/07/learn-linux/#1-linux","title":"1. linux\u200b\u516b\u80a1","text":"<p>Linux \u200b\u57fa\u7840\u77e5\u8bc6\u200b\u603b\u7ed3\u200b</p>","tags":["linux"]},{"location":"blog/2024/12/07/learn-linux/#2-linux","title":"2. linux\u200b\u547d\u4ee4\u200b\u67e5\u8be2","text":"<p>Linux Command Manual</p>","tags":["linux"]},{"location":"blog/2024/12/07/learn-linux/#3-tldr","title":"3. tldr","text":"<p>tldr</p>","tags":["linux"]},{"location":"blog/2024/11/12/linux%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/","title":"linux\u200b\u73af\u5883\u200b\u90e8\u7f72","text":"<p> \u200b\u7ea6\u200b 79 \u200b\u4e2a\u200b\u5b57\u200b  43 \u200b\u884c\u200b\u4ee3\u7801\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["linux"]},{"location":"blog/2024/11/12/linux%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/#ssh","title":"SSH\u200b\u8fde\u63a5","text":"<p>\u200b\u6211\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200bmacos\uff0c\u200b\u9009\u62e9\u200b\u8f6f\u4ef6\u200b Termius \u200b\u8fdb\u884c\u200bSSH\u200b\u8fdc\u7a0b\u200b\u8fde\u63a5\u200b  </p> <p> </p>","tags":["linux"]},{"location":"blog/2024/11/12/linux%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/#linux_1","title":"linux \u200b\u7cfb\u7edf\u200b\u73af\u5883","text":"Bash<pre><code>[root@iZbp12idmwavjjcx2k19kjZ ~]# cat /etc/os-release \nNAME=\"Alibaba Cloud Linux\"\nVERSION=\"3 (OpenAnolis Edition)\"\nID=\"alinux\"\nID_LIKE=\"rhel fedora centos anolis\"\nVERSION_ID=\"3\"\nVARIANT=\"OpenAnolis Edition\"\nVARIANT_ID=\"openanolis\"\nALINUX_MINOR_ID=\"2104\"\nALINUX_UPDATE_ID=\"10\"\nPLATFORM_ID=\"platform:al8\"\nPRETTY_NAME=\"Alibaba Cloud Linux 3.2104 U10 (OpenAnolis Edition)\"\nANSI_COLOR=\"0;31\"\nHOME_URL=\"https://www.aliyun.com/\"\n</code></pre>","tags":["linux"]},{"location":"blog/2024/11/12/linux%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/#docker","title":"\u5b89\u88c5\u200bdocker","text":"Bash<pre><code># \u200b\u66f4\u65b0\u200byum\nyum upgrade\n\n# \u200b\u8bbe\u7f6e\u200b\u955c\u50cf\u200b\u4ed3\u5e93\u200b (\u200b\u963f\u91cc\u200b\u4e91\u200b\u955c\u50cf\u200b)\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n# \u200b\u5b89\u88c5\u200bdocker\nyum install docker-ce\n\n# \u200b\u542f\u52a8\u200bdocker\nsudo systemctl start docker\nsudo systemctl enable docker\n\n# \u200b\u67e5\u770b\u200bdocker \u200b\u7248\u672c\u200b\ndocker --version\n</code></pre>","tags":["linux"]},{"location":"blog/2024/11/12/linux%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/#docker-compose","title":"\u5b89\u88c5\u200b docker-compose","text":"Bash<pre><code># \u200b\u5148\u200b\u6267\u884c\u200b\u8fd9\u200b\u4e24\u884c\u200b\u547d\u4ee4\u200b\uff0c\u200b\u76f4\u63a5\u200bpip\u200b\u4f1a\u200b\u62a5\u9519\u200b\nsudo python3 -m pip install -U pip\nsudo python3 -m pip install -U setuptools\n\n# \u200b\u5b89\u88c5\u200bdocker-compose\npip install docker-compose\n\n# \u200b\u67e5\u770b\u200b docker-compose \u200b\u7248\u672c\u200b\ndocker-compose --version\n</code></pre>","tags":["linux"]},{"location":"blog/2024/11/12/linux%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/#docker_1","title":"docker \u200b\u914d\u7f6e\u200b\u56fd\u5185\u200b\u955c\u50cf\u200b\u6e90","text":"<p>\u200b\u914d\u7f6e\u200b\u56fd\u5185\u200b\u955c\u50cf\u200b\u6e90\u200b \u200b\u955c\u50cf\u200b\u6e90\u5730\u5740\u200b\u5927\u5168\u200b</p> Bash<pre><code>vim  /etc/docker/daemon.json\n</code></pre> Text Only<pre><code>{\"registry-mirrors\": [\n\"https://docker.1panel.dev\",\n\"https://docker.fxxk.dedyn.io\",\n\"https://docker.xn--6oq72ry9d5zx.cn\",\n\"https://docker.m.daocloud.io\",\n\"https://a.ussh.net\",\n\"https://docker.zhai.cm\"]}\n</code></pre> <p>\u200b\u4e0a\u8ff0\u200b\u955c\u50cf\u200b\u6e90\u200b 2024/10/10 \u200b\u53ef\u7528\u200b</p> <p>\u200b\u91cd\u542f\u200bdocker\u200b\u670d\u52a1\u200b</p> Bash<pre><code># \u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6\u200b\nsudo systemctl daemon-reload\n# \u200b\u91cd\u65b0\u542f\u52a8\u200bdocker\u200b\u670d\u52a1\u200b\nsudo service docker restart\n</code></pre>","tags":["linux"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/","title":"Missing Semester of MacOS - A Vim Enthusiast Programmer\u2019s Perspective","text":"<p> \u200b\u7ea6\u200b 1679 \u200b\u4e2a\u200b\u5b57\u200b  14 \u200b\u884c\u200b\u4ee3\u7801\u200b  26 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 6 \u200b\u5206\u949f\u200b</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#_1","title":"\u524d\u8a00","text":"<p>\u200b\u5f53\u200b\u6211\u200b\u7ecf\u5386\u200b\u4e86\u200b\u4f7f\u7528\u200b MacBook Air \u200b\u5f00\u542f\u200b docker + n \u200b\u4e2a\u200b idea \u200b\u9879\u76ee\u200b + cursor + vscode + \u200b\u4e00\u5806\u200b\u6d4f\u89c8\u5668\u200b\u6807\u7b7e\u200b\u9875\u200b \u200b\u5361\u5230\u200b\u7206\u70b8\u200b\u7684\u200b\u4f53\u9a8c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u51b3\u5b9a\u200b\u8fc1\u79fb\u200b\u6211\u200b\u7684\u200b\u5f00\u53d1\u200b\u73af\u5883\u200b\u5230\u200b MacBook Pro \u200b\u4e0a\u200b\uff0c\u200b\u5728\u200b\u8d2d\u4e70\u200b\u524d\u200b\u4e86\u89e3\u200b\u5230\u200b mac \u200b\u6709\u200b\u975e\u5e38\u200b\"\u200b\u5148\u8fdb\u200b\"\u200b\u7684\u200b Migration Assistant\uff0c\u200b\u80fd\u200b\u65e0\u7f1d\u200b\u590d\u5236\u200b\u6240\u6709\u200b\u7684\u200b\u914d\u7f6e\u200b\u5230\u200b\u65b0\u200b\u7684\u200b MacBook \u200b\u4e0a\u200b(\u200b\u5185\u5fc3\u200b os: \u200b\u54ce\u5440\u200b\u8fd9\u200b\u771f\u662f\u200b\u4e2a\u200b\u597d\u200b\u4e1c\u897f\u200b\uff0c\u200b\u770b\u6765\u200b\u4e0d\u7528\u200b\u81ea\u5df1\u200b\u518d\u200b\u914d\u7f6e\u200b\u4e00\u904d\u200b\u4e86\u200b)</p> <p>\u200b\u7136\u540e\u200b... \u200b\u4e0d\u51fa\u610f\u5916\u200b\u5730\u51fa\u200b\u4e86\u200b\u610f\u5916\u200b\uff0c\u200b\u6211\u200b\u7684\u200b mba \u200b\u7684\u200b Migration Assistant \u200b\u62bd\u98ce\u200b\u4e86\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u4e00\u200b\u8fdb\u5165\u200b\u5230\u200b\u9009\u62e9\u200b\u9875\u9762\u200b\u5c31\u662f\u200b\u5f7b\u5e95\u200b\u5361\u6b7b\u200b-&gt;\u200b\u9ed1\u5c4f\u200b-&gt;\u200b\u7b49\u5f85\u200b\u51e0\u5c0f\u65f6\u200b\u4f9d\u7136\u200b\u9ed1\u5c4f\u200b-&gt;\u200b\u91cd\u542f\u200b-&gt;\u200b\u91cd\u65b0\u542f\u52a8\u200b\u7a0b\u5e8f\u200b-&gt;\u200b\u5f7b\u5e95\u200b\u5361\u6b7b\u200b-&gt;....</p> <p>\u200b\u6211\u200b\u751a\u81f3\u200b\u6ca1\u6709\u200b\u5728\u200b\u7f51\u4e0a\u200b\u641c\u7d22\u200b\u5230\u200b\u4efb\u4f55\u200b\u4e00\u4f4d\u200b\u6709\u200b\u8ddf\u200b\u6211\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u5361\u6b7b\u200b\u53d7\u5bb3\u8005\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u65b9\u6cd5\u200b\u6bd4\u5982\u200b\u5c06\u200b\u7cfb\u7edf\u200b\u7248\u672c\u5347\u7ea7\u200b\u5230\u200b\u6700\u65b0\u7248\u200b\u90fd\u200b\u8bd5\u8fc7\u200b\u4e86\u200b\uff0c\u200b\u4f9d\u7136\u200b\u65e0\u6548\u200b\u3002</p> <p>\u200b\u603b\u4e4b\u200b\u653e\u5f03\u200b\u4e86\u200b\uff0c\u200b\u6b63\u597d\u200b\u4e00\u76f4\u200b\u60f3\u200b\u8ddf\u200b\u522b\u4eba\u200b\u63a8\u8350\u200b\u6211\u200b\u7684\u200b MacOS \u200b\u914d\u7f6e\u200b\uff0c\u200b\u800c\u4e14\u200b\u4e4b\u524d\u200b\u4f7f\u7528\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u8fd8\u662f\u200b\u62c9\u200b\u4e86\u200b\u5f88\u591a\u200b\u53f2\u200b\u5728\u200b\u81ea\u5df1\u200b\u7684\u200b\u7535\u8111\u200b\u91cc\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u501f\u6b64\u200b\u8bb0\u5f55\u200b\u4e00\u4e0b\u200b\u6211\u200b\u662f\u200b\u5982\u4f55\u200b\u4ece\u200b\u96f6\u200b\u914d\u7f6e\u200b\u6211\u200b\u7684\u200b MacOS \u200b\u7684\u200b\u5427\u200b\u3002</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#_2","title":"\u7cfb\u7edf\u200b\u8bbe\u7f6e","text":"<p>\u200b\u5f00\u542f\u200b\u4e09\u6307\u200b\u62d6\u62fd\u200b</p> <p></p> <p>\u200b\u5f00\u542f\u200b\u8f7b\u70b9\u200b</p> <p></p> <p>\u200b\u53bb\u6389\u200b\u52a8\u753b\u200b\u6548\u679c\u200b</p> <p></p> <p>\u200b\u81ea\u52a8\u9690\u85cf\u200b dock</p> <p></p> <p>\u200b\u7981\u7528\u200b\u6839\u636e\u200b\u6700\u8fd1\u200b\u4f7f\u7528\u200b\u91cd\u200b\u6392\u5e8f\u200b\u7a97\u53e3\u200b</p> <p></p> <p>finder \u200b\u9ed8\u8ba4\u200b\u6253\u5f00\u200b\u5728\u200b user \u200b\u6587\u4ef6\u5939\u200b (\u200b\u6253\u5f00\u200b finder \u200b\u7a97\u53e3\u200b\uff0c\u200b\u5de6\u4e0a\u89d2\u200b settings)</p> <p></p> <p>finder sidebar \u200b\u914d\u7f6e\u200b\uff0c\u200b\u6309\u200b\u81ea\u5df1\u200b\u559c\u6b22\u200b\u7684\u200b\u6765\u200b</p> <p></p> <p>Mac \u200b\u957f\u200b\u6309\u200b\u8fde\u7eed\u200b\u8f93\u5165\u200b (\u200b\u91cd\u542f\u200b\u751f\u6548\u200b)</p> Bash<pre><code>defaults write -g ApplePressAndHoldEnabled -bool false\n</code></pre> <p>\u200b\u7981\u7528\u200b\u952e\u76d8\u200b\u81ea\u52a8\u200b\u52a0\u200b\u53e5\u53f7\u200b</p> <p></p> <p></p> <p>\u200b\u952e\u76d8\u200b\u6309\u952e\u200b repeat \u200b\u62c9\u6ee1\u200b</p> <p></p> <p>\u200b\u6253\u5f00\u200b Terminal\uff0c\u200b\u8f93\u5165\u200b</p> Bash<pre><code>cd ~/Documents\nmkdir {Code,Dev-Tools,docker,Privacy,Resources}\nmkdir Code/{github.com,Java,Go,Python,vscode,FrontEnd,CS\\ Course}\n</code></pre> <p>\u200b\u8fd9\u200b\u662f\u200b\u6211\u200b\u559c\u6b22\u200b\u7684\u200b mac \u200b\u6587\u4ef6\u200b\u7ba1\u7406\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u6211\u200b\u7684\u200b mac \u200b\u7684\u200b\u684c\u9762\u4e0a\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u4efb\u4f55\u200b\u6587\u4ef6\u200b</p> <ul> <li>Code: \u200b\u5b58\u653e\u200b\u4ee3\u7801\u200b\u6587\u4ef6\u200b<ul> <li>github.com</li> <li>Java</li> <li>Go</li> <li>Python</li> <li>vscode</li> <li>FrontEnd</li> <li>CS Course</li> </ul> </li> <li>Dev-Tools\uff1a\u200b\u5f00\u53d1\u5de5\u5177\u200b\uff0c\u200b\u6bd4\u5982\u200b maven</li> <li>docker\uff1adocker-compose \u200b\u6587\u4ef6\u200b</li> <li>Privacy\uff1a\u200b\u9690\u79c1\u200b\u6587\u4ef6\u200b</li> <li>Resources\uff1a\u200b\u5b66\u4e60\u200b\u8d44\u6599\u200b</li> </ul> <p></p> <p>keyboard shortcuts \u200b\u4e2d\u200b\u6253\u5f00\u200b\u5feb\u6377\u952e\u200b\u5207\u6362\u200b\u684c\u9762\u200b\uff0c\u200b\u4f7f\u7528\u200b option+\u200b\u6570\u5b57\u952e\u200b\u5207\u6362\u200b (\u200b\u9700\u8981\u200b\u521b\u5efa\u200b\u591a\u4e2a\u200b\u684c\u9762\u200b\u624d\u200b\u4f1a\u200b\u6709\u200b\u9009\u9879\u200b)</p> <p></p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#_3","title":"\u7f51\u7edc","text":"<p>\u200b\u8fd9\u91cc\u200b\u4f7f\u7528\u200b <code>Clash Verge</code></p> <p>\u200b\u4f60\u200b\u8ddf\u200b\u6211\u200b\u8bf4\u200b\u8981\u200b VPN \u200b\u624d\u80fd\u200b\u53bb\u200b github \u200b\u4e0b\u200b clash\uff1f\u200b\u90a3\u200b\u4f60\u200b\u4e0b\u4e2a\u200b Clash \u200b\u554a\u200b ()</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#homebrew","title":"HomeBrew","text":"<p>\u200b\u6267\u884c\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8ddf\u7740\u200b\u914d\u7f6e\u200b\u5c31\u884c\u200b</p> Bash<pre><code>/bin/zsh -c \"$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)\"\n</code></pre>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#arc","title":"Arc","text":"<p>\u200b\u795e\u4e2d\u795e\u200b\uff01\u200b\u4e0b\u8f7d\u200b Arc \u200b\u6d4f\u89c8\u5668\u200b</p> <p>Download Arc</p> <p></p> <p>\u200b\u4e00\u4e9b\u200b\u5feb\u6377\u952e\u200b</p> <ul> <li><code>cmd + t</code> \uff1a\u200b\u6253\u5f00\u200b\u641c\u7d22\u200b\u6846\u200b\uff0c\u200b\u641c\u7d22\u200b\u6846\u5185\u200b\u8f93\u5165\u200b\u4e0d\u540c\u200b space \u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u627e\u5230\u200b <code>focus on space\u200b\u540d\u79f0\u200b</code> \u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\uff0c\u200b\u5373\u53ef\u200b\u5b9e\u73b0\u200b\u5207\u6362\u200b space \u200b\u6548\u679c\u200b</li> <li><code>cmd + shift + c</code> \uff1a\u200b\u590d\u5236\u200b\u5f53\u524d\u200b\u7f51\u7ad9\u200b\u94fe\u63a5\u200b</li> <li><code>cmd + shift + option + c</code> \uff1a\u200b\u4ee5\u200b md \u200b\u683c\u5f0f\u200b\u590d\u5236\u200b\u5f53\u524d\u200b\u7f51\u7ad9\u200b\u94fe\u63a5\u200b\uff0c\u200b\u540d\u5b57\u200b+\u200b\u94fe\u63a5\u200b</li> <li><code>cmd + s</code> \uff1a\u200b\u6253\u5f00\u200b/\u200b\u5173\u95ed\u200b\u4fa7\u8fb9\u200b\u680f\u200b</li> </ul>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#raycast","title":"Raycast","text":"<p>\u200b\u795e\u4e2d\u795e\u200b\uff01\u200b\u540a\u6253\u200b spotlight</p> <p>Raycast - Your shortcut to everything</p> <p>\u200b\u5b89\u88c5\u200b\u5b8c\u6bd5\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5728\u200b\u7cfb\u7edf\u200b\u8bbe\u7f6e\u200b\u7684\u200b keyboard shortcuts \u200b\u4e2d\u200b\u5173\u95ed\u200b spotlight</p> <p></p> <p>\u200b\u66f4\u6539\u200b raycast \u200b\u5feb\u6377\u952e\u200b</p> <p></p> <p></p> <p>\u200b\u540e\u7eed\u200b\u4e0b\u8f7d\u200b\u522b\u7684\u200b\u8f6f\u4ef6\u200b\u540e\u200b\u4f1a\u200b\u8fdb\u4e00\u6b65\u200b\u914d\u7f6e\u200b</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#_4","title":"\u5fae\u4fe1\u200b\u8f93\u5165\u6cd5","text":"<p>\u200b\u795e\u200b\uff01\u200b\u6bd4\u200b\u539f\u751f\u200b\u8f93\u5165\u6cd5\u200b\u597d\u7528\u200b\uff0c\u200b\u9009\u5b83\u200b\u4e3b\u8981\u200b\u662f\u200b\u6211\u200b\u8981\u200b\u914d\u7f6e\u200b\u4e00\u4e9b\u200b\u4e1c\u897f\u200b + \u200b\u8de8\u200b\u8bbe\u5907\u200b\u590d\u5236\u200b\u540c\u6b65\u200b</p> <p>\u200b\u5fae\u4fe1\u200b\u8f93\u5165\u6cd5\u200b-\u200b\u7b80\u6d01\u200b\u597d\u7528\u200b\u6253\u5b57\u200b\u5feb\u200b</p> <p></p> <p>\u200b\u73b0\u5728\u200b\u4f7f\u7528\u200b <code>control + space</code> \u200b\u6216\u8005\u200b <code>fn</code> \u200b\u5207\u6362\u200b\u8f93\u5165\u6cd5\u200b</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#karabiner-elements","title":"Karabiner-Elements","text":"<p>\u200b\u795e\u4e2d\u795e\u200b\uff01\u200b\u6539\u200b\u952e\u4f4d\u200b\u65e0\u654c\u200b\uff0c\u200b\u771f\u7684\u200b\u597d\u7528\u200b</p> <p>Karabiner-Elements</p> <p>\u200b\u5148\u200b\u628a\u200b mac \u200b\u5185\u7f6e\u200b\u952e\u76d8\u200b\u7684\u200b fn \u200b\u548c\u200b control \u200b\u8c03\u6362\u200b\u4e00\u4e0b\u200b\u4f4d\u7f6e\u200b (\u200b\u6211\u200b\u8bf4\u200b mac \u200b\u952e\u76d8\u200b\u8bbe\u8ba1\u200b\u771f\u662f\u200b\u4e00\u5768\u200b\uff0ccontrol \u200b\u653e\u200b\u90a3\u4e2a\u200b\u4f4d\u7f6e\u200b)</p> <p></p> <p>\u200b\u63a5\u7740\u200b\u8fdb\u884c\u200b\u590d\u6742\u200b\u7684\u200b\u952e\u4f4d\u200b\u6620\u5c04\u200b</p> <p></p> <ol> <li>\u200b\u6620\u5c04\u200b <code>cmd + shift</code> \u200b\u5230\u200b <code>control + space</code>\uff0c\u200b\u73b0\u5728\u200b\u5207\u6362\u200b\u8f93\u5165\u6cd5\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>cmd + shift</code> \u200b\u4e86\u200b</li> <li>\u200b\u6620\u5c04\u200b\u5927\u5199\u200b\u952e\u5230\u200b <code>cmd + shift + option + control</code> \uff0c\u200b\u5927\u5199\u200b\u952e\u200b\u73b0\u5728\u200b\u6ca1\u7528\u200b\u4e86\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u8f85\u52a9\u200b\u952e\u4f4d\u200b</li> <li>\u200b\u6620\u5c04\u200b\u5927\u5199\u200b\u952e\u200b + hjkl \u200b\u5230\u200b\u65b9\u5411\u952e\u200b\uff0cvim \u200b\u7528\u6237\u200b\u5e94\u8be5\u200b\u61c2\u200b\u8fd9\u4e2a\u200b\u7684\u200b\u542b\u91d1\u91cf\u200b\uff0c\u200b\u65e0\u654c\u200b\uff01</li> </ol> <p>\u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b</p> Text Only<pre><code>{\n    \"description\": \"Command + Shift to control + spacebar\",\n    \"manipulators\": [\n        {\n            \"from\": {\n                \"key_code\": \"left_shift\",\n                \"modifiers\": { \"mandatory\": [\"left_command\"] }\n            },\n            \"to\": [\n                {\n                    \"key_code\": \"spacebar\",\n                    \"modifiers\": [\"left_control\"]\n                }\n            ],\n            \"type\": \"basic\"\n        }\n    ]\n}\n</code></pre> Text Only<pre><code>{\n    \"description\": \"Change LeftShift+LeftCommand+LeftControl+LeftOption+hjkl to arrow keys\",\n    \"manipulators\": [\n        {\n            \"from\": {\n                \"key_code\": \"h\",\n                \"modifiers\": {\n                    \"mandatory\": [\"left_shift\", \"left_command\", \"left_control\", \"left_option\"],\n                    \"optional\": [\"any\"]\n                }\n            },\n            \"to\": [{ \"key_code\": \"left_arrow\" }],\n            \"type\": \"basic\"\n        },\n        {\n            \"from\": {\n                \"key_code\": \"j\",\n                \"modifiers\": {\n                    \"mandatory\": [\"left_shift\", \"left_command\", \"left_control\", \"left_option\"],\n                    \"optional\": [\"any\"]\n                }\n            },\n            \"to\": [{ \"key_code\": \"down_arrow\" }],\n            \"type\": \"basic\"\n        },\n        {\n            \"from\": {\n                \"key_code\": \"k\",\n                \"modifiers\": {\n                    \"mandatory\": [\"left_shift\", \"left_command\", \"left_control\", \"left_option\"],\n                    \"optional\": [\"any\"]\n                }\n            },\n            \"to\": [{ \"key_code\": \"up_arrow\" }],\n            \"type\": \"basic\"\n        },\n        {\n            \"from\": {\n                \"key_code\": \"l\",\n                \"modifiers\": {\n                    \"mandatory\": [\"left_shift\", \"left_command\", \"left_control\", \"left_option\"],\n                    \"optional\": [\"any\"]\n                }\n            },\n            \"to\": [{ \"key_code\": \"right_arrow\" }],\n            \"type\": \"basic\"\n        }\n    ]\n}\n</code></pre> Text Only<pre><code>{\n    \"manipulators\": [\n        {\n            \"description\": \"Change caps_lock to command+control+option+shift.\",\n            \"from\": {\n                \"key_code\": \"caps_lock\",\n                \"modifiers\": { \"optional\": [\"any\"] }\n            },\n            \"to\": [\n                {\n                    \"key_code\": \"left_shift\",\n                    \"modifiers\": [\"left_command\", \"left_control\", \"left_option\"]\n                }\n            ],\n            \"type\": \"basic\"\n        }\n    ]\n}\n</code></pre> <p>Karabiner-Elements \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u914d\u7f6e\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7981\u7528\u200b mac \u200b\u7684\u200b\u5185\u7f6e\u200b\u952e\u76d8\u200b\uff0c\u200b\u7136\u540e\u200b\u4f60\u200b\u7684\u200b\u5916\u7f6e\u200b\u952e\u76d8\u200b\u5c31\u200b\u80fd\u200b\u76f4\u63a5\u200b\u653e\u5728\u200b\u5185\u7f6e\u200b\u952e\u76d8\u200b\u4e0a\u200b\u4e86\u200b</p> <p></p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#raycast_1","title":"Raycast \u200b\u518d\u200b\u914d\u7f6e","text":"<p>\u200b\u5728\u200b\u521a\u521a\u200b\u8fdb\u884c\u200b\u4e86\u200b Karabiner-Elements \u200b\u7684\u200b\u914d\u7f6e\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u5df2\u7ecf\u200b\u5c06\u200b\u5927\u5199\u200b\u952e\u200b\u4f5c\u4e3a\u200b\u8f85\u52a9\u200b\u952e\u4f4d\u200b\u6620\u5c04\u200b\u5230\u200b\u4e86\u200b <code>cmd + shift + option + control</code> \uff0c\u200b\u6240\u4ee5\u200b\u6211\u200b\u53ef\u4ee5\u200b 100% \u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u6709\u200b\u952e\u4f4d\u200b\u51b2\u7a81\u200b</p> <p>\u200b\u8ba9\u200b\u6211\u4eec\u200b\u8f93\u5165\u200b <code>cmd + ,</code> \u200b\u6253\u5f00\u200b raycast \u200b\u7684\u200b settings\uff0c\u200b\u627e\u5230\u200b extensions</p> <p>\u200b\u8fd9\u91cc\u200b\u4ee5\u200b\u6211\u200b mba \u200b\u4e0a\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4ec5\u4f9b\u53c2\u8003\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6309\u200b\u4f60\u200b\u559c\u6b22\u200b\u7684\u200b\u6765\u200b</p> <p></p> <p>\u200b\u73b0\u5728\u200b\u5207\u6362\u200b\u7a97\u53e3\u200b\u5df2\u7136\u200b\u53d8\u5f97\u200b\u975e\u5e38\u200b\u4e1d\u6ed1\u200b\uff0c\u200b\u5e94\u7528\u200b\u4e4b\u95f4\u200b\u4f7f\u7528\u200b <code>CapsLock+\u200b\u5b57\u6bcd\u200b</code> \u200b\u8fdb\u884c\u200b\u5207\u6362\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u200b\u5207\u6362\u200b\u5230\u200b\u684c\u9762\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8bbf\u95ee\u200b finder\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u200b\u9700\u8981\u200b\u8f93\u5165\u200b <code>option+\u200b\u6570\u5b57\u200b</code> \u200b\u5373\u53ef\u200b</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#arc_1","title":"Arc \u200b\u518d\u200b\u914d\u7f6e","text":"<p>\u200b\u6539\u200b\u4e00\u4e2a\u200b\u952e\u4f4d\u200b\u5373\u53ef\u200b\uff0c\u200b\u6620\u5c04\u200b CapsLock + N \u200b\u5230\u200b\u6253\u5f00\u200b little arc window</p> <p></p> <p>\u200b\u4ec0\u4e48\u200b\u662f\u200b little arc window\uff1f</p> <p>\u200b\u8fd9\u200b\u4e1c\u897f\u200b\u7070\u5e38\u597d\u200b\u7528\u200b\u554a\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6211\u200b\u73b0\u5728\u200b\u5168\u5c4f\u200b\u7684\u200b obsidian \u200b\u7a97\u53e3\u200b\uff0c\u200b\u6211\u200b\u5e0c\u671b\u200b\u67e5\u8be2\u200b\u4e00\u4e2a\u200b\u4e1c\u897f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6253\u5f00\u200b\u5c0f\u200b\u7a97\u53e3\u200b\uff0c\u200b\u67e5\u5b8c\u200b cmd + w \u200b\u5173\u95ed\u200b\u5373\u53ef\u200b\uff0c\u200b\u975e\u5e38\u200b\u7684\u200b\u65b9\u4fbf\u200b</p> <p>rt</p> <p></p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#iterm2","title":"iterm2","text":"<p>iTerm2 - macOS Terminal Replacement</p> <p>shell \u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\u8bf7\u200b\u770b\u200b oh-my-zsh</p> <p>or \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5230\u200b\u6211\u200b\u7684\u200b dotfiles \u200b\u4ed3\u5e93\u200b LunaY-dotfiles \u200b\u627e\u5230\u200b zsh \u200b\u6587\u4ef6\u5939\u200b\u7684\u200b .zshrc</p> <p>\u200b\u628a\u200b\u6587\u4ef6\u200b mv \u200b\u5230\u200b ~ \u200b\u4e0b\u200b</p> <p>\u200b\u8bb0\u5f97\u200b\u5b89\u88c5\u200b\u5b57\u4f53\u200b\uff0c\u200b\u7136\u540e\u200b\u53bb\u200b iterm2 \u200b\u7684\u200b settings \u200b\u4e2d\u200b\u9009\u62e9\u200b hack-nerd-font</p> Bash<pre><code>brew install font-hack-nerd-font\n</code></pre>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#tmux","title":"tmux","text":"<p>tmux \u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b</p> Bash<pre><code>git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm\n</code></pre> Bash<pre><code>brew install tmux\ntmux\n</code></pre> <p>dotfiles \u200b\u4ed3\u5e93\u200b LunaY-dotfiles \u200b\u627e\u5230\u200b tmux \u200b\u6587\u4ef6\u5939\u200b\u4e0b\u200b\u7684\u200b <code>.tmux.conf</code></p> <p>\u200b\u7136\u540e\u200b mv \u200b\u5230\u200b ~ \u200b\u6587\u4ef6\u5939\u200b\u4e0b\u200b</p> <p>\u200b\u8f93\u5165\u200b</p> Bash<pre><code>tmux source ~/.tmux.conf\n</code></pre> <p>\u200b\u952e\u4f4d\u200b\u6620\u5c04\u200b\u5f88\u200b\u4e45\u200b\u4e4b\u524d\u200b\u914d\u200b\u7684\u200b\u4e86\u200b\uff0c\u200b\u8bf4\u200b\u4e0b\u200b\u6211\u200b\u5e38\u7528\u200b\u7684\u200b</p> <ul> <li>prefix: <code>control+z</code></li> <li>\u200b\u6c34\u5e73\u200b\u5207\u5206\u200b\u7a97\u53e3\u200b\uff1a<code>prefix + |</code></li> <li>\u200b\u5782\u76f4\u200b\u5207\u5206\u200b\u7a97\u53e3\u200b: <code>prefix + -</code></li> </ul>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#lazygit","title":"Lazygit","text":"<p>\u200b\u795e\u4e2d\u795e\u200b\uff01\u200b\u7528\u200b\u4e86\u200b\u90fd\u200b\u8bf4\u597d\u200b\uff0c\u200b\u7ec8\u7aef\u200b\u91cc\u200b\u7684\u200b git \u200b\u56fe\u5f62\u5316\u200b\u754c\u9762\u200b</p> Bash<pre><code>brew install lazygit\n</code></pre>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#snipaste","title":"Snipaste","text":"<p>\u200b\u795e\u200b\uff01\u200b\u622a\u56fe\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u82f9\u679c\u200b\u81ea\u5e26\u200b\u7684\u200b\u622a\u56fe\u200b\u4e5f\u200b\u662f\u200b\u4e00\u200b\u5768\u200b</p> <p>Snipaste - \u200b\u622a\u56fe\u200b + \u200b\u8d34\u56fe\u200b</p> <p>\u200b\u8fd9\u8fb9\u200b\u628a\u200b\u622a\u56fe\u200b\u5feb\u6377\u952e\u200b\u6620\u5c04\u200b\u5230\u200b<code>\u200b\u5927\u5199\u200b\u952e\u200b+1</code>\uff0c\u200b\u56e0\u4e3a\u200b\u6211\u200b\u7684\u200b\u952e\u76d8\u200b\u7684\u200b <code>f1</code> \u200b\u952e\u8981\u200b\u7528\u200b <code>fn+1</code> \u200b\u624d\u80fd\u200b\u6309\u200b\u51fa\u6765\u200b\u5f88\u200b\u4e0d\u200b\u65b9\u4fbf\u200b</p> <p></p> <p>\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b?</p> <ul> <li><code>\u200b\u5927\u5199\u200b\u952e\u200b+1</code>\uff1a\u200b\u5f00\u59cb\u200b\u622a\u56fe\u200b</li> <li><code>,</code>: \u200b\u4e0a\u200b\u4e00\u5f20\u200b\u622a\u56fe\u200b</li> <li><code>\u3002</code>\uff1a\u200b\u4e0b\u200b\u4e00\u5f20\u200b\u622a\u56fe\u200b</li> </ul>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#input-source-pro","title":"Input Source Pro","text":"<p>\u200b\u795e\u200b\uff01\u200b\u81ea\u52a8\u200b\u5207\u6362\u200b\u8f93\u5165\u6cd5\u200b</p> Bash<pre><code>brew install --cask input-source-pro\n</code></pre> <p>\u200b\u6216\u8005\u200b\u53bb\u200b\u5b98\u7f51\u200b\u4e0b\u8f7d\u200b</p> <p>Input Source Pro - \u200b\u81ea\u52a8\u200b\u5207\u6362\u200b\u8f93\u5165\u6cd5\u200b\u52a0\u4e0a\u200b\u9002\u65f6\u200b\u7684\u200b\u63d0\u793a\u200b\uff0c\u200b\u8ba9\u200b\u6bcf\u200b\u4e00\u6b21\u200b\u8f93\u5165\u200b\u90fd\u200b\u6e38\u5203\u6709\u4f59\u200b</p> <p>\u200b\u4e00\u4e9b\u200b\u914d\u7f6e\u200b</p> <p></p> <p></p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#dropover","title":"DropOver","text":"<p>\u200b\u4e00\u822c\u200b\u3002\u200b\u76f8\u5f53\u4e8e\u200b\u7ed9\u200b\u4f60\u200b\u4e00\u4e2a\u200b buffer \u200b\u590d\u5236\u7c98\u8d34\u200b\u6587\u4ef6\u200b</p> <p>\u200b\u4f46\u662f\u200b\uff01\u200b\u8fd9\u200b\u8f6f\u4ef6\u200b\u514d\u8d39\u7248\u200b\u79fb\u52a8\u200b\u6587\u4ef6\u200b\u5230\u200b buffer \u200b\u91cc\u200b\u8981\u200b\u5148\u200b\u7b49\u200b 3 \u200b\u79d2\u200b\uff0c\u200b\u5443\u200b\u5443\u200b</p> <p>\u200b\u4e0d\u8fc7\u200b\u8fd8\u662f\u200b\u5f88\u200b\u597d\u200b\u7528\u200b\u7684\u200b</p> <p>Dropover - Easier Drag and Drop on your Mac.</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#runcat","title":"RunCat","text":"<p>\u200b\u54c8\u57fa\u7c73\u200b\uff01\u200b\u6302\u200b\u53f3\u4e0a\u89d2\u200b\u770b\u200b\u7cfb\u7edf\u200b\u4fe1\u606f\u200b\u7684\u200b</p> <p>\u200b\u603b\u4e4b\u200b\u53ef\u7231\u200b\u5c31\u884c\u200b</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#picgo","title":"PicGo","text":"<p>\u200b\u795e\u4e2d\u795e\u200b\uff01\u200b\u65e0\u9700\u200b\u591a\u8a00\u200b</p> Bash<pre><code>brew install picgo --cask\n</code></pre>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#scroll-reverser","title":"Scroll Reverser","text":"<p>\u200b\u7ffb\u8f6c\u200b\u9f20\u6807\u200b\u6eda\u8f6e\u200b\u7528\u200b\u7684\u200b</p> <p>Scroll Reverser for macOS</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#idea","title":"idea","text":"<p>\u200b\u6211\u200b\u7684\u200b ideavim \u200b\u914d\u7f6e\u200b\uff1aideavimrc</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#vscode","title":"vscode","text":"Bash<pre><code>brew install --cask visual-studio-code\n</code></pre> <p>\u200b\u6211\u200b\u7684\u200b vscode + vscode vim \u200b\u914d\u7f6e\u200b\uff1avscode</p>","tags":["mac"]},{"location":"blog/2025/07/03/missing-semester-of-macos---a-vim-enthusiast-programmers-perspective/#neovim","title":"neovim","text":"<p>\u200b\u6211\u200b\u7684\u200b neovim \u200b\u914d\u7f6e\u200b\uff1aneovim</p>","tags":["mac"]},{"location":"blog/2025/09/29/ospp2025%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/","title":"OSPP2025 \u200b\u7ecf\u9a8c\u200b\u5206\u4eab","text":"<p> \u200b\u7ea6\u200b 6079 \u200b\u4e2a\u200b\u5b57\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 20 \u200b\u5206\u949f\u200b</p> <p>\u200b\u4e86\u89e3\u200b\u5230\u200b OSPP \u200b\u7684\u200b\u5951\u673a\u200b\u662f\u200b\u901a\u8fc7\u200b\u5b66\u6821\u200b\u5de5\u4f5c\u5ba4\u200b\uff0c\u200b\u5de5\u4f5c\u5ba4\u200b\u7684\u200b\u5b66\u957f\u200b\u59d0\u5728\u200b\u53bb\u5e74\u200b\u7684\u200b OSPP \u200b\u7533\u8bf7\u200b\u4e2d\u200b\u6210\u679c\u200b\u9887\u4e30\u200b\uff0c\u200b\u770b\u7740\u200b\u5b66\u957f\u200b\u59d0\u200b\u4e2d\u9009\u200b\u7684\u200b\u9879\u76ee\u200b\u4e00\u4e2a\u4e2a\u200b\u90fd\u200b\u975e\u5e38\u200b\u7684\u200b\u9ad8\u5927\u200b\u4e0a\u200b\uff0c\u200b\u8ba9\u200b\u6211\u200b\u975e\u5e38\u200b\u773c\u7ea2\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f53\u65f6\u200b\u7684\u200b\u6211\u200b\u5e76\u4e0d\u77e5\u9053\u200b\u5e94\u8be5\u200b\u600e\u4e48\u200b\u53bb\u200b\u53c2\u52a0\u200b\u5f00\u6e90\u200b\uff0c\u200b\u600e\u4e48\u200b\u53bb\u200b\u627e\u200b issue \u200b\u53bb\u200b\u505a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bf4\u200b\u5728\u200b\u4eca\u5e74\u200b\u6b63\u5f0f\u200b\u53c2\u52a0\u200b OSPP \u200b\u4e4b\u524d\u200b\uff0c\u200b\u6211\u200b\u662f\u200b\u4e00\u4f4d\u200b\u5b8c\u5168\u200b\u96f6\u200b\u7ecf\u9a8c\u200b\u7684\u200b\u5f00\u6e90\u200b\u5c0f\u767d\u200b\uff0c\u200b\u53ea\u6709\u200b git \u200b\u548c\u200b github \u200b\u7684\u200b\u57fa\u7840\u200b\u4f7f\u7528\u200b\u7ecf\u9a8c\u200b\u3002</p> <p>\u200b\u5728\u200b\u4eca\u5e74\u200b\u7684\u200b 5 \u200b\u6708\u4efd\u200b\uff0cOSPP \u200b\u7684\u200b\u9879\u76ee\u200b\u5f00\u59cb\u200b\u9010\u6b65\u200b\u653e\u51fa\u200b\uff0c\u200b\u6211\u200b\u9009\u9879\u200b\u76ee\u7684\u200b\u4e3b\u9898\u200b\u662f\u200b\u8ddf\u200b AI Agent \u200b\u6709\u5173\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u4e3b\u8981\u200b\u662f\u4ece\u200b\u529f\u5229\u200b\u7684\u200b\u89d2\u5ea6\u200b\u53bb\u200b\u9009\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4eca\u5e74\u200b AI Agent \u200b\u975e\u5e38\u200b\u7684\u200b\u706b\u7206\u200b\uff0c\u200b\u521d\u6b65\u200b\u951a\u5b9a\u200b\u7684\u200b\u662f\u200b\u6d77\u7acb\u200b\u8001\u5e08\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u9879\u76ee\u200b\u76ee\u6807\u200b\u662f\u200b\u7528\u200b langgraph \u200b\u6784\u5efa\u200b k8s \u200b\u7684\u200b\u95ee\u7b54\u200b\u667a\u80fd\u200b\u4f53\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u6c9f\u901a\u200b\u4e86\u200b\u4e24\u5468\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6211\u200b\u89c9\u5f97\u200b\u8fd9\u4e2a\u200b\u9879\u76ee\u200b\u5176\u5b9e\u200b\u4e0d\u592a\u200b\u9002\u5408\u200b\u6211\u200b\uff0c\u200b\u9996\u5148\u200b\u56e0\u4e3a\u200b\u9879\u76ee\u200b\u4e3b\u529b\u200b\u8bed\u8a00\u200b\u662f\u200b python \u200b\u53bb\u200b\u642d\u200b agent\uff0c\u200b\u540c\u65f6\u200b\u8fd8\u8981\u200b\u5199\u200b\u524d\u7aef\u200b\u9875\u9762\u200b\uff0c\u200b\u6211\u200b\u4e00\u76f4\u200b\u4ee5\u6765\u200b\u90fd\u200b\u662f\u200b\u5199\u200b java \u200b\u7684\u200b\uff0c\u200b\u53bb\u200b\u4ece\u200b\u96f6\u200b\u5b66\u4e60\u200b\u4e24\u4e2a\u200b\u65b0\u200b\u7684\u200b\u9886\u57df\u200b\u5e76\u200b\u5728\u200b\u4e00\u4e2a\u6708\u200b\u5185\u200b\u5199\u51fa\u200b\u65b9\u6848\u200b\u5bf9\u4e8e\u200b\u6211\u200b\u6765\u8bf4\u200b\u96be\u5ea6\u200b\u6709\u70b9\u200b\u592a\u5927\u200b\u4e86\u200b\uff0c\u200b\u800c\u4e14\u200b\u5728\u200b\u5199\u200b\u7533\u8bf7\u4e66\u200b\u7684\u200b\u540c\u65f6\u200b\u8fd8\u200b\u5728\u200b\u627e\u200b\u5b9e\u4e60\u200b\uff0c\u200b\u5b9e\u5728\u200b\u9876\u4e0d\u4f4f\u200b\u538b\u529b\u200b\uff0c\u200b\u5c31\u200b\u51b3\u5b9a\u200b\u6362\u200b\u9879\u76ee\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5927\u6982\u200b\u662f\u200b 5 \u200b\u6708\u200b\u4e2d\u65ec\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6253\u7b97\u200b\u5c06\u200b\u76ee\u6807\u200b\u9879\u76ee\u200b\u66f4\u6362\u200b\u4e3a\u200b java \u200b\u4e2d\u200b\u7684\u200b ai \u200b\u9879\u76ee\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6211\u200b\u672c\u8eab\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5f00\u6e90\u200b\u9879\u76ee\u200b\u7684\u200b\u8d21\u732e\u200b\u7ecf\u9a8c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5e76\u200b\u4e0d\u200b\u8003\u8651\u200b Apache \u200b\u76f8\u5173\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u5377\u5ea6\u200b\u592a\u9ad8\u200b\uff0c\u200b\u6700\u7ec8\u200b\u9009\u62e9\u200b\u4e86\u200b LiteFlow \u200b\u8fd9\u4e2a\u200b\u793e\u533a\u200b\u4f5c\u4e3a\u200b\u6211\u200b\u7684\u200b\u7533\u8bf7\u200b\u9879\u76ee\u200b\u3002</p> <p>5 \u200b\u6708\u200b\u53ef\u4ee5\u200b\u8bf4\u200b\u662f\u200b\u6211\u200b\u76f8\u5bf9\u200b\u6700\u5fd9\u200b\u7684\u200b\u4e00\u6708\u200b\uff0c\u200b\u4e00\u8fb9\u200b\u5fd9\u200b\u7740\u200b\u627e\u200b\u5b9e\u4e60\u200b\uff0c\u200b\u4e00\u8fb9\u200b\u64b0\u5199\u200b OSPP \u200b\u7684\u200b\u5f00\u6e90\u200b\u7533\u8bf7\u4e66\u200b\uff0c\u200b\u540c\u65f6\u200b\u8fd8\u8981\u200b\u517c\u987e\u200b\u5b66\u6821\u200b\u7684\u200b\u8bfe\u7a0b\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u6700\u7ec8\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u6bd4\u8f83\u200b\u559c\u4eba\u200b\u7684\u200b\uff0c\u200b\u5728\u200b 5 \u200b\u6708\u200b\u4e2d\u4e0b\u65ec\u200b\u62ff\u5230\u200b\u4e86\u200b\u4e00\u5bb6\u200b AI \u200b\u521d\u521b\u200b\u7684\u200b offer\uff0c\u200b\u5728\u200b\u62ff\u5230\u200b offer \u200b\u540e\u200b\u5c31\u200b\u4e0d\u200b\u6253\u7b97\u200b\u7ee7\u7eed\u200b\u627e\u200b\u4e86\u200b\uff0c\u200b\u4e00\u65b9\u9762\u200b\u662f\u200b\u8fd9\u5bb6\u200b\u521d\u521b\u200b\u7ed9\u200b\u7684\u200b\u5b9e\u5728\u200b\u592a\u591a\u200b\u4e86\u200b\uff0c\u200b\u6bd4\u200b\u5927\u5382\u200b\u540e\u7aef\u200b\u6700\u200b\u9ad8\u6863\u200b\u7684\u200b\u8fd8\u8981\u200b\u9ad8\u200b\u4e00\u6863\u200b\uff0c\u200b\u53e6\u4e00\u65b9\u9762\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5168\u8eab\u5fc3\u200b\u6295\u5165\u200b\u5230\u200b OSPP \u200b\u7533\u8bf7\u4e66\u200b\u7684\u200b\u64b0\u5199\u200b\u4e2d\u200b\uff0c\u200b\u4e8b\u5b9e\u8bc1\u660e\u200b\u6211\u200b\u7684\u200b\u9009\u62e9\u200b\u8fd8\u200b\u633a\u200b\u6b63\u786e\u200b\u7684\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u4e00\u8d77\u200b\u770b\u770b\u200b\u6211\u200b\u7684\u200b\u7533\u8bf7\u200b\u5168\u8fc7\u7a0b\u200b</p>","tags":["ospp"]},{"location":"blog/2025/09/29/ospp2025%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/#509-616","title":"5.09 - 6.16 \u200b\u5957\u200b\u78c1\u200b\u4e0e\u200b\u7533\u8bf7\u4e66\u200b\u64b0\u5199","text":"<p>\u200b\u9996\u5148\u200b\u5fc5\u987b\u200b\u8981\u200b\u660e\u786e\u200b\u7684\u200b\u4e00\u70b9\u200b\u662f\u200b\uff0c\u200b\u5957\u200b\u78c1\u200b\u5f88\u200b\u91cd\u8981\u200b\uff01\u200b\u5fc5\u987b\u200b\u79ef\u6781\u200b\u7684\u200b\u548c\u200b\u5bfc\u5e08\u200b\u8fdb\u884c\u200b\u90ae\u4ef6\u200b\u6c9f\u901a\u200b\uff0c\u200b\u5982\u679c\u200b\u80fd\u52a0\u200b\u5230\u200b\u5fae\u4fe1\u200b\u5c31\u200b\u66f4\u597d\u200b\u4e86\u200b\u3002</p> <p>\u200b\u7533\u8bf7\u4e66\u200b\u64b0\u5199\u200b\u6211\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u98de\u4e66\u200b\u6587\u6863\u200b\uff0c\u200b\u5728\u200b\u98de\u4e66\u200b\u6587\u6863\u200b\u4e0a\u200b\u4e66\u5199\u200b\u5b8c\u6bd5\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b\u98de\u200b\u4e66\u200b\u81ea\u5e26\u200b\u7684\u200b\u5bfc\u51fa\u200b\u6210\u200b pdf \u200b\u529f\u80fd\u200b\u5bfc\u51fa\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u4eca\u5e74\u200b OSPP \u200b\u7684\u200b\u9879\u76ee\u200b\u7533\u8bf7\u200b\u53ea\u80fd\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u4e86\u200b\uff0c\u200b\u5f88\u591a\u200b\u9879\u76ee\u200b\u5230\u200b\u540e\u671f\u200b\u751a\u81f3\u200b\u6ca1\u200b\u4eba\u9009\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e3b\u529e\u65b9\u200b\u5c06\u200b\u9879\u76ee\u200b\u7533\u8bf7\u200b\u65f6\u95f4\u200b\u5ef6\u957f\u200b\u4e86\u200b\u4e24\u5468\u200b\uff0c\u200b\u5f53\u65f6\u200b\u770b\u7740\u200b\u6211\u200b\u7533\u8bf7\u200b\u7684\u200b\u9879\u76ee\u200b\u70ed\u5ea6\u200b\u4e00\u70b9\u4e00\u70b9\u200b\u63d0\u9ad8\u200b\uff0c\u200b\u7ed9\u200b\u6211\u200b\u5413\u200b\u5f97\u200b\u4e0d\u8f7b\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u6211\u200b\u7684\u200b\u5957\u200b\u78c1\u200b\u90ae\u4ef6\u200b\u4e0e\u200b\u5bfc\u5e08\u200b\u56de\u590d\u200b\uff1a</p> <ol> <li>2025-05-19</li> </ol> Text Only<pre><code>\u200b\u6211\u200b\u770b\u200b\u4e86\u200b\u4f60\u200b\u7684\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u6587\u6863\u200b\u3002\n\n\n\u200b\u5bf9\u4e8e\u200bLiteFlow\u200b\u5e94\u8be5\u200b\u662f\u200b\u770b\u8fc7\u200b\u4e00\u4e9b\u200b\u6e90\u4ee3\u7801\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bf9\u200bDify\u200b\u662f\u200b\u6709\u200b\u8fc7\u200b\u81ea\u5df1\u200b\u7684\u200b\u5b9e\u8df5\u200b\u548c\u200b\u601d\u8003\u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\u65b9\u5411\u200b\u3002\n\n\n\u200b\u6211\u200b\u8bf4\u200b\u4e0b\u200b\u6211\u200b\u7684\u200b\u60f3\u6cd5\u200b\u548c\u200b\u4e00\u4e9b\u200b\u91cd\u70b9\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u81ea\u884c\u200b\u770b\u4e0b\u200b\u4f60\u200b\u7684\u200b\u7533\u8bf7\u4e66\u200b\u8fd8\u200b\u7f3a\u5931\u200b\u4e86\u200b\u54ea\u4e9b\u200b\n\n\n1. LF\u200b\u7684\u200b\u6838\u5fc3\u200b\u5c31\u200b\u56db\u5927\u5757\u200b\uff0c \u200b\u89c4\u5219\u200b\u5982\u4f55\u200b\u89e3\u6790\u200b\uff0c\u200b\u811a\u672c\u200b\u5982\u4f55\u200b\u89e3\u6790\u200b\uff0c\u200b\u5982\u4f55\u200b\u6267\u884c\u200b\u7684\u200b\uff0c\u200b\u5b58\u50a8\u200b\u63d2\u4ef6\u200b\u5982\u4f55\u200b\u505a\u5230\u200b\u70ed\u200b\u66f4\u65b0\u200b\u89c4\u5219\u200b/\u200b\u811a\u672c\u200b(\u200b\u5b58\u50a8\u200b\u63d2\u4ef6\u200b\u53ea\u200b\u770b\u200bSQL\u200b\u5373\u53ef\u200b\uff09\uff0c\u200b\u8fd9\u90e8\u5206\u200b\u9700\u8981\u200b\u7ec6\u770b\u200b\uff0c\u200b\u539f\u7406\u200b\u8981\u200b\u9610\u8ff0\u200b\u3002\u200b\u8fd9\u200b\u76f8\u5f53\u4e8e\u200bLF\u200b\u7684\u200b\u6574\u4e2a\u200b\u9aa8\u67b6\u200b\u3002\u200b\u9610\u8ff0\u200b\u8981\u200b\u7cbe\u70bc\u200b\uff0c\u200b\u4e0d\u7528\u200b\u8d34\u200b\u5927\u91cf\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5173\u952e\u200b\u90e8\u5206\u200b\u6307\u51fa\u200b\u6765\u200b\u5373\u53ef\u200b\u3002\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u8003\u91cf\u200b\u5b66\u751f\u200b\u5bf9\u200bLF\u200b\u6e90\u4ee3\u7801\u200b\u7406\u89e3\u200b\u7684\u200b\u80fd\u529b\u200b\u3002\n\n2. LF\u200b\u548c\u200b\u5927\u200b\u6a21\u578b\u200b\u7ed3\u5408\u200b\uff0c\u200b\u5176\u5b9e\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u8fd8\u662f\u200b\u5982\u4f55\u200b\u8c03\u7528\u200b\u5927\u200b\u6a21\u578b\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u6765\u200b\u66f4\u200b\u65b9\u4fbf\u200b\u7684\u200b\u63d0\u4f9b\u200b\u5f00\u53d1\u8005\u200b\u5f00\u7bb1\u200b\u5373\u7528\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u4e0d\u7528\u200b\u5f00\u53d1\u8005\u200b\u81ea\u5df1\u200b\u53bb\u200b\u5199\u200b\u5927\u200b\u6a21\u578b\u200b\u7ec4\u4ef6\u200b\u3002LF\u200b\u5b98\u65b9\u200b\u5c31\u200b\u4e3a\u200b\u4e4b\u200b\u5c01\u88c5\u200b\u597d\u200b\u4e00\u4e9b\u200b\u73b0\u6210\u200b\u7684\u200b\u63d2\u4ef6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u3002\n\n3. \u200b\u5173\u4e8e\u200bLF\u200b\u5982\u4f55\u200b\u8c03\u7528\u200b\u5927\u200b\u6a21\u578b\u200b\uff0c\u200b\u5176\u5b9e\u200b\u65e0\u975e\u200b\u5c31\u662f\u200bLF\u200b\u5c01\u88c5\u200b\u4e00\u4e9b\u200b\u4e0e\u200b\u5927\u200b\u6a21\u578b\u200b\u4ea4\u4e92\u200b\u7684\u200b\u63d2\u4ef6\u200b\u3002\u200b\u5982\u4f55\u200b\u5c01\u88c5\u200b\uff0c\u200b\u6d89\u53ca\u200b\u5982\u4f55\u200b\u9009\u578b\u200b\u5927\u200b\u6a21\u578b\u200b\u7684\u200bClient\uff0c\u200b\u9009\u578b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u65b9\u9762\u200b\u3002\u200b\u6bd4\u5982\u8bf4\u200bspring-ai, langchain4j\u200b\u7b49\u7b49\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8be6\u7ec6\u200b\u4e86\u89e3\u200b\u4e0b\u200b\u540e\u8005\u200b\u3002\u200b\u9009\u578b\u200b\u5b9a\u200b\u4e86\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5b9e\u73b0\u200b\u65e0\u975e\u200b\u5c31\u662f\u200b\u8c03\u7528\u200b\u8fd9\u4e9b\u200b\u5de5\u5177\u200b\u53bb\u200b\u548c\u200b\u5927\u200b\u6a21\u578b\u200b\u5e73\u53f0\u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b\u3002\u200b\u5f88\u591a\u200b\u80fd\u529b\u200b\u90fd\u200b\u662f\u200b\u5927\u200b\u6a21\u578b\u200b\u5e73\u53f0\u200b\u76f4\u63a5\u200b\u63d0\u4f9b\u200b\u7684\u200b\uff0c\u200b\u6211\u4eec\u200b\u5148\u200b\u76f4\u63a5\u200b\u5bf9\u63a5\u200b\u5927\u200b\u6a21\u578b\u200b\u5e73\u53f0\u200b\u7684\u200b\u80fd\u529b\u200b\u3002\u200b\u4e0d\u200b\u8003\u8651\u200b\u81ea\u5df1\u200b\u672c\u5730\u200b\u53bb\u5411\u200b\u91cf\u5316\u200b\uff0c\u200b\u5bf9\u63a5\u200b\u672c\u5730\u200b\u7684\u200b\u5411\u91cf\u200b\u6570\u636e\u5e93\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u8003\u8651\u200b\u81ea\u5df1\u200b\u53bb\u200b\u5b58\u50a8\u200b\u8bb0\u5fc6\u4f53\u200b\u3002\n\n4. \u200b\u9700\u8981\u200b\u5bf9\u63a5\u200b\u54ea\u4e9b\u200b\u5927\u200b\u6a21\u578b\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u54ea\u4e9b\u200b\u5927\u200b\u6a21\u578b\u200b\u5e73\u53f0\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u9700\u8981\u200b\u601d\u8003\u200b\u4e0b\u200b\uff0c\u200b\u5f53\u7136\u200b\u4e5f\u200b\u8981\u200b\u548c\u200b\u7b2c\u200b3\u200b\u70b9\u200b\u7ed3\u5408\u200b\u8d77\u6765\u200b\u601d\u8003\u200b\u3002\u200b\u5f53\u7136\u200b\u4e0d\u7528\u200b\u5927\u800c\u5168\u200b\uff0c\u200b\u5927\u800c\u5168\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u662f\u200b\u597d\u200b\u7684\u200b\uff0c\u200b\u9aa8\u67b6\u200b\u6253\u200b\u7ed3\u5b9e\u200b\uff0c\u200b\u540e\u9762\u200b\u6269\u5c55\u200b\u4e5f\u200b\u662f\u200b\u975e\u5e38\u5bb9\u6613\u200b\u7684\u200b \u3002\u200b\u6bd5\u7adf\u200b\u6211\u4eec\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5f00\u6e90\u200b\u6846\u67b6\u200b\uff0c\u200b\u5f00\u6e90\u200b\u5c31\u200b\u610f\u5473\u7740\u200b\u9700\u8981\u200b\u4e0d\u65ad\u200b\u8fed\u4ee3\u200b\u3002\n\n5. \u200b\u5047\u8bbe\u200b\u6211\u4eec\u200b\u5df2\u7ecf\u200b\u5b9a\u4e49\u200b\u597d\u200b\u4e86\u200b\u5404\u79cd\u200bAI\u200b\u7ec4\u4ef6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f7f\u7528\u8005\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u3002\u200b\u6211\u200b\u5e0c\u671b\u200b\u7684\u200b\u662f\u200b\u5f00\u7bb1\u200b\u5373\u7528\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u5f00\u53d1\u8005\u200b\u65e0\u9700\u200b\u81ea\u5df1\u200b\u518d\u200b\u53bb\u200b\u5199\u7c7b\u200b\u53bb\u200b\u96c6\u6210\u200b\u3002\u200b\u5c31\u200b\u5982\u540c\u200bdify\u200b\u4e00\u6837\u200b\uff0cdify\u200b\u662f\u200b\u62d6\u200b\u4e00\u4e2a\u200b\u7ec4\u4ef6\u200b\u5230\u200b\u753b\u5e03\u200b\u4e0a\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u753b\u5e03\u200b\u4e0a\u200b\u9009\u62e9\u200b\u6a21\u578b\u200b\uff0c\u200b\u586b\u5199\u200b\u53c2\u6570\u200b\u3002LF\u200b\u662f\u200b\u540e\u200b\u7aef\u200b\u7248\u672c\u200b\u7684\u200bdify\uff0c\u200b\u867d\u7136\u200b\u6ca1\u6709\u200b\u754c\u9762\u200b\u3002\u200b\u4f46\u662f\u200b\u4f7f\u7528\u200b\u65b9\u9762\u200b\u5e94\u8be5\u200b\u548c\u200bdify\u200b\u5e94\u8be5\u200b\u5982\u51fa\u4e00\u8f99\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5728\u200b\u7f16\u6392\u200b\u4e2d\u5199\u200b\u5df2\u7ecf\u200b\u5b9a\u4e49\u200b\u597d\u200b\u7684\u200b\u7ec4\u4ef6\u200b\u3002\u200b\u90a3\u200b\u6700\u200b\u5173\u952e\u200b\u7684\u200b\u4e00\u70b9\u200b\u6765\u200b\u4e86\u200b\uff1a\u200b\u5982\u4f55\u200b\u53bb\u200b\u5b9a\u4e49\u200b\u5404\u4e2a\u200b\u7ec4\u4ef6\u200b\u4e0a\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5982\u4f55\u200b\u6807\u51c6\u5316\u200b\u8fd9\u4e9b\u200b\u53c2\u6570\u200b\uff0c\u200b\u54ea\u4e9b\u200b\u53c2\u6570\u200b\u7684\u200bscope\u200b\u4e3a\u200b\u516c\u5171\u200b\u53c2\u6570\u200b\uff0c\u200b\u54ea\u4e9b\u200b\u53c2\u6570\u200b\u7684\u200bscope\u200b\u4e3a\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7ec4\u4ef6\u200b\u7684\u200b\u53c2\u6570\u200b\uff1f\u200b\u73b0\u6709\u200bLF\u200b\u4f53\u7cfb\u200b\u4e2d\u200b\u7684\u200b\u89c4\u5219\u200b\u53c2\u6570\u200b\u8bbe\u5b9a\u200b\u6709\u200b\u54ea\u4e9b\u200b\uff1f\u200b\u6ee1\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u8fd9\u6b21\u200b\u8bfe\u9898\u200b\u4e2d\u200b\u7684\u200bai\u200b\u7ec4\u4ef6\u200b\u7684\u200b\u9700\u6c42\u200b\uff1f\u200b\u5982\u679c\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u5e94\u8be5\u200b\u5728\u200bLF\u200b\u539f\u6709\u200b\u4f53\u7cfb\u200b\u4e2d\u200b\u505a\u51fa\u200b\u4ec0\u4e48\u6837\u200b\u7684\u200b\u6539\u53d8\u200b\uff1f(\u200b\u8fd9\u200b\u4e00\u4e2a\u200b\u5927\u70b9\u200b\u624d\u200b\u662f\u200b\u8fd9\u6b21\u200b\u8bfe\u9898\u200b\u4e2d\u200b\u6700\u200b\u91cd\u8981\u200b\u6700\u200b\u91cd\u8981\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5173\u7cfb\u200b\u7740\u200b\u4f7f\u7528\u8005\u200b\u8be5\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u6700\u7ec8\u200b\u548c\u200b\u73b0\u6709\u200bLF\u200b\u4f53\u7cfb\u200b\u7ed3\u5408\u200b\u7684\u200b\u5f62\u6001\u200b\uff09\n\n6. \u200b\u8003\u8651\u200b\u5b8c\u200b\u4e86\u200b\u7b2c\u200b5\u200b\u70b9\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5165\u53c2\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u8981\u200b\u8003\u8651\u200b\u6bcf\u4e2a\u200bai\u200b\u7ec4\u4ef6\u200b\u7684\u200b\u51fa\u200b\u53c2\u200b\u8bbe\u8ba1\u200b\u3002LF\u200b\u5929\u7136\u200b\u7684\u200b\u6709\u200b\u4e0a\u4e0b\u6587\u200b\uff0c\u200b\u800c\u4e14\u200b\u4e0a\u4e0b\u6587\u200b\u529f\u80fd\u200b\u7279\u522b\u200b\u5f3a\u5927\u200b\u3002\u200b\u5982\u4f55\u200b\u52a0\u4ee5\u200b\u8fd0\u7528\u200b\uff1f\u200b\u5e76\u4e14\u200b\u5982\u4f55\u200b\u5728\u200b\u8868\u8fbe\u5f0f\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\u540e\u200b\u4e00\u4e2a\u200bai\u200b\u7ec4\u4ef6\u200b\u7684\u200b\u5165\u200b\u53c2\u200b\u5f15\u7528\u200b\u524d\u200b\u4e00\u4e2a\u200bai\u200b\u7ec4\u4ef6\u200b\u7684\u200b\u51fa\u200b\u53c2\u200b\u3002\u200b\u8fd9\u200b\u5c31\u662f\u200b\u51fa\u5165\u200b\u53c2\u200b\u7ed1\u5b9a\u200b\u8bbe\u8ba1\u200b\u3002\n\n7. \u200b\u6700\u540e\u200b\u5219\u200b\u9700\u8981\u200b\u8003\u8651\u200b\uff0c\u200b\u73b0\u6709\u200b\u7684\u200b\u7f16\u6392\u200b\u65b9\u5f0f\u200b\u662f\u5426\u200b\u6ee1\u8db3\u200b\u8fd9\u6b21\u200b\u8bfe\u9898\u200b\uff0c\u200b\u9700\u4e0d\u9700\u8981\u200b\u589e\u52a0\u200b\u65b0\u200b\u7684\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u6211\u200b\u4e3e\u4f8b\u8bf4\u660e\u200b\uff1a\u200b\u6709\u4e9b\u200b\u5927\u200b\u6a21\u578b\u200b\u5e73\u53f0\u200b\u6709\u79cd\u200bai\u200b\u7ec4\u4ef6\u200b\u53eb\u505a\u200b\u610f\u56fe\u200b\u5206\u7c7b\u200b\u7684\u200b\u3002\u200b\u90a3\u4e48\u200b\u610f\u56fe\u200b\u5206\u7c7b\u200b\u5728\u200bLF\u200b\u4e0a\u7528\u200b\u4ec0\u4e48\u200b\u8868\u8fbe\u5f0f\u200b\u6765\u200b\u8868\u8fbe\u200b\uff1f\u200b\u7b2c\u4e00\u200b\u60f3\u5230\u200b\u7684\u200b\u80af\u5b9a\u200b\u662f\u200bSWITCH\uff0c\u200b\u4f46\u662f\u200bSWITCH\u200b\u662f\u200b\u5355\u9009\u200b\uff0c\u200b\u800c\u200b\u5f88\u591a\u200b\u5927\u200b\u6a21\u578b\u200b\u7684\u200b\u610f\u56fe\u200b\u662f\u200b\u591a\u9009\u200b\uff0c\u200b\u90a3\u4e48\u200b\u662f\u4e0d\u662f\u200b\u8981\u200b\u652f\u6301\u200bSWITCH\u200b\u7684\u200b\u591a\u9009\u200b\u7279\u6027\u200b\u5462\u200b\uff1f\u200b\u8fd9\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u9700\u8981\u200b\u81ea\u5df1\u200b\u601d\u8003\u200b\u8fd9\u6b21\u200b\u8bfe\u9898\u200b\u6709\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u9700\u8981\u200b\u6269\u5c55\u200b\u8868\u8fbe\u5f0f\u200b\u7684\u200b\u573a\u666f\u200b\u3002\n\n\n\n\u200b\u5176\u5b9e\u200b\u8fd9\u6b21\u200b\u8bfe\u9898\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u70b9\u200b\u975e\u5e38\u200b\u591a\u200b\uff0c\u200b\u8981\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u5b8c\u6210\u200b\u8fd9\u6b21\u200b\u8bfe\u9898\u200b\u9700\u8981\u200b\u524d\u671f\u200b\u6295\u5165\u200b\u5927\u91cf\u200b\u7684\u200b\u601d\u8003\u200b\u548c\u200b\u8bbe\u8ba1\u200b\u3002\u200b\u5f88\u591a\u200b\u529f\u80fd\u200b\u9700\u8981\u200b\u548c\u200bLF\u200b\u672c\u8eab\u200b\u7ed3\u5408\u200b\u3002\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u82b1\u200b\u5927\u91cf\u200b\u7684\u200b\u7cbe\u529b\u200b\u53bb\u200b\u7814\u8bfb\u200b\u6e90\u7801\u200b\u3002\n\nLF\u200b\u672c\u8eab\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u975e\u5e38\u200b\u9971\u6ee1\u200b\uff0c\u200b\u800c\u4e14\u200b\u4e5f\u200b\u5728\u200b\u4e0d\u505c\u200b\u7684\u200b\u8fed\u4ee3\u200b\u3002\n\n\n\u200b\u65e2\u7136\u200b\u662f\u200b\u548c\u200bAI\u200b\u6709\u5173\u200b\uff0c\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ed3\u5408\u200bAI\u200b\u6765\u200b\u8f85\u52a9\u200b\u4f60\u200b\u5206\u6790\u200b\u6e90\u7801\u200b\uff0c\u200b\u53bb\u200b\u5f04\u61c2\u200b\u5b83\u200b\u3002\u200b\u4f46\u662f\u200b\u5f97\u200b\u786e\u4fdd\u200b\uff0c\u200b\u4f60\u200b\u662f\u200b\u771f\u7684\u200b\u7406\u89e3\u200b\u4e86\u200b\u6e90\u7801\u200b\u5e76\u200b\u62e5\u6709\u200b\u5bf9\u4e8e\u200b\u672c\u6b21\u200b\u8bfe\u9898\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u5927\u81f4\u200b\u601d\u60f3\u200b\u3002\n\n\n\u200b\u52a0\u6cb9\u200b~~\u200b\u6e90\u7801\u200b\u4e2d\u200b\u78b0\u5230\u200b\u4e0d\u200b\u61c2\u200b\u7684\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u6765\u200b\u95ee\u200b\u6211\u200b\u3002\u200b\u90ae\u4ef6\u200b\u4e00\u822c\u200b24\u200b\u5c0f\u65f6\u200b\u5185\u4f1a\u200b\u56de\u200b\u3002\u200b\u5468\u672b\u200b\u9664\u5916\u200b\n\n\n---\n\n\n&gt; \u200b\u5bfc\u5e08\u200b\u60a8\u597d\u200b\uff0c\u200b\u6211\u200b\u5df2\u200b\u5c06\u200b\u81ea\u5df1\u200b\u5bf9\u200b\u8be5\u9879\u200b\u76ee\u7684\u200b\u521d\u6b65\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u4ee5\u53ca\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u9047\u5230\u200b\u7684\u200b\u4e00\u4e9b\u200b\u7591\u95ee\u200b\u6574\u7406\u200b\u5728\u200b\u4e86\u200b\u4e00\u4efd\u200b\u98de\u200b\u4e66\u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u60a8\u200b\u67e5\u9605\u200b\u3002\u200b\u5982\u200b\u60a8\u200b\u6709\u7a7a\u200b\uff0c\u200b\u8fd8\u200b\u8bf7\u200b\u5e2e\u5fd9\u200b\u770b\u770b\u200b\uff0c\u200b\u5e76\u200b\u7ed9\u4e88\u200b\u4e00\u4e9b\u200b\u6307\u5bfc\u200b\u610f\u89c1\u200b\uff0c\u200b\u4e07\u5206\u200b\u611f\u8c22\u200b\uff01\n\n&gt; \u200b\u98de\u200b\u4e66\u200b\u94fe\u63a5\u200b\uff1a\n</code></pre> <ol> <li>2025-05-28</li> </ol> Text Only<pre><code>\u200b\u6211\u200b\u4ed4\u7ec6\u200b\u770b\u200b\u4e86\u200b\u4f60\u200b\u7684\u200b\u6587\u6863\u200b\uff0c\u200b\u80fd\u200b\u770b\u200b\u51fa\u6765\u200b\u662f\u200b\u82b1\u200b\u4e86\u200b\u65f6\u95f4\u200b\u601d\u8003\u200b\u7684\u200b\u3002\n\n\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u8fd9\u4e2a\u200b\u8bfe\u9898\u200b\u7684\u200b\u601d\u8003\u200b\uff0c\u200b\u9700\u8981\u200b\u6293\u4f4f\u200b\u91cd\u70b9\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5efa\u8bae\u200b\uff1a\n\n\n\n1. \u200b\u5173\u4e8e\u200b\u4e09\u7ea7\u200b\u53c2\u6570\u200b\u914d\u7f6e\u200b\u4f53\u7cfb\u200b\uff0c\u200b\u4ece\u200b\u53c2\u6570\u200b\u7684\u200bscope\u200b\u6765\u8bf4\u200b\uff0c\u200b\u6709\u4e9b\u200b\u9700\u8981\u200b\u5168\u5c40\u200b\u914d\u7f6e\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7528\u200b\u5bf9\u63a5\u200b\u4ec0\u4e48\u200b\u5e73\u53f0\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200bbase-url\uff0capi-key\u200b\u8fd9\u4e9b\u200b\u3002\u200b\u4f46\u662f\u200b\u6709\u4e9b\u200b\u53c2\u6570\u200b\u53ea\u662f\u200b\u7ec4\u4ef6\u200b\u5c42\u9762\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8fd9\u4e2a\u200b\u7ec4\u4ef6\u200b\u7528\u200b\u4ec0\u4e48\u200b\u6a21\u578b\u200b\uff0c\u200b\u7ec4\u4ef6\u200b\u5206\u7c7b\u200b\uff0c\u200b\u6e29\u5ea6\u200b\u7b49\u200b\u53c2\u6570\u200b\u3002\u200b\u5176\u5b9e\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4e09\u5c42\u200b\uff0c\u200b\u751a\u81f3\u4e8e\u200b\u90fd\u200b\u7b97\u4e0d\u4e0a\u200b\u5c42\u200b\u7684\u200b\u6982\u5ff5\u200b\u3002\u200b\u53ea\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u53c2\u6570\u200b\u914d\u200b\u5728\u200b\u4e0d\u540c\u200b\u5730\u65b9\u200b\u800c\u5df2\u200b\u3002\u200b\u5728\u200bchain\u200b\u4e2d\u200b\u914d\u7f6e\u200b\u5b8c\u5168\u200b\u6ca1\u200b\u5fc5\u8981\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6709\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\uff0c\u200b\u4e00\u4e2a\u200bchain\u200b\u4e2d\u200b2\u200b\u4e2a\u200bai\u200b\u6a21\u578b\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\uff0c\u200b\u53c2\u6570\u200b\u4e5f\u200b\u4e0d\u200b\u4e00\u6837\u200b\u3002\n\n2. AI\u200b\u7ec4\u4ef6\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u4f60\u200b\u4e0d\u80fd\u200b\u5b8c\u5168\u200b\u7167\u642c\u200bDify\uff0c\u200b\u8981\u200b\u7ed3\u5408\u200bLF\uff0c\u200b\u6bd4\u5982\u8bf4\u200bstart\u200b\u548c\u200bend\uff0c\u200b\u5728\u200bLF\u200b\u91cc\u200b\u6ca1\u6709\u200b\u8fd9\u200b\u56de\u4e8b\u200b\u3002\u200b\u8fd8\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u91cf\u200b\u8d4b\u503c\u200b\uff0c\u200b\u53d1\u9001\u200bhttp\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u73b0\u6709\u200bLF\u200b\u5c31\u200b\u80fd\u200b\u5b8c\u6210\u200b\u8fd9\u4e9b\u200b\u3002\u200b\u8fd8\u662f\u200b\u4e00\u4e2a\u200b\u7ed3\u5408\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\n\n3. AI\u200b\u7ec4\u4ef6\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u65b9\u6848\u200b\u4e00\u200b\uff0c\u200b\u9884\u5148\u200b\u5f00\u53d1\u200bAI\u200b\u8282\u70b9\u200b\uff0c\u200b\u7684\u786e\u200b\u4f1a\u200b\u5f15\u8d77\u200b\u7ec4\u4ef6\u200bid\u200b\u51b2\u7a81\u200b\u95ee\u9898\u200b\uff0c\u200b\u5982\u679c\u200b\u53bb\u200b\u6620\u5c04\u200b\u3002\u200b\u8fd9\u200b\u65b9\u5f0f\u200b\u592a\u200b\u6b7b\u677f\u200b\u3002\u200b\u65b9\u6848\u200b\u4e8c\u200b\uff0c\u200b\u7528\u6237\u200b\u8fd8\u8981\u200b\u81ea\u5df1\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u90a3\u200b\u57fa\u672c\u4e0a\u200b\u8fdd\u80cc\u200b\u4e86\u200b\u5f00\u7bb1\u200b\u5373\u7528\u200b\u8fd9\u4e2a\u200b\u8bc9\u6c42\u200b\uff0c\u200b\u81f3\u5c11\u200b\u5728\u200b\u4f7f\u7528\u200b\u5c42\u9762\u200b\u4e0a\u200b\u4e0d\u662f\u200b\u592a\u200b\u65b9\u4fbf\u200b\u3002\u200b\u63d0\u793a\u200b\uff1a\u200b\u662f\u5426\u200b\u80fd\u200b\u7528\u200bAnnotation\u200b\u7684\u200b\u58f0\u660e\u200b\u5f0f\u200b\u65b9\u5f0f\u200b\u8ba9\u200b\u7528\u6237\u200b\u53bb\u200b\u81ea\u5b9a\u4e49\u200bai\u200b\u7ec4\u4ef6\u200b\u5462\u200b\uff1f\u200b\u8fd9\u4e2a\u200b\u4e0d\u200b\u9700\u8981\u200b\u7c7b\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5b9a\u4e49\u200b\u63a5\u53e3\u200b\u5373\u53ef\u200b\uff0c\u200b\u63a5\u53e3\u200b\u5982\u4f55\u200b\u53d8\u6210\u200bAI\u200b\u7ec4\u4ef6\u200b\uff0c\u200b\u8fd9\u200b\u9700\u8981\u200b\u9760\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0c\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\u5982\u4f55\u200b\u505a\u200b\uff1f\u200b\u8fd9\u6837\u4e00\u6765\u200b\uff0c\u200b\u540c\u65f6\u200b\u89e3\u51b3\u200b\u4e86\u200b\u7ec4\u4ef6\u200b\u4e0a\u200b\u7684\u200b\u5165\u200b\u53c2\u200b\u95ee\u9898\u200b\u548c\u200bNodeId\u200b\u51b2\u7a81\u200b\u95ee\u9898\u200b\uff0c\u200b\u90a3\u4e48\u200bprompt\u200b\u5982\u4f55\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u52a8\u6001\u5316\u200b\u7684\u200b\u5165\u200b\u53c2\u51fa\u200b\u53c2\u200b\u600e\u4e48\u200b\u505a\u200b\uff1f\n\n    1. \u200b\u5f53\u7136\u200b\u6211\u200b\u53ea\u662f\u200b\u63d0\u51fa\u200b\u4e2a\u200b\u6982\u5ff5\u200b\uff0c\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u6309\u7167\u200b\u6211\u200b\u8bf4\u200b\u7684\u200b\u6765\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u8bb2\u7a76\u200b\u81ea\u5706\u5176\u8bf4\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u4f18\u70b9\u200b\u6700\u200b\u591a\u200b\uff0c\u200b\u540c\u65f6\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u7f3a\u9677\u200b\u63a7\u5236\u200b\u5728\u200b\u53ef\u4ee5\u200b\u5bb9\u5fcd\u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\u3002\n\n4. \u200b\u51fa\u5165\u200b\u53c2\u200b\u7684\u200b\u7ed1\u5b9a\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f60\u200b\u6587\u6863\u200b\u4e0a\u200b\u4e5f\u200b\u6709\u200b\u63d0\u5230\u200b\u3002\u200b\u4f60\u200b\u662f\u200b\u91c7\u7528\u200b\u5b9a\u4e49\u200b&lt;ai-nodes&gt;\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u6765\u200b\u505a\u200b\u7684\u200b\u3002\n\n    1. \u200b\u9996\u5148\u200b\u4f60\u200b\u7684\u200b\u7ec4\u4ef6\u200b\u5b9a\u4e49\u200b\u548c\u200b\u51fa\u5165\u200b\u53c2\u662f\u200b\u5206\u5f00\u200b\u6765\u200b\u7684\u200b\uff0c\u200b\u5f00\u53d1\u8005\u200b\u9700\u8981\u200b\u5b9a\u4e49\u200b\u4e24\u5757\u200b\u5185\u5bb9\u200b\u3002\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u592a\u200b\u5272\u88c2\u200b\n\n    2. \u200b\u5176\u6b21\u200b\u51fa\u5165\u200b\u53c2\u200b\u5b8c\u5168\u200b\u91c7\u7528\u200b\u4e86\u200bxml\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u9700\u8981\u200b\u70ed\u200b\u66f4\u200b\u5417\u200b\uff1f\u200b\u5982\u679c\u200b\u9700\u8981\u200b\uff0c\u200b\u90a3\u70ed\u200b\u66f4\u200b\u600e\u4e48\u200b\u505a\u200b\uff1f\u200b\u5982\u679c\u200b\u5f00\u53d1\u8005\u200b\u60f3\u200b\u4f7f\u7528\u200b\u5b58\u50a8\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u6bd4\u5982\u200bsql\uff0credis\uff0cetcd\u200b\u7b49\u200b\uff0c\u200b\u8fd9\u200b\u6574\u4e2a\u200b\u7684\u200b\u4e00\u5957\u200b\u4e1c\u897f\u200b\u53c8\u200b\u8be5\u200b\u5982\u4f55\u200b\u9002\u914d\u200b\u3002\u200b\u9002\u914d\u200b\u9700\u8981\u200b\u6709\u200b\u591a\u200b\u5927\u200b\u7684\u200b\u590d\u6742\u5ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u82b1\u200b\u591a\u5c11\u200b\u65f6\u95f4\u200b\uff1f\n\n5. Streaming\u200b\u600e\u4e48\u200b\u505a\u200b\uff0c\u200b\u4f60\u200b\u5b8c\u5168\u200b\u6ca1\u200b\u63d0\u5230\u200b\n\n6. Function Calling\u200b\u548c\u200bMCP\u200b\u5927\u6982\u200b\u7684\u200b\u65b9\u5411\u200b\u662f\u200b\u4ec0\u4e48\u200b\uff0c\u200b\u4f60\u200b\u4e5f\u200b\u6ca1\u200b\u63d0\u5230\u200b\u3002\n\n\n\n\u200b\u5176\u5b9e\u200bAI\u200b\u7ec4\u4ef6\u200b\u7c7b\u578b\u5b9a\u4e49\u200b\u6709\u200b\u51e0\u4e2a\u200b\u662f\u200b\u4e0d\u200b\u91cd\u8981\u200b\u7684\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5148\u200b\u8003\u8651\u200b\u6700\u200b\u57fa\u7840\u200b\u7684\u200b\u51e0\u4e2a\u200b\uff0c\u200b\u5927\u200b\u6a21\u578b\u200b\u7ec4\u4ef6\u200b\uff0c\u200b\u77e5\u8bc6\u5e93\u200b\u641c\u7d22\u200b\u7ec4\u4ef6\u200b\uff0c\u200b\u5206\u7c7b\u200b\u7ec4\u4ef6\u200b\u3002\u200b\u4e3b\u8981\u200b\u5c31\u200b\u8fd9\u200b3\u200b\u79cd\u200b\uff0c\u200b\u5927\u200b\u6a21\u578b\u200b\u7ec4\u4ef6\u200b\u540c\u65f6\u200b\u8fd8\u6709\u200bfunction calling\u200b\u548c\u200bmcp\u200b\u7684\u200b\u53d8\u79cd\u200b\uff0c\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200bstreaming\u3002\n\n\n\n\u200b\u8bbe\u8ba1\u200b\u624d\u200b\u662f\u200b\u6700\u200b\u91cd\u8981\u200b\u7684\u200b\uff0c\u200b\u5c24\u5176\u200b\u662f\u200b\u7ec4\u4ef6\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u51fa\u5165\u200b\u53c2\u200b\u8bbe\u8ba1\u200b\u3002\n\n\n\n\u200b\u5982\u679c\u200b\u4f60\u200b\u8981\u200b\u9488\u5bf9\u200b\u4e8e\u200b\u539f\u6765\u200b\u7684\u200b\u89e3\u6790\u200b\u505a\u200b\u6539\u52a8\u200b\uff0c\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u975e\u5e38\u200b\u5468\u5168\u200b\uff08\u200b\u8fd9\u200b\u5f53\u7136\u200b\u4e5f\u200b\u9700\u8981\u200b\u5bf9\u200b\u6e90\u7801\u200b\u66f4\u200b\u6df1\u5c42\u6b21\u200b\u7684\u200b\u7406\u89e3\u200b\uff09\uff0c\u200b\u4ee5\u53ca\u200b\u5bf9\u200b\u5404\u4e2a\u200b\u5176\u4ed6\u200b\u5927\u200b\u529f\u80fd\u5757\u200b\u7684\u200b\u5f71\u54cd\u200b\u8bc4\u4f30\u200b\u3002\u200b\u4ee5\u53ca\u200b\u590d\u6742\u5ea6\u200b\u7684\u200b\u8bc4\u4f30\u200b\u3002\n\n\n\n---\n\n\n\n&gt; \u200b\u5bfc\u5e08\u200b\u60a8\u597d\u200b\uff0c\u200b\u6211\u200b\u6839\u636e\u200b\u60a8\u200b\u4e0a\u6b21\u200b\u7684\u200b\u56de\u590d\u200b\uff0c\u200b\u5199\u200b\u4e86\u200b\u4e00\u4efd\u200b\u521d\u7248\u200b\u7533\u8bf7\u4e66\u200b\u3002\n&gt;\n&gt; \u200b\u6709\u200b\u4e00\u4e9b\u200b\u95ee\u9898\u200b\u60f3\u200b\u8bf7\u6559\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u9996\u5148\u200b\u6211\u200b\u53d1\u73b0\u200b\u8981\u662f\u200b\u60f3\u8981\u200b\u5b9e\u73b0\u200b AI \u200b\u7ec4\u4ef6\u200b\u7684\u200b\u4e00\u4e9b\u200b\u6269\u5c55\u200b\u529f\u80fd\u200b\uff0c\u200b\u9700\u8981\u200b\u5bf9\u200b\u539f\u6709\u200b\u6846\u67b6\u200b\u4ee3\u7801\u200b\u589e\u52a0\u200b\u89e3\u6790\u200b\u903b\u8f91\u200b\uff0c\u200b\u8fd9\u6837\u200b\u505a\u200b\u662f\u5426\u200b\u5408\u7406\u200b\u5462\u200b\uff1f\n&gt;\n&gt; \u200b\u8fd8\u6709\u200b\u5c31\u662f\u200b\u5bfc\u5e08\u200b\u60a8\u200b\u5bf9\u200b dify \u200b\u8282\u70b9\u200b\u770b\u6cd5\u200b\u5982\u4f55\u200b\uff1f\u200b\u9700\u8981\u200b\u5168\u90e8\u200b\u5b9e\u73b0\u200b\u5417\u200b\uff0c\u200b\u8fd8\u662f\u200b\u53ea\u8981\u200b\u5b9e\u73b0\u200b\u90e8\u5206\u200b\u91cd\u8981\u200b\u7684\u200b\u8282\u70b9\u200b\u5373\u53ef\u200b\uff1f\n&gt;\n&gt; \u200b\u6700\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u7533\u8bf7\u4e66\u200b\u6709\u200b\u4efb\u4f55\u200b\u4e0d\u8db3\u4e4b\u5904\u200b\uff0c\u200b\u8fd8\u200b\u671b\u200b\u5bfc\u5e08\u200b\u6307\u51fa\u200b\uff0c\u200b\u6211\u4f1a\u200b\u6539\u6b63\u200b\u3002\n&gt;\n&gt;\n&gt;\n&gt; \u200b\u7533\u8bf7\u4e66\u200b\u98de\u200b\u4e66\u200b\u6587\u6863\u200b\uff1a\n</code></pre> <ol> <li>2025-06-3</li> </ol> Text Only<pre><code>\u200b\u4ee5\u4e0a\u200b\u662f\u200b\u4f60\u200b\u7ec4\u4ef6\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u5305\u62ec\u200b\u51fa\u5165\u200b\u53c2\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5927\u81f4\u200b\u7684\u200b\u793a\u610f\u200b\u3002\n\n\n\n1. \u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200bAI\u200b\u7ec4\u4ef6\u200b\u6765\u8bf4\u200b\uff0c\u200b\u9700\u8981\u200b\u6700\u200b\u57fa\u672c\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6a21\u578b\u200b\u9009\u62e9\u200b\uff0csystemPrompt\uff0cuserPrompt\uff0chistory\uff0ctemperature\u200b\u548c\u200bmaxTokens\uff0c\u200b\u8fd9\u4e9b\u200b\u4f60\u200b\u7528\u200b\u4e00\u4e2a\u200b@AIChat\u200b\u6807\u7b7e\u200b\u53bb\u200b\u805a\u5408\u200b\uff0c\u200b\u6ca1\u592a\u5927\u200b\u95ee\u9898\u200b(\u200b\u53ef\u80fd\u200b\u5c11\u200b\u4e86\u200b\u51e0\u9879\u200b)\u3002\n\n    1. prompt\u200b\u5f53\u4e2d\u200b\u5f15\u7528\u200b\u7684\u200b\u53d8\u91cf\u200b\u7528\u200b\u53cc\u82b1\u200b\u62ec\u53f7\u200b\u8868\u793a\u200b\uff0c\u200b\u8fd9\u200b\u6ca1\u200b\u5565\u200b\u95ee\u9898\u200b\u3002\u200b\u4f46\u662f\u200b\u8003\u8651\u200b\u8fc7\u200bprompt\u200b\u8fd9\u79cd\u200b\u9700\u8981\u200b\u8f93\u5165\u200b\u957f\u200b\u6587\u672c\u200b\uff0c\u200b\u5c24\u5176\u200b\u662f\u200b\u5e26\u200bmarkdown\u200b\u683c\u5f0f\u200b\u7684\u200b\u6587\u672c\u200b\u7684\u200b\u60c5\u51b5\u200b\u5417\u200b\uff1f\u200b\u8fd9\u79cd\u200b\u600e\u4e48\u200b\u89e3\u51b3\u200b\uff1f\u200b\u73b0\u5b9e\u200b\u573a\u666f\u200b\u4e2d\u200b\u5f88\u591a\u200bprompt\u200b\u90fd\u200b\u662f\u200b\u975e\u5e38\u200b\u957f\u200b\u7684\u200b\u3002\n\n2. \u200b\u8f93\u5165\u200b\u53c2\u6570\u200b\u8fd9\u79cd\u200b\u7ed3\u6784\u200b\u4e5f\u200b\u6ca1\u200b\u5565\u200b\u95ee\u9898\u200b\uff0c\u200b\u4ece\u200bcontext\u200b\u4e2d\u200b\u7ed1\u5b9a\u200b\u4e00\u4e9b\u200b\u6570\u636e\u200b\u4f5c\u4e3a\u200bai\u200b\u6a21\u578b\u200b\u7684\u200b\u8f93\u5165\u200b\u53c2\u6570\u200b\uff0c\u200b\u8fd9\u90e8\u5206\u200b\u5176\u5b9e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u5728\u200bLF\u200b\u6709\u200b\u76f8\u5e94\u200b\u7684\u200b\u89e3\u6790\u200b\u516c\u5171\u200b\u65b9\u6cd5\u200b\u3002\n\n3. \u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u5927\u200b\u6a21\u578b\u200b\u8fd4\u56de\u200b\uff0c\u200b\u65e0\u975e\u200b\u5c31\u200b\u4e24\u79cd\u200b\uff0c\u200b\u6587\u672c\u200b\u6216\u8005\u200b\u5bf9\u8c61\u200b(\u200b\u5bf9\u8c61\u200b\u5bf9\u5e94\u200b\u7740\u200bJSON\uff09\uff0c\u200b\u90a3\u200b\u4f60\u200b\u7684\u200b@AIOutPut\u200b\u662f\u5426\u200b\u4e5f\u200b\u5e94\u8be5\u200b\u63d0\u4f9b\u200b\u76f8\u5e94\u200b\u9009\u9879\u200b\uff1f\n\n    1. \u200b\u4f60\u200b\u9009\u62e9\u200b\u4e86\u200b\u8f93\u51fa\u200b\u53c2\u6570\u200b\u4e5f\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u539f\u6709\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\u3002\u200b\u8fd9\u90e8\u5206\u200b\u6ca1\u200b\u5565\u200b\u95ee\u9898\u200b\n\n4. \u200b\u770b\u8d77\u6765\u200b\u4ee5\u4e0a\u200b\u6240\u6709\u200b\u7684\u200b\u5b9a\u4e49\u200b\u548c\u200b\u4f60\u200b\u5b9a\u4e49\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4f60\u200b\u8fd4\u56de\u200bChatAIResult\u200b\u662f\u200b\u4ec0\u4e48\u200b\u610f\u601d\u200b\u5462\u200b\uff0c\u200b\u662f\u200b\u60f3\u200b\u8bf4\u660e\u200b\u7ed1\u5b9a\u200b\u7684\u200b\u5bf9\u8c61\u200b\u662f\u200bChatAIResult\u200b\u7c7b\u578b\u200b\u5417\u200b\uff1f\u200b\u90a3\u200b\u4f60\u200b\u505a\u5230\u200b@AIOutPut\u200b\u6807\u7b7e\u200b\u91cc\u200b\u53bb\u200b\u4e0d\u200b\u5c31\u200b\u597d\u200b\u4e86\u200b\u4e48\u200b\u3002\n\n\n\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u53ea\u662f\u200b\u7528\u6765\u200b\u5b9a\u4e49\u200b\u5927\u200b\u6a21\u578b\u200b\uff0c\u200b\u6700\u540e\u200b\u53cd\u6b63\u200b\u8981\u200b\u88ab\u200b\u52a8\u6001\u200b\u4ee3\u7406\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4f60\u200b\u6240\u6709\u200b\u7684\u200b\u6807\u6ce8\u200b\u5b9a\u4e49\u200b\u5728\u200b\u7c7b\u200b\u4e0a\u200b\u770b\u8d77\u6765\u200b\u4e5f\u200b\u5b8c\u5168\u200b\u6210\u7acb\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u6807\u8bc6\u200b\u63a5\u53e3\u200b\u3002\n\n\n\n\n\u200b\u90a3\u200b\u77e5\u8bc6\u200b\u68c0\u7d22\u200b\u7ec4\u4ef6\u200b\u548c\u200b\u610f\u56fe\u200b\u5206\u7c7b\u200b\u7ec4\u4ef6\u200b\u5462\u200b\uff1f\u200b\u53ea\u200b\u5728\u200b\u4f60\u200b\u7684\u200b\u6587\u6863\u200b\u4e2d\u200b\u89c1\u5230\u200b\u4e86\u200b\u6807\u6ce8\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u4f46\u662f\u200b\u6ca1\u6709\u200b\u89c1\u5230\u200b\u6700\u7ec8\u200b\u7684\u200b\u5448\u73b0\u200b\u65b9\u5f0f\u200b\n\n\u200b\u8be5\u200b\u5982\u4f55\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u5982\u4f55\u200b\u53c8\u200b\u548c\u200b\u4e0a\u9762\u200b\u8fbe\u6210\u200b\u7edf\u4e00\u200b\uff0c\u200b\u6216\u8005\u200b\u4e0d\u200b\u7edf\u4e00\u200b\u4e5f\u200b\u884c\u200b\uff0c\u200b\u4f60\u200b\u53ea\u8981\u200b\u80fd\u200b\u81ea\u5706\u5176\u8bf4\u200b\u5c31\u200bok\n\n\n\n\n\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u6700\u5927\u200b\u7684\u200b\u70b9\u200b\u5728\u4e8e\u200bLF\u200b\u7684\u200bFlowExecutor\u200b\u662f\u200b\u540c\u6b65\u200b\u8fd4\u56de\u200b\uff0c\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u600e\u4e48\u200b\u5728\u200b\u4e00\u4e2a\u200b\u540c\u6b65\u200b\u8fd4\u56de\u200b\u7684\u200b\u91cc\u9762\u200b\u6301\u7eed\u200b\u5411\u5916\u200bstreaming\u200b\u5462\u200b\u3002\u200b\u6ce8\u89e3\u200b\u5c42\u9762\u200b\u5176\u5b9e\u200b\u63d0\u200b\u4e00\u4e0b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u662f\u200b\u592a\u200b\u91cd\u8981\u200b\u3002\n\n\n\n---\n\n\n\n&gt; \u200b\u5bfc\u5e08\u200b\u60a8\u597d\u200b\uff0c\u200b\u6211\u200b\u5df2\u200b\u6309\u7167\u200b\u60a8\u200b\u7684\u200b\u53cd\u9988\u200b\u5bf9\u200b\u9879\u76ee\u200b\u7533\u8bf7\u4e66\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4fee\u6539\u200b\uff0c\u200b\u5b8c\u6210\u200b\u4e86\u200b\u7b2c\u4e8c\u200b\u7248\u200b\u3002\u200b\u9ebb\u70e6\u200b\u60a8\u200b\u5728\u200b\u767e\u5fd9\u4e4b\u4e2d\u200b\u5ba1\u9605\u200b\u4e00\u4e0b\u200b\n&gt;\n&gt;\n&gt;\n&gt; \u200b\u98de\u200b\u4e66\u200b\u6587\u6863\u200b\u94fe\u63a5\u200b\uff1a\n</code></pre> <ol> <li>2025-06-4- 12:33</li> </ol> Text Only<pre><code>\u200b\u7ed9\u200b\u4f60\u200b\u4e3e\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u4ee5\u4e0a\u200b\u662f\u200bcoze\u200b\u5b98\u65b9\u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u793a\u4f8b\u200b\u3002\n\n\n\n{{}}\u200b\u5728\u200bprompt\u200b\u4e2d\u200b\u7684\u786e\u200b\u662f\u200b\u5360\u4f4d\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u8868\u793a\u200b\u52a8\u6001\u200b\u53c2\u6570\u200b\uff0c\u200b\u800c\u200b\u6574\u4e2a\u200bprompt\u200b\u6a21\u7248\u200b\u662f\u200b\u9759\u6001\u200b\u7684\u200b\u3002\u200b\u6574\u4e2a\u200bprompt\u200b\u6a21\u7248\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u957f\u200b\u6587\u672c\u200b\u3002\n\n\n\n\u200b\u5728\u200b\u4f60\u200b\u7684\u200b\u4f7f\u7528\u200b\u6a21\u5f0f\u200b\u4e2d\u200b\uff0c\u200b\u7ea2\u6846\u200b\u90e8\u5206\u200b\u672c\u8eab\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200bprompt\u200b\u6a21\u7248\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u90e8\u5206\u200b\u592a\u957f\u200b\u4e86\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\u3002\u200b\u800c\u4e14\u200b\u5199\u200b\u5728\u200b\u8fd9\u200b\u91cc\u9762\u200b\u4f1a\u200b\u4e22\u5931\u200b\u683c\u5f0f\u200b\u4fe1\u606f\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u90e8\u5206\u200b\u76f4\u63a5\u200b\u7528\u200b{{}}\u200b\u6765\u200b\u5360\u4f4d\u200b\u3002\u200b\u6bcf\u6b21\u200b\u8c03\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\u8ba9\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u62fc\u6210\u200b\u5927\u200bprompt\u200b\u81ea\u5df1\u200b\u4f20\u200b\u5417\u200b\uff1f\n\n\n\n\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5230\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u4fbf\u6377\u200b\u5ea6\u200b\u3002\n\n\n\nFlowExecutor\u200b\u672c\u8eab\u200b\u5c31\u200b\u6709\u200b\u8fd4\u56de\u200bCompletableFuture\u200b\u7684\u200b\u63a5\u53e3\u200b\u3002\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u52a0\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u591a\u200b\u4ece\u200b\u5f02\u6b65\u200b\u548c\u200bSseEmitter\uff0c\u200b\u4ee5\u53ca\u200blangChain4J\u200b\u7684\u200b\u6d41\u5f0f\u200b\u5904\u7406\u200b\u65b9\u5411\u200b\u53bb\u200b\u7ed3\u5408\u200b\u601d\u8003\u200b\u3002\n\n\n\n\u200b\u7533\u8bf7\u4e66\u200b\u6309\u7167\u200bospp\u200b\u8981\u6c42\u200b\u4e0a\u4f20\u200b\uff0c\u200b\u5177\u4f53\u200b\u770b\u5b98\u200b\u7f51\u200b\u3002\u200b\u6392\u7248\u200b\u6ca1\u592a\u5927\u200b\u8981\u6c42\u200b\uff0c\u200b\u7ae0\u8282\u200b\u6e05\u6670\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\u3002\u200b\u7b49\u200b\u6240\u6709\u200b\u540c\u5b66\u200b\u90fd\u200b\u63d0\u4ea4\u200b\u4e86\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u7efc\u5408\u200b\u8bc4\u5b9a\u200b\u6765\u200b\u786e\u5b9a\u200b\u4eba\u9009\u200b\n\n\n\n---\n\n\n\n&gt; \u200b\u5bfc\u5e08\u200b\u60a8\u597d\u200b\uff0c\u200b\u770b\u200b\u4e86\u200b\u60a8\u200b\u7684\u200b\u90ae\u4ef6\u200b\u56de\u590d\u200b\u540e\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7591\u60d1\u200b\u60f3\u200b\u8ddf\u200b\u60a8\u200b\u4ea4\u6d41\u200b\u4e00\u4e0b\u200b\u3002\n&gt;\n&gt;\n&gt;\n&gt; \u200b\u9996\u5148\u200b\u662f\u200b\u957f\u200b\u6587\u672c\u200b\u95ee\u9898\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u6211\u200b\u8ba4\u4e3a\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u5360\u4f4d\u200b\u7b26\u200b\u89e3\u6790\u200b\u4f3c\u4e4e\u200b\u6ca1\u4ec0\u4e48\u200b\u95ee\u9898\u200b\uff1f\u200b\u5c06\u200b\u6587\u672c\u200b\u76f4\u63a5\u200b\u89e3\u6790\u200b\u5230\u200b\u5360\u4f4d\u200b\u7b26\u5c31\u884c\u200b\u5427\u200b\n&gt;\n&gt;\n&gt;\n&gt; \u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u200b\u770b\u5230\u200bFlowExecutor\u200b\u6709\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u662f\u200bexecute2Future\uff0c\u200b\u90a3\u4e48\u200b\u7528\u6237\u200b\u5728\u200b\u9700\u8981\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\u5e94\u8be5\u200b\u8c03\u7528\u200b\u8fd9\u4e2a\u200b\u5f02\u6b65\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e3b\u7ebf\u200b\u7a0b\u5c31\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200bFuture \u200b\u63a5\u53e3\u200b\u7684\u200b\u7ed3\u679c\u200b\u83b7\u53d6\u200b\u662f\u200b\u540c\u6b65\u200b\u4e14\u200b\u963b\u585e\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u7528\u6237\u200b\u60f3\u8981\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b SseEmitter \u200b\u5230\u200b\u524d\u7aef\u200b\u540c\u65f6\u200b\u9700\u8981\u200b\u5728\u200b\u6d41\u7a0b\u200b\u7ed3\u675f\u200b\u7684\u200b\u65f6\u5019\u200b\u5904\u7406\u200b\u76f8\u5173\u200b\u7684\u200b\u4e1a\u52a1\u200b\u903b\u8f91\u200b\uff0c\u200b\u90a3\u4e48\u200b\u56e0\u4e3a\u200b Future \u200b\u63a5\u53e3\u200b\u4f1a\u200b\u963b\u585e\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\uff0c\u200b\u5c31\u200b\u5bfc\u81f4\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u5df2\u7ecf\u200b\u8f93\u51fa\u200b\u5b8c\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bf7\u6c42\u200b\u624d\u200b\u7ed3\u675f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u6837\u200b\u505a\u200b\u4f3c\u4e4e\u200b\u4e0d\u592a\u200b\u5408\u7406\u200b\u3002\n&gt;\n&gt;\n&gt;\n&gt; \u200b\u90a3\u4e48\u200b\uff0c\u200b\u80fd\u200b\u4e0d\u80fd\u200b\u5728\u200bFlowExecutor\u200b\u52a0\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u7684\u200b\u662f\u200b CompletableFuture\uff0c\u200b\u90a3\u4e48\u200b\u7528\u6237\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7f16\u5199\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u53bb\u200b\u5904\u7406\u200b\u6d41\u7a0b\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\u7684\u200b\u4e1a\u52a1\u200b\u903b\u8f91\u200b\uff0c\u200b\u7136\u540e\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b SseEmitter \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u3002\n&gt;\n&gt; \u200b\u7136\u540e\u200b\uff0c\u200b\u6211\u200b\u7a81\u7136\u200b\u610f\u8bc6\u200b\u5230\u200b\u6211\u200b\u4e4b\u524d\u200b\u7684\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u65b9\u6848\u200b\u662f\u200b\u4e0d\u5408\u7406\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5982\u679c\u200b\u662f\u200b\u5728\u200b\u6ce8\u89e3\u200b\u5c42\u9762\u200b\u8bbe\u7f6e\u200b\u5bf9\u5e94\u200b\u7684\u200b Spring Bean ID \u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7528\u6237\u200b\u7684\u200b\u5904\u7406\u200b\u903b\u8f91\u200b\u5728\u200b\u8fdb\u7a0b\u200b\u542f\u52a8\u200b\u524d\u200b\u5c31\u662f\u200b\u5b9a\u6b7b\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u8bf4\u200b\u9700\u8981\u200b\u5728\u200b\u6d41\u5f0f\u200b\u4f20\u8f93\u200b\u4e2d\u200b\u7528\u5230\u200b\u4e00\u4e9b\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u662f\u200b\u83b7\u53d6\u200b\u4e0d\u5230\u200b\u7684\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u6211\u200b\u89c9\u5f97\u200b\u5e94\u8be5\u200b\u5c06\u200b StreamHandler \u200b\u653e\u5728\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7528\u6237\u200b\u5728\u200b\u6267\u884c\u200b\u4e00\u4e2a\u200b\u6d41\u7a0b\u200b\u4e4b\u524d\u200b\uff0c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5904\u7406\u200b\u903b\u8f91\u200b\u8fdb\u884c\u200b\u81ea\u5b9a\u4e49\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u662f\u200b\u66f4\u52a0\u200b\u7075\u6d3b\u200b\u7684\u200b\u3002\n&gt;\n&gt;\n&gt;\n&gt; \u200b\u7533\u8bf7\u4e66\u200b\u7684\u8bdd\u200b\uff0c\u200b\u6700\u540e\u200b\u662f\u200b\u4e0a\u4f20\u200b pdf \u200b\u5c31\u884c\u200b\u5417\u200b\uff1f\u200b\u7136\u540e\u200b\u6392\u7248\u200b\u4e0a\u200b\u662f\u5426\u200b\u6709\u200b\u7279\u6b8a\u200b\u7684\u200b\u8981\u6c42\u200b\uff1f\n</code></pre> <ol> <li>2025-06-5</li> </ol> Text Only<pre><code>\u200b\u5173\u4e8e\u200bprompt\uff0c\u200b\u4f60\u200b\u7684\u200b\u601d\u8003\u200b\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\u3002\n\u200b\u4f46\u662f\u200b\u4ecb\u4e8e\u200b\u4f60\u200b\u7684\u200b\u4e09\u4e2a\u200b\u4e3b\u8981\u200b\u7684\u200b\u6807\u6ce8\u200b\u53c2\u6570\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u9700\u8981\u200b\u4ece\u200b\u5f00\u53d1\u8005\u200b\u7684\u200b\u89d2\u5ea6\u200b\u591a\u53bb\u200b\u60f3\u60f3\u200b\uff0c\u200b\u600e\u4e48\u6837\u200b\u7b80\u5355\u200b\u5f00\u53d1\u200b\u6211\u4eec\u200b\u5c31\u200b\u600e\u4e48\u200b\u53bb\u200b\u8bbe\u8ba1\u200b\u3002\n\u200b\u6240\u4ee5\u200bprompt\u200b\u4e0d\u7528\u200b\u628a\u200bResource\u200b\u7684\u200b\u7c7b\u578b\u200b\u548c\u200b\u76f4\u63a5\u200b\u5199\u200b\u7684\u200b\u5206\u5f00\u200b\u3002\u200b\u5c31\u200bsystemPrompt\u200b\u548c\u200buserPrompt\u200b\u4e24\u4e2a\u200b\u53ef\u4ee5\u200b\u5305\u542b\u200b\u6240\u6709\u200b\u60c5\u51b5\u200b\uff0c\u200b\u7528\u6237\u200b\u600e\u4e48\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u6211\u4eec\u200b\u53bb\u200b\u9002\u914d\u200b\uff0c\u200b\u667a\u80fd\u200b\u7684\u200b\u8bc6\u522b\u200b\u3002\n\n\u200b\u5173\u4e8e\u200bsse\u200b\u7684\u200b\u601d\u8003\u200b\uff0c\u200b\u6211\u200b\u770b\u200b\u4e86\u200b\u4f60\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u7684\u786e\u200bCompletableFuture\u200b\u8fd4\u56de\u200b\u53ef\u80fd\u200b\u66f4\u597d\u200b\u3002\u200b\u4f20\u5165\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200bstreaming\u3002\n\n\u200b\u51e1\u662f\u200b\u7528\u6237\u200b\u9700\u8981\u200b\u76f4\u63a5\u200b\u5b9a\u4e49\u200b\u7684\u200b\u4e1c\u897f\u200b\uff0c\u200b\u5e0c\u671b\u200b\u8981\u200b\u7ad9\u200b\u5728\u200b\u7528\u6237\u200b\u4fa7\u53bb\u200b\u601d\u8003\u200b\u3002\u200b\u5c24\u5176\u200b\u8fd9\u4e2a\u200b\u8bfe\u9898\u200b\uff0c\u200b\u9700\u8981\u200b\u7528\u6237\u200b\u4fa7\u200b\u5b9a\u4e49\u200b\u7684\u200b\u4e1c\u897f\u200b\u8fd8\u200b\u633a\u200b\u591a\u200b\uff0c\u200b\u9700\u8981\u200b\u683c\u5916\u200b\u6ce8\u610f\u200b\u3002\n\n\u200b\u603b\u4f53\u200b\u4e0d\u9519\u200b\uff0c\u200b\u770b\u6765\u200b\u662f\u200b\u82b1\u200b\u4e86\u200b\u65f6\u95f4\u200b\u601d\u8003\u200b\u7684\u200b\u3002\u200b\u52a0\u6cb9\u200b\n\n\n---\n\n\u200b\u5bfc\u5e08\u200b\u60a8\u597d\u200b\uff0c\u200b\u53c8\u200b\u4fee\u6539\u200b\u4e86\u200b\u4e00\u7248\u200b\u7533\u8bf7\u4e66\u200b\uff0c\u200b\u4e3b\u8981\u200b\u4fee\u6539\u200b\u548c\u200b\u6dfb\u52a0\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b 4.4\uff0c4.5\uff0c4.7 \u200b\u7ae0\u8282\u200b\n\n\u200b\u7136\u540e\u200b\u7533\u8bf7\u4e66\u200b\u7684\u200b pdf \u200b\u7248\u672c\u200b\u5728\u200b\u9644\u4ef6\u200b\u4e2d\u200b\n\n\n\u200b\u957f\u200b\u6587\u672c\u200b prompt \u200b\u6211\u200b\u5e94\u8be5\u200b\u7406\u89e3\u200b\u5bfc\u5e08\u200b\u60a8\u200b\u7684\u200b\u610f\u601d\u200b\u4e86\u200b\u3002\n\n\u200b\u4f46\u662f\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u200b\u771f\u200b\u6ca1\u200b\u627e\u5230\u200bFlowExecutor\u200b\u6709\u200b\u8fd4\u56de\u200b CompletableFuture \u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b9\u6cd5\u200b\u554a\u200b\uff0c\u200b\u6211\u200b\u53ea\u200b\u770b\u5230\u200b execute2Future \u200b\u662f\u200b\u8fd4\u56de\u200b Future \u200b\u63a5\u53e3\u200b\u7684\u200b\u3002\n\n\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5f02\u6b65\u200b\u7684\u200b\u6267\u884c\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u90a3\u4e48\u200b\u80af\u5b9a\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u8981\u662f\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u8c03\u7528\u200b furture.get()\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u83b7\u53d6\u200b\u7ed3\u679c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u540c\u6b65\u200b\u4e14\u200b\u963b\u585e\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540e\u7eed\u200b\u7684\u200b\u64cd\u4f5c\u200b\u4e0d\u4f1a\u200b\u6267\u884c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bd4\u65b9\u8bf4\u200b\u6709\u200b\u8fd9\u6837\u200b\u4e00\u4e2a\u200b\u573a\u666f\u200b\u3002\n\n1. \u200b\u8bf7\u6c42\u200b\u8fdb\u5165\u200b\n2. \u200b\u5728\u200b\u4e0a\u4e0b\u6587\u200b\u8bbe\u7f6e\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u8c03\u7528\u200b AI \u200b\u76f8\u5173\u200b\u8282\u70b9\u200b\n3. \u200b\u8c03\u7528\u200bexecute2Future\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u83b7\u53d6\u200b future \u200b\u5bf9\u8c61\u200b\n4. future.get()\u200b\u83b7\u53d6\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\uff0c\u200b\u5e76\u200b\u5bf9\u200b\u7ed3\u679c\u200b\u8fdb\u884c\u200b\u4e1a\u52a1\u200b\u5904\u7406\u200b\n5. return \u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u5904\u7406\u5668\u200b\u7ed9\u200b\u524d\u7aef\u200b\n\n\u200b\u95ee\u9898\u200b\u5c31\u200b\u5728\u200b 4 -&gt; 5 \u200b\u8fd9\u4e2a\u200b\u9636\u6bb5\u200b\uff0c\u200b\u540e\u200b\u7aef\u200b\u8981\u662f\u200b\u60f3\u8981\u200b\u4f7f\u7528\u200b SSE \u200b\u534f\u8bae\u200b\u5bf9\u200b\u524d\u7aef\u200b\u8fdb\u884c\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5e94\u5f53\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u76f8\u5173\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u4f46\u662f\u200b\u9636\u6bb5\u200b 4 \u200b\u963b\u585e\u4f4f\u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b LLM \u200b\u8282\u70b9\u200b\u6d41\u5f0f\u200b\u8f93\u51fa\u200b\u5df2\u7ecf\u200b\u5173\u95ed\u200b\u4e86\u200b\u624d\u200b\u8fd4\u56de\u200b\u76f8\u5173\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u90a3\u4e48\u200b\u524d\u7aef\u200b\u662f\u200b\u6536\u4e0d\u5230\u200b\u4efb\u4f55\u200b\u6d88\u606f\u200b\u7684\u200b\u3002\n\n\u200b\u5f53\u7136\u200b\u89e3\u51b3\u200b\u4e0a\u8ff0\u200b\u95ee\u9898\u200b\u53ef\u4ee5\u200b\u9760\u200b\u7528\u6237\u200b\u81ea\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6bd4\u5982\u8bf4\u200b\u6211\u200b\u4e0d\u200b\u8c03\u7528\u200b future.get()\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u963b\u585e\u200b\u3002\u200b\u6bd4\u5982\u8bf4\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u8d77\u200b\u4e00\u4e2a\u200b CompletableFuture \u200b\u7136\u540e\u200b\u5728\u200b\u91cc\u9762\u200b\u5199\u200b future.get() \uff0c\u200b\u518d\u7528\u200b\u56de\u8c03\u200b\u903b\u8f91\u200b\u505a\u200b\u76f8\u5173\u200b\u7684\u200b\u4e1a\u52a1\u200b\u5904\u7406\u200b\u3002\n\n\u200b\u4f46\u662f\u200b\u6211\u4eec\u200b\u4e3a\u4f55\u200b\u4e0d\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b CompletableFuture \u200b\u5bf9\u8c61\u200b\u5462\u200b\uff1f\u200b\u6211\u200b\u89c9\u5f97\u200b\u8fd9\u6837\u200b\u505a\u200b\u662f\u200b\u5408\u7406\u200b\u7684\u200b\u3002\u200b\u76f8\u5173\u200b\u7684\u200b\u8ba8\u8bba\u200b\u6211\u200b\u653e\u5728\u200b\u7533\u8bf7\u4e66\u200b\u7684\u200b 4.7 \u200b\u7ae0\u8282\u200b\u3002\n\n\u200b\u98de\u200b\u4e66\u200b\u94fe\u63a5\u200b\uff1a\n</code></pre> <ol> <li>2025-06-19- 12:20 \u200b\u5bfc\u5e08\u200b\u5fae\u4fe1\u200b\u901a\u77e5\u200b\u4e2d\u9009\u200b</li> </ol> <p></p> <p>\u200b\u6700\u7ec8\u200b\u7533\u8bf7\u4e66\u200b pdf \u200b\u6709\u200b 36 \u200b\u9875\u200b\uff0c\u200b\u5728\u200b\u7533\u8bf7\u4e66\u200b\u63d0\u4ea4\u200b\u622a\u6b62\u200b\u7684\u200b\u4e24\u5929\u200b\u540e\u200b\u6210\u529f\u200b\u4e2d\u9009\u200b!!!</p>","tags":["ospp"]},{"location":"blog/2025/09/29/ospp2025%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/#701-930","title":"7.01 - 9.30 \u200b\u9879\u76ee\u200b\u5f00\u53d1","text":"<p>\u200b\u5728\u200b\u4e2d\u9009\u200b\u540e\u200b\u7684\u200b\u90a3\u80a1\u200b\u5174\u594b\u200b\u52b2\u200b\u6d88\u9000\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6211\u200b\u5f00\u59cb\u200b\u601d\u8003\u200b\u5e94\u8be5\u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u9879\u76ee\u200b\uff0c\u200b\u6b64\u65f6\u200b\u7684\u200b\u6211\u200b\u5e76\u4e0d\u77e5\u9053\u200b\u5199\u200b\u8fd9\u200b\u9b3c\u200b\u9879\u76ee\u200b\u80fd\u200b\u8fd9\u4e48\u200b\u6298\u78e8\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u7533\u8bf7\u4e66\u200b\u662f\u200b\u6211\u200b\u548c\u200b AI \u200b\u4e00\u8d77\u200b\u5199\u200b\u7684\u200b\uff0c\u200b\u5149\u662f\u200b\u5199\u200b\u7533\u8bf7\u4e66\u200b\u5c31\u8981\u200b\u5c06\u200b\u6211\u200b\u71c3\u5c3d\u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5199\u200b\u4ec0\u4e48\u200b mvp \u200b\u53bb\u200b\u9a8c\u8bc1\u200b\u6211\u200b\u7684\u200b\u65b9\u6848\u200b\u53ef\u884c\u6027\u200b\u3002</p> <p>\u200b\u7136\u540e\u200b\uff0c\u200b\u4e2d\u9009\u200b\u4e4b\u540e\u200b\u6211\u200b\u53d1\u73b0\u200b\u6211\u200b\u7684\u200b\u65b9\u6848\u200b\u600e\u4e48\u200b\u8fd9\u4e48\u200b\u50cf\u200b\u4e00\u200b\u5768\u200b shit \u200b\u5462\u200b\uff0c\u200b\u6b38\u200b\uff0c\u200b\u8981\u200b\u4e0d\u200b\u4e0d\u200b\u6309\u200b\u65b9\u6848\u200b\u5199\u200b\u7684\u200b\u6765\u200b\uff0c\u200b\u6211\u200b\u6309\u200b\u6211\u200b\u81ea\u5df1\u200b\u7684\u200b\u60f3\u6cd5\u200b\u5199\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u65b9\u6848\u200b\u5b9e\u73b0\u200b\u5427\u200b\ud83e\udd13</p> <p>\u200b\u5728\u200b 7 \u200b\u6708\u521d\u200b\u5230\u200b 7 \u200b\u6708\u200b\u4e2d\u65ec\u200b\uff0c\u200b\u6211\u200b\u56e0\u4e3a\u200b\u6211\u200b\u7684\u200b\u7075\u673a\u4e00\u52a8\u200b\u4e00\u76f4\u200b\u5728\u200b\u6309\u200b\u6211\u200b\u81ea\u5df1\u200b\u7684\u200b\u60f3\u6cd5\u200b\u5199\u200b\uff0c\u200b\u6211\u200b\u7684\u200b\u60f3\u6cd5\u200b\u5927\u6982\u200b\u5c31\u662f\u200b\u5e95\u5c42\u200b\u8c03\u7528\u200b AI \u200b\u6a21\u578b\u200b\u4e0d\u7528\u200b\u5f00\u6e90\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u800c\u662f\u200b\u81ea\u5df1\u200b\u5c1d\u8bd5\u200b\u53bb\u200b\u5199\u200b\u4e00\u5957\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u4e00\u987f\u200b\u81ea\u200b\u8ba4\u4e3a\u200b\u60ca\u4e3a\u5929\u4eba\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u5e76\u7528\u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u7248\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6211\u200b\u4fe1\u5fc3\u200b\u6ee1\u6ee1\u5730\u200b\u53d1\u5fae\u4fe1\u200b\u8ddf\u200b\u5bfc\u5e08\u200b\u8bf4\u200b\uff1a\u201c\u200b\u770b\u770b\u200b\u6211\u200b\u5199\u200b\u7684\u200b\u600e\u4e48\u6837\u200b\ud83e\udd13\u201d</p> <p>\u200b\u4e0d\u51fa\u610f\u5916\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8981\u51fa\u200b\u610f\u5916\u200b\u4e86\u200b</p> <p>\u200b\u5bfc\u5e08\u200b\u628a\u200b\u6211\u200b\u72e0\u72e0\u200b\u55b7\u200b\u4e86\u200b\u4e00\u987f\u200b\uff0c\u200b\u8bf4\u200b\uff0c\u200b\u4f60\u200b\u81ea\u5df1\u200b\u5199\u200b\u7684\u200b\u518d\u200b\u597d\u200b\u80fd\u200b\u6709\u200b\u5f00\u6e90\u200b\u7684\u200b langchain4j \u200b\u5199\u200b\u7684\u200b\u597d\u200b\u5417\u200b\uff0c\u200b\u4e0d\u8981\u200b\u628a\u200b\u7cbe\u529b\u200b\u82b1\u200b\u5728\u200b\u6ca1\u200b\u5fc5\u8981\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u80fd\u200b\u7528\u200b\u5f00\u6e90\u200b\u7684\u200b\u5c31\u200b\u7528\u200b\u5f00\u6e90\u200b\u7684\u200b</p> <p>\u200b\u7ed9\u200b\u6211\u200b\u76f4\u63a5\u200b\u6574\u200b\u6291\u90c1\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u4e5f\u200b\u6ca1\u200b\u529e\u6cd5\u200b\uff0c\u200b\u53ea\u80fd\u200b\u987a\u4ece\u200b\u4e86\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7528\u200b langchain4j \u200b\u53bb\u200b\u5199\u200b\u5427\u200b\uff01</p> <p>\u200b\u5728\u200b 7 \u200b\u6708\u200b\u4e2d\u65ec\u200b\u5230\u200b 7 \u200b\u6708\u5e95\u200b\uff0c\u200b\u6211\u7528\u200b langchain4j \u200b\u7684\u200b\u65b9\u6848\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u7248\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53d1\u7ed9\u200b\u4e86\u200b\u5bfc\u5e08\u200b\uff0c\u200b\u4e0d\u51fa\u610f\u5916\u200b\u7684\u8bdd\u200b\uff0c\u200b\u8fd9\u200b\u5927\u6982\u200b\u5c31\u662f\u200b\u6700\u7ec8\u200b\u7684\u200b\u7248\u672c\u200b\u4e86\u200b</p> <p>\u200b\u7136\u540e\u200b\u51fa\u200b\u610f\u5916\u200b\u4e86\u200b= =</p> <p>\u200b\u5bfc\u5e08\u200b\u8bf4\u200b\uff0clangchain4j \u200b\u7684\u200b\u65b9\u6848\u200b\u4e5f\u200b\u4e0d\u884c\u200b\uff0c\u200b\u9996\u5148\u200b langchain4j \u200b\u8981\u6c42\u200b jdk17 \u200b\u53ca\u200b\u4ee5\u4e0a\u200b\uff0c\u200b\u800c\u200b LiteFlow \u200b\u9700\u8981\u200b\u652f\u6301\u200b jdk8 \u200b\u53ca\u200b\u4ee5\u4e0a\u200b\uff0c\u200b\u8fd9\u200b\u4f9d\u8d56\u200b\u5c31\u200b\u6ca1\u6cd5\u7528\u200b\uff0c\u200b\u518d\u8005\u200b langchain4j \u200b\u7684\u200b api \u200b\u5c01\u88c5\u200b\u7684\u200b\u8fc7\u4e8e\u200b\u9ad8\u5c42\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u9879\u76ee\u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u57fa\u7840\u200b\u7684\u200b\u8c03\u7528\u200b\u5927\u200b\u6a21\u578b\u200b\u7684\u200b\u80fd\u529b\u200b\u5373\u53ef\u200b</p> <p>\u200b\u53c8\u200b\u7ed9\u200b\u6211\u6574\u200b\u6291\u90c1\u200b\u4e86\u200b\uff0c\u200b\u6211\u200b\u771f\u662f\u200b\u65e5\u200b\u4e86\u200b</p> <p>\u200b\u4f46\u662f\u200b\u9879\u76ee\u200b\u8fd8\u662f\u200b\u8981\u200b\u5199\u200b\u7684\u200b\uff0c\u200b\u6bd5\u7adf\u200b\u662f\u200b\u6211\u200b\u81ea\u5df1\u200b\u9009\u200b\u7684\u200b\uff0c\u200b\u5c31\u7b97\u200b\u662f\u200b\u53f2\u200b\u6211\u200b\u4e5f\u200b\u5403\u200b\u4e86\u200b</p> <p>\u200b\u6700\u540e\u200b\u548c\u200b\u5bfc\u5e08\u200b\u6c9f\u901a\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6700\u7ec8\u200b\u6572\u5b9a\u200b\u6309\u200b\u6211\u200b\u539f\u6765\u200b\u7684\u200b\u65b9\u6848\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e5f\u200b\u5c31\u662f\u200b\u81ea\u5df1\u200b\u53bb\u200b\u5199\u200b\u4e00\u5957\u200b\u5e95\u5c42\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u597d\u200b\u5728\u200b\u8fd9\u200b\u4e24\u7248\u200b\u65b9\u6848\u200b\u662f\u200b\u53ef\u4ee5\u200b\u4e92\u901a\u200b\u7684\u200b\uff0c\u200b\u603b\u4e4b\u200b\u4e5f\u200b\u4e0d\u7b97\u200b\u767d\u5199\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b 8 \u200b\u6708\u4efd\u200b\u4e00\u76f4\u200b\u5728\u200b\u6162\u6162\u200b\u53bb\u200b\u5b9e\u73b0\u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u6ca1\u6709\u200b\u8bf4\u200b\u5bfc\u5e08\u200b\u4e0d\u597d\u200b\u7684\u200b\u610f\u601d\u200b\uff0c\u200b\u76f8\u53cd\u200b\u6211\u200b\u975e\u5e38\u611f\u8c22\u200b\u5bfc\u5e08\u200b\u5bf9\u200b\u6211\u200b\u7684\u200b\u6307\u5bfc\u200b\uff0c\u200b\u6211\u200b\u89c9\u5f97\u200b\u81ea\u5df1\u200b\u771f\u662f\u200b\u8fd0\u6c14\u200b\u7206\u68da\u200b\uff0c\u200b\u80fd\u200b\u9047\u5230\u200b\u4e00\u4e2a\u200b\u8fd9\u4e48\u200b\u597d\u200b\u7684\u200b\u5bfc\u5e08\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u6b21\u200b\u53bb\u200b\u95ee\u200b\u95ee\u9898\u200b\uff0c\u200b\u5bfc\u5e08\u200b\u90fd\u200b\u662f\u200b\u4e00\u5927\u200b\u6bb5\u200b\u4e00\u5927\u200b\u6bb5\u200b\u7684\u200b\u56de\u590d\u200b\u6211\u200b\uff0c\u200b\u53bb\u200b\u8ba8\u8bba\u200b\u76f8\u5173\u200b\u7684\u200b\u65b9\u6848\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u786e\u5b9e\u200b\u53d7\u76ca\u200b\u5f88\u5927\u200b\u3002</p> <p>\u200b\u5230\u200b 8 \u200b\u6708\u200b\u4e0b\u200b\u534a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u611f\u89c9\u200b\u5bfc\u5e08\u200b\u4e5f\u200b\u7b97\u200b\u8ba4\u53ef\u200b\u6211\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u5f00\u59cb\u200b\u8ba8\u8bba\u200b\u7ed3\u9879\u200b\u76f8\u5173\u200b\u7684\u200b\u4e8b\u5b9c\u200b\u3002</p> <p>\u200b\u622a\u6b62\u200b 8 \u200b\u6708\u5e95\u200b\uff0c\u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b\u7684\u200b\u4ee3\u7801\u200b\u91cf\u200b\u5171\u8ba1\u200b 1w5 \u200b\u884c\u200b\u5de6\u53f3\u200b\uff08\u200b\u4e0d\u200b\u5305\u542b\u200b\u6d4b\u8bd5\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5b8c\u5168\u200b\u5b8c\u5584\u200b\uff0c\u200b\u9700\u8981\u200b\u6162\u6162\u200b\u7684\u200b\u8fdb\u884c\u200b\u8fed\u4ee3\u200b\u3002</p> <p>\u200b\u5bfc\u5e08\u200b\u8fd9\u8fb9\u200b\u975e\u5e38\u200b\u7684\u200b\u5584\u89e3\u4eba\u610f\u200b\uff0c\u200b\u5141\u8bb8\u200b\u76f4\u63a5\u200b\u5408\u5165\u200b\u6211\u200b\u7684\u200b pr\uff0c\u200b\u5e76\u4e14\u200b\u544a\u77e5\u200b\u6211\u200b\u8bf4\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u62c5\u5fc3\u200b ospp \u200b\u7684\u200b\u65f6\u95f4\u200b\u8282\u70b9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5408\u5165\u200b\uff0c\u200b\u4f46\u662f\u200b\u540e\u7eed\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u76f8\u5173\u200b\u7684\u200b\u8fed\u4ee3\u200b\u5de5\u4f5c\u200b</p> <p>\u200b\u6240\u4ee5\u200b\u4e0d\u51fa\u610f\u5916\u200b\u7684\u8bdd\u200b\u6211\u200b\u8fd9\u8fb9\u200b\u5176\u5b9e\u200b\u5df2\u7ecf\u200b\u53ef\u4ee5\u200b\u5f00\u200b\u9999\u69df\u200b\u4e86\u200b\uff0c\u200b\u540e\u7eed\u200b\u53ea\u8981\u200b\u8ddf\u7740\u200b ospp \u200b\u7684\u200b\u6d41\u7a0b\u200b\u8d70\u200b\u5c31\u200b\u80fd\u200b\u987a\u5229\u200b\u7ed3\u9879\u200b\u3002</p> <p>\u200b\u7136\u540e\u200b\u8e0f\u9a6c\u200b\u53c8\u200b\u51fa\u200b\u610f\u5916\u200b\u4e86\u200b</p> <p>ospp \u200b\u7684\u200b\u7ed3\u9879\u200b\u5ba1\u6838\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6211\u200b\u7684\u200b PR \u200b\u7684\u200b commit \u200b\u592a\u200b\u591a\u200b\u62a5\u9519\u200b\u4e86\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u4e0d\u4e86\u200b\uff0c\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u4e0d\u200b\u591a\u200b\uff0c\u200b\u5c31\u200b 87 \u200b\u4e2a\u200b commit\uff0c\u200b\u95ee\u200b\u5ba2\u670d\u200b\u4e4b\u540e\u200b\uff0c\u200b\u60c5\u51b5\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a \"\u200b\u540e\u53f0\u200b\u53cd\u9988\u200b\u662f\u56e0\u4e3a\u200bPR\u200b\u4e2d\u200b\u5305\u542b\u200b\u7684\u200bcommit\u200b\u6570\u91cf\u200b\u592a\u200b\u591a\u200b\u5bfc\u81f4\u200b\u9650\u5236\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u88ab\u200b\u7b2c\u4e09\u65b9\u200b\u5e73\u53f0\u200b\u89e3\u6790\u200b\u7981\u6b62\u200b\u3002\u200b\u5efa\u8bae\u200b\u7cbe\u7b80\u200bcommit\u200b\u6570\u91cf\u200b\uff0c\u200b\u5177\u4f53\u64cd\u4f5c\u200b\u65b9\u6cd5\u200b\u53ef\u200b\u4e0e\u200b\u5bfc\u5e08\u200b\u8ba8\u8bba\u200b\u51b3\u5b9a\u200b\u3002\"</p> <p>\u200b\u4e0d\u662f\u200b\u4f60\u200b\u544a\u8bc9\u200b\u6211\u200b\u600e\u4e48\u200b\u7cbe\u7b80\u200b commit\uff1f\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u5408\u200b\u8fdb\u53bb\u200b\uff0c\u200b\u8fd8\u6709\u200b\u8fd9\u200b\u4e0d\u662f\u200b\u4f60\u4eec\u200b OSPP \u200b\u540e\u53f0\u200b\u670d\u52a1\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u95ee\u9898\u200b\u5417\u200b\uff1f</p> <p>\u200b\u4e0d\u8fc7\u200b\u8ddf\u200b\u5bfc\u5e08\u200b\u53cd\u9988\u200b\u540e\u200b\uff0c\u200b\u5bfc\u5e08\u200b\u8bf4\u200b\u80fd\u591f\u200b\u5e2e\u200b\u6211\u200b\u89e3\u51b3\u200b\uff0c\u200b\u5b9e\u5728\u200b\u4e0d\u884c\u200b\u5c31\u200b\u8d70\u200b\u4eba\u5de5\u200b\u5ba1\u6838\u200b\uff0c\u200b\u603b\u4e4b\u200b\u5148\u200b\u8fd9\u6837\u200b\u5427\u200b</p> <p>\u200b\u6700\u540e\u200b\u7684\u200b\u6700\u540e\u200b\uff0c\u200b\u5f88\u200b\u611f\u8c22\u200b OSPP \u200b\u548c\u200b LiteFlow \u200b\u793e\u533a\u200b\u80fd\u591f\u200b\u7ed9\u200b\u6211\u200b\u4e00\u6b21\u200b\u53c2\u4e0e\u200b\u5f00\u6e90\u200b\u7684\u200b\u673a\u4f1a\u200b\u3002\u200b\u6211\u200b\u5728\u200b\u4e00\u200b\u5f00\u59cb\u200b\u7533\u8bf7\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4ece\u6765\u200b\u6ca1\u60f3\u200b\u8fc7\u200b\u81ea\u5df1\u200b\u4e5f\u200b\u80fd\u591f\u200b\u53c2\u4e0e\u200b\u5f00\u6e90\u200b\uff0c\u200b\u751a\u81f3\u200b\u4e00\u5ea6\u200b\u6000\u7591\u200b\u81ea\u5df1\u200b\u7684\u200b\u80fd\u529b\u200b\u662f\u5426\u200b\u80fd\u591f\u200b\u80dc\u4efb\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u771f\u771f\u6b63\u6b63\u200b\u6295\u5165\u200b\u8fdb\u53bb\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u66fe\u7ecf\u200b\u8ba4\u4e3a\u200b\u5f88\u96be\u200b\u7684\u200b\u4e8b\u60c5\u200b\u6216\u8bb8\u200b\u5e76\u200b\u4e0d\u200b\u53ef\u6015\u200b\uff0c\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\u8ba9\u200b\u81ea\u5df1\u200b\u884c\u52a8\u200b\u8d77\u6765\u200b\u3002</p>","tags":["ospp"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/","title":"AstroMailer \ud83c\udf0c","text":"<p> \u200b\u7ea6\u200b 509 \u200b\u4e2a\u200b\u5b57\u200b  29 \u200b\u884c\u200b\u4ee3\u7801\u200b  1 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 2 \u200b\u5206\u949f\u200b</p> <p>AstroMailer \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6bcf\u65e5\u200b\u65e9\u5b89\u200b\u90ae\u4ef6\u200b\u53d1\u9001\u5668\u200b\uff0c\u200b\u5b83\u200b\u901a\u8fc7\u200b\u96c6\u6210\u200b NASA \u200b\u5929\u6587\u200b\u6bcf\u65e5\u200b\u4e00\u56fe\u200b\uff08APOD\uff09\u3001\u200b\u8bcd\u9738\u200b\u91d1\u53e5\u200b\u548c\u200b\u767e\u5ea6\u200b\u7ffb\u8bd1\u200b API\uff0c\u200b\u4e3a\u200b\u7528\u6237\u200b\u5e26\u6765\u200b\u6d6a\u6f2b\u200b\u3001\u200b\u6e29\u6696\u200b\u7684\u200b\u65e9\u5b89\u200b\u90ae\u4ef6\u200b\u3002</p> <p>github\u200b\u5730\u5740\u200b: AstroMailer</p>","tags":["project"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/#_1","title":"\u529f\u80fd\u200b\u6982\u8ff0","text":"<ul> <li>\ud83d\udce7 \u200b\u6bcf\u65e5\u200b\u53d1\u9001\u200b\u65e9\u5b89\u200b\u90ae\u4ef6\u200b<ul> <li>\u200b\u9644\u5e26\u200b NASA \u200b\u5929\u6587\u200b\u6bcf\u65e5\u200b\u4e00\u56fe\u200b\u53ca\u5176\u200b\u89e3\u91ca\u200b\u3002</li> <li>\u200b\u5305\u542b\u200b\u8bcd\u9738\u200b\u6bcf\u65e5\u200b\u91d1\u53e5\u200b\uff08\u200b\u4e2d\u200b\u82f1\u53cc\u8bed\u200b\uff09\u3002</li> <li>\u200b\u90ae\u4ef6\u200b\u652f\u6301\u200b\u4e2d\u200b\u82f1\u6587\u7ffb\u8bd1\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b\u7b80\u6d01\u200b\u4f18\u96c5\u200b\u7684\u200b HTML \u200b\u6837\u5f0f\u200b\u8bbe\u8ba1\u200b\u3002</li> </ul> </li> <li>\ud83c\udf0c \u200b\u968f\u673a\u200b\u80cc\u666f\u8272\u200b\u548c\u200b\u6837\u5f0f\u200b<ul> <li>\u200b\u90ae\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u53e5\u5b50\u200b\u548c\u200b\u80cc\u666f\u200b\u914d\u8272\u200b\u91c7\u7528\u200b\u52a8\u6001\u968f\u673a\u200b\u751f\u6210\u200b\uff0c\u200b\u8ba9\u200b\u6bcf\u200b\u4e00\u5929\u200b\u7684\u200b\u90ae\u4ef6\u200b\u90fd\u200b\u6709\u200b\u72ec\u7279\u200b\u7684\u200b\u98ce\u683c\u200b\u3002</li> <li>\ud83d\udd04 \u200b\u7f13\u5b58\u200b\u673a\u5236\u200b</li> <li>\u200b\u4f7f\u7528\u200b diskcache \u200b\u7f13\u5b58\u200b NASA \u200b\u56fe\u7247\u200b\u548c\u200b\u5185\u5bb9\u200b\uff0c\u200b\u51cf\u5c11\u200b\u91cd\u590d\u200b API \u200b\u8bf7\u6c42\u200b\u3002</li> </ul> </li> </ul>","tags":["project"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/#_2","title":"\u9879\u76ee\u200b\u67b6\u6784","text":"<p>AstroMailer \u200b\u7684\u200b\u4e3b\u8981\u200b\u529f\u80fd\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <ol> <li>\u200b\u90ae\u4ef6\u200b\u53d1\u9001\u200b\u6a21\u5757\u200b<ul> <li>\u200b\u4f7f\u7528\u200b smtplib \u200b\u5b9e\u73b0\u200b\u90ae\u4ef6\u200b\u7684\u200b\u53d1\u9001\u200b\u3002</li> <li>\u200b\u652f\u6301\u200b HTML \u200b\u683c\u5f0f\u5316\u200b\u90ae\u4ef6\u200b\u5185\u5bb9\u200b\u3002</li> </ul> </li> <li>API \u200b\u8c03\u7528\u200b\u6a21\u5757\u200b<ul> <li>\u200b\u96c6\u6210\u200b NASA APOD API \u200b\u83b7\u53d6\u200b\u6bcf\u65e5\u200b\u5929\u6587\u200b\u56fe\u7247\u200b\u548c\u200b\u63cf\u8ff0\u200b\u3002</li> <li>\u200b\u96c6\u6210\u200b\u767e\u5ea6\u200b\u7ffb\u8bd1\u200b API \u200b\u7ffb\u8bd1\u200b\u56fe\u7247\u200b\u63cf\u8ff0\u200b\u4e3a\u200b\u4e2d\u6587\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b\u8bcd\u9738\u200b API \u200b\u83b7\u53d6\u200b\u6bcf\u65e5\u200b\u91d1\u53e5\u200b\u3002</li> </ul> </li> <li>\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u6a21\u5757\u200b<ul> <li>\u200b\u4f7f\u7528\u200b schedule \u200b\u5b9e\u73b0\u200b\u6bcf\u5929\u200b\u65e9\u4e0a\u200b 8 \u200b\u70b9\u200b\u81ea\u52a8\u200b\u53d1\u9001\u200b\u90ae\u4ef6\u200b\u3002</li> </ul> </li> <li>\u200b\u7f13\u5b58\u200b\u6a21\u5757\u200b<ul> <li>\u200b\u4f7f\u7528\u200b diskcache \u200b\u7f13\u5b58\u6570\u636e\u200b\uff0c\u200b\u907f\u514d\u200b\u9891\u7e41\u200b\u8c03\u7528\u200b API\u3002</li> </ul> </li> </ol>","tags":["project"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/#_3","title":"\u8fd0\u884c\u200b\u622a\u56fe","text":"<p>\ud83d\udce7 \u200b\u90ae\u4ef6\u200b\u793a\u4f8b\u200b    </p> <p></p>","tags":["project"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/#_4","title":"\u6280\u672f\u200b\u6808","text":"<ul> <li>\u200b\u7f16\u7a0b\u8bed\u8a00\u200b: Python 3.10+</li> <li> <p>\u200b\u4e3b\u8981\u200b\u4f9d\u8d56\u200b:</p> <ul> <li>smtplib: \u200b\u53d1\u9001\u200b\u90ae\u4ef6\u200b</li> <li>schedule: \u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u8c03\u5ea6\u200b</li> <li>diskcache: \u200b\u672c\u5730\u200b\u7f13\u5b58\u200b</li> <li>requests: \u200b\u8c03\u7528\u200b API</li> <li>PyYAML: \u200b\u89e3\u6790\u200b\u914d\u7f6e\u6587\u4ef6\u200b</li> </ul> </li> <li> <p>API:</p> <ul> <li>NASA APOD API</li> <li>\u200b\u767e\u5ea6\u200b\u7ffb\u8bd1\u200b API</li> <li>\u200b\u8bcd\u9738\u200b API</li> </ul> </li> </ul>","tags":["project"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/#_5","title":"\u5b89\u88c5\u200b\u4e0e\u200b\u8fd0\u884c","text":"<p>1. \u200b\u514b\u9686\u200b\u9879\u76ee\u200b</p> Bash<pre><code>git clone https://github.com/Pale-illusions/AstroMailer.git\ncd AstroMailer\n</code></pre> <p>2. \u200b\u521b\u5efa\u200b\u865a\u62df\u73af\u5883\u200b\u5e76\u200b\u5b89\u88c5\u200b\u4f9d\u8d56\u200b</p> Bash<pre><code># \u200b\u521b\u5efa\u200b\u865a\u62df\u73af\u5883\u200b\npython3 -m venv myvenv\n\n# \u200b\u6fc0\u6d3b\u200b\u865a\u62df\u73af\u5883\u200b\nsource myvenv/bin/activate  # macOS/Linux\nmyvenv\\Scripts\\activate     # Windows\n\n# \u200b\u5b89\u88c5\u200b\u4f9d\u8d56\u200b\npip install -r requirements.txt\n</code></pre> <p>3. \u200b\u914d\u7f6e\u200b\u73af\u5883\u200b</p> <p>\u200b\u5728\u200b <code>resources/config.yaml</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u914d\u7f6e\u200b\u4f60\u200b\u7684\u200b <code>API</code> \u200b\u5bc6\u94a5\u200b\u548c\u200b\u90ae\u4ef6\u200b\u8d26\u6237\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u793a\u4f8b\u200b\u914d\u7f6e\u6587\u4ef6\u200b <code>config.yaml</code>\uff1a</p> YAML<pre><code>api_key:\n  nasa: \"\u200b\u4f60\u200b\u7684\u200bNASA_API_KEY\"\n  baidu_translate:\n    appid: \"\u200b\u4f60\u200b\u7684\u200b\u767e\u5ea6\u200b\u7ffb\u8bd1\u200bAPPID\"\n    secret_key: \"\u200b\u4f60\u200b\u7684\u200b\u767e\u5ea6\u200b\u7ffb\u8bd1\u200bSECRET_KEY\"\n\nemail:\n  name: \"AstroMailer\"\n  smtp_server: \"smtp.gmail.com\"\n  smtp_port: 587\n  sender: \"your_email@example.com\"\n  password: \"your_email_password\"\n  recipients:\n    - \"recipient1@example.com\"\n    - \"recipient2@example.com\"\n</code></pre> <p>4. \u200b\u542f\u52a8\u200b\u670d\u52a1\u200b</p> <p>\u200b\u76f4\u63a5\u200b\u8fd0\u884c\u200b</p> Bash<pre><code>python src/main.py\n</code></pre> <p>docker</p> Bash<pre><code>docker-compose up -d\n</code></pre>","tags":["project"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/#_6","title":"\u8d21\u732e\u200b\u6307\u5357","text":"<p>\u200b\u6b22\u8fce\u200b\u8d21\u732e\u200b\u4ee3\u7801\u200b\uff01\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u4e3a\u200b AstroMailer \u200b\u63d0\u4ea4\u200b\u65b0\u200b\u7684\u200b\u529f\u80fd\u200b\u6216\u200b\u4fee\u590d\u200b bug\uff0c\u200b\u8bf7\u200b\u6309\u7167\u200b\u4ee5\u4e0b\u200b\u6b65\u9aa4\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>Fork \u200b\u4ed3\u5e93\u200b\u3002</li> <li>\u200b\u521b\u5efa\u200b\u65b0\u200b\u5206\u652f\u200b\uff1a</li> </ol> Bash<pre><code>git checkout -b feature/your-feature-name\n</code></pre> <ol> <li>\u200b\u63d0\u4ea4\u200b\u4ee3\u7801\u200b\u5e76\u200b\u521b\u5efa\u200b Pull Request\u3002</li> </ol>","tags":["project"]},{"location":"blog/2024/12/17/astromailer-%E4%B8%80%E4%B8%AA%E6%AF%8F%E6%97%A5%E6%97%A9%E5%AE%89%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E5%99%A8/#_7","title":"\u5f00\u6e90\u200b\u534f\u8bae","text":"<p>\u200b\u672c\u200b\u9879\u76ee\u200b\u91c7\u7528\u200b Apache-2.0 license\u3002</p> <p>\u200b\u611f\u8c22\u200b\u4f7f\u7528\u200b AstroMailer\uff0c\u200b\u8ba9\u200b\u5b87\u5b99\u200b\u7684\u200b\u6d6a\u6f2b\u200b\u70b9\u4eae\u200b\u4f60\u200b\u7684\u200b\u6bcf\u200b\u4e00\u5929\u200b\uff01\u2728</p>","tags":["project"]},{"location":"blog/2024/12/06/homebrew/","title":"Homebrew","text":"<p> \u200b\u7ea6\u200b 19 \u200b\u4e2a\u200b\u5b57\u200b  2 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p> <p>\u200b\u6267\u884c\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8ddf\u7740\u200b\u914d\u7f6e\u200b\u5c31\u884c\u200b</p> Bash<pre><code>/bin/zsh -c \"$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)\"\n</code></pre> <p>\u200b\u5173\u95ed\u200b\u81ea\u52a8\u66f4\u65b0\u200b</p> Bash<pre><code>echo 'export HOMEBREW_NO_AUTO_UPDATE=1' &gt;&gt; ~/.zshrc\n</code></pre>","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/","title":"oh-my-zsh","text":"<p> \u200b\u7ea6\u200b 337 \u200b\u4e2a\u200b\u5b57\u200b  6 \u200b\u884c\u200b\u4ee3\u7801\u200b  5 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p> <p>\u200b\u672c\u6587\u200b\u57fa\u4e8e\u200b macos \u200b\u7cfb\u7edf\u200b\uff0c\u200b\u4f7f\u7528\u200b oh-my-zsh \u200b\u5bf9\u200b\u7ec8\u7aef\u200b\u8fdb\u884c\u200b\u7f8e\u5316\u200b\u3002</p> <p>Oh My Zsh \u200b\u662f\u200b\u57fa\u4e8e\u200b zsh \u200b\u547d\u4ee4\u884c\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6269\u5c55\u200b\u5de5\u5177\u96c6\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e30\u5bcc\u200b\u7684\u200b\u6269\u5c55\u200b\u529f\u80fd\u200b\u3002</p> <p></p>","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/#1-oh-my-zsh","title":"1. \u200b\u5b89\u88c5\u200b oh-my-zsh","text":"Bash<pre><code>sh -c \"$(curl -fsSL https://install.ohmyz.sh/)\"\n</code></pre>","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/#2","title":"2. \u200b\u914d\u7f6e\u200b\u4e3b\u9898","text":"<p>\u200b\u4f7f\u7528\u200b powerlevel10k \u200b\u4e3b\u9898\u200b\u3002</p> Bash<pre><code>git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k\n</code></pre> <p>\u200b\u5728\u200b <code>~/.zshrc</code> \u200b\u8bbe\u7f6e\u200b <code>ZSH_THEME=\"powerlevel10k/powerlevel10k\"</code>\u3002</p> <p>\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b</p> Bash<pre><code>source ~/.zshrc\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u7ec8\u7aef\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5f15\u5bfc\u200b\u4f60\u200b\u914d\u7f6e\u200b <code>powerlevel10k</code>\u3002</p> <p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u91cd\u65b0\u914d\u7f6e\u200b\uff0c\u200b\u8f93\u5165\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b</p> Bash<pre><code>p10k configure\n</code></pre>","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/#3","title":"3. \u200b\u5b89\u88c5\u200b\u63d2\u4ef6","text":"","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/#31-zsh-autosuggestions","title":"3.1 zsh -autosuggestions","text":"<p>zsh -autosuggestions \u200b\u662f\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u200b\u63d0\u793a\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5f53\u200b\u4f60\u200b\u8f93\u5165\u200b\u547d\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u63a8\u6d4b\u200b\u4f60\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8f93\u5165\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u6309\u4e0b\u200b\u53f3\u952e\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u91c7\u7528\u200b\u5efa\u8bae\u200b\u3002\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u5b89\u88c5\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u628a\u200b\u63d2\u4ef6\u200b\u4e0b\u8f7d\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b <code>~/.oh-my-zsh/custom/plugins</code> \u200b\u76ee\u5f55\u200b</p> Bash<pre><code>git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions\n</code></pre>","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/#32-zsh-syntax-highlighting","title":"3.2 zsh-syntax-highlighting","text":"<p>zsh-syntax-highlighting \u200b\u662f\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u200b\u8bed\u6cd5\u200b\u6821\u9a8c\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5728\u200b\u8f93\u5165\u200b\u547d\u4ee4\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u82e5\u200b\u6307\u4ee4\u200b\u4e0d\u200b\u5408\u6cd5\u200b\uff0c\u200b\u5219\u200b\u6307\u4ee4\u200b\u663e\u793a\u200b\u4e3a\u200b\u7ea2\u8272\u200b\uff0c\u200b\u82e5\u200b\u6307\u4ee4\u200b\u5408\u6cd5\u200b\u5c31\u200b\u4f1a\u200b\u663e\u793a\u200b\u4e3a\u200b\u7eff\u8272\u200b\u3002\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> <p>\u200b\u5b89\u88c5\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u628a\u200b\u63d2\u4ef6\u200b\u4e0b\u8f7d\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b <code>~/.oh-my-zsh/custom/plugins</code> \u200b\u76ee\u5f55\u200b\u3002</p> Bash<pre><code>git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n</code></pre>","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/#33-z","title":"3.3 z","text":"<p><code>oh-my-zsh</code> \u200b\u5185\u7f6e\u200b\u4e86\u200b <code>z</code> \u200b\u63d2\u4ef6\u200b\u3002<code>z</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u5939\u200b\u5feb\u6377\u200b\u8df3\u8f6c\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u66fe\u7ecf\u200b\u8df3\u200b\u8f6c\u8fc7\u200b\u7684\u200b\u76ee\u5f55\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8f93\u5165\u200b\u6700\u7ec8\u76ee\u6807\u200b\u6587\u4ef6\u5939\u200b\u540d\u79f0\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u907f\u514d\u200b\u518d\u200b\u8f93\u5165\u200b\u957f\u4e32\u200b\u8def\u5f84\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u5207\u6362\u200b\u6587\u4ef6\u5939\u200b\u7684\u200b\u6548\u7387\u200b\u3002\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p>","tags":["tools"]},{"location":"blog/2024/12/06/oh-my-zsh/#34","title":"3.4 \u200b\u542f\u7528\u200b\u63d2\u4ef6","text":"<p>\u200b\u4fee\u6539\u200b <code>~/.zshrc</code> \u200b\u4e2d\u200b\u63d2\u4ef6\u200b\u5217\u8868\u200b\u4e3a\u200b\uff1a</p> Text Only<pre><code>plugins=(git zsh-syntax-highlighting zsh-autosuggestions z)\n</code></pre> <p>\u200b\u6267\u884c\u200b <code>source ~/.zshrc</code></p>","tags":["tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/","title":"git commit \u200b\u89c4\u8303","text":"<p> \u200b\u7ea6\u200b 679 \u200b\u4e2a\u200b\u5b57\u200b  33 \u200b\u884c\u200b\u4ee3\u7801\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 3 \u200b\u5206\u949f\u200b</p>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#commit-message","title":"Commit message \u200b\u683c\u5f0f","text":"<p>\u200b\u6bcf\u6b21\u200b\u63d0\u4ea4\u200b\uff0cCommit message \u200b\u90fd\u200b\u5305\u62ec\u200b\u4e09\u4e2a\u200b\u90e8\u5206\u200b\uff1aheader\uff0cbody \u200b\u548c\u200b footer\u3002</p> git commit<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;\n&lt;BLANK LINE&gt;\n&lt;body&gt;\n&lt;BLANK LINE&gt;\n&lt;footer&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\uff0cheader \u200b\u662f\u200b\u5fc5\u9700\u200b\u7684\u200b\uff0cbody \u200b\u548c\u200b footer \u200b\u53ef\u4ee5\u200b\u7701\u7565\u200b\u3002 \u200b\u4e0d\u7ba1\u200b\u662f\u200b\u54ea\u200b\u4e00\u4e2a\u200b\u90e8\u5206\u200b\uff0c\u200b\u4efb\u4f55\u200b\u4e00\u884c\u200b\u90fd\u200b\u4e0d\u5f97\u200b\u8d85\u8fc7\u200b72\u200b\u4e2a\u5b57\u7b26\u200b\uff08\u200b\u6216\u200b100\u200b\u4e2a\u5b57\u7b26\u200b\uff09\u3002\u200b\u8fd9\u662f\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u81ea\u52a8\u200b\u6362\u884c\u200b\u5f71\u54cd\u200b\u7f8e\u89c2\u200b\u3002</p>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#header","title":"Header","text":"<p>Header\u200b\u90e8\u5206\u200b\u53ea\u6709\u200b\u4e00\u884c\u200b\uff0c\u200b\u5305\u62ec\u200b\u4e09\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\uff1atype\uff08\u200b\u5fc5\u9700\u200b\uff09\u3001scope\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\u200b\u548c\u200bsubject\uff08\u200b\u5fc5\u9700\u200b\uff09\u3002</p>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#1-type","title":"1. type","text":"<p>\u200b\u7528\u4e8e\u200b\u8bf4\u660e\u200b commit \u200b\u7684\u200b\u7c7b\u522b\u200b\uff0c\u200b\u53ea\u200b\u5141\u8bb8\u200b\u4f7f\u7528\u200b\u4e0b\u9762\u200b7\u200b\u4e2a\u200b\u6807\u8bc6\u200b\u3002</p> <ul> <li>feat\uff1a\u200b\u65b0\u200b\u529f\u80fd\u200b\uff08feature\uff09</li> <li>fix\uff1a\u200b\u4fee\u8865\u200bbug</li> <li>docs\uff1a\u200b\u6587\u6863\u200b\uff08documentation\uff09</li> <li>style\uff1a \u200b\u683c\u5f0f\u200b\uff08\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u4ee3\u7801\u8fd0\u884c\u200b\u7684\u200b\u53d8\u52a8\u200b\uff09</li> <li>refactor\uff1a\u200b\u91cd\u6784\u200b\uff08\u200b\u5373\u200b\u4e0d\u662f\u200b\u65b0\u589e\u200b\u529f\u80fd\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u4fee\u6539\u200bbug\u200b\u7684\u200b\u4ee3\u7801\u200b\u53d8\u52a8\u200b\uff09</li> <li>test\uff1a\u200b\u589e\u52a0\u200b\u6d4b\u8bd5\u200b</li> <li>chore\uff1a\u200b\u6784\u5efa\u200b\u8fc7\u7a0b\u200b\u6216\u200b\u8f85\u52a9\u5de5\u5177\u200b\u7684\u200b\u53d8\u52a8\u200b</li> </ul> <p>\u200b\u5982\u679c\u200btype\u200b\u4e3a\u200bfeat\u200b\u548c\u200bfix\uff0c\u200b\u5219\u200b\u8be5\u200b commit \u200b\u5c06\u200b\u80af\u5b9a\u200b\u51fa\u73b0\u200b\u5728\u200b Change log \u200b\u4e4b\u4e2d\u200b\u3002\u200b\u5176\u4ed6\u200b\u60c5\u51b5\u200b\uff08docs\u3001chore\u3001style\u3001refactor\u3001test\uff09\u200b\u7531\u200b\u4f60\u200b\u51b3\u5b9a\u200b\uff0c\u200b\u8981\u200b\u4e0d\u8981\u200b\u653e\u5165\u200b Change log\uff0c\u200b\u5efa\u8bae\u200b\u662f\u200b\u4e0d\u8981\u200b\u3002</p>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#2-scope","title":"2. scope","text":"<p>scope\u200b\u7528\u4e8e\u200b\u8bf4\u660e\u200b commit \u200b\u5f71\u54cd\u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6570\u636e\u200b\u5c42\u200b\u3001\u200b\u63a7\u5236\u200b\u5c42\u200b\u3001\u200b\u89c6\u56fe\u200b\u5c42\u200b\u7b49\u7b49\u200b\uff0c\u200b\u89c6\u200b\u9879\u76ee\u200b\u4e0d\u540c\u200b\u800c\u200b\u4e0d\u540c\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\u5728\u200bAngular\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b $location, $browser, $compile, $rootScope, ngHref, ngClick, ngView\u200b\u7b49\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u4fee\u6539\u200b\u5f71\u54cd\u200b\u4e86\u200b\u4e0d\u6b62\u200b\u4e00\u4e2a\u200bscope\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b * \u200b\u4ee3\u66ff\u200b\u3002</p>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#3-subject","title":"3. subject","text":"<p>subject\u200b\u662f\u200b commit \u200b\u76ee\u7684\u200b\u7684\u200b\u7b80\u77ed\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u4e0d\u200b\u8d85\u8fc7\u200b50\u200b\u4e2a\u5b57\u7b26\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u6ce8\u610f\u4e8b\u9879\u200b\uff1a</p> <ul> <li>\u200b\u4ee5\u200b\u52a8\u8bcd\u200b\u5f00\u5934\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7b2c\u4e00\u4eba\u79f0\u200b\u73b0\u5728\u200b\u65f6\u200b\uff0c\u200b\u6bd4\u5982\u200bchange\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200bchanged\u200b\u6216\u200bchanges</li> <li>\u200b\u7b2c\u4e00\u4e2a\u200b\u5b57\u6bcd\u200b\u5c0f\u5199\u200b</li> <li>\u200b\u7ed3\u5c3e\u200b\u4e0d\u200b\u52a0\u200b\u53e5\u53f7\u200b\uff08.\uff09</li> </ul>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#body","title":"Body","text":"<p>Body \u200b\u90e8\u5206\u200b\u662f\u200b\u5bf9\u200b\u672c\u6b21\u200b commit \u200b\u7684\u200b\u8be6\u7ec6\u63cf\u8ff0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u6210\u200b\u591a\u884c\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8303\u4f8b\u200b\u3002</p> git commit<pre><code>More detailed explanatory text, if necessary.  Wrap it to \nabout 72 characters or so. \n\nFurther paragraphs come after blank lines.\n\n- Bullet points are okay, too\n- Use a hanging indent\n</code></pre> <p>\u200b\u6709\u200b3\u200b\u4e2a\u200b\u6ce8\u610f\u200b\u70b9\u200b:</p> <ul> <li>\u200b\u4f7f\u7528\u200b\u7b2c\u4e00\u4eba\u79f0\u200b\u73b0\u5728\u200b\u65f6\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4f7f\u7528\u200bchange\u200b\u800c\u200b\u4e0d\u662f\u200bchanged\u200b\u6216\u200bchanges\u3002</li> <li>\u200b\u6c38\u8fdc\u200b\u522b\u5fd8\u4e86\u200b\u7b2c\u200b2\u200b\u884c\u662f\u200b\u7a7a\u884c\u200b</li> <li>\u200b\u5e94\u8be5\u200b\u8bf4\u660e\u200b\u4ee3\u7801\u200b\u53d8\u52a8\u200b\u7684\u200b\u52a8\u673a\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4e0e\u200b\u4ee5\u524d\u200b\u884c\u4e3a\u200b\u7684\u200b\u5bf9\u6bd4\u200b\u3002</li> </ul>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#footer","title":"Footer","text":"<p>Footer \u200b\u90e8\u5206\u200b\u53ea\u200b\u7528\u4e8e\u200b\u4ee5\u4e0b\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p> <ol> <li>\u200b\u4e0d\u200b\u517c\u5bb9\u200b\u53d8\u52a8\u200b</li> </ol> <p>\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u4ee3\u7801\u200b\u4e0e\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u7248\u672c\u200b\u4e0d\u200b\u517c\u5bb9\u200b\uff0c\u200b\u5219\u200b Footer \u200b\u90e8\u5206\u200b\u4ee5\u200bBREAKING CHANGE\u200b\u5f00\u5934\u200b\uff0c\u200b\u540e\u9762\u200b\u662f\u200b\u5bf9\u200b\u53d8\u52a8\u200b\u7684\u200b\u63cf\u8ff0\u200b\u3001\u200b\u4ee5\u53ca\u200b\u53d8\u52a8\u200b\u7406\u7531\u200b\u548c\u200b\u8fc1\u79fb\u200b\u65b9\u6cd5\u200b\u3002</p> git commit<pre><code>BREAKING CHANGE: isolate scope bindings definition has changed.\n\n    To migrate the code follow the example below:\n\n    Before:\n\n    scope: {\n      myAttr: 'attribute',\n    }\n\n    After:\n\n    scope: {\n      myAttr: '@',\n    }\n\n    The removed `inject` wasn't generaly useful for directives so there should be no code using it.\n</code></pre> <ol> <li>\u200b\u5173\u95ed\u200bissue</li> </ol> <p>\u200b\u5982\u679c\u200b\u5f53\u524d\u200b commit \u200b\u9488\u5bf9\u200b\u67d0\u4e2a\u200bissue\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u5728\u200b Footer \u200b\u90e8\u5206\u200b\u5173\u95ed\u200b\u8fd9\u4e2a\u200b issue \u3002</p> git commit<pre><code>Closes #234\n</code></pre>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#revert","title":"Revert","text":"<p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b commit \u200b\u7528\u4e8e\u200b\u64a4\u9500\u200b\u4ee5\u524d\u200b\u7684\u200b commit\uff0c\u200b\u5219\u200b\u5fc5\u987b\u200b\u4ee5\u200brevert:\u200b\u5f00\u5934\u200b\uff0c\u200b\u540e\u9762\u200b\u8ddf\u7740\u200b\u88ab\u200b\u64a4\u9500\u200b Commit \u200b\u7684\u200b Header\u3002</p> git commit<pre><code>revert: feat(pencil): add 'graphiteWidth' option\n\nThis reverts commit 667ecc1654a317a13331b17617d973392f415f02.\n</code></pre> <p>Body\u200b\u90e8\u5206\u200b\u7684\u200b\u683c\u5f0f\u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5199\u6210\u200b<code>This reverts commit &amp;lt;hash&gt;.</code>\uff0c\u200b\u5176\u4e2d\u200b\u7684\u200bhash\u200b\u662f\u200b\u88ab\u200b\u64a4\u9500\u200b commit \u200b\u7684\u200b SHA \u200b\u6807\u8bc6\u7b26\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u5f53\u524d\u200b commit \u200b\u4e0e\u200b\u88ab\u200b\u64a4\u9500\u200b\u7684\u200b commit\uff0c\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u53d1\u5e03\u200b\uff08release\uff09\u200b\u91cc\u9762\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4eec\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u5728\u200b Change log \u200b\u91cc\u9762\u200b\u3002\u200b\u5982\u679c\u200b\u4e24\u8005\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u53d1\u5e03\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u524d\u200b commit\uff0c\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5728\u200b Change log \u200b\u7684\u200bReverts\u200b\u5c0f\u6807\u9898\u200b\u4e0b\u9762\u200b\u3002</p>","tags":["git","tools"]},{"location":"blog/2024/11/21/git-commit-%E8%A7%84%E8%8C%83/#_1","title":"\u53c2\u8003\u8d44\u6599","text":"<p>git commit \u200b\u89c4\u8303\u200b\u6307\u5357\u200b</p>","tags":["git","tools"]},{"location":"blog/2025/02/02/01ideagit-demo/","title":"01.IdeaGit-Demo","text":"<p> \u200b\u7ea6\u200b 198 \u200b\u4e2a\u200b\u5b57\u200b  2 \u200b\u884c\u200b\u4ee3\u7801\u200b  9 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/01ideagit-demo/#_1","title":"\u51c6\u5907","text":"<ol> <li>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200bgithub repo</li> </ol> <ol> <li>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200bidea\u200b\u9879\u76ee\u200b</li> </ol> <p>\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0cgithub repo\u200b\u4e2d\u662f\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b\u9884\u5148\u200b\u5b9a\u4e49\u200b\u7684\u200b<code>README</code>\u200b\u6587\u4ef6\u200b\uff0c\u200b\u800c\u200bidea\u200b\u9879\u76ee\u200b\u4e2d\u200b\u4e0d\u200b\u5b58\u5728\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/01ideagit-demo/#_2","title":"\u5c1d\u8bd5\u200b\u63d0\u4ea4\u200b\u5e76\u200b\u63a8\u9001","text":"<p>\u200b\u627e\u5230\u200b\u5de6\u4fa7\u200b<code>commit</code>\u200b\u9009\u9879\u200b\uff0c\u200b\u9009\u4e2d\u200b\u5168\u90e8\u200b\u5e76\u200b\u70b9\u51fb\u200b<code>Commit</code></p> <p></p> <p>\u200b\u5728\u200b<code>commit</code>\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\u53f3\u952e\u200b<code>master</code>\u200b\u5206\u652f\u200b\uff0c\u200b\u5c06\u200b\u5176\u200b\u6539\u540d\u200b\u4e3a\u200b<code>main</code>\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u548c\u200bgithub repo\u200b\u4e2d\u200b\u7684\u200b\u5206\u652f\u200b\u4fdd\u6301\u4e00\u81f4\u200b</p> <p></p> <p>\u200b\u53f3\u952e\u200b<code>main</code>\u200b\u5206\u652f\u200b\uff0c\u200b\u5c1d\u8bd5\u200b<code>push</code></p> <p></p> <p>\u200b\u6b64\u65f6\u200b\u8fd8\u200b\u672a\u5b9a\u4e49\u200b<code>git remote</code>\uff0c\u200b\u70b9\u51fb\u200b<code>Define remote</code>\uff0c\u200b\u590d\u5236\u200b<code>github repo</code>\u200b\u7684\u200b\u94fe\u63a5\u200b\u7c98\u8d34\u200b\u8fdb\u53bb\u200b\uff0c\u200b\u518d\u6b21\u200b\u5c1d\u8bd5\u200b\u63a8\u9001\u200b</p> <p>\u200b\u4e0d\u51fa\u610f\u5916\u200b\uff0c\u200b\u5e94\u8be5\u200b\u8981\u51fa\u200b\u610f\u5916\u200b\u4e86\u200b\uff0cidea\u200b\u4f1a\u200b\u63d0\u793a\u200b<code>push reject</code>\uff0c\u200b\u4ee3\u8868\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b</p> <p></p> <p>\u200b\u89e3\u51b3\u529e\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u547d\u4ee4\u884c\u200b</li> </ol> Bash<pre><code>git fetch\ngit pull --rebase origin main\n</code></pre> <ol> <li>idea\u200b\u624b\u52a8\u200b\u62c9\u53d6\u200b</li> </ol> <p>\u200b\u9996\u5148\u200b\u8fdb\u884c\u200b<code>fetch</code>\uff0c\u200b\u7136\u540e\u200b\u8fdb\u884c\u200b<code>pull</code></p> <p></p> <p>\u200b\u6211\u200b\u8fd9\u91cc\u200b\u9009\u62e9\u200b\u547d\u4ee4\u884c\u200b\u6267\u884c\u200b</p> <p></p> <p>\u200b\u6b64\u65f6\u200b push \u200b\u6210\u529f\u200b\uff0crt</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/","title":"02.IdeaGit \u200b\u57fa\u7840\u200b\u64cd\u4f5c","text":"<p> \u200b\u7ea6\u200b 1713 \u200b\u4e2a\u200b\u5b57\u200b  26 \u200b\u884c\u200b\u4ee3\u7801\u200b  31 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 6 \u200b\u5206\u949f\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#1","title":"1. \u200b\u521d\u59cb\u5316","text":"Bash<pre><code>git init\n</code></pre> <p>\u200b\u67e5\u770b\u200b\u76ee\u5f55\u200b\u7ed3\u6784\u200b\u4e2d\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5305\u542b\u200b\u6709\u200b <code>.git</code> \u200b\u5b50\u76ee\u5f55\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u8bf4\u660e\u200b\u521b\u5efa\u200b\u7248\u672c\u200b\u5e93\u200b\u6210\u529f\u200b</p> <p>\u200b\u76f8\u5f53\u4e8e\u200bidea\u200b\u4e2d\u200b\u7684\u200b <code>vcs----create git repository</code></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#2","title":"2. \u200b\u5c06\u200b\u6587\u4ef6\u200b\u6dfb\u52a0\u200b\u5230\u200b\u7248\u672c\u200b\u5e93","text":"","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#21","title":"2.1 \u200b\u5c06\u200b\u6587\u4ef6\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6682\u5b58\u533a","text":"Bash<pre><code>git add 001.txt        // \u200b\u6dfb\u52a0\u200b\u5355\u4e2a\u200b\u6587\u4ef6\u200b\u5230\u200b\u6682\u5b58\u533a\u200b\ngit add .                // \u200b\u5c06\u200b\u5f53\u524d\u76ee\u5f55\u200b\u4e0b\u200b\u6240\u6709\u200b\u4fee\u6539\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6682\u5b58\u533a\u200b\uff0c\u200b\u9664\u200b\u6309\u7167\u200b\u89c4\u5219\u200b\u5ffd\u7565\u200b\u7684\u200b\u4e4b\u5916\u200b\n</code></pre> <p>\u200b\u76f8\u5f53\u4e8e\u200bidea\u200b\u4e2d\u200b\u7684\u200b<code>git --&gt; add</code></p> <p></p> <p>\u200b\u4e0d\u540c\u4e4b\u5904\u200b\u662f\u200b\u5728\u200bidea\u200b\u4e2d\u200b\u5373\u4fbf\u200b\u4e0d\u200b\u8fdb\u884c\u200b<code>add</code>\uff0c\u200b\u4f9d\u65e7\u200b\u53ef\u4ee5\u200b<code>commit</code></p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#22","title":"2.2 \u200b\u5c06\u200b\u6682\u5b58\u533a\u200b\u6587\u4ef6\u200b\u63d0\u4ea4\u200b\u5230\u200b\u4ed3\u5e93","text":"Bash<pre><code>git commit        // \u200b\u5982\u679c\u200b\u6682\u5b58\u533a\u200b\u6709\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u5176\u4e2d\u200b\u7684\u200b\u6587\u4ef6\u200b\u63d0\u4ea4\u200b\u5230\u200b\u4ed3\u5e93\u200b\ngit commit -m 'your comments'         // \u200b\u5e26\u200b\u8bc4\u8bba\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8bf4\u660e\u200b\u63d0\u4ea4\u200b\u5185\u5bb9\u200b\u3001\u200b\u53d8\u66f4\u200b\u3001\u200b\u4f5c\u7528\u200b\u7b49\u200b\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u548c\u200bidea\u200b\u4e2d\u200b\u7684\u200b<code>git -commit</code>\u200b\u4e00\u81f4\u200b\uff0c\u200b\u4e0d\u540c\u70b9\u200b\uff1a\u200b\u6ce8\u91ca\u200b\u5fc5\u987b\u200b\u5199\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#23","title":"2.3 \u200b\u67e5\u770b\u200b\u4ed3\u5e93\u200b\u72b6\u6001","text":"Bash<pre><code>git status\n</code></pre> <p>\u200b\u5728\u200bidea\u200b\u4e2d\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5728\u200bcommit\u200b\u754c\u9762\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6539\u52a8\u200b\u7684\u200b\u6240\u6709\u200b\u6587\u4ef6\u200b\u4ee5\u53ca\u200b\u672a\u200badd\u200b\u7684\u200b\u6587\u4ef6\u200b</p> <p>\u200b\u7ea2\u8272\u200b: \u200b\u4ee3\u8868\u200b\u672a\u200b<code>add</code>\u200b\u5230\u200b\u6682\u5b58\u533a\u200b \u200b\u7eff\u8272\u200b: \u200b\u4ee3\u8868\u200b\u5df2\u200b\u5728\u200b\u6682\u5b58\u533a\u200b\u4f46\u662f\u200b\u6709\u200b\u4fee\u6539\u200b \u200b\u65e0\u200b\u6807\u8bb0\u200b\uff1a\u200b\u4ee3\u8868\u200b\u65e0\u200b\u4fee\u6539\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#24","title":"2.4 \u200b\u67e5\u770b\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u7684\u200b\u5177\u4f53\u200b\u4fee\u6539","text":"Bash<pre><code>git diff    // \u200b\u67e5\u770b\u200b\u7248\u672c\u200b\u5e93\u4e2d\u200b\u6240\u6709\u200b\u7684\u200b\u6539\u52a8\u200b\ngit diff 001.txt        // \u200b\u67e5\u770b\u200b\u5177\u4f53\u200b\u6587\u4ef6\u200b\u7684\u200b\u6539\u52a8\u200b\n</code></pre> <p>\u200b\u5728\u200bidea\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b<code>commit</code>\u200b\u754c\u9762\u200b\u4e2d\u200b\u53cc\u51fb\u200b\u6587\u4ef6\u200b\u67e5\u770b\u200b\uff0c\u200b\u6216\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u53f3\u952e\u200b\u6807\u7b7e\u200b<code>--show diff with working tree</code>\u200b\u67e5\u770b\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#25","title":"2.5 \u200b\u67e5\u770b\u200b\u5386\u53f2\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55","text":"Bash<pre><code>git log     // \u200b\u663e\u793a\u200b\u6240\u6709\u200b\u63d0\u4ea4\u200b\u7684\u200b\u5386\u53f2\u8bb0\u5f55\u200b\ngit log --pretty=oneline    // \u200b\u5355\u884c\u200b\u663e\u793a\u200b\u63d0\u4ea4\u200b\u5386\u53f2\u8bb0\u5f55\u200b\u7684\u200b\u5185\u5bb9\u200b\n</code></pre> <p>\u200b\u76f8\u5f53\u4e8e\u200bidea\u200b\u4e2d\u200b\u7684\u200b<code>git</code>\u200b\u7a97\u53e3\u200b\uff0c\u200b\u540c\u65f6\u200b<code>commit id</code> \u200b\u4f4d\u4e8e\u200b\u53f3\u4e0b\u89d2\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#26","title":"2.6 \u200b\u7248\u672c\u200b\u56de\u9000","text":"Bash<pre><code>git reset --hard HEAD^        // \u200b\u56de\u9000\u200b\u5230\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u63d0\u4ea4\u200b\u7248\u672c\u200b\ngit reset --hard HEAD^^        // \u200b\u56de\u9000\u200b\u5230\u200b\u4e0a\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u63d0\u4ea4\u200b\u7248\u672c\u200b\ngit reset --hard 'commit_id'    // \u200b\u4f1a\u9000\u200b\u5230\u200b commit_id \u200b\u6307\u5b9a\u200b\u7684\u200b\u63d0\u4ea4\u200b\u7248\u672c\u200b\n</code></pre> <p>\u200b\u5982\u4e0b\u200b\u56fe\u200b\uff0c\u200b\u67d0\u4e2a\u200b<code>git</code>\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u5b58\u5728\u200b2\u200b\u4e2a\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u9700\u8981\u200b\u7248\u672c\u200b\u56de\u9000\u200b\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u8bb0\u5f55\u200b</p> <p></p> <p>\u200b\u8f93\u5165\u200b <code>git reset --hard f731</code></p> <p></p> <p>\u200b\u6b64\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u53cd\u6094\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u56de\u9000\u200b\uff0c\u200b\u5982\u4f55\u200b\u91cd\u65b0\u200b\u8fd4\u56de\u200b\uff1f</p> <p>\u200b\u8f93\u5165\u200b<code>git log</code>\uff0c\u200b\u53d1\u73b0\u200b\u4ec5\u200b\u5b58\u5728\u200b\u4e00\u6761\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u67e5\u8be2\u200b\u4e0d\u5230\u200b\u7b2c\u200b2\u200b\u6761\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55\u200b</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b<code>git reflog</code>\u200b\u627e\u5230\u200b\u4e4b\u524d\u200b\u7684\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55\u200b</p> Bash<pre><code>git reflog\ngit reset --hard 'commit_id'\n</code></pre> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#git","title":"git\u200b\u5de5\u4f5c\u200b\u533a\u57df","text":"<p><code>git reset</code>\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4e0d\u4ec5\u4ec5\u200b\u53ea\u6709\u200b<code>hard</code>\u200b\u4e00\u79cd\u200b\uff0c\u200b\u8fd8\u6709\u200b<code>soft</code>\u3001<code>mixed</code>\u3001<code>keep</code>\uff0c\u200b\u800c\u200b\u5728\u200b\u4ecb\u7ecd\u200b\u5b83\u4eec\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5f02\u540c\u200b\u524d\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u7406\u89e3\u200bgit\u200b\u7684\u200b\u5de5\u4f5c\u200b\u533a\u57df\u200b</p> <p></p> <ul> <li>Workspace\uff1a \u200b\u5de5\u4f5c\u200b\u533a\u200b\uff0c\u200b\u5c31\u662f\u200b\u4f60\u200b\u5e73\u65f6\u200b\u5b58\u653e\u200b\u9879\u76ee\u200b\u4ee3\u7801\u200b\u7684\u200b\u5730\u65b9\u200b</li> <li>Index / Stage\uff1a \u200b\u6682\u5b58\u533a\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4e34\u65f6\u200b\u5b58\u653e\u200b\u4f60\u200b\u7684\u200b\u6539\u52a8\u200b\uff0c\u200b\u4e8b\u5b9e\u4e0a\u200b\u5b83\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5373\u5c06\u200b\u63d0\u4ea4\u200b\u5230\u200b\u6587\u4ef6\u200b\u5217\u8868\u200b\u4fe1\u606f\u200b</li> <li>Repository\uff1a \u200b\u4ed3\u5e93\u533a\u200b\uff08\u200b\u6216\u200b\u7248\u672c\u200b\u5e93\u200b\uff09\uff0c\u200b\u5c31\u662f\u200b\u5b89\u5168\u200b\u5b58\u653e\u6570\u636e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u8fd9\u200b\u91cc\u9762\u200b\u6709\u200b\u4f60\u200b\u63d0\u4ea4\u200b\u5230\u200b\u6240\u6709\u200b\u7248\u672c\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u5176\u4e2d\u200bHEAD\u200b\u6307\u5411\u200b\u6700\u65b0\u200b\u653e\u5165\u200b\u4ed3\u5e93\u200b\u7684\u200b\u7248\u672c\u200b</li> <li>Remote\uff1a \u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u6258\u7ba1\u200b\u4ee3\u7801\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7b80\u5355\u200b\u7684\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u4f60\u200b\u9879\u76ee\u7ec4\u200b\u4e2d\u200b\u7684\u200b\u4e00\u53f0\u200b\u7535\u8111\u200b\u7528\u4e8e\u200b\u8fdc\u7a0b\u200b\u6570\u636e\u4ea4\u6362\u200b</li> </ul> <p>\u200b\u6267\u884c\u200b<code>reset</code>\u200b\u547d\u4ee4\u200b\u540e\u200b\u8fd8\u200b\u5b58\u5728\u200b\u6587\u4ef6\u200b\u7684\u200b\u533a\u57df\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#261-git-reset-soft","title":"2.6.1 git reset --soft","text":"<p>\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u79fb\u52a8\u200b\u672c\u5730\u200b\u5e93\u200bHEAD\u200b\u6307\u9488\u200b</p> <p>\u200b\u524d\u7f6e\u200b\u51c6\u5907\u200b(\u200b\u5176\u4ed6\u200b\u6f14\u793a\u200b\u7c7b\u4f3c\u200b\u4e0d\u200b\u505a\u200b\u8fc7\u200b\u591a\u200b\u8d58\u8ff0\u200b)</p> <p>\u200b\u7c7b\u4f3c\u200b\u4e0a\u6587\u200b\uff0c\u200b\u67d0\u4e2a\u200b<code>git</code>\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u5b58\u5728\u200b2\u200b\u4e2a\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u9700\u8981\u200b\u7248\u672c\u200b\u56de\u9000\u200b\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u8bb0\u5f55\u200b</p> <p>\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b</p> <p></p> <p>\u200b\u8f93\u5165\u200b\u4e0b\u8ff0\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>soft</code>\u200b\u56de\u6eda\u200b\uff0c\u200b\u5e76\u200b\u63a8\u9001\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b</p> Bash<pre><code>git reset --soft 'commitid'\ngit push --force origin master # \u200b\u6ce8\u610f\u200b\u8fd9\u91cc\u200b\u8981\u200b\u5f3a\u5236\u200b\u63a8\u9001\u200b\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u7b2c\u200b2\u200b\u6b21\u200b\u63d0\u4ea4\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e86\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u7248\u672c\u200b\u5e93\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b</p> <p></p> <p>\u200b\u8fd0\u884c\u200b <code>git status</code> \u200b\u548c\u200b <code>ll</code>(alias for <code>ls -l</code>), \u200b\u89c2\u5bdf\u200b\u7ed3\u679c\u200b\u53ef\u77e5\u200b\u5de5\u4f5c\u200b\u533a\u200b\u548c\u200b\u6682\u5b58\u533a\u200b\u672a\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b</p> <p></p> <p>\u200b\u7ed3\u8bba\u200b</p> <p>soft\u200b\u53ea\u200b\u5f71\u54cd\u200b\u7248\u672c\u200b\u5e93\u200b\uff0c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u5de5\u4f5c\u200b\u533a\u200b\u548c\u200b\u6682\u5b58\u533a\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#262-git-reset-mixed","title":"2.6.2 git reset --mixed","text":"<p>\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u79fb\u52a8\u200b\u672c\u5730\u200b\u5e93\u200bHEAD\u200b\u6307\u9488\u200b \u200b\u91cd\u7f6e\u200b\u6682\u5b58\u533a\u200b</p> <p>\u200b\u8f93\u5165\u200b\u4e0b\u8ff0\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f7f\u7528\u200bmixed\u200b\u56de\u6eda\u200b\uff0c\u200b\u5e76\u200b\u63a8\u9001\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b</p> Bash<pre><code>git reset --mixed 'commitid'\ngit push --force origin master # \u200b\u6ce8\u610f\u200b\u8fd9\u91cc\u200b\u8981\u200b\u5f3a\u5236\u200b\u63a8\u9001\u200b\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u7b2c\u200b2\u200b\u6b21\u200b\u63d0\u4ea4\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e86\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u7248\u672c\u200b\u5e93\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b</p> <p></p> <p>\u200b\u8fd0\u884c\u200b <code>git status</code> \u200b\u548c\u200b <code>ll</code>(alias for <code>ls -l</code>), \u200b\u89c2\u5bdf\u200b\u7ed3\u679c\u200b\u53ef\u77e5\u200b\u5de5\u4f5c\u200b\u533a\u672a\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b\uff0c\u200b\u6682\u5b58\u533a\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b(\u200b\u4e22\u5931\u200b\u4e86\u200b\u5bf9\u200bt2\u200b\u7684\u200b\u8ffd\u8e2a\u200b)</p> <p></p> <p>\u200b\u7ed3\u8bba\u200b</p> <p>mixed\u200b\u5f71\u54cd\u200b\u7248\u672c\u200b\u5e93\u200b\u548c\u200b\u6682\u5b58\u533a\u200b\uff0c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u5de5\u4f5c\u200b\u533a\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#263-git-reset-hard","title":"2.6.3 git reset --hard","text":"<p>\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u79fb\u52a8\u200b\u672c\u5730\u200b\u5e93\u200bHEAD\u200b\u6307\u9488\u200b \u200b\u91cd\u7f6e\u200b\u6682\u5b58\u533a\u200b \u200b\u91cd\u7f6e\u200b\u5de5\u4f5c\u200b\u533a\u200b</p> <p>\u200b\u8f93\u5165\u200b\u4e0b\u8ff0\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f7f\u7528\u200bhard\u200b\u56de\u6eda\u200b\uff0c\u200b\u5e76\u200b\u63a8\u9001\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b</p> Bash<pre><code>git reset --hard 'commitid'\ngit push --force origin master # \u200b\u6ce8\u610f\u200b\u8fd9\u91cc\u200b\u8981\u200b\u5f3a\u5236\u200b\u63a8\u9001\u200b\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u7b2c\u200b2\u200b\u6b21\u200b\u63d0\u4ea4\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e86\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u7248\u672c\u200b\u5e93\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b</p> <p></p> <p>\u200b\u8fd0\u884c\u200b <code>git status</code> \u200b\u548c\u200b <code>ll</code>(alias for <code>ls -l</code>), \u200b\u89c2\u5bdf\u200b\u7ed3\u679c\u200b\u53ef\u77e5\u200b\u5de5\u4f5c\u200b\u533a\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b\uff0c\u200b\u6682\u5b58\u533a\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b(\u200b\u4e22\u5931\u200b\u4e86\u200b\u5bf9\u200bt2\u200b\u7684\u200b\u8ffd\u8e2a\u200b)</p> <p></p> <p>\u200b\u7ed3\u8bba\u200b</p> <p>hard\u200b\u5f71\u54cd\u200b\u7248\u672c\u200b\u5e93\u200b\u3001\u200b\u6682\u5b58\u533a\u200b\u548c\u200b\u5de5\u4f5c\u200b\u533a\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#264-git-reset-keep","title":"2.6.4 git reset --keep","text":"<p>\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u79fb\u52a8\u200b\u672c\u5730\u200b\u5e93\u200bHEAD\u200b\u6307\u9488\u200b \u200b\u91cd\u7f6e\u200b\u6682\u5b58\u533a\u200b \u200b\u91cd\u7f6e\u200b\u5de5\u4f5c\u200b\u533a\u200b, \u200b\u4fdd\u7559\u200b\u6539\u52a8\u200b</p> <p><code>keep</code>\u200b\u6a21\u5f0f\u200b\u548c\u200b<code>hard</code>\u200b\u6a21\u5f0f\u200b\u6709\u4e9b\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u200b\u5de5\u4f5c\u200b\u533a\u200b\u7684\u200b\u64cd\u4f5c\u200b\u6709\u4e9b\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5177\u4f53\u200b\u5982\u4e0b\u200b</p> <p>\u200b\u5de5\u4f5c\u200b\u533a\u4e2d\u200b\u6587\u4ef6\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7248\u672c\u200b\u548c\u200b\u9000\u56de\u200b\u7248\u672c\u200b\u4e4b\u95f4\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u8fc7\u200b\u53d8\u52a8\u200b\uff0c\u200b\u5219\u200b\u5de5\u4f5c\u200b\u533a\u200b\u7684\u200b\u4fee\u6539\u200b\u4fdd\u6301\u200b\u4e0d\u4fbf\u200b\uff1b\u200b\u5982\u679c\u200b\u53d1\u751f\u200b\u4e86\u200b\u53d8\u52a8\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5de5\u4f5c\u200b\u533a\u200b\u4e5f\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4fee\u6539\u200b\uff0c\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u5408\u5e76\u200b\uff08\u200b\u6216\u8005\u200b\u51b2\u7a81\u200b\u89e3\u51b3\u200b\uff09    </p> <p>1. \u200b\u5de5\u4f5c\u200b\u533a\u200b\u6587\u4ef6\u200b\u672a\u200b\u53d1\u751f\u200b\u53d8\u52a8\u200b</p> Bash<pre><code>git reset --keep 'commitid'\n</code></pre> <p>\u200b\u4e0e\u200b<code>hard</code>\u200b\u6a21\u5f0f\u200b\u4fdd\u6301\u4e00\u81f4\u200b\uff0c\u200b\u7248\u672c\u200b\u5e93\u200b\u3001\u200b\u6682\u5b58\u533a\u200b\u548c\u200b\u5de5\u4f5c\u200b\u533a\u5747\u200b\u53d1\u751f\u200b\u4fee\u6539\u200b</p> <p></p> <p>2. \u200b\u5de5\u4f5c\u200b\u533a\u200b\u6587\u4ef6\u200b\u53d1\u751f\u200b\u53d8\u52a8\u200b</p> <p>\u200b\u5728\u200b<code>reset</code>\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5c06\u200b<code>t1</code>\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b<code>111</code>\u200b\u6539\u4e3a\u200b<code>311</code>\uff0c\u200b\u5e76\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6682\u5b58\u533a\u200b</p> <p></p> <p>\u200b\u6267\u884c\u200breset</p> Bash<pre><code>git reset --keep 'commitid'\n</code></pre> <p>\u200b\u795e\u5947\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u52a0\u5165\u200b\u6682\u5b58\u533a\u200b\u7684\u200b\u5bf9\u5e94\u200b\u6587\u4ef6\u200b\u53d1\u751f\u200b\u7684\u200b\u53d8\u52a8\u200b\u4e5f\u200b\u88ab\u200b\u4fdd\u7559\u200b\u4e86\u200b\u4e0b\u6765\u200b</p> <p></p> <p>\u200b\u518d\u200b\u6765\u770b\u200b\u53d8\u52a8\u200b\u7684\u200b\u53e6\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5728\u200b<code>reset</code>\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5c06\u200b<code>t1</code>\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b<code>111</code>\u200b\u6539\u4e3a\u200b<code>311</code>\uff0c\u200b\u4e14\u200b\u5c06\u200b<code>t2</code>\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b<code>222</code>\u200b\u6539\u6210\u200b<code>322</code>\uff0c\u200b\u5e76\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6682\u5b58\u533a\u200b</p> <p></p> <p>\u200b\u6267\u884c\u200b reset</p> Bash<pre><code>git reset --keep 'commitid'\n</code></pre> <p>\u200b\u53d1\u73b0\u200b\u51fa\u73b0\u200b\u62a5\u9519\u200b\uff0c\u200b\u539f\u56e0\u200b\u662f\u200b<code>f731</code>\u200b\u7248\u672c\u200b\u4e2d\u200b<code>t2</code>\u200b\u6587\u4ef6\u200b\u662f\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u65e0\u6cd5\u200b<code>merge</code></p> <p></p> <p>\u200b\u7ed3\u8bba\u200b</p> <p>keep\u200b\u5f71\u54cd\u200b\u7248\u672c\u200b\u5e93\u200b\u3001\u200b\u6682\u5b58\u533a\u200b\u548c\u200b\u5de5\u4f5c\u200b\u533a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u64a4\u9500\u200b\u63d0\u4ea4\u200b\u800c\u200b\u4e0d\u200b\u4e22\u5931\u200b\u6587\u4ef6\u200b\u7684\u200b\u66f4\u6539\u200b</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u5b66\u4e60\u200bidea git\u200b\u4e2d\u200b\u7684\u200b\u7248\u672c\u200b\u56de\u9000\u200b</p> <p>\u200b\u9996\u5148\u200b\u5728\u200b\u9879\u76ee\u200b\u4e2d\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b <code>GitResetTest.java</code> \u200b\u7684\u200b\u6587\u4ef6\u200b</p> <p>\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6682\u5b58\u533a\u200b\u5e76\u200b\u63d0\u4ea4\u200b</p> <p></p> <p>\u200b\u4fee\u6539\u200b\u6587\u4ef6\u200b\uff0c\u200b\u518d\u6b21\u200b\u63d0\u4ea4\u200b</p> <p></p> <p>\u200b\u53f3\u952e\u200b\u5e0c\u671b\u200b\u56de\u9000\u200b\u5230\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u9009\u62e9\u200b<code>Reset</code></p> <p></p> <p>\u200b\u9009\u62e9\u200bhard\u200b\u6a21\u5f0f\u200b</p> <p></p> <p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u64a4\u9500\u200b\u56de\u6eda\u200b\uff0c\u200b\u540c\u6837\u200b\u9700\u8981\u200b\u67e5\u8be2\u200b<code>reflog</code>, \u200b\u6253\u5f00\u200b<code>terminal</code>\u200b\u8f93\u5165\u200b<code>git reflog</code>, \u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b<code>commitid</code></p> <p></p> <p>\u200b\u901a\u8fc7\u200b\u53f3\u952e\u200b\u9879\u76ee\u200b\u7684\u200breset head\u200b\u8fdb\u884c\u200b\u56de\u9000\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#27","title":"2.7 \u200b\u64a4\u9500\u200b\u4fee\u6539","text":"Bash<pre><code>git checkout -- 004.txt   // \u200b\u5982\u679c\u200b 004.txt \u200b\u6587\u4ef6\u200b\u5728\u200b\u5de5\u4f5c\u200b\u533a\u200b\uff0c\u200b\u5219\u200b\u4e22\u5f03\u200b\u5176\u200b\u4fee\u6539\u200b\ngit checkout -- .            // \u200b\u4e22\u5f03\u200b\u5f53\u524d\u76ee\u5f55\u200b\u4e0b\u200b\u6240\u6709\u200b\u5de5\u4f5c\u200b\u533a\u4e2d\u200b\u6587\u4ef6\u200b\u7684\u200b\u4fee\u6539\u200b\n</code></pre> <p>idea\u200b\u4e2d\u200b\uff1a</p> <p></p> <p>\u200b\u6ce8\u610f\u200b\u5230\u200b\u5728\u200b<code>rollback</code>\u200b\u53f3\u4fa7\u200b\u6709\u200b\u4e00\u4e2a\u200b\u9759\u9ed8\u200b\u6401\u7f6e\u200b\u6309\u94ae\u200b</p> <p></p> <p>\u200b\u70b9\u51fb\u200b\u4e4b\u540e\u200b\u4fee\u6539\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e5f\u200b\u4f1a\u200b\u6d88\u5931\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u4e3b\u8981\u200b\u662f\u200b\u7528\u4e8e\u200b\u6682\u5b58\u200b\u4f60\u200b\u4fee\u6539\u200b\u540e\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5e76\u200b\u628a\u200b\u4f60\u200b\u5de5\u4f5c\u200b\u533a\u200b\u7684\u200b\u4ee3\u7801\u200b\u56de\u6eda\u200b\u5230\u200b\u6700\u540e\u200bcommit\u200b\u7684\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u6062\u590d\u200b\u7684\u200b\u65f6\u5019\u200b\u901a\u8fc7\u200b:</p> <p></p> <p>\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\u5177\u4f53\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5462\u200b\uff1f</p> <p>\u200b\u8bd5\u60f3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5728\u200b\u6211\u4eec\u200b\u5f00\u53d1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6b63\u5728\u200b\u5199\u200b\u67d0\u4e2a\u200b\u9700\u6c42\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u7136\u800c\u200b\u6b64\u65f6\u200b\u9879\u76ee\u7ecf\u7406\u200b\u8981\u6c42\u200b\u4f60\u200b\u53bb\u200b\u505a\u200b\u4e00\u4e2a\u200b\u66f4\u52a0\u200b\u91cd\u8981\u200b/\u200b\u7d27\u8feb\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u90a3\u4e48\u200b\u73b0\u5728\u200b\u8fd9\u90e8\u5206\u200b\u9700\u6c42\u200b\u4ee3\u7801\u200b\u6682\u672a\u200b\u5199\u200b\u5b8c\u200b\uff0c\u200b\u662f\u200b\u4e0d\u80fd\u200b\u63d0\u4ea4\u200b\u7684\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u9759\u9ed8\u200b\u6401\u7f6e\u200b\uff0c\u200b\u5c06\u200b\u4ee3\u7801\u200b\u6682\u65f6\u200b\u6401\u7f6e\u200b\uff0c\u200b\u7b49\u5230\u200b\u628a\u200b\u9879\u76ee\u7ecf\u7406\u200b\u7684\u200b\u4efb\u52a1\u200b\u5fd9\u200b\u5b8c\u540e\u200b\uff0c\u200b\u9009\u62e9\u200b\u53d6\u6d88\u200b\u9759\u9ed8\u200b\uff0c\u200b\u63a5\u7740\u200b\u5199\u200b\u5373\u53ef\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/02ideagit-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#28","title":"2.8 \u200b\u5220\u9664\u200b\u6587\u4ef6","text":"<p>\u200b\u5728\u200b\u88ab\u200b git \u200b\u7ba1\u7406\u200b\u7684\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u5982\u4e0b\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\u6765\u200b\u8bb0\u5f55\u200b\u5220\u9664\u200b\u52a8\u4f5c\u200b\uff1a</p> <ol> <li><code>rm + git commit -am \"abc\"</code></li> <li><code>git rm + git commit -m \"abc\"</code></li> </ol> <p>\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b</p> <ul> <li>\u200b\u5982\u679c\u200b\u6587\u4ef6\u200b\u5df2\u7ecf\u200b\u88ab\u200bgit\u200b\u8ddf\u8e2a\u200b\uff0c\u200b\u90a3\u4e48\u200b 1\u30012 \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b</li> <li>\u200b\u5982\u679c\u200b\u6587\u4ef6\u200b\u672a\u200b\u88ab\u200bgit\u200b\u8ddf\u8e2a\u200b<ul> <li><code>rm + git commit -am \"abc\"</code> \u200b\u4e0d\u4f1a\u200b\u63d0\u4ea4\u200b\u5220\u9664\u200b</li> <li><code>git rm + git commit -m \"abc\"</code> \u200b\u53ef\u4ee5\u200b\u786e\u4fdd\u200b\u6587\u4ef6\u200b\u5220\u9664\u200b\u88ab\u200bgit\u200b\u8bb0\u5f55\u200b\u5e76\u200b\u63d0\u4ea4\u200b</li> </ul> </li> </ul>","tags":["tools","git"]},{"location":"blog/2025/02/02/03ideagit-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/","title":"03.IdeaGit \u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93","text":"<p> \u200b\u7ea6\u200b 149 \u200b\u4e2a\u200b\u5b57\u200b  5 \u200b\u884c\u200b\u4ee3\u7801\u200b  2 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/03ideagit-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#1","title":"1. \u200b\u514b\u9686\u200b\u4ed3\u5e93","text":"Bash<pre><code>git clone \u200b\u4f60\u200b\u7684\u200b\u4ed3\u5e93\u200b\u5730\u5740\u200b\n</code></pre> <p>idea\u200b\u4e2d\u5373\u200b\u521b\u5efa\u200b\u9879\u76ee\u200b\u7684\u200b\u65f6\u5019\u200b\u9009\u62e9\u200b from version control</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/03ideagit-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#2","title":"2. \u200b\u6dfb\u52a0\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93","text":"Bash<pre><code>git remote add origin \u200b\u4f60\u200b\u7684\u200b\u4ed3\u5e93\u200b\u5730\u5740\u200b\n</code></pre>","tags":["tools","git"]},{"location":"blog/2025/02/02/03ideagit-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#3","title":"3. \u200b\u67e5\u770b\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4fe1\u606f","text":"Bash<pre><code>git remote [-v] // \u200b\u663e\u793a\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4fe1\u606f\u200b\n</code></pre> <p>idea\u200b\u4e2d\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/03ideagit-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#4","title":"4. \u200b\u63a8\u9001\u200b\u672c\u5730\u200b\u5185\u5bb9\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93","text":"Bash<pre><code>git push -u origin &lt;branch&gt;\n</code></pre> <p><code>-u</code> \u200b\u4ee3\u8868\u200b\u8bbe\u7f6e\u200b\u4e0a\u6e38\u200b\u5206\u652f\u200b\u3002</p> <p>\u200b\u5728\u200b\u6267\u884c\u200b <code>git push -u origin &lt;branch&gt;</code> \u200b\u540e\u200b\uff0cGit \u200b\u4f1a\u200b\u5c06\u200b\u5f53\u524d\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u4e0e\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u7684\u200b <code>&lt;branch&gt;</code> \u200b\u5206\u652f\u200b\u5173\u8054\u200b\u3002\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u7b80\u5355\u200b\u5730\u200b\u4f7f\u7528\u200b <code>git push</code>\u200b\u6216\u200b <code>git pull</code>\uff0cGit \u200b\u4f1a\u200b\u77e5\u9053\u200b\u5e94\u8be5\u200b\u63a8\u9001\u200b/\u200b\u62c9\u53d6\u200b\u54ea\u4e2a\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u6bcf\u6b21\u200b\u90fd\u200b\u6307\u5b9a\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u7684\u200b\u540d\u79f0\u200b\u3002</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/03ideagit-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/#5","title":"5. \u200b\u4fee\u6539\u200b\u672c\u5730\u200b\u4ed3\u5e93\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u5730\u5740","text":"Bash<pre><code>git remote set-url origin url\n</code></pre>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/","title":"04.IdeaGit \u200b\u5206\u652f\u200b\u7ba1\u7406","text":"<p> \u200b\u7ea6\u200b 1063 \u200b\u4e2a\u200b\u5b57\u200b  29 \u200b\u884c\u200b\u4ee3\u7801\u200b  25 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 4 \u200b\u5206\u949f\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#1","title":"1. \u200b\u67e5\u770b\u200b\u5206\u652f","text":"Bash<pre><code>git branch        // \u200b\u67e5\u770b\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u4fe1\u606f\u200b\ngit branch -v     // \u200b\u67e5\u770b\u200b\u76f8\u5bf9\u200b\u8be6\u7ec6\u200b\u7684\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u4fe1\u606f\u200b\ngit branch -av     // \u200b\u67e5\u770b\u200b\u5305\u62ec\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u5728\u5185\u200b\u7684\u200b\u5206\u652f\u200b\u4fe1\u606f\u200b\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\uff1a\u200b\u5728\u200b <code>git branch</code> \u200b\u7684\u200b\u8f93\u51fa\u200b\u5185\u5bb9\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u524d\u9762\u200b\u5e26\u6709\u200b <code>*</code> \u200b\u53f7\u200b\uff0c\u200b\u8fd9\u200b\u6807\u8bc6\u200b\u6211\u4eec\u200b\u5f53\u524d\u200b\u6240\u5728\u200b\u7684\u200b\u5206\u652f\u200b\u3002</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#2","title":"2. \u200b\u521b\u5efa\u200b\u5206\u652f","text":"<p>\u200b\u5206\u652f\u200b\u521b\u5efa\u200b\u540e\u200b\uff0c\u200b\u65b0\u200b\u5206\u652f\u200b\u57fa\u4e8e\u200b\u5f53\u524d\u200b\u5206\u652f\u200b\u3002</p> Bash<pre><code>git branch dev \n</code></pre> <p>idea \u200b\u4e2d\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#3","title":"3. \u200b\u5207\u6362\u200b\u5206\u652f","text":"Bash<pre><code>git checkout dev\n</code></pre> <p>idea:</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#4","title":"4. \u200b\u521b\u5efa\u200b\u5e76\u200b\u5207\u6362\u200b\u5206\u652f","text":"Bash<pre><code>git checkout -b dev # \u200b\u65b0\u5efa\u200b dev \u200b\u5206\u652f\u200b\uff0c\u200b\u5e76\u200b\u5207\u6362\u200b\u5230\u200b\u8be5\u200b\u5206\u652f\u200b\u4e0a\u200b\n</code></pre>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#5","title":"5. \u200b\u5408\u5e76\u200b\u5206\u652f","text":"Bash<pre><code>git checkout master        # \u200b\u5207\u6362\u200b\u56de\u200b master \u200b\u5206\u652f\u200b\ngit merge dev            # \u200b\u5c06\u200b dev \u200b\u5206\u949f\u200b\u4e2d\u200b\u7684\u200b\u4fee\u6539\u200b\u5408\u5e76\u200b\u56de\u200b master \u200b\u5206\u652f\u200b\n</code></pre> <p>idea:\u200b\u5148\u200bcheck out \u200b\u5230\u200b\u6307\u5b9a\u200b\u6807\u7b7e\u200b\uff0c\u200b\u5728\u200b\u628a\u200b\u9700\u8981\u200b\u5408\u5e76\u200b\u7684\u200b\u6807\u7b7e\u200b\u53f3\u952e\u200b\u5408\u5e76\u200b\u5373\u53ef\u200b\u3002</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#6","title":"6. \u200b\u5220\u9664\u200b\u5206\u652f","text":"Bash<pre><code>git branch -d dev # \u200b\u5220\u9664\u200b dev \u200b\u5206\u652f\u200b\n</code></pre>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#7","title":"7. \u200b\u5efa\u7acb\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u548c\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u7684\u200b\u5173\u8054","text":"","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#71","title":"7.1 \u200b\u672c\u5730\u200b\u5206\u652f\u200b\u5b58\u5728\u200b\uff0c\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u5b58\u5728\u200b\uff0c\u200b\u4f46\u200b\u4e4b\u95f4\u200b\u6ca1\u6709\u200b\u5173\u8054\u200b\u5173\u7cfb\u200b\u3002","text":"Bash<pre><code>git push -u origin/remote_branch \u200b\u547d\u4ee4\u200b\u63a8\u9001\u200b\u3002\n</code></pre>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#72","title":"7.2 \u200b\u672c\u5730\u200b\u5206\u652f\u200b\u5b58\u5728\u200b\uff0c\u200b\u4f46\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u4e0d\u200b\u5b58\u5728\u200b\u3002","text":"Bash<pre><code>git push origin local_branch:remote_branch \n</code></pre>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#73","title":"7.3 \u200b\u672c\u5730\u200b\u5206\u652f\u200b\u5b58\u5728\u200b\uff0c\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u5b58\u5728\u200b\uff0c\u200b\u4e14\u200b\u5173\u8054\u200b\u5173\u7cfb\u200b\u5df2\u200b\u5efa\u7acb","text":"<p>\u200b\u4f7f\u7528\u200b <code>git push</code> \u200b\u547d\u4ee4\u200b\u8fdb\u884c\u200b\u63a8\u9001\u200b\u5373\u53ef\u200b</p> <p>idea\u200b\u4e2d\u200b\u672c\u5730\u200b<code>push</code>\u200b\u65f6\u200b\u76f4\u63a5\u200b\u4fee\u6539\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u540d\u200b\u5373\u53ef\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#8","title":"8. \u200b\u4ece\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u62c9\u53d6","text":"<p>\u200b\u901a\u8fc7\u200b <code>git fetch</code> \u200b\u548c\u200b <code>git pull</code> \u200b\u6765\u200b\u83b7\u53d6\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> Bash<pre><code>git fetch origin master    \ngit pull origin master\n</code></pre> <p><code>git fetch</code> \u200b\u548c\u200b <code>git pull</code> \u200b\u4e4b\u95f4\u200b\u7684\u200b\u533a\u522b\u200b\uff1a</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#81-git-fetch","title":"8.1 git fetch","text":"<p><code>git fetch</code> \u200b\u662f\u200b\u4ec5\u4ec5\u200b\u83b7\u53d6\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u7684\u200b\u66f4\u65b0\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u81ea\u52a8\u200b\u505a\u200b\u5408\u5e76\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u5148\u200b\u67e5\u770b\u200b\u66f4\u65b0\u200b\uff1a</p> Bash<pre><code>git log -p FETCH_HEAD\n</code></pre> <p>\u200b\u6216\u8005\u200b\u62c9\u53d6\u200b\u5230\u200b\u4e00\u4e2a\u200b\u5176\u4ed6\u200b\u5206\u652f\u200b\uff08\u200b\u76ee\u524d\u200b\u8fd8\u200b\u6ca1\u89c1\u200b\u8fc7\u200b\u5206\u652f\u200b\u521b\u5efa\u200b\uff09</p> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff1a</p> Bash<pre><code>git merge origin/master\n</code></pre> <p>\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200b\u672c\u5730\u200b\u5206\u652f\u200b\uff0c\u200b\u62c9\u53d6\u200b\u8fdc\u7a0b\u200b\u5230\u200b\u672c\u5730\u200btemp,\u200b\u67e5\u770b\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6ca1\u200b\u95ee\u9898\u200b\u5219\u200b\u5408\u5e76\u200b\uff0c\u200b\u5408\u5e76\u200b\u540e\u200b\u5220\u9664\u200b\u5373\u53ef\u200b\u3002</p> Bash<pre><code>## \u200b\u5728\u200b\u672c\u5730\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200btemp\u200b\u5206\u652f\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u8fdc\u7a0b\u200borigin\u200b\u4ed3\u5e93\u200b\u7684\u200bmaster\u200b\u5206\u652f\u200b\u4ee3\u7801\u200b\u4e0b\u8f7d\u200b\u5230\u200b\u672c\u5730\u200btemp\u200b\u5206\u652f\u200b\uff1b\n$ git fetch origin master:temp\n\n## \u200b\u6bd4\u8f83\u200b\u672c\u5730\u200b\u4ee3\u7801\u200b\u4e0e\u200b\u521a\u521a\u200b\u4ece\u200b\u8fdc\u7a0b\u200b\u4e0b\u8f7d\u200b\u4e0b\u6765\u200b\u7684\u200b\u4ee3\u7801\u200b\u7684\u200b\u533a\u522b\u200b\uff1b\n$ git diff temp\n\n## \u200b\u5408\u5e76\u200btemp\u200b\u5206\u652f\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200bmaster\u200b\u5206\u652f\u200b;\n$ git merge temp\n\n## \u200b\u5982\u679c\u200b\u4e0d\u60f3\u200b\u4fdd\u7559\u200btemp\u200b\u5206\u652f\u200b\uff0c\u200b\u5220\u9664\u200b;\n$ git branch -d temp\n</code></pre> <p>\u200b\u5b9e\u673a\u200b\u6f14\u793a\u200b:</p> <p>\u200b\u5728\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u624b\u52a8\u200b\u4fee\u6539\u200b<code>t1</code>\u200b\u7684\u200b<code>111</code>\u200b\u4e3a\u200b<code>511</code>, \u200b\u5728\u200b\u672c\u5730\u200b\u4ed3\u5e93\u200b\u7684\u200b<code>t1</code>\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u6dfb\u52a0\u200b<code>666</code>\u200b\u5e76\u200b<code>commit</code></p> <p>1. git fetch origin master:temp</p> <p></p> <p>2. git diff temp</p> <p></p> <p>3. git merge temp</p> <p>\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\uff0c\u200b\u624b\u52a8\u200b\u89e3\u51b3\u200b</p> <p></p> <p>\u200b\u9009\u62e9\u200b\u5168\u90e8\u200b\u63a5\u53d7\u200b(<code>lazygit</code>\u200b\u6309\u200b<code>b</code>)\uff0c\u200b\u5f53\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u9009\u62e9\u200b\u67d0\u200b\u4e00\u4e2a\u200b<code>hunk</code></p> <p></p> <p>\u200b\u6700\u7ec8\u200b<code>commit log</code>\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b</p> <p></p> <p>4. git branch -d temp</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#82-git-pull","title":"8.2 git pull","text":"<p><code>git pull</code> \u200b\u5728\u200b\u83b7\u53d6\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u7684\u200b\u5185\u5bb9\u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u505a\u200b\u5408\u5e76\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u6210\u200b <code>git fetch</code> \u200b\u4e4b\u540e\u200b <code>git merge</code>\u3002</p> Bash<pre><code># \u200b\u56e0\u4e3a\u200b\u5b58\u5728\u200b\u51b2\u7a81\u200b\u6545\u200bgit pull\u200b\u4f1a\u200b\u62a5\u9519\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u4e8c\u9009\u200b\u4e00\u200b\u5373\u53ef\u200b\ngit pull --no-rebase # merge\u200b\u51b2\u7a81\u200b\ngit pull --rebase # rebase\u200b\u51b2\u7a81\u200b\n</code></pre> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#83-idea","title":"8.3 idea \u200b\u62c9\u53d6\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93","text":"","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#1_1","title":"1. \u200b\u524d\u7f6e\u200b\u51c6\u5907","text":"<p>\u200b\u672c\u5730\u200b\u521b\u5efa\u200b<code>GitPullTest.java</code>\u200b\u5e76\u200b\u6dfb\u52a0\u200b<code>f1</code>\u200b\u51fd\u6570\u200b\uff0c\u200b\u63d0\u4ea4\u200b\u5e76\u200b\u63a8\u9001\u200b</p> <p></p> <p>\u200b\u672c\u5730\u200b\u4ed3\u5e93\u200b\u6dfb\u52a0\u200b<code>f2</code>\u200b\u51fd\u6570\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4ea4\u200b</p> <p></p> <p>\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u6dfb\u52a0\u200b<code>f3</code>\u200b\u51fd\u6570\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4ea4\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#2-git-fetch","title":"2. git fetch","text":"<p>\u200b\u627e\u5230\u200bidea\u200b\u4e0a\u65b9\u200b<code>git</code>\u200b\u83dc\u5355\u200b\uff0c\u200b\u9009\u62e9\u200b<code>fetch</code> (\u200b\u8fd9\u91cc\u200b\u4ec5\u200b\u6f14\u793a\u200b<code>fetch</code>\uff0c\u200b\u4e0d\u200b\u6f14\u793a\u200b<code>pull</code>\uff0c\u200b\u601d\u60f3\u200b\u90fd\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b)</p> <p></p> <p>\u200b\u9009\u62e9\u200b<code>remote</code>\u200b\u4e0b\u200b\u7684\u200b<code>main</code>\u200b\u5206\u652f\u200b\uff0c\u200b\u67e5\u770b\u200b\u66f4\u6539\u200b</p> <p></p> <p>\u200b\u68c0\u67e5\u200b\u8fc7\u540e\u200b\u53d1\u73b0\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u53f3\u952e\u200b<code>remote</code>\u200b\u7684\u200b<code>main</code>\u200b\u5206\u652f\u200b\uff0c\u200b\u9009\u62e9\u200b<code>merge</code>\u200b\u6216\u200b<code>rebase</code>\u200b\u5408\u5e76\u200b</p> <p></p> <p>\u200b\u9009\u62e9\u200b<code>merge</code>\uff0c\u200b\u53d1\u73b0\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\uff0c\u200b\u9700\u8981\u200b\u89e3\u51b3\u200b</p> <p></p> <p>\u200b\u70b9\u51fb\u200b<code>merge</code>\u200b\u6309\u94ae\u200b\uff0c\u200b\u5f39\u200b\u51fa\u200b\u51b2\u7a81\u200b\u89e3\u51b3\u200b\u9875\u9762\u200b</p> <p></p> <p>\u200b\u5de6\u4fa7\u200b\u4e3a\u200b\u672c\u5730\u200b\u4ed3\u5e93\u200b\u4ee3\u7801\u200b\uff0c\u200b\u53f3\u4fa7\u200b\u4e3a\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4ee3\u7801\u200b</p> <p>\u200b\u6709\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\u89e3\u51b3\u200b\u51b2\u7a81\u200b</p> <ol> <li>\u200b\u5de6\u4e0b\u89d2\u200b <code>Accept Left</code> \u200b\u548c\u200b <code>Accept Right</code>\uff0c\u200b\u4f46\u200b\u53ea\u80fd\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u4ed3\u5e93\u200b\u7684\u200b\u4ee3\u7801\u200b\u4f5c\u4e3a\u200b\u6700\u7ec8\u200b\u5408\u5e76\u200b\u6587\u4ef6\u200b</li> <li>\u200b\u5c4f\u5e55\u200b\u4e2d\u95f4\u200b\u7684\u200b<code>&gt;&gt;</code>\u200b\u548c\u200b<code>&lt;&lt;</code>\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4fdd\u7559\u200b\u672c\u5730\u200b\u548c\u200b\u8fdc\u7a0b\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u9009\u62e9\u200b\u5176\u4e2d\u200b\u4e00\u4efd\u200b</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u9009\u62e9\u200b\u540c\u65f6\u200b\u4fdd\u7559\u200b\u672c\u5730\u200b\u548c\u200b\u8fdc\u7a0b\u200b\u4ee3\u7801\u200b</p> <p>PS: \u200b\u4e2d\u95f4\u200b\u90e8\u5206\u200b\u53ef\u4ee5\u200b\u968f\u610f\u200b\u4fee\u6539\u200b/\u200b\u8c03\u6362\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4f46\u200b\u4e24\u4fa7\u200b\u662f\u200b\u65e0\u6cd5\u200b\u4fee\u6539\u200b\u7684\u200b</p> <p></p> <p>\u200b\u6700\u7ec8\u200b\u6548\u679c\u200b\u5982\u56fe\u6240\u793a\u200b(<code>merge</code>)</p> <p></p> <p>\u200b\u5982\u679c\u200b\u9009\u62e9\u200b<code>rebase</code>\uff0c\u200b\u6700\u7ec8\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#84-mergerebase","title":"8.4 merge\u200b\u4e0e\u200brebase\u200b\u7684\u200b\u533a\u522b\u200b(\u200b\u5b58\u5728\u200b\u51b2\u7a81\u200b)","text":"<p>1. merge</p> <ul> <li>\u200b\u4fdd\u7559\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\uff08\u200b\u4f1a\u200b\u4ea7\u751f\u200b\u5408\u5e76\u200b\u63d0\u4ea4\u200b merge commit\uff09\u3002</li> <li>\u200b\u9002\u5408\u200b\u591a\u4eba\u200b\u534f\u4f5c\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u4fee\u6539\u200b\u5386\u53f2\u8bb0\u5f55\u200b\u3002</li> </ul> <p>2. rebase</p> <ul> <li>\u200b\u4e0d\u200b\u4ea7\u751f\u200b\u5408\u5e76\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u800c\u662f\u200b\u5c06\u200b feature \u200b\u5206\u652f\u200b\u4e0a\u200b\u7684\u200b\u63d0\u4ea4\u200b\u91cd\u65b0\u200b\u5e94\u7528\u200b\u5230\u200b main \u200b\u5206\u652f\u200b\u540e\u9762\u200b\u3002</li> <li>\u200b\u5386\u53f2\u200b\u4f1a\u200b\u88ab\u200b\u91cd\u5199\u200b\uff08\u200b\u63d0\u4ea4\u200b\u54c8\u5e0c\u200b\u503c\u200b\u6539\u53d8\u200b\uff09\uff0c\u200b\u9002\u5408\u200b\u4fdd\u6301\u200b\u63d0\u4ea4\u200b\u5386\u53f2\u200b\u6574\u6d01\u200b\u3002</li> </ul>","tags":["tools","git"]},{"location":"blog/2025/02/02/04ideagit-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/#85-merge-fast-forward","title":"8.5 merge fast-forward(\u200b\u4e0d\u200b\u5b58\u5728\u200b\u51b2\u7a81\u200b)","text":"<p><code>Fast-forward</code> \u200b\u662f\u200b Git \u200b\u4e2d\u200b\u7684\u200b\u4e00\u79cd\u200b \u200b\u5408\u5e76\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5f53\u200b\u4f60\u200b\u6267\u884c\u200b <code>git merge</code> \u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u5206\u652f\u200b\u6ca1\u6709\u200b\u65b0\u200b\u7684\u200b\u63d0\u4ea4\u200b\uff08\u200b\u5373\u8be5\u200b\u5206\u652f\u200b\u7684\u200b HEAD \u200b\u6ca1\u6709\u200b\u5206\u6b67\u200b\uff09\uff0cGit \u200b\u4f1a\u200b\u76f4\u63a5\u200b\u5c06\u200b\u5f53\u524d\u200b\u5206\u652f\u200b\u6307\u5411\u200b\u76ee\u6807\u200b\u5206\u652f\u200b\u7684\u200b\u6700\u65b0\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u521b\u5efa\u200b\u989d\u5916\u200b\u7684\u200b\u5408\u5e76\u200b\u63d0\u4ea4\u200b\u3002</p> <p>\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u4f1a\u200b\u53d1\u751f\u200b <code>Fast-Forward</code>\uff1f</p> <ul> <li>\u200b\u5f53\u200b\u76ee\u6807\u200b\u5206\u652f\u200b\u6ca1\u6709\u200b\u65b0\u200b\u7684\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u524d\u200b\u5206\u652f\u200b\u5b8c\u5168\u200b\u5904\u4e8e\u200b\u76ee\u6807\u200b\u5206\u652f\u200b\u7684\u200b\u524d\u9762\u200b\uff08\u200b\u5373\u200b\u76ee\u6807\u200b\u5206\u652f\u200b\u662f\u200b\u5f53\u524d\u200b\u5206\u652f\u200b\u7684\u200b\u7956\u5148\u200b\uff09\uff0cGit \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7b80\u5355\u200b\u5730\u200b\u5c06\u200b\u5f53\u524d\u200b\u5206\u652f\u200b \u201c\u200b\u5feb\u8fdb\u200b\u201d \u200b\u5230\u200b\u76ee\u6807\u200b\u5206\u652f\u200b\u7684\u200b\u6700\u65b0\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u5408\u5e76\u200b\u63d0\u4ea4\u200b\u3002</li> </ul> <p></p> <p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c<code>dev</code>\u200b\u5206\u652f\u200b\u4e3a\u200b\u76ee\u6807\u200b\u5206\u652f\u200b\uff0c<code>feature</code>\u200b\u5206\u652f\u200b\u4e3a\u200b\u5f53\u524d\u200b\u5206\u652f\u200b</p> <p><code>dev</code>\u200b\u5206\u652f\u200b\u4e2d\u200b\u4e0d\u200b\u5b58\u5728\u200b\u65b0\u200b\u7684\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u4e14\u200b<code>feature</code>\u200b\u5206\u652f\u200b\u5b8c\u5168\u200b\u5904\u4e8e\u200b<code>dev</code>\u200b\u5206\u652f\u200b\u4e4b\u524d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8fdb\u884c\u200b<code>merge</code>\u200b\u5c06\u200b\u89e6\u53d1\u200b<code>fast-forward</code>\uff0c\u200b\u6548\u679c\u200b\u4e0e\u200b<code>rebase</code>\u200b\u4e00\u81f4\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/05ideagit-%E6%9D%82%E9%A1%B9/","title":"05.IdeaGit \u200b\u6742\u9879","text":"<p> \u200b\u7ea6\u200b 220 \u200b\u4e2a\u200b\u5b57\u200b  10 \u200b\u884c\u200b\u4ee3\u7801\u200b  9 \u200b\u5f20\u200b\u56fe\u7247\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b 1 \u200b\u5206\u949f\u200b</p>","tags":["tools","git"]},{"location":"blog/2025/02/02/05ideagit-%E6%9D%82%E9%A1%B9/#cherry-pick","title":"Cherry-Pick","text":"<p>\u200b\u590d\u7528\u200b04.IdeaGit \u200b\u5206\u652f\u200b\u7ba1\u7406\u200b\u4e2d\u200b<code>8.3</code>\u200b\u7684\u200b\u524d\u7f6e\u200b\u51c6\u5907\u200b</p> <p>\u200b\u5728\u200b<code>merge</code>\u200b\u8fc7\u7a0b\u200b\u4e0a\u200b\u7565\u6709\u4e0d\u540c\u200b\uff0c\u200b\u4fdd\u7559\u200b\u51fd\u6570\u200b<code>f2</code>\uff0c\u200b\u53bb\u9664\u200b\u51fd\u6570\u200b<code>f3</code></p> <p>\u200b\u6700\u7ec8\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> Java<pre><code>public class GitPullTest {\n\n    public void f1() {\n        System.out.println(\"f1\");\n    }\n\n    public void f2() {\n        System.out.println(\"f2\");\n    }\n}\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u521b\u5efa\u200b\u51fd\u6570\u200b<code>f4</code></p> <p></p> <p>\u200b\u95ee\u9898\u200b\u6765\u200b\u4e86\u200b\uff0c\u200b\u5728\u200b\u5b9e\u73b0\u200b\u51fd\u6570\u200b<code>f4</code>\u200b\u65f6\u200b\uff0c\u200b\u53d1\u73b0\u200b\u5176\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u51fd\u6570\u200b<code>f3</code>\u200b\u7684\u200b\u903b\u8f91\u200b\u7b80\u5316\u200b\u4ee3\u7801\u200b</p> <p>\u200b\u800c\u200b\u60f3\u8981\u200b\u91cd\u65b0\u200b\u83b7\u53d6\u200b\u4e4b\u524d\u200b\u5df2\u7ecf\u200b\u653e\u5f03\u200b\u7684\u200b\u51fd\u6570\u200b<code>f3</code>\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u4e2d\u200b\u8bb0\u5f55\u200b\u540e\u200b\u70b9\u51fb\u200b<code>cherry-pick</code>\u200b\u6309\u94ae\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff08\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u89e3\u51b3\u200b\u51b2\u7a81\u200b\uff09\uff0c\u200b\u4e4b\u540e\u200b\u4f1a\u200b\u5bf9\u200b\u51fd\u6570\u200b<code>f4</code>\u200b\u5728\u200b\u4e3b\u5e72\u200b\u4e0a\u200b\u91cd\u65b0\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u88ab\u200b\u629b\u5f03\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u91cd\u65b0\u200b\u83b7\u5f97\u200b\u3002</p> <p></p> <p>\u200b\u89e3\u51b3\u200b\u51b2\u7a81\u200b\u540e\u200b\uff0c\u200b\u6700\u7ec8\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/2025/02/02/05ideagit-%E6%9D%82%E9%A1%B9/#undo-commitrevert-commitdrop-commit","title":"Undo Commit\uff0cRevert Commit\uff0cDrop Commit","text":"","tags":["tools","git"]},{"location":"blog/2025/02/02/05ideagit-%E6%9D%82%E9%A1%B9/#tag","title":"Tag","text":"<p>\u200b\u5728\u200b\u9879\u76ee\u200b\u5b8c\u5de5\u200b\u51c6\u5907\u200b\u53d1\u5e03\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u63d0\u4ea4\u200b\u6253\u200b\u4e0a\u200b<code>Tag</code></p> <p></p> <p></p> <p>\u200b\u6ce8\u610f\u200b\uff1apush\u200b\u7684\u200b\u65f6\u5019\u200b\u4e00\u5b9a\u200b\u8981\u200b\u9009\u4e2d\u200b\u5de6\u4e0b\u89d2\u200b<code>Push tags</code>\uff0c\u200b\u5426\u5219\u200b\u65e0\u6cd5\u200b\u751f\u6548\u200b</p> <p></p> <p>\u200b\u67e5\u770b\u200b\u8fdc\u7aef\u200b\u4ed3\u5e93\u200b</p> <p></p>","tags":["tools","git"]},{"location":"blog/archive/2025/","title":"2025","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/archive/2024/","title":"2024","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/ospp/","title":"ospp","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/mac/","title":"mac","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/algorithm/","title":"Algorithm","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/tools/","title":"tools","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/linux/","title":"linux","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/project/","title":"project","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/cs/","title":"CS","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/docker/","title":"docker","text":"<p> \u200b\u7ea6\u200b 1 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/category/hello-world/","title":"Hello World","text":"<p> \u200b\u7ea6\u200b 2 \u200b\u4e2a\u200b\u5b57\u200b  \u200b\u9884\u8ba1\u200b\u9605\u8bfb\u200b\u65f6\u95f4\u200b\u4e0d\u5230\u200b 1 \u200b\u5206\u949f\u200b</p>"},{"location":"blog/page/2/","title":"Blog","text":""},{"location":"blog/page/3/","title":"Blog","text":""},{"location":"blog/archive/2025/page/2/","title":"2025","text":""},{"location":"blog/archive/2024/page/2/","title":"2024","text":""}]}