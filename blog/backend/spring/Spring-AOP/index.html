
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="褚成志">
      
      
        <link rel="canonical" href="https://doc.chucz.asia/blog/backend/spring/Spring-AOP/">
      
      
        <link rel="prev" href="../../Java/FrequencyControl/">
      
      
        <link rel="next" href="../Spring-IOC/">
      
      
      <link rel="icon" href="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/106435907.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Spring AOP - 褚成志的分享站</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Bitter";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/link.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/customize.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/editable-code.css">
    
      <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-JWTTRFDCWY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-JWTTRFDCWY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-JWTTRFDCWY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
    <link rel="stylesheet" href="../../../../assets/stylesheets/custom.00c04c01.min.css">
  
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spring-aop" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="褚成志的分享站" class="md-header__button md-logo" aria-label="褚成志的分享站" data-md-component="logo">
      
  <img src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/106435907.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            褚成志的分享站
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spring AOP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭自动模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="关闭自动模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Pale-illusions/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Pale-illusions/ZH-TW/" hreflang="zh-TW" class="md-select__link">
              China(TW)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/initchu/my-mkdocs.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Mkdocs-褚成志
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../tag/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../" class="md-tabs__link">
          
  
  
    
  
  Blogger

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../JVM/JVM%20%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/" class="md-tabs__link">
          
  
  
    
  
  后端

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../frontend/JavaScript/testJs/" class="md-tabs__link">
          
  
  
    
  
  前端

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/" class="md-tabs__link">
          
  
  
    
  
  操作系统

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../about/link/" class="md-tabs__link">
          
  
  
    
  
  友链

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../about/me/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="褚成志的分享站" class="md-nav__button md-logo" aria-label="褚成志的分享站" data-md-component="logo">
      
  <img src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/106435907.png" alt="logo">

    </a>
    褚成志的分享站
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/initchu/my-mkdocs.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Mkdocs-褚成志
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Blogger
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blogger
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/cs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hello World
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/mac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mac
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/ospp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ospp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    project
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    后端
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            后端
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    JVM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            JVM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../JVM/JVM%20%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JVM 思维导图
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Java/FrequencyControl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Frequency-Control-Starter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Spring AOP
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Spring AOP
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#jdk" class="md-nav__link">
    <span class="md-ellipsis">
      JDK动态代理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JDK动态代理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-jdk" class="md-nav__link">
    <span class="md-ellipsis">
      1. JDK动态代理源码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 运行测试代码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cglib" class="md-nav__link">
    <span class="md-ellipsis">
      Cglib 动态代理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cglib 动态代理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-cglib" class="md-nav__link">
    <span class="md-ellipsis">
      1. Cglib 动态代理源码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cglib" class="md-nav__link">
    <span class="md-ellipsis">
      2. CGLIB 动态代理原理与性能优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cglib" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cglib 动态代理类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aop" class="md-nav__link">
    <span class="md-ellipsis">
      AOP 代理工厂
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AOP 代理工厂">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 测试代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-aop" class="md-nav__link">
    <span class="md-ellipsis">
      2. AOP 代理工厂代码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advicebeforeadviceafteradviceafterreturningadvicethrowsadvice" class="md-nav__link">
    <span class="md-ellipsis">
      几种常用的Advice：BeforeAdvice/AfterAdvice/AfterReturningAdvice/ThrowsAdvice...
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spring-aop_1" class="md-nav__link">
    <span class="md-ellipsis">
      Spring AOP 拦截器链
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spring AOP 拦截器链">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proxyfactory" class="md-nav__link">
    <span class="md-ellipsis">
      ProxyFactory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jdk_1" class="md-nav__link">
    <span class="md-ellipsis">
      基于JDK动态代理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基于JDK动态代理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 获取拦截器链
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2reflectivemethodinvocation" class="md-nav__link">
    <span class="md-ellipsis">
      2.将拦截器封装成ReflectiveMethodInvocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.执行拦截器链
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointcutadvisorpointcutadvice" class="md-nav__link">
    <span class="md-ellipsis">
      PointcutAdvisor：Pointcut和Advice的组合
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean" class="md-nav__link">
    <span class="md-ellipsis">
      动态代理融入Bean的生命周期
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enableaspectjautoproxy" class="md-nav__link">
    <span class="md-ellipsis">
      @EnableAspectJAutoProxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="@EnableAspectJAutoProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proxytargetclass" class="md-nav__link">
    <span class="md-ellipsis">
      proxyTargetClass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exposeproxy" class="md-nav__link">
    <span class="md-ellipsis">
      exposeProxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aop_1" class="md-nav__link">
    <span class="md-ellipsis">
      AOP 生成代理的三个时机
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AOP 生成代理的三个时机">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beforeinstantiation" class="md-nav__link">
    <span class="md-ellipsis">
      实例化前(BeforeInstantiation)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#afterinitialization" class="md-nav__link">
    <span class="md-ellipsis">
      初始化后(AfterInitialization)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      循坏依赖
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring-IOC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring IOC 容器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring-MVC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring MVC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring-tx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring 事务
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring中@Transactional失效场景
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    循环依赖
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    详解 Spring 生命周期
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3_8" >
        
          
          <label class="md-nav__link" for="__nav_4_3_8" id="__nav_4_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    simple-spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_8">
            <span class="md-nav__icon md-icon"></span>
            simple-spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simple-spring/simple-spring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simple-Spring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Learn-Spring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    并发编程
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            并发编程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CompletableFuture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JUC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java线程池实现原理及其在美团业务中的实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ThreadLocal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Volatile与指令重排
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    不可不说的Java“锁”事
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    从ReentrantLock的实现看AQS的原理及应用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分布式锁
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    架构设计
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            架构设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E4%BB%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%90%86%E8%A7%A3Pull%E4%B8%8EPush%E6%A8%A1%E5%9E%8B%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    从消息队列理解Pull与Push模型底层逻辑
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    消息端到端的一致性与可靠性
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    前端
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            前端
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    JavaScript
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            JavaScript
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/JavaScript/testJs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JavaScript Code Runner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    QuickDive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            QuickDive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/JavaScript/QuickDive/BasicGrammar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基本语法
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    操作系统
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            操作系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IO多路复用底层原理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分页存储原理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    友链
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            友链
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/link/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    友链
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            关于
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/me/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    作者个人简介
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#jdk" class="md-nav__link">
    <span class="md-ellipsis">
      JDK动态代理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JDK动态代理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-jdk" class="md-nav__link">
    <span class="md-ellipsis">
      1. JDK动态代理源码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 运行测试代码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cglib" class="md-nav__link">
    <span class="md-ellipsis">
      Cglib 动态代理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cglib 动态代理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-cglib" class="md-nav__link">
    <span class="md-ellipsis">
      1. Cglib 动态代理源码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cglib" class="md-nav__link">
    <span class="md-ellipsis">
      2. CGLIB 动态代理原理与性能优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cglib" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cglib 动态代理类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aop" class="md-nav__link">
    <span class="md-ellipsis">
      AOP 代理工厂
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AOP 代理工厂">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 测试代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-aop" class="md-nav__link">
    <span class="md-ellipsis">
      2. AOP 代理工厂代码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advicebeforeadviceafteradviceafterreturningadvicethrowsadvice" class="md-nav__link">
    <span class="md-ellipsis">
      几种常用的Advice：BeforeAdvice/AfterAdvice/AfterReturningAdvice/ThrowsAdvice...
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spring-aop_1" class="md-nav__link">
    <span class="md-ellipsis">
      Spring AOP 拦截器链
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spring AOP 拦截器链">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proxyfactory" class="md-nav__link">
    <span class="md-ellipsis">
      ProxyFactory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jdk_1" class="md-nav__link">
    <span class="md-ellipsis">
      基于JDK动态代理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基于JDK动态代理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 获取拦截器链
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2reflectivemethodinvocation" class="md-nav__link">
    <span class="md-ellipsis">
      2.将拦截器封装成ReflectiveMethodInvocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.执行拦截器链
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointcutadvisorpointcutadvice" class="md-nav__link">
    <span class="md-ellipsis">
      PointcutAdvisor：Pointcut和Advice的组合
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean" class="md-nav__link">
    <span class="md-ellipsis">
      动态代理融入Bean的生命周期
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enableaspectjautoproxy" class="md-nav__link">
    <span class="md-ellipsis">
      @EnableAspectJAutoProxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="@EnableAspectJAutoProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proxytargetclass" class="md-nav__link">
    <span class="md-ellipsis">
      proxyTargetClass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exposeproxy" class="md-nav__link">
    <span class="md-ellipsis">
      exposeProxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aop_1" class="md-nav__link">
    <span class="md-ellipsis">
      AOP 生成代理的三个时机
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AOP 生成代理的三个时机">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beforeinstantiation" class="md-nav__link">
    <span class="md-ellipsis">
      实例化前(BeforeInstantiation)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#afterinitialization" class="md-nav__link">
    <span class="md-ellipsis">
      初始化后(AfterInitialization)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      循坏依赖
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../tag/#tag:java" class="md-tag">java</a>
      
    
      
      
      
        <a href="../../../../tag/#tag:spring" class="md-tag">spring</a>
      
    
  </nav>


  
    <a href="https://github.com/initchu/my-mkdocs.git/edit/main/docs/blog/backend/spring/Spring-AOP.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/initchu/my-mkdocs.git/raw/main/docs/blog/backend/spring/Spring-AOP.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="spring-aop">Spring AOP<a class="headerlink" href="#spring-aop" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 4161 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 959 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 6 张图片 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 26 分钟</p>
</div>
<p><strong>AOP</strong> 切点表达式和使用以及基于 <strong>JDK</strong> 和 <strong>CGLIB</strong> 的动态代理类关系：</p>
<p><img alt="" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2024/11/29/17328624708126.jpg" /></p>
<p><code>Joinpoint</code>，织入点，指需要执行代理操作的某个类的某个方法(仅支持方法级别的<code>JoinPoint</code>)；<code>Pointcut</code>是<code>JoinPoint</code>的表述方式，能捕获<code>JoinPoint</code>。</p>
<p>最常用的切点表达式是<code>AspectJ</code>的切点表达式。</p>
<ul>
<li>需要匹配类，定义<code>ClassFilter</code>接口</li>
<li>匹配方法，定义<code>MethodMatcher</code>接口</li>
</ul>
<p><code>PointCut</code>需要同时匹配类和方法，包含<code>ClassFilter</code>和<code>MethodMatcher</code>, <code>AspectJExpressionPointcut</code>是支持<code>AspectJ</code>切点表达式的<code>PointCut</code>实现，简单实现仅支持<code>execution</code>函数。</p>
<p><code>AdvisedSupport</code> 是一个核心类，用于支持和管理代理对象的配置和功能</p>
<p><code>AdvisedSupport</code> 的主要功能是：</p>
<ol>
<li>存储 AOP 配置元信息：<ul>
<li>目标对象（被代理对象）。</li>
<li>代理的接口列表。</li>
<li>应用的拦截器链或通知（Advices）。</li>
</ul>
</li>
<li>管理代理行为：<ul>
<li>决定代理是 JDK 动态代理还是 CGLIB 动态代理。</li>
<li>负责控制代理对象的生命周期。</li>
</ul>
</li>
<li>支持运行时动态修改：<ul>
<li>可以在运行时动态添加或移除通知（Advice）。</li>
</ul>
</li>
</ol>
<h2 id="jdk">JDK动态代理<a class="headerlink" href="#jdk" title="Permanent link">&para;</a></h2>
<p><code>AopProxy</code>是获取代理对象的抽象接口，<code>JdkDynamicAopProxy</code>的基于JDK动态代理的具体实现。</p>
<p><code>TargetSource</code>，被代理对象的封装。</p>
<p><code>MethodInterceptor</code>，方法拦截器，是<code>AOP Alliance</code>的"公民"，顾名思义，可以拦截方法，可在被代理执行的方法前后增加代理行为。</p>
<details>

<summary>测试代码</summary>

<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AopTest</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testJdkDynamicProxy</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">        </span><span class="n">WorldService</span><span class="w"> </span><span class="n">worldService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceImpl</span><span class="p">();</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">        </span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advisedSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="p">();</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">        </span><span class="n">TargetSource</span><span class="w"> </span><span class="n">targetSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TargetSource</span><span class="p">(</span><span class="n">worldService</span><span class="p">);</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">        </span><span class="n">WorldServiceInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceInterceptor</span><span class="p">();</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="n">MethodMatcher</span><span class="w"> </span><span class="n">methodMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AspectJExpressionPointcut</span><span class="p">(</span><span class="s">&quot;execution(* test.aop.bean.WorldService.explode(..))&quot;</span><span class="p">).</span><span class="na">getMethodMatcher</span><span class="p">();</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">        </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setTargetSource</span><span class="p">(</span><span class="n">targetSource</span><span class="p">);</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">        </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setMethodInterceptor</span><span class="p">(</span><span class="n">methodInterceptor</span><span class="p">);</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">        </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setMethodMatcher</span><span class="p">(</span><span class="n">methodMatcher</span><span class="p">);</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">        </span><span class="n">WorldService</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldService</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JdkDynamicAopProxy</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">).</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">        </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>

<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span>
<span class="normal"><a href="#__codelineno-1-8">8</a></span>
<span class="normal"><a href="#__codelineno-1-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorldServiceInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">MethodInvocation</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;do something before the Earth explodes&quot;</span><span class="p">);</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;do something after the Earth explodes&quot;</span><span class="p">);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>

</details>

<h3 id="1-jdk">1. JDK动态代理源码<a class="headerlink" href="#1-jdk" title="Permanent link">&para;</a></h3>
<p>代码位置：<code>com.iflove.simplespring.aop.framework.JdkDynamicAopProxy</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nd">@Override</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Proxy</span><span class="p">.</span><span class="na">newProxyInstance</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getContextClassLoader</span><span class="p">(),</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTargetClass</span><span class="p">(),</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="p">}</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="nd">@Override</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getMethodMatcher</span><span class="p">().</span><span class="na">matches</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">().</span><span class="na">getClass</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">        </span><span class="c1">// 启动代理方法 </span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getMethodInterceptor</span><span class="p">();</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ReflectiveMethodInvocation</span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">(),</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">));</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">(),</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>重点关注以上两个核心方法</p>
<ol>
<li><code>getProxy()</code><ul>
<li><code>getProxy()</code> 方法用于创建代理对象，返回一个基于 Java 动态代理的代理实例。</li>
</ul>
</li>
<li><code>invoke()</code><ul>
<li><code>invoke()</code> 方法用于处理代理对象上的方法调用，判断是否需要应用代理逻辑。如果方法匹配切面条件，则执行增强逻辑；否则直接调用目标方法。</li>
</ul>
</li>
</ol>
<h3 id="2">2. 运行测试代码<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>在测试代码的末尾加上</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">proxy</span><span class="p">.</span><span class="na">getClass</span><span class="p">());</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<p>保证程序始终运行</p>
<p>下载 <strong>arthas</strong> 并启动</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>java<span class="w"> </span>-jar<span class="w"> </span>arthas-boot.jar
</code></pre></div></td></tr></table></div>
<p>选择对应进程</p>
<p><img alt="" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2024/12/26/17350138436503.jpg" /></p>
<p>输入</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>jad<span class="w"> </span>com.sun.proxy.<span class="nv">$Proxy2</span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2024/12/26/17350141712400.jpg" /></p>
<p>获得代理类信息如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span>
<span class="normal"><a href="#__codelineno-6-56">56</a></span>
<span class="normal"><a href="#__codelineno-6-57">57</a></span>
<span class="normal"><a href="#__codelineno-6-58">58</a></span>
<span class="normal"><a href="#__codelineno-6-59">59</a></span>
<span class="normal"><a href="#__codelineno-6-60">60</a></span>
<span class="normal"><a href="#__codelineno-6-61">61</a></span>
<span class="normal"><a href="#__codelineno-6-62">62</a></span>
<span class="normal"><a href="#__codelineno-6-63">63</a></span>
<span class="normal"><a href="#__codelineno-6-64">64</a></span>
<span class="normal"><a href="#__codelineno-6-65">65</a></span>
<span class="normal"><a href="#__codelineno-6-66">66</a></span>
<span class="normal"><a href="#__codelineno-6-67">67</a></span>
<span class="normal"><a href="#__codelineno-6-68">68</a></span>
<span class="normal"><a href="#__codelineno-6-69">69</a></span>
<span class="normal"><a href="#__codelineno-6-70">70</a></span>
<span class="normal"><a href="#__codelineno-6-71">71</a></span>
<span class="normal"><a href="#__codelineno-6-72">72</a></span>
<span class="normal"><a href="#__codelineno-6-73">73</a></span>
<span class="normal"><a href="#__codelineno-6-74">74</a></span>
<span class="normal"><a href="#__codelineno-6-75">75</a></span>
<span class="normal"><a href="#__codelineno-6-76">76</a></span>
<span class="normal"><a href="#__codelineno-6-77">77</a></span>
<span class="normal"><a href="#__codelineno-6-78">78</a></span>
<span class="normal"><a href="#__codelineno-6-79">79</a></span>
<span class="normal"><a href="#__codelineno-6-80">80</a></span>
<span class="normal"><a href="#__codelineno-6-81">81</a></span>
<span class="normal"><a href="#__codelineno-6-82">82</a></span>
<span class="normal"><a href="#__codelineno-6-83">83</a></span>
<span class="normal"><a href="#__codelineno-6-84">84</a></span>
<span class="normal"><a href="#__codelineno-6-85">85</a></span>
<span class="normal"><a href="#__codelineno-6-86">86</a></span>
<span class="normal"><a href="#__codelineno-6-87">87</a></span>
<span class="normal"><a href="#__codelineno-6-88">88</a></span>
<span class="normal"><a href="#__codelineno-6-89">89</a></span>
<span class="normal"><a href="#__codelineno-6-90">90</a></span>
<span class="normal"><a href="#__codelineno-6-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="cm">/*</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="cm"> * Decompiled with CFR.</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="cm"> *</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="cm"> * Could not load the following classes:</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="cm"> *  test.aop.bean.WorldService</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="cm"> */</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="kn">package</span><span class="w"> </span><span class="nn">com.sun.proxy</span><span class="p">;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.InvocationHandler</span><span class="p">;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Method</span><span class="p">;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Proxy</span><span class="p">;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.UndeclaredThrowableException</span><span class="p">;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">test.aop.bean.WorldService</span><span class="p">;</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">$Proxy2</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="kd">extends</span><span class="w"> </span><span class="n">Proxy</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="kd">implements</span><span class="w"> </span><span class="n">WorldService</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m1</span><span class="p">;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m2</span><span class="p">;</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m0</span><span class="p">;</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m3</span><span class="p">;</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">$Proxy2</span><span class="p">(</span><span class="n">InvocationHandler</span><span class="w"> </span><span class="n">invocationHandler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">invocationHandler</span><span class="p">);</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">            </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;java.lang.Object&quot;</span><span class="p">).</span><span class="na">getMethod</span><span class="p">(</span><span class="s">&quot;equals&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;java.lang.Object&quot;</span><span class="p">));</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">            </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;java.lang.Object&quot;</span><span class="p">).</span><span class="na">getMethod</span><span class="p">(</span><span class="s">&quot;toString&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">            </span><span class="n">m0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;java.lang.Object&quot;</span><span class="p">).</span><span class="na">getMethod</span><span class="p">(</span><span class="s">&quot;hashCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">            </span><span class="n">m3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;test.aop.bean.WorldService&quot;</span><span class="p">).</span><span class="na">getMethod</span><span class="p">(</span><span class="s">&quot;explode&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NoSuchMethodException</span><span class="w"> </span><span class="n">noSuchMethodException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NoSuchMethodError</span><span class="p">(</span><span class="n">noSuchMethodException</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">classNotFoundException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NoClassDefFoundError</span><span class="p">(</span><span class="n">classNotFoundException</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Boolean</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="na">h</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">object</span><span class="p">});</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">throwable</span><span class="p">;</span>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UndeclaredThrowableException</span><span class="p">(</span><span class="n">throwable</span><span class="p">);</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-57" name="__codelineno-6-57"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="na">h</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">throwable</span><span class="p">;</span>
<a id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-62" name="__codelineno-6-62"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-63" name="__codelineno-6-63"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UndeclaredThrowableException</span><span class="p">(</span><span class="n">throwable</span><span class="p">);</span>
<a id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-65" name="__codelineno-6-65"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-66" name="__codelineno-6-66"></a>
<a id="__codelineno-6-67" name="__codelineno-6-67"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-68" name="__codelineno-6-68"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="na">h</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">m0</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-71" name="__codelineno-6-71"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-72" name="__codelineno-6-72"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">throwable</span><span class="p">;</span>
<a id="__codelineno-6-73" name="__codelineno-6-73"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-74" name="__codelineno-6-74"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-75" name="__codelineno-6-75"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UndeclaredThrowableException</span><span class="p">(</span><span class="n">throwable</span><span class="p">);</span>
<a id="__codelineno-6-76" name="__codelineno-6-76"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-77" name="__codelineno-6-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-78" name="__codelineno-6-78"></a>
<a id="__codelineno-6-79" name="__codelineno-6-79"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">explode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-80" name="__codelineno-6-80"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-81" name="__codelineno-6-81"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">h</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-82" name="__codelineno-6-82"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-6-83" name="__codelineno-6-83"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-84" name="__codelineno-6-84"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-85" name="__codelineno-6-85"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">throwable</span><span class="p">;</span>
<a id="__codelineno-6-86" name="__codelineno-6-86"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-87" name="__codelineno-6-87"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-88" name="__codelineno-6-88"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UndeclaredThrowableException</span><span class="p">(</span><span class="n">throwable</span><span class="p">);</span>
<a id="__codelineno-6-89" name="__codelineno-6-89"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-90" name="__codelineno-6-90"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-91" name="__codelineno-6-91"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>可以看到代理类信息如下 <code>public final class $Proxy2 extends Proxy implements WorldService</code></p>
<p>继承了 <code>Proxy</code>，实现了 <code>WorldService</code> 接口</p>
<p>上述信息印证了一个重要的概念，即：</p>
<div class="admonition 知识点">
<p class="admonition-title">知识点</p>
<p><strong>JDK 动态代理生成的代理类和代理对象为兄弟关系，需要一个共同的接口</strong></p>
</div>
<p>接下来看代理类实现的 <code>explode</code> 方法</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">explode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">h</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">throwable</span><span class="p">;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UndeclaredThrowableException</span><span class="p">(</span><span class="n">throwable</span><span class="p">);</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>其他都很好理解，问题是：<strong>这里的 <code>h</code> 是什么？</strong></p>
<p>先给出解答：<strong><code>h</code> 是 <code>InvocationHandler</code></strong></p>
<p>接下来，一步一步从源码角度分析</p>
<p>首先，这个代理类是通过 <code>JdkDynamicAopProxy</code> 的 <code>getProxy</code> 方法获取的</p>
<p>定义如下</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nd">@Override</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Proxy</span><span class="p">.</span><span class="na">newProxyInstance</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getContextClassLoader</span><span class="p">(),</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTargetClass</span><span class="p">(),</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>以及 <code>Proxy.newProxyInstance</code> 的方法签名</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">newProxyInstance</span><span class="p">(</span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">loader</span><span class="p">,</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">                                          </span><span class="n">Class</span><span class="o">&lt;?&gt;[]</span><span class="w"> </span><span class="n">interfaces</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">                                          </span><span class="n">InvocationHandler</span><span class="w"> </span><span class="n">h</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>可以看到在 <code>getProxy</code> 方法中返回代理对象的最后一个参数为 <code>this</code>，即 <code>JdkDynamicAopProxy</code> 本身，而 <code>JdkDynamicAopProxy</code> 这个类实现了 <code>InvocationHandler</code> 接口，所以在动态生成的代理类中调用的 <code>this.h.invoke</code> 其实就是 <code>JdkDynamicAopProxy</code> 的 <code>invoke</code> 方法。</p>
<hr />
<p>最后再来看 <code>invoke</code> 方法</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span>
<span class="normal"><a href="#__codelineno-10-8">8</a></span>
<span class="normal"><a href="#__codelineno-10-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nd">@Override</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getMethodMatcher</span><span class="p">().</span><span class="na">matches</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">().</span><span class="na">getClass</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">        </span><span class="c1">// 启动代理方法</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getMethodInterceptor</span><span class="p">();</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ReflectiveMethodInvocation</span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">(),</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">));</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">(),</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>核心逻辑如下：</p>
<ol>
<li>
<p>方法匹配：</p>
<ul>
<li>调用 <code>advised.getMethodMatcher().matches(...)</code> 判断当前方法是否符合切面条件。</li>
<li>如果匹配，执行代理逻辑；否则直接调用目标方法。</li>
</ul>
</li>
<li>
<p>代理逻辑：</p>
<ul>
<li>获取 <code>MethodInterceptor</code> 对象，封装了增强逻辑。</li>
<li>调用 <code>MethodInterceptor.invoke(...)</code>，传入一个<code>ReflectiveMethodInvocation</code> 对象。</li>
<li><code>ReflectiveMethodInvocation</code> 是 <code>Spring AOP</code> 的核心类，用于封装方法调用的上下文（目标对象、方法、参数等）。</li>
</ul>
</li>
<li>
<p>直接调用目标方法：</p>
<ul>
<li>如果方法不匹配代理条件，直接调用目标对象的方法，使用反射机制。</li>
</ul>
</li>
</ol>
<h2 id="cglib">Cglib 动态代理<a class="headerlink" href="#cglib" title="Permanent link">&para;</a></h2>
<p>与基于JDK的动态代理在运行期间为接口生成对象的代理对象不同</p>
<p>基于CGLIB的动态代理能在运行期间<strong>动态构建字节码的class文件</strong>，为类生成子类，因此被代理类<strong>不需要继承自任何接口</strong>。</p>
<div class="admonition 重要概念">
<p class="admonition-title">重要概念</p>
<p><strong>cglib</strong> 不要求目标实现接口，它生成的<strong>代理类是目标的子类</strong>，因此代理与目标之间是<strong>子父</strong>关系</p>
</div>
<details>

<summary>测试代码</summary>

<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advisedSupport</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="nd">@Before</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span><span class="n">WorldService</span><span class="w"> </span><span class="n">worldService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceImpl</span><span class="p">();</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="p">();</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="n">TargetSource</span><span class="w"> </span><span class="n">targetSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TargetSource</span><span class="p">(</span><span class="n">worldService</span><span class="p">);</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="n">WorldServiceInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceInterceptor</span><span class="p">();</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">    </span><span class="n">MethodMatcher</span><span class="w"> </span><span class="n">methodMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AspectJExpressionPointcut</span><span class="p">(</span><span class="s">&quot;execution(* test.aop.bean.WorldService.explode(..))&quot;</span><span class="p">).</span><span class="na">getMethodMatcher</span><span class="p">();</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setTargetSource</span><span class="p">(</span><span class="n">targetSource</span><span class="p">);</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setMethodInterceptor</span><span class="p">(</span><span class="n">methodInterceptor</span><span class="p">);</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setMethodMatcher</span><span class="p">(</span><span class="n">methodMatcher</span><span class="p">);</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>

<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nd">@Test</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testCglibDynamicProxy1</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="n">WorldService</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldService</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CglibAopProxy</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">).</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>

<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nd">@Test</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testCglibDynamicProxy2</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="n">WorldServiceImpl</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldServiceImpl</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CglibAopProxy</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">).</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>

</details>

<p>运行上述代码均无报错，即验证了 <strong>代理与目标之间是子父关系</strong> </p>
<h3 id="1-cglib">1. Cglib 动态代理源码<a class="headerlink" href="#1-cglib" title="Permanent link">&para;</a></h3>
<p>代码位置：<code>com.iflove.simplespring.aop.framework.CglibAopProxy</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span>
<span class="normal"><a href="#__codelineno-14-40">40</a></span>
<span class="normal"><a href="#__codelineno-14-41">41</a></span>
<span class="normal"><a href="#__codelineno-14-42">42</a></span>
<span class="normal"><a href="#__codelineno-14-43">43</a></span>
<span class="normal"><a href="#__codelineno-14-44">44</a></span>
<span class="normal"><a href="#__codelineno-14-45">45</a></span>
<span class="normal"><a href="#__codelineno-14-46">46</a></span>
<span class="normal"><a href="#__codelineno-14-47">47</a></span>
<span class="normal"><a href="#__codelineno-14-48">48</a></span>
<span class="normal"><a href="#__codelineno-14-49">49</a></span>
<span class="normal"><a href="#__codelineno-14-50">50</a></span>
<span class="normal"><a href="#__codelineno-14-51">51</a></span>
<span class="normal"><a href="#__codelineno-14-52">52</a></span>
<span class="normal"><a href="#__codelineno-14-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CglibAopProxy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AopProxy</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advised</span><span class="p">;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">CglibAopProxy</span><span class="p">(</span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advised</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">advised</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advised</span><span class="p">;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">        </span><span class="n">Enhancer</span><span class="w"> </span><span class="n">enhancer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Enhancer</span><span class="p">();</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">aClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">().</span><span class="na">getClass</span><span class="p">();</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">        </span><span class="n">aClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassUtils</span><span class="p">.</span><span class="na">isCglibProxyClass</span><span class="p">(</span><span class="n">aClass</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="n">aClass</span><span class="p">.</span><span class="na">getSuperclass</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">aClass</span><span class="p">;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">        </span><span class="n">enhancer</span><span class="p">.</span><span class="na">setSuperclass</span><span class="p">(</span><span class="n">aClass</span><span class="p">);</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">        </span><span class="n">enhancer</span><span class="p">.</span><span class="na">setInterfaces</span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTargetClass</span><span class="p">());</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">        </span><span class="n">enhancer</span><span class="p">.</span><span class="na">setCallback</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DynamicAdvisedInterceptor</span><span class="p">(</span><span class="n">advised</span><span class="p">));</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">enhancer</span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DynamicAdvisedInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advised</span><span class="p">;</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">DynamicAdvisedInterceptor</span><span class="p">(</span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advised</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">advised</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advised</span><span class="p">;</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">intercept</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">objects</span><span class="p">,</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">methodProxy</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="w">            </span><span class="n">CglibMethodInvocation</span><span class="w"> </span><span class="n">methodInvocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CglibMethodInvocation</span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">(),</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">objects</span><span class="p">,</span><span class="w"> </span><span class="n">methodProxy</span><span class="p">);</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">advised</span><span class="p">.</span><span class="na">getMethodMatcher</span><span class="p">().</span><span class="na">matches</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">().</span><span class="na">getClass</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getMethodInterceptor</span><span class="p">().</span><span class="na">invoke</span><span class="p">(</span><span class="n">methodInvocation</span><span class="p">);</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CglibMethodInvocation</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ReflectiveMethodInvocation</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">methodProxy</span><span class="p">;</span>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">CglibMethodInvocation</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">methodProxy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a><span class="w">            </span><span class="kd">super</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">);</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">methodProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodProxy</span><span class="p">;</span>
<a id="__codelineno-14-45" name="__codelineno-14-45"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-46" name="__codelineno-14-46"></a>
<a id="__codelineno-14-47" name="__codelineno-14-47"></a><span class="w">        </span><span class="nd">@Override</span>
<a id="__codelineno-14-48" name="__codelineno-14-48"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">proceed</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-49" name="__codelineno-14-49"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">methodProxy</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">target</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">arguments</span><span class="p">);</span>
<a id="__codelineno-14-50" name="__codelineno-14-50"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-51" name="__codelineno-14-51"></a>
<a id="__codelineno-14-52" name="__codelineno-14-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-53" name="__codelineno-14-53"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>与 <code>JDK</code> 动态代理不同的是，<code>Cglib</code> 动态代理拥有两个特别的内部类 <code>DynamicAdvisedInterceptor</code> 和 <code>CglibMethodInvocation</code> </p>
<ul>
<li><code>CglibMethodInvocation</code> 扩展 <code>ReflectiveMethodInvocation</code> 类以支持 <code>CGLIB</code> 代理</li>
<li>主要是覆盖了 <code>invokeJoinpoint()</code> 方法，如果有 <code>MethodProxy</code> 对象,则通过调用 <code>MethodProxy#invoke</code> 方法，否则通过反射调用</li>
</ul>
<hr />
<p><strong>那么问题来了，<code>methodProxy</code> 究竟是什么？不使用 <code>methodProxy</code> 行不行？</strong></p>
<p>首先回答 <strong><em>不使用 <code>methodProxy</code> 行不行？</em></strong> 这个问题</p>
<p>答案是 <strong>可以！</strong></p>
<p>如果把 <code>proceed</code> 方法中的 <code>methodProxy</code> 替换为 <code>method</code>，代理依然生效，且不会报错</p>
<p><strong>接下来，从源码角度分析 <code>methodProxy</code> 究竟是什么？</strong></p>
<hr />
<h3 id="2-cglib">2. CGLIB 动态代理原理与性能优化<a class="headerlink" href="#2-cglib" title="Permanent link">&para;</a></h3>
<p><code>MethodProxy</code> 是 CGLIB 中一个关键的类，用于执行代理方法。它通过 ASM 字节码框架生成动态代理类，以提高方法调用的性能。与传统的反射方式相比，<code>MethodProxy</code> 能避免频繁反射操作，从而优化性能。</p>
<p>进入 <code>proceed</code> 方法中的 <code>invoke</code> 方法，源码如下</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">init</span><span class="p">();</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">        </span><span class="n">FastClassInfo</span><span class="w"> </span><span class="n">fci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">fastClassInfo</span><span class="p">;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fci</span><span class="p">.</span><span class="na">f1</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">fci</span><span class="p">.</span><span class="na">i1</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">var4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">        </span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var4</span><span class="p">;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getTargetException</span><span class="p">();</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="w"> </span><span class="n">var5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">        </span><span class="n">IllegalArgumentException</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var5</span><span class="p">;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">fastClassInfo</span><span class="p">.</span><span class="na">i1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Protected method: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">sig1</span><span class="p">);</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>继续进入该方法下的 <code>init</code> 方法</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">fastClassInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">        </span><span class="kd">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">initLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">fastClassInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">                </span><span class="n">CreateInfo</span><span class="w"> </span><span class="n">ci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">createInfo</span><span class="p">;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">                </span><span class="n">FastClassInfo</span><span class="w"> </span><span class="n">fci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FastClassInfo</span><span class="p">();</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">                </span><span class="n">fci</span><span class="p">.</span><span class="na">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">helper</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="na">c1</span><span class="p">);</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">                </span><span class="n">fci</span><span class="p">.</span><span class="na">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">helper</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="na">c2</span><span class="p">);</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">                </span><span class="n">fci</span><span class="p">.</span><span class="na">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fci</span><span class="p">.</span><span class="na">f1</span><span class="p">.</span><span class="na">getIndex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">sig1</span><span class="p">);</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">                </span><span class="n">fci</span><span class="p">.</span><span class="na">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fci</span><span class="p">.</span><span class="na">f2</span><span class="p">.</span><span class="na">getIndex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">sig2</span><span class="p">);</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">fastClassInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fci</span><span class="p">;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">createInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在 <code>init</code> 方法下，有两个特殊的类 <code>f1</code> 和 <code>f2</code>，这两个其实就是 <code>FastClass</code></p>
<p>将源码拉到底部，可以看到 <code>FastClass</code> 定义如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span>
<span class="normal"><a href="#__codelineno-17-7">7</a></span>
<span class="normal"><a href="#__codelineno-17-8">8</a></span>
<span class="normal"><a href="#__codelineno-17-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FastClassInfo</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="n">FastClass</span><span class="w"> </span><span class="n">f1</span><span class="p">;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="n">FastClass</span><span class="w"> </span><span class="n">f2</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i1</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i2</span><span class="p">;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">FastClassInfo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>F1</code> 表示已经创建的<strong>代理类</strong>，包含代理逻辑</li>
<li><code>F2</code> 表示<strong>原始类的方法封装</strong>，加速原生类方法调用</li>
</ul>
<p>无论是<strong>代理类</strong>还是<strong>原生的类</strong>, 在<strong>创建代理、执行代理内部的一些方法以及调用一些值</strong>的时候, 如果要使用到<strong>原生类中的方法</strong>的话，是需要通过<strong>反射的方式</strong>去执行的。</p>
<p>可以往<strong>极端</strong>一点的方向思考，如果<strong>原生类中被调用的方法非常多</strong>的话，会导致 <code>java</code> 进行<strong>频繁的反射</strong>，而使用反射，又会导致 <code>JVM</code> 机制进行<strong>反射的检查</strong>，所以这样做是相当<strong>牺牲性能</strong>的。</p>
<p>为了解决这个问题，<code>Cglib</code> 创建了一个 <code>MethodProxy</code> 类，将<strong>原生类中所有需要代理的方法</strong>存入这个类中，那么在需要使用的时候，<strong>直接执行</strong>即可，相当于一个<strong>缓存</strong>的作用，好处就是可以<strong>提高性能</strong>。</p>
<p><br/></p>
<p>在 <code>MethodProxy</code> 类中还有一个特别的方法 <code>invokeSuper</code>，这个方法代表<strong>直接调用原始类的方法</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">methodProxy</span><span class="p">.</span><span class="na">invokeSuper</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">target</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">arguments</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>那么顾名思义，<code>invoke</code> 方法，就是<strong>调用代理类的代理方法</strong></p>
<hr />
<h3 id="3-cglib">3. Cglib 动态代理类<a class="headerlink" href="#3-cglib" title="Permanent link">&para;</a></h3>
<p>类似上文获取 JDK 动态代理类的方法</p>
<p>在测试代码的末尾加上</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">proxy</span><span class="p">.</span><span class="na">getClass</span><span class="p">());</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<p>保证程序始终运行</p>
<p>下载 <strong>arthas</strong> 并启动</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>java<span class="w"> </span>-jar<span class="w"> </span>arthas-boot.jar
</code></pre></div></td></tr></table></div>
<p>获取<strong>动态代理类</strong>代码如下(有点小长)：</p>
<details>

<summary>动态代理类</summary>

<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">  1</a></span>
<span class="normal"><a href="#__codelineno-21-2">  2</a></span>
<span class="normal"><a href="#__codelineno-21-3">  3</a></span>
<span class="normal"><a href="#__codelineno-21-4">  4</a></span>
<span class="normal"><a href="#__codelineno-21-5">  5</a></span>
<span class="normal"><a href="#__codelineno-21-6">  6</a></span>
<span class="normal"><a href="#__codelineno-21-7">  7</a></span>
<span class="normal"><a href="#__codelineno-21-8">  8</a></span>
<span class="normal"><a href="#__codelineno-21-9">  9</a></span>
<span class="normal"><a href="#__codelineno-21-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-21-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-21-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-21-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-21-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-21-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-21-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-21-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-21-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-21-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-21-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-21-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-21-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-21-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-21-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-21-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-21-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-21-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-21-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-21-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-21-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-21-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-21-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-21-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-21-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-21-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-21-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-21-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-21-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-21-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-21-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-21-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-21-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-21-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-21-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-21-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-21-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-21-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-21-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-21-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-21-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-21-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-21-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-21-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-21-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-21-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-21-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-21-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-21-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-21-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-21-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-21-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-21-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-21-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-21-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-21-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-21-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-21-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-21-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-21-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-21-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-21-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-21-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-21-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-21-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-21-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-21-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-21-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-21-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-21-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-21-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-21-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-21-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-21-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-21-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-21-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-21-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-21-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-21-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-21-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-21-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-21-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-21-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-21-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-21-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-21-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-21-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-21-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-21-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-21-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-21-100">100</a></span>
<span class="normal"><a href="#__codelineno-21-101">101</a></span>
<span class="normal"><a href="#__codelineno-21-102">102</a></span>
<span class="normal"><a href="#__codelineno-21-103">103</a></span>
<span class="normal"><a href="#__codelineno-21-104">104</a></span>
<span class="normal"><a href="#__codelineno-21-105">105</a></span>
<span class="normal"><a href="#__codelineno-21-106">106</a></span>
<span class="normal"><a href="#__codelineno-21-107">107</a></span>
<span class="normal"><a href="#__codelineno-21-108">108</a></span>
<span class="normal"><a href="#__codelineno-21-109">109</a></span>
<span class="normal"><a href="#__codelineno-21-110">110</a></span>
<span class="normal"><a href="#__codelineno-21-111">111</a></span>
<span class="normal"><a href="#__codelineno-21-112">112</a></span>
<span class="normal"><a href="#__codelineno-21-113">113</a></span>
<span class="normal"><a href="#__codelineno-21-114">114</a></span>
<span class="normal"><a href="#__codelineno-21-115">115</a></span>
<span class="normal"><a href="#__codelineno-21-116">116</a></span>
<span class="normal"><a href="#__codelineno-21-117">117</a></span>
<span class="normal"><a href="#__codelineno-21-118">118</a></span>
<span class="normal"><a href="#__codelineno-21-119">119</a></span>
<span class="normal"><a href="#__codelineno-21-120">120</a></span>
<span class="normal"><a href="#__codelineno-21-121">121</a></span>
<span class="normal"><a href="#__codelineno-21-122">122</a></span>
<span class="normal"><a href="#__codelineno-21-123">123</a></span>
<span class="normal"><a href="#__codelineno-21-124">124</a></span>
<span class="normal"><a href="#__codelineno-21-125">125</a></span>
<span class="normal"><a href="#__codelineno-21-126">126</a></span>
<span class="normal"><a href="#__codelineno-21-127">127</a></span>
<span class="normal"><a href="#__codelineno-21-128">128</a></span>
<span class="normal"><a href="#__codelineno-21-129">129</a></span>
<span class="normal"><a href="#__codelineno-21-130">130</a></span>
<span class="normal"><a href="#__codelineno-21-131">131</a></span>
<span class="normal"><a href="#__codelineno-21-132">132</a></span>
<span class="normal"><a href="#__codelineno-21-133">133</a></span>
<span class="normal"><a href="#__codelineno-21-134">134</a></span>
<span class="normal"><a href="#__codelineno-21-135">135</a></span>
<span class="normal"><a href="#__codelineno-21-136">136</a></span>
<span class="normal"><a href="#__codelineno-21-137">137</a></span>
<span class="normal"><a href="#__codelineno-21-138">138</a></span>
<span class="normal"><a href="#__codelineno-21-139">139</a></span>
<span class="normal"><a href="#__codelineno-21-140">140</a></span>
<span class="normal"><a href="#__codelineno-21-141">141</a></span>
<span class="normal"><a href="#__codelineno-21-142">142</a></span>
<span class="normal"><a href="#__codelineno-21-143">143</a></span>
<span class="normal"><a href="#__codelineno-21-144">144</a></span>
<span class="normal"><a href="#__codelineno-21-145">145</a></span>
<span class="normal"><a href="#__codelineno-21-146">146</a></span>
<span class="normal"><a href="#__codelineno-21-147">147</a></span>
<span class="normal"><a href="#__codelineno-21-148">148</a></span>
<span class="normal"><a href="#__codelineno-21-149">149</a></span>
<span class="normal"><a href="#__codelineno-21-150">150</a></span>
<span class="normal"><a href="#__codelineno-21-151">151</a></span>
<span class="normal"><a href="#__codelineno-21-152">152</a></span>
<span class="normal"><a href="#__codelineno-21-153">153</a></span>
<span class="normal"><a href="#__codelineno-21-154">154</a></span>
<span class="normal"><a href="#__codelineno-21-155">155</a></span>
<span class="normal"><a href="#__codelineno-21-156">156</a></span>
<span class="normal"><a href="#__codelineno-21-157">157</a></span>
<span class="normal"><a href="#__codelineno-21-158">158</a></span>
<span class="normal"><a href="#__codelineno-21-159">159</a></span>
<span class="normal"><a href="#__codelineno-21-160">160</a></span>
<span class="normal"><a href="#__codelineno-21-161">161</a></span>
<span class="normal"><a href="#__codelineno-21-162">162</a></span>
<span class="normal"><a href="#__codelineno-21-163">163</a></span>
<span class="normal"><a href="#__codelineno-21-164">164</a></span>
<span class="normal"><a href="#__codelineno-21-165">165</a></span>
<span class="normal"><a href="#__codelineno-21-166">166</a></span>
<span class="normal"><a href="#__codelineno-21-167">167</a></span>
<span class="normal"><a href="#__codelineno-21-168">168</a></span>
<span class="normal"><a href="#__codelineno-21-169">169</a></span>
<span class="normal"><a href="#__codelineno-21-170">170</a></span>
<span class="normal"><a href="#__codelineno-21-171">171</a></span>
<span class="normal"><a href="#__codelineno-21-172">172</a></span>
<span class="normal"><a href="#__codelineno-21-173">173</a></span>
<span class="normal"><a href="#__codelineno-21-174">174</a></span>
<span class="normal"><a href="#__codelineno-21-175">175</a></span>
<span class="normal"><a href="#__codelineno-21-176">176</a></span>
<span class="normal"><a href="#__codelineno-21-177">177</a></span>
<span class="normal"><a href="#__codelineno-21-178">178</a></span>
<span class="normal"><a href="#__codelineno-21-179">179</a></span>
<span class="normal"><a href="#__codelineno-21-180">180</a></span>
<span class="normal"><a href="#__codelineno-21-181">181</a></span>
<span class="normal"><a href="#__codelineno-21-182">182</a></span>
<span class="normal"><a href="#__codelineno-21-183">183</a></span>
<span class="normal"><a href="#__codelineno-21-184">184</a></span>
<span class="normal"><a href="#__codelineno-21-185">185</a></span>
<span class="normal"><a href="#__codelineno-21-186">186</a></span>
<span class="normal"><a href="#__codelineno-21-187">187</a></span>
<span class="normal"><a href="#__codelineno-21-188">188</a></span>
<span class="normal"><a href="#__codelineno-21-189">189</a></span>
<span class="normal"><a href="#__codelineno-21-190">190</a></span>
<span class="normal"><a href="#__codelineno-21-191">191</a></span>
<span class="normal"><a href="#__codelineno-21-192">192</a></span>
<span class="normal"><a href="#__codelineno-21-193">193</a></span>
<span class="normal"><a href="#__codelineno-21-194">194</a></span>
<span class="normal"><a href="#__codelineno-21-195">195</a></span>
<span class="normal"><a href="#__codelineno-21-196">196</a></span>
<span class="normal"><a href="#__codelineno-21-197">197</a></span>
<span class="normal"><a href="#__codelineno-21-198">198</a></span>
<span class="normal"><a href="#__codelineno-21-199">199</a></span>
<span class="normal"><a href="#__codelineno-21-200">200</a></span>
<span class="normal"><a href="#__codelineno-21-201">201</a></span>
<span class="normal"><a href="#__codelineno-21-202">202</a></span>
<span class="normal"><a href="#__codelineno-21-203">203</a></span>
<span class="normal"><a href="#__codelineno-21-204">204</a></span>
<span class="normal"><a href="#__codelineno-21-205">205</a></span>
<span class="normal"><a href="#__codelineno-21-206">206</a></span>
<span class="normal"><a href="#__codelineno-21-207">207</a></span>
<span class="normal"><a href="#__codelineno-21-208">208</a></span>
<span class="normal"><a href="#__codelineno-21-209">209</a></span>
<span class="normal"><a href="#__codelineno-21-210">210</a></span>
<span class="normal"><a href="#__codelineno-21-211">211</a></span>
<span class="normal"><a href="#__codelineno-21-212">212</a></span>
<span class="normal"><a href="#__codelineno-21-213">213</a></span>
<span class="normal"><a href="#__codelineno-21-214">214</a></span>
<span class="normal"><a href="#__codelineno-21-215">215</a></span>
<span class="normal"><a href="#__codelineno-21-216">216</a></span>
<span class="normal"><a href="#__codelineno-21-217">217</a></span>
<span class="normal"><a href="#__codelineno-21-218">218</a></span>
<span class="normal"><a href="#__codelineno-21-219">219</a></span>
<span class="normal"><a href="#__codelineno-21-220">220</a></span>
<span class="normal"><a href="#__codelineno-21-221">221</a></span>
<span class="normal"><a href="#__codelineno-21-222">222</a></span>
<span class="normal"><a href="#__codelineno-21-223">223</a></span>
<span class="normal"><a href="#__codelineno-21-224">224</a></span>
<span class="normal"><a href="#__codelineno-21-225">225</a></span>
<span class="normal"><a href="#__codelineno-21-226">226</a></span>
<span class="normal"><a href="#__codelineno-21-227">227</a></span>
<span class="normal"><a href="#__codelineno-21-228">228</a></span>
<span class="normal"><a href="#__codelineno-21-229">229</a></span>
<span class="normal"><a href="#__codelineno-21-230">230</a></span>
<span class="normal"><a href="#__codelineno-21-231">231</a></span>
<span class="normal"><a href="#__codelineno-21-232">232</a></span>
<span class="normal"><a href="#__codelineno-21-233">233</a></span>
<span class="normal"><a href="#__codelineno-21-234">234</a></span>
<span class="normal"><a href="#__codelineno-21-235">235</a></span>
<span class="normal"><a href="#__codelineno-21-236">236</a></span>
<span class="normal"><a href="#__codelineno-21-237">237</a></span>
<span class="normal"><a href="#__codelineno-21-238">238</a></span>
<span class="normal"><a href="#__codelineno-21-239">239</a></span>
<span class="normal"><a href="#__codelineno-21-240">240</a></span>
<span class="normal"><a href="#__codelineno-21-241">241</a></span>
<span class="normal"><a href="#__codelineno-21-242">242</a></span>
<span class="normal"><a href="#__codelineno-21-243">243</a></span>
<span class="normal"><a href="#__codelineno-21-244">244</a></span>
<span class="normal"><a href="#__codelineno-21-245">245</a></span>
<span class="normal"><a href="#__codelineno-21-246">246</a></span>
<span class="normal"><a href="#__codelineno-21-247">247</a></span>
<span class="normal"><a href="#__codelineno-21-248">248</a></span>
<span class="normal"><a href="#__codelineno-21-249">249</a></span>
<span class="normal"><a href="#__codelineno-21-250">250</a></span>
<span class="normal"><a href="#__codelineno-21-251">251</a></span>
<span class="normal"><a href="#__codelineno-21-252">252</a></span>
<span class="normal"><a href="#__codelineno-21-253">253</a></span>
<span class="normal"><a href="#__codelineno-21-254">254</a></span>
<span class="normal"><a href="#__codelineno-21-255">255</a></span>
<span class="normal"><a href="#__codelineno-21-256">256</a></span>
<span class="normal"><a href="#__codelineno-21-257">257</a></span>
<span class="normal"><a href="#__codelineno-21-258">258</a></span>
<span class="normal"><a href="#__codelineno-21-259">259</a></span>
<span class="normal"><a href="#__codelineno-21-260">260</a></span>
<span class="normal"><a href="#__codelineno-21-261">261</a></span>
<span class="normal"><a href="#__codelineno-21-262">262</a></span>
<span class="normal"><a href="#__codelineno-21-263">263</a></span>
<span class="normal"><a href="#__codelineno-21-264">264</a></span>
<span class="normal"><a href="#__codelineno-21-265">265</a></span>
<span class="normal"><a href="#__codelineno-21-266">266</a></span>
<span class="normal"><a href="#__codelineno-21-267">267</a></span>
<span class="normal"><a href="#__codelineno-21-268">268</a></span>
<span class="normal"><a href="#__codelineno-21-269">269</a></span>
<span class="normal"><a href="#__codelineno-21-270">270</a></span>
<span class="normal"><a href="#__codelineno-21-271">271</a></span>
<span class="normal"><a href="#__codelineno-21-272">272</a></span>
<span class="normal"><a href="#__codelineno-21-273">273</a></span>
<span class="normal"><a href="#__codelineno-21-274">274</a></span>
<span class="normal"><a href="#__codelineno-21-275">275</a></span>
<span class="normal"><a href="#__codelineno-21-276">276</a></span>
<span class="normal"><a href="#__codelineno-21-277">277</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="cm">/*</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="cm"> * Decompiled with CFR.</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="cm"> *</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="cm"> * Could not load the following classes:</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="cm"> *  test.aop.bean.WorldService</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="cm"> *  test.aop.bean.WorldServiceImpl</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="cm"> */</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="kn">package</span><span class="w"> </span><span class="nn">test.aop.bean</span><span class="p">;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Method</span><span class="p">;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">net.sf.cglib.core.ReflectUtils</span><span class="p">;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">net.sf.cglib.core.Signature</span><span class="p">;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">net.sf.cglib.proxy.Callback</span><span class="p">;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">net.sf.cglib.proxy.Factory</span><span class="p">;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">net.sf.cglib.proxy.MethodInterceptor</span><span class="p">;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">net.sf.cglib.proxy.MethodProxy</span><span class="p">;</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">test.aop.bean.WorldService</span><span class="p">;</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">test.aop.bean.WorldServiceImpl</span><span class="p">;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="kd">extends</span><span class="w"> </span><span class="n">WorldServiceImpl</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="kd">implements</span><span class="w"> </span><span class="n">WorldService</span><span class="p">,</span>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="n">Factory</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">CGLIB$BOUND</span><span class="p">;</span>
<a id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">CGLIB$FACTORY_DATA</span><span class="p">;</span>
<a id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="w"> </span><span class="n">CGLIB$THREAD_CALLBACKS</span><span class="p">;</span>
<a id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="n">CGLIB$STATIC_CALLBACKS</span><span class="p">;</span>
<a id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">CGLIB$CALLBACK_FILTER</span><span class="p">;</span>
<a id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">CGLIB$explode$0$Method</span><span class="p">;</span>
<a id="__codelineno-21-31" name="__codelineno-21-31"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">CGLIB$explode$0$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-32" name="__codelineno-21-32"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">CGLIB$emptyArgs</span><span class="p">;</span>
<a id="__codelineno-21-33" name="__codelineno-21-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">CGLIB$equals$1$Method</span><span class="p">;</span>
<a id="__codelineno-21-34" name="__codelineno-21-34"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">CGLIB$equals$1$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-35" name="__codelineno-21-35"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">CGLIB$toString$2$Method</span><span class="p">;</span>
<a id="__codelineno-21-36" name="__codelineno-21-36"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">CGLIB$toString$2$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-37" name="__codelineno-21-37"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">CGLIB$hashCode$3$Method</span><span class="p">;</span>
<a id="__codelineno-21-38" name="__codelineno-21-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">CGLIB$hashCode$3$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-39" name="__codelineno-21-39"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">CGLIB$clone$4$Method</span><span class="p">;</span>
<a id="__codelineno-21-40" name="__codelineno-21-40"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="n">CGLIB$clone$4$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-41" name="__codelineno-21-41"></a>
<a id="__codelineno-21-42" name="__codelineno-21-42"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-43" name="__codelineno-21-43"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-21-44" name="__codelineno-21-44"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">);</span>
<a id="__codelineno-21-45" name="__codelineno-21-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-46" name="__codelineno-21-46"></a>
<a id="__codelineno-21-47" name="__codelineno-21-47"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-48" name="__codelineno-21-48"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$STATICHOOK1</span><span class="p">();</span>
<a id="__codelineno-21-49" name="__codelineno-21-49"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-50" name="__codelineno-21-50"></a>
<a id="__codelineno-21-51" name="__codelineno-21-51"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-52" name="__codelineno-21-52"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-53" name="__codelineno-21-53"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-54" name="__codelineno-21-54"></a><span class="w">            </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-21-55" name="__codelineno-21-55"></a><span class="w">            </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-56" name="__codelineno-21-56"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-57" name="__codelineno-21-57"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-58" name="__codelineno-21-58"></a><span class="w">            </span><span class="n">Object</span><span class="w"> </span><span class="n">object2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">intercept</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$equals$1$Method</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">object</span><span class="p">},</span><span class="w"> </span><span class="n">CGLIB$equals$1$Proxy</span><span class="p">);</span>
<a id="__codelineno-21-59" name="__codelineno-21-59"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">object2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Boolean</span><span class="p">)</span><span class="n">object2</span><span class="p">;</span>
<a id="__codelineno-21-60" name="__codelineno-21-60"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-61" name="__codelineno-21-61"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
<a id="__codelineno-21-62" name="__codelineno-21-62"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-63" name="__codelineno-21-63"></a>
<a id="__codelineno-21-64" name="__codelineno-21-64"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-65" name="__codelineno-21-65"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-66" name="__codelineno-21-66"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-67" name="__codelineno-21-67"></a><span class="w">            </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-21-68" name="__codelineno-21-68"></a><span class="w">            </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-69" name="__codelineno-21-69"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-70" name="__codelineno-21-70"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-71" name="__codelineno-21-71"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">intercept</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$toString$2$Method</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$emptyArgs</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$toString$2$Proxy</span><span class="p">);</span>
<a id="__codelineno-21-72" name="__codelineno-21-72"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-73" name="__codelineno-21-73"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-21-74" name="__codelineno-21-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-75" name="__codelineno-21-75"></a>
<a id="__codelineno-21-76" name="__codelineno-21-76"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-77" name="__codelineno-21-77"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-78" name="__codelineno-21-78"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-79" name="__codelineno-21-79"></a><span class="w">            </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-21-80" name="__codelineno-21-80"></a><span class="w">            </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-81" name="__codelineno-21-81"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-82" name="__codelineno-21-82"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-83" name="__codelineno-21-83"></a><span class="w">            </span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">intercept</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$hashCode$3$Method</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$emptyArgs</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$hashCode$3$Proxy</span><span class="p">);</span>
<a id="__codelineno-21-84" name="__codelineno-21-84"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="n">Number</span><span class="p">)</span><span class="n">object</span><span class="p">).</span><span class="na">intValue</span><span class="p">();</span>
<a id="__codelineno-21-85" name="__codelineno-21-85"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-86" name="__codelineno-21-86"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">hashCode</span><span class="p">();</span>
<a id="__codelineno-21-87" name="__codelineno-21-87"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-88" name="__codelineno-21-88"></a>
<a id="__codelineno-21-89" name="__codelineno-21-89"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">clone</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">CloneNotSupportedException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-90" name="__codelineno-21-90"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-91" name="__codelineno-21-91"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-92" name="__codelineno-21-92"></a><span class="w">            </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-21-93" name="__codelineno-21-93"></a><span class="w">            </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-94" name="__codelineno-21-94"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-95" name="__codelineno-21-95"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-96" name="__codelineno-21-96"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">intercept</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$clone$4$Method</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$emptyArgs</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$clone$4$Proxy</span><span class="p">);</span>
<a id="__codelineno-21-97" name="__codelineno-21-97"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-98" name="__codelineno-21-98"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">clone</span><span class="p">();</span>
<a id="__codelineno-21-99" name="__codelineno-21-99"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-100" name="__codelineno-21-100"></a>
<a id="__codelineno-21-101" name="__codelineno-21-101"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-21-102" name="__codelineno-21-102"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">newInstance</span><span class="p">(</span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="n">callbackArray</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-103" name="__codelineno-21-103"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$SET_THREAD_CALLBACKS</span><span class="p">(</span><span class="n">callbackArray</span><span class="p">);</span>
<a id="__codelineno-21-104" name="__codelineno-21-104"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">();</span>
<a id="__codelineno-21-105" name="__codelineno-21-105"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$SET_THREAD_CALLBACKS</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-21-106" name="__codelineno-21-106"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">;</span>
<a id="__codelineno-21-107" name="__codelineno-21-107"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-108" name="__codelineno-21-108"></a>
<a id="__codelineno-21-109" name="__codelineno-21-109"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-21-110" name="__codelineno-21-110"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">newInstance</span><span class="p">(</span><span class="n">Callback</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-111" name="__codelineno-21-111"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$SET_THREAD_CALLBACKS</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Callback</span><span class="o">[]</span><span class="p">{</span><span class="n">callback</span><span class="p">});</span>
<a id="__codelineno-21-112" name="__codelineno-21-112"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">();</span>
<a id="__codelineno-21-113" name="__codelineno-21-113"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$SET_THREAD_CALLBACKS</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-21-114" name="__codelineno-21-114"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">;</span>
<a id="__codelineno-21-115" name="__codelineno-21-115"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-116" name="__codelineno-21-116"></a>
<a id="__codelineno-21-117" name="__codelineno-21-117"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-21-118" name="__codelineno-21-118"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">newInstance</span><span class="p">(</span><span class="n">Class</span><span class="o">[]</span><span class="w"> </span><span class="n">classArray</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">objectArray</span><span class="p">,</span><span class="w"> </span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="n">callbackArray</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-119" name="__codelineno-21-119"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">;</span>
<a id="__codelineno-21-120" name="__codelineno-21-120"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$SET_THREAD_CALLBACKS</span><span class="p">(</span><span class="n">callbackArray</span><span class="p">);</span>
<a id="__codelineno-21-121" name="__codelineno-21-121"></a><span class="w">        </span><span class="n">Class</span><span class="o">[]</span><span class="w"> </span><span class="n">classArray2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">classArray</span><span class="p">;</span>
<a id="__codelineno-21-122" name="__codelineno-21-122"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">classArray</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-123" name="__codelineno-21-123"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-124" name="__codelineno-21-124"></a><span class="w">                </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">();</span>
<a id="__codelineno-21-125" name="__codelineno-21-125"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-126" name="__codelineno-21-126"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-127" name="__codelineno-21-127"></a><span class="w">            </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-128" name="__codelineno-21-128"></a><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Constructor not found&quot;</span><span class="p">);</span>
<a id="__codelineno-21-129" name="__codelineno-21-129"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-130" name="__codelineno-21-130"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-131" name="__codelineno-21-131"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$SET_THREAD_CALLBACKS</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-21-132" name="__codelineno-21-132"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">;</span>
<a id="__codelineno-21-133" name="__codelineno-21-133"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-134" name="__codelineno-21-134"></a>
<a id="__codelineno-21-135" name="__codelineno-21-135"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">explode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-136" name="__codelineno-21-136"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-137" name="__codelineno-21-137"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-138" name="__codelineno-21-138"></a><span class="w">            </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-21-139" name="__codelineno-21-139"></a><span class="w">            </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-140" name="__codelineno-21-140"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-141" name="__codelineno-21-141"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-142" name="__codelineno-21-142"></a><span class="w">            </span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">intercept</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$explode$0$Method</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$emptyArgs</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$explode$0$Proxy</span><span class="p">);</span>
<a id="__codelineno-21-143" name="__codelineno-21-143"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-21-144" name="__codelineno-21-144"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-145" name="__codelineno-21-145"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-21-146" name="__codelineno-21-146"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-147" name="__codelineno-21-147"></a>
<a id="__codelineno-21-148" name="__codelineno-21-148"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-21-149" name="__codelineno-21-149"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="nf">getCallbacks</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-150" name="__codelineno-21-150"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-21-151" name="__codelineno-21-151"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-21-152" name="__codelineno-21-152"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Callback</span><span class="o">[]</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">};</span>
<a id="__codelineno-21-153" name="__codelineno-21-153"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-154" name="__codelineno-21-154"></a>
<a id="__codelineno-21-155" name="__codelineno-21-155"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">CGLIB$STATICHOOK1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-156" name="__codelineno-21-156"></a><span class="w">        </span><span class="n">CGLIB$THREAD_CALLBACKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="p">();</span>
<a id="__codelineno-21-157" name="__codelineno-21-157"></a><span class="w">        </span><span class="n">CGLIB$emptyArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-158" name="__codelineno-21-158"></a><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;test.aop.bean.WorldServiceImpl$$EnhancerByCGLIB$$81790592&quot;</span><span class="p">);</span>
<a id="__codelineno-21-159" name="__codelineno-21-159"></a><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;test.aop.bean.WorldServiceImpl&quot;</span><span class="p">);</span>
<a id="__codelineno-21-160" name="__codelineno-21-160"></a><span class="w">        </span><span class="n">CGLIB$explode$0$Method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReflectUtils</span><span class="p">.</span><span class="na">findMethods</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;explode&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()V&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">clazz2</span><span class="p">.</span><span class="na">getDeclaredMethods</span><span class="p">())</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-161" name="__codelineno-21-161"></a><span class="w">        </span><span class="n">CGLIB$explode$0$Proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MethodProxy</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">clazz2</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()V&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;explode&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CGLIB$explode$0&quot;</span><span class="p">);</span>
<a id="__codelineno-21-162" name="__codelineno-21-162"></a><span class="w">        </span><span class="n">clazz2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;java.lang.Object&quot;</span><span class="p">);</span>
<a id="__codelineno-21-163" name="__codelineno-21-163"></a><span class="w">        </span><span class="n">Method</span><span class="o">[]</span><span class="w"> </span><span class="n">methodArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReflectUtils</span><span class="p">.</span><span class="na">findMethods</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;equals&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;(Ljava/lang/Object;)Z&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;toString&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()Ljava/lang/String;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hashCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()I&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clone&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()Ljava/lang/Object;&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">clazz2</span><span class="p">.</span><span class="na">getDeclaredMethods</span><span class="p">());</span>
<a id="__codelineno-21-164" name="__codelineno-21-164"></a><span class="w">        </span><span class="n">CGLIB$equals$1$Method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-165" name="__codelineno-21-165"></a><span class="w">        </span><span class="n">CGLIB$equals$1$Proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MethodProxy</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">clazz2</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;(Ljava/lang/Object;)Z&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;equals&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CGLIB$equals$1&quot;</span><span class="p">);</span>
<a id="__codelineno-21-166" name="__codelineno-21-166"></a><span class="w">        </span><span class="n">CGLIB$toString$2$Method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-167" name="__codelineno-21-167"></a><span class="w">        </span><span class="n">CGLIB$toString$2$Proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MethodProxy</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">clazz2</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()Ljava/lang/String;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;toString&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CGLIB$toString$2&quot;</span><span class="p">);</span>
<a id="__codelineno-21-168" name="__codelineno-21-168"></a><span class="w">        </span><span class="n">CGLIB$hashCode$3$Method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-169" name="__codelineno-21-169"></a><span class="w">        </span><span class="n">CGLIB$hashCode$3$Proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MethodProxy</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">clazz2</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()I&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hashCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CGLIB$hashCode$3&quot;</span><span class="p">);</span>
<a id="__codelineno-21-170" name="__codelineno-21-170"></a><span class="w">        </span><span class="n">CGLIB$clone$4$Method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-171" name="__codelineno-21-171"></a><span class="w">        </span><span class="n">CGLIB$clone$4$Proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MethodProxy</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">clazz2</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;()Ljava/lang/Object;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clone&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CGLIB$clone$4&quot;</span><span class="p">);</span>
<a id="__codelineno-21-172" name="__codelineno-21-172"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-173" name="__codelineno-21-173"></a>
<a id="__codelineno-21-174" name="__codelineno-21-174"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">CGLIB$toString$2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-175" name="__codelineno-21-175"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-21-176" name="__codelineno-21-176"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-177" name="__codelineno-21-177"></a>
<a id="__codelineno-21-178" name="__codelineno-21-178"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-179" name="__codelineno-21-179"></a><span class="w">        </span><span class="n">block2</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-180" name="__codelineno-21-180"></a><span class="w">            </span><span class="n">Object</span><span class="w"> </span><span class="n">object2</span><span class="p">;</span>
<a id="__codelineno-21-181" name="__codelineno-21-181"></a><span class="w">            </span><span class="n">block3</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-182" name="__codelineno-21-182"></a><span class="w">                </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">)</span><span class="n">object</span><span class="p">;</span>
<a id="__codelineno-21-183" name="__codelineno-21-183"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BOUND</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">block2</span><span class="p">;</span>
<a id="__codelineno-21-184" name="__codelineno-21-184"></a><span class="w">                </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BOUND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-21-185" name="__codelineno-21-185"></a><span class="w">                </span><span class="n">object2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGLIB$THREAD_CALLBACKS</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-21-186" name="__codelineno-21-186"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">object2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">block3</span><span class="p">;</span>
<a id="__codelineno-21-187" name="__codelineno-21-187"></a><span class="w">                </span><span class="n">object2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGLIB$STATIC_CALLBACKS</span><span class="p">;</span>
<a id="__codelineno-21-188" name="__codelineno-21-188"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CGLIB$STATIC_CALLBACKS</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">block2</span><span class="p">;</span>
<a id="__codelineno-21-189" name="__codelineno-21-189"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-190" name="__codelineno-21-190"></a><span class="w">            </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MethodInterceptor</span><span class="p">)((</span><span class="n">Callback</span><span class="o">[]</span><span class="p">)</span><span class="n">object2</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-191" name="__codelineno-21-191"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-192" name="__codelineno-21-192"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-193" name="__codelineno-21-193"></a>
<a id="__codelineno-21-194" name="__codelineno-21-194"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">CGLIB$equals$1</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-195" name="__codelineno-21-195"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
<a id="__codelineno-21-196" name="__codelineno-21-196"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-197" name="__codelineno-21-197"></a>
<a id="__codelineno-21-198" name="__codelineno-21-198"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">CGLIB$explode$0</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-199" name="__codelineno-21-199"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-21-200" name="__codelineno-21-200"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-201" name="__codelineno-21-201"></a>
<a id="__codelineno-21-202" name="__codelineno-21-202"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">CGLIB$hashCode$3</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-203" name="__codelineno-21-203"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">hashCode</span><span class="p">();</span>
<a id="__codelineno-21-204" name="__codelineno-21-204"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-205" name="__codelineno-21-205"></a>
<a id="__codelineno-21-206" name="__codelineno-21-206"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-21-207" name="__codelineno-21-207"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCallback</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">Callback</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-208" name="__codelineno-21-208"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-209" name="__codelineno-21-209"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-210" name="__codelineno-21-210"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MethodInterceptor</span><span class="p">)</span><span class="n">callback</span><span class="p">;</span>
<a id="__codelineno-21-211" name="__codelineno-21-211"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-212" name="__codelineno-21-212"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-213" name="__codelineno-21-213"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-214" name="__codelineno-21-214"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-215" name="__codelineno-21-215"></a>
<a id="__codelineno-21-216" name="__codelineno-21-216"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-21-217" name="__codelineno-21-217"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCallbacks</span><span class="p">(</span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="n">callbackArray</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-218" name="__codelineno-21-218"></a><span class="w">        </span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="n">callbackArray2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">callbackArray</span><span class="p">;</span>
<a id="__codelineno-21-219" name="__codelineno-21-219"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="n">worldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-21-220" name="__codelineno-21-220"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MethodInterceptor</span><span class="p">)</span><span class="n">callbackArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-221" name="__codelineno-21-221"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-222" name="__codelineno-21-222"></a>
<a id="__codelineno-21-223" name="__codelineno-21-223"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MethodProxy</span><span class="w"> </span><span class="nf">CGLIB$findMethodProxy</span><span class="p">(</span><span class="n">Signature</span><span class="w"> </span><span class="n">signature</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-224" name="__codelineno-21-224"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">Object</span><span class="p">)</span><span class="n">signature</span><span class="p">).</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-21-225" name="__codelineno-21-225"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="na">hashCode</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-226" name="__codelineno-21-226"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="o">-</span><span class="mi">508378822</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-227" name="__codelineno-21-227"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">string</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;clone()Ljava/lang/Object;&quot;</span><span class="p">))</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-228" name="__codelineno-21-228"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">CGLIB$clone$4$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-229" name="__codelineno-21-229"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-230" name="__codelineno-21-230"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">1741417204</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-231" name="__codelineno-21-231"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">string</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;explode()V&quot;</span><span class="p">))</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-232" name="__codelineno-21-232"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">CGLIB$explode$0$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-233" name="__codelineno-21-233"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-234" name="__codelineno-21-234"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">1826985398</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-235" name="__codelineno-21-235"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">string</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;equals(Ljava/lang/Object;)Z&quot;</span><span class="p">))</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-236" name="__codelineno-21-236"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">CGLIB$equals$1$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-237" name="__codelineno-21-237"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-238" name="__codelineno-21-238"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">1913648695</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-239" name="__codelineno-21-239"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">string</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;toString()Ljava/lang/String;&quot;</span><span class="p">))</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-240" name="__codelineno-21-240"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">CGLIB$toString$2$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-241" name="__codelineno-21-241"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-242" name="__codelineno-21-242"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">1984935277</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-243" name="__codelineno-21-243"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">string</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;hashCode()I&quot;</span><span class="p">))</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-244" name="__codelineno-21-244"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">CGLIB$hashCode$3$Proxy</span><span class="p">;</span>
<a id="__codelineno-21-245" name="__codelineno-21-245"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-246" name="__codelineno-21-246"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-247" name="__codelineno-21-247"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-21-248" name="__codelineno-21-248"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-249" name="__codelineno-21-249"></a>
<a id="__codelineno-21-250" name="__codelineno-21-250"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">CGLIB$clone$4</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">CloneNotSupportedException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-251" name="__codelineno-21-251"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">clone</span><span class="p">();</span>
<a id="__codelineno-21-252" name="__codelineno-21-252"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-253" name="__codelineno-21-253"></a>
<a id="__codelineno-21-254" name="__codelineno-21-254"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-21-255" name="__codelineno-21-255"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Callback</span><span class="w"> </span><span class="nf">getCallback</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-256" name="__codelineno-21-256"></a><span class="w">        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">;</span>
<a id="__codelineno-21-257" name="__codelineno-21-257"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-21-258" name="__codelineno-21-258"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-259" name="__codelineno-21-259"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-260" name="__codelineno-21-260"></a><span class="w">                </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-21-261" name="__codelineno-21-261"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-262" name="__codelineno-21-262"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-263" name="__codelineno-21-263"></a><span class="w">            </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-264" name="__codelineno-21-264"></a><span class="w">                </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-21-265" name="__codelineno-21-265"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-21-266" name="__codelineno-21-266"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-267" name="__codelineno-21-267"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">;</span>
<a id="__codelineno-21-268" name="__codelineno-21-268"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-269" name="__codelineno-21-269"></a>
<a id="__codelineno-21-270" name="__codelineno-21-270"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">CGLIB$SET_STATIC_CALLBACKS</span><span class="p">(</span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="n">callbackArray</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-271" name="__codelineno-21-271"></a><span class="w">        </span><span class="n">CGLIB$STATIC_CALLBACKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">callbackArray</span><span class="p">;</span>
<a id="__codelineno-21-272" name="__codelineno-21-272"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-273" name="__codelineno-21-273"></a>
<a id="__codelineno-21-274" name="__codelineno-21-274"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">CGLIB$SET_THREAD_CALLBACKS</span><span class="p">(</span><span class="n">Callback</span><span class="o">[]</span><span class="w"> </span><span class="n">callbackArray</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-275" name="__codelineno-21-275"></a><span class="w">        </span><span class="n">CGLIB$THREAD_CALLBACKS</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">callbackArray</span><span class="p">);</span>
<a id="__codelineno-21-276" name="__codelineno-21-276"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-277" name="__codelineno-21-277"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>

</details>

<p>主要关注动态代理后的 <code>explode</code> 方法做了什么？</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">explode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">        </span><span class="n">WorldServiceImpl$$EnhancerByCGLIB$$81790592</span><span class="p">.</span><span class="na">CGLIB$BIND_CALLBACKS</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">        </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">CGLIB$CALLBACK_0</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="p">.</span><span class="na">intercept</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$explode$0$Method</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$emptyArgs</span><span class="p">,</span><span class="w"> </span><span class="n">CGLIB$explode$0$Proxy</span><span class="p">);</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="kd">super</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>首先获取 <code>MethodInterceptor</code>，如果不为空，则调用 <code>MethodInterceptor</code> 的 <code>intercept</code> 方法</p>
<p>即 <code>DynamicAdvisedInterceptor</code> 类的 <code>intercept</code> 方法，<strong>执行动态代理的方法</strong></p>
<h2 id="aop">AOP 代理工厂<a class="headerlink" href="#aop" title="Permanent link">&para;</a></h2>
<h3 id="1">1. 测试代码<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nd">@Test</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testProxyFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="c1">// 使用 JDK 动态代理</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setProxyTargetClass</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="n">WorldService</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldService</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProxyFactory</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">).</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="c1">// 使用 Cglib 动态代理</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setProxyTargetClass</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldService</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProxyFactory</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">).</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">    </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="2-aop">2. AOP 代理工厂代码<a class="headerlink" href="#2-aop" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProxyFactory</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advisedSupport</span><span class="p">;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ProxyFactory</span><span class="p">(</span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advisedSupport</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">advisedSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advisedSupport</span><span class="p">;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">createAopProxy</span><span class="p">().</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AopProxy</span><span class="w"> </span><span class="nf">createAopProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">isProxyTargetClass</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CglibAopProxy</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">);</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JdkDynamicAopProxy</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">);</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>注意到切换 <code>JDK</code> 和 <code>Cglib</code> 动态代理之间的关键是 <code>AdvisedSupport</code> 的 <code>proxyTargetClass</code> 参数</p>
<ul>
<li><code>proxyTargetClass</code> 为 <code>false</code> 代表使用 <code>JDK</code> 动态代理</li>
<li><code>proxyTargetClass</code> 为 <code>true</code> 代表使用 <code>Cglib</code> 动态代理</li>
</ul>
<p>而 <code>AdvisedSupport</code> 的 <code>proxyTargetClass</code> 参数 <strong>默认值</strong> 为 <code>false</code>，即默认使用 <code>JDK</code> 动态代理</p>
<h2 id="advicebeforeadviceafteradviceafterreturningadvicethrowsadvice">几种常用的Advice：BeforeAdvice/AfterAdvice/AfterReturningAdvice/ThrowsAdvice...<a class="headerlink" href="#advicebeforeadviceafteradviceafterreturningadvicethrowsadvice" title="Permanent link">&para;</a></h2>
<p><code>Spring</code> 将 <code>AOP</code> 联盟中的 <code>Advice</code> 细化出各种类型的 <code>Advice</code>，常用的有<code>BeforeAdvice/AfterAdvice/AfterReturningAdvice/ThrowsAdvice</code>，我们可以通过扩展<code>MethodInterceptor</code>来实现。</p>
<p>测试代码</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WorldServiceBeforeAdvice</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MethodBeforeAdvice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">before</span><span class="p">(</span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;BeforeAdvice: do something before the earth explodes&quot;</span><span class="p">);</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nd">@Test</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testBeforeAdvice</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">    </span><span class="c1">//设置BeforeAdvice</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">    </span><span class="n">WorldServiceBeforeAdvice</span><span class="w"> </span><span class="n">beforeAdvice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceBeforeAdvice</span><span class="p">();</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">    </span><span class="n">MethodBeforeAdviceInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MethodBeforeAdviceInterceptor</span><span class="p">(</span><span class="n">beforeAdvice</span><span class="p">);</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setMethodInterceptor</span><span class="p">(</span><span class="n">methodInterceptor</span><span class="p">);</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">    </span><span class="n">WorldService</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldService</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProxyFactory</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">).</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">    </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>简单来说，就是通过规范 <code>Interceptor</code> 分类，根据需要的<strong>代理时机</strong>选择对应的 <code>Advice</code> 和 <code>Interceptor</code> 即可，相对简单，不过多赘述</p>
<h2 id="spring-aop_1">Spring AOP 拦截器链<a class="headerlink" href="#spring-aop_1" title="Permanent link">&para;</a></h2>
<p>虽然在前面我们完成了对方法的增强，但并不完美。我们的目前的代码只能支持对方法的单个增强。作为spring的核心功能如果不支持多切面的话有点太别扭了。<code>spring</code>利用了<strong>拦截器链</strong>来完成了对多个切面的支持。</p>
<h4 id="proxyfactory">ProxyFactory<a class="headerlink" href="#proxyfactory" title="Permanent link">&para;</a></h4>
<p>让我们从 <code>ProxyFactory</code> 开始，来看一下代理对象的整个创建流程。至于为什么从 <code>ProxyFactory</code>开，这是因为代理对象最终是用 <code>ProxyFactory</code> 的 <code>getProxy()</code> 函数来获得的。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProxyFactory</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ProxyFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">createAopProxy</span><span class="p">().</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AopProxy</span><span class="w"> </span><span class="nf">createAopProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">isProxyTargetClass</span><span class="p">()</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTargetClass</span><span class="p">().</span><span class="na">length</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CglibAopProxy</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JdkDynamicAopProxy</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>为了更贴合<code>spring</code>的实现，这里更改了 <code>ProxyFactory</code> 使其<strong>继承</strong>了 <code>AdvisedSupport</code>，正如spring源码中做的那样。</p>
<hr />
<h4 id="jdk_1">基于JDK动态代理<a class="headerlink" href="#jdk_1" title="Permanent link">&para;</a></h4>
<p><code>ProxyFactory</code> 只是简单的做了下选择，当我们<strong>设置 <code>proxyTargetClass</code> 属性</strong>或者<strong>被代理对象没有接口时</strong>会调用 <code>cjlib</code> 动态代理，否则调用 <code>jdk</code> 动态代理。二者实现并没有太大区别，这里只贴出jdk动态代理的实现。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getProxy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Proxy</span><span class="p">.</span><span class="na">newProxyInstance</span><span class="p">(</span><span class="n">getClass</span><span class="p">().</span><span class="na">getClassLoader</span><span class="p">(),</span><span class="w"> </span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTargetClass</span><span class="p">(),</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">        </span><span class="c1">// 获取目标对象</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">target</span><span class="o">=</span><span class="n">advised</span><span class="p">.</span><span class="na">getTargetSource</span><span class="p">().</span><span class="na">getTarget</span><span class="p">();</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">targetClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="na">getClass</span><span class="p">();</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">retVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">        </span><span class="c1">// 获取拦截器链</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">advised</span><span class="p">.</span><span class="na">getInterceptorsAndDynamicInterceptionAdvice</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">targetClass</span><span class="p">);</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">chain</span><span class="o">==</span><span class="kc">null</span><span class="o">||</span><span class="n">chain</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()){</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">            </span><span class="c1">// 将拦截器统一封装成ReflectiveMethodInvocation</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="w">            </span><span class="n">MethodInvocation</span><span class="w"> </span><span class="n">invocation</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">ReflectiveMethodInvocation</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">targetClass</span><span class="p">,</span><span class="w"> </span><span class="n">chain</span><span class="p">);</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="w">            </span><span class="c1">// Proceed to the joinpoint through the interceptor chain.</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="w">            </span><span class="c1">// 执行拦截器链</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a><span class="w">            </span><span class="n">retVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invocation</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">retVal</span><span class="p">;</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>jdk动态代理可以分为<strong>获取拦截器链，将拦截器统一封装成 <code>ReflectiveMethodInvocation</code>，执行拦截器链</strong>三部分。我们来逐一看一下这三部分。</p>
<hr />
<h5 id="1_1">1. 获取拦截器链<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h5>
<p>首先将获取到所有与当前<code>method</code>匹配的<code>advice</code><strong>(增强)</strong>，跟踪<code>getInterceptorsAndDynamicInterceptionAdvice</code>代码，我们发现<code>Spring AOP</code>也使用<strong>缓存</strong>进行提高性能，如果该方法已经获取过拦截器，则直接取缓存，否则通过<code>advisorChainFactory</code>获取拦截器链。</p>
<p><code>AdvisorChainFactory</code>是用来获得拦截器链接口。它的一个实现类为<code>DefaultAdvisorChainFactory</code></p>
<p><code>AdvisedSupport#getInterceptorsAndDynamicInterceptionAdvice</code>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getInterceptorsAndDynamicInterceptionAdvice</span><span class="p">(</span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">targetClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">cacheKey</span><span class="o">=</span><span class="n">method</span><span class="p">.</span><span class="na">hashCode</span><span class="p">();</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">methodCache</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">);</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cached</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">            </span><span class="n">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">advisorChainFactory</span><span class="p">.</span><span class="na">getInterceptorsAndDynamicInterceptionAdvice</span><span class="p">(</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="w">                    </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">targetClass</span><span class="p">);</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">methodCache</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">,</span><span class="w"> </span><span class="n">cached</span><span class="p">);</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cached</span><span class="p">;</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><br/></p>
<p>接下来，对<code>advisorChainFactory</code>获取拦截器链进行解读。</p>
<p>整体代码并不复杂，首先获取所有<code>Advisor</code><strong>(切面)</strong>，通过<code>pointcutAdvisor.getPointcut().getClassFilter().matches(actualClass)</code>校验当前代理对象是否匹配该<code>Advisor</code>，再通过<code>pointcutAdvisor.getPointcut().getMethodMatcher()</code>校验<strong>是否匹配</strong>当前调用<code>method</code>。</p>
<p>如果通过校验，则提取<code>advisor</code>中的<code>interceptors</code>增强，添加到<code>interceptorList</code>中。</p>
<p>这里可能有读者会疑惑，明明是要获取<code>MethodInterceptor</code>，可<code>AdvisedSupport</code>的<code>getAdvice()</code>返回的是<code>Advice</code><strong>(增强)</strong>,其实如果我们点开<code>MethodInterceptor</code>的源码，我们会发现<code>MethodInterceptor</code>继承了<code>Interceptor</code>接口，而<code>Interceptor</code>又继承了<code>Advice</code>接口。因为这里的<code>Advice</code>和<code>MethodInterceptor</code>我们都是用的<code>AOP</code>联盟的接口，所以特此说明一下。</p>
<p><code>DefultAdvisorChainFactory#getInterceptorsAndDynamicInterceptionAdvice</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span>
<span class="normal"><a href="#__codelineno-30-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getInterceptorsAndDynamicInterceptionAdvice</span><span class="p">(</span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">targetClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">        </span><span class="n">Advisor</span><span class="o">[]</span><span class="w"> </span><span class="n">advisors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">getAdvisors</span><span class="p">().</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Advisor</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">interceptorList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">advisors</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">        </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">actualClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">targetClass</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">targetClass</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getDeclaringClass</span><span class="p">());</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Advisor</span><span class="w"> </span><span class="n">advisor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">advisors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">advisor</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">PointcutAdvisor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">                </span><span class="c1">// Add it conditionally.</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">                </span><span class="n">PointcutAdvisor</span><span class="w"> </span><span class="n">pointcutAdvisor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PointcutAdvisor</span><span class="p">)</span><span class="w"> </span><span class="n">advisor</span><span class="p">;</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">                </span><span class="c1">// 校验当前Advisor是否适用于当前对象</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pointcutAdvisor</span><span class="p">.</span><span class="na">getPointcut</span><span class="p">().</span><span class="na">getClassFilter</span><span class="p">().</span><span class="na">matches</span><span class="p">(</span><span class="n">actualClass</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="w">                    </span><span class="n">MethodMatcher</span><span class="w"> </span><span class="n">mm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pointcutAdvisor</span><span class="p">.</span><span class="na">getPointcut</span><span class="p">().</span><span class="na">getMethodMatcher</span><span class="p">();</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="w">                    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">match</span><span class="p">;</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="w">                    </span><span class="c1">// 校验Advisor是否应用到当前方法上</span>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="w">                    </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mm</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="n">actualClass</span><span class="p">);</span>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="w">                        </span><span class="n">MethodInterceptor</span><span class="w"> </span><span class="n">interceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MethodInterceptor</span><span class="p">)</span><span class="w"> </span><span class="n">advisor</span><span class="p">.</span><span class="na">getAdvice</span><span class="p">();</span>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="w">                            </span><span class="n">interceptorList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">interceptor</span><span class="p">);</span>
<a id="__codelineno-30-18" name="__codelineno-30-18"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">interceptorList</span><span class="p">;</span>
<a id="__codelineno-30-23" name="__codelineno-30-23"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="2reflectivemethodinvocation">2.将拦截器封装成ReflectiveMethodInvocation<a class="headerlink" href="#2reflectivemethodinvocation" title="Permanent link">&para;</a></h5>
<p>这里也是重写了<code>ReflectiveMethodInvocation</code>的实现，来支持多切面。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span>
<span class="normal"><a href="#__codelineno-31-5">5</a></span>
<span class="normal"><a href="#__codelineno-31-6">6</a></span>
<span class="normal"><a href="#__codelineno-31-7">7</a></span>
<span class="normal"><a href="#__codelineno-31-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ReflectiveMethodInvocation</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">proxy</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">targetClass</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arguments</span><span class="p">;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">targetClass</span><span class="o">=</span><span class="n">targetClass</span><span class="p">;</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">interceptorsAndDynamicMethodMatchers</span><span class="o">=</span><span class="n">chain</span><span class="p">;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="3">3.执行拦截器链<a class="headerlink" href="#3" title="Permanent link">&para;</a></h5>
<p>spring能够保证<strong>多个切面同时匹配同一方法的而不出现乱序</strong>的关键就在下面一段代码了。</p>
<p><code>ReflectiveMethodInvocation#proceed()</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">proceed</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">        </span><span class="c1">// 初始currentInterceptorIndex为-1，每调用一次proceed就把currentInterceptorIndex+1</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">currentInterceptorIndex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">interceptorsAndDynamicMethodMatchers</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">            </span><span class="c1">// 当调用次数 = 拦截器个数时</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">            </span><span class="c1">// 触发当前method方法</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">target</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">arguments</span><span class="p">);</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">interceptorOrInterceptionAdvice</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">interceptorsAndDynamicMethodMatchers</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="na">currentInterceptorIndex</span><span class="p">);</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w">        </span><span class="c1">// 普通拦截器，直接触发拦截器invoke方法</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">MethodInterceptor</span><span class="p">)</span><span class="w"> </span><span class="n">interceptorOrInterceptionAdvice</span><span class="p">).</span><span class="na">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>我们看到，<code>MethodInvocation</code>只是简单的将拦截器链的所有拦截器一一执行，最后再触发当前的<code>method</code>方法。</p>
<p>这是很简单高效的方法，但问题是我们希望某些增强比如<code>AfterReturningAdvice</code>能够在方法<strong>执行完</strong>才被执行，这就涉及到<strong>不同增强的执行顺序</strong>的问题了。</p>
<p>而<code>MethodInvocation</code>显然没有考虑顺序的问题，一个<code>AfterReturningAdvice</code>很可能在<code>BeforeAdvice</code>之前被调用。那么该如何保证顺序问题呢？</p>
<p>答案是，<strong>控制增强的调用顺序其实由每个拦截器负责</strong>，所以我们需要分析<code>MethodBeforeAdviceInterceptor</code>和<code>AfterReturningAdviceInterceptor</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MethodBeforeAdviceInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MethodInterceptor</span><span class="p">,</span><span class="w"> </span><span class="n">BeforeAdvice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MethodBeforeAdvice</span><span class="w"> </span><span class="n">advice</span><span class="p">;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MethodBeforeAdviceInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MethodBeforeAdviceInterceptor</span><span class="p">(</span><span class="n">MethodBeforeAdvice</span><span class="w"> </span><span class="n">advice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">advice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advice</span><span class="p">;</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAdvice</span><span class="p">(</span><span class="n">MethodBeforeAdvice</span><span class="w"> </span><span class="n">advice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">advice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advice</span><span class="p">;</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">MethodInvocation</span><span class="w"> </span><span class="n">mi</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">advice</span><span class="p">.</span><span class="na">before</span><span class="p">(</span><span class="n">mi</span><span class="p">.</span><span class="na">getMethod</span><span class="p">(),</span><span class="w"> </span><span class="n">mi</span><span class="p">.</span><span class="na">getArguments</span><span class="p">(),</span><span class="w"> </span><span class="n">mi</span><span class="p">.</span><span class="na">getThis</span><span class="p">());</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mi</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AfterReturningAdviceInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MethodInterceptor</span><span class="p">,</span><span class="w"> </span><span class="n">AfterAdvice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AfterReturningAdvice</span><span class="w"> </span><span class="n">advice</span><span class="p">;</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">AfterReturningAdviceInterceptor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">AfterReturningAdviceInterceptor</span><span class="p">(</span><span class="n">AfterReturningAdvice</span><span class="w"> </span><span class="n">advice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">advice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advice</span><span class="p">;</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="n">MethodInvocation</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="w">       </span><span class="n">Object</span><span class="w"> </span><span class="n">retVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="w">       </span><span class="k">this</span><span class="p">.</span><span class="na">advice</span><span class="p">.</span><span class="na">afterReturning</span><span class="p">(</span><span class="n">retVal</span><span class="p">,</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">.</span><span class="na">getMethod</span><span class="p">(),</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">.</span><span class="na">getArguments</span><span class="p">(),</span><span class="w"> </span><span class="n">methodInvocation</span><span class="p">.</span><span class="na">getThis</span><span class="p">());</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">retVal</span><span class="p">;</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>看了源码大家应该就清楚了，<strong>拦截器链执行的顺序</strong>正时在各个拦截器的<code>invoke</code>方法中实现的。<code>before</code>会<strong>先执行<code>advice</code>增强方法再链式调用</strong>，而<code>after</code>则是<strong>先执行链式调用，再调用<code>advice</code>增强方法</strong>，也就是一个<strong>递归</strong>的过程。和二叉树的遍历有些异曲同工之处。</p>
<p><img alt="" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2024/12/26/17350539252278.jpg" /></p>
<h3 id="_1">测试<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span>
<span class="normal"><a href="#__codelineno-35-19">19</a></span>
<span class="normal"><a href="#__codelineno-35-20">20</a></span>
<span class="normal"><a href="#__codelineno-35-21">21</a></span>
<span class="normal"><a href="#__codelineno-35-22">22</a></span>
<span class="normal"><a href="#__codelineno-35-23">23</a></span>
<span class="normal"><a href="#__codelineno-35-24">24</a></span>
<span class="normal"><a href="#__codelineno-35-25">25</a></span>
<span class="normal"><a href="#__codelineno-35-26">26</a></span>
<span class="normal"><a href="#__codelineno-35-27">27</a></span>
<span class="normal"><a href="#__codelineno-35-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nd">@Before</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">    </span><span class="n">WorldService</span><span class="w"> </span><span class="n">worldService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceImpl</span><span class="p">();</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProxyFactory</span><span class="p">();</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">    </span><span class="c1">//Advisor是Pointcut和Advice的组合</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;execution(* test.aop.bean.WorldService.explode(..))&quot;</span><span class="p">;</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">    </span><span class="n">AspectJExpressionPointcutAdvisor</span><span class="w"> </span><span class="n">advisor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AspectJExpressionPointcutAdvisor</span><span class="p">();</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">    </span><span class="n">advisor</span><span class="p">.</span><span class="na">setExpression</span><span class="p">(</span><span class="n">expression</span><span class="p">);</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">    </span><span class="n">AfterReturningAdviceInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AfterReturningAdviceInterceptor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceAfterReturnAdvice</span><span class="p">());</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">    </span><span class="n">advisor</span><span class="p">.</span><span class="na">setAdvice</span><span class="p">(</span><span class="n">methodInterceptor</span><span class="p">);</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">    </span><span class="n">TargetSource</span><span class="w"> </span><span class="n">targetSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TargetSource</span><span class="p">(</span><span class="n">worldService</span><span class="p">);</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setTargetSource</span><span class="p">(</span><span class="n">targetSource</span><span class="p">);</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">addAdvisor</span><span class="p">(</span><span class="n">advisor</span><span class="p">);</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="p">}</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="nd">@Test</span>
<a id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testBeforeAdvice</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="w">    </span><span class="c1">//设置BeforeAdvice</span>
<a id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;execution(* test.aop.bean.WorldService.explode(..))&quot;</span><span class="p">;</span>
<a id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="w">    </span><span class="n">AspectJExpressionPointcutAdvisor</span><span class="w"> </span><span class="n">advisor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AspectJExpressionPointcutAdvisor</span><span class="p">();</span>
<a id="__codelineno-35-21" name="__codelineno-35-21"></a><span class="w">    </span><span class="n">advisor</span><span class="p">.</span><span class="na">setExpression</span><span class="p">(</span><span class="n">expression</span><span class="p">);</span>
<a id="__codelineno-35-22" name="__codelineno-35-22"></a><span class="w">    </span><span class="n">MethodBeforeAdviceInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MethodBeforeAdviceInterceptor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceBeforeAdvice</span><span class="p">());</span>
<a id="__codelineno-35-23" name="__codelineno-35-23"></a><span class="w">    </span><span class="n">advisor</span><span class="p">.</span><span class="na">setAdvice</span><span class="p">(</span><span class="n">methodInterceptor</span><span class="p">);</span>
<a id="__codelineno-35-24" name="__codelineno-35-24"></a><span class="w">    </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">addAdvisor</span><span class="p">(</span><span class="n">advisor</span><span class="p">);</span>
<a id="__codelineno-35-25" name="__codelineno-35-25"></a><span class="w">    </span><span class="n">ProxyFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ProxyFactory</span><span class="p">)</span><span class="w"> </span><span class="n">advisedSupport</span><span class="p">;</span>
<a id="__codelineno-35-26" name="__codelineno-35-26"></a><span class="w">    </span><span class="n">WorldService</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldService</span><span class="p">)</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-35-27" name="__codelineno-35-27"></a><span class="w">    </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-35-28" name="__codelineno-35-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="pointcutadvisorpointcutadvice">PointcutAdvisor：Pointcut和Advice的组合<a class="headerlink" href="#pointcutadvisorpointcutadvice" title="Permanent link">&para;</a></h2>
<p><code>Advisor</code>是包含一个<code>Pointcut</code>和一个<code>Advice</code>的组合，<code>Pointcut</code>用于捕获<code>JoinPoint</code>，<code>Advice</code>决定在<code>JoinPoint</code>执行某种操作。实现了一个支持<code>aspectj</code>表达式的<code>AspectJExpressionPointcutAdvisor</code>。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span>
<span class="normal"><a href="#__codelineno-36-22">22</a></span>
<span class="normal"><a href="#__codelineno-36-23">23</a></span>
<span class="normal"><a href="#__codelineno-36-24">24</a></span>
<span class="normal"><a href="#__codelineno-36-25">25</a></span>
<span class="normal"><a href="#__codelineno-36-26">26</a></span>
<span class="normal"><a href="#__codelineno-36-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DynamicProxyTest</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testAdvisor</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">        </span><span class="n">WorldService</span><span class="w"> </span><span class="n">worldService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceImpl</span><span class="p">();</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">        </span><span class="c1">//Advisor是Pointcut和Advice的组合</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;execution(* org.springframework.test.service.WorldService.explode(..))&quot;</span><span class="p">;</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">        </span><span class="n">AspectJExpressionPointcutAdvisor</span><span class="w"> </span><span class="n">advisor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AspectJExpressionPointcutAdvisor</span><span class="p">();</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">        </span><span class="n">advisor</span><span class="p">.</span><span class="na">setExpression</span><span class="p">(</span><span class="n">expression</span><span class="p">);</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">        </span><span class="n">MethodBeforeAdviceInterceptor</span><span class="w"> </span><span class="n">methodInterceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MethodBeforeAdviceInterceptor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">WorldServiceBeforeAdvice</span><span class="p">());</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">        </span><span class="n">advisor</span><span class="p">.</span><span class="na">setAdvice</span><span class="p">(</span><span class="n">methodInterceptor</span><span class="p">);</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">        </span><span class="n">ClassFilter</span><span class="w"> </span><span class="n">classFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">advisor</span><span class="p">.</span><span class="na">getPointcut</span><span class="p">().</span><span class="na">getClassFilter</span><span class="p">();</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">classFilter</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="n">worldService</span><span class="p">.</span><span class="na">getClass</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="w">            </span><span class="n">AdvisedSupport</span><span class="w"> </span><span class="n">advisedSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AdvisedSupport</span><span class="p">();</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="w">            </span><span class="n">TargetSource</span><span class="w"> </span><span class="n">targetSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TargetSource</span><span class="p">(</span><span class="n">worldService</span><span class="p">);</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">            </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setTargetSource</span><span class="p">(</span><span class="n">targetSource</span><span class="p">);</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="w">            </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setMethodInterceptor</span><span class="p">((</span><span class="n">MethodInterceptor</span><span class="p">)</span><span class="w"> </span><span class="n">advisor</span><span class="p">.</span><span class="na">getAdvice</span><span class="p">());</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a><span class="w">            </span><span class="n">advisedSupport</span><span class="p">.</span><span class="na">setMethodMatcher</span><span class="p">(</span><span class="n">advisor</span><span class="p">.</span><span class="na">getPointcut</span><span class="p">().</span><span class="na">getMethodMatcher</span><span class="p">());</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="c1">//          advisedSupport.setProxyTargetClass(true);   //JDK or CGLIB</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a><span class="w">            </span><span class="n">WorldService</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">WorldService</span><span class="p">)</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProxyFactory</span><span class="p">(</span><span class="n">advisedSupport</span><span class="p">).</span><span class="na">getProxy</span><span class="p">();</span>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a><span class="w">            </span><span class="n">proxy</span><span class="p">.</span><span class="na">explode</span><span class="p">();</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="bean">动态代理融入Bean的生命周期<a class="headerlink" href="#bean" title="Permanent link">&para;</a></h2>
<p><code>BeanPostProcessor</code>处理阶段可以修改和替换<code>bean</code>，正好可以在此阶段返回<strong>代理对象替换原对象</strong>。不过我们引入一种特殊的<code>BeanPostProcessor</code>——<code>InstantiationAwareBeanPostProcessor</code>，织入逻辑位于<code>BeanPostProcessor#postProcessAfterInitialization</code>，具体实现查看<code>AbstractAutowireCapableBeanFactory#resolveBeforeInstantiation</code>。</p>
<p><code>DefaultAdvisorAutoProxyCreator</code>是处理横切逻辑的织入返回代理对象的<code>InstantiationAwareBeanPostProcessor</code>实现类，当对象实例化时，生成代理对象并返回。</p>
<p><strong>至此，bean的生命周期如下</strong> </p>
<p><img alt="" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2024/12/27/17353103588346.jpg" /></p>
<ol>
<li>读取xml文件</li>
<li>load beandefinition</li>
<li>BeanFactoryProcessor 修改 BeanDefinition</li>
<li>InstantiationAwareBeanPostProcessor#postProcessBeforeInstantiation</li>
<li>bean实例化</li>
<li>BeanFactoryAware(setBeanFactory, setBeanName, setBeanClassLoader)</li>
<li>BeanPostProcessor前置处理 (例：ApplicationContextAwareProcessor)</li>
<li>执行 bean 的初始化方法<ol>
<li>InitializingBean#afterPropertiesSet</li>
<li>自定义初始化方法init-method</li>
</ol>
</li>
<li>BeanPostProcessor后置处理(InstantiationAwareBeanPostProcessor#postProcessAfterInitialization创建代理对象返回)</li>
<li>如果是DisposableBean注册销毁方法</li>
<li>判断scope<ol>
<li>如果是singleton，放入缓存</li>
<li>如果是prototype，过</li>
</ol>
</li>
<li>使用</li>
<li>执行bean的销毁方法(singleton）<ol>
<li>DisposableBean#destroy</li>
<li>自定义销毁方法destroy-metod</li>
</ol>
</li>
</ol>
<h2 id="enableaspectjautoproxy">@EnableAspectJAutoProxy<a class="headerlink" href="#enableaspectjautoproxy" title="Permanent link">&para;</a></h2>
<p>在<code>spring</code>中我们要<strong>开启自动代理</strong>的功能需要在<strong>配置类</strong>添加如下的注解：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="nd">@EnableAspectJAutoProxy</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppConfiguration</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<p>当然在<code>xml</code>中配置也可：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">XML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="nt">&lt;aop:aspectj-autoproxy</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div></td></tr></table></div>
<p>注解源码如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="nd">@Target</span><span class="p">(</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">)</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="nd">@Documented</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="nd">@Import</span><span class="p">(</span><span class="n">AspectJAutoProxyRegistrar</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">EnableAspectJAutoProxy</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">proxyTargetClass</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">exposeProxy</span><span class="p">()</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在该注解中我们可以配置<code>proxyTargetClass</code>和<code>exposeProxy</code>两个重要属性，<strong>它们分别控制着Spring如何创建和使用代理对象来实现切面功能。</strong></p>
<h3 id="proxytargetclass"><strong>proxyTargetClass</strong><a class="headerlink" href="#proxytargetclass" title="Permanent link">&para;</a></h3>
<p>用于指示<code>Spring AOP</code>应使用<strong>哪种类型的代理</strong>来织入切面：</p>
<ul>
<li><code>proxyTargetClass = true</code>: 指示Spring使用<code>CGLIB</code>库生成基于类的代理。这意味着Spring会<strong>创建目标类的子类</strong>，并在其中插入切面逻辑。这种代理方式可以拦截类的所有方法（包括非接口方法和final方法），适用于那些<strong>没有接口或者需要对非公共方法进行增强</strong>的场景。</li>
<li><code>proxyTargetClass = false 或未指定（默认情况）</code>: Spring将使用标准的<strong>JDK动态代理</strong>技术，即创建一个实现了目标类所有接口的新代理对象，并在代理对象的方法调用中插入切面逻辑。这种方式仅能用于<strong>代理实现了至少一个接口的目标类，且只能拦截通过接口声明的方法</strong>。</li>
</ul>
<h3 id="exposeproxy"><strong>exposeProxy</strong><a class="headerlink" href="#exposeproxy" title="Permanent link">&para;</a></h3>
<p>用于控制代理对象是否应被公开给被代理对象的内部方法访问：</p>
<ul>
<li>
<p><code>exposeProxy = true</code>: 当设置为<strong>true</strong>时，<code>Spring</code>会确保在<strong>AOP代理对象上下文</strong>中，通过 <code>AopContext.currentProxy()</code> 方法能够获取到<strong>当前正在执行的代理对象</strong>。<br />
这对于在被代理对象内部需要调用自身其他方法，并希望这些内部方法调用也能触发切面逻辑的情况非常有用。<br />
例如，一个服务类中的某个方法可能需要调用另一个<strong>私有</strong>或<strong>受保护</strong>的方法，而这两个方法都被同一个切面所增强。在这种情况下，若不暴露代理，内部方法调用将不会经过切面处理；而暴露代理后，可以通过 <code>AopContext.currentProxy().methodToCall()</code> 的方式确保内部方法调用也得到切面的拦截。</p>
</li>
<li>
<p><code>exposeProxy = false 或未指定（默认情况）</code>： 默认情况下，<code>Spring</code>不会特别暴露代理对象，因此在被代理对象内部直接通过 <code>this</code> 调用其他方法时，这些方法调用将<strong>不会触发切面逻辑</strong>，而是直接调用目标类的原始方法。</p>
</li>
</ul>
<p>关于 <strong>exposeProxy</strong>，来看一个业务中的实际使用场景 <em>(我的 IM 项目中用到了)</em></p>
<p>以下是一段处理好友申请的业务逻辑</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span>
<span class="normal"><a href="#__codelineno-40-17">17</a></span>
<span class="normal"><a href="#__codelineno-40-18">18</a></span>
<span class="normal"><a href="#__codelineno-40-19">19</a></span>
<span class="normal"><a href="#__codelineno-40-20">20</a></span>
<span class="normal"><a href="#__codelineno-40-21">21</a></span>
<span class="normal"><a href="#__codelineno-40-22">22</a></span>
<span class="normal"><a href="#__codelineno-40-23">23</a></span>
<span class="normal"><a href="#__codelineno-40-24">24</a></span>
<span class="normal"><a href="#__codelineno-40-25">25</a></span>
<span class="normal"><a href="#__codelineno-40-26">26</a></span>
<span class="normal"><a href="#__codelineno-40-27">27</a></span>
<span class="normal"><a href="#__codelineno-40-28">28</a></span>
<span class="normal"><a href="#__codelineno-40-29">29</a></span>
<span class="normal"><a href="#__codelineno-40-30">30</a></span>
<span class="normal"><a href="#__codelineno-40-31">31</a></span>
<span class="normal"><a href="#__codelineno-40-32">32</a></span>
<span class="normal"><a href="#__codelineno-40-33">33</a></span>
<span class="normal"><a href="#__codelineno-40-34">34</a></span>
<span class="normal"><a href="#__codelineno-40-35">35</a></span>
<span class="normal"><a href="#__codelineno-40-36">36</a></span>
<span class="normal"><a href="#__codelineno-40-37">37</a></span>
<span class="normal"><a href="#__codelineno-40-38">38</a></span>
<span class="normal"><a href="#__codelineno-40-39">39</a></span>
<span class="normal"><a href="#__codelineno-40-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="cm">/**</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="cm"> * 申请好友</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="cm"> * @param uid     uid</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="cm"> * @param request 请求</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="cm"> * @return {@link RestBean}</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="cm"> */</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="nd">@Transactional</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="nd">@Override</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="nd">@RedissonLock</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;#uid&quot;</span><span class="p">)</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="kd">public</span><span class="w"> </span><span class="n">RestBean</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">FriendApplyReq</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="w">    </span><span class="c1">// 不能添加自己为好友</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getTargetUid</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestBean</span><span class="p">.</span><span class="na">failure</span><span class="p">(</span><span class="n">FriendErrorEnum</span><span class="p">.</span><span class="na">SELF_APPLY_FORBIDDEN</span><span class="p">);</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><span class="w">    </span><span class="c1">// 判断是否存在好友关系</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="w">    </span><span class="n">UserFriend</span><span class="w"> </span><span class="n">isFriend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userFriendDao</span><span class="p">.</span><span class="na">getByFriend</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getTargetUid</span><span class="p">());</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a><span class="w">    </span><span class="c1">// 已经存在好友关系</span>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Objects</span><span class="p">.</span><span class="na">nonNull</span><span class="p">(</span><span class="n">isFriend</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestBean</span><span class="p">.</span><span class="na">failure</span><span class="p">(</span><span class="n">FriendErrorEnum</span><span class="p">.</span><span class="na">ALREADY_FRIENDS</span><span class="p">);</span>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="w">    </span><span class="c1">// 判断是否存在申请记录 （我 -&gt; 对方） 且 申请状态为 待审批</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a><span class="w">    </span><span class="n">UserApply</span><span class="w"> </span><span class="n">myFriendApply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userApplyDao</span><span class="p">.</span><span class="na">getFriendApply</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getTargetUid</span><span class="p">());</span>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a><span class="w">    </span><span class="c1">// 存在申请</span>
<a id="__codelineno-40-24" name="__codelineno-40-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Objects</span><span class="p">.</span><span class="na">nonNull</span><span class="p">(</span><span class="n">myFriendApply</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-25" name="__codelineno-40-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestBean</span><span class="p">.</span><span class="na">failure</span><span class="p">(</span><span class="n">FriendErrorEnum</span><span class="p">.</span><span class="na">EXISTS_FRIEND_APPLY</span><span class="p">);</span>
<a id="__codelineno-40-26" name="__codelineno-40-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-27" name="__codelineno-40-27"></a><span class="w">    </span><span class="c1">// 判断是否存在申请记录 (对方 -&gt; 我)</span>
<a id="__codelineno-40-28" name="__codelineno-40-28"></a><span class="w">    </span><span class="n">UserApply</span><span class="w"> </span><span class="n">friendApply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userApplyDao</span><span class="p">.</span><span class="na">getFriendApply</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getTargetUid</span><span class="p">(),</span><span class="w"> </span><span class="n">uid</span><span class="p">);</span>
<a id="__codelineno-40-29" name="__codelineno-40-29"></a><span class="w">    </span><span class="c1">// 如果存在，直接同意</span>
<a id="__codelineno-40-30" name="__codelineno-40-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Objects</span><span class="p">.</span><span class="na">nonNull</span><span class="p">(</span><span class="n">friendApply</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-31" name="__codelineno-40-31"></a><span class="w">        </span><span class="c1">// 获取当前执行的对象的代理实例(确保事务正确执行)，同意申请</span>
<a id="__codelineno-40-32" name="__codelineno-40-32"></a><span class="w">        </span><span class="p">((</span><span class="n">FriendService</span><span class="p">)</span><span class="w"> </span><span class="n">AopContext</span><span class="p">.</span><span class="na">currentProxy</span><span class="p">()).</span><span class="na">applyApprove</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FriendApplyApproveReq</span><span class="p">(</span><span class="n">friendApply</span><span class="p">.</span><span class="na">getId</span><span class="p">()));</span>
<a id="__codelineno-40-33" name="__codelineno-40-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestBean</span><span class="p">.</span><span class="na">success</span><span class="p">();</span>
<a id="__codelineno-40-34" name="__codelineno-40-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-35" name="__codelineno-40-35"></a><span class="w">    </span><span class="n">UserApply</span><span class="w"> </span><span class="n">userApply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FriendAdapter</span><span class="p">.</span><span class="na">buildFriendApply</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">);</span>
<a id="__codelineno-40-36" name="__codelineno-40-36"></a><span class="w">    </span><span class="n">userApplyDao</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">userApply</span><span class="p">);</span>
<a id="__codelineno-40-37" name="__codelineno-40-37"></a><span class="w">    </span><span class="c1">// 用户申请事件，向对方异步发送请求消息</span>
<a id="__codelineno-40-38" name="__codelineno-40-38"></a><span class="w">    </span><span class="n">applicationEventPublisher</span><span class="p">.</span><span class="na">publishEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UserApplyEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">userApply</span><span class="p">));</span>
<a id="__codelineno-40-39" name="__codelineno-40-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">RestBean</span><span class="p">.</span><span class="na">success</span><span class="p">();</span>
<a id="__codelineno-40-40" name="__codelineno-40-40"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>主要关注业务中处理 <strong>如果申请记录(对方-&gt;我)存在，则直接同意申请</strong> 的处理逻辑 </p>
<p>这一行代码的核心是确保事务和其他切面逻辑（如 <code>@Transactional</code> 和 <code>@RedissonLock</code>）在调用 <code>applyApprove</code> 方法时能够生效。</p>
<p>为什么需要通过代理调用？</p>
<ul>
<li><strong>事务传播问题</strong>：<ul>
<li>在 Spring 中，如果类中的一个方法<strong>直接调用</strong>同类的另一个方法（比如 <code>apply</code> 调用 <code>this.applyApprove</code>），Spring 的<strong>动态代理不会生效</strong>。</li>
<li>这会导致 <code>applyApprove</code> 方法上的事务注解 <code>@Transactional</code> 被忽略，<strong>事务功能失效</strong>。</li>
</ul>
</li>
<li>代理解决方案：<ul>
<li>使用 <code>AopContext.currentProxy()</code> 获取当前类的<strong>代理对象</strong>。</li>
<li>通过<strong>代理对象</strong>调用方法，保证事务和切面逻辑生效。</li>
</ul>
</li>
</ul>
<h2 id="aop_1">AOP 生成代理的三个时机<a class="headerlink" href="#aop_1" title="Permanent link">&para;</a></h2>
<h3 id="beforeinstantiation"><strong>实例化前(BeforeInstantiation)</strong><a class="headerlink" href="#beforeinstantiation" title="Permanent link">&para;</a></h3>
<p>讲道理一般不用</p>
<p>具体时机在 <code>createBean</code> 方法上半部分 <code>#resolveBeforeInstantiation</code>，如果 <code>Bean</code> 在 <strong>实例化前</strong> 被动态代理了，判断 <code>Bean</code> 是否为 <code>null</code>，如果不为 <code>null</code>，则<strong>短路并直接返回</strong></p>
<p>无代理则进入下半部分 <code>doCreateBean</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span>
<span class="normal"><a href="#__codelineno-41-21">21</a></span>
<span class="normal"><a href="#__codelineno-41-22">22</a></span>
<span class="normal"><a href="#__codelineno-41-23">23</a></span>
<span class="normal"><a href="#__codelineno-41-24">24</a></span>
<span class="normal"><a href="#__codelineno-41-25">25</a></span>
<span class="normal"><a href="#__codelineno-41-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="cm">/**</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="cm"> * Apply before-instantiation post-processors, resolving whether there is a</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="cm"> * before-instantiation shortcut for the specified bean.</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="cm"> * @param beanName the name of the bean</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="cm"> * @param mbd the bean definition for the bean</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="cm"> * @return the shortcut-determined bean instance, or {@code null} if none</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="cm"> */</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;deprecation&quot;</span><span class="p">)</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="nd">@Nullable</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="kd">protected</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">resolveBeforeInstantiation</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">RootBeanDefinition</span><span class="w"> </span><span class="n">mbd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Boolean</span><span class="p">.</span><span class="na">FALSE</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">mbd</span><span class="p">.</span><span class="na">beforeInstantiationResolved</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">        </span><span class="c1">// Make sure bean class is actually resolved at this point.</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">mbd</span><span class="p">.</span><span class="na">isSynthetic</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">hasInstantiationAwareBeanPostProcessors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">            </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">targetType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">determineTargetType</span><span class="p">(</span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">mbd</span><span class="p">);</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">targetType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">                </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applyBeanPostProcessorsBeforeInstantiation</span><span class="p">(</span><span class="n">targetType</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bean</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a><span class="w">                    </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applyBeanPostProcessorsAfterInitialization</span><span class="p">(</span><span class="n">bean</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-41-21" name="__codelineno-41-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-41-22" name="__codelineno-41-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-41-23" name="__codelineno-41-23"></a><span class="w">        </span><span class="n">mbd</span><span class="p">.</span><span class="na">beforeInstantiationResolved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">bean</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-41-24" name="__codelineno-41-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-41-25" name="__codelineno-41-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<a id="__codelineno-41-26" name="__codelineno-41-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span>
<span class="normal"><a href="#__codelineno-42-29">29</a></span>
<span class="normal"><a href="#__codelineno-42-30">30</a></span>
<span class="normal"><a href="#__codelineno-42-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="nd">@Override</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">postProcessBeforeInstantiation</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">beanClass</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">    </span><span class="c1">// 缓存代理</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">cacheKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCacheKey</span><span class="p">(</span><span class="n">beanClass</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasLength</span><span class="p">(</span><span class="n">beanName</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="na">targetSourcedBeans</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">beanName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">advisedBeans</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isInfrastructureClass</span><span class="p">(</span><span class="n">beanClass</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">shouldSkip</span><span class="p">(</span><span class="n">beanClass</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">advisedBeans</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">,</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">FALSE</span><span class="p">);</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="w">    </span><span class="c1">// 如果我们有一个自定义的TargetSource，在这里创建代理。</span>
<a id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="w">    </span><span class="c1">// 抑制目标bean默认的实例化过程，就是说有这个配置就不会按照原有的方式进行实例化了</span>
<a id="__codelineno-42-18" name="__codelineno-42-18"></a><span class="w">    </span><span class="c1">// TargetSource将以自定义方式处理目标实例。</span>
<a id="__codelineno-42-19" name="__codelineno-42-19"></a><span class="w">    </span><span class="n">TargetSource</span><span class="w"> </span><span class="n">targetSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCustomTargetSource</span><span class="p">(</span><span class="n">beanClass</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-42-20" name="__codelineno-42-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">targetSource</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-21" name="__codelineno-42-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasLength</span><span class="p">(</span><span class="n">beanName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-22" name="__codelineno-42-22"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">targetSourcedBeans</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-42-23" name="__codelineno-42-23"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-42-24" name="__codelineno-42-24"></a><span class="w">        </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">specificInterceptors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getAdvicesAndAdvisorsForBean</span><span class="p">(</span><span class="n">beanClass</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">targetSource</span><span class="p">);</span>
<a id="__codelineno-42-25" name="__codelineno-42-25"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createProxy</span><span class="p">(</span><span class="n">beanClass</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">specificInterceptors</span><span class="p">,</span><span class="w"> </span><span class="n">targetSource</span><span class="p">);</span>
<a id="__codelineno-42-26" name="__codelineno-42-26"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">proxyTypes</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">,</span><span class="w"> </span><span class="n">proxy</span><span class="p">.</span><span class="na">getClass</span><span class="p">());</span>
<a id="__codelineno-42-27" name="__codelineno-42-27"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">proxy</span><span class="p">;</span>
<a id="__codelineno-42-28" name="__codelineno-42-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-29" name="__codelineno-42-29"></a>
<a id="__codelineno-42-30" name="__codelineno-42-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-42-31" name="__codelineno-42-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="afterinitialization"><strong>初始化后(AfterInitialization)</strong><a class="headerlink" href="#afterinitialization" title="Permanent link">&para;</a></h3>
<p>具体时机在 <code>Bean</code> 实例化之后，填充属性完毕之后，在调用 <code>initializeBean</code> 方法中的子方法 <code>applyBeanPostProcessorsAfterInitialization</code>, 即 <strong>BeanPostProcessor的后置方法</strong></p>
<p>原理可以看以下这个类图，AOP代理的核心类 <code>AutoProxyCreator</code> 均实现了 <code>BeanPostProcessor</code> 这个接口</p>
<p><img alt="" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2024/12/28/17353735113073.jpg" /></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="cm">/**</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="cm"> * Create a proxy with the configured interceptors if the bean is</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="cm"> * identified as one to proxy by the subclass.</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="cm"> * @see #getAdvicesAndAdvisorsForBean</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="cm"> */</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="nd">@Override</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="nd">@Nullable</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">postProcessAfterInitialization</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">bean</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bean</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="w">        </span><span class="n">Object</span><span class="w"> </span><span class="n">cacheKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCacheKey</span><span class="p">(</span><span class="n">bean</span><span class="p">.</span><span class="na">getClass</span><span class="p">(),</span><span class="w"> </span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">earlyBeanReferences</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">bean</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">wrapIfNecessary</span><span class="p">(</span><span class="n">bean</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">cacheKey</span><span class="p">);</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_2"><strong>循坏依赖</strong><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>如果开启了<strong>循环引用</strong>，在存在<strong>循环引用</strong>问题时，从<strong>三级缓存</strong>获取一个bean的代理对象的早期引用的时候可能为其生成代理，实现的逻辑和上边一样</p>
<p>在 <code>doCreateBean</code> 方法中</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span>
<span class="normal"><a href="#__codelineno-44-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1">// 处理循环依赖，将实例化后的Bean对象提前放入缓存中暴露出来</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">beanDefinition</span><span class="p">.</span><span class="na">isSingleton</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">finalBean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">    </span><span class="n">addSingletonFactory</span><span class="p">(</span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">getEarlyBeanReference</span><span class="p">(</span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">beanDefinition</span><span class="p">,</span><span class="w"> </span><span class="n">finalBean</span><span class="p">));</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span>
<span class="normal"><a href="#__codelineno-45-3">3</a></span>
<span class="normal"><a href="#__codelineno-45-4">4</a></span>
<span class="normal"><a href="#__codelineno-45-5">5</a></span>
<span class="normal"><a href="#__codelineno-45-6">6</a></span>
<span class="normal"><a href="#__codelineno-45-7">7</a></span>
<span class="normal"><a href="#__codelineno-45-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="kd">protected</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getEarlyBeanReference</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">,</span><span class="w"> </span><span class="n">BeanDefinition</span><span class="w"> </span><span class="n">beanDefinition</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">bean</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">exposedObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bean</span><span class="p">;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">BeanPostProcessor</span><span class="w"> </span><span class="n">beanPostProcessor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">getBeanPostProcessors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">beanPostProcessor</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">InstantiationAwareBeanPostProcessor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="w">            </span><span class="n">exposedObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">InstantiationAwareBeanPostProcessor</span><span class="p">)</span><span class="w"> </span><span class="n">beanPostProcessor</span><span class="p">).</span><span class="na">getEarlyBeanReference</span><span class="p">(</span><span class="n">exposedObject</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">exposedObject</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">exposedObject</span><span class="p">;</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="nd">@Override</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getEarlyBeanReference</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">bean</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">beanName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="w">    </span><span class="n">earlyProxyReferences</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">wrapIfNecessary</span><span class="p">(</span><span class="n">bean</span><span class="p">,</span><span class="w"> </span><span class="n">beanName</span><span class="p">);</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->

  
    
  

  <!-- Determine date of creation -->
  


<!-- Source file information -->

  <aside class="md-source-file">

    <!-- Date of last update -->
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2025年10月22日 12:37:18 UTC">2025-10-22</span>
  </span>

    

    <!-- Date of creation -->
    

    <!-- Authors (git-authors plugin) -->
    

    <!-- Authors (git-committers plugin) -->
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="贡献者">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a
          href="https://github.com/LunaY77"
          class="md-author"
          title="@LunaY77"
        >
          
          <img
            src="https://avatars.githubusercontent.com/u/106435907?v=4&size=72"
            alt="LunaY77"
          />
        </a>
      

      <!-- More authors -->
      
      
    </nav>
  </span>

    
  </aside>

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine feedback configuration -->

  


<!-- Determine whether to show feedback -->


<!-- Was this page helpful? -->

  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        此页面有帮助吗？
      </legend>
      <div class="md-feedback__inner">

        <!-- Feedback ratings -->
        <div class="md-feedback__list">
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page was helpful"
              data-md-value="1"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg>
            </button>
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page could be improved"
              data-md-value="0"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg>
            </button>
          
        </div>

        <!-- Feedback rating notes (shown after submission) -->
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              谢谢你的反馈！
            </div>
          
            <div data-md-value="0" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              Thanks for your feedback! Help us improve this page by using our <a href="https://marketingplatform.google.com/about/analytics/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Comment system -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <!-- Footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    
      
      <nav
        class="md-footer__inner md-grid"
        aria-label="页脚"
        
      >

        <!-- Link to previous page -->
        
          
          <a
            href="../../Java/FrequencyControl/"
            class="md-footer__link md-footer__link--prev"
            aria-label="上一页: Frequency-Control-Starter"
          >
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Frequency-Control-Starter
              </div>
            </div>
            
          </a>
        

        <!-- Link to next page -->
        
          
          <a
            href="../Spring-IOC/"
            class="md-footer__link md-footer__link--next"
            aria-label="下一页: Spring IOC 容器"
          >
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Spring IOC 容器
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022~2024 褚成志/All Rights Reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
   
    <font color="#B9B9B9">
      <div class="footer-visit-count" style="display: flex; justify-content: center; align-items: center;">
    本站访问量：<script async src="//finicounter.eu.org/finicounter.js"></script>
    <span id="finicount_views"></span>    &nbsp;|&nbsp;
    <footer>
      <!-- <a href="http://beian.miit.gov.cn/" target="_blank">浙ICP备2024135861号-1</a> -->
    </footer>
  
  </div>
      </font>

      <style>
        .footer-visit-count {
            height: fit-content;
            min-height: 55px; /* 根据实际情况调整此高度 */
        }
        </style>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/initchu" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<2307984361@qq.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M61.4 64C27.5 64 0 91.5 0 125.4c0 .9 0 1.7.1 2.6H0v256c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V128h-.1c0-.9.1-1.7.1-2.6 0-33.9-27.5-61.4-61.4-61.4zM464 192.3V384c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192.3l154.8 117.4c31.4 23.9 74.9 23.9 106.4 0zM48 125.4c0-7.4 6-13.4 13.4-13.4h389.2c7.4 0 13.4 6 13.4 13.4 0 4.2-2 8.2-5.3 10.7L280.2 271.5c-14.3 10.8-34.1 10.8-48.4 0L53.3 136.1c-3.3-2.5-5.3-6.5-5.3-10.7"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["announce.dismiss", "content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "navigation.expand", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/extra.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="../../../../javascripts/editable-code.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.0.2/dist/add-html-label-6e56ed67.min.js"></script>
      
    
    <script src="../../../../assets/javascripts/custom.9458f965.min.js"></script>
  
  </body>
</html>