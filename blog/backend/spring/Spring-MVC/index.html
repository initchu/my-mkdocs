
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="褚成志">
      
      
        <link rel="canonical" href="https://www.chucz.asia/blog/backend/spring/Spring-MVC/">
      
      
        <link rel="prev" href="../Spring-IOC/">
      
      
        <link rel="next" href="../Spring-tx/">
      
      
      <link rel="icon" href="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/106435907.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Spring MVC - 褚成志的分享站</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Bitter";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/link.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/customize.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/editable-code.css">
    
      <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-JWTTRFDCWY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-JWTTRFDCWY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-JWTTRFDCWY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
    <link rel="stylesheet" href="../../../../assets/stylesheets/custom.00c04c01.min.css">
  
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spring-mvc" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="褚成志的分享站" class="md-header__button md-logo" aria-label="褚成志的分享站" data-md-component="logo">
      
  <img src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/106435907.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            褚成志的分享站
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spring MVC
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭自动模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="关闭自动模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Pale-illusions/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Pale-illusions/ZH-TW/" hreflang="zh-TW" class="md-select__link">
              China(TW)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/initchu/my-mkdocs.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Mkdocs-褚成志
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../tag/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../" class="md-tabs__link">
          
  
  
    
  
  Blogger

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../JVM/JVM%20%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/" class="md-tabs__link">
          
  
  
    
  
  后端

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../frontend/JavaScript/testJs/" class="md-tabs__link">
          
  
  
    
  
  前端

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/" class="md-tabs__link">
          
  
  
    
  
  操作系统

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../about/link/" class="md-tabs__link">
          
  
  
    
  
  友链

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../about/me/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="褚成志的分享站" class="md-nav__button md-logo" aria-label="褚成志的分享站" data-md-component="logo">
      
  <img src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/23/106435907.png" alt="logo">

    </a>
    褚成志的分享站
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/initchu/my-mkdocs.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Mkdocs-褚成志
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Blogger
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blogger
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/cs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hello World
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/mac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mac
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/ospp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ospp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    project
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    后端
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            后端
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    JVM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            JVM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../JVM/JVM%20%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JVM 思维导图
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Java/FrequencyControl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Frequency-Control-Starter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring-AOP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring AOP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring-IOC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring IOC 容器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Spring MVC
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Spring MVC
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#springmvc" class="md-nav__link">
    <span class="md-ellipsis">
      SpringMVC原理
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      动态注册Web组件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="动态注册Web组件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webapplicationinitializer" class="md-nav__link">
    <span class="md-ellipsis">
      实现 WebApplicationInitializer 接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abstractannotationconfigdispatcherservletinitializer" class="md-nav__link">
    <span class="md-ellipsis">
      继承 AbstractAnnotationConfigDispatcherServletInitializer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      容器启动
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容器启动">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servletcontainerinitializer" class="md-nav__link">
    <span class="md-ellipsis">
      ServletContainerInitializer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      容器初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容器初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      根容器查找
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      容器创建
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mvc" class="md-nav__link">
    <span class="md-ellipsis">
      MVC初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MVC初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handlermapping" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerMapping检查
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handleradapter" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerAdapter检查
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handlermapping_1" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerMapping初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerMapping初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requestmappinghandlermapping" class="md-nav__link">
    <span class="md-ellipsis">
      RequestMappingHandlerMapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handleradapter_1" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerAdapter初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerAdapter初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      参数解析器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      返回结果解析器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      请求执行流程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求执行流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-service" class="md-nav__link">
    <span class="md-ellipsis">
      1. Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-processrequest" class="md-nav__link">
    <span class="md-ellipsis">
      2. processRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-doservice" class="md-nav__link">
    <span class="md-ellipsis">
      3. doService
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-dodispatch" class="md-nav__link">
    <span class="md-ellipsis">
      4. 请求分发 doDispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-gethandler" class="md-nav__link">
    <span class="md-ellipsis">
      5. 处理器查找 getHandler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-gethandleradapter" class="md-nav__link">
    <span class="md-ellipsis">
      6. 适配器查找 getHandlerAdapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-hahandle" class="md-nav__link">
    <span class="md-ellipsis">
      7. 请求处理 ha.handle(...)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring-tx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring 事务
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spring%E4%B8%AD%40Transactional%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spring中@Transactional失效场景
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    循环依赖
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AF%A6%E8%A7%A3%20Spring%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    详解 Spring 生命周期
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3_8" >
        
          
          <label class="md-nav__link" for="__nav_4_3_8" id="__nav_4_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    simple-spring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_8">
            <span class="md-nav__icon md-icon"></span>
            simple-spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simple-spring/simple-spring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simple-Spring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simple-spring/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Learn-Spring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    并发编程
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            并发编程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/CompletableFuture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CompletableFuture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/JUC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JUC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%BE%8E%E5%9B%A2%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java线程池实现原理及其在美团业务中的实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/ThreadLocal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ThreadLocal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Volatile%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Volatile与指令重排
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AF%B4%E7%9A%84Java%E2%80%9C%E9%94%81%E2%80%9D%E4%BA%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    不可不说的Java“锁”事
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E4%BB%8EReentrantLock%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%9C%8BAQS%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    从ReentrantLock的实现看AQS的原理及应用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分布式锁
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    架构设计
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            架构设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E4%BB%8E%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%90%86%E8%A7%A3Pull%E4%B8%8EPush%E6%A8%A1%E5%9E%8B%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    从消息队列理解Pull与Push模型底层逻辑
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%8F%AF%E9%9D%A0%E6%80%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    消息端到端的一致性与可靠性
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    前端
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            前端
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    JavaScript
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            JavaScript
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/JavaScript/testJs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JavaScript Code Runner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    QuickDive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            QuickDive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/JavaScript/QuickDive/BasicGrammar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基本语法
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    操作系统
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            操作系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IO多路复用底层原理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/%E5%88%86%E9%A1%B5%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分页存储原理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    友链
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            友链
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/link/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    友链
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            关于
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/me/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    作者个人简介
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#springmvc" class="md-nav__link">
    <span class="md-ellipsis">
      SpringMVC原理
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      动态注册Web组件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="动态注册Web组件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webapplicationinitializer" class="md-nav__link">
    <span class="md-ellipsis">
      实现 WebApplicationInitializer 接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abstractannotationconfigdispatcherservletinitializer" class="md-nav__link">
    <span class="md-ellipsis">
      继承 AbstractAnnotationConfigDispatcherServletInitializer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      容器启动
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容器启动">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servletcontainerinitializer" class="md-nav__link">
    <span class="md-ellipsis">
      ServletContainerInitializer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      容器初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容器初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      根容器查找
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      容器创建
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mvc" class="md-nav__link">
    <span class="md-ellipsis">
      MVC初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MVC初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handlermapping" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerMapping检查
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handleradapter" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerAdapter检查
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handlermapping_1" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerMapping初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerMapping初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requestmappinghandlermapping" class="md-nav__link">
    <span class="md-ellipsis">
      RequestMappingHandlerMapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handleradapter_1" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerAdapter初始化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerAdapter初始化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      参数解析器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      返回结果解析器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      请求执行流程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请求执行流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-service" class="md-nav__link">
    <span class="md-ellipsis">
      1. Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-processrequest" class="md-nav__link">
    <span class="md-ellipsis">
      2. processRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-doservice" class="md-nav__link">
    <span class="md-ellipsis">
      3. doService
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-dodispatch" class="md-nav__link">
    <span class="md-ellipsis">
      4. 请求分发 doDispatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-gethandler" class="md-nav__link">
    <span class="md-ellipsis">
      5. 处理器查找 getHandler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-gethandleradapter" class="md-nav__link">
    <span class="md-ellipsis">
      6. 适配器查找 getHandlerAdapter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-hahandle" class="md-nav__link">
    <span class="md-ellipsis">
      7. 请求处理 ha.handle(...)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../tag/#tag:java" class="md-tag">java</a>
      
    
      
      
      
        <a href="../../../../tag/#tag:spring" class="md-tag">spring</a>
      
    
  </nav>


  
    <a href="https://github.com/initchu/my-mkdocs.git/edit/main/docs/blog/backend/spring/Spring-MVC.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/initchu/my-mkdocs.git/raw/main/docs/blog/backend/spring/Spring-MVC.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="spring-mvc">Spring MVC<a class="headerlink" href="#spring-mvc" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 2586 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 734 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 8 张图片 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 18 分钟</p>
</div>
<div class="admonition 注意">
<p class="admonition-title">注意</p>
<p>文章中的代码大部分为我的项目 Simple-Spring 代码实现，非纯源码</p>
</div>
<h2 id="springmvc">SpringMVC原理<a class="headerlink" href="#springmvc" title="Permanent link">&para;</a></h2>
<p><img alt="" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/19/17372249274778.jpg" /></p>
<p>根据上图，我们可以得知Spring MVC的工作流程如下：</p>
<ol>
<li>用户（客户端，即浏览器）发送请求至前端控制器（DispatcherServlet）</li>
<li>前端控制器收到请求后调⽤处理器映射器（HandlerMapping）</li>
<li>处理器映射器根据请求Url找到具体的处理器（Handler，也叫后端控制器），生成处理器对象及处理器拦截器（如果有）一并返回给前端控制器</li>
<li>前端控制器收到处理器对象及处理器拦截器（如果有）后调用处理器适配器（HandlerAdapter）去调用处理器Handler</li>
<li>处理器适配器执行处理器</li>
<li>处理器执行完后给处理器适配器返回ModelAndView</li>
<li>处理器适配器将ModelAndView（ModelAndView是SpringMVC框架的⼀个底层对象，包括 Model 和 View）返回给前端控制器</li>
<li>前端控制器接收到ModelAndView后，请求视图解析器（ViewResolver）去进⾏视图解析，根据逻辑视图名来解析真正的视图</li>
<li>视图解析器将解析完的View返回给前端控制器</li>
<li>前端控制器进⾏视图渲染，就是将模型数据（在 ModelAndView 对象中）填充到 request 域</li>
<li>前端控制器向⽤户响应结果</li>
</ol>
<h2 id="web">动态注册Web组件<a class="headerlink" href="#web" title="Permanent link">&para;</a></h2>
<p>通常来说，要启动一个Web服务器，需要静态地在项目路径下配置 <code>webapp/WEB-INF/web.xml</code> 文件</p>
<p>那么 Spring 是怎么做到不使用<code>web.xml</code>，而是通过 Java 注解方式来动态地实现 Web 和 Mvc的呢？</p>
<p>先给出答案，可以通过以下两种方式动态配置</p>
<h3 id="webapplicationinitializer"><strong>实现 WebApplicationInitializer 接口</strong><a class="headerlink" href="#webapplicationinitializer" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebInitializer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebApplicationInitializer</span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nd">@Override</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onStartup</span><span class="p">(</span><span class="n">ServletContext</span><span class="w"> </span><span class="n">servletContext</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="abstractannotationconfigdispatcherservletinitializer"><strong>继承 AbstractAnnotationConfigDispatcherServletInitializer</strong><a class="headerlink" href="#abstractannotationconfigdispatcherservletinitializer" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebMvcInitializer</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractAnnotationConfigDispatcherServletInitializer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="_1"><strong>容器启动</strong><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>上述两种方法仅仅是给出了动态配置，而导入该配置的具体位置在 <code>org.springframework.web.SpringServletContainerInitializer#onStartup</code> 方法，<strong>该方法即为 Web容器初始化并启动 的源头</strong>。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nd">@HandlesTypes</span><span class="p">({</span><span class="n">WebApplicationInitializer</span><span class="p">.</span><span class="na">class</span><span class="p">})</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SpringServletContainerInitializer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ServletContainerInitializer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onStartup</span><span class="p">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">webAppInitializerClasses</span><span class="p">,</span><span class="w"> </span><span class="n">ServletContext</span><span class="w"> </span><span class="n">servletContext</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="p">}</span><span class="w">     </span>
</code></pre></div></td></tr></table></div>
<hr />
<h4 id="servletcontainerinitializer"><strong>ServletContainerInitializer</strong><a class="headerlink" href="#servletcontainerinitializer" title="Permanent link">&para;</a></h4>
<p><code>ServletContainerInitializer</code> 是 Servlet 3.0 规范中引入的接口，用于在 Web 应用启动时动态发现和注册 Servlet、Filter 和 Listener。该接口的作用是在 Web 容器启动过程中接收符合特定条件的类集合，并可以基于这些类执行一些自定义的操作。</p>
<p>接口定义如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="cm">/**</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="cm"> * ServletContainerInitializers (SCIs) are registered via an entry in the</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="cm"> * file META-INF/services/javax.servlet.ServletContainerInitializer that must be</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="cm"> * included in the JAR file that contains the SCI implementation.</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="cm"> * &lt;p&gt;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="cm"> * SCI processing is performed regardless of the setting of metadata-complete.</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="cm"> * SCI processing can be controlled per JAR file via fragment ordering. If</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="cm"> * absolute ordering is defined, then only the JARs included in the ordering</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="cm"> * will be processed for SCIs. To disable SCI processing completely, an empty</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="cm"> * absolute ordering may be defined.</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="cm"> * &lt;p&gt;</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="cm"> * SCIs register an interest in annotations (class, method or field) and/or</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="cm"> * types via the {@link javax.servlet.annotation.HandlesTypes} annotation which</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="cm"> * is added to the class.</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="cm"> *</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="cm"> * @since Servlet 3.0</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="cm"> */</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ServletContainerInitializer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="cm">     * Receives notification during startup of a web application of the classes</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="cm">     * within the web application that matched the criteria defined via the</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="cm">     * {@link javax.servlet.annotation.HandlesTypes} annotation.</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="cm">     *</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="cm">     * @param c     The (possibly null) set of classes that met the specified</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="cm">     *              criteria</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="cm">     * @param ctx   The ServletContext of the web application in which the</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="cm">     *              classes were discovered</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="cm">     *</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="cm">     * @throws ServletException If an error occurs</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="cm">     */</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">onStartup</span><span class="p">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">ServletContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">;</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>实现了 <code>ServletContainerInitializer</code> 接口的类必须在一个 JAR 包中的 <code>META-INF/services/javax.servlet.ServletContainerInitialize</code>r 文件中进行注册。该文件的内容应该包含实现类的全限定名，例如：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>org.springframework.web.SpringServletContainerInitializer
</code></pre></div></td></tr></table></div>
<p>这种注册机制利用了 <strong>JDK 的 SPI（Service Provider Interface）机制</strong>，容器启动时会自动加载这个文件，从中读取并加载相应的初始化类。</p>
<hr />
<p>为了让 <code>ServletContainerInitializer</code> 能够接收到符合条件的类，必须使用 <code>@HandlesTypes</code> 注解来标明该类需要处理的类型。</p>
<p><code>@HandlesTypes</code> 注解的 <code>value</code> 属性接收一个类数组，指定哪些类型的类会被注入到 <code>onStartup</code> 方法中。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nd">@HandlesTypes</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="nd">@Target</span><span class="p">({</span><span class="n">ElementType</span><span class="p">.</span><span class="na">TYPE</span><span class="p">})</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="kd">public</span><span class="w"> </span><span class="nd">@interface</span><span class="w"> </span><span class="n">HandlesTypes</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="n">Class</span><span class="o">[]</span><span class="w"> </span><span class="nf">value</span><span class="p">();</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">}</span><span class="w">   </span>
</code></pre></div></td></tr></table></div>
<p>在 Spring 源码中导入的是动态配置类 <code>WebApplicationInitializer</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nd">@HandlesTypes</span><span class="p">(</span><span class="n">WebApplicationInitializer</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>Servlet 3.0+ 容器会自动去扫描 <code>classpath</code> 下所有实现了 <code>WebApplicationInitializer</code> 接口的类，如果没有找到相关类，那么 <code>An INFO-level log message will be issued notifying the user</code>，会有一条INFO级别 的日志。</p>
<p>如果找到了多个实现类，那么都会被实例化，如果实现了<code>org.springframework.core.Ordered</code> 接口或者添加了 <code>@Order</code> 注解，那么就按照顺序来。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nd">@Override</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onStartup</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span><span class="w"> </span><span class="n">webAppInitializerClasses</span><span class="p">,</span><span class="w"> </span><span class="n">ServletContext</span><span class="w"> </span><span class="n">servletContext</span><span class="p">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WebApplicationInitializer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">initializers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">webAppInitializerClasses</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">        </span><span class="n">initializers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">webAppInitializerClasses</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">waiClass</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">webAppInitializerClasses</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">            </span><span class="c1">// Be defensive: Some servlet containers provide us with invalid classes,</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">            </span><span class="c1">// no matter what @HandlesTypes says...</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">waiClass</span><span class="p">.</span><span class="na">isInterface</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">Modifier</span><span class="p">.</span><span class="na">isAbstract</span><span class="p">(</span><span class="n">waiClass</span><span class="p">.</span><span class="na">getModifiers</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">                    </span><span class="n">WebApplicationInitializer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">isAssignableFrom</span><span class="p">(</span><span class="n">waiClass</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">                    </span><span class="n">initializers</span><span class="p">.</span><span class="na">add</span><span class="p">((</span><span class="n">WebApplicationInitializer</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">                            </span><span class="n">ReflectionUtils</span><span class="p">.</span><span class="na">accessibleConstructor</span><span class="p">(</span><span class="n">waiClass</span><span class="p">).</span><span class="na">newInstance</span><span class="p">());</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">                </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServletException</span><span class="p">(</span><span class="s">&quot;Failed to instantiate WebApplicationInitializer class&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">);</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">initializers</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">        </span><span class="n">servletContext</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;No Spring WebApplicationInitializer types detected on classpath&quot;</span><span class="p">);</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">    </span><span class="n">servletContext</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">initializers</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; Spring WebApplicationInitializers detected on classpath&quot;</span><span class="p">);</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">    </span><span class="n">AnnotationAwareOrderComparator</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">initializers</span><span class="p">);</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">WebApplicationInitializer</span><span class="w"> </span><span class="n">initializer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">initializers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">        </span><span class="n">initializer</span><span class="p">.</span><span class="na">onStartup</span><span class="p">(</span><span class="n">servletContext</span><span class="p">);</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="_2">初始化<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Spring MVC 的核心是 DispatcherServlet，初始化也是围绕其展开的。类图如下：</p>
<p><img src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/11/dispatcherservlet.png" style="height:500px; display: block; margin: auto;"></p>
<p>Servlet标准定义了init方法是其生命周期的初始化方法。</p>
<p><code>com.iflove.simplespring.webmvc.HttpServletBean#init</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nd">@Override</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="c1">// 源码里面设置了 ServletConfigPropertyValues</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="c1">// 暂时不做实现</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="c1">// Let subclasses do whatever initialization they like.</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="n">initServletBean</span><span class="p">();</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>主要逻辑一目了然。注意<strong>源码中setPropertyValues方法会导致对DispatcherServlet相关setter方法的调用，所以当进行容器初始化时从init-param中读取的参数已被设置到DispatcherServlet的相关字段(Field)中，项目代码中并未实现</strong>。</p>
<hr />
<h3 id="_3"><strong>容器初始化</strong><a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#initServletBean</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nd">@Override</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initServletBean</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Initializing Spring &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getClass</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getServletName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&#39;&quot;</span><span class="p">);</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Initializing Servlet &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getServletName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&#39;&quot;</span><span class="p">);</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">    </span><span class="c1">// 初始化 Web IOC 容器</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">webApplicationContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initWebApplicationContext</span><span class="p">();</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">    </span><span class="c1">// 默认空实现，且无子类重写</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">    </span><span class="n">initFrameworkServlet</span><span class="p">();</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Completed initialization in &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; ms&quot;</span><span class="p">);</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#initWebApplicationContext</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kd">protected</span><span class="w"> </span><span class="n">WebApplicationContext</span><span class="w"> </span><span class="nf">initWebApplicationContext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="n">WebApplicationContext</span><span class="w"> </span><span class="n">rootContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WebApplicationContextUtils</span><span class="p">.</span><span class="na">getWebApplicationContext</span><span class="p">(</span><span class="n">getServletContext</span><span class="p">());</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="n">WebApplicationContext</span><span class="w"> </span><span class="n">wac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">webApplicationContext</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wac</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ConfigurableWebApplicationContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">        </span><span class="n">ConfigurableWebApplicationContext</span><span class="w"> </span><span class="n">cwac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ConfigurableWebApplicationContext</span><span class="p">)</span><span class="w"> </span><span class="n">wac</span><span class="p">;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cwac</span><span class="p">.</span><span class="na">getParent</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">            </span><span class="n">cwac</span><span class="p">.</span><span class="na">setParent</span><span class="p">(</span><span class="n">rootContext</span><span class="p">);</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">        </span><span class="c1">// 配置上下文并刷新</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">        </span><span class="n">configureAndRefreshWebApplicationContext</span><span class="p">(</span><span class="n">cwac</span><span class="p">);</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wac</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">        </span><span class="c1">// 寻找 IOC 容器</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">        </span><span class="n">wac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findWebApplicationContext</span><span class="p">();</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wac</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">        </span><span class="c1">// 创建新的 IOC 容器</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">        </span><span class="n">wac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createWebApplicationContext</span><span class="p">(</span><span class="n">rootContext</span><span class="p">);</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">    </span><span class="c1">// MVC 初始化 (由 DispatcherServlet 实现)</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">    </span><span class="n">onRefresh</span><span class="p">(</span><span class="n">wac</span><span class="p">);</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">    </span><span class="c1">// 将 WebApplicationContext 实例放入 Servlet 上下文中共享</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">attrName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getServletContextAttributeName</span><span class="p">();</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">    </span><span class="n">getServletContext</span><span class="p">().</span><span class="na">setAttribute</span><span class="p">(</span><span class="n">attrName</span><span class="p">,</span><span class="w"> </span><span class="n">wac</span><span class="p">);</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">wac</span><span class="p">;</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>下面分部分解读</p>
<hr />
<h4 id="_4"><strong>根容器查找</strong><a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>spring-mvc支持Spring容器与MVC容器共存，此时，<strong>Spring容器即根容器，mvc容器将根容器视为父容器</strong>。</p>
<p>根据Servlet规范，各组件的加载 顺序如下:</p>
<p><code>listener -&gt; filter -&gt; servlet</code></p>
<p><code>com.iflove.simplespring.webmvc.context.support.WebApplicationContextUtils#getWebApplicationContext(javax.servlet.ServletContext)</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">String</span><span class="w"> </span><span class="n">ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WebApplicationContext</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.ROOT&quot;</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">WebApplicationContext</span><span class="w"> </span><span class="nf">getWebApplicationContext</span><span class="p">(</span><span class="n">ServletContext</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getWebApplicationContext</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span><span class="w"> </span><span class="n">WebApplicationContext</span><span class="p">.</span><span class="na">ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span class="p">);</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>两参数方法:</p>
<p><code>com.iflove.simplespring.webmvc.context.support.WebApplicationContextUtils#getWebApplicationContext(javax.servlet.ServletContext, java.lang.String)</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">WebApplicationContext</span><span class="w"> </span><span class="nf">getWebApplicationContext</span><span class="p">(</span><span class="n">ServletContext</span><span class="w"> </span><span class="n">sc</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">attrName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="n">Object</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="na">getAttribute</span><span class="p">(</span><span class="n">attrName</span><span class="p">);</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">WebApplicationContext</span><span class="p">)</span><span class="w"> </span><span class="n">attr</span><span class="p">;</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>可以得出结论:</p>
<p><strong>如果Spring根容器存在，那么它被保存在ServletContext中，其key为<code>WebApplicationContext.class.getName() + ".ROOT"</code>。</strong></p>
<hr />
<h4 id="_5"><strong>容器创建</strong><a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#createWebApplicationContext</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span>
<span class="normal"><a href="#__codelineno-13-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">protected</span><span class="w"> </span><span class="n">WebApplicationContext</span><span class="w"> </span><span class="nf">createWebApplicationContext</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="c1">// 创建一个新的 IOC 容器</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="n">ConfigurableWebApplicationContext</span><span class="w"> </span><span class="n">wac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigWebApplicationContext</span><span class="p">();</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="c1">// 设置父容器</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="n">wac</span><span class="p">.</span><span class="na">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="c1">// 配置上下文并刷新</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="n">configureAndRefreshWebApplicationContext</span><span class="p">(</span><span class="n">wac</span><span class="p">);</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">wac</span><span class="p">;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>注意：这里创建新的IOC容器默认为 <code>AnnotationConfigWebApplicationContext</code>，而 Spring 源码中为 <code>XmlWebApplicationContext</code></p>
<p><code>configureAndRefreshWebApplicationContext</code>主要作用即配置servlet上下文并刷新容器</p>
<p>核心源码:</p>
<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#configureAndRefreshWebApplicationContext</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">configureAndRefreshWebApplicationContext</span><span class="p">(</span><span class="n">ConfigurableWebApplicationContext</span><span class="w"> </span><span class="n">wac</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="c1">// 配置 servlet 上下文</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="n">wac</span><span class="p">.</span><span class="na">setServletContext</span><span class="p">(</span><span class="n">getServletContext</span><span class="p">());</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="n">wac</span><span class="p">.</span><span class="na">setServletConfig</span><span class="p">(</span><span class="n">getServletConfig</span><span class="p">());</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="c1">// 刷新容器</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="n">wac</span><span class="p">.</span><span class="na">refresh</span><span class="p">();</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="mvc"><strong>MVC初始化</strong><a class="headerlink" href="#mvc" title="Permanent link">&para;</a></h3>
<p>入口位于<code>DispatcherServlet</code>的<code>initStrategies</code>方法(经由<code>onRefresh</code>调用):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span>
<span class="normal"><a href="#__codelineno-15-45">45</a></span>
<span class="normal"><a href="#__codelineno-15-46">46</a></span>
<span class="normal"><a href="#__codelineno-15-47">47</a></span>
<span class="normal"><a href="#__codelineno-15-48">48</a></span>
<span class="normal"><a href="#__codelineno-15-49">49</a></span>
<span class="normal"><a href="#__codelineno-15-50">50</a></span>
<span class="normal"><a href="#__codelineno-15-51">51</a></span>
<span class="normal"><a href="#__codelineno-15-52">52</a></span>
<span class="normal"><a href="#__codelineno-15-53">53</a></span>
<span class="normal"><a href="#__codelineno-15-54">54</a></span>
<span class="normal"><a href="#__codelineno-15-55">55</a></span>
<span class="normal"><a href="#__codelineno-15-56">56</a></span>
<span class="normal"><a href="#__codelineno-15-57">57</a></span>
<span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span>
<span class="normal"><a href="#__codelineno-15-63">63</a></span>
<span class="normal"><a href="#__codelineno-15-64">64</a></span>
<span class="normal"><a href="#__codelineno-15-65">65</a></span>
<span class="normal"><a href="#__codelineno-15-66">66</a></span>
<span class="normal"><a href="#__codelineno-15-67">67</a></span>
<span class="normal"><a href="#__codelineno-15-68">68</a></span>
<span class="normal"><a href="#__codelineno-15-69">69</a></span>
<span class="normal"><a href="#__codelineno-15-70">70</a></span>
<span class="normal"><a href="#__codelineno-15-71">71</a></span>
<span class="normal"><a href="#__codelineno-15-72">72</a></span>
<span class="normal"><a href="#__codelineno-15-73">73</a></span>
<span class="normal"><a href="#__codelineno-15-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="cm">/**</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="cm"> * mvc 初始化(核心方法)</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="cm"> *</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="cm"> * @param context the current WebApplicationContext</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="cm"> */</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="nd">@Override</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onRefresh</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="n">initStrategies</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="p">}</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initStrategies</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">    </span><span class="c1">// 初始化文件上传解析器（MultipartResolver）</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">    </span><span class="c1">// 用于解析包含文件上传的 multipart 请求。Spring 提供了标准实现，如</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="c1">// CommonsMultipartResolver（基于 Apache Commons FileUpload）和</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">    </span><span class="c1">// StandardServletMultipartResolver（基于 Servlet 3.0 标准）。</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="c1">// 如果需要支持文件上传功能，则必须配置此解析器。</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">    </span><span class="c1">// initMultipartResolver(context);</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">    </span><span class="c1">// 初始化区域解析器（LocaleResolver）</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">    </span><span class="c1">// 用于解析请求的区域信息（Locale），以便在国际化应用中提供正确的语言和格式。</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">    </span><span class="c1">// 常见的实现包括 CookieLocaleResolver 和 SessionLocaleResolver，</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">    </span><span class="c1">// 它们分别基于 Cookie 或 Session 存储和解析区域信息。</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">    </span><span class="c1">// initLocaleResolver(context);</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">    </span><span class="c1">// 初始化主题解析器（ThemeResolver）</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">    </span><span class="c1">// 用于支持 Spring MVC 的主题功能。主题通常用来改变应用程序的视觉外观，比如 CSS 样式。</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">    </span><span class="c1">// 常见实现包括 FixedThemeResolver 和 CookieThemeResolver，</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="w">    </span><span class="c1">// 它们分别支持固定主题和基于 Cookie 的动态主题切换。</span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="w">    </span><span class="c1">// initThemeResolver(context);</span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="w">    </span><span class="c1">// 初始化请求 URL 映射器（HandlerMapping）</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="w">    </span><span class="c1">// 用于将请求 URL 映射到对应的处理器（Handler）。</span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="w">    </span><span class="c1">// Spring MVC 提供了多种 HandlerMapping 实现，如</span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a><span class="w">    </span><span class="c1">// - RequestMappingHandlerMapping：基于 @RequestMapping 注解的映射。</span>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="w">    </span><span class="c1">// - SimpleUrlHandlerMapping：基于 XML 或 Java 配置的静态映射。</span>
<a id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w">    </span><span class="c1">// DispatcherServlet 会从 HandlerMapping 中找到与请求匹配的处理器。</span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="w">    </span><span class="n">initHandlerMappings</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a>
<a id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="w">    </span><span class="c1">// 初始化请求适配器（HandlerAdapter）</span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a><span class="w">    </span><span class="c1">// 用于将请求的处理委派给具体的处理器（Handler）。</span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="w">    </span><span class="c1">// HandlerAdapter 通过多态支持不同类型的处理器，例如：</span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a><span class="w">    </span><span class="c1">// - HttpRequestHandlerAdapter：支持实现 HttpRequestHandler 接口的处理器。</span>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a><span class="w">    </span><span class="c1">// - SimpleControllerHandlerAdapter：支持实现 Controller 接口的处理器。</span>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="w">    </span><span class="c1">// - RequestMappingHandlerAdapter：支持基于 @RequestMapping 的处理器方法。</span>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a><span class="w">    </span><span class="c1">// DispatcherServlet 会根据匹配的处理器选择适当的适配器执行请求。</span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a><span class="w">    </span><span class="n">initHandlerAdapters</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a><span class="w">    </span><span class="c1">// 初始化异常处理器（HandlerExceptionResolver）</span>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a><span class="w">    </span><span class="c1">// 用于捕获和处理请求过程中抛出的异常。</span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="w">    </span><span class="c1">// Spring MVC 提供默认实现，如：</span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a><span class="w">    </span><span class="c1">// - ExceptionHandlerExceptionResolver：支持 @ExceptionHandler 注解。</span>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a><span class="w">    </span><span class="c1">// - ResponseStatusExceptionResolver：支持 @ResponseStatus 注解。</span>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a><span class="w">    </span><span class="c1">// - DefaultHandlerExceptionResolver：处理 Spring 内部标准异常。</span>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a><span class="w">    </span><span class="c1">// 如果没有匹配的异常处理器，异常将被容器默认的错误页面处理。</span>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a><span class="w">    </span><span class="c1">// initHandlerExceptionResolvers(context);</span>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a><span class="w">    </span><span class="c1">// 初始化请求到视图名称的转换器（RequestToViewNameTranslator）</span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a><span class="w">    </span><span class="c1">// 用于在没有显式指定视图名称的情况下，从请求路径推断视图名称。</span>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="w">    </span><span class="c1">// 默认实现是 DefaultRequestToViewNameTranslator，它会从 URL 中提取路径作为视图名称。</span>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="w">    </span><span class="c1">// 例如：请求 `/user/profile` 会解析为视图名称 `user/profile`。</span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="w">    </span><span class="c1">// initRequestToViewNameTranslator(context);</span>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a>
<a id="__codelineno-15-63" name="__codelineno-15-63"></a><span class="w">    </span><span class="c1">// 初始化视图解析器（ViewResolver）</span>
<a id="__codelineno-15-64" name="__codelineno-15-64"></a><span class="w">    </span><span class="c1">// 用于将视图名称解析为具体的视图对象（View），比如 JSP、Thymeleaf 或 Freemarker。</span>
<a id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="w">    </span><span class="c1">// 常见的实现包括：InternalResourceViewResolver、ThymeleafViewResolver。</span>
<a id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="w">    </span><span class="c1">// DispatcherServlet 根据解析后的视图对象渲染响应。</span>
<a id="__codelineno-15-67" name="__codelineno-15-67"></a><span class="w">    </span><span class="c1">// initViewResolvers(context);</span>
<a id="__codelineno-15-68" name="__codelineno-15-68"></a>
<a id="__codelineno-15-69" name="__codelineno-15-69"></a><span class="w">    </span><span class="c1">// 初始化 Flash 属性管理器（FlashMapManager）</span>
<a id="__codelineno-15-70" name="__codelineno-15-70"></a><span class="w">    </span><span class="c1">// 用于在请求重定向时，存储和传递临时属性（Flash 属性）。</span>
<a id="__codelineno-15-71" name="__codelineno-15-71"></a><span class="w">    </span><span class="c1">// Spring 提供默认实现：DefaultFlashMapManager，基于 Session 存储 Flash 属性。</span>
<a id="__codelineno-15-72" name="__codelineno-15-72"></a><span class="w">    </span><span class="c1">// Flash 属性通常用于传递一次性的用户反馈消息，例如表单提交后的成功提示。</span>
<a id="__codelineno-15-73" name="__codelineno-15-73"></a><span class="w">    </span><span class="c1">// initFlashMapManager(context);</span>
<a id="__codelineno-15-74" name="__codelineno-15-74"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>源码中 MVC初始化 存在多个init方法，为了简化代码，仅给出2个核心实现</p>
<p>显然，这里就是spring-mvc的核心了。</p>
<hr />
<h4 id="handlermapping"><strong>HandlerMapping检查</strong><a class="headerlink" href="#handlermapping" title="Permanent link">&para;</a></h4>
<p>initHandlerMappings方法用于确保容器中<strong>至少含有一个HandlerMapping对象</strong>。</p>
<p>如果没有开启注解驱动，那么将会使用默认的<code>HandlerMapping</code>，相关代码:</p>
<p><code>com.iflove.simplespring.webmvc.DispatcherServlet#initHandlerMappings</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initHandlerMappings</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="c1">//从容器中拿</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">HandlerMapping</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanFactoryUtils</span><span class="p">.</span><span class="na">beansOfTypeIncludingAncestors</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">HandlerMapping</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ObjectUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">map</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">handlerMappings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">map</span><span class="p">.</span><span class="na">values</span><span class="p">());</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">        </span><span class="c1">//没有则从默认配置文件中拿</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">handlerMappings</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">getDefaultStrategies</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">HandlerMapping</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">handlerMappings</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">Comparator</span><span class="p">.</span><span class="na">comparingInt</span><span class="p">(</span><span class="n">Ordered</span><span class="p">::</span><span class="n">getOrder</span><span class="p">));</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>默认的策略由<code>DispatcherServlet.properties</code>决定，<strong>在 Spring 源码中是<code>BeanNameUrlHandlerMapping</code>、<code>RequestMappingHandlerMapping</code>、<code>RouterFunctionMapping</code>，而 Simple-Spring 中为<code>RequestMappingHandlerMapping</code></strong>。</p>
<p><code>DispatcherServlet.properties</code>具体配置如下：</p>
<p><code>src/main/resources/com/iflove/simplespring/webmvc/DispatcherServlet.properties</code></p>
<p>注意：<code>DispatcherServlet.properties</code>如果放在<code>resources</code> 需要与 <code>DispatcherServlet.java</code> 的路径一致</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a>com.iflove.simplespring.webmvc.HandlerMapping=com.iflove.simplespring.webmvc.handler.RequestMappingHandlerMapping
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>com.iflove.simplespring.webmvc.HandlerAdapter=com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter
</code></pre></div></td></tr></table></div>
<p>继续跟踪 <code>getDefaultStrategies(...)</code> 方法代码：</p>
<ol>
<li>首先根据已定义的 <code>DEFAULT_STRATEGIES_PATH</code>，获得指定默认策略配置文件的路径</li>
<li>加载配置文件，并获得对应的策略类名</li>
<li>通过 Spring 上下文创建并初始化策略类</li>
</ol>
<p><code>com.iflove.simplespring.webmvc.DispatcherServlet#getDefaultStrategies</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span>
<span class="normal"><a href="#__codelineno-18-42">42</a></span>
<span class="normal"><a href="#__codelineno-18-43">43</a></span>
<span class="normal"><a href="#__codelineno-18-44">44</a></span>
<span class="normal"><a href="#__codelineno-18-45">45</a></span>
<span class="normal"><a href="#__codelineno-18-46">46</a></span>
<span class="normal"><a href="#__codelineno-18-47">47</a></span>
<span class="normal"><a href="#__codelineno-18-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="cm">/**</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="cm"> * 与 DispatcherServlet 类相关的类路径资源的名称，用于定义 DispatcherServlet 的默认策略名称</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="cm"> * 注意：路径应保持一致</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="cm"> */</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_STRATEGIES_PATH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;DispatcherServlet.properties&quot;</span><span class="p">;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="kd">protected</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getDefaultStrategies</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategyInterface</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">defaultStrategies</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">            </span><span class="c1">// Load default strategy implementations from properties file.</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">            </span><span class="c1">// This is currently strictly internal and not meant to be customized</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">            </span><span class="c1">// by application developers.</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">            </span><span class="n">ClassPathResource</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ClassPathResource</span><span class="p">(</span><span class="n">DEFAULT_STRATEGIES_PATH</span><span class="p">,</span><span class="w"> </span><span class="n">DispatcherServlet</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">            </span><span class="n">defaultStrategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertiesLoaderUtils</span><span class="p">.</span><span class="na">loadProperties</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Could not load &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DEFAULT_STRATEGIES_PATH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&#39;: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strategyInterface</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultStrategies</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">classNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtils</span><span class="p">.</span><span class="na">commaDelimitedListToStringArray</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strategies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">classNames</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">className</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">classNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="w">                </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassUtils</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="n">className</span><span class="p">,</span><span class="w"> </span><span class="n">DispatcherServlet</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getClassLoader</span><span class="p">());</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="w">                </span><span class="n">Object</span><span class="w"> </span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDefaultStrategy</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a><span class="w">                </span><span class="n">strategies</span><span class="p">.</span><span class="na">add</span><span class="p">((</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="n">strategy</span><span class="p">);</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BeanInitializationException</span><span class="p">(</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a><span class="w">                        </span><span class="s">&quot;Could not find DispatcherServlet&#39;s default strategy class [&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">className</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a><span class="w">                                </span><span class="s">&quot;] for interface [&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">);</span>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">LinkageError</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BeanInitializationException</span><span class="p">(</span>
<a id="__codelineno-18-36" name="__codelineno-18-36"></a><span class="w">                        </span><span class="s">&quot;Unresolvable class definition for DispatcherServlet&#39;s default strategy class [&quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-18-37" name="__codelineno-18-37"></a><span class="w">                                </span><span class="n">className</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] for interface [&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-18-38" name="__codelineno-18-38"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-18-39" name="__codelineno-18-39"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-40" name="__codelineno-18-40"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">strategies</span><span class="p">;</span>
<a id="__codelineno-18-41" name="__codelineno-18-41"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-42" name="__codelineno-18-42"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span>
<a id="__codelineno-18-43" name="__codelineno-18-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-44" name="__codelineno-18-44"></a><span class="p">}</span>
<a id="__codelineno-18-45" name="__codelineno-18-45"></a>
<a id="__codelineno-18-46" name="__codelineno-18-46"></a><span class="kd">protected</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">createDefaultStrategy</span><span class="p">(</span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-47" name="__codelineno-18-47"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getAutowireCapableBeanFactory</span><span class="p">().</span><span class="na">createBean</span><span class="p">(</span><span class="n">clazz</span><span class="p">);</span>
<a id="__codelineno-18-48" name="__codelineno-18-48"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h4 id="handleradapter"><strong>HandlerAdapter检查</strong><a class="headerlink" href="#handleradapter" title="Permanent link">&para;</a></h4>
<p>套路和上面完全一样，<strong>Spring默认使用<code>HttpRequestHandlerAdapter</code>、<code>SimpleControllerHandlerAdapter</code>、<code>RequestMappingHandlerAdapter</code>、<code>HandlerFunctionAdapter</code>，Simple-Spring中使用<code>RequestMappingHandlerMethodAdapter</code></strong>。</p>
<p>btw, Spring的<code>DispatcherServlet.properties</code>在<code>org/springframework/web/servlet/DispatcherServlet.properties</code></p>
<hr />
<h3 id="handlermapping_1"><strong>HandlerMapping初始化</strong><a class="headerlink" href="#handlermapping_1" title="Permanent link">&para;</a></h3>
<p>此接口用以根据请求的URL寻找合适的处理器，下面以<code>RequestMappingHandlerMapping</code>位代表进行说明。</p>
<h4 id="requestmappinghandlermapping"><strong>RequestMappingHandlerMapping</strong><a class="headerlink" href="#requestmappinghandlermapping" title="Permanent link">&para;</a></h4>
<p>此实现根据<code>@Controller</code>和<code>@RequestMapping</code>注解完成解析。类图(忽略部分接口):</p>
<p><img alt="HandlerMapping" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/19/handlermapping.png" /></p>
<p>初始化的入口位于<code>AbstractHandlerMapping</code>的<code>afterPropertiesSet</code>方法和<code>initApplicationContext</code>方法，<code>afterPropertiesSet</code>调用了<code>initHandlerMethods</code>:</p>
<p><code>com.iflove.simplespring.webmvc.handler.AbstractHandlerMapping#afterPropertiesSet</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nd">@Override</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterPropertiesSet</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="n">initHandlerMethod</span><span class="p">();</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>com.iflove.simplespring.webmvc.handler.AbstractHandlerMapping#initHandlerMethod</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="cm">/**</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="cm"> * 初始化处理器方法</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="cm"> */</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initHandlerMethod</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">    </span><span class="c1">// from Yusiheng</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="c1">//获取所有bean</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obtainApplicationContext</span><span class="p">();</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">    </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanFactoryUtils</span><span class="p">.</span><span class="na">beanNamesForTypeIncludingAncestors</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">names</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">        </span><span class="c1">//拿到当前class</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">        </span><span class="n">Class</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">            </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getType</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">        </span><span class="c1">//判断是否是一个handler -&gt; 交给子类</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isHandler</span><span class="p">(</span><span class="n">type</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="w">            </span><span class="c1">//找到bean当中的HandlerMethod -&gt; 交给子类</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">            </span><span class="n">detectHandlerMethod</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>detectHandlerMethods</code>方法将反射遍历类中所有的<code>public</code>方法，如果方法上含有<code>@RequestMapping</code>注解，那么将方法上的路径与类上的基础路径(如果有)进行合并，之后将映射(匹配关系)注册到<code>MappingRegistry</code>中。</p>
<p>注意，<strong>类上的@RequestMapping注解只能作为基路径存在，也就是说，如果类里面没有任何的方法级@RequestMapping注解，那么类上的注解是没有意义的</strong>。这一点可以从实验和源码上得到证实。</p>
<p>下面我们关注一下 Spring 源码中映射关系是如何保存(注册)的。</p>
<p>内部类<code>AbstractHandlerMethodMapping.MappingRegistry</code>是映射的载体，类图:</p>
<p><img alt="MappingRegistry" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/19/mappingregistry.png" /></p>
<p>其register方法简略版源码:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">mapping</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="c1">//包装bean和方法</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handlerMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createHandlerMethod</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">);</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">mappingLookup</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">);</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">directUrls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getDirectUrls</span><span class="p">(</span><span class="n">mapping</span><span class="p">);</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">directUrls</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">urlLookup</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="p">);</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getNamingStrategy</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getNamingStrategy</span><span class="p">().</span><span class="na">getName</span><span class="p">(</span><span class="n">handlerMethod</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="p">);</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">        </span><span class="n">addMappingName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">);</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">    </span><span class="n">CorsConfiguration</span><span class="w"> </span><span class="n">corsConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initCorsConfiguration</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="p">);</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">corsConfig</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">corsLookup</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">handlerMethod</span><span class="p">,</span><span class="w"> </span><span class="n">corsConfig</span><span class="p">);</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">registry</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MappingRegistration</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">,</span><span class="w"> </span><span class="n">directUrls</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">));</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>mapping</code>其实是一个<code>RequestMappingInfo</code>对象，可以将其看做是 <strong>@RequestMapping注解各种属性的一个封装</strong>。最终由<code>RequestMappingInfo.createRequestMappingInfo</code>方法创建，源码:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">protected</span><span class="w"> </span><span class="n">RequestMappingInfo</span><span class="w"> </span><span class="nf">createRequestMappingInfo</span><span class="p">(</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">        </span><span class="n">RequestMapping</span><span class="w"> </span><span class="n">requestMapping</span><span class="p">,</span><span class="w"> </span><span class="n">RequestCondition</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">customCondition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">RequestMappingInfo</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">            </span><span class="p">.</span><span class="na">paths</span><span class="p">(</span><span class="n">resolveEmbeddedValuesInPatterns</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">path</span><span class="p">()))</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">            </span><span class="p">.</span><span class="na">methods</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">method</span><span class="p">())</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">            </span><span class="p">.</span><span class="na">params</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">params</span><span class="p">())</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">            </span><span class="p">.</span><span class="na">headers</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">headers</span><span class="p">())</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">            </span><span class="p">.</span><span class="na">consumes</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">consumes</span><span class="p">())</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">            </span><span class="p">.</span><span class="na">produces</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">produces</span><span class="p">())</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">            </span><span class="p">.</span><span class="na">mappingName</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">name</span><span class="p">())</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">            </span><span class="p">.</span><span class="na">customCondition</span><span class="p">(</span><span class="n">customCondition</span><span class="p">)</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">            </span><span class="p">.</span><span class="na">options</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">config</span><span class="p">)</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>这就很明显了，具体每种属性什么意义可以参考<code>@RequestMapping</code>源码。</p>
<p><code>register</code>方法中<code>urlLookup</code>其实就是将<code>paths</code>属性中的每个<code>path</code>都与处理器做映射。</p>
<p><code>getNamingStrategy</code>方法得到的是一个<code>HandlerMethodMappingNamingStrategy</code>接口的实例，此接口用以根据<code>HandlerMethod</code>得到一个名字，类图:</p>
<p><img alt="HandlerMethodMappingNamingStrategy" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/19/handlermethodmappingnamingstrategy.png" /></p>
<p>比如对于我们的控制器, <code>SimpleController.echo</code>方法，最终得到的名字将是<code>SC#echo</code>。</p>
<p><br></p>
<p>以上是对Spring源码中如何保存(注册)映射关系的解读，而在<code>Simple-Spring</code>中实现的方法非常简单。</p>
<p>首先是 <code>detectHandlerMethod</code> 方法，类似于 Spring 源码的实现，不过多赘述</p>
<p><code>com.iflove.simplespring.webmvc.handler.RequestMappingHandlerMapping#detectHandlerMethod</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nd">@Override</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">detectHandlerMethod</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="c1">// from Yusiheng</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="c1">// 获取当前类</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obtainApplicationContext</span><span class="p">();</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getType</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">    </span><span class="c1">// 获取当前类下的所有方法</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Method</span><span class="o">[]</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="na">getDeclaredMethods</span><span class="p">();</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethod</span><span class="o">&gt;</span><span class="w"> </span><span class="n">handlerMethods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="c1">// 获得类上的路径</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AnnotatedElementUtils</span><span class="p">.</span><span class="na">hasAnnotation</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMapping</span><span class="p">.</span><span class="na">class</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">RequestMapping</span><span class="w"> </span><span class="n">requestMapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AnnotatedElementUtils</span><span class="p">.</span><span class="na">findMergedAnnotation</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMapping</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestMapping</span><span class="p">.</span><span class="na">value</span><span class="p">();</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">        </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">methods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">        </span><span class="c1">// 获取方法上是否存在RequestMapping注解</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AnnotatedElementUtils</span><span class="p">.</span><span class="na">hasAnnotation</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMapping</span><span class="p">.</span><span class="na">class</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="w">            </span><span class="c1">// 收集</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handlerMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HandlerMethod</span><span class="p">(</span><span class="n">bean</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">);</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><span class="w">            </span><span class="c1">// 获得方法上的路径</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a><span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">RequestMapping</span><span class="w"> </span><span class="n">requestMapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AnnotatedElementUtils</span><span class="p">.</span><span class="na">findMergedAnnotation</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">RequestMapping</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a><span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestMapping</span><span class="p">.</span><span class="na">value</span><span class="p">();</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">childPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="w">            </span><span class="n">handlerMethod</span><span class="p">.</span><span class="na">setRequestMethods</span><span class="p">(</span><span class="n">requestMapping</span><span class="p">.</span><span class="na">requestMethod</span><span class="p">());</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a><span class="w">            </span><span class="c1">// 拼接路径</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a><span class="w">            </span><span class="n">handlerMethod</span><span class="p">.</span><span class="na">setPath</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">childPath</span><span class="p">);</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a><span class="w">            </span><span class="n">handlerMethods</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">handlerMethod</span><span class="p">);</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a><span class="w">    </span><span class="c1">// 注册HandlerMethod</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ObjectUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">handlerMethods</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handlerMethod</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">handlerMethods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a><span class="w">            </span><span class="n">register</span><span class="p">(</span><span class="n">handlerMethod</span><span class="p">);</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>重点在于 <code>register</code> 方法，对于路径映射的注册，通过 <code>HashMap</code> 做简单实现，它的键是请求路径（String 类型），值是一个 <code>Set&lt;HandlerMethod&gt;</code>，表示在该路径下可能匹配的多个 <code>HandlerMethod</code>（处理方法）</p>
<p>如果路径包含 <code>{}</code>，即带有路径参数的占位符，例如 <code>/user/{id}</code>，则将 <code>{}</code> 中的内容替换成正则表达式 <code>(\w+)</code>，以支持路径参数的匹配。</p>
<ul>
<li>替换后的路径会用于后续的路径匹配。</li>
<li>如果路径没有路径参数，直接注册该路径和对应的 HandlerMethod。</li>
</ul>
<p><code>com.iflove.simplespring.webmvc.handler.AbstractHandlerMapping#register(com.iflove.simplespring.webmvc.handler.HandlerMethod)</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1">// 路径映射表，每个路径对应多个 HandlerMethod</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">HandlerMethod</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">mappingRegistry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="c1">// 获取请求路径</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">.</span><span class="na">getPath</span><span class="p">();</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;{&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;}&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">        </span><span class="c1">// 路径替换</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">        </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\\{\\w+}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;(\\\\w+)&quot;</span><span class="p">);</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">        </span><span class="c1">// 存在，可能请求类型一样</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">        </span><span class="n">register</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">);</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">        </span><span class="c1">// 根据请求路径的不同分别保存HandlerMethod</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">        </span><span class="n">register</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">);</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="p">}</span>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handlerMethod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="w">    </span><span class="c1">// 注册处理器</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="w">    </span><span class="n">mappingRegistry</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">()).</span><span class="na">add</span><span class="p">(</span><span class="n">handlerMethod</span><span class="p">);</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="handleradapter_1"><strong>HandlerAdapter初始化</strong><a class="headerlink" href="#handleradapter_1" title="Permanent link">&para;</a></h3>
<p>同样，以RequestMappingHandlerAdapter为例进行说明，类图:</p>
<p><img alt="RequestMappingHandlerMethodAdapter" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/19/requestmappinghandlermethodadapter.png" /></p>
<p>显然，入口在实现了<code>InitializingBean</code>的<code>afterPropertiesSet</code>方法:</p>
<p><code>com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter#afterPropertiesSet</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span>
<span class="normal"><a href="#__codelineno-25-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="cm">/**</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="cm"> * 初始化基础组件</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="cm"> */</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="nd">@Override</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterPropertiesSet</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">    </span><span class="n">resolverComposite</span><span class="p">.</span><span class="na">addResolvers</span><span class="p">(</span><span class="n">getDefaultArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">    </span><span class="n">returnValueHandlerComposite</span><span class="p">.</span><span class="na">addMethodReturnValueHandlers</span><span class="p">(</span><span class="n">getDefaultMethodReturnValueHandler</span><span class="p">());</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h4 id="_6"><strong>参数解析器</strong><a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>参数解析器，负责从request中解析、得到Controller方法所需的参数。</p>
<p><img alt="diagram" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/19/diagram1.png" /></p>
<p><code>com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter#getDefaultArgumentResolver</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="cm">/**</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="cm"> * 初始化参数解析器</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="cm"> */</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getDefaultArgumentResolver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resolvers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PathVariableMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PathVariableMapMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RequestCookieMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RequestHeaderMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RequestHeaderMapMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RequestPartMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RequestParamMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RequestParamMapMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RequestRequestBodyMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ServletRequestMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">    </span><span class="n">resolvers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ServletResponseMethodArgumentResolver</span><span class="p">());</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">resolvers</span><span class="p">;</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h4 id="_7"><strong>返回结果解析器</strong><a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p><code>HandlerMethodReturnValueHandler</code>接口用以处理方法调用(Controller方法)的返回值，类图:</p>
<p><img alt="HandlerMethodReturnValueHandler" src="https://initchu.oss-cn-hangzhou.aliyuncs.com/2025/01/19/handlermethodreturnvaluehandler.png" /></p>
<h2 id="_8">请求执行流程<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="1-service"><strong>1. Service</strong><a class="headerlink" href="#1-service" title="Permanent link">&para;</a></h3>
<p>首先请求进入到 <code>FrameworkServlet</code> 重写的 <code>Service</code> 方法中，此处有一个判断逻辑</p>
<ul>
<li>如果请求类型为 <code>GET, POST, DELETE, PUT</code> 等常见 <code>Http</code> 方法，走 <code>super.service</code> 处理</li>
<li>否则走自定义 <code>processRequest</code> 方法</li>
</ul>
<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#service</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="cm">/**</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="cm"> * 拦截请求，根据请求类型判断去向</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="cm"> * @param request Http 请求</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="cm"> * @param response Http 响应</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="cm"> * @throws ServletException ServletException</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="cm"> * @throws IOException IOException</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="cm"> */</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="nd">@Override</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">service</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">    </span><span class="c1">// 如果请求类型为 GET, POST, DELETE, PUT 等常见 Http 方法，走 super.service 处理 </span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HTTP_SERVLET_METHODS</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getMethod</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">service</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="w">        </span><span class="n">processRequest</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<a id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>而进入到 <code>super.service</code> 方法中的请求最终同样回到自定义的 <code>processRequest</code> 方法中，接下来通过源码对此进行解释</p>
<p><code>javax.servlet.http.HttpServlet#service(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span>
<span class="normal"><a href="#__codelineno-28-25">25</a></span>
<span class="normal"><a href="#__codelineno-28-26">26</a></span>
<span class="normal"><a href="#__codelineno-28-27">27</a></span>
<span class="normal"><a href="#__codelineno-28-28">28</a></span>
<span class="normal"><a href="#__codelineno-28-29">29</a></span>
<span class="normal"><a href="#__codelineno-28-30">30</a></span>
<span class="normal"><a href="#__codelineno-28-31">31</a></span>
<span class="normal"><a href="#__codelineno-28-32">32</a></span>
<span class="normal"><a href="#__codelineno-28-33">33</a></span>
<span class="normal"><a href="#__codelineno-28-34">34</a></span>
<span class="normal"><a href="#__codelineno-28-35">35</a></span>
<span class="normal"><a href="#__codelineno-28-36">36</a></span>
<span class="normal"><a href="#__codelineno-28-37">37</a></span>
<span class="normal"><a href="#__codelineno-28-38">38</a></span>
<span class="normal"><a href="#__codelineno-28-39">39</a></span>
<span class="normal"><a href="#__codelineno-28-40">40</a></span>
<span class="normal"><a href="#__codelineno-28-41">41</a></span>
<span class="normal"><a href="#__codelineno-28-42">42</a></span>
<span class="normal"><a href="#__codelineno-28-43">43</a></span>
<span class="normal"><a href="#__codelineno-28-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">service</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getMethod</span><span class="p">();</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">lastModified</span><span class="p">;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">        </span><span class="n">lastModified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getLastModified</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastModified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1L</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">doGet</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">ifModifiedSince</span><span class="p">;</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">                </span><span class="n">ifModifiedSince</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getDateHeader</span><span class="p">(</span><span class="s">&quot;If-Modified-Since&quot;</span><span class="p">);</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="w"> </span><span class="n">var9</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">                </span><span class="n">ifModifiedSince</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1L</span><span class="p">;</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ifModifiedSince</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lastModified</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000L</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000L</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">maybeSetLastModified</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">lastModified</span><span class="p">);</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">doGet</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="w">                </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="mi">304</span><span class="p">);</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;HEAD&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a><span class="w">        </span><span class="n">lastModified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getLastModified</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">maybeSetLastModified</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">lastModified</span><span class="p">);</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">doHead</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-27" name="__codelineno-28-27"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-28" name="__codelineno-28-28"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">doPost</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-29" name="__codelineno-28-29"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;PUT&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-30" name="__codelineno-28-30"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">doPut</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-31" name="__codelineno-28-31"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;DELETE&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-32" name="__codelineno-28-32"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">doDelete</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-33" name="__codelineno-28-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;OPTIONS&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-34" name="__codelineno-28-34"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">doOptions</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-35" name="__codelineno-28-35"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;TRACE&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-36" name="__codelineno-28-36"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">doTrace</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-28-37" name="__codelineno-28-37"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-38" name="__codelineno-28-38"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">errMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lStrings</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;http.method_not_implemented&quot;</span><span class="p">);</span>
<a id="__codelineno-28-39" name="__codelineno-28-39"></a><span class="w">        </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">errArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">method</span><span class="p">};</span>
<a id="__codelineno-28-40" name="__codelineno-28-40"></a><span class="w">        </span><span class="n">errMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageFormat</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">errMsg</span><span class="p">,</span><span class="w"> </span><span class="n">errArgs</span><span class="p">);</span>
<a id="__codelineno-28-41" name="__codelineno-28-41"></a><span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">sendError</span><span class="p">(</span><span class="mi">501</span><span class="p">,</span><span class="w"> </span><span class="n">errMsg</span><span class="p">);</span>
<a id="__codelineno-28-42" name="__codelineno-28-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-43" name="__codelineno-28-43"></a>
<a id="__codelineno-28-44" name="__codelineno-28-44"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>可以看到在 <code>super.service</code> 方法中根据请求类型进入到各自的 <code>do**</code> 方法中，而 请求的 <code>do**</code> 方法又被 <code>FrameworkServlet</code> 重写, 且方法体均为 <code>processRequest(request, response);</code>，已 <code>doGet</code> 方法为例</p>
<p>PS: 源码重写的 <code>doOptions</code> 和 <code>doTrace</code> 有些不一样的内容，但不常用，故不做实现</p>
<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#doGet</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="cm">/**</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="cm"> * Delegate GET requests to processRequest/doService.</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="cm"> * &lt;p&gt;Will also be invoked by HttpServlet&#39;s default implementation of {@code doHead},</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="cm"> * with a {@code NoBodyResponse} that just captures the content length.</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="cm"> * @see #doHead</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="cm"> */</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="nd">@Override</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="kd">protected</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="n">processRequest</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="2-processrequest"><strong>2. processRequest</strong><a class="headerlink" href="#2-processrequest" title="Permanent link">&para;</a></h3>
<p><code>processRequest</code> 是 <code>FrameworkServlet</code> 中的核心方法，<strong>用于接收并初始化 HTTP 请求处理的上下文环境</strong>。</p>
<p>主要做了以下操作：</p>
<ol>
<li>记录开始时间</li>
<li>设置请求上下文<ul>
<li>使用 <code>LocaleContextHolder</code> 和 <code>RequestContextHolder</code> 设置本地化上下文和请求上下文</li>
<li>通过 <code>buildLocaleContext</code> 和 <code>buildRequestAttributes</code> 方法为当前线程创建 <code>LocaleContext</code> 和 <code>ServletRequestAttributes</code></li>
</ul>
</li>
<li>初始化异步管理器</li>
<li>调用 <code>doService</code> 方法</li>
<li>异常处理</li>
<li>清理上下文</li>
<li>日志记录和事件发布</li>
</ol>
<p><code>com.iflove.simplespring.webmvc.FrameworkServlet#processRequest</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span>
<span class="normal"><a href="#__codelineno-30-23">23</a></span>
<span class="normal"><a href="#__codelineno-30-24">24</a></span>
<span class="normal"><a href="#__codelineno-30-25">25</a></span>
<span class="normal"><a href="#__codelineno-30-26">26</a></span>
<span class="normal"><a href="#__codelineno-30-27">27</a></span>
<span class="normal"><a href="#__codelineno-30-28">28</a></span>
<span class="normal"><a href="#__codelineno-30-29">29</a></span>
<span class="normal"><a href="#__codelineno-30-30">30</a></span>
<span class="normal"><a href="#__codelineno-30-31">31</a></span>
<span class="normal"><a href="#__codelineno-30-32">32</a></span>
<span class="normal"><a href="#__codelineno-30-33">33</a></span>
<span class="normal"><a href="#__codelineno-30-34">34</a></span>
<span class="normal"><a href="#__codelineno-30-35">35</a></span>
<span class="normal"><a href="#__codelineno-30-36">36</a></span>
<span class="normal"><a href="#__codelineno-30-37">37</a></span>
<span class="normal"><a href="#__codelineno-30-38">38</a></span>
<span class="normal"><a href="#__codelineno-30-39">39</a></span>
<span class="normal"><a href="#__codelineno-30-40">40</a></span>
<span class="normal"><a href="#__codelineno-30-41">41</a></span>
<span class="normal"><a href="#__codelineno-30-42">42</a></span>
<span class="normal"><a href="#__codelineno-30-43">43</a></span>
<span class="normal"><a href="#__codelineno-30-44">44</a></span>
<span class="normal"><a href="#__codelineno-30-45">45</a></span>
<span class="normal"><a href="#__codelineno-30-46">46</a></span>
<span class="normal"><a href="#__codelineno-30-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="cm">/**</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="cm"> * 处理 Http 请求</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="cm"> * @param request Http 请求</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="cm"> * @param response Http 响应</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="cm"> */</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="kd">protected</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">processRequest</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">    </span><span class="c1">// 记录开始时间，设置请求上下文，初始化异步管理器</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="w">    </span><span class="cm">/*</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="cm">    long startTime = System.currentTimeMillis();</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="cm">    Throwable failureCause = null;</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="cm">    LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();</span>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a><span class="cm">    LocaleContext localeContext = buildLocaleContext(request);</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="cm">    RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();</span>
<a id="__codelineno-30-18" name="__codelineno-30-18"></a><span class="cm">    ServletRequestAttributes requestAttributes = buildRequestAttributes(request, response, previousAttributes);</span>
<a id="__codelineno-30-19" name="__codelineno-30-19"></a>
<a id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="cm">    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span>
<a id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="cm">    asyncManager.registerCallableInterceptor(org.springframework.web.servlet.FrameworkServlet.class.getName(), new org.springframework.web.servlet.FrameworkServlet.RequestBindingInterceptor());</span>
<a id="__codelineno-30-22" name="__codelineno-30-22"></a>
<a id="__codelineno-30-23" name="__codelineno-30-23"></a><span class="cm">    initContextHolders(request, localeContext, requestAttributes);</span>
<a id="__codelineno-30-24" name="__codelineno-30-24"></a><span class="cm">    */</span>
<a id="__codelineno-30-25" name="__codelineno-30-25"></a>
<a id="__codelineno-30-26" name="__codelineno-30-26"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-27" name="__codelineno-30-27"></a><span class="w">        </span><span class="n">doService</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<a id="__codelineno-30-28" name="__codelineno-30-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-29" name="__codelineno-30-29"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ServletException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-30" name="__codelineno-30-30"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">ex</span><span class="p">;</span>
<a id="__codelineno-30-31" name="__codelineno-30-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-32" name="__codelineno-30-32"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-33" name="__codelineno-30-33"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServletException</span><span class="p">(</span><span class="s">&quot;Request processing failed: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">);</span>
<a id="__codelineno-30-34" name="__codelineno-30-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-35" name="__codelineno-30-35"></a>
<a id="__codelineno-30-36" name="__codelineno-30-36"></a><span class="w">    </span><span class="c1">// 清理上下文，日志记录和事件发布 </span>
<a id="__codelineno-30-37" name="__codelineno-30-37"></a><span class="w">    </span><span class="cm">/*</span>
<a id="__codelineno-30-38" name="__codelineno-30-38"></a><span class="cm">    finally {</span>
<a id="__codelineno-30-39" name="__codelineno-30-39"></a><span class="cm">        resetContextHolders(request, previousLocaleContext, previousAttributes);</span>
<a id="__codelineno-30-40" name="__codelineno-30-40"></a><span class="cm">        if (requestAttributes != null) {</span>
<a id="__codelineno-30-41" name="__codelineno-30-41"></a><span class="cm">            requestAttributes.requestCompleted();</span>
<a id="__codelineno-30-42" name="__codelineno-30-42"></a><span class="cm">        }</span>
<a id="__codelineno-30-43" name="__codelineno-30-43"></a><span class="cm">        logResult(request, response, failureCause, asyncManager);</span>
<a id="__codelineno-30-44" name="__codelineno-30-44"></a><span class="cm">        publishRequestHandledEvent(request, response, startTime, failureCause);</span>
<a id="__codelineno-30-45" name="__codelineno-30-45"></a><span class="cm">    }</span>
<a id="__codelineno-30-46" name="__codelineno-30-46"></a><span class="cm">    */</span>
<a id="__codelineno-30-47" name="__codelineno-30-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="3-doservice"><strong>3. doService</strong><a class="headerlink" href="#3-doservice" title="Permanent link">&para;</a></h3>
<p><code>doService</code> 是 <code>processRequest</code> 的子流程，用于封装更多的细节逻辑，<strong>包括为请求分发创建上下文环境，并调用核心分发方法 <code>doDispatch</code></strong>。</p>
<p>主要做了以下操作：</p>
<ol>
<li>日志记录</li>
<li>请求包含支持</li>
<li>添加框架级对象<ul>
<li>将 Web 应用上下文、语言环境解析器（LocaleResolver）、主题解析器等对象添加到请求中，供后续处理使用。</li>
</ul>
</li>
<li>解析闪存消息</li>
<li>路径解析</li>
<li>调用 <code>doDispatch</code>，进行核心的请求分发逻辑</li>
</ol>
<p><code>com.iflove.simplespring.webmvc.DispatcherServlet#doService</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span>
<span class="normal"><a href="#__codelineno-31-32">32</a></span>
<span class="normal"><a href="#__codelineno-31-33">33</a></span>
<span class="normal"><a href="#__codelineno-31-34">34</a></span>
<span class="normal"><a href="#__codelineno-31-35">35</a></span>
<span class="normal"><a href="#__codelineno-31-36">36</a></span>
<span class="normal"><a href="#__codelineno-31-37">37</a></span>
<span class="normal"><a href="#__codelineno-31-38">38</a></span>
<span class="normal"><a href="#__codelineno-31-39">39</a></span>
<span class="normal"><a href="#__codelineno-31-40">40</a></span>
<span class="normal"><a href="#__codelineno-31-41">41</a></span>
<span class="normal"><a href="#__codelineno-31-42">42</a></span>
<span class="normal"><a href="#__codelineno-31-43">43</a></span>
<span class="normal"><a href="#__codelineno-31-44">44</a></span>
<span class="normal"><a href="#__codelineno-31-45">45</a></span>
<span class="normal"><a href="#__codelineno-31-46">46</a></span>
<span class="normal"><a href="#__codelineno-31-47">47</a></span>
<span class="normal"><a href="#__codelineno-31-48">48</a></span>
<span class="normal"><a href="#__codelineno-31-49">49</a></span>
<span class="normal"><a href="#__codelineno-31-50">50</a></span>
<span class="normal"><a href="#__codelineno-31-51">51</a></span>
<span class="normal"><a href="#__codelineno-31-52">52</a></span>
<span class="normal"><a href="#__codelineno-31-53">53</a></span>
<span class="normal"><a href="#__codelineno-31-54">54</a></span>
<span class="normal"><a href="#__codelineno-31-55">55</a></span>
<span class="normal"><a href="#__codelineno-31-56">56</a></span>
<span class="normal"><a href="#__codelineno-31-57">57</a></span>
<span class="normal"><a href="#__codelineno-31-58">58</a></span>
<span class="normal"><a href="#__codelineno-31-59">59</a></span>
<span class="normal"><a href="#__codelineno-31-60">60</a></span>
<span class="normal"><a href="#__codelineno-31-61">61</a></span>
<span class="normal"><a href="#__codelineno-31-62">62</a></span>
<span class="normal"><a href="#__codelineno-31-63">63</a></span>
<span class="normal"><a href="#__codelineno-31-64">64</a></span>
<span class="normal"><a href="#__codelineno-31-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="cm">/**</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="cm"> * 暴露特定于 DispatcherServlet 的请求属性，并将实际的请求分派委托给 {@link #doDispatch} 方法</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="cm"> */</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="nd">@Override</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doService</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">    </span><span class="c1">// 日志记录，请求包含支持，添加框架级对象，解析闪存信息，路径解析</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">    </span><span class="cm">/*</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="cm">    logRequest(request);</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="cm">    // Keep a snapshot of the request attributes in case of an include,</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="cm">    // to be able to restore the original attributes after the include.</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="cm">    Map&lt;String, Object&gt; attributesSnapshot = null;</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="cm">    if (WebUtils.isIncludeRequest(request)) {</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="cm">        attributesSnapshot = new HashMap&lt;&gt;();</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="cm">        Enumeration&lt;?&gt; attrNames = request.getAttributeNames();</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="cm">        while (attrNames.hasMoreElements()) {</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="cm">            String attrName = (String) attrNames.nextElement();</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="cm">            if (this.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) {</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="cm">                attributesSnapshot.put(attrName, request.getAttribute(attrName));</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="cm">            }</span>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="cm">        }</span>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="cm">    }</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="cm">    // Make framework objects available to handlers and view objects.</span>
<a id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="cm">    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</span>
<a id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="cm">    request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver);</span>
<a id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="cm">    request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver);</span>
<a id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="cm">    request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</span>
<a id="__codelineno-31-29" name="__codelineno-31-29"></a>
<a id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="cm">    if (this.flashMapManager != null) {</span>
<a id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="cm">        FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response);</span>
<a id="__codelineno-31-32" name="__codelineno-31-32"></a><span class="cm">        if (inputFlashMap != null) {</span>
<a id="__codelineno-31-33" name="__codelineno-31-33"></a><span class="cm">            request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</span>
<a id="__codelineno-31-34" name="__codelineno-31-34"></a><span class="cm">        }</span>
<a id="__codelineno-31-35" name="__codelineno-31-35"></a><span class="cm">        request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap());</span>
<a id="__codelineno-31-36" name="__codelineno-31-36"></a><span class="cm">        request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager);</span>
<a id="__codelineno-31-37" name="__codelineno-31-37"></a><span class="cm">    }</span>
<a id="__codelineno-31-38" name="__codelineno-31-38"></a>
<a id="__codelineno-31-39" name="__codelineno-31-39"></a><span class="cm">    RequestPath previousRequestPath = null;</span>
<a id="__codelineno-31-40" name="__codelineno-31-40"></a><span class="cm">    if (this.parseRequestPath) {</span>
<a id="__codelineno-31-41" name="__codelineno-31-41"></a><span class="cm">        previousRequestPath = (RequestPath) request.getAttribute(ServletRequestPathUtils.PATH_ATTRIBUTE);</span>
<a id="__codelineno-31-42" name="__codelineno-31-42"></a><span class="cm">        ServletRequestPathUtils.parseAndCache(request);</span>
<a id="__codelineno-31-43" name="__codelineno-31-43"></a><span class="cm">    }</span>
<a id="__codelineno-31-44" name="__codelineno-31-44"></a><span class="cm">    */</span>
<a id="__codelineno-31-45" name="__codelineno-31-45"></a>
<a id="__codelineno-31-46" name="__codelineno-31-46"></a><span class="w">    </span><span class="c1">// 设置 Web 应用上下文 </span>
<a id="__codelineno-31-47" name="__codelineno-31-47"></a><span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="na">setAttribute</span><span class="p">(</span><span class="n">WEB_APPLICATION_CONTEXT_ATTRIBUTE</span><span class="p">,</span><span class="w"> </span><span class="n">getWebApplicationContext</span><span class="p">());</span>
<a id="__codelineno-31-48" name="__codelineno-31-48"></a>
<a id="__codelineno-31-49" name="__codelineno-31-49"></a><span class="w">    </span><span class="c1">// 核心请求分发逻辑 </span>
<a id="__codelineno-31-50" name="__codelineno-31-50"></a><span class="w">    </span><span class="n">doDispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<a id="__codelineno-31-51" name="__codelineno-31-51"></a>
<a id="__codelineno-31-52" name="__codelineno-31-52"></a><span class="w">    </span><span class="cm">/*</span>
<a id="__codelineno-31-53" name="__codelineno-31-53"></a><span class="cm">    finally {</span>
<a id="__codelineno-31-54" name="__codelineno-31-54"></a><span class="cm">        if (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {</span>
<a id="__codelineno-31-55" name="__codelineno-31-55"></a><span class="cm">            // Restore the original attribute snapshot, in case of an include.</span>
<a id="__codelineno-31-56" name="__codelineno-31-56"></a><span class="cm">            if (attributesSnapshot != null) {</span>
<a id="__codelineno-31-57" name="__codelineno-31-57"></a><span class="cm">                restoreAttributesAfterInclude(request, attributesSnapshot);</span>
<a id="__codelineno-31-58" name="__codelineno-31-58"></a><span class="cm">            }</span>
<a id="__codelineno-31-59" name="__codelineno-31-59"></a><span class="cm">        }</span>
<a id="__codelineno-31-60" name="__codelineno-31-60"></a><span class="cm">        if (this.parseRequestPath) {</span>
<a id="__codelineno-31-61" name="__codelineno-31-61"></a><span class="cm">            ServletRequestPathUtils.setParsedRequestPath(previousRequestPath, request);</span>
<a id="__codelineno-31-62" name="__codelineno-31-62"></a><span class="cm">        }</span>
<a id="__codelineno-31-63" name="__codelineno-31-63"></a><span class="cm">    }</span>
<a id="__codelineno-31-64" name="__codelineno-31-64"></a><span class="cm">     */</span>
<a id="__codelineno-31-65" name="__codelineno-31-65"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="4-dodispatch"><strong>4. 请求分发 doDispatch</strong><a class="headerlink" href="#4-dodispatch" title="Permanent link">&para;</a></h3>
<p><code>doDispatch</code> 是 <code>Spring MVC</code> 的请求分发核心逻辑，负责将请求分配给合适的处理器（Handler）并执行。</p>
<p><code>com.iflove.simplespring.webmvc.DispatcherServlet#doDispatch</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span>
<span class="normal"><a href="#__codelineno-32-20">20</a></span>
<span class="normal"><a href="#__codelineno-32-21">21</a></span>
<span class="normal"><a href="#__codelineno-32-22">22</a></span>
<span class="normal"><a href="#__codelineno-32-23">23</a></span>
<span class="normal"><a href="#__codelineno-32-24">24</a></span>
<span class="normal"><a href="#__codelineno-32-25">25</a></span>
<span class="normal"><a href="#__codelineno-32-26">26</a></span>
<span class="normal"><a href="#__codelineno-32-27">27</a></span>
<span class="normal"><a href="#__codelineno-32-28">28</a></span>
<span class="normal"><a href="#__codelineno-32-29">29</a></span>
<span class="normal"><a href="#__codelineno-32-30">30</a></span>
<span class="normal"><a href="#__codelineno-32-31">31</a></span>
<span class="normal"><a href="#__codelineno-32-32">32</a></span>
<span class="normal"><a href="#__codelineno-32-33">33</a></span>
<span class="normal"><a href="#__codelineno-32-34">34</a></span>
<span class="normal"><a href="#__codelineno-32-35">35</a></span>
<span class="normal"><a href="#__codelineno-32-36">36</a></span>
<span class="normal"><a href="#__codelineno-32-37">37</a></span>
<span class="normal"><a href="#__codelineno-32-38">38</a></span>
<span class="normal"><a href="#__codelineno-32-39">39</a></span>
<span class="normal"><a href="#__codelineno-32-40">40</a></span>
<span class="normal"><a href="#__codelineno-32-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="cm">/**</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="cm"> * 处理实际的分派到处理器的过程。</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="cm"> *</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="cm"> * &lt;p&gt;处理器将通过按顺序应用 servlet 的 HandlerMappings 来获取。</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="cm"> * HandlerAdapter 将通过查询 servlet 安装的 HandlerAdapters 来找到第一个支持该处理器类的适配器。</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="cm"> * &lt;p&gt;所有的 HTTP 方法都由该方法处理。具体哪些方法是可接受的，由 HandlerAdapters 或处理器本身决定</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="cm"> *</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="cm"> * @param req  current HTTP request</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="cm"> * @param resp current HTTP response</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="cm"> * @throws Exception in case of any kind of processing failure</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="cm"> */</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doDispatch</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="w">    </span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="w">    </span><span class="n">HandlerExecutionChain</span><span class="w"> </span><span class="n">handlerExecutionChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="w">        </span><span class="n">handlerExecutionChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getHandler</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="w">        </span><span class="c1">//handlerMethod找不到则返回404</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ObjectUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">handlerExecutionChain</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a><span class="w">            </span><span class="n">resp</span><span class="p">.</span><span class="na">sendError</span><span class="p">(</span><span class="n">HttpServletResponse</span><span class="p">.</span><span class="na">SC_NOT_FOUND</span><span class="p">);</span>
<a id="__codelineno-32-21" name="__codelineno-32-21"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a>
<a id="__codelineno-32-24" name="__codelineno-32-24"></a><span class="w">        </span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">afterCompletion</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">getHandlerMethod</span><span class="p">(),</span><span class="w"> </span><span class="n">ex</span><span class="p">);</span>
<a id="__codelineno-32-25" name="__codelineno-32-25"></a>
<a id="__codelineno-32-26" name="__codelineno-32-26"></a><span class="w">        </span><span class="c1">// 获得适配器</span>
<a id="__codelineno-32-27" name="__codelineno-32-27"></a><span class="w">        </span><span class="n">HandlerAdapter</span><span class="w"> </span><span class="n">ha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getHandlerAdapter</span><span class="p">(</span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">getHandlerMethod</span><span class="p">());</span>
<a id="__codelineno-32-28" name="__codelineno-32-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">applyPreInterceptor</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-29" name="__codelineno-32-29"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-32-30" name="__codelineno-32-30"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-32-31" name="__codelineno-32-31"></a><span class="w">        </span><span class="n">ha</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">getHandlerMethod</span><span class="p">());</span>
<a id="__codelineno-32-32" name="__codelineno-32-32"></a><span class="w">        </span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">applyPostInterceptor</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<a id="__codelineno-32-33" name="__codelineno-32-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-34" name="__codelineno-32-34"></a><span class="w">        </span><span class="n">ex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-32-35" name="__codelineno-32-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-36" name="__codelineno-32-36"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-37" name="__codelineno-32-37"></a><span class="w">        </span><span class="n">processDispatchResult</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">handlerExecutionChain</span><span class="p">,</span><span class="w"> </span><span class="n">ex</span><span class="p">);</span>
<a id="__codelineno-32-38" name="__codelineno-32-38"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-39" name="__codelineno-32-39"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServletException</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-32-40" name="__codelineno-32-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-41" name="__codelineno-32-41"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="5-gethandler"><strong>5. 处理器查找 getHandler</strong><a class="headerlink" href="#5-gethandler" title="Permanent link">&para;</a></h3>
<p>查找对应的处理器 <code>handler</code>，并与 <code>HandlerInterceptor</code> 组装为处理器链返回。</p>
<p><code>com.iflove.simplespring.webmvc.DispatcherServlet#getHandler</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="cm">/**</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="cm"> * Return the HandlerExecutionChain for this request.</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="cm"> * &lt;p&gt;Tries all handler mappings in order.</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="cm"> *</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="cm"> * @param request current HTTP request</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="cm"> * @return the HandlerExecutionChain, or {@code null} if no handler could be found</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="cm"> */</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="nd">@Nullable</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="kd">protected</span><span class="w"> </span><span class="n">HandlerExecutionChain</span><span class="w"> </span><span class="nf">getHandler</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">handlerMappings</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">HandlerMapping</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">handlerMappings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">            </span><span class="n">HandlerExecutionChain</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapping</span><span class="p">.</span><span class="na">getHandler</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">handler</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">handler</span><span class="p">;</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="6-gethandleradapter"><strong>6. 适配器查找 getHandlerAdapter</strong><a class="headerlink" href="#6-gethandleradapter" title="Permanent link">&para;</a></h3>
<p>根据 <code>handler</code> 查找支持的适配器</p>
<p><code>com.iflove.simplespring.webmvc.DispatcherServlet#getHandlerAdapter</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="cm">/**</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="cm"> * Return the HandlerAdapter for this handler object.</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="cm"> *</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="cm"> * @param handler the handler object to find an adapter for</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="cm"> * @throws ServletException if no HandlerAdapter can be found for the handler. This is a fatal error.</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="cm"> */</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="kd">protected</span><span class="w"> </span><span class="n">HandlerAdapter</span><span class="w"> </span><span class="nf">getHandlerAdapter</span><span class="p">(</span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">handlerAdapters</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">HandlerAdapter</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">handlerAdapters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adapter</span><span class="p">.</span><span class="na">support</span><span class="p">(</span><span class="n">handler</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">adapter</span><span class="p">;</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServletException</span><span class="p">(</span><span class="s">&quot;No adapter for handler [&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="w">            </span><span class="s">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span><span class="p">);</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="7-hahandle"><strong>7. 请求处理 ha.handle(...)</strong><a class="headerlink" href="#7-hahandle" title="Permanent link">&para;</a></h3>
<p>在请求处理前后分别进行拦截器的前置处理与后置处理。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">applyPreInterceptor</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="p">}</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="n">ha</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">getHandlerMethod</span><span class="p">());</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="n">handlerExecutionChain</span><span class="p">.</span><span class="na">applyPostInterceptor</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><code>com.iflove.simplespring.webmvc.adapter.RequestMappingHandlerMethodAdapter#handle</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Java</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="cm">/**</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="cm"> * 处理请求，执行方法就在这内部</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="cm"> */</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="nd">@Override</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">HandlerMethod</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">WebServletRequest</span><span class="w"> </span><span class="n">webServletRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebServletRequest</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">);</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">    </span><span class="c1">// 需要将 HandlerMethod执行，创建一个类来包装</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">ServletInvocableHandlerMethod</span><span class="w"> </span><span class="n">invocableMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServletInvocableHandlerMethod</span><span class="p">();</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">    </span><span class="c1">// 获取到初始化的组件</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">    </span><span class="n">invocableMethod</span><span class="p">.</span><span class="na">setHandlerMethod</span><span class="p">(</span><span class="n">handler</span><span class="p">);</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">    </span><span class="n">invocableMethod</span><span class="p">.</span><span class="na">setConversionService</span><span class="p">(</span><span class="n">conversionService</span><span class="p">);</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">    </span><span class="n">invocableMethod</span><span class="p">.</span><span class="na">setResolverComposite</span><span class="p">(</span><span class="n">resolverComposite</span><span class="p">);</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">    </span><span class="n">invocableMethod</span><span class="p">.</span><span class="na">setReturnValueHandlerComposite</span><span class="p">(</span><span class="n">returnValueHandlerComposite</span><span class="p">);</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">    </span><span class="c1">// 执行方法逻辑</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="w">    </span><span class="n">invocableMethod</span><span class="p">.</span><span class="na">invokeAndHandle</span><span class="p">(</span><span class="n">webServletRequest</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->

  
    
  

  <!-- Determine date of creation -->
  


<!-- Source file information -->

  <aside class="md-source-file">

    <!-- Date of last update -->
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2025年10月22日 12:37:18 UTC">2025-10-22</span>
  </span>

    

    <!-- Date of creation -->
    

    <!-- Authors (git-authors plugin) -->
    

    <!-- Authors (git-committers plugin) -->
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="贡献者">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a
          href="https://github.com/LunaY77"
          class="md-author"
          title="@LunaY77"
        >
          
          <img
            src="https://avatars.githubusercontent.com/u/106435907?v=4&size=72"
            alt="LunaY77"
          />
        </a>
      

      <!-- More authors -->
      
      
    </nav>
  </span>

    
  </aside>

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine feedback configuration -->

  


<!-- Determine whether to show feedback -->


<!-- Was this page helpful? -->

  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        此页面有帮助吗？
      </legend>
      <div class="md-feedback__inner">

        <!-- Feedback ratings -->
        <div class="md-feedback__list">
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page was helpful"
              data-md-value="1"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg>
            </button>
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page could be improved"
              data-md-value="0"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg>
            </button>
          
        </div>

        <!-- Feedback rating notes (shown after submission) -->
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              谢谢你的反馈！
            </div>
          
            <div data-md-value="0" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              Thanks for your feedback! Help us improve this page by using our <a href="https://marketingplatform.google.com/about/analytics/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Comment system -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <!-- Footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    
      
      <nav
        class="md-footer__inner md-grid"
        aria-label="页脚"
        
      >

        <!-- Link to previous page -->
        
          
          <a
            href="../Spring-IOC/"
            class="md-footer__link md-footer__link--prev"
            aria-label="上一页: Spring IOC 容器"
          >
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Spring IOC 容器
              </div>
            </div>
            
          </a>
        

        <!-- Link to next page -->
        
          
          <a
            href="../Spring-tx/"
            class="md-footer__link md-footer__link--next"
            aria-label="下一页: Spring 事务"
          >
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Spring 事务
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022~2024 褚成志/All Rights Reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
   
    <font color="#B9B9B9">
      <div class="footer-visit-count" style="display: flex; justify-content: center; align-items: center;">
    本站访问量：<script async src="//finicounter.eu.org/finicounter.js"></script>
    <span id="finicount_views"></span>    &nbsp;|&nbsp;
    <footer>
      <!-- <a href="http://beian.miit.gov.cn/" target="_blank">浙ICP备2024135861号-1</a> -->
    </footer>
  
  </div>
      </font>

      <style>
        .footer-visit-count {
            height: fit-content;
            min-height: 55px; /* 根据实际情况调整此高度 */
        }
        </style>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/initchu" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<782081987@qq.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M61.4 64C27.5 64 0 91.5 0 125.4c0 .9 0 1.7.1 2.6H0v256c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V128h-.1c0-.9.1-1.7.1-2.6 0-33.9-27.5-61.4-61.4-61.4zM464 192.3V384c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192.3l154.8 117.4c31.4 23.9 74.9 23.9 106.4 0zM48 125.4c0-7.4 6-13.4 13.4-13.4h389.2c7.4 0 13.4 6 13.4 13.4 0 4.2-2 8.2-5.3 10.7L280.2 271.5c-14.3 10.8-34.1 10.8-48.4 0L53.3 136.1c-3.3-2.5-5.3-6.5-5.3-10.7"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["announce.dismiss", "content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "navigation.expand", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/javascripts/extra.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="../../../../javascripts/editable-code.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.0.2/dist/add-html-label-6e56ed67.min.js"></script>
      
    
    <script src="../../../../assets/javascripts/custom.9458f965.min.js"></script>
  
  </body>
</html>